

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Scan &mdash; Scale 5.3.0-snapshot documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Scale 5.3.0-snapshot documentation" href="../index.html"/>
        <link rel="up" title="Architecture" href="index.html"/>
        <link rel="next" title="Strike" href="strike.html"/>
        <link rel="prev" title="Import/Export" href="port.html"/>
    <link href="../_static/style.css" rel="stylesheet" type="text/css">


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Scale
          

          
            
            <img src="../_static/scale3-transparent-128.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                5.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithm_integration/index.html">Algorithm Integration into Scale</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Architecture</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="jobs/index.html">Jobs and Recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="logs.html">ElasticSearch Logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="messaging.html">Messaging System</a></li>
<li class="toctree-l2"><a class="reference internal" href="port.html">Import/Export</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Scan</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scan-configuration-specification-version-1-0">Scan Configuration Specification Version 1.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#directory-scanner">Directory Scanner</a></li>
<li class="toctree-l3"><a class="reference internal" href="#s3-scanner">S3 Scanner</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="strike.html">Strike</a></li>
<li class="toctree-l2"><a class="reference internal" href="triggers.html">Triggers</a></li>
<li class="toctree-l2"><a class="reference internal" href="workspaces.html">Workspaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="django/index.html">Django/Code Base</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../rest/index.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Scale</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Architecture</a> &raquo;</li>
        
      <li>Scan</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/architecture/scan.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scan">
<span id="architecture-scan"></span><h1>Scan<a class="headerlink" href="#scan" title="Permalink to this headline">¶</a></h1>
<p>Scan is the name of Scale&#8217;s system job that scans for pre-existing source data files and ingests them into
Scale. A Scan job scans a given workspace for pre-existing files. Scale administrators would commonly use the Scan job
to bulk ingest data from a workspace prior to wiring it up for Strike processing.</p>
<p>When a file is identified within the workspace being scanned, its file name is checked against a number of rules using regular
expressions configured for that Scan job. When the first rule that matches the new file&#8217;s name is reached, that rule&#8217;s
other fields indicate how Scan should handle the file, such as tagging it with data type tags or moving the file to a
new location in a different workspace.</p>
<p>Scanning may be performed in two stages: dry run and ingest. When scanning is performed as a dry run, no ingest jobs will
result, but a file count will be stored in the Scan model. This can be valuable if it is desirable to identify the files
or count that will be matched prior to launching the actual ingest operations. There is no requirement to perform a dry
run first.</p>
<div class="section" id="scan-configuration-specification-version-1-0">
<span id="architecture-scan-spec"></span><h2>Scan Configuration Specification Version 1.0<a class="headerlink" href="#scan-configuration-specification-version-1-0" title="Permalink to this headline">¶</a></h2>
<p>A valid Scan configuration is a JSON document with the following structure:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;workspace&quot;</span><span class="o">:</span> <span class="nx">STRING</span><span class="p">,</span>
    <span class="s2">&quot;scanner&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="nx">STRING</span>
    <span class="p">},</span>
    <span class="s2">&quot;recursive&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;files_to_ingest&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;filename_regex&quot;</span><span class="o">:</span> <span class="nx">STRING</span><span class="p">,</span>
            <span class="s2">&quot;data_types&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="nx">STRING</span><span class="p">,</span>
                <span class="nx">STRING</span>
            <span class="p">],</span>
            <span class="s2">&quot;new_workspace&quot;</span><span class="o">:</span> <span class="nx">STRING</span><span class="p">,</span>
            <span class="s2">&quot;new_file_path&quot;</span><span class="o">:</span> <span class="nx">STRING</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>version</strong>: JSON string</p>
<blockquote>
<div>The <em>version</em> is an optional string value that defines the version of the configuration used. This allows updates to
be made to the specification while maintaining backwards compatibility by allowing Scale to recognize an older
version and convert it to the current version. The default value for <em>version</em> if it is not included is the latest
version, which is currently 1.0. It is recommended, though not required, that you include the <em>version</em> so that
future changes to the specification will still accept your Scan configuration.</div></blockquote>
<p><strong>workspace</strong>: JSON string</p>
<blockquote>
<div>The <em>workspace</em> field is a required string that specifies the name of the workspace that is being scanned. The
type of the workspace (its broker type) will determine which types of scanner can be used.</div></blockquote>
<p><strong>scanner</strong>: JSON object</p>
<blockquote>
<div><p>The <em>scanner</em> field is a required object that specifies the type and configuration of the scanner that will scan
<em>workspace</em> for files.</p>
<p><strong>type</strong>: JSON string</p>
<blockquote>
<div><p>The <em>type</em> is a required string that specifies the type of the scanner to use. The other fields that configure
the scanner are based upon the type of the scanner in the <em>type</em> field. Certain scanner types may only be used
on workspaces with corresponding broker types. The valid scanner types are:</p>
<p><strong>dir</strong></p>
<blockquote>
<div>A &#8220;dir&#8221; scanner identifies files within a directory. This scanner may only be used with a
<em>host</em> workspace.</div></blockquote>
<p><strong>s3</strong></p>
<blockquote>
<div>An &#8220;s3&#8221; scanner identifies objects within an Amazon Web Services (AWS) Simple Storage Service (S3) bucket.
This scanner may only be used with an <em>s3</em> workspace.</div></blockquote>
<p>Additional <em>scanner</em> fields may be required depending on the type of scanner selected. See below for more
information on each scanner type.</p>
</div></blockquote>
</div></blockquote>
<p><strong>recursive</strong>: JSON boolean</p>
<blockquote>
<div>The <em>recursive</em> field is an optional boolean that indicates whether a scanner should be limited to the root of a workspace
or traverse the entire tree. If ommitted, the default is true for full tree recursion.</div></blockquote>
<p><strong>files_to_ingest</strong>: JSON array</p>
<blockquote>
<div><p>The <em>files_to_ingest</em> field is a list of JSON objects that define the rules for how to handle files that appear in
the scanned workspace. The array must contain at least one item. Each JSON object has the following fields:</p>
<p><strong>filename_regex</strong>: JSON string</p>
<blockquote>
<div>The <em>filename_regex</em> field is a required string that defines a regular expression to check against the names of
new files in the scanned workspace. When a new file appears in the workspace, the file&#8217;s name is checked
against each expression in order of the <em>files_to_ingest</em> array. If an expression matches the new file name in
the workspace, that file is ingested according to the other fields in the JSON object and all subsequent rules
in the list are ignored (first rule matched is applied).</div></blockquote>
<p><strong>data_types</strong>: JSON array</p>
<blockquote>
<div>The <em>data_types</em> field is an optional list of strings. Any file that matches the corresponding file name regular
expression will have these data type strings &#8220;tagged&#8221; with the file. If not provided, <em>data_types</em> defaults to
an empty array.</div></blockquote>
<p><strong>new_workspace</strong>: JSON string</p>
<blockquote>
<div>The <em>new_workspace</em> field optionally specifies the name of a new workspace to which the file should be copied.
This allows the ingest process to move files to a different workspace after they appear in the scanned
workspace.</div></blockquote>
<p><strong>new_file_path</strong>: JSON string</p>
<blockquote>
<div>The <em>new_file_path</em> field is an optional string that specifies a new relative path for storing new files. If
<em>new_workspace</em> is also specified, the file is moved to the new workspace at this new path location (instead of
using the current path the new file originally came in on). If <em>new_workspace</em> is not specified, the file is
moved to this new path location within the original scanned workspace. In either of these cases, three
additional and dynamically named directories, for the current year, month, and day, will be appended to the
<em>new_file_path</em> value automatically by the Scale system (i.e. workspace_path/YYYY/MM/DD).</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="directory-scanner">
<h2>Directory Scanner<a class="headerlink" href="#directory-scanner" title="Permalink to this headline">¶</a></h2>
<p>The directory scanner uses a workspace that mounts a host directory into the container and scans that
directory for files. Therefore this scanner only works with a host workspace. For each file detected in the mounted
host directory, its file name is checked for the trailing file name suffix specified in the optional <em>transfer_suffix</em>
configuration field. If the file name contains the suffix, the scanner will skip that file.</p>
<p>Example directory watching scanner configuration:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;workspace&quot;</span><span class="o">:</span> <span class="s2">&quot;my-host-workspace&quot;</span><span class="p">,</span>
    <span class="s2">&quot;scanner&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;dir-watcher&quot;</span><span class="p">,</span>
        <span class="s2">&quot;transfer_suffix&quot;</span><span class="o">:</span> <span class="s2">&quot;_tmp&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;recursive&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;files_to_ingest&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;filename_regex&quot;</span><span class="o">:</span> <span class="s2">&quot;*.h5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data_types&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="s2">&quot;data type 1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;data type 2&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;new_workspace&quot;</span><span class="o">:</span> <span class="s2">&quot;my-new-workspace&quot;</span><span class="p">,</span>
            <span class="s2">&quot;new_file_path&quot;</span><span class="o">:</span> <span class="s2">&quot;/new/file/path&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The directory watching scanner requires one additional field in its configuration:</p>
<p><strong>transfer_suffix</strong>: JSON string</p>
<blockquote>
<div>The <em>transfer_suffix</em> field is an optional string that defines a suffix that is used on the file names to indicate
that files are still transferring and have not yet finished being copied into the scanned directory.</div></blockquote>
</div>
<div class="section" id="s3-scanner">
<h2>S3 Scanner<a class="headerlink" href="#s3-scanner" title="Permalink to this headline">¶</a></h2>
<p>The S3 scanner identifies objects within an Amazon Web Services (AWS) Simple Storage Service (S3) backed workspace.
After the scanner finds a new object in the S3 bucket, it applies the configured Scan rules.</p>
<p>Example S3 scanner configuration:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;workspace&quot;</span><span class="o">:</span> <span class="s2">&quot;my-s3-workspace&quot;</span><span class="p">,</span>
    <span class="s2">&quot;scanner&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;s3&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;recursive&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;files_to_ingest&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;filename_regex&quot;</span><span class="o">:</span> <span class="s2">&quot;*.h5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data_types&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="s2">&quot;data type 1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;data type 2&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;new_workspace&quot;</span><span class="o">:</span> <span class="s2">&quot;my-new-workspace&quot;</span><span class="p">,</span>
            <span class="s2">&quot;new_file_path&quot;</span><span class="o">:</span> <span class="s2">&quot;/new/file/path&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The S3 scanner derives all its configuration from the associated workspace and
presently does not need any additional configuration.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="strike.html" class="btn btn-neutral float-right" title="Strike" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="port.html" class="btn btn-neutral" title="Import/Export" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, NGA.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'5.3.0-snapshot',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>