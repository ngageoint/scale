(function () {
    'use strict';

    var app = angular.module('scaleApp', [
        'scaleConfigModule',
        'ngResource',
        'ngSanitize',
        'ngRoute',
        'emguo.poller',
        'ui.bootstrap',
        'ui.grid',
        'ui.grid.selection',
        'ui.grid.pagination',
        'ui.grid.resizeColumns',
        'cfp.hotkeys',
        'toggle-switch'
    ]);

    app.config(['$routeProvider', '$resourceProvider', '$provide', 'pollerConfig', function($routeProvider, $resourceProvider, $provide, pollerConfig) {
        // Fix sourcemaps
        // @url https://github.com/angular/angular.js/issues/5217#issuecomment-50993513
        $provide.decorator('$exceptionHandler', ['$delegate', function ($delegate) {
            return function (exception, cause) {
                $delegate(exception, cause);
                setTimeout(function() {
                    throw exception;
                });
            };
        }]);

        // stop pollers when route changes
        pollerConfig.stopOnRouteChange = true;
        pollerConfig.smart = true;

        // preserve trailing slashes
        $resourceProvider.defaults.stripTrailingSlashes = false;

        //routing
        $routeProvider
            .when('/', {
                controller: 'ovController',
                controllerAs: 'vm',
                templateUrl: 'modules/overview/partials/ovTemplate.html'
            })
            .when('/admin/login',{
                controller: 'adminLoginController',
                templateUrl: 'modules/admin/partials/adminLoginTemplate.html'
            })
            .when('/admin/logout',{
                controller: 'logoutController',
                templateUrl: 'modules/admin/partials/adminLoginTemplate.html'
            })
            .when('/about', {
                controller: 'aboutController',
                controllerAs: 'vm',
                templateUrl: 'modules/about/partials/aboutTemplate.html'
            })
            .when('/feed', {
                controller: 'feedDetailsController',
                controllerAs: 'vm',
                templateUrl: 'modules/feed/partials/feedDetailsTemplate.html',
                reloadOnSearch: false
            })
            .when('/feed/ingests', {
                controller: 'ingestRecordsController',
                controllerAs: 'vm',
                templateUrl: 'modules/feed/partials/ingestRecordsTemplate.html',
                reloadOnSearch: false
            })
            .when('/feed/ingests/:id', {
                controller: 'ingestRecordDetailsController',
                controllerAs: 'vm',
                templateUrl: 'modules/feed/partials/ingestRecordDetailsTemplate.html'
            })
            .when('/metrics', {
                controller: 'metricsController',
                controllerAs: 'vm',
                templateUrl: 'modules/metrics/partials/metricsTemplate.html',
                reloadOnSearch: false
            })
            .when('/nodes', {
                controller: 'nodesController',
                controllerAs: 'vm',
                templateUrl: 'modules/nodes/partials/nodesTemplate.html'
            })
            .when('/nodes/:id', {
                controller: 'nodeDetailsController',
                controllerAs: 'vm',
                templateUrl: 'modules/nodes/partials/nodeDetailsTemplate.html'
            })
            .when('/load/queued', {
                controller: 'loadController',
                controllerAs: 'vm',
                templateUrl: 'modules/load/partials/loadTemplate.html'
            })
            .when('/load/running', {
                controller: 'queueRunningController',
                controllerAs: 'vm',
                templateUrl: 'modules/load/partials/queueRunningTemplate.html'
            })
            .when('/load/depth', {
                controller: 'loadDepthController',
                controllerAs: 'vm',
                templateUrl: 'modules/load/partials/loadDepthTemplate.html'
            })
            .when('/recipes', {
                controller: 'recipesController',
                controllerAs: 'vm',
                templateUrl: 'modules/recipes/partials/recipesTemplate.html',
                reloadOnSearch: false
            })
            .when('/recipes/recipe/:id', {
                controller: 'recipeDetailsController',
                controllerAs: 'vm',
                templateUrl: 'modules/recipes/partials/recipeDetailsTemplate.html'
            })
            .when('/recipes/types/:id?', {
                controller: 'recipeTypesController',
                controllerAs: 'vm',
                templateUrl: 'modules/recipes/partials/recipeTypesTemplate.html'
            })
            .when('/jobs', {
                controller: 'jobsController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobsTemplate.html',
                reloadOnSearch: false
            })
            .when('/jobs/job/:id', {
                controller: 'jobDetailController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobDetailTemplate.html'
            })
            .when('/jobs/types/:id?', {
                controller: 'jobTypesController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobTypesTemplate.html'
            })
            .when('/jobs/failure-rates', {
                controller: 'jobTypesFailureRatesController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobTypesFailureRatesTemplate.html',
                reloadOnSearch: false
            })
            .when('/jobs/executions', {
                controller: 'jobExecutionsController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobExecutionsTemplate.html'
            })
            .when('/jobs/executions/:id', {
                controller: 'jobExecutionDetailController',
                controllerAs: 'vm',
                templateUrl: 'modules/jobs/partials/jobExecutionDetailTemplate.html'
            })
            .when('/workspaces/:id?', {
                controller: 'workspacesController',
                controllerAs: 'vm',
                templateUrl: 'modules/workspaces/partials/workspacesTemplate.html'
            })
            .otherwise({
                redirectTo: '/'
            });
    }])
    .value('moment', window.moment)
    .value('localStorage', window.localStorage)
    .value('XMLHttpRequest', window.XMLHttpRequest)
    .value('toastr', window.toastr);
})();

(function () {
    'use strict';

    angular.module('scaleConfigModule', []).provider('scaleConfig', function () {
        var scaleConfig = {},
            scaleConfigLocal = {};

        this.$get = function () {
            var config = $.ajax({
                type: 'GET',
                url: 'config/scaleConfig.json',
                cache: false,
                async: false,
                contentType: 'application/json',
                dataType: 'json'
            });
            
            if (config.status === 200) {
                scaleConfig = config.responseJSON.scaleConfig;

                var configLocal = $.ajax({
                    type: 'GET',
                    url: 'config/scaleConfig.local.json',
                    cache: false,
                    async: false,
                    contentType: 'application/json',
                    dataType: 'json'
                });

                if (configLocal.status === 200) {
                    scaleConfigLocal = configLocal.responseJSON.scaleConfigLocal;
                }

                _.merge(scaleConfig, scaleConfigLocal);
            }

            return scaleConfig;
        }
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisHeaderController', ['subnavService', function(subnavService) {
        var vm = this;
        vm.currentPath = subnavService.getCurrentPath();
    }])
    .directive('aisHeader', function () {
        /**
         * Usage: <ais-header name={name}></ais-header>
         */
        return {
            controller: 'aisHeaderController',
            controllerAs: 'vm',
            restrict: 'E',
            templateUrl: 'modules/header/headerTemplate.html',
            scope: {
                name: '=',
                hideTitle: '=',
                loading: '=', // optional - will overlay a loading spinner on the page based on the passed-in value
                showSubnav: '=',
                subnavLinks: '='
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('scaleNavigation', function () {
        return {
            restrict: 'E',
            templateUrl: 'modules/navigation/partials/navTemplate.html',
            controller: 'navController',
            controllerAs: 'vm'
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aboutController', ['$scope', '$location', 'navService', 'stateService', function($scope, $location, navService, stateService) {
        var vm = this;
        
        vm.stateService = stateService;
        vm.version = '';

        var initialize = function() {
            navService.updateLocation('about');
        };

        initialize();

        $scope.$watch('vm.stateService.getVersion()', function (newValue) {
            vm.version = newValue;
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('adminLoginController', ['$timeout', '$location', 'stateService', 'userService', function ($timeout, $location, stateService, userService) {

        var initialize = function () {
            var user = userService.getUserCreds();
            
            if (!user) {
                userService.login('admin');
            }

            $timeout(function () {
                // Any code in here will automatically have an $scope.apply() run afterwards
                $location.path('/');
            });
        };

        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('logoutController', ['$timeout', '$rootScope', '$location', 'userService', function ($timeout, $rootScope, $location, userService) {

        var initialize = function () {
            userService.logout();
            $timeout(function(){
                // Any code in here will automatically have an $scope.apply() run afterwards
                $location.path("/");
            });
        };

        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('aisDataFeedController', ['$scope', 'scaleConfig', 'loadService', 'scaleService', function ($scope, scaleConfig, loadService, scaleService) {
        var days = [],
            hours = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],
            values = {};
        
        var processNewFeed = function () {
            days = [];
            var day = '';
            if ($scope.feed) {
                _.forEach($scope.feed.values, function (val) {
                    var valday = moment.utc(val.time).format(scaleConfig.dateFormats.day);
                    var valhour = moment.utc(val.time).hour();
                    var id = valday + '_' + valhour;
                    values[id] = val;
                    if (valday !== day) {
                        day = valday;
                        days.push(valday);
                    }
                });
                buildTable();
            }
        };

        var buildTable = function () {
            var currDay = moment().utc().format(scaleConfig.dateFormats.day);
            var currHour = moment().utc().hour();

            var table_html = '<div class="table-responsive"><table>';
            table_html += '<tr><th>Hour (UTC)</th>';
            for(day in days) {
                table_html += '<td class="day-label" title="' + days[day] + '"><div class="day-of-week">' + scaleService.getDayString(moment(days[day]).day()) + '</div>' + moment(days[day]).format('MM/DD') + '</td>';
            }
            table_html += '</tr>';
            for(var hour in hours) {
                hour = 23-hour;
                table_html += '<tr>';
                table_html += '<th title="' + hours[hour] + ':00">' + hours[hour] + '</th>';

                for(var day in days) {
                    var key =  days[day] + '_' + hours[hour];
                    var files = values[key].files;
                    var size = values[key].size;
                    var cls = 'good';
                    if (days[day] === currDay) {
                        if (hours[hour] === currHour) {
                            cls = 'current';
                        }
                        else if (hours[hour] > currHour) {
                            cls = 'future';
                        }
                    }
                    if (files === 0 && size === 0 && cls !== 'current' && cls !== 'future') {
                        cls = 'unknown';
                    }
                    table_html += '<td id="' + key + '" title="' + days[day] + ' ' + hours[hour] + ':00">';
                    if (cls === 'future') {
                        table_html += '<span class="' + cls + '" id="span_' + days[day] + '_' + hours[hour] + '" style="display: block;">&nbsp;</span></td>';
                    }
                    else{
                        table_html += '<span class="' + cls + '" id="span_' + days[day] + '_' + hours[hour] + '" style="display: block;">' + scaleService.calculateFileSizeFromBytes(size,1) + ' / ' + files + '</span></td>';
                    }

                }
                table_html += '</tr>';
            }
            table_html += '</table></div>';
            $('#history').html(table_html);
        };

        var initialize = function () {

            $scope.$watch('feed', function (value) {
                if ($scope.feed) {
                    processNewFeed();
                }
            });
        };

        initialize();
    }]).directive('aisDataFeed', function () {
        return {
            controller: 'aisDataFeedController',
            templateUrl: 'modules/charts/dataFeed/dataFeedTemplate.html',
            restrict: 'E',
            scope: {
                feed: '=' // Feed data
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisDonutController', ['$scope', '$element', 'scaleConfig', function ($scope, $element, scaleConfig) {
        var colData = [],
            chart = null;

        var genChart = function () {
            if (chart) {
                var oldData = [],
                    removeIds = [];

                // reassemble currently displayed data to match colData
                _.forEach(chart.data(), function (d) {
                    oldData.push([d.values[0].id, d.values[0].value]);
                });

                // determine which elements to remove
                _.forEach(oldData, function (od) {
                    var keep = _.find(colData, function (cd) {
                        return cd[0] === od[0];
                    });
                    if (!keep) {
                        removeIds.push(od[0]);
                    }
                });

                // update chart
                chart.load({
                    columns: colData,
                    unload: removeIds
                });
            } else {
                chart = c3.generate({
                    bindto: $element[0],
                    data: {
                        columns: colData,
                        type: $scope.type,
                        colors: {
                            down: scaleConfig.colors.chart_red,
                            warning: scaleConfig.colors.chart_yellow,
                            up: scaleConfig.colors.chart_green,
                            Completed: scaleConfig.colors.chart_green,
                            Done: '#3681bf',
                            Queue: scaleConfig.colors.chart_yellow,
                            Failed: scaleConfig.colors.chart_red,
                            ALGORITHM: scaleConfig.colors.failure_algorithm,
                            DATA: scaleConfig.colors.failure_data,
                            SYSTEM: scaleConfig.colors.failure_system,
                            Offline: scaleConfig.colors.chart_red,
                            'High Failure Rate': scaleConfig.colors.chart_orange,
                            Paused: scaleConfig.colors.chart_yellow
                        }
                    },
                    transition: {
                        duration: 700
                    },
                    pie: {
                        label: {
                            format: d3.format(',')
                        }
                    },
                    donut: {
                        label: {
                            format: $scope.showLabel ? d3.format(',') : function () {
                                return '';
                            }
                        },
                        width: $scope.width,
                        title: $scope.name
                    },
                    tooltip: {
                        format: {
                            value: d3.format(',')
                        }
                    },
                    size: {
                        height: $scope.size || 320
                    }
                });
            }
            $element[0].style.position = 'static';
        };

        var initColumnData = function (){
            colData = [];
            $scope.data.forEach(function (obj){
                colData.push([obj.status,obj.count]);
            });
        };

        var initialize = function () {
            initColumnData();
            genChart();
        };

        $scope.$watch('data', function (data) {
            if (data) {
                if (data.length > 0) {
                    initialize();
                } else {
                    $($element[0]).empty();
                }
            }
        });

        window.onresize = function () {
            genChart();
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisDonut', function () {
        return {
            controller: 'aisDonutController',
            restrict: 'E',
            scope: {
                data: '=',
                type: '=',
                size: '=',
                showLabel: '=',
                width: '=',
                name: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisGridChartController', ['$rootScope', '$scope', '$location', '$uibModal', 'userService', 'scaleConfig', 'scaleService', function ($rootScope, $scope, $location, $uibModal, userService, scaleConfig, scaleService) {
        var vm = this,
            svg = null,
            rect = null,
            scale = parseFloat($scope.scale),
            tip = d3.tip()
                .attr('class', 'd3-tip')
                .offset([-10, 0])
                .html(function(d) {
                    var failures = d.status.getFailures(),
                        failStr = failures.length > 0 ? '<br /><br />' : '',
                        running = getCellActivityTotal(d),
                        completed = getCellTotal(d),
                        statusStr = running > 0 || completed > 0 ? '<br />' : '';

                    if (running > 0) {
                        statusStr = statusStr + '<span class="label label-running">Running: ' + running + '</span>';
                    }
                    if (completed > 0) {
                        statusStr = statusStr + ' <span class="label label-completed">Completed: ' + completed + '</span>';
                    }

                    failures = _.sortByOrder(failures, ['order']);

                    _.forEach(failures, function (f) {
                        failStr = failStr + '<span class="label label-' + f.status.toLowerCase() + '">' + _.capitalize(f.status.toLowerCase()) + ': ' + f.count + '</span> ';
                    });
                    return d.title + ' ' + d.version + '<br />' + statusStr + failStr;
                }),
            cellWidth = 50 * scale,
            cellHeight = 50 * scale,
            enableZoom = typeof $scope.mode !== 'undefined' ? $scope.mode === 'zoom' : true,
            enableTooltip = typeof $scope.mode !== 'undefined' ? $scope.mode === 'tooltip' : false,
            enableReveal = typeof $scope.reveal !== 'undefined' ? $scope.reveal : true,
            user = userService.getUserCreds(),
            gridData = [],
            width = $('.grid-chart').width(),
            height = (Math.ceil(width / cellWidth) * cellHeight),
            cols = 0,
            rows = 0,
            cellFontLg = .4,
            cellFontSm = .3;
        
        vm.loading = true;
        vm.pauseReason = '';
        vm.dataValues = [];
        vm.gridClass = function () {
            return $scope.icons === true ? 'icons' : '';
        };

        $scope.$watchCollection('vm.dataValues', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            height = (Math.ceil(newValue.length / (Math.floor(width / cellWidth))) * cellHeight);
            if (enableZoom) {
                height = height * 6;
            }
            d3.select('.grid-chart-container svg').attr('height', height);
            d3.select('.overlay').attr('height', height);
        });

        var getDataValues = function (data) {
            gridData = [];
            vm.dataValues = [];
            if (data.data) {
                var dataType = data.data.toString().split(',')[0];
                if (dataType === 'JobType') {
                    vm.dataValues = _.sortByOrder(_.values(data.data), ['name'], ['asc']);
                    // associate JobType with JobTypeStatus
                    _.forEach(vm.dataValues, function (val) {
                        val.status = _.find(data.status, 'job_type.id', val.id);
                    });
                    vm.dataValues = _.sortByOrder(_.values(data.data), ['status.has_running', 'status.description', 'name'], ['asc', 'asc', 'asc']);
                } else if (dataType === 'Node') {
                    vm.dataValues = _.values(data.data);
                    //vm.dataValues = _.sortByOrder(_.values(data.data), ['hostname'], ['asc']);
                    // associate Node with NodeStatus
                    _.forEach(vm.dataValues, function (val) {
                        val.status = _.find(data.status, 'node.id', val.id);
                    });
                    //vm.dataValues = _.sortByOrder(vm.dataValues, ['hostname'], ['asc']); // sort by hostName asc
                } else {
                    vm.dataValues = data.data;
                }

                cols = $scope.columns ? $scope.columns : Math.floor(width / cellWidth);
                rows = $scope.rows ? $scope.rows : Math.ceil(vm.dataValues.length / cols);

                d3.range(rows).map(function (row) {
                    d3.range(cols).map(function (col) {
                        if (col <= vm.dataValues.length - 1) {
                            var dataObj = vm.dataValues[(cols * row) + col];
                            if (dataObj) {
                                dataObj.coords = [col * cellHeight, row * cellWidth];
                                gridData.push(dataObj);
                            }
                        }
                    });
                });

                update();
            }
        };

        var revealData = function () {
            d3.selectAll('.cell-text')
                .style('display', 'none');
            d3.selectAll('.cell-text-detail')
                .style('display', 'block');
            d3.selectAll('.cell-pause-resume-icon')
                .style('display', 'block');
        };

        var hideData = function () {
            d3.selectAll('.cell-text')
                .style('display', 'block');
            d3.selectAll('.cell-text-detail')
                .style('display', 'none');
            d3.selectAll('.cell-pause-resume-icon')
                .style('display', 'none');
        };

        var initialize = function (data) {
            cols = $scope.columns ? $scope.columns : Math.floor(width / cellWidth);
            rows = $scope.rows ? $scope.rows : Math.ceil(vm.dataValues.length / cols);

            var tickValues = Array.apply(null, {length: rows}).map(Number.call, Number);

            var zoom = d3.behavior.zoom()
                .scaleExtent([1, 6])
                //.center([0, 0])
                .on('zoom', zoomed);

            if (enableZoom) {
                svg = d3.select('.grid-chart').append('svg')
                    .attr('width', width)
                    .attr('height', height)
                    .append('g')
                    .call(zoom)
                    .append('g');
            } else if (enableTooltip) {
                svg = d3.select('.grid-chart').append('svg')
                    .attr('width', width)
                    .attr('height', height)
                    .append('g')
                    .call(tip);
            } else {
                svg = d3.select('.grid-chart').append('svg')
                    .attr('width', width)
                    .attr('height', height)
                    .append('g');
            }

            svg.append('rect')
                .attr('class', 'overlay')
                .attr('width', width)
                .attr('height', height);

            if (vm.showAxes) {
                var y = d3.scale.linear()
                    .domain([0, rows])
                    .range([0, height-10]);

                var yAxis = d3.svg.axis()
                    .scale(y)
                    .orient('left')
                    .tickValues(tickValues);

                svg.attr('transform', 'translate(' + 25 + ',' + 0 + ')')
                    .append('g')
                    .attr('class', 'y axis')
                    .attr('transform', 'translate(' + 0 + ',' + cellHeight / 2 + ')')
                    .call(yAxis);
            }

            getDataValues(data);

            function zoomed() {
                var s = d3.event.scale;

                if (enableReveal) {
                    if (s > 3) {
                        revealData();
                    } else {
                        hideData();
                    }
                }
                if (s === 1) {
                    if ($scope.showAxes) {
                        zoom.translate([25, 0]);
                    } else {
                        zoom.translate([0, 0]);
                    }
                }
                svg.attr('transform', 'translate(' + zoom.translate() + ')scale(' + d3.event.scale + ')');
            }

            vm.loading = false;
        };

        var dragOffsetX = 0,
            dragOffsetY = 0,
            clickOffsetX = 0,
            clickOffsetY = 0;

        var drag = d3.behavior.drag()
            .on('dragstart', function () {
                // track offsetX and offsetY to distinguish between drag and click
                dragOffsetX = d3.event.sourceEvent.layerX;
                dragOffsetY = d3.event.sourceEvent.layerY;
            });

        var getCellFill = function (d) {
            if (d && d.status) {
                return d.status.getCellFill();
            }
            return 'none';
        };

        var getCellText = function (d) {
            if (d) {
                return d.getCellText();
            }
        };

        var getCellActivity = function (d) {
            if (d && d.status) {
                if (d.toString() === 'JobType') {
                    return d.status.getCellActivity();
                }
            }
        };

        var getCellPauseResume = function (d) {
            if (d && d.status) {
                return d.status.getCellPauseResume();
            }
        };

        var getCellActivityTotal = function (d) {
            if (d && d.status) {
                return d.status.getCellActivityTotal();
            }
        };

        var getCellTitle = function (d) {
            if (d) {
                return d.getCellTitle();
            }
        };

        var getCellError = function (d) {
            if (d && d.status) {
                return d.status.getCellError();
            }
            return 'Failed: Unavailable';
        };

        var getCellTotal = function (d) {
            if (d && d.status) {
                return d.status.getCellTotal();
            }
            return 'Completed: Unavailable';
        };

        var getCellStatus = function (d) {
            if (d && d.status) {
                if (d.toString() === 'Node') {
                    return d.status.getCellStatus();
                }
            }
            return 'Status Unavailable';
        };

        var getCellJobs = function (d) {
            if (d && d.status) {
                if (d.toString() === 'Node') {
                    return d.status.getCellJobs();
                }
            }
        };

        var getCellFailures = function (d) {
            if (d && d.status) {
                if (d.toString() === 'JobType') {
                    return d.status.getCellFailures();
                }
            }
        };

        var cellClickHandler = function (target) {
            // track offsetX and offsetY to distinguish between drag and click
            clickOffsetX = d3.event.layerX;
            clickOffsetY = d3.event.layerY;
            if (dragOffsetX === clickOffsetX && dragOffsetY === clickOffsetY) {
                // offsets are the same; no dragging occurred; process as click event
                $scope.$apply(function () {
                    if (target.toString() === 'JobType') {
                        $location.path('/jobs').search('job_type_id', target.id).search('status', target.status.has_running.status);
                    } else if (target.toString() === 'Node') {
                        $location.path('/nodes/' + target.id);
                    }
                });
            }
        };

        var update = function () {
            var elem = $('.cell-activity-icon');
            TweenMax.to(elem, 1, {
                rotation: 360,
                transformOrigin: '50% 50%',
                repeat: -1,
                ease: Linear.easeNone
            });

            // DATA JOIN
            // Join new data with old elements, if any.
            if (enableTooltip) {
                var containerGroup = svg.selectAll('.cell-group')
                    .data(gridData, function (d) { return d.coords; })
                    .on('mouseover', tip.show)
                    .on('mouseout', tip.hide)
                    .on('click', tip.hide);
            } else {
                var containerGroup = svg.selectAll('.cell-group')
                    .data(gridData, function (d) { return d.coords; });
            }

            // UPDATE
            // Update old elements as needed.
            containerGroup.selectAll('.stop1')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        if (failures.length === 1) {
                            return '100%';
                        }
                        return '0%';
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        return failures[0] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[0] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });

            containerGroup.selectAll('.stop2')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        if (failures.length === 3) {
                            return '50%';
                        } else if (failures.length === 2) {
                            return '100%';
                        }
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 1) {
                        return failures[1] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[1] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });

            containerGroup.selectAll('.stop3')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 2) {
                        if (failures.length === 3) {
                            return '100%';
                        }
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 2) {
                        return failures[2] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[2] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });

            containerGroup.selectAll('.cell')
                .data(gridData, function (d) { return d.coords; })
                .transition()
                .duration(750)
                .style('stroke', function (d) {
                    return d ? '#fff' : 'none';
                })
                .style('fill', function (d) {
                    if (d.toString() === 'Node') {
                        return getCellFill(d);
                    }
                });

            var cg = containerGroup.selectAll('.cell-gradient');

            containerGroup.selectAll('.cell-text')
                .data(gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellText(d);
                })
                .attr('y', function (d) {
                    if (d.toString() === 'JobType' && getCellActivityTotal(d) > 0) {
                        return cellHeight / 2;
                    }
                    return (cellHeight / 2) + 10;
                });

            containerGroup.selectAll('.cell-total-active')
                .data(gridData, function (d) { return d.coords; })
                .text(function (d) {
                    if (d.toString() === 'JobType') {
                        return getCellActivityTotal(d);
                    }
                });

            containerGroup.selectAll('.cell-pause-resume-icon')
                .data(gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellPauseResume(d);
                });

            containerGroup.selectAll('.cell-activity-icon')
                .data(gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellActivity(d);
                });

            containerGroup.selectAll('.cell-title')
                .data(gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellTitle(d);
                });

            containerGroup.selectAll('.cell-error')
                .data(gridData, function (d) { return d.coords; })
                .text(function (d) {
                    return getCellError(d, true);
                });

            containerGroup.selectAll('.cell-total')
                .data(gridData, function (d) { return d.coords; })
                .text(function (d) {
                    return getCellTotal(d);
                });

            containerGroup.selectAll('.cell-status')
                .data(gridData, function (d) { return d.coords; })
                .text(function (d) {
                    return getCellStatus(d);
                });

            containerGroup.selectAll('.cell-jobs')
                .data(gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellJobs(d);
                });

            containerGroup.selectAll('.cell-overlay')
                .data(gridData, function (d) { return d.coords; })
                .on('click', function (target) {
                    cellClickHandler(target);
                });

            // ENTER
            // Create new elements as needed.
            var cellGroup = containerGroup.enter()
                .append('g')
                .attr('class', 'cell-group');

            var defs = cellGroup.append('defs');
            var gradient = defs.append('linearGradient')
                .attr('id', function (d) {
                    return d.name;
                })
                .attr('class', 'cell-gradient')
                .attr('x1', 0)
                .attr('y1', 0)
                .attr('x2', 0)
                .attr('y2', 1);
            gradient.append('stop')
                .attr('class', 'stop1')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        if (failures.length === 1) {
                            return '100%';
                        }
                        return '0%';
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        return failures[0] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[0] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });
            gradient.append('stop')
                .attr('class', 'stop2')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 1) {
                        if (failures.length === 3) {
                            return '50%';
                        } else if (failures.length === 2) {
                            return '100%';
                        }
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 1) {
                        return failures[1] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[1] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });
            gradient.append('stop')
                .attr('class', 'stop3')
                .attr('offset', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 2) {
                        if (failures.length === 3) {
                            return '100%';
                        }
                    }
                    return '0%';
                })
                .attr('stop-color', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 2) {
                        return failures[2] === 'SYSTEM' ? scaleConfig.colors.failure_system : failures[2] === 'DATA' ? scaleConfig.colors.failure_data : scaleConfig.colors.failure_algorithm;
                    }
                    return getCellFill(d);
                });

            cellGroup.append('rect')
                .attr('class', 'cell')
                .attr('width', cellWidth)
                .attr('height', cellHeight)
                .style('fill', function (d) {
                    if (d.toString() === 'Node') {
                        return getCellFill(d);
                    }
                })
                .attr('fill', function (d) {
                    if (d.toString() === 'JobType') {
                        return 'url(#' + d.name + ')';
                    }
                })
                .style('stroke', function (d) {
                    return d ? '#fff' : 'none';
                })
                .transition()
                .duration(750);

            cellGroup.append('text')
                .attr('class', 'cell-text')
                .html(function (d) {
                    return getCellText(d);
                })
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', function (d) {
                    if (d.toString() === 'JobType') {
                        if (getCellActivityTotal(d) > 0) {
                            return cellHeight / 2;
                        }
                        return (cellHeight / 2) + 10;
                    }
                    return cellHeight / 2;
                })
                .style('font-size', function (d) {
                    if (d.toString() === 'Node') {
                        return $scope.scale * 8 + 'px';
                    }
                    return '';
                })
                .style('display', enableReveal ? 'block' : 'none');

            cellGroup.append('text')
                .attr('class', 'cell-total-active')
                .text(function (d) {
                    if (d.toString() === 'JobType') {
                        return getCellActivityTotal(d);
                    }
                })
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', cellHeight - 5)
                .style('display', enableReveal ? 'block' : 'none');

            cellGroup.append('g')
                .attr('class', 'cell-activity')
                .append('text')
                .attr('class', 'cell-activity-icon')
                .attr('font-size', 11)
                .html(function (d) {
                    return getCellActivity(d);
                })
                .attr('text-anchor', 'end')
                .attr('x', cellWidth - 2)
                .attr('y', 13);

            var detail = cellGroup.append('text')
                .attr('class', 'cell-text-detail')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight *.15)) // 15% from top of cell
                .attr('dy', 0)
                .style('display', enableReveal ? 'none' : 'block');

            detail.append('tspan')
                .attr('class', 'cell-title')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight * .15)) // 15% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .html(function (d) {
                    return getCellTitle(d);
                })
                .call(wrap);

            detail.append('tspan')
                .attr('class', 'cell-error')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight *.3)) // 30% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .text(function (d) {
                    return getCellError(d);
                })
                .call(wrap);

            detail.append('tspan')
                .attr('class', 'cell-total')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight *.4)) // 40% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .text(function (d) {
                    return getCellTotal(d);
                })
                .call(wrap);

            detail.append('tspan')
                .attr('class', 'cell-status')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight * .55)) // 55% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontLg * scale + 'em')
                .text(function (d) {
                    return getCellStatus(d);
                });

            detail.append('tspan')
                .attr('class', 'cell-jobs')
                .attr('text-anchor', 'middle')
                .attr('x', cellWidth / 2)
                .attr('y', Math.floor(cellHeight * .75)) // 75% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .html(function (d) {
                    return getCellJobs(d);
                })
                .call(wrap);

            cellGroup.append('rect')
                .attr('class', 'cell-overlay')
                .attr('width', cellWidth)
                .attr('height', cellHeight)
                .style('fill', '#fff')
                .on('mouseover', function () {
                    d3.select(this)
                        .style('fill-opacity', '0.25');
                })
                .on('mouseout', function () {
                    d3.select(this)
                        .style('fill-opacity', '0');
                })
                .on('click', function (d) {
                    cellClickHandler(d);
                })
                .call(drag);

            if (user && user.is_admin) {
                cellGroup.append('text')
                    .attr('class', 'cell-pause-resume-icon')
                    .html(function (d) {
                        return getCellPauseResume(d);
                    })
                    .attr('text-anchor', 'start')
                    .attr('x', enableReveal ? 2 : 5)
                    .attr('y', enableReveal ? $scope.scale * 8 : 20)
                    .style('display', enableReveal ? 'none' : 'block')
                    .style('font-size', enableReveal ? $scope.scale * 7 + 'px' : '1.3em')
                    .on('mouseover', function () {
                        d3.select(this)
                            .style('cursor', 'pointer')
                            .style('fill', scaleConfig.colors.chart_blue);
                    })
                    .on('mouseout', function () {
                        d3.select(this)
                            .style('fill', 'white');
                    });
            }

            // ENTER + UPDATE
            // Appending to the enter selection expands the update selection to include
            // entering elements; so, operations on the update selection after appending to
            // the enter selection will apply to both entering and updating nodes.
            containerGroup.transition()
                .duration(750)
                .attr('transform', function (d) {
                    return 'translate(' + d.coords + ')';
                });

            var updateCellFill = function () {
                containerGroup.selectAll('.cell')
                    .transition()
                    .duration(250)
                    .style('stroke', function (d) {
                        return d ? '#fff' : 'none';
                    })
                    .style('fill', function (d) {
                        return getCellFill(d);
                    });
            };

            var updatePauseResume = function () {
                containerGroup.selectAll('.cell-pause-resume-icon')
                    .html(function (d) {
                        return getCellPauseResume(d);
                    });
            };

            var updateCellStatus = function () {
                containerGroup.selectAll('.cell-status')
                    .text(function (d) {
                        return getCellStatus(d);
                    });
            };

            // EXIT
            // Remove old elements as needed.
            containerGroup.exit()
                .attr('class', 'cell-exit')
                .transition()
                .duration(750)
                .attr('transform', 'translate(0,0)')
                .remove();

            function wrap (text, width) {
                text.each(function () {
                    var text = d3.select(this),
                        words = text.text().split(/\s+/).reverse(),
                        word,
                        line = [],
                        lineNumber = 0,
                        lineHeight = 1.1,
                        y = text.attr('y'),
                        dy = parseFloat(text.attr('dy')),
                        tspan = text.text(null).append('tspan').attr('x', cellWidth / 2).attr('y', y).attr('dy', dy + 'em');
                    while (word = words.pop()) {
                        if (word !== 'undefined') {
                            line.push(word);
                            tspan.text(line.join(' '));
                            if (tspan.node().getComputedTextLength() > (cellWidth - 10)) {
                                line.pop();
                                tspan.text(line.join(' '));
                                line = [word];
                                tspan = text.append('tspan').attr('x', cellWidth / 2).attr('y', y).attr('dy', ++lineNumber * lineHeight + dy + 'em').text(word);
                            }
                        }
                    }
                });
            }
        };

        $scope.$watch('data', function (data) {
            if (_.keys(data).length > 0) {
                $('.grid-chart').empty();
                initialize(data);
            }
        });

        $scope.$on('redrawGrid', function (event, data) {
            getDataValues(data);
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisGridChart', function () {
        return {
            controller: 'aisGridChartController',
            controllerAs: 'vm',
            templateUrl: 'modules/charts/grid/gridChartTemplate.html',
            restrict: 'E',
            scope: {
                data: '=',
                icons: '=', // indicates whether cell-text is entirely made up of icons
                scale: '=', // multiplier to increase cell size
                reveal: '=', // if true, less data will show when zoomed out
                mode: '@', // valid values are zoom or tooltip
                columns: '=',
                rows: '=',
                showAxes: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisHealthController', ['$scope', function ($scope) {
        var vm = this,
            initialized = false;

        var initialize = function () {
            initialized = true;
            var scale = $scope.scale || 1;
            vm.donutSize = 275 * scale;
            vm.donutWidth = 25 * scale;
        };

        $scope.$watch('data', function (data) {
            if (data) {
                if (_.keys(data).length > 0) {
                    if (!initialized) {
                        initialize();
                    }
                }
            }
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').directive('aisHealth', function () {
        return {
            controller: 'aisHealthController',
            controllerAs: 'vm',
            templateUrl: 'modules/charts/health/healthTemplate.html',
            restrict: 'E',
            scope: {
                name: '=',
                data: '=',
                scale: '=',
                errorLabel: '=',
                type: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisJobLoadController', ['$scope', 'scaleConfig', 'scaleService', 'loadService', function ($scope, scaleConfig, scaleService, loadService) {
        var vm = this,
            chart = null,
            colArr = [],
            xArr = [];

        vm.filterValue = 1;
        vm.filterDuration = 'w';
        vm.filterDurations = ['M', 'w', 'd'];
        vm.zoomEnabled = false;
        vm.zoomClass = 'btn-default';
        vm.zoomText = 'Enable Zoom';
        vm.jobLoadData = {};
        vm.loadingJobLoad = true;
        vm.jobLoadError = null;
        vm.jobLoadErrorStatus = null;
        vm.total = 0;
        vm.chartStyle = '';

        var jobLoadParams = {
            started: moment.utc().subtract(vm.filterValue, vm.filterDuration).startOf('d').toDate(), ended: moment.utc().endOf('d').toDate(), job_type_id: null, job_type_name: null, job_type_category: null, url: null
        };

        vm.toggleZoom = function () {
            vm.zoomEnabled = !vm.zoomEnabled;
            chart.zoom.enable(vm.zoomEnabled);
            if (vm.zoomEnabled) {
                vm.zoomClass = 'btn-primary';
                vm.zoomText = 'Disable Zoom';
            } else {
                vm.zoomClass = 'btn-default';
                vm.zoomText = 'Enable Zoom';
            }
        };

        var initChart = function () {
            xArr = [];
            
            xArr = _.pluck(vm.jobLoadData.results, 'time');
            _.forEach(xArr, function (d, i) {
                xArr[i] = moment.utc(d).toDate();
            });
            xArr.unshift('x');

            var pendingArr = _.pluck(vm.jobLoadData.results, 'pending_count'),
                queuedArr = _.pluck(vm.jobLoadData.results, 'queued_count'),
                runningArr = _.pluck(vm.jobLoadData.results, 'running_count');

            pendingArr.unshift('Pending');
            queuedArr.unshift('Queued');
            runningArr.unshift('Running');

            // add to colArr
            colArr = [xArr, pendingArr, queuedArr, runningArr];

            var types = {},
                type = {},
                groups = [];

            _.forEach(colArr, function(col){
                type = {};
                if (col[0] !== 'x') {
                    type[col[0]] = 'area';
                    groups.push(col[0]);
                }
                angular.extend(types, type);
            });

            if (chart) {
                chart.flush();
            }
            // chart config
            chart = c3.generate({
                bindto: '#job-load',
                data: {
                    x: 'x',
                    columns: colArr,
                    types: types,
                    groups: [groups],
                    colors: {
                        Pending: scaleConfig.colors.chart_pink,
                        Queued: scaleConfig.colors.chart_purple,
                        Running: scaleConfig.colors.chart_blue
                    }
                },
                transition: {
                    duration: 700
                },
                tooltip: {
                    format: {
                        title: function (x) {
                            return moment.utc(x).startOf('h').format(scaleConfig.dateFormats.day_second);
                        }
                    }
                },
                axis: {
                    x: {
                        type: 'timeseries',
                        tick: {
                            format: function (d) {
                                return moment.utc(d).format(scaleConfig.dateFormats.day);
                            }
                        }
                    }
                }
            });
            vm.loadingJobLoad = false;
        };

        var getJobLoad = function (showPageLoad) {
            if (showPageLoad) {
                $scope.$parent.loading = true;
            } else {
                vm.loadingJobLoad = true;
            }
            jobLoadParams.started = moment.utc().subtract(vm.filterValue, vm.filterDuration).startOf('d').toDate();
            jobLoadParams.ended = moment.utc(jobLoadParams.started).add(1, vm.filterDuration).endOf('d').toDate();
            jobLoadParams.page_size = 1000;

            loadService.getJobLoad(jobLoadParams).then(null, null, function (result) {
                if (result.$resolved) {
                    vm.jobLoadData = result;
                    initChart();
                } else {
                    if (result.statusText && result.statusText !== '') {
                        vm.jobLoadErrorStatus = result.statusText;
                    }
                    vm.jobLoadError = 'Unable to retrieve job load.';
                }
                if (showPageLoad) {
                    $scope.$parent.loading = false;
                } else {
                    vm.loadingJobLoad = false;
                }
            });
        };

        vm.updateJobLoadRange = function (action) {
            if (action === 'older') {
                vm.filterValue++;
            } else if (action === 'newer') {
                if (vm.filterValue > 1) {
                    vm.filterValue--;
                }
            } else if (action === 'today') {
                vm.filterValue = 1;
            }
            getJobLoad(true);
        };

        $scope.$watch('vm.filterValue', function (value) {
            var $jobLoadNewer = $('.job-load-newer'),
                $jobLoadToday = $('.job-load-today');

            if (value > 1) {
                $jobLoadNewer.removeAttr('disabled');
                $jobLoadToday.removeAttr('disabled');
            } else {
                $jobLoadNewer.attr('disabled', 'disabled');
                $jobLoadToday.attr('disabled', 'disabled');
            }
        });


        if ($scope.autoHeight) {
            // set chart height
            angular.element(document).ready(function () {
                // set container heights equal to available page height
                var viewport = scaleService.getViewportSize(),
                    offset = scaleConfig.headerOffset,
                    headerOffset = $('.job-load-header').height(),
                    legendOffset = $('.job-load-legend-label').height(),
                    filterOffset = $('.job-load-filter').outerHeight(true),
                    chartMaxHeight = viewport.height - offset - headerOffset - legendOffset - filterOffset - 5;

                vm.chartStyle = 'height: ' + chartMaxHeight + 'px; max-height: ' + chartMaxHeight + 'px;';
                getJobLoad();
            });
        } else {
            getJobLoad();
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisJobLoad', function () {
        return {
            controller: 'aisJobLoadController',
            controllerAs: 'vm',
            templateUrl: 'modules/charts/jobLoad/jobLoadTemplate.html',
            restrict: 'E',
            scope: {
                showFilter: '=', // show time range filter UI
                cullLegend: '=', // only show job types in legend whose value is > 0
                hideTitle: '=',
                autoHeight: '='
            }
        };
    });
})();

'use strict';

angular.module('scaleApp').controller('aisRadialPercentageController', ['$scope', '$element', 'scaleConfig', function ($scope, $element, scaleConfig) {
    var isInitialized = false,
        foreground = '',
        text = '',
        arcTween = '',
        textTween = '';

    var getForeground = function () {
        var value = parseFloat($scope.percentage);
        if (value >= 75) {
            return scaleConfig.colors.chart_green;
        } else if (value < 75 && value >= 50) {
            return scaleConfig.colors.chart_yellow;
        } else {
            return scaleConfig.colors.chart_red;
        }
    };

    var initialize = function () {
        // handle input either .83 or 83
        var percentage = $scope.percentage || 0;
        if (percentage > 1) {
            percentage /= 100;
        }

        // size the chart to the parent container. It's square, so take the
        // smaller of width/height
        var size = $element[0].parentNode.clientWidth;
        if ($element[0].parentNode.clientHeight < size) {
            size = $element[0].parentNode.clientHeight;
        }
        
        var formatPercent = d3.format('.0%');

        var arc = d3.svg.arc()
            .startAngle(0)
            .outerRadius(size * 0.95 / 2)
            .innerRadius(size * 0.80 / 2);

        var svg = d3.select($element[0]).append('svg').attr({
            width: size,
            height: size
        }).append('g').attr({
            'transform': 'translate(' + size / 2 + ',' + size / 2 + ')',
            'class': 'aisRadial'
        });

        var meter = svg.append('g').attr({
            'transform': 'rotate(180)'
        });
        meter.append('path')
            .datum({
                endAngle: (2 * Math.PI),
            })
            .attr('class', 'background')
            .attr('d', arc);

        foreground = meter.append('path')
            .datum({
                endAngle: 0
            })
            .attr({
                'd': arc
            })
            .style('fill', function () {
                return getForeground();
            });

        text = svg.append('text')
            .datum({
                percentage: 0
            })
            .attr('text-anchor', 'middle')
            .attr('dy', '.35em');


        textTween = function (transition, newPercentage) {
            transition.attrTween('text', function (d) {
                if (typeof d === 'undefined') {
                    d = 0;
                }
                var i = d3.interpolate(d.percentage, newPercentage);
                return function (t) {
                    d.percentage = i(t);
                    text.text(formatPercent(i(t)));
                    return t;
                }
            });
        };
        arcTween = function (transition, newAngle) {
            transition.attrTween('d', function (d) {
                var i = d3.interpolate(d.endAngle, newAngle);
                return function (t) {
                    d.endAngle = i(t);
                    return arc(d);
                };
            });
        };

        isInitialized = true;

        redraw(percentage);
    };

    var redraw = function (value) {
        if (isInitialized) {
            var percentage = value;
            if (percentage > 1) {
                percentage /= 100;
            }

            foreground.transition().duration(1000)
                .style('fill', function () {
                    return getForeground();
                })
                .call(arcTween, (Math.PI * 2) * percentage);
            text.transition().duration(1000).call(textTween, percentage);
        }
    };

    $scope.$watch('percentage', function (value) {
        if (value && !isInitialized) {
            initialize();
        } else {
            redraw(value);
        }
    })
}]);

'use strict';

angular.module('scaleApp').directive('aisRadialPercentage', function () {
    return {
        controller: 'aisRadialPercentageController',
        restrict: 'E',
        scope: {
            percentage: '@'
        }
    };
});

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisTimelineDirectiveController', ['$scope', '$element', 'scaleConfig', function ($scope, $element, scaleConfig) {
        var vm = this,
            gantt = null,
            taskNames = [];

        $element[0].onresize = function () {
            console.log('element resize');
        };

        var initialize = function () {
            $scope.$watch('tasks', function (value) {
                drawTimeline();
            });
        };

        var drawTimeline = function () {
            if ($scope.tasks && $scope.tasks.length > 0) {
                $scope.tasks.sort(function (a, b) {
                    return a[$scope.ended] - b[$scope.ended];
                });

                taskNames = _($scope.tasks).pluck('taskName').uniq().value();
                var height = taskNames.length * 30 + 20;

                var width = $element[0].clientWidth;
                if (!width || width === 0) { width = 600; }


                $scope.tasks.sort(function (a, b) {
                    return a[$scope.started] - b[$scope.started];
                });
                var minDate = $scope.tasks[0][$scope.started];
                var maxDate = $scope.tasks[$scope.tasks.length - 1][$scope.ended];
                var daysDiff = moment.utc(maxDate).diff(moment.utc(minDate),'days');
                var format = '%H:%M:%S.%m';
                if (daysDiff > 0) {
                    format = "%m/%d/%y %H:%M";
                }

                gantt = d3.gantt().renderTo("#ais-timeline").taskTypes(taskNames).taskStatus(scaleConfig.taskStatusStyles).tickFormat(format).begin($scope.started).ended($scope.ended).height(height).width(width);

                gantt.timeDomainMode("fit");

                gantt($scope.tasks);

            }
        };

        vm.formatDate = function (date) {
            if (date) {
                return moment.utc(date).toISOString();
            }
            else {
                return date;
            }
        };
        initialize();

    }]).directive('aisTimeline', function () {
        return {
            controller: 'aisTimelineDirectiveController',
            controllerAs: 'vm',
            templateUrl: 'modules/charts/timeline/timelineDirectiveTemplate.html',
            restrict: 'E',
            scope: {
                tasks: '=',
                started: '=',
                ended: '='
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisGridPagination', function () {
        return {
            templateUrl: 'modules/common/directives/aisGridPaginationTemplate.html',
            restrict: 'E'
        };
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').directive('aisMultiselect', function () {
        return {
            restrict: 'A',
            require: '^ngModel',
            scope: {
                multiselectDataProvider: '=',
                enableFiltering: '=',
                maxHeight: '=',
                numberDisplayed: '=',
                includeSelectAllOption: '=',
                nonSelectedText: '=',
                ngModel: '='
            },
            link: function(scope, element, attributes) {
                element = $(element[0]);

                element.multiselect({
                    enableFiltering: scope.enableFiltering,
                    enableCaseInsensitiveFiltering: true,
                    maxHeight: scope.maxHeight || 300,
                    numberDisplayed: scope.numberDisplayed || 3,
                    includeSelectAllOption: scope.includeSelectAllOption,
                    nonSelectedText: scope.nonSelectedText || 'None Selected',
                    onChange: function (optionElement, checked) {
                        scope.$apply(function () {
                            scope.ngModel = element.val();
                        });
                    }
                });

                scope.$watchCollection('multiselectDataProvider', function (newValue, oldValue) {
                    if (angular.equals(newValue, oldValue)) {
                        return;
                    }
                    element.multiselect('dataprovider', newValue);
                });

                /*
                // Watch for any changes to the length of our select element
                scope.$watch(function () {
                    return element[0];
                }, function (newValue) {
                    debugger;
                    //element.multiselect('setOptions', element[0]);
                    //element.multiselect('rebuild');
                }, true);

                // Watch for any changes from outside the directive and refresh
                scope.$watch(attributes.ngModel, function () {
                    element.multiselect('refresh');
                });
                */
            }
        };
    })
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('gaugeFactory', ['scaleConfig', function (scaleConfig) {
        var Gauge = function (placeholderName, configuration)
        {
            this.placeholderName = placeholderName;

            var self = this; // for internal d3 functions

            this.configure = function(configuration)
            {
                this.config = configuration;

                this.config.size = this.config.size * 0.9;

                this.config.radius = this.config.size * 0.97 / 2;
                this.config.cx = this.config.size / 2;
                this.config.cy = this.config.size / 2;

                this.config.min = undefined != configuration.min ? configuration.min : 0;
                this.config.max = undefined != configuration.max ? configuration.max : 100;
                this.config.range = this.config.max - this.config.min;

                this.config.majorTicks = configuration.majorTicks || 5;
                this.config.minorTicks = configuration.minorTicks || 2;

                this.config.greenColor 	= configuration.greenColor || '#8fca0e';
                this.config.yellowColor = configuration.yellowColor || '#ffc317';
                this.config.redColor 	= configuration.redColor || '#f54d36';
                this.config.grayColor   = configuration.grayColor || '#aaa';

                this.config.transitionDuration = configuration.transitionDuration || 500;
            };

            this.render = function()
            {
                this.body = d3.select('#' + this.placeholderName)
                    .append('svg:svg')
                    .attr('class', 'gauge')
                    .attr('width', this.config.size)
                    .attr('height', this.config.size);

                this.body.append('svg:circle')
                    .attr('class', 'outer-circle')
                    .attr('cx', this.config.cx)
                    .attr('cy', this.config.cy)
                    .attr('r', this.config.radius)
                    .style('fill', '#ccc');
                /*.style('stroke', '#000')
                 .style('stroke-width', '0.5px');*/

                this.body.append('svg:circle')
                    .attr('cx', this.config.cx)
                    .attr('cy', this.config.cy)
                    .attr('r', 0.9 * this.config.radius)
                    .style('fill', '#fff')
                    .style('stroke', '#e0e0e0')
                    .style('stroke-width', '2px');

                for (var greenIdx in this.config.greenZones)
                {
                    this.drawBand(this.config.greenZones[greenIdx].from, this.config.greenZones[greenIdx].to, self.config.greenColor);
                }

                for (var yellowIdx in this.config.yellowZones)
                {
                    this.drawBand(this.config.yellowZones[yellowIdx].from, this.config.yellowZones[yellowIdx].to, self.config.yellowColor);
                }

                for (var redIdx in this.config.redZones)
                {
                    this.drawBand(this.config.redZones[redIdx].from, this.config.redZones[redIdx].to, self.config.redColor);
                }

                var fontSize = 0;

                if (undefined != this.config.label)
                {
                    fontSize = Math.round(this.config.size / 9);
                    this.body.append('svg:text')
                        .attr('x', this.config.cx)
                        .attr('y', this.config.cy / 2 + fontSize / 2)
                        .attr('dy', fontSize / 2)
                        .attr('text-anchor', 'middle')
                        .text(this.config.label)
                        .style('font-size', fontSize + 'px')
                        .style('fill', '#333')
                        .style('stroke-width', '0px');
                }

                fontSize = Math.round(this.config.size / 16);
                var majorDelta = this.config.range / (this.config.majorTicks - 1);
                for (var major = this.config.min; major <= this.config.max; major += majorDelta)
                {
                    var minorDelta = majorDelta / this.config.minorTicks,
                        point1 = 0,
                        point2 = 0;
                    for (var minor = major + minorDelta; minor < Math.min(major + majorDelta, this.config.max); minor += minorDelta)
                    {
                        point1 = this.valueToPoint(minor, 0.75);
                        point2 = this.valueToPoint(minor, 0.85);

                        this.body.append('svg:line')
                            .attr('x1', point1.x)
                            .attr('y1', point1.y)
                            .attr('x2', point2.x)
                            .attr('y2', point2.y)
                            .style('stroke', '#666')
                            .style('stroke-width', '1px');
                    }

                    point1 = this.valueToPoint(major, 0.7);
                    point2 = this.valueToPoint(major, 0.85);

                    this.body.append('svg:line')
                        .attr('x1', point1.x)
                        .attr('y1', point1.y)
                        .attr('x2', point2.x)
                        .attr('y2', point2.y)
                        .style('stroke', '#333')
                        .style('stroke-width', '2px');

                    if (major == this.config.min || major == this.config.max)
                    {
                        var point = this.valueToPoint(major, 0.63);

                        this.body.append('svg:text')
                            .attr('x', point.x)
                            .attr('y', point.y)
                            .attr('dy', fontSize / 3)
                            .attr('text-anchor', major == this.config.min ? 'start' : 'end')
                            .text(major)
                            .style('font-size', fontSize + 'px')
                            .style('fill', '#333')
                            .style('stroke-width', '0px');
                    }
                }

                var pointerContainer = this.body.append('svg:g').attr('class', 'pointerContainer');

                var midValue = (this.config.min + this.config.max) / 2;

                var pointerPath = this.buildPointerPath(midValue);

                var pointerLine = d3.svg.line()
                    .x(function(d) { return d.x })
                    .y(function(d) { return d.y })
                    .interpolate('basis');

                pointerContainer.selectAll('path')
                    .data([pointerPath])
                    .enter()
                    .append('svg:path')
                    .attr('d', pointerLine)
                    .style('fill', '#888');

                pointerContainer.append('svg:circle')
                    .attr('cx', this.config.cx)
                    .attr('cy', this.config.cy)
                    .attr('r', 0.07 * this.config.radius)
                    .style('fill', '#888');

                fontSize = Math.round(this.config.size / 10);
                pointerContainer.selectAll('text')
                    .data([midValue])
                    .enter()
                    .append('svg:text')
                    .attr('x', this.config.cx)
                    .attr('y', this.config.size - this.config.cy / 4 - fontSize)
                    .attr('dy', fontSize / 2)
                    .attr('text-anchor', 'middle')
                    .style('font-size', fontSize + 'px')
                    .style('fill', '#000')
                    .style('stroke-width', '0px');

                this.redraw(this.config.min, 0);
            };

            this.buildPointerPath = function(value)
            {
                var delta = this.config.range / 13;

                var head = valueToPoint(value, 0.85);
                var head1 = valueToPoint(value - delta, 0.12);
                var head2 = valueToPoint(value + delta, 0.12);

                var tailValue = value - (this.config.range * (1/(270/360)) / 2);
                var tail = valueToPoint(tailValue, 0.28);
                var tail1 = valueToPoint(tailValue - delta, 0.12);
                var tail2 = valueToPoint(tailValue + delta, 0.12);

                return [head, head1, tail2, tail, tail1, head2, head];

                function valueToPoint(value, factor)
                {
                    var point = self.valueToPoint(value, factor);
                    point.x -= self.config.cx;
                    point.y -= self.config.cy;
                    return point;
                }
            };

            this.drawBand = function(start, end, color)
            {
                if (0 >= end - start) return;

                this.body.append('svg:path')
                    .style('fill', color)
                    .attr('d', d3.svg.arc()
                        .startAngle(this.valueToRadians(start))
                        .endAngle(this.valueToRadians(end))
                        .innerRadius(0.65 * this.config.radius)
                        .outerRadius(0.85 * this.config.radius))
                    .attr('transform', function() { return 'translate(' + self.config.cx + ', ' + self.config.cy + ') rotate(270)' });
            };

            this.redraw = function(value, transitionDuration)
            {
                var isDisabled = false;
                if (value < 0) {
                    isDisabled = true;
                    value = 0;
                }
                var pointerContainer = this.body.select('.pointerContainer');

                pointerContainer.selectAll('text').text(parseFloat(value).toFixed(2) + '%');

                var pointer = pointerContainer.selectAll('path');
                pointer.transition()
                    .duration(undefined != transitionDuration ? transitionDuration : this.config.transitionDuration)
                    //.delay(0)
                    //.ease('linear')
                    //.attr('transform', function(d)
                    .attrTween('transform', function()
                    {
                        var pointerValue = value;
                        if (value > self.config.max) pointerValue = self.config.max + 0.02*self.config.range;
                        else if (value < self.config.min) pointerValue = self.config.min - 0.02*self.config.range;
                        var targetRotation = (self.valueToDegrees(pointerValue) - 90);
                        var currentRotation = self._currentRotation || targetRotation;
                        self._currentRotation = targetRotation;

                        return function(step)
                        {
                            var rotation = currentRotation + (targetRotation-currentRotation)*step;
                            return 'translate(' + self.config.cx + ', ' + self.config.cy + ') rotate(' + rotation + ')';
                        }
                    });

                var outerCircle = this.body.select('.outer-circle')
                    .transition()
                    .duration(750)
                    .style('fill', function () {
                        var i = parseInt(value);
                        if (i >= 0 && i < 75 && !isDisabled) {
                            return self.config.greenColor;
                        } else if (i >= 75 && i < 90 && !isDisabled) {
                            return self.config.yellowColor;
                        } else if (i === 0 && isDisabled) {
                            return self.config.redColor;
                        } else {
                            return self.config.redColor;
                        }
                    });
            };

            this.valueToDegrees = function(value)
            {
                // thanks @closealert
                //return value / this.config.range * 270 - 45;
                return value / this.config.range * 270 - (this.config.min / this.config.range * 270 + 45);
            };

            this.valueToRadians = function(value)
            {
                return this.valueToDegrees(value) * Math.PI / 180;
            };

            this.valueToPoint = function(value, factor)
            {
                return { 	x: this.config.cx - this.config.radius * factor * Math.cos(this.valueToRadians(value)),
                    y: this.config.cy - this.config.radius * factor * Math.sin(this.valueToRadians(value)) 		};
            };

            // initialization
            this.configure(configuration);
        };

        return {
            createGauge: function (name, label, min, max, size) {
                var config = {
                    size: size || scaleConfig.defaultGaugeWidth,
                    label: label,
                    min: min || 0,
                    max: max || 100,
                    minorTicks: 5
                };

                var range = config.max - config.min;
                config.yellowZones = [{ from: config.min + range*0.75, to: config.min + range*0.9 }];
                config.redZones = [{ from: config.min + range*0.9, to: config.max }];

                var gauge = new Gauge(name + 'GaugeContainer', config);
                gauge.render();
                return gauge;
            }
        }
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('gridFactory', ['uiGridConstants', function (uiGridConstants) {

        var getSortConfig = function (orderParam) {
            var sortArr = [];

            if (orderParam) {
                _.forEach(orderParam, function (param) {
                    var sortField = param;
                    var sortDirection = 'asc';
                    if (_.startsWith(param, '-')) {
                        sortDirection = 'desc';
                    }
                    sortArr.push({
                        direction: sortDirection,
                        field: sortField
                    })
                });
            }

            return sortArr;
        };

        return {
            defaultGridOptions: function () {
                return {
                    enableRowSelection: true,
                    enableRowHeaderSelection: false,
                    enableHorizontalScrollbar: uiGridConstants.scrollbars.NEVER,
                    enableVerticalScrollbar: uiGridConstants.scrollbars.NEVER,
                    multiSelect: false,
                    enableFiltering: true,
                    useExternalSorting: true,
                    useExternalFiltering: true,
                    enableSorting: true,
                    minRowsToShow: 17,
                    paginationPageSizes: [25, 50, 75, 100],
                    paginationPageSize: 25,
                    useExternalPagination: true,
                    enablePaginationControls: false,
                    paginationCurrentPage: 1
                }
            },
            applySortConfig: function (columnDefs, gridParams) {
                var sortConfig = getSortConfig(gridParams.order);
                _.forEach(sortConfig, function (config, idx) {
                    var field = _.startsWith(config.field, '-') ? config.field.substring(1) : config.field,
                        colDef = _.find(columnDefs, {field: field});

                    if (colDef) {
                        colDef.sort = {
                            direction: config.direction,
                            priority: idx
                        };
                    }
                });
                return columnDefs;
            }
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('pollerFactory', ['poller', function (poller) {
        return {
            newPoller: function (resource, interval) {
                return poller.get(resource, {
                    delay: interval,
                    catchError: true
                });
            }
        }
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('Status', ['StatusMaster', 'StatusScheduler', 'StatusResources', function (StatusMaster, StatusScheduler, StatusResources) {
        var Status = function ($resolved, master, scheduler, queue_depth, resources) {
            this.$resolved = $resolved;
            this.master = StatusMaster.transformer(master);
            this.scheduler = StatusScheduler.transformer(scheduler);
            this.queue_depth = queue_depth;
            this.resources = StatusResources.transformer(resources);
        };

        // public methods
        Status.prototype = {
            getCpuUsage: function () {
                if (this.resources.scheduled.cpus && this.resources.total.cpus) {
                    if (this.resources.total.cpus > 0) {
                        return ((this.resources.scheduled.cpus / this.resources.total.cpus) * 100).toFixed(2);
                    }
                }
                return 0.00;
            },
            getMemUsage: function () {
                if (this.resources.scheduled.mem && this.resources.total.mem) {
                    if (this.resources.total.mem > 0) {
                        return ((this.resources.scheduled.mem / this.resources.total.mem) * 100).toFixed(2);
                    }
                }
                return 0.00;
            },
            getDiskUsage: function () {
                if (this.resources.scheduled.disk && this.resources.total.disk) {
                    if (this.resources.total.disk > 0) {
                        return ((this.resources.scheduled.disk / this.resources.total.disk) * 100).toFixed(2);
                    }
                }
                return 0.00;
            }
        };

        // static methods, assigned to class
        Status.build = function (data) {
            if (data) {
                return new Status(
                    data.$resolved,
                    data.master,
                    data.scheduler,
                    data.queue_depth,
                    data.resources
                );
            }
            return new Status();
        };

        Status.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Status.build)
                    .filter(Boolean);
            }
            return Status.build(data);
        };

        return Status;
    }]);
})();
(function () {
    'use strict';
    
    angular.module('scaleApp').factory('StatusMaster', function () {
        var StatusMaster = function (is_online, hostname, port) {
            this.is_online = is_online;
            this.hostname = hostname;
            this.port = port;
        };

        // public methods
        StatusMaster.prototype = {

        };

        // static methods, assigned to class
        StatusMaster.build = function (data) {
            if (data) {
                return new StatusMaster(
                    data.is_online,
                    data.hostname,
                    data.port
                );
            }
            return new StatusMaster();
        };

        StatusMaster.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusMaster.build)
                    .filter(Boolean);
            }
            return StatusMaster.build(data);
        };

        return StatusMaster;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('StatusResource', function () {
        var StatusResource = function (cpus, mem, disk) {
            this.cpus = cpus;
            this.mem = mem;
            this.disk = disk;
        };

        // public methods
        StatusResource.prototype = {

        };

        // static methods, assigned to class
        StatusResource.build = function (data) {
            if (data) {
                return new StatusResource(
                    data.cpus,
                    data.mem,
                    data.disk
                );
            }
            return new StatusResource();
        };

        StatusResource.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusResource.build)
                    .filter(Boolean);
            }
            return StatusResource.build(data);
        };

        return StatusResource;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('StatusResources', ['StatusResource', function (StatusResource) {
        var StatusResources = function (total, scheduled, used) {
            this.total = StatusResource.transformer(total);
            this.scheduled = StatusResource.transformer(scheduled);
            this.used = StatusResource.transformer(used);
        };

        // public methods
        StatusResources.prototype = {

        };

        // static methods, assigned to class
        StatusResources.build = function (data) {
            if (data) {
                return new StatusResources(
                    data.total,
                    data.scheduled,
                    data.used
                );
            }
            return new StatusResources();
        };

        StatusResources.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusResources.build)
                    .filter(Boolean);
            }
            return StatusResources.build(data);
        };

        return StatusResources;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('StatusScheduler', function () {
        var StatusScheduler = function (is_online, is_paused, hostname) {
            this.is_online = is_online;
            this.is_paused = is_paused;
            this.hostname = hostname;
        };

        // public methods
        StatusScheduler.prototype = {

        };

        // static methods, assigned to class
        StatusScheduler.build = function (data) {
            if (data) {
                return new StatusScheduler(
                    data.is_online,
                    data.is_paused,
                    data.hostname
                );
            }
            return new StatusScheduler();
        };

        StatusScheduler.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusScheduler.build)
                    .filter(Boolean);
            }
            return StatusScheduler.build(data);
        };

        return StatusScheduler;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').service('scaleService', ['$q', '$http', 'scaleConfig', function ($q, $http, scaleConfig) {
        function padWithZero (input, length) {
            // Cast input to string
            input = '' + input;

            var paddingSize = Math.max(0, length - input.length);
            return new Array(paddingSize > 0 ? paddingSize + 1 : 0).join('0') + input;
        }

        return {
            calculateFileSizeFromMib: function(num){
                if (num > 0) {
                    if (num < 1024) {
                        return num.toFixed(2) + ' MB';
                    }
                    if (num >= 1024 && num < 1024*1024) {
                        return (num/1024).toFixed(2) + ' GB';
                    }
                    return (num/1024/1024).toFixed(2) + ' TB';
                }
                return num;
            },
            calculateFileSizeFromBytes: function(num,decimals){
                if (num > 0) {
                    if (num < 1024) {
                        return num.toFixed(decimals) + ' Bytes';
                    }
                    if (num >= 1024 && num < 1024*1024) {
                        return (num/1024).toFixed(decimals) + ' KB';
                    }
                    if (num >= 1024*1024 && num < 1024*1024*1024) {
                        return (num/1024/1024).toFixed(decimals) + ' MB';
                    }
                    if (num >= 1024*1024*1024 && num < 1024*1024*1024*1024) {
                        return (num/1024/1024/1024).toFixed(decimals) + ' GB';
                    }
                    return (num/1024/1024/1024/1024).toFixed(decimals) + ' TB';
                }
                return num;
            },
            getViewportSize: function () {
                var w = window,
                    d = document,
                    e = d.documentElement,
                    g = document.body,
                    x = w.innerWidth || e.clientWidth || g.clientWidth,
                    y = w.innerHeight || e.clientHeight || g.clientHeight;

                return {
                    width: x,
                    height: y
                };
            },
            calculateDuration: function (start, stop) {
                var to = moment.utc(stop),
                    from = moment.utc(start),
                    diff = moment.utc(to).diff(moment.utc(from)),
                    durationStr = '';

                var duration = moment.duration(diff);

                durationStr = duration.days() > 0 ? durationStr + padWithZero(duration.days(), 2) + 'd, ' : durationStr;
                durationStr = duration.hours() > 0 ? durationStr + padWithZero(duration.hours(), 2) + 'h, ' : durationStr;
                durationStr = duration.minutes() > 0 ? durationStr + padWithZero(duration.minutes(), 2) + 'm, ' : durationStr;
                durationStr = durationStr + padWithZero(duration.seconds(), 2) + 's';
                
                return durationStr;
            },
            getDayString: function(dayNumber){
                var dayArr = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
                return dayArr[dayNumber];
            },
            isIE: function () {
                var ua = window.navigator.userAgent,
                    oldIE = ua.indexOf('MSIE'),
                    newIE = ua.indexOf('Trident/');

                if ((oldIE > -1) || (newIE > -1)) {
                    return true;
                }
                return false;
            },
            getVersion: function () {
                var d = $q.defer();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'v' + scaleConfig.majorVersion + '/version/',
                    method: 'GET'
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            setGridHeight: function (offset) {
                // set container heights equal to available page height
                offset = offset || scaleConfig.headerOffset;
                
                var viewport = this.getViewportSize(),
                    gridMaxHeight = viewport.height - offset;

                return 'height: ' + gridMaxHeight + 'px; max-height: ' + gridMaxHeight + 'px; overflow-y: auto;';
            }
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('schedulerService', ['$http', '$q', 'scaleConfig', function ($http, $q, scaleConfig) {
        var getUpdateSchedulerData = function (is_paused) {
            return {
                is_paused: is_paused
            };
        };

        return {
            updateScheduler: function (data) {
                data = data || getUpdateSchedulerData();
                var d = $q.defer();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'scheduler/',
                    method: 'PATCH',
                    data: data
                }).success(function (result) {
                    d.resolve(result);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('stateService', ['$location', function ($location) {
        var version = '',
            jobsColDefs = [],
            jobsParams = {},
            jobExecutionsParams = {},
            recipesColDefs = [],
            jobTypesFailureRatesParams = {},
            recipesParams = {},
            ingestsColDefs = [],
            ingestsParams = {},
            nodesColDefs = [],
            nodeStatusParams = {},
            showActiveWorkspaces = true,
            nodesParams = {};

        var updateQuerystring = function (data) {
            // set defaults
            data.page = data.page || 1;
            data.page_size = data.page_size || 25;
            data.started = data.started || moment.utc().subtract(1, 'weeks').startOf('d').toISOString();
            data.ended = data.ended || moment.utc().endOf('d').toISOString();
            data.order = data.order ? Array.isArray(data.order) ? data.order : [data.order] : null;
            data.status = data.status || null;
            // check for params in querystring, and update as necessary
            _.forEach(_.pairs(data), function (param) {
                $location.search(param[0], param[1]);
            });
        };

        var initJobsParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(1, 'weeks').startOf('d').toISOString(),
                ended: data.ended ? data.ended : moment.utc().endOf('d').toISOString(),
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['-last_modified'],
                status: data.status ? data.status : null,
                error_category: data.error_category ? data.error_category : null,
                job_type_id: data.job_type_id ? parseInt(data.job_type_id) : null,
                job_type_name: data.job_type_name ? data.job_type_name : null,
                job_type_category: data.job_type_category ? data.job_type_category : null,
                url: null
            };
        };

        var initJobExecutionsParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(1, 'weeks').startOf('d').toISOString(),
                ended: data.ended ? data.ended : moment.utc().endOf('d').toISOString(),
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['-last_modified'],
                status: data.status ? data.status : null,
                job_type_id: data.job_type_id ? parseInt(data.job_type_id) : null,
                job_type_name: data.job_type_name ? data.job_type_name : null,
                job_type_category: data.job_type_category ? data.job_type_category : null,
                node_id: data.node_id ? data.node_id : null
            };
        };

        var initJobTypesFailureRatesParams = function (data) {
            return {
                page: null,
                page_size: null,
                started: null,
                ended: null,
                name: data.name ? data.name : null,
                category: null,
                order: null
            };
        };

        var initRecipesParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(1, 'weeks').startOf('d').toISOString(),
                ended: data.ended ? data.ended : moment.utc().endOf('d').toISOString(),
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['-last_modified'],
                type_id: data.type_id ? parseInt(data.type_id) : null,
                type_name: data.type_name ? data.type_name : null,
                url: null
            };
        };

        var initIngestsParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(1, 'weeks').startOf('d').toISOString(),
                ended: data.ended ? data.ended : moment.utc().endOf('d').toISOString(),
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['-ingest_started'],
                status: data.status ? data.status : null
            };
        };

        var initNodesParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(1, 'weeks').startOf('d').toISOString(),
                ended: data.ended ? data.ended : moment.utc().endOf('d').toISOString(),
                order: data.order ? Array.isArray(data.order) ? data.order : [data.order] : ['hostname'],
                include_inactive: data.include_inactive ? data.include_inactive : null
            };
        };

        var initNodeStatusParams = function (data) {
            return {
                page: data.page ? parseInt(data.page) : 1,
                page_size: data.page_size ? parseInt(data.page_size) : 25,
                started: data.started ? data.started : moment.utc().subtract(3, 'hours').toISOString(),
                ended: data.ended ? data.ended : moment.utc().toISOString()
            };
        };

        return {
            getVersion: function () {
                return version;
            },
            setVersion: function (data) {
                version = data;
            },
            getJobsColDefs: function () {
                return jobsColDefs;
            },
            setJobsColDefs: function (data) {
                jobsColDefs = data;
            },
            getJobsParams: function () {
                if (_.keys(jobsParams).length === 0) {
                    return initJobsParams($location.search());
                }
                return jobsParams;
            },
            setJobsParams: function (data) {
                jobsParams = initJobsParams(data);
                updateQuerystring(jobsParams);
            },
            getJobExecutionsParams: function () {
                if (_.keys(jobExecutionsParams).length === 0) {
                    return initJobExecutionsParams($location.search());
                }
                return jobExecutionsParams;
            },
            setJobExecutionsParams: function (data) {
                jobExecutionsParams = initJobExecutionsParams(data);
                updateQuerystring(jobExecutionsParams);
            },
            getJobTypesFailureRatesParams: function () {
                if (_.keys(jobTypesFailureRatesParams).length === 0) {
                    return initJobTypesFailureRatesParams($location.search());
                }
                return jobTypesFailureRatesParams;
            },
            setJobTypesFailureRatesParams: function (data) {
                jobTypesFailureRatesParams = initJobTypesFailureRatesParams(data);
                _.forEach(_.pairs(jobTypesFailureRatesParams), function (param) {
                    $location.search(param[0], param[1]);
                });
            },
            getRecipesColDefs: function () {
                return recipesColDefs;
            },
            setRecipesColDefs: function (data) {
                recipesColDefs = data;
            },
            getRecipesParams: function () {
                if (_.keys(recipesParams).length === 0) {
                    return initRecipesParams($location.search());
                }
                return recipesParams;
            },
            setRecipesParams: function (data) {
                recipesParams = initRecipesParams(data);
                updateQuerystring(recipesParams);
            },
            getIngestsColDefs: function () {
                return ingestsColDefs;
            },
            setIngestsColDefs: function (data) {
                ingestsColDefs = data;
            },
            getIngestsParams: function () {
                if (_.keys(ingestsParams).length === 0) {
                    return initIngestsParams($location.search());
                }
                return ingestsParams;
            },
            setIngestsParams: function (data) {
                ingestsParams = initIngestsParams(data);
                updateQuerystring(ingestsParams);
            },
            getNodesColDefs: function () {
                return nodesColDefs;
            },
            setNodesColDefs: function (data) {
                nodesColDefs = data;
            },
            getNodeStatusParams: function () {
                if (_.keys(nodeStatusParams).length === 0) {
                    return initNodeStatusParams($location.search());
                }
                return nodeStatusParams;
            },
            setNodeStatusParams: function (data) {
                nodeStatusParams = initNodeStatusParams(data);
                updateQuerystring(nodeStatusParams);
            },
            getShowActiveWorkspaces: function () {
                return showActiveWorkspaces;
            },
            setShowActiveWorkspaces: function (data) {
                showActiveWorkspaces = data;
            },
            getNodesParams: function () {
                if (_.keys(nodesParams).length === 0) {
                    return initNodesParams($location.search());
                }
                return nodesParams;
            },
            setNodesParams: function (data) {
                nodesParams = initNodesParams(data);
                updateQuerystring(nodesParams);
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('statusService', ['$resource', 'scaleConfig', 'poller', 'pollerFactory', 'Status', function ($resource, scaleConfig, poller, pollerFactory, Status) {
        return {
            getStatus: function () {
                var statusResource = $resource(scaleConfig.urls.apiPrefix + 'status/'),
                    statusPoller = pollerFactory.newPoller(statusResource, scaleConfig.pollIntervals.status);

                return statusPoller.promise.then(null, null, function (result) {
                    if (result.$resolved) {
                        result = Status.transformer(result);
                    } else {
                        statusPoller.stop();
                    }
                    return result;
                });
            }
        }
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').service('userService', function () {
        return {
            getUserCreds: function () {
                var creds = localStorage.getItem('userCreds');
                try {
                    return JSON.parse(creds);
                } catch (e) {
                    console.log('Error parsing user credentials');
                    return creds;
                }
            },
            setUserCreds: function (user) {
                if (user !== null) {
                    localStorage.setItem('userCreds', JSON.stringify(user));
                } else {
                    localStorage.removeItem('userCreds');
                }

            },
            login: function (username) {
                var user = {
                    username: username,
                    is_admin: true
                };
                this.setUserCreds(user);
                return user;
            },
            logout: function () {
                this.setUserCreds(null);
            }
        }
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('feedDetailsController', ['$scope', '$location', 'scaleConfig', 'navService', 'subnavService', 'feedService', 'moment', function ($scope, $location, scaleConfig, navService, subnavService, feedService, moment) {
        var vm = this;
        
        vm.loading = true;
        vm.feedData = {};
        vm.subnavLinks = scaleConfig.subnavLinks.feed;
        vm.useIngestTime = 'false';
        vm.filterValue = 1;
        vm.filterDuration = 'w';

        vm.changeFeedSelection = function (){
            setFeedUrl();
            //getFeed();
        };

        vm.changeIngestTimeSelection = function (){
            setFeedUrl();
            getFeed();
        };

        var getFeedParams = function (){
            var params = {};
            var strikeId = vm.selectedFeed ? vm.selectedFeed.strike.id : null;
            var useIngestTime = vm.useIngestTime ? vm.useIngestTime : null;

            params.started = moment.utc().subtract(vm.filterValue, vm.filterDuration).startOf('d').toISOString();
            params.ended = moment.utc(params.started).add(1, vm.filterDuration).endOf('d').toISOString();

            if (strikeId != $location.search().strike_id) {
                params.strike_id = strikeId;
            } else if ($location.search().strike_id) {
                params.strike_id = $location.search().strike_id;
            }

            if (useIngestTime != $location.search().use_ingest_time) {
               params.use_ingest_time = useIngestTime;
            } else if ($location.search().use_ingest_time) {
               console.log('getFeedParams use_ingest_time: ' + $location.search().use_ingest_time);
               params.use_ingest_time = $location.search().use_ingest_time;
            }

            return params;
        };

        var getFeed = function () {
            vm.loading = true;
            if ($location.search().use_ingest_time) {
                vm.useIngestTime = $location.search().use_ingest_time;
            }
            var feedParams = getFeedParams();
            $location.search(feedParams);
            feedService.getFeed(feedParams).then(function (data) {
                vm.allFeeds = _.sortByOrder(data.results, ['strike.name'], ['asc']);
                var strikeId = $location.search().strike_id;
                if(strikeId){
                    // set selectedFeed = new feed
                    var feed = _.find(vm.allFeeds, function (feed){
                        return feed.strike.id == strikeId;
                    });
                    vm.selectedFeed = feed ? feed : null;
                } else {
                    vm.selectedFeed = vm.allFeeds[0];
                    setFeedUrl();
                }
            }).finally(function (){
                vm.loading = false;
            });
        };

        vm.updateFeedRange = function (action) {
            if (action === 'older') {
                vm.filterValue++;
            } else if (action === 'newer') {
                if (vm.filterValue > 1) {
                    vm.filterValue--;
                }
            } else if (action === 'today') {
                vm.filterValue = 1;
            }
            getFeed();
        };

        var setFeedUrl = function (){
            // set param in URL
            var params = getFeedParams();
            $location.search(params);
        };

        var initialize = function () {
            navService.updateLocation('feed');
            subnavService.setCurrentPath('feed');
            getFeed();
        };

        initialize();

        $scope.$watch('vm.filterValue', function (value) {
            var $feedNewer = $('.feed-newer'),
                $feedToday = $('.feed-today');

            if (value > 1) {
                $feedNewer.removeAttr('disabled');
                $feedToday.removeAttr('disabled');
            } else {
                $feedNewer.attr('disabled', 'disabled');
                $feedToday.attr('disabled', 'disabled');
            }
        });
    }]);
})();

(function () {
    'use strict';
    
    angular.module('scaleApp').controller('ingestRecordDetailsController', ['$scope', '$routeParams', 'scaleConfig', 'scaleService', 'navService', 'subnavService', 'feedService', function ($scope, $routeParams, scaleConfig, scaleService, navService, subnavService, feedService) {
        var vm = this;
        
        vm.loading = false;
        vm.subnavLinks = scaleConfig.subnavLinks.feed;
        vm.scaleService = scaleService;
        vm.moment = moment;
        vm.ingestRecord = null;

        var getIngestRecordDetails = function () {
            vm.loading = true;
            feedService.getSourceDetails($routeParams.id).then(function (data) {
                vm.ingestRecord = data;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            navService.updateLocation('feed');
            subnavService.setCurrentPath('feed/ingests');
            getIngestRecordDetails();
        };

        vm.calculateFileSize = function (size) {
            return scaleService.calculateFileSizeFromBytes(size);
        };

        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('ingestRecordsController', ['$scope', '$location', 'scaleConfig', 'scaleService', 'stateService', 'feedService', 'navService', 'subnavService', 'gridFactory', function ($scope, $location, scaleConfig, scaleService, stateService, feedService, navService, subnavService, gridFactory) {
        subnavService.setCurrentPath('feed/ingests');

        var vm = this;

        vm.ingestsParams = stateService.getIngestsParams();

        vm.stateService = stateService;
        vm.loading = true;
        vm.subnavLinks = scaleConfig.subnavLinks.feed;
        vm.ingestStatusValues = scaleConfig.ingestStatus;
        vm.selectedIngestStatus = vm.ingestsParams.status || vm.ingestStatusValues[0];
        vm.lastModifiedStart = moment.utc(vm.ingestsParams.started).toDate();
        vm.lastModifiedStartPopup = {
            opened: false
        };
        vm.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStartPopup.opened = true;
        };
        vm.lastModifiedStop = moment.utc(vm.ingestsParams.ended).toDate();
        vm.lastModifiedStopPopup = {
            opened: false
        };
        vm.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStopPopup.opened = true;
        };
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.ingestData = [];
        vm.searchText = '';
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.paginationCurrentPage = vm.ingestsParams.page || 1;
        vm.gridOptions.paginationPageSize = vm.ingestsParams.page_size || vm.gridOptions.paginationPageSize;
        vm.gridOptions.data = [];

        vm.refreshData = function () {
            var filteredData = _.filter(vm.ingestData, function (d) {
                return d.file_name.toLowerCase().includes(vm.searchText.toLowerCase());
            });
            vm.gridOptions.data = filteredData.length > 0 ? filteredData : vm.gridOptions.data;
        };

        var filteredByStatus = vm.ingestsParams.status ? true : false,
            filteredByOrder = vm.ingestsParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'file_name',
                displayName: 'File Name',
                //filterHeaderTemplate: '<div class="ui-grid-filter-container"><input ng-model="grid.appScope.vm.searchText" ng-change="grid.appScope.vm.refreshData()" class="form-control" placeholder="Search"></div>'
                enableFiltering: false
            },
            {
                field: 'file_size',
                displayName: 'File Size',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.file_size_formatted }}</div>'
            },
            {
                field: 'strike.id',
                displayName: 'Strike Process',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.strike.id }}</div>'
            },
            {
                field: 'status',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedIngestStatus" ng-options="status.toUpperCase() for status in grid.appScope.vm.ingestStatusValues"></select></div>'
            },
            {
                field: 'transfer_started',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.transfer_started_formatted }}</div>'
            },
            {
                field: 'transfer_ended',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.transfer_ended_formatted }}</div>'
            },
            {
                field: 'ingest_started',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.ingest_started_formatted }}</div>'
            },
            {
                field: 'ingest_ended',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.ingest_ended_formatted }}</div>'
            }
        ];

        vm.getIngests = function () {
            vm.loading = true;
            feedService.getIngestsOnce(vm.ingestsParams).then(function (data) {
                vm.ingestData = data.results;
                vm.gridOptions.minRowsToShow = data.results.length;
                vm.gridOptions.virtualizationThreshold = data.results.length;
                vm.gridOptions.totalItems = data.count;
                vm.gridOptions.data = data.results;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.filterResults = function () {
            stateService.setIngestsParams(vm.ingestsParams);
            vm.loading = true;
            vm.getIngests();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.ingestsParams);
        };

        vm.updateIngestOrder = function (sortArr) {
            vm.ingestsParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.updateIngestStatus = function (value) {
            if (value != vm.ingestsParams.status) {
                vm.ingestsParams.page = 1;
            }
            vm.ingestsParams.status = value === 'VIEW ALL' ? null : value;
            vm.ingestsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.ingestsParams.page = currentPage;
                vm.ingestsParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                $location.search({});
                $location.path('/feed/ingests/' + row.entity.id);
            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setIngestsColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateIngestOrder(sortArr);
            });
        };

        vm.initialize = function () {
            stateService.setIngestsParams(vm.ingestsParams);
            vm.updateColDefs();
            vm.getIngests();
            navService.updateLocation('feed');
        };

        vm.initialize();

        $scope.$watch('vm.selectedIngestStatus', function (value) {
            if (vm.loading) {
                if (filteredByStatus) {
                    vm.updateIngestStatus(value);
                }
            } else {
                filteredByStatus = value !== 'VIEW ALL';
                vm.updateIngestStatus(value);
            }
        });

        $scope.$watch('vm.lastModifiedStart', function (value) {
            if (!vm.loading) {
                vm.ingestsParams.started = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watch('vm.lastModifiedStop', function (value) {
            if (!vm.loading) {
                vm.ingestsParams.ended = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watchCollection('vm.stateService.getIngestsColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getIngestsParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.ingestsParams = newValue;
            vm.updateColDefs();
        });
    }]);
})();
/**
 * <scale-file-ancestry-tree />
 */
(function () {
    angular.module('scaleApp').controller('scaleFileAncestryTreeController', ['$scope', function ($scope) {
        $scope.source = null;


        var treeData = [
            {
                "name": "Top Level",
                "parent": "null",
                "children": [
                    {
                        "name": "Level 2: A",
                        "parent": "Top Level"
                        //"children": [
                        //    {
                        //        "name": "Son of A",
                        //        "parent": "Level 2: A"
                        //    },
                        //    {
                        //        "name": "Daughter of A",
                        //        "parent": "Level 2: A"
                        //    }
                        //]
                    },
                    {
                        "name": "Level 2: B",
                        "parent": "Top Level"
                    }
                ]
            }
        ];


// ************** Generate the tree diagram	 *****************
        var margin = {top: 20, right: 120, bottom: 20, left: 120};
        var width = 500 - margin.right - margin.left;
        var height = 400 - margin.top - margin.bottom;

        var i = 0,
            duration = 750,
            root;

        var tree = d3.layout.tree()
            .size([height, width]);

        var diagonal = d3.svg.diagonal()
            .projection(function(d) { return [d.y, d.x]; });

        var svg = d3.select("svg");
            //.attr("width", width + margin.right + margin.left)
            //.attr("height", height + margin.top + margin.bottom)
        var inner = svg.append("g");

        inner.attr("transform", "translate(" + margin.left/1.5 + "," + margin.top/2 + ")," +
                "scale(" + 1 + ")");
        inner.attr("class", "tree-group");


        root = treeData[0];
        root.x0 = height / 2;
        root.y0 = 0;

        update(root);

        d3.select(self.frameElement).style("height", "500px");

        function update(source) {

            // Compute the new tree layout.
            var nodes = tree.nodes(root).reverse(),
                links = tree.links(nodes);

            // Normalize for fixed-depth.
            nodes.forEach(function(d) { d.y = d.depth * 180; });

            // Update the nodes
            var node = inner.selectAll("g.node")
                .data(nodes, function(d) { return d.id || (d.id = ++i); });

            // Enter any new nodes at the parent's previous position.
            var nodeEnter = node.enter().append("g")
                .attr("class", "node")
                .attr("transform", function(d) { return "translate(" + source.y0 + "," + source.x0 + ")"; });
                //.on("click", click);

            nodeEnter.append("circle")
                .attr("r", 1e-6)
                .style("fill", function(d) { return d._children ? "lightsteelblue" : "#fff"; });

            nodeEnter.append("text")
                .attr("x", function(d) { return d.children || d._children ? -13 : 13; })
                .attr("dy", ".35em")
                .attr("text-anchor", function(d) { return d.children || d._children ? "end" : "start"; })
                .text(function(d) { return d.name; })
                .style("fill-opacity", 1e-6);

            // Transition nodes to their new position.
            var nodeUpdate = node.transition()
                .duration(duration)
                .attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; });

            nodeUpdate.select("circle")
                .attr("r", 10)
                .style("fill", function(d) { return d._children ? "lightsteelblue" : "#fff"; });

            nodeUpdate.select("text")
                .style("fill-opacity", 1);

            // Transition exiting nodes to the parent's new position.
            var nodeExit = node.exit().transition()
                .duration(duration)
                .attr("transform", function(d) { return "translate(" + source.y + "," + source.x + ")"; })
                .remove();

            nodeExit.select("circle")
                .attr("r", 1e-6);

            nodeExit.select("text")
                .style("fill-opacity", 1e-6);

            // Update the links
            var link = inner.selectAll("path.link")
                .data(links, function(d) { return d.target.id; });

            // Enter any new links at the parent's previous position.
            link.enter().insert("path", "g")
                .attr("class", "link")
                .attr("d", function(d) {
                    var o = {x: source.x0, y: source.y0};
                    return diagonal({source: o, target: o});
                });

            // Transition links to their new position.
            link.transition()
                .duration(duration)
                .attr("d", diagonal);

            // Transition exiting nodes to the parent's new position.
            link.exit().transition()
                .duration(duration)
                .attr("d", function(d) {
                    var o = {x: source.x, y: source.y};
                    return diagonal({source: o, target: o});
                })
                .remove();

            // Stash the old positions for transition.
            nodes.forEach(function(d) {
                d.x0 = d.x;
                d.y0 = d.y;
            });

        }

// Toggle children on click.
        function click(d) {
            if (d.children) {
                d._children = d.children;
                d.children = null;
            } else {
                d.children = d._children;
                d._children = null;
            }
            update(d);
        }
        
    }]).directive('scaleFileAncestryTree', function () {
        'use strict';
        /**
         * Usage: <scale-file-ancestry-tree source="source" />
         */
        return {
            controller: 'scaleFileAncestryTreeController',
            templateUrl: 'modules/feed/directives/fileAncestryTreeTemplate.html',
            restrict: 'E',
            scope: {
                source: '='
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Feed', ['scaleConfig', function (scaleConfig) {
        var Feed = function (value, status) {
            this.value = value;
            this.status = status;
        };

        // public methods
        Feed.prototype = {
            toString: function () {
                return 'Feed';
            },
            getCellText: function () {
                return this.value;
            },
            getCellTitle: function () {
                return '';
            }
        };

        // static methods, assigned to class
        Feed.build = function (data) {
            if (data) {
                return new Feed(
                    data.value,
                    data.status
                );
            }
            return new Feed();
        };

        Feed.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Feed.build)
                    .filter(Boolean);
            }
            return Feed.build(data);
        };

        return Feed;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('FeedStatus', ['scaleConfig', function (scaleConfig) {
        var FeedStatus = function (status) {
            this.status = status;
        };

        // public methods
        FeedStatus.prototype = {
            toString: function () {
                return 'FeedStatus';
            },
            getCellFill: function () {
                return scaleConfig.colors.chart_green;
            },
            getCellActivity: function () {
                return '';
            },
            getCellActivityTotal: function () {
                return '';
            },
            getCellError: function () {
                return '';
            },
            getCellTotal: function () {
                return '';
            }
        };

        // static methods, assigned to class
        FeedStatus.build = function (data) {
            if (data) {
                return new FeedStatus(
                    data.status
                );
            }
            return new FeedStatus();
        };

        FeedStatus.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(FeedStatus.build)
                    .filter(Boolean);
            }
            return FeedStatus.build(data);
        };

        return FeedStatus;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Ingest', ['scaleConfig', 'scaleService', function (scaleConfig, scaleService) {
        var Ingest = function (id, file_name, strike, status, bytes_transferred, transfer_started, transfer_ended, media_type, file_size, data_type, ingest_started, ingest_ended, source_file, created, last_modified) {
            this.id = id;
            this.file_name = file_name;
            this.strike = strike;
            this.status = status;
            this.bytes_transferred = bytes_transferred;
            this.transfer_started = transfer_started;
            this.transfer_started_formatted = moment.utc(transfer_started).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.transfer_ended = transfer_ended;
            this.transfer_ended_formatted = moment.utc(transfer_ended).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.media_type = media_type;
            this.file_size = file_size;
            this.file_size_formatted = scaleService.calculateFileSizeFromBytes(file_size);
            this.data_type = data_type;
            this.ingest_started = ingest_started;
            this.ingest_started_formatted = ingest_started ? moment.utc(ingest_started).format(scaleConfig.dateFormats.day_second_utc_nolabel) : '';
            this.ingest_ended = ingest_ended;
            this.ingest_ended_formatted = ingest_ended ? moment.utc(ingest_ended).format(scaleConfig.dateFormats.day_second_utc_nolabel) : '';
            this.source_file = source_file;
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.last_modified = last_modified;
            this.last_modified_formatted = moment.utc(last_modified).format(scaleConfig.dateFormats.day_second_utc_nolabel);
        };

        // public methods
        Ingest.prototype = {
            
        };

        // static methods, assigned to class
        Ingest.build = function (data) {
            if (data) {
                return new Ingest(
                    data.id,
                    data.file_name,
                    data.strike,
                    data.status,
                    data.bytes_transferred,
                    data.transfer_started,
                    data.transfer_ended,
                    data.media_type,
                    data.file_size,
                    data.data_type,
                    data.ingest_started,
                    data.ingest_ended,
                    data.source_file,
                    data.created,
                    data.last_modified
                );
            }
            return new Ingest();
        };

        Ingest.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Ingest.build);
            }
            return Ingest.build(data);
        };

        return Ingest;
    }]);
})();

(function () {
    'use strict';
    angular.module('scaleApp').service('feedService', ['$location', '$timeout', '$q', '$http', 'scaleConfig', 'Ingest', function ($location, $timeout, $q, $http, scaleConfig, Ingest) {

        var getFeedParams = function (params) {
            if(!params) { params = {}; }
            var p = {};
            p.page_size = 1000;
            p.started = params.started ? params.started : moment.utc().add(-7,'days').startOf('d').toDate();
            p.ended = params.ended ? params.ended : moment.utc().toDate();
            p.use_ingest_time = params.use_ingest_time ? params.use_ingest_time : null;
            return p;
        };

        var getIngestsParams = function (params) {
            return params;
        };

        var getSourceParams = function (page, page_size, started, ended, order, is_parsed, file_name) {
            return {
                page: page,
                page_size: page_size ? page_size : 1000,
                started: started,
                ended: ended,
                order: order ? order : '-last_modified',
                is_parsed: is_parsed,
                file_name: file_name
            };
        };

        return {
            getFeed: function (params) {
                var d = $q.defer();
                var params = getFeedParams(params);
                $http({
                    url: scaleConfig.urls.apiPrefix + 'ingests/status/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getIngestsOnce: function (params) {
                var d = $q.defer();
                var params = getIngestsParams(params);
                $http({
                    url: scaleConfig.urls.apiPrefix + 'ingests/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = Ingest.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getSources: function (params) {
                params = params || getSourceParams();
                var d = $q.defer();
                $http({
                    url: scaleConfig.urls.apiPrefix + 'sources/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getSourceDetails: function (id) {
                var d = $q.defer();
                $http({
                    url: scaleConfig.urls.apiPrefix + 'sources/' + id + '/',
                    method: 'GET'
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('jobDetailController', ['$scope', '$rootScope', '$location', '$routeParams', '$uibModal', 'stateService', 'navService', 'jobService', 'jobExecutionService', 'nodeService', 'loadService', 'scaleConfig', 'subnavService', 'userService', 'scaleService', 'toastr', function ($scope, $rootScope, $location, $routeParams, $uibModal, stateService, navService, jobService, jobExecutionService, nodeService, loadService, scaleConfig, subnavService, userService, scaleService, toastr) {
        var vm = this;
        
        vm.job = {};
        vm.jobId = $routeParams.id;
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs');
        vm.loadingJobDetail = false;
        vm.latestExecution = null;
        vm.executionLog = null;
        vm.executionDetails = null;
        vm.selectedExecutionDetailValues = null;
        vm.timeline = [];
        vm.readonly = true;
        vm.jobErrorCreated = '';
        vm.jobErrorLastModified = '';
        vm.lastStatusChange = '';
        vm.triggerOccurred = '';

        vm.showLog = function (execution) {
            vm.selectedExecutionLog = execution;
            $uibModal.open({
                animation: true,
                templateUrl: 'showLog.html',
                scope: $scope,
                windowClass: 'log-modal-window'
            });
        };

        vm.showExecutionDetails = function (executionId) {
            jobExecutionService.getJobExecutionDetails(executionId).then(function (data) {
                vm.selectedExecutionDetails = data;
                vm.selectedExecutionDetailValues = _.pairs(data);
                $uibModal.open({
                    animation: true,
                    templateUrl: 'showExecutionDetails.html',
                    scope: $scope,
                    size: 'lg'
                });
            }).catch(function (error) {
                console.log(error);
            });
        };

        vm.requeueJob = function (jobId) {
            vm.loading = true;
            loadService.requeueJobs({ job_ids: [jobId] }).then(function (data) {
                toastr['success']('Requeued Job');
                vm.job.status = data.job_status;
                getJobDetail(jobId);
            }).catch(function (error) {
                toastr['error']('Requeue request failed');
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.cancelJob = function (job) {
            vm.loading = true;
            vm.actionClicked = true;
            vm.loading = true;
            var originalStatus = job.status;
            job.status = 'CANCEL';
            jobService.updateJob(job.id, { status: 'CANCELED' }).then(function () {
                toastr['success']('Job Canceled');
                job.status = 'CANCELED';
            }).catch(function (error) {
                toastr['error'](error);
                console.log(error);
                job.status = originalStatus;
            }).finally(function () {
                vm.loading = false;
            });
        };
        
        vm.calculateFileSize = function (size) {
            return scaleService.calculateFileSizeFromBytes(size);
        };

        var getJobDetail = function (jobId) {
            vm.loadingJobDetail = true;
            jobService.getJobDetail(jobId).then(function (data) {
                vm.job = data;
                vm.timeline = calculateTimeline(data);
                vm.latestExecution = data.getLatestExecution();
                vm.jobErrorCreated = data.error ? moment.utc(data.error.created).toISOString() : '';
                vm.lastStatusChange = data.last_status_change ? moment.duration(moment.utc(data.last_status_change).diff(moment.utc())).humanize(true) : '';
                vm.triggerOccurred = data.event.occurred ? moment.duration(moment.utc(data.event.occurred).diff(moment.utc())).humanize(true) : '';
                vm.inputs = data.inputs;
                vm.outputs = data.outputs;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loadingJobDetail = false;
            });
        };

        var calculateTimeline = function (job) {
            var tl = [];
            tl.push({ taskName: 'Created', started: job.created ? moment.utc(job.created).toDate() : job.created, ended: job.queued ? moment.utc(job.queued).toDate() : job.queued });
            tl.push({ taskName: 'Queued', started: job.queued ? moment.utc(job.queued).toDate() : job.queued, ended: job.started ? moment.utc(job.started).toDate() : job.started });
            tl.push({ taskName: 'Executed', started: job.started ? moment.utc(job.started).toDate() : job.started, ended: job.ended ? moment.utc(job.ended).toDate() : job.ended });

            return tl;
        };

        var initialize = function () {
            navService.updateLocation('jobs');
            var user = userService.getUserCreds();
            vm.readonly = !(user && user.is_admin);
            getJobDetail(vm.jobId);
        };

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('jobExecutionDetailController', ['$scope', '$location', '$routeParams', 'navService', 'jobExecutionService', 'nodeService', 'scaleConfig', 'subnavService', function ($scope, $location, $routeParams, navService, jobExecutionService, nodeService, scaleConfig, subnavService) {
        var vm = this;
        
        vm.jobExecution = {};
        vm.jobExecutionId = $routeParams.id;
        vm.loading = true;
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs/runs');

        var getJobExecutionDetail = function () {
            jobExecutionService.getJobExecutionDetail(id).then(function (data) {
                vm.jobExecution = data;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            getJobExecutionDetail($routeParams.id);
            navService.updateLocation('jobs');
        };

        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('jobExecutionsController', ['$scope', '$location', 'navService', 'stateService', 'gridFactory', 'userService', 'jobExecutionService', 'jobTypeService', 'uiGridConstants', 'scaleConfig', 'subnavService', function ($scope, $location, navService, stateService, gridFactory, userService, jobExecutionService, jobTypeService, uiGridConstants, scaleConfig, subnavService) {
        subnavService.setCurrentPath('jobs');

        var vm = this,
            jobTypeViewAll = { name: 'VIEW ALL', title: 'VIEW ALL', version: '', id: 0 };

        vm.jobExecutionsParams = stateService.getJobExecutionsParams();

        vm.stateService = stateService;
        vm.loading = true;
        vm.readonly = true;
        vm.jobTypeValues = [jobTypeViewAll];
        vm.jobExecution = null;
        vm.selectedJobType = vm.jobExecutionsParams.job_type_id ? vm.jobExecutionsParams.job_type_id : jobTypeViewAll;
        vm.jobStatusValues = scaleConfig.jobStatus;
        vm.selectedJobStatus = vm.jobExecutionsParams.status || vm.jobStatusValues[0];
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        vm.actionClicked = false;
        vm.lastModifiedStart = moment.utc(vm.jobExecutionsParams.started).toDate();
        vm.lastModifiedStartPopup = {
            opened: false
        };
        vm.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStartPopup.opened = true;
        };
        vm.lastModifiedStop = moment.utc(vm.jobExecutionsParams.ended).toDate();
        vm.lastModifiedStopPopup = {
            opened: false
        };
        vm.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStopPopup.opened = true;
        };
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.paginationCurrentPage = vm.jobExecutionsParams.page || 1;
        vm.gridOptions.paginationPageSize = vm.jobExecutionsParams.page_size || vm.gridOptions.paginationPageSize;
        vm.gridOptions.data = [];

        var filteredByJobType = vm.jobExecutionsParams.job_type_id ? true : false,
            filteredByJobStatus = vm.jobExecutionsParams.status ? true : false,
            filteredByOrder = vm.jobExecutionsParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'job_type',
                displayName: 'Job Type',
                cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }} {{ row.entity.job_type.version }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobType" ng-options="jobType as (jobType.title + \' \' + jobType.version) for jobType in grid.appScope.vm.jobTypeValues"></select></div>'
            },
            {
                field: 'created',
                displayName: 'Created (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'
            },
            {
                field: 'last_modified',
                displayName: 'Last Modified (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'
            },
            {
                field: 'duration',
                enableFiltering: false,
                enableSorting: false,
                width: 120,
                cellTemplate: '<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'
            },
            {
                field: 'status',
                width: 150,
                cellTemplate: '<div class="ui-grid-cell-contents"><div class="pull-right"><button ng-show="((!grid.appScope.vm.readonly) && (row.entity.status === \'FAILED\' || row.entity.status === \'CANCELED\'))" ng-click="grid.appScope.vm.requeueJobs({ job_ids: [row.entity.id] })" class="btn btn-xs btn-default" title="Requeue Job"><i class="fa fa-repeat"></i></button> <button ng-show="!grid.appScope.vm.readonly && row.entity.status !== \'COMPLETED\' && row.entity.status !== \'CANCELED\'" ng-click="grid.appScope.vm.cancelJob(row.entity)" class="btn btn-xs btn-default" title="Cancel Job"><i class="fa fa-ban"></i></button></div> {{ row.entity.status }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobStatus"><option ng-selected="{{ grid.appScope.vm.jobStatusValues[$index] == grid.appScope.vm.selectedJobStatus }}" value="{{ grid.appScope.vm.jobStatusValues[$index] }}" ng-repeat="status in grid.appScope.vm.jobStatusValues track by $index">{{ status.toUpperCase() }}</option></select></div>'
            },
            {
                field: 'id',
                displayName: 'Log',
                enableFiltering: false,
                sortable: false,
                width: 60,
                cellTemplate: '<div class="ui-grid-cell-contents text-center"><button ng-click="grid.appScope.vm.showLog(row.entity)" class="btn btn-xs btn-default"><i class="fa fa-file-text"></i></button></div>'
            }
        ];

        vm.getJobExecutions = function () {
            jobExecutionService.getJobExecutions(vm.jobExecutionsParams).then(function (data) {
                vm.gridOptions.totalItems = data.count;
                vm.gridOptions.minRowsToShow = data.results.length;
                vm.gridOptions.virtualizationThreshold = data.results.length;
                vm.gridOptions.data = data.results;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.getJobTypes = function () {
            jobTypeService.getJobTypesOnce().then(function (data) {
                vm.jobTypeValues.push(data.results);
                vm.jobTypeValues = _.flatten(vm.jobTypeValues);
                vm.selectedJobType = _.find(vm.jobTypeValues, { id: vm.jobExecutionsParams.job_type_id }) || jobTypeViewAll;
                vm.getJobExecutions();
            }).catch(function () {
                vm.loading = false;
            });
        };

        vm.showLog = function (jobExecution) {
            // show log modal
            vm.actionClicked = true;
            vm.jobExecution = jobExecution;
            $uibModal.open({
                animation: true,
                templateUrl: 'showLog.html',
                scope: $scope,
                size: 'lg',
                windowClass: 'log-modal-window'
            });
        };

        vm.filterResults = function () {
            stateService.setJobsParams(vm.jobExecutionsParams);
            vm.loading = true;
            vm.getJobs();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.jobExecutionsParams);
        };

        vm.updateJobOrder = function (sortArr) {
            vm.jobExecutionsParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.updateJobType = function (value) {
            if (value.id !== vm.jobExecutionsParams.job_type_id) {
                vm.jobExecutionsParams.page = 1;
            }
            vm.jobExecutionsParams.job_type_id = value.id === 0 ? null : value.id;
            vm.jobExecutionsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.updateJobStatus = function (value) {
            if (value != vm.jobExecutionsParams.status) {
                vm.jobExecutionsParams.page = 1;
            }
            vm.jobExecutionsParams.status = value === 'VIEW ALL' ? null : value;
            vm.jobExecutionsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                if (vm.actionClicked) {
                    vm.actionClicked = false;
                } else {
                    $location.path('/jobs/job/' + row.entity.id);
                }
            });
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.jobExecutionsParams.page = currentPage;
                vm.jobExecutionsParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setJobsColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateJobOrder(sortArr);
            });
        };

        vm.initialize = function () {
            stateService.setJobExecutionsParams(vm.jobExecutionsParams);
            vm.updateColDefs();
            var user = userService.getUserCreds();
            vm.readonly = !(user && user.is_admin);
            vm.getJobTypes();
            navService.updateLocation('jobs/executions');
        };

        vm.initialize();

        $scope.$watch('vm.selectedJobType', function (value) {
            if (parseInt(value)) {
                value = _.find(vm.jobTypeValues, {id: parseInt(value)});
            }
            if (value) {
                if (vm.loading) {
                    if (filteredByJobType) {
                        vm.updateJobType(value);
                    }
                } else {
                    filteredByJobType = !angular.equals(value, jobTypeViewAll);
                    vm.updateJobType(value);
                }
            }
        });

        $scope.$watch('vm.selectedJobStatus', function (value) {
            if (vm.loading) {
                if (filteredByJobStatus) {
                    vm.updateJobStatus(value);
                }
            } else {
                filteredByJobStatus = value !== 'VIEW ALL';
                vm.updateJobStatus(value);
            }
        });

        $scope.$watch('vm.lastModifiedStart', function (value) {
            if (!vm.loading) {
                vm.jobExecutionsParams.started = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watch('vm.lastModifiedStop', function (value) {
            if (!vm.loading) {
                vm.jobExecutionsParams.ended = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watchCollection('vm.stateService.getJobsColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getJobsParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.jobExecutionsParams = newValue;
            vm.updateColDefs();
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('jobTypesController', ['$rootScope', '$scope', '$routeParams', '$location', 'hotkeys', 'scaleService', 'navService', 'jobTypeService', 'scaleConfig', 'subnavService', 'nodeService', 'localStorage', 'userService', function ($rootScope, $scope, $routeParams, $location, hotkeys, scaleService, navService, jobTypeService, scaleConfig, subnavService, nodeService, localStorage, userService) {
        var vm = this;
        
        vm.containerStyle = '';
        vm.requestedJobTypeId = parseInt($routeParams.id);
        vm.jobTypes = [];
        vm.jobTypeIds = [];
        vm.jobTypeCount = 0;
        vm.activeJobTypeDetails = {};
        vm.activeJobTypeInterfaceValues = [];
        vm.activeJobTypeErrors = [];
        vm.activeJobTypeStats = {};
        vm.showJobTypeErrors = false;
        vm.loading = true;
        vm.activeJobType = null;
        vm.healthData6 = {};
        vm.healthData12 = {};
        vm.healthData24 = {};
        vm.activityIcon = '<i class="fa fa-pulse">&#x' + scaleConfig.activityIconCode + '</i>';
        vm.jobDetailsClass = 'hidden';
        vm.pauseBtnClass = 'fa-pause';
        vm.user = userService.getUserCreds();
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs/types');

        vm.viewDetails = function (id) {
            vm.activeJobType = _.find(vm.jobTypes, 'id', id);
            vm.activeJobType.created = formatDateTime(vm.activeJobType.created);
            vm.activeJobType.lastModified = formatDateTime(vm.activeJobType.lastModified);

            $location.path('jobs/types/' + id);

            getJobTypeDetails(vm.activeJobType.id);

            vm.jobDetailsClass = 'visible';
        };

        vm.togglePause = function () {
            vm.activeJobType.is_paused = !vm.activeJobType.is_paused;
            vm.activeJobTypeDetails.is_paused = vm.activeJobType.is_paused;
            vm.loading = true;
            jobTypeService.updateJobType(vm.activeJobTypeDetails).then(function(data){
                vm.activeJobTypeDetails = data;
                vm.pauseBtnClass = vm.getPauseButtonClass(vm.activeJobTypeDetails.is_paused);
                vm.loading = false;
            }).catch(function (error) {
                console.log(error);
                toastr['error'](error);
                vm.loading = false;
            });
        };

        vm.getPauseButtonClass = function(is_paused){
            return is_paused ? 'fa-play' : 'fa-pause';
        };

        vm.getJobTypeListItemClass = function(jobType){
            return jobType.is_paused ? 'paused' : '';
        };

        var formatDateTime = function (dt) {
            return moment.utc(dt).toISOString();
        };

        var getJobTypes = function () {
            jobTypeService.getJobTypesOnce().then(function (data) {
                vm.jobTypes = data.results;
                vm.jobTypeIds = _.pluck(vm.jobTypes, 'id');
                vm.jobTypeCount = data.count;
                if (vm.requestedJobTypeId) {
                    vm.viewDetails(vm.requestedJobTypeId);
                } else {
                    vm.loading = false;
                }
                hotkeys.bindTo($scope)
                    .add({
                        combo: 'ctrl+up',
                        description: 'Previous Job Type',
                        callback: function () {
                            if (vm.activeJobType) {
                                var idx = _.indexOf(vm.jobTypeIds, vm.activeJobType.id);
                                if (idx > 0) {
                                    vm.viewDetails(vm.jobTypeIds[idx - 1]);
                                }
                            }
                        }
                    }).add({
                        combo: 'ctrl+down',
                        description: 'Next Job Type',
                        callback: function () {
                            if (vm.activeJobType) {
                                var idx = _.indexOf(vm.jobTypeIds, vm.activeJobType.id);
                                if (idx < (vm.jobTypeIds.length - 1)) {
                                    vm.viewDetails(vm.jobTypeIds[idx + 1]);
                                }
                            }
                        }
                    });
            }).catch(function (error) {
                console.log(error);
                vm.loading = false;
            });
        };

        var getJobTypeDetails = function (id) {
            vm.loading = true;
            jobTypeService.getJobTypeDetails(id).then(function (data) {
                vm.activeJobTypeDetails = data;
                vm.activeJobTypeInterfaceValues = _.pairs(data.job_type_interface);
                vm.pauseBtnClass = vm.getPauseButtonClass(vm.activeJobTypeDetails.is_paused);
                // format error mapping
                vm.activeJobTypeErrors = [];
                vm.showJobTypeErrors = _.keys(data.error_mapping.exit_codes).length > 0;
                if (vm.showJobTypeErrors) {
                    _.forEach(data.error_mapping.exit_codes, function (error_name) {
                        var error = _.find(data.errors, 'name', error_name),
                            exitCode = _.invert(data.error_mapping.exit_codes)[error_name];
                        vm.activeJobTypeErrors.push({code: exitCode, data: error});
                    });
                }

                // format job type stats
                var performance = data.getPerformance(),
                    failures = data.getFailures();

                vm.activeJobTypeStats = performance;

                vm.healthData6 = {
                    gaugeData: performance.hour6.rate,
                    donutData: failures.hour6
                };
                vm.healthData12 = {
                    gaugeData: performance.hour12.rate,
                    donutData: failures.hour12
                };
                vm.healthData24 = {
                    gaugeData: performance.hour24.rate,
                    donutData: failures.hour24
                };
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            getJobTypes();
            navService.updateLocation('jobs');
        };

        initialize();

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                containerMaxHeight = viewport.height - offset;

            vm.containerStyle = 'height: ' + containerMaxHeight + 'px; max-height: ' + containerMaxHeight + 'px;';
        });
    }]);
})();

(function () {
    'use strict';
    
    angular.module('scaleApp').controller('jobTypesFailureRatesController', ['$scope', '$location', 'scaleConfig', 'stateService', 'scaleService', 'subnavService', 'jobTypeService', 'metricsService', 'gridFactory', 'JobType', 'toastr', 'moment', function ($scope, $location, scaleConfig, stateService, scaleService, subnavService, jobTypeService, metricsService, gridFactory, JobType, toastr, moment) {
        var vm = this,
            jobTypeViewAll = { name: 'VIEW ALL', title: 'VIEW ALL', version: '', id: 0 };

        vm.jobTypesParams = stateService.getJobTypesFailureRatesParams();

        var jobTypes = [],
            started = moment.utc().subtract(30, 'days').startOf('d').toISOString(),
            ended = moment.utc().endOf('d').toISOString(),
            filteredByJobType = vm.jobTypesParams.name ? true : false;

        vm.stateService = stateService;
        vm.scaleService = scaleService;
        vm.loading = true;
        vm.dates = [];
        vm.performanceData = [];
        vm.jobTypeValues = [jobTypeViewAll];
        vm.selectedJobType = vm.jobTypesParams.name ? vm.jobTypesParams.name : jobTypeViewAll;
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs/failure-rates');

        var defaultColumnDefs = [
            {
                field: 'job_type',
                displayName: 'Job Type',
                cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }} {{ row.entity.job_type.version }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobType" ng-options="jobType as (jobType.title + \' \' + jobType.version) for jobType in grid.appScope.vm.jobTypeValues"></select></div>',
                enableSorting: false
            },
            {
                field: 'twentyfour_hours',
                displayName: '24 Hours',
                enableSorting: false,
                enableFiltering: false,
                headerCellTemplate: 'gridHeader.html',
                cellTemplate: 'gridRow.html'
            },
            {
                field: 'fortyeight_hours',
                displayName: '48 Hours',
                enableSorting: false,
                enableFiltering: false,
                headerCellTemplate: 'gridHeader.html',
                cellTemplate: 'gridRow.html'
            },
            {
                field: 'thirty_days',
                displayName: '30 Days',
                enableSorting: false,
                enableFiltering: false,
                headerCellTemplate: 'gridHeader.html',
                cellTemplate: 'gridRow.html'
            }
        ];

        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.columnDefs = defaultColumnDefs;
        vm.gridOptions.data = [];
        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            $scope.gridApi = gridApi;
            $scope.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                if ($scope.actionClicked) {
                    $scope.actionClicked = false;
                } else {
                    $scope.$apply(function () {
                        $location.path('/jobs/types/' + row.entity.job_type.id);
                    });
                }
            });
        };
        
        vm.setStyle = function (colField, errorType) {
            var errorValue = (colField[errorType] / colField.total).toFixed(2);
            var textColor = errorValue >= 0.5 ? '#fff' : '#000';
            var rgb = errorType === 'system' ? '103, 0, 13' : errorType === 'algorithm' ? '203, 24, 29' : '241, 105, 19';
            return 'background: rgba(' + rgb + ', ' + errorValue + '); color: ' + textColor;
        };

        vm.failRateStyle = function (error, total) {
            var percentage = ((error / total) * 100).toFixed(0);
            return percentage > 0 ? 'width: ' + percentage + '%' : 'display: none';
        };
        
        vm.getPercentageOfTotal = function (errorTotal, total) {
            if (total === 0) {
                return '0%';
            }
            return ((errorTotal / total) * 100).toFixed(0) + '%';
        };

        vm.filterResults = function () {
            vm.gridOptions.data = [];
            stateService.setJobTypesFailureRatesParams(vm.jobTypesParams);
            _.forEach(_.pairs(vm.jobTypesParams), function (param) {
                $location.search(param[0], param[1]);
            });
            vm.loading = true;
            initialize();
        };

        vm.updateJobType = function (value) {
            vm.jobTypesParams.name = value.name === 'VIEW ALL' ? null : value.name;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        var formatData = function (data, numDays) {
            var dataArr = [];
            _.forEach(data, function (result) {
                var filteredResult = _.filter(result, function (d) {
                    var date = moment.utc(d.date, 'YYYY-MM-DD');
                    if (moment.utc().diff(moment.utc(date), 'd') <= numDays) {
                        return d;
                    }
                });
                dataArr.push(filteredResult);
            });
            return dataArr;
        };

        var formatColumn = function (cData, id) {
            var systemErrors = cData[0],
                algorithmErrors = cData[1],
                dataErrors = cData[2],
                totalCount = cData[3];

            var obj = {
                system: _.sum(_.map(_.filter(systemErrors, { id: id }), 'value')),
                algorithm: _.sum(_.map(_.filter(algorithmErrors, { id: id }), 'value')),
                data: _.sum(_.map(_.filter(dataErrors, { id: id }), 'value')),
                total: _.sum(_.map(_.filter(totalCount, { id: id }), 'value'))
            };
            obj.errorTotal = obj.system + obj.algorithm + obj.data;

            return obj;
        };

        var initialize = function () {
            stateService.setJobTypesFailureRatesParams(vm.jobTypesParams);
            jobTypeService.getJobTypesOnce().then(function (jobTypesData) {
                jobTypes = _.cloneDeep(jobTypesData.results);
                vm.jobTypeValues.push(jobTypesData.results);
                vm.jobTypeValues = _.flatten(vm.jobTypeValues);
                vm.selectedJobType = _.find(vm.jobTypeValues, { name: vm.jobTypesParams.name }) || jobTypeViewAll;
                vm.gridOptions.totalItems = jobTypesData.count;

                var metricsParams = {
                    page: null,
                    page_size: null,
                    started: started,
                    ended: ended,
                    choice_id: vm.selectedJobType.id > 0 ? [vm.selectedJobType.id] : _.map(jobTypes, 'id'),
                    column: ['error_system_count', 'error_algorithm_count', 'error_data_count', 'total_count'],
                    group: null,
                    dataType: 'job-types'
                };

                metricsService.getPlotData(metricsParams).then(function (data) {
                    if (data.results.length > 0) {
                        var data30Days = _.map(data.results, 'values'),
                            data48Hours = formatData(data30Days, 2),
                            data24Hours = formatData(data48Hours, 1);

                        _.forEach(jobTypes, function (jobType) {
                            vm.performanceData.push({
                                job_type: JobType.transformer(jobType),
                                twentyfour_hours: formatColumn(data24Hours, jobType.id),
                                fortyeight_hours: formatColumn(data48Hours, jobType.id),
                                thirty_days: formatColumn(data30Days, jobType.id)
                            });
                        });

                        vm.performanceData = _.sortByOrder(vm.performanceData, [function (d) {
                            if (d.twentyfour_hours.total > 0) {
                                return d.twentyfour_hours.errorTotal / d.twentyfour_hours.total;
                            }
                            return 0;
                        }, 'twentyfour_hours.total'], ['desc', 'desc']);

                        vm.gridOptions.minRowsToShow = vm.performanceData.length;
                        vm.gridOptions.virtualizationThreshold = vm.performanceData.length;
                        vm.gridOptions.data = vm.performanceData;
                    }

                    vm.loading = false;
                }).catch(function (error) {
                    vm.loading = false;
                    console.log(error);
                    toastr['error'](error);
                });
            });
        };
        
        initialize();

        $scope.$watch('vm.selectedJobType', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            if (vm.loading) {
                if (filteredByJobType) {
                    vm.updateJobType(newValue);
                }
            } else {
                filteredByJobType = newValue !== 'VIEW ALL';
                vm.updateJobType(newValue);
            }
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('jobsController', ['$scope', '$location', '$uibModal', 'scaleConfig', 'scaleService', 'stateService', 'navService', 'subnavService', 'userService', 'jobService', 'jobTypeService', 'loadService', 'gridFactory', 'toastr', function ($scope, $location, $uibModal, scaleConfig, scaleService, stateService, navService, subnavService, userService, jobService, jobTypeService, loadService, gridFactory, toastr) {
        subnavService.setCurrentPath('jobs');

        var vm = this,
            jobTypeViewAll = { name: 'VIEW ALL', title: 'VIEW ALL', version: '', id: 0 };

        vm.jobsParams = stateService.getJobsParams();

        vm.stateService = stateService;
        vm.loading = true;
        vm.readonly = true;
        vm.jobTypeValues = [jobTypeViewAll];
        vm.jobExecution = null;
        vm.selectedJobType = vm.jobsParams.job_type_id ? vm.jobsParams.job_type_id : jobTypeViewAll;
        vm.jobStatusValues = scaleConfig.jobStatus;
        vm.selectedJobStatus = vm.jobsParams.status || vm.jobStatusValues[0];
        vm.errorCategoryValues = _.map(scaleConfig.errorCategories, 'name');
        vm.selectedErrorCategory = vm.jobsParams.error_category || vm.errorCategoryValues[0];
        vm.subnavLinks = scaleConfig.subnavLinks.jobs;
        vm.actionClicked = false;
        vm.lastModifiedStart = moment.utc(vm.jobsParams.started).toDate();
        vm.lastModifiedStartPopup = {
            opened: false
        };
        vm.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStartPopup.opened = true;
        };
        vm.lastModifiedStop = moment.utc(vm.jobsParams.ended).toDate();
        vm.lastModifiedStopPopup = {
            opened: false
        };
        vm.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStopPopup.opened = true;
        };
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.paginationCurrentPage = vm.jobsParams.page || 1;
        vm.gridOptions.paginationPageSize = vm.jobsParams.page_size || vm.gridOptions.paginationPageSize;
        vm.gridOptions.data = [];

        var filteredByJobType = vm.jobsParams.job_type_id ? true : false,
            filteredByJobStatus = vm.jobsParams.status ? true : false,
            filteredByErrorCategory = vm.jobsParams.error_category ? true : false,
            filteredByOrder = vm.jobsParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'job_type',
                displayName: 'Job Type',
                cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }} {{ row.entity.job_type.version }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobType" ng-options="jobType as (jobType.title + \' \' + jobType.version) for jobType in grid.appScope.vm.jobTypeValues"></select></div>'
            },
            {
                field: 'created',
                displayName: 'Created (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'
            },
            {
                field: 'last_modified',
                displayName: 'Last Modified (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'
            },
            {
                field: 'duration',
                enableFiltering: false,
                enableSorting: false,
                width: 120,
                cellTemplate: '<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'
            },
            {
                field: 'status',
                width: 150,
                cellTemplate: '<div class="ui-grid-cell-contents"><div class="pull-right"><button ng-show="((!grid.appScope.vm.readonly) && (row.entity.status === \'FAILED\' || row.entity.status === \'CANCELED\'))" ng-click="grid.appScope.vm.requeueJobs({ job_ids: [row.entity.id] })" class="btn btn-xs btn-default" title="Requeue Job"><i class="fa fa-repeat"></i></button> <button ng-show="!grid.appScope.vm.readonly && row.entity.status !== \'COMPLETED\' && row.entity.status !== \'CANCELED\'" ng-click="grid.appScope.vm.cancelJob(row.entity)" class="btn btn-xs btn-default" title="Cancel Job"><i class="fa fa-ban"></i></button></div> {{ row.entity.status }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedJobStatus"><option ng-selected="{{ grid.appScope.vm.jobStatusValues[$index] == grid.appScope.vm.selectedJobStatus }}" value="{{ grid.appScope.vm.jobStatusValues[$index] }}" ng-repeat="status in grid.appScope.vm.jobStatusValues track by $index">{{ status.toUpperCase() }}</option></select></div>'
            },
            {
                field: 'error.category',
                width: 150,
                displayName: 'Error Category',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedErrorCategory"><option ng-selected="{{ grid.appScope.vm.errorCategoryValues[$index] == grid.appScope.vm.selectedErrorCategory }}" value="{{ grid.appScope.vm.errorCategoryValues[$index] }}" ng-repeat="error in grid.appScope.vm.errorCategoryValues track by $index">{{ error.toUpperCase() }}</option></select></div>'
            },
            {
                field: 'error.title',
                displayName: 'Error',
                cellTemplate: '<div class="ui-grid-cell-contents"><div uib-tooltip="{{ row.entity.error.description }}" tooltip-append-to-body="true">{{ row.entity.error.title }}</div></div>',
                width: 200,
                enableFiltering: false
            },
            {
                field: 'id',
                displayName: 'Log',
                enableFiltering: false,
                sortable: false,
                width: 60,
                cellTemplate: '<div class="ui-grid-cell-contents text-center"><button ng-click="grid.appScope.vm.showLog(row.entity.id)" class="btn btn-xs btn-default"><i class="fa fa-file-text"></i></button></div>'
            }
        ];

        vm.getJobs = function () {
            jobService.getJobsOnce(vm.jobsParams).then(function (data) {
                vm.gridOptions.totalItems = data.count;
                vm.gridOptions.minRowsToShow = data.results.length;
                vm.gridOptions.virtualizationThreshold = data.results.length;
                vm.gridOptions.data = data.results;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.getJobTypes = function () {
            jobTypeService.getJobTypesOnce().then(function (data) {
                vm.jobTypeValues.push(data.results);
                vm.jobTypeValues = _.flatten(vm.jobTypeValues);
                vm.selectedJobType = _.find(vm.jobTypeValues, { id: vm.jobsParams.job_type_id }) || jobTypeViewAll;
                vm.getJobs();
            }).catch(function () {
                vm.loading = false;
            });
        };

        vm.showLog = function (jobId) {
            // show log modal
            vm.actionClicked = true;
            jobService.getJobDetail(jobId).then(function (data) {
                vm.jobExecution = data.getLatestExecution();
                $uibModal.open({
                    animation: true,
                    templateUrl: 'showLog.html',
                    scope: $scope,
                    size: 'lg',
                    windowClass: 'log-modal-window'
                });
            });
        };

        vm.requeueJobs = function (jobsParams) {
            if (!jobsParams) {
                jobsParams = vm.jobsParams ? vm.jobsParams : { started: vm.lastModifiedStart.toISOString(), ended: vm.lastModifiedStop.toISOString() };
            }
            vm.actionClicked = true;
            vm.loading = true;
            loadService.requeueJobs(jobsParams).then(function () {
                toastr['success']('Requeue Successful');
                vm.getJobs();
            }).catch(function (error) {
                toastr['error']('Requeue request failed');
                vm.loading = false;
            });
        };

        vm.cancelJob = function (job) {
            vm.actionClicked = true;
            vm.loading = true;
            var originalStatus = job.status;
            job.status = 'CANCEL';
            jobService.updateJob(job.id, { status: 'CANCELED' }).then(function () {
                toastr['success']('Job Canceled');
                job.status = 'CANCELED';
            }).catch(function (error) {
                toastr['error'](error);
                job.status = originalStatus;
            }).finally(function () {
                vm.loading = false;
            });
        };
        
        vm.filterResults = function () {
            stateService.setJobsParams(vm.jobsParams);
            vm.loading = true;
            vm.getJobs();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.jobsParams);
        };

        vm.updateJobOrder = function (sortArr) {
            vm.jobsParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.updateJobType = function (value) {
            if (value.id !== vm.jobsParams.job_type_id) {
                vm.jobsParams.page = 1;
            }
            vm.jobsParams.job_type_id = value.id === 0 ? null : value.id;
            vm.jobsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.updateJobStatus = function (value) {
            if (value != vm.jobsParams.status) {
                vm.jobsParams.page = 1;
            }
            vm.jobsParams.status = value === 'VIEW ALL' ? null : value;
            vm.jobsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.updateErrorCategory = function (value) {
            if (value != vm.jobsParams.error_category) {
                vm.jobsParams.page = 1;
            }
            vm.jobsParams.error_category = value === 'VIEW ALL' ? null : value;
            vm.jobsParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                if (vm.actionClicked) {
                    vm.actionClicked = false;
                } else {
                    $location.path('/jobs/job/' + row.entity.id);
                }
            });
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.jobsParams.page = currentPage;
                vm.jobsParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setJobsColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateJobOrder(sortArr);
            });
        };

        vm.initialize = function () {
            stateService.setJobsParams(vm.jobsParams);
            vm.updateColDefs();
            var user = userService.getUserCreds();
            vm.readonly = !(user && user.is_admin);
            vm.getJobTypes();
            navService.updateLocation('jobs');
        };

        vm.initialize();

        $scope.$watch('vm.selectedJobType', function (value) {
            if (parseInt(value)) {
                value = _.find(vm.jobTypeValues, {id: parseInt(value)});
            }
            if (value) {
                if (vm.loading) {
                    if (filteredByJobType) {
                        vm.updateJobType(value);
                    }
                } else {
                    filteredByJobType = !angular.equals(value, jobTypeViewAll);
                    vm.updateJobType(value);
                }
            }
        });

        $scope.$watch('vm.selectedJobStatus', function (value) {
            if (vm.loading) {
                if (filteredByJobStatus) {
                    vm.updateJobStatus(value);
                }
            } else {
                filteredByJobStatus = value !== 'VIEW ALL';
                vm.updateJobStatus(value);
            }
        });

        $scope.$watch('vm.selectedErrorCategory', function (value) {
            if (vm.loading) {
                if (filteredByErrorCategory) {
                    vm.updateErrorCategory(value);
                }
            } else {
                filteredByErrorCategory = value !== 'VIEW ALL';
                vm.updateErrorCategory(value);
            }
        });

        $scope.$watch('vm.lastModifiedStart', function (value) {
            if (!vm.loading) {
                vm.jobsParams.started = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watch('vm.lastModifiedStop', function (value) {
            if (!vm.loading) {
                vm.jobsParams.ended = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watchCollection('vm.stateService.getJobsColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getJobsParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.jobsParams = newValue;
            vm.updateColDefs();
        });
    }]);
})();
(function () {
    'use strict';
    
    angular.module('scaleApp').controller('jobExecutionLogController', ['$scope', '$location', '$element', '$timeout', 'jobExecutionService', 'scaleConfig', function ($scope, $location, $element, $timeout, jobExecutionService, scaleConfig) {
        var vm = this;
        
        var initialize = function () {
            vm.forceScroll = true;
            vm.jobLogError = null;

            $scope.$watch('execution', function () {
                if ($scope.execution) {
                    jobExecutionService.getLog($scope.execution.id).then(null, null, function (result) {
                        // get difference of max scroll length and current scroll length.
                        var logResult = result.execution_log;
                        if (result.$resolved) {
                            var div = $($element[0]).find('.bash');
                            vm.scrollDiff = (div.scrollTop() + div.prop('offsetHeight')) - div.prop('scrollHeight');
                            if (vm.scrollDiff >= 0) {
                                vm.forceScroll = true;
                            }
                            vm.execLog = logResult;
                        } else {
                            if (result.statusText && result.statusText !== '') {
                                vm.jobLogErrorStatus = result.statusText;
                            }
                            $scope.jobLogError = 'Unable to retrieve job logs.';
                        }
                    });
                }
            });
            $scope.$watch('vm.execLog', function () {
                if (vm.execLog) {
                    if (vm.forceScroll || vm.scrollDiff >= 0) {
                        $timeout(function () {
                            vm.forceScroll = false;
                            var scrlHeight = $($element[0]).find('.bash').prop('scrollHeight');
                            $($element[0]).find('.bash').scrollTop(scrlHeight);
                        }, 50);
                    }
                }
            });
        };

        vm.scrollitem = function (item) {
            console.log(item);
        };

        vm.stdoutChanged = function () {
            console.log('stdout changed.');
        };

        initialize();

    }]).directive('jobExecutionLog', function () {
        return {
            controller: 'jobExecutionLogController',
            controllerAs: 'vm',
            templateUrl: 'modules/jobs/directives/jobExecutionLogTemplate.html',
            restrict: 'E',
            scope: {
                execution: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisJobHealthController', ['$rootScope', '$scope', 'jobTypeService', function ($rootScope, $scope, jobTypeService) {
        var vm = this;
        
        vm.loadingJobHealth = true;
        vm.jobHealthError = null;
        vm.jobHealthErrorStatus = null;
        vm.jobHealth = {};

        var getJobTypeStatus = function () {
            jobTypeService.getJobTypeStatus({
                page: null,
                page_size: 1000,
                started: $scope.duration,
                ended: null
            }).then(null, null, function (data) {
                if (data.$resolved) {
                    vm.jobHealthError = null;
                    vm.jobTypeStatus = data.results;
                    vm.total = 0;
                    vm.failed = 0;

                    var performance = {},
                        failures = [];

                    _.forEach(data.results, function (status) {
                        performance = status.getPerformance();
                        vm.total = vm.total + performance.total;
                        vm.failed = vm.failed + performance.failed;
                        failures.push(status.getFailures());
                    });

                    var failureData = [],
                        systemFailures = 0,
                        dataFailures = 0,
                        algorithmFailures = 0;

                    _.forEach(failures, function (f) {
                        _.forEach(f, function (type) {
                            if (type.status === 'SYSTEM') {
                                systemFailures = systemFailures + type.count;
                            } else if (type.status === 'DATA') {
                                dataFailures = dataFailures + type.count;
                            } else if (type.status === 'ALGORITHM') {
                                algorithmFailures = algorithmFailures + type.count;
                            }
                        });
                    });

                    if (systemFailures > 0 || dataFailures > 0 || algorithmFailures > 0) {
                        if (systemFailures > 0) {
                            failureData.push({
                                status: 'SYSTEM',
                                count: systemFailures
                            });
                        }
                        if (algorithmFailures > 0) {
                            failureData.push({
                                status: 'ALGORITHM',
                                count: algorithmFailures
                            });
                        }
                        if (dataFailures > 0) {
                            failureData.push({
                                status: 'DATA',
                                count: dataFailures
                            });
                        }
                    }

                    vm.jobHealth = {
                        gaugeData: vm.total === 0 ? 0 : 100 - ((vm.failed / vm.total) * 100).toFixed(2),
                        donutData: failureData
                    };

                    if ($scope.broadcastData) {
                        $rootScope.$broadcast('jobTypeStatus', vm.jobTypeStatus);
                    }
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.jobHealthErrorStatus = data.statusText;
                    }
                    vm.jobHealthError = 'Unable to retrieve job statistics.';
                }
                vm.loadingJobHealth = false;
            });
        };

        getJobTypeStatus();
    }]).directive('aisJobHealth', function(){
        /**
         * Usage: <ais-job-health />
         **/
        return {
            controller: 'aisJobHealthController',
            controllerAs: 'vm',
            templateUrl: 'modules/jobs/directives/jobHealthTemplate.html',
            restrict: 'E',
            scope: {
                duration: '=',
                broadcastData: '=', // set to true when using another widget in the same view that also calls getJobTypeStatus
                showDescription: '='
            }
        };
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('jobTypeInterfaceDirectiveController', ['$rootScope', '$scope', 'jobTypeService', function ($rootScope, $scope, jobTypeService) {

    }]).directive('aisJobTypeInterface', function(){
        /**
         * Usage: <ais-job-health />
         **/
        return {
            controller: 'jobTypeInterfaceDirectiveController',
            templateUrl: 'modules/jobs/directives/jobTypeInterfaceTemplate.html',
            restrict: 'E',
            scope: {
                jobTypeInterface: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Job', ['scaleConfig', 'JobType', 'scaleService', function (scaleConfig, JobType, scaleService) {
        var Job = function (id, job_type, job_type_rev, event, error, status, priority, num_exes, timeout, max_tries, cpus_required, mem_required, disk_in_required, disk_out_required, created, queued, started, ended, last_status_change, last_modified) {
            this.id = id;
            this.job_type = JobType.transformer(job_type);
            this.job_type_rev = job_type_rev;
            this.event = event;
            this.error = error;
            this.status = status;
            this.priority = priority;
            this.num_exes = num_exes;
            this.timeout = timeout;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.disk_in_required = disk_in_required;
            this.disk_out_required = disk_out_required;
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.queued = queued;
            this.started = started;
            this.ended = ended;
            this.last_status_change = last_status_change;
            this.last_modified = last_modified;
            this.last_modified_formatted = moment.utc(last_modified).format(scaleConfig.dateFormats.day_second_utc_nolabel);
        };

        // public methods
        Job.prototype = {
            getDuration: function () {
                var start = this.started,
                    end = this.ended ? this.ended : moment.utc().toISOString();
                return scaleService.calculateDuration(start, end);
            }
        };

        // static methods, assigned to class
        Job.build = function (data) {
            if (data) {
                return new Job(
                    data.id,
                    data.job_type,
                    data.job_type_rev,
                    data.event,
                    data.error,
                    data.status,
                    data.priority,
                    data.num_exes,
                    data.timeout,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.disk_in_required,
                    data.disk_out_required,
                    data.created,
                    data.queued,
                    data.started,
                    data.ended,
                    data.last_status_change,
                    data.last_modified
                );
            }
            return new Job();
        };

        Job.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Job.build)
                    .filter(Boolean);
            }
            return Job.build(data);
        };

        return Job;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailEvent', ['JobDetailEventRule', function (JobDetailEventRule) {
        var JobDetailEvent = function (id, type, rule, occurred) {
            this.id = id;
            this.type = type;
            this.rule = JobDetailEventRule.transformer(rule);
            this.occurred = occurred;
        };

        // public methods
        JobDetailEvent.prototype = {

        };

        // static methods, assigned to class
        JobDetailEvent.build = function (data) {
            if (data) {
                return new JobDetailEvent(
                    data.id,
                    data.type,
                    data.rule,
                    data.occurred
                );
            }
            return new JobDetailEvent();
        };

        JobDetailEvent.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailEvent.build)
                    .filter(Boolean);
            }
            return JobDetailEvent.build(data);
        };

        return JobDetailEvent;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailEventRule', function () {
        var JobDetailEventRule = function (id, type, is_active, created, archived, last_modified) {
            this.id = id;
            this.type = type;
            this.is_active = is_active;
            this.created = created;
            this.archived = archived;
            this.last_modified = last_modified;
        };

        // public methods
        JobDetailEventRule.prototype = {

        };

        // static methods, assigned to class
        JobDetailEventRule.build = function (data) {
            if (data) {
                return new JobDetailEventRule(
                    data.id,
                    data.type,
                    data.is_active,
                    data.created,
                    data.archived,
                    data.last_modified
                );
            }
            return new JobDetailEventRule();
        };

        JobDetailEventRule.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailEventRule.build)
                    .filter(Boolean);
            }
            return JobDetailEventRule.build(data);
        };

        return JobDetailEventRule;
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailInputData', function () {
        var JobDetailInputData = function (name, value, file_id, file_ids, files) {
            this.name = name;
            this.value = value;
            this.file_id = file_id;
            this.file_ids = file_ids;
            this.files = files;
        };

        // public methods
        JobDetailInputData.prototype = {
            getValue: function () {
                if (this.value)
                    return this.value;
                if (this.file_id)
                    return this.file_id;
                if (this.file_ids)
                    return this.file_ids;
            }
        };

        // static methods, assigned to class
        JobDetailInputData.build = function (data) {
            if (data) {
                return new JobDetailInputData(
                    data.name,
                    data.value,
                    data.file_id,
                    data.file_ids,
                    data.files
                );
            }
            return new JobDetailInputData();
        };

        JobDetailInputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailInputData.build)
                    .filter(Boolean);
            }
            return JobDetailInputData.build(data);
        };

        return JobDetailInputData;
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailOutputData', function () {
        var JobDetailOutputData = function (name, workspace_id, files) {
            this.name = name;
            this.workspace_id = workspace_id;
            this.files = files;
        };

        // public methods
        JobDetailOutputData.prototype = {

        };

        // static methods, assigned to class
        JobDetailOutputData.build = function (data) {
            if (data) {
                return new JobDetailOutputData(
                    data.name,
                    data.workspace_id,
                    data.files
                );
            }
            return new JobDetailOutputData();
        };

        JobDetailOutputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailOutputData.build)
                    .filter(Boolean);
            }
            return JobDetailOutputData.build(data);
        };

        return JobDetailOutputData;
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetails', ['scaleConfig', 'JobType', 'JobExecution', 'Product', 'JobDetailInputData', 'JobDetailOutputData', 'Recipe', 'JobDetailEvent', 'scaleService', function (scaleConfig, JobType, JobExecution, Product, JobDetailInputData, JobDetailOutputData, Recipe, JobDetailEvent, scaleService) {
        var JobDetails = function (id, job_type, job_type_rev, event, error, status, priority, num_exes, timeout, max_tries, cpus_required, mem_required, disk_in_required, disk_out_required, created, queued, started, ended, last_status_change, last_modified, data, results, recipes, job_exes, inputs, outputs) {
            this.id = id;
            this.job_type = JobType.transformer(job_type);
            this.job_type_rev = job_type_rev;
            this.event = JobDetailEvent.transformer(event);
            this.error = error;
            this.status = status;
            this.priority = priority;
            this.num_exes = num_exes;
            this.timeout = timeout;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.disk_in_required = disk_in_required;
            this.disk_out_required = disk_out_required;
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc);
            this.queued = queued;
            this.queued_formatted = moment.utc(queued).format(scaleConfig.dateFormats.day_second_utc);
            this.started = started;
            this.started_formatted = moment.utc(started).format(scaleConfig.dateFormats.day_second_utc);
            this.ended = ended;
            this.ended_formatted = moment.utc(ended).format(scaleConfig.dateFormats.day_second_utc);
            this.last_status_change = last_status_change;
            this.last_modified = last_modified;
            this.data = {
                input_data: JobDetailInputData.transformer(data.input_data),
                version: data.version,
                output_data: JobDetailOutputData.transformer(data.output_data)
            };
            this.results = {
                output_data: JobDetailOutputData.transformer(results.output_data),
                version: results.version
            };
            this.recipes = Recipe.transformer(recipes);
            this.job_exes = JobExecution.transformer(job_exes);
            this.inputs = inputs;
            this.outputs = outputs;
        };

        // public methods
        JobDetails.prototype = {
            getDuration: function () {
                return scaleService.calculateDuration(this.created, this.last_modified);
            },
            getLatestExecution: function(){
                if (this.num_exes > 0 ) {
                    return this.job_exes[0];
                }
                return null;
            },
            getStatusClass: function(){
                // if(this.status === 'COMPLETED'){
                //     return 'label-success';
                // }
                // else if( this.status === 'FAILED'){
                //     return 'label-default';//    return 'label-danger';
                // }
                // else{
                //     return 'label-default';
                // }
                return this.status.toLowerCase();
            }
        };

        // static methods, assigned to class
        JobDetails.build = function (data) {
            if (data) {
                return new JobDetails(
                    data.id,
                    data.job_type,
                    data.job_type_rev,
                    data.event,
                    data.error,
                    data.status,
                    data.priority,
                    data.num_exes,
                    data.timeout,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.disk_in_required,
                    data.disk_out_required,
                    data.created,
                    data.queued,
                    data.started,
                    data.ended,
                    data.last_status_change,
                    data.last_modified,
                    data.data,
                    data.results,
                    data.recipes,
                    data.job_exes,
                    data.inputs,
                    data.outputs
                );
            }
            return new JobDetails();
        };

        JobDetails.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetails.build)
                    .filter(Boolean);
            }
            return JobDetails.build(data);
        };

        return JobDetails;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobExecution', ['scaleConfig', 'Job', 'Node', 'moment', function (scaleConfig, Job, Node, moment) {
        var JobExecution = function (id, status, command_arguments, timeout, pre_started, pre_completed, pre_exit_code, job_started, job_completed, job_exit_code, post_started, post_completed, post_exit_code, created, queued, started, ended, last_modified, job, node, error, environment, cpus_scheduled, mem_scheduled, disk_in_scheduled, disk_out_scheduled, disk_total_scheduled, results, current_stdout_url, current_stderr_url, results_manifest) {
            this.id = id;
            this.status = status;
            this.command_arguments = command_arguments;
            this.timeout = timeout;
            this.pre_started = pre_started;
            this.pre_completed = pre_completed;
            this.pre_exit_code = pre_exit_code;
            this.job_started = job_started;
            this.job_completed = job_completed;
            this.job_exit_code = job_exit_code;
            this.post_started = post_started;
            this.post_completed = post_completed;
            this.post_exit_code = post_exit_code;
            this.created = created;
            this.created_formatted = created ? moment.utc(created).toISOString() : created;
            this.queued = queued;
            this.queued_formatted = queued ? moment.utc(queued).toISOString() : queued;
            this.started = started;
            this.started_formatted = started ? moment.utc(started).toISOString() : started;
            this.ended = ended;
            this.ended_formatted = ended ? moment.utc(ended).toISOString() : ended;
            this.last_modified = last_modified;
            this.last_modified_formatted = last_modified ? moment.utc(last_modified).toISOString() : last_modified;
            this.job = Job.transformer(job);
            this.node = Node.transformer(node);
            this.error = error;
            this.environment = environment;
            this.cpus_scheduled = cpus_scheduled;
            this.mem_scheduled = mem_scheduled;
            this.disk_in_scheduled = disk_in_scheduled;
            this.disk_out_scheduled = disk_out_scheduled;
            this.disk_total_scheduled = disk_total_scheduled;
            this.results = results;
            this.current_stdout_url = current_stdout_url;
            this.current_stderr_url = current_stderr_url;
            this.results_manifest = results_manifest;
        };

        // public methods
        JobExecution.prototype = {
            getDuration: function () {
                return moment.utc(this.job_completed).diff(moment.utc(this.job_started));
            },
            getIcon: function () {
                return this.job.jobType.iconCode ? '<i class="fa">&#x' + this.job.jobType.iconCode + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            }
        };

        // static methods, assigned to class
        JobExecution.build = function (data) {
            if (data) {
                return new JobExecution(
                    data.id,
                    data.status,
                    data.command_arguments,
                    data.timeout,
                    data.pre_started,
                    data.pre_completed,
                    data.pre_exit_code,
                    data.job_started,
                    data.job_completed,
                    data.job_exit_code,
                    data.post_started,
                    data.post_completed,
                    data.post_exit_code,
                    data.created,
                    data.queued,
                    data.started,
                    data.ended,
                    data.last_modified,
                    data.job,
                    data.node,
                    data.error,
                    data.environment,
                    data.cpus_scheduled,
                    data.mem_scheduled,
                    data.disk_in_scheduled,
                    data.disk_out_scheduled,
                    data.disk_total_scheduled,
                    data.results,
                    data.current_stdout_url,
                    data.current_stderr_url,
                    data.results_manifest
                );
            }
            return new JobExecution();
        };

        JobExecution.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobExecution.build)
                    .filter(Boolean);
            }
            return JobExecution.build(data);
        };

        return JobExecution;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobExecutionLog', ['scaleConfig', 'Job', 'Node', function (scaleConfig, Job, Node) {
        var JobExecutionLog = function (id, status, command_arguments, timeout, exit_code, created, queued, scheduled, pre_started, pre_completed, job_started, job_completed, post_started, post_completed, ended, last_modified, job, node, error, is_finished, stdout, stderr) {
            this.id = id;
            this.status = status;
            this.command_arguments = command_arguments;
            this.timeout = timeout;
            this.exit_code = exit_code;
            this.created = created;
            this.queued = queued;
            this.scheduled = scheduled;
            this.pre_started = pre_started;
            this.pre_completed = pre_completed;
            this.job_started = job_started;
            this.job_completed = job_completed;
            this.post_started = post_started;
            this.post_completed = post_completed;
            this.ended = ended;
            this.last_modified = last_modified;
            this.job = Job.transformer(job);
            this.node = Node.transformer(node);
            this.error = error;
            this.is_finished = is_finished;
            this.stdout = stdout;
            this.stdoutHtml = stdout ? stdout.replace(new RegExp('\r?\n','g'), '<br />') : '';
            this.stderr = stderr;
        };

        // public methods
        JobExecutionLog.prototype = {
            toHtml: function(instr){
                return instr
            }

        };

        // static methods, assigned to class
        JobExecutionLog.build = function (data) {
            if (data) {
                return new JobExecutionLog(
                    data.id,
                    data.status,
                    data.command_arguments,
                    data.timeout,
                    data.exit_code,
                    data.created,
                    data.queued,
                    data.scheduled,
                    data.pre_started,
                    data.pre_completed,
                    data.job_started,
                    data.job_completed,
                    data.post_started,
                    data.post_completed,
                    data.ended,
                    data.last_modified,
                    data.job,
                    data.node,
                    data.error,
                    data.is_finished,
                    data.stdout,
                    data.stderr
                );
            }
            return new JobExecutionLog();
        };

        JobExecutionLog.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobExecutionLog.build)
                    .filter(Boolean);
            }
            return JobExecutionLog.build(data);
        };

        return JobExecutionLog;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobType', ['scaleConfig', 'JobTypeInterface', function (scaleConfig, JobTypeInterface) {
        var JobType = function (id, name, title, version, description, is_system, is_long_running, is_active, is_operational, is_paused, uses_docker, docker_privileged, docker_image, priority, timeout, max_tries, cpus_required, mem_required, disk_out_const_required, disk_out_mult_required, icon_code, created, archived, paused, last_modified, job_type_interface) {
            this.id = id;
            this.name = name;
            this.title = title;
            this.version = version;
            this.description = description;
            this.is_system = is_system;
            this.is_long_running = is_long_running;
            this.is_active = is_active;
            this.is_operational = is_operational;
            this.is_paused = is_paused;
            this.uses_docker = uses_docker;
            this.docker_privileged = docker_privileged;
            this.docker_image = docker_image;
            this.priority = priority;
            this.timeout = timeout;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.disk_out_const_required = disk_out_const_required;
            this.disk_out_mult_required = disk_out_mult_required;
            this.icon_code = icon_code;
            this.created = created;
            this.archived = archived;
            this.paused = paused;
            this.last_modified = last_modified;
            this.job_type_interface = JobTypeInterface.transformer(job_type_interface);
        };

        // public methods
        JobType.prototype = {
            toString: function () {
                return 'JobType';
            },
            getIcon: function () {
                return this.icon_code ? '<i class="fa fa-fw">&#x' + this.icon_code + '</i>' : '<i class="fa fa-fw">&#x' + scaleConfig.defaultIconCode + '</i>';
            },
            getCellText: function () {
                return this.icon_code ? '&#x' + this.icon_code + ';' : '&#x' + scaleConfig.defaultIconCode + ';';
            },
            getCellTitle: function () {
                return this.title;
            }
        };

        // static methods, assigned to class
        JobType.build = function (data) {
            if (data) {
                return new JobType(
                    data.id,
                    data.name,
                    data.title,
                    data.version,
                    data.description,
                    data.is_system,
                    data.is_long_running,
                    data.is_active,
                    data.is_operational,
                    data.is_paused,
                    data.uses_docker,
                    data.docker_privileged,
                    data.docker_image,
                    data.priority,
                    data.timeout,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.disk_out_const_required,
                    data.disk_out_mult_required,
                    data.icon_code,
                    data.created,
                    data.archived,
                    data.paused,
                    data.last_modified,
                    data.interface
                );
            }
            return new JobType();
        };

        JobType.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobType.build)
                    .filter(Boolean);
            }
            return JobType.build(data);
        };

        return JobType;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeDetails', ['scaleConfig', 'JobTypeInterface', 'JobTypeErrorMapping', 'JobTypeError', 'scaleService', function (scaleConfig, JobTypeInterface, JobTypeErrorMapping, JobTypeError, scaleService) {
        var JobTypeDetails = function (id, name, version, title, description, category, author_name, author_url, is_system, is_long_running, is_active, is_operational, is_paused, icon_code, uses_docker, docker_privileged, docker_image, revision_num, priority, timeout, max_scheduled, max_tries, cpus_required, mem_required, disk_out_const_required, disk_out_mult_required, created, archived, paused, last_modified, job_type_interface, error_mapping, trigger_rule, errors, job_counts_6h, job_counts_12h, job_counts_24h) {
            this.id = id;
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            this.category = category;
            this.author_name = author_name;
            this.author_url = author_url;
            this.is_system = is_system;
            this.is_long_running = is_long_running;
            this.is_active = is_active;
            this.is_operational = is_operational;
            this.is_paused = is_paused;
            this.icon_code = icon_code;
            this.uses_docker = uses_docker;
            this.docker_privileged = docker_privileged;
            this.docker_image = docker_image;
            this.revision_num = revision_num;
            this.priority = priority;
            this.timeout = timeout;
            this.max_scheduled = max_scheduled;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.mem_required_formatted = scaleService.calculateFileSizeFromMib(mem_required);
            this.disk_out_const_required = disk_out_const_required;
            this.disk_out_const_required_formatted = scaleService.calculateFileSizeFromMib(disk_out_const_required);
            this.disk_out_mult_required = disk_out_mult_required;
            this.created = created;
            this.archived = archived;
            this.paused = paused;
            this.last_modified = last_modified;
            this.job_type_interface = job_type_interface;
            this.error_mapping = JobTypeErrorMapping.transformer(error_mapping);
            this.trigger_rule = trigger_rule;
            this.errors = JobTypeError.transformer(errors);
            this.job_counts_6h = job_counts_6h;
            this.job_counts_12h = job_counts_12h;
            this.job_counts_24h = job_counts_24h;
        };

        // public methods
        JobTypeDetails.prototype = {
            getIcon: function () {
                return this.icon_code ? '<i class="fa">&#x' + this.icon_code + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            },
            getPerformance: function () {
                var failed6Arr = _.where(this.job_counts_6h, { 'status': 'FAILED' }),
                    failed12Arr = _.where(this.job_counts_12h, { 'status': 'FAILED' }),
                    failed24Arr = _.where(this.job_counts_24h, { 'status': 'FAILED' });

                var completed6 = _.find(this.job_counts_6h, 'status', 'COMPLETED') || { count: 0 },
                    failed6 = _.sum(failed6Arr, 'count'),
                    total6 = failed6Arr.length > 0 ? failed6 + completed6.count : completed6.count,
                    successRate6 = total6 === 0 ? 0 : 100 - ((failed6 / total6) * 100).toFixed(2),
                    completed12 = _.find(this.job_counts_12h, 'status', 'COMPLETED') || { count: 0 },
                    failed12 = _.sum(failed12Arr, 'count'),
                    total12 = failed12Arr.length > 0 ? failed12 + completed12.count : completed12.count,
                    successRate12 = total12 === 0 ? 0 : 100 - ((failed12 / total12) * 100).toFixed(2),
                    completed24 = _.find(this.job_counts_24h, 'status', 'COMPLETED') || { count: 0 },
                    failed24 = _.sum(failed24Arr, 'count'),
                    total24 = failed24Arr.length > 0 ? failed24 + completed24.count : completed24.count,
                    successRate24 = total24 === 0 ? 0 : 100 - ((failed24 / total24) * 100).toFixed(2);

                return {
                    hour6: {
                        rate: successRate6,
                        failed: failed6,
                        completed: completed6.count,
                        total: total6
                    },
                    hour12: {
                        rate: successRate12,
                        failed: failed12,
                        completed: completed12.count,
                        total: total12
                    },
                    hour24: {
                        rate: successRate24,
                        failed: failed24,
                        completed: completed24.count,
                        total: total24
                    }
                };
            },
            getFailures: function () {
                var failed6 = _.where(this.job_counts_6h, { 'status': 'FAILED' }),
                    failed6Values = _.values(_.groupBy(failed6, 'category')),
                    failed12 = _.where(this.job_counts_12h, { 'status': 'FAILED' }),
                    failed12Values = _.values(_.groupBy(failed12, 'category')),
                    failed24 = _.where(this.job_counts_24h, { 'status': 'FAILED' }),
                    failed24Values = _.values(_.groupBy(failed24, 'category'));

                var getFailureCounts = function (categories) {
                    var returnArr = [];
                    _.forEach(categories, function (category) {
                        _.forEach(category, function (val) {
                            returnArr.push({ status: val.category, count: val.count });
                        });
                    });
                    return returnArr;
                };

                return {
                    hour6: getFailureCounts(failed6Values),
                    hour12: getFailureCounts(failed12Values),
                    hour24: getFailureCounts(failed24Values)
                };
            }
        };

        // static methods, assigned to class
        JobTypeDetails.build = function (data) {
            if (data) {
                // TODO: change property returned by API from "interface" to "job_type_interface" because "interface" is a reserved word in JS
                var jobTypeInterface = data.interface ? data.interface : data.job_type_interface;
                return new JobTypeDetails(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.category,
                    data.author_name,
                    data.author_url,
                    data.is_system,
                    data.is_long_running,
                    data.is_active,
                    data.is_operational,
                    data.is_paused,
                    data.icon_code,
                    data.uses_docker,
                    data.docker_privileged,
                    data.docker_image,
                    data.revision_num,
                    data.priority,
                    data.timeout,
                    data.max_scheduled,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.disk_out_const_required,
                    data.disk_out_mult_required,
                    data.created,
                    data.archived,
                    data.paused,
                    data.last_modified,
                    jobTypeInterface,
                    data.error_mapping,
                    data.trigger_rule,
                    data.errors,
                    data.job_counts_6h,
                    data.job_counts_12h,
                    data.job_counts_24h
                );
            }
            return new JobTypeDetails();
        };

        JobTypeDetails.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeDetails.build);
            }
            return JobTypeDetails.build(data);
        };

        return JobTypeDetails;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeError', ['moment', 'scaleConfig', function (moment, scaleConfig) {
        var JobTypeError = function (id, name, title, description, category, created, last_modified) {
            this.id = id;
            this.name = name;
            this.title = title;
            this.description = description;
            this.category = category;
            this.created = created;
            this.created_formatted = created ? moment.utc(created).toISOString() : created;
            this.last_modified = last_modified;
            this.last_modified_formatted = last_modified ? moment.utc(last_modified).toISOString() : last_modified;
        };

        // public methods
        JobTypeError.prototype = {

        };

        // static methods, assigned to class
        JobTypeError.build = function (data) {
            if (data) {
                return new JobTypeError(
                    data.id,
                    data.name,
                    data.title,
                    data.description,
                    data.category,
                    data.created,
                    data.last_modified
                );
            }
            return new JobTypeError();
        };

        JobTypeError.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeError.build)
                    .filter(Boolean);
            }
            return JobTypeError.build(data);
        };

        return JobTypeError;
    }])
})();

(function () {
    'use strict';
    
    angular.module('scaleApp').factory('JobTypeErrorMapping', function () {
        var JobTypeErrorMapping = function (version, exit_codes) {
            this.version = version;
            this.exit_codes = exit_codes;
        };

        // public methods
        JobTypeErrorMapping.prototype = {

        };

        // static methods, assigned to class
        JobTypeErrorMapping.build = function (data) {
            if (data) {
                return new JobTypeErrorMapping(
                    data.version,
                    data.exit_codes
                );
            }
            return new JobTypeErrorMapping();
        };

        JobTypeErrorMapping.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeErrorMapping.build)
                    .filter(Boolean);
            }
            return JobTypeErrorMapping.build(data);
        };

        return JobTypeErrorMapping;
    })
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeInputData', ['scaleConfig', function (scaleConfig) {
        var JobTypeInputData = function (media_types, required, type, name) {
            this.media_types = media_types;
            this.required = required;
            this.type = type;
            this.name = name;
        };

        // public methods
        JobTypeInputData.prototype = {

        };

        // static methods, assigned to class
        JobTypeInputData.build = function (data) {
            if (data) {
                return new JobTypeInputData(
                    data.media_types,
                    data.required,
                    data.type,
                    data.name
                );
            }
            return new JobTypeInputData();
        };

        JobTypeInputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeInputData.build);
            }
            return JobTypeInputData.build(data);
        };

        return JobTypeInputData;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeInterface', ['scaleConfig', 'JobTypeInputData', 'JobTypeOutputData', function (scaleConfig, JobTypeInputData, JobTypeOutputData) {
        var JobTypeInterface = function (version, command, command_arguments, input_data, output_data) {
            this.version = version;
            this.command = command;
            this.command_arguments = command_arguments;
            this.input_data = JobTypeInputData.transformer(input_data);
            this.output_data = JobTypeOutputData.transformer(output_data);
        };

        // public methods
        JobTypeInterface.prototype = {
            getIcon: function () {
                return this.iconCode ? '<i class="fa">&#x' + this.iconCode + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            }
        };

        // static methods, assigned to class
        JobTypeInterface.build = function (data) {
            if (data) {
                return new JobTypeInterface(
                    data.version,
                    data.command,
                    data.command_arguments,
                    data.input_data,
                    data.output_data
                );
            }
            return new JobTypeInterface();
        };

        JobTypeInterface.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeInterface.build)
                    .filter(Boolean);
            }
            return JobTypeInterface.build(data);
        };

        return JobTypeInterface;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeOutputData', function () {
        var JobTypeOutputData = function (name, type, required, media_type) {
            this.name = name;
            this.type = type;
            this.required = required;
            this.media_type = media_type;
        };

        // public methods
        JobTypeOutputData.prototype = {

        };

        // static methods, assigned to class
        JobTypeOutputData.build = function (data) {
            if (data) {
                return new JobTypeOutputData(
                    data.name,
                    data.type,
                    data.required,
                    data.media_type
                );
            }
            return new JobTypeOutputData();
        };

        JobTypeOutputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeOutputData.build)
                    .filter(Boolean);
            }
            return JobTypeOutputData.build(data);
        };

        return JobTypeOutputData;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeStatus', ['scaleConfig', 'JobType', 'JobExecution', function (scaleConfig, JobType, JobExecution) {
        var JobTypeStatus = function (job_type, job_counts) {
            this.job_type = JobType.transformer(job_type);
            this.job_counts = job_counts;
            this.has_running = _.find(job_counts, 'status', 'RUNNING');
            this.description = this.getPerformance().rateDescription;
        };

        // public methods
        JobTypeStatus.prototype = {
            toString: function () {
                return 'JobTypeStatus';
            },
            getPerformance: function () {
                var failedArr = _.sortByOrder(_.filter(this.job_counts, { status: 'FAILED' }), ['count'], ['desc']),
                    completed = _.find(this.job_counts, 'status', 'COMPLETED') || { count: 0 },
                    failed = _.sum(failedArr, 'count'),
                    failedCategory = failedArr.length > 0 ? failedArr[0].category : '',
                    total = failedArr.length > 0 ? failed + completed.count : completed.count,
                    successRate = total === 0 ? 0 : 100 - ((failed / total) * 100).toFixed(2),
                    successRateDescription = 'success';

                if (successRate <= 30 && total > 0) {
                    successRateDescription = 'error';
                } else if (successRate > 30 && successRate <= 60 && total > 0) {
                    successRateDescription = 'warning';
                } else if (total === 0 && !this.has_running) {
                    successRateDescription = 'z_inactive'; // prepend with 'z_' for ordering purposes
                }

                return {
                    rate: successRate,
                    rateDescription: successRateDescription,
                    failed: failed,
                    failedCategory: failedCategory,
                    completed: completed.count,
                    total: total
                };
            },
            getRunning: function () {
                return _.find(this.job_counts, 'status', 'RUNNING') || { count: 0 };
            },
            getFailures: function () {
                var failed = _.where(this.job_counts, { 'status': 'FAILED' });

                _.forEach(failed, function (f) {
                    var category = _.find(scaleConfig.errorCategories, { name: f.category });
                    f.order = category ? category.order : '';
                });

                var failedValues = _.values(_.groupBy(failed, 'order'));

                var getFailureCounts = function (categories) {
                    var returnArr = [];
                    _.forEach(categories, function (category) {
                        _.forEach(category, function (val) {
                            returnArr.push({ status: val.category, count: val.count, order: val.order });
                        });
                    });
                    return _.sortByOrder(returnArr, ['order'], ['desc']);
                };

                return getFailureCounts(failedValues);
            },
            getCellFill: function () {
                var status = this.getPerformance();
                if (status.rateDescription === 'z_inactive') {
                    return scaleConfig.colors.chart_gray_dark;
                }
                return scaleConfig.colors.chart_green;
            },
            getCellActivity: function () {
                var running = this.getRunning();
                if (running.count > 0) {
                    return '&#x' + scaleConfig.activityIconCode + ';';
                }
                return '';
            },
            getCellActivityTotal: function () {
                return this.getRunning().count > 0 ? this.getRunning().count : '';
            },
            getCellError: function () {
                var performance = this.getPerformance();
                return 'Failed: ' + (performance.failed);
            },
            getCellTotal: function () {
                var performance = this.getPerformance();
                return performance.completed;
            },
            getCellPauseResume: function () {
                return;
            },
            getCellFailures: function () {
                return _.map(this.getFailures(), 'status');
            }
        };

        // static methods, assigned to class
        JobTypeStatus.build = function (data) {
            if (data) {
                return new JobTypeStatus(
                    data.job_type,
                    data.job_counts
                );
            }
            return new JobTypeStatus();
        };

        JobTypeStatus.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeStatus.build)
                    .filter(Boolean);
            }
            return JobTypeStatus.build(data);
        };

        return JobTypeStatus;
    }]);
})();

(function (){
    'use strict';

    angular.module('scaleApp').factory('Product', ['JobType', 'scaleService', 'scaleConfig', function (JobType, scaleService, scaleConfig) {
        var Product = function (id, workspace, file_name, media_type, file_size, data_type, is_deleted, uuid, url, created, deleted, data_started, data_ended, geometry, center_point, meta_data, countries, last_modified, is_operational, is_published, published, unpublished, job_type, job, job_exe, update, source_files) {
            this.id = id;
            this.workspace = workspace;
            this.file_name = file_name;
            this.media_type = media_type;
            this.file_size = file_size;
            this.file_size_readable = this.getReadableFileSize();
            this.data_type = data_type;
            this.is_deleted = is_deleted;
            this.uuid = uuid;
            this.url = url;
            this.created = created;
            this.created_formatted = created ? moment.utc(created).toISOString() : created;
            this.deleted = deleted;
            this.data_started = data_started;
            this.data_ended = data_ended;
            this.geometry = geometry;
            this.center_point = center_point;
            this.meta_data = meta_data;
            this.countries = countries;
            this.last_modified = last_modified;
            this.last_modified_formatted = last_modified ? moment.utc(last_modified).toISOString() : last_modified;
            this.is_operational = is_operational;
            this.is_operational_label = is_operational ? 'Operational' : 'R&amp;D';
            this.is_published = is_published;
            this.published = published;
            this.unpublished = unpublished;
            this.job_type = JobType.transformer(job_type);
            this.job = job;
            this.job_exe = job_exe;
            this.update = update;
            this.source_files = source_files;
        };

        // public methods
        Product.prototype = {
            getDuration: function () {
                return moment.utc(this.last_modified).diff(moment.utc(this.created));
            },
            getReadableFileSize: function () {
                return scaleService.calculateFileSizeFromBytes(this.file_size);
            }
        };

        // static methods, assigned to class
        Product.build = function (data) {
            if (data) {
                return new Product(
                    data.id,
                    data.workspace,
                    data.file_name,
                    data.media_type,
                    data.file_size,
                    data.data_type,
                    data.is_deleted,
                    data.uuid,
                    data.url,
                    data.created,
                    data.deleted,
                    data.data_started,
                    data.data_ended,
                    data.geometry,
                    data.center_point,
                    data.meta_data,
                    data.countries,
                    data.last_modified,
                    data.is_operational,
                    data.is_published,
                    data.published,
                    data.unpublished,
                    data.job_type,
                    data.job,
                    data.job_exe,
                    data.update,
                    data.source_files
                );
            }
            return new Product();
        };

        Product.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Product.build)
                    .filter(Boolean);
            }
            return Product.build(data);
        };

        return Product;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RunningJob', ['scaleConfig', 'scaleService', 'JobType', function (scaleConfig, scaleService, JobType) {
        var RunningJob = function (count, longest_running, job_type) {
            this.count = count;
            this.longest_running = longest_running;
            this.job_type = JobType.transformer(job_type);
        };

        // public methods
        RunningJob.prototype = {
            getDuration: function () {
                return scaleService.calculateDuration(this.longest_running, moment.utc().toISOString());
            },
            getIcon: function () {
                var icon = this.job_type.icon_code ? '<i class="fa fa-fw">&#x' + this.job_type.icon_code + '</i>' : '<i class="fa fa-fw">&#x' + scaleConfig.defaultIconCode + '</i>';
                return icon;
            }
        };

        // static methods, assigned to class
        RunningJob.build = function (data) {
            if (data) {
                return new RunningJob(
                    data.count,
                    data.longest_running,
                    data.job_type
                );
            }
            return new RunningJob();
        };

        RunningJob.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RunningJob.build)
                    .filter(Boolean);
            }
            return RunningJob.build(data);
        };

        return RunningJob;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('SystemFailure', ['scaleConfig', 'scaleService', function (scaleConfig, scaleService) {
        var SystemFailure = function (count, job_type_name, job_type_version, error_name, first_error, last_error) {
            this.count = count;
            this.job_type_name = job_type_name;
            this.job_type_version = job_type_version;
            this.error_name = error_name;
            this.first_error = first_error;
            this.last_error = last_error;
        };

        // public methods
        SystemFailure.prototype = {
            getDuration: function () {
                return scaleService.calculateDuration(this.first_error, this.last_error);
            },
            getIcon: function () {
                var configJobType = _.find(scaleConfig.jobTypes, 'title', this.job_type_name);
                if (configJobType) {
                    return configJobType.icon;
                }
                return scaleConfig.defaultIcon;
            }
        };

        // static methods, assigned to class
        SystemFailure.build = function (data) {
            if (data) {
                return new SystemFailure(
                    data.count,
                    data.job_type_name,
                    data.job_type_version,
                    data.error_name,
                    data.first_error,
                    data.last_error
                );
            }
            return new SystemFailure();
        };

        SystemFailure.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(SystemFailure.build)
                    .filter(Boolean);
            }
            return SystemFailure.build(data);
        };

        return SystemFailure;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('jobExecutionService', ['$http', '$q', '$resource', 'poller', 'scaleConfig', 'JobExecution', 'JobExecutionLog', function ($http, $q, $resource, poller, scaleConfig, JobExecution, JobExecutionLog) {

        var getJobExecutionsParams = function (page, page_size, started, ended, order, status, job_type_id, job_type_name, job_type_category, node_id) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order,
                status: status,
                job_type_id: job_type_id,
                job_type_name: job_type_name,
                job_type_category: job_type_category,
                node_id: node_id
            };
        };

        return {
            getJobExecutions: function (params) {
                params = params || getJobExecutionsParams();
                var d = $q.defer();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'job-executions/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = JobExecution.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobExecutionDetails: function (id) {
                var d = $q.defer();

                $http.get(scaleConfig.urls.apiPrefix + 'job-executions/' + id + '/').success(function (data) {
                    d.resolve(JobExecution.transformer(data));
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getLogOnce: function(execId){
                var d = $q.defer();

                $http.get(scaleConfig.urls.apiPrefix + 'job-executions/' + execId + '/logs/').success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getLog: function(execId){
                var url = url || scaleConfig.urls.apiPrefix + 'job-executions/' + execId + '/logs/';

                // Update view. Since a promise can only be resolved or rejected once but we want
                // to keep track of all requests, poller service uses the notifyCallback. By default
                // poller only gets notified of success responses.
                var jobExecutionLogResource = $resource(url);
                var jobExecutionLogPoller = poller.get(jobExecutionLogResource, {
                        delay: scaleConfig.pollIntervals.jobExecutionLog
                    });

                return jobExecutionLogPoller.promise.then(null, null, function (result) {
                    if(result.$resolved){
                        result.execution_log = JobExecutionLog.transformer(result);
                        if(result.execution_log.status === 'COMPLETED' || result.execution_log.status === 'FAILED'){
                            jobExecutionLogPoller.stop();
                        }
                        return result;
                    } else {
                        jobExecutionLogPoller.stop();
                        return result;
                    }

                });
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('jobService', ['$http', '$q', '$resource', 'scaleConfig', 'Job', 'JobDetails', 'RunningJob', 'poller', 'pollerFactory', function($http, $q, $resource, scaleConfig, Job, JobDetails, RunningJob, poller, pollerFactory) {

        var getJobsParams = function (page, page_size, started, ended, order, status, job_type_id, job_type_name, job_type_category, url) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order,
                status: status,
                job_type_id: job_type_id,
                job_type_name: job_type_name,
                job_type_category: job_type_category,
                url: url
            };
        };

        var getJobUpdateData = function (status) {
            return {
                status: status
            };
        };

        return {
            getJobs: function (params) {
                params = params || getJobsParams();
                params.url = params.url ? params.url : scaleConfig.urls.apiPrefix + 'jobs/';

                var jobsResource = $resource(params.url, params),
                    jobsPoller = pollerFactory.newPoller(jobsResource, scaleConfig.pollIntervals.jobs);

                return jobsPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        data.results = Job.transformer(data.results);
                    } else {
                        jobsPoller.stop();
                    }
                    return data;
                });
            },
            getJobsOnce: function (params) {
                params = params || getJobsParams();
                var d = $q.defer();

                $http({
                    url: params.url ? params.url : scaleConfig.urls.apiPrefix + 'jobs/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = Job.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            getJobCountsByStatus: function (hour) {
                hour = hour || 3;
                var d = $q.defer();

                $http.get(scaleConfig.urls.getJobCountsByStatus(hour)).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobDetail: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.urls.apiPrefix + 'jobs/' + id + '/').success(function (data) {
                    d.resolve(JobDetails.transformer(data));
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getRunningJobs: function (pageNumber, pageSize) {
                var params = {
                    pageNumber: pageNumber,
                    pageSize: pageSize
                };
                var runningJobsResource = $resource(scaleConfig.urls.apiPrefix + 'job-types/running/', params),
                    runningJobsPoller = pollerFactory.newPoller(runningJobsResource, scaleConfig.pollIntervals.runningJobs);

                return runningJobsPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        data.results = RunningJob.transformer(data.results);
                    } else {
                        runningJobsPoller.stop();
                    }
                    return data;
                });
            },
            getRunningJobsOnce: function (pageNumber, pageSize) {
                var params = {
                    pageNumber: pageNumber,
                    pageSize: pageSize
                };
                var d = $q.defer();

                $http.get(scaleConfig.urls.apiPrefix + 'job-types/running/', params).success(function (data) {
                    data.results = RunningJob.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            updateJob: function (id, data) {
                data = data || getJobUpdateData();
                var d = $q.defer();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'jobs/' + id + '/',
                    method: 'PATCH',
                    data: data
                }).success(function (result) {
                    d.resolve(result);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('jobTypeService', ['$http', '$q', '$resource', 'poller', 'pollerFactory', 'scaleConfig', 'jobService', 'JobType', 'JobTypeDetails', 'JobTypeStatus', function ($http, $q, $resource, poller, pollerFactory, scaleConfig, jobService, JobType, JobTypeDetails, JobTypeStatus) {
        /*var totalJobTypes = 5;

        var getTotalJobTypes = function () {
            return totalJobTypes;
        };

        var setTotalJobTypes = function () {
            totalJobTypes = Math.floor(Math.random() * (20 - 1 + 1)) + 1;
        };

        setInterval(function () {
            setTotalJobTypes();
        }, 3100);*/

        var getJobTypeParams = function (page, page_size, started, ended, name, category, order) {
            return {
                page: page,
                page_size: page_size ? page_size : 1000,
                started: started,
                ended: ended,
                name: name,
                category: category,
                order: order ? order : ['title', 'version']
            };
        };

        var getJobTypeStatusParams = function (page, page_size, started, ended) {
            return {
                page: page,
                page_size: page_size ? page_size : 1000,
                started: started,
                ended: ended
            };
        };

        return {
            getJobTypes: function (params) {
                params = params || getJobTypeParams();
                // var params = {
                //     order: order || ['name','version']
                // };

                var jobTypesResource = $resource(scaleConfig.urls.apiPrefix + 'job-types/', params),
                    jobTypesPoller = pollerFactory.newPoller(jobTypesResource, scaleConfig.pollIntervals.jobTypes);

                return jobTypesPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        /*var returnResult = {
                            $resolved: true,
                            job_types: []
                        };
                        for (var i = 1; i < getTotalJobTypes(); i++) {
                            returnResult.job_types.push(
                                {
                                    "is_system": true,
                                    "paused": null,
                                    "disk": 64.0,
                                    "id": i,
                                    "docker_image": null,
                                    "archived": null,
                                    "uses_docker": false,
                                    "priority": 10,
                                    "version": "1.0",
                                    "icon_code": scaleConfig.jobTypes[i - 1].code,
                                    "description": "Ingests a source file into a workspace",
                                    "mem": 64.0,
                                    "is_active": true,
                                    "cpus": 1.0,
                                    "last_modified": "2015-03-11T00:00:00Z",
                                    "max_tries": 3,
                                    "is_paused": false,
                                    "name": scaleConfig.jobTypes[i - 1].title,
                                    "created": "2015-03-11T00:00:00Z",
                                    "timeout": 1800,
                                    "is_long_running": false
                                }
                            )
                        }
                        result = returnResult;*/

                        data.results = JobType.transformer(data.results);
                        return data;
                    } else {
                        jobTypesPoller.stop();
                        return data;
                    }
                });
            },
            getJobTypesOnce: function (params) {
                params = params || getJobTypeParams();

                var d = $q.defer();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'job-types/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = JobType.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobTypeStatus: function (params) {
                params = params || getJobTypeStatusParams();

                var jobTypeStatusResource = $resource(scaleConfig.urls.apiPrefix + 'job-types/status/', params),
                    jobTypeStatusPoller = pollerFactory.newPoller(jobTypeStatusResource, scaleConfig.pollIntervals.jobTypeStatus);

                return jobTypeStatusPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        /*var returndata = {
                            $resolved: true,
                            job_type_stats: []
                        };
                        for (var i = 0; i < getTotalJobTypes(); i++) {
                            returndata.job_type_stats.push(
                                {
                                    "id": i,
                                    "icon_code": "",
                                    "name": "",
                                    "version": "",
                                    "num_completed": Math.floor(Math.random() * (20000 - 10000 + 1)) + 10000,
                                    "num_canceled": Math.floor(Math.random() * (100 - 20 + 1)) + 20,
                                    "num_error_DATA": Math.floor(Math.random() * (9000 - 20 + 1)) + 20,
                                    "num_error_SYSTEM": Math.floor(Math.random() * (9000 - 20 + 1)) + 20,
                                    "num_error_ALGORITHM": Math.floor(Math.random() * (9000 - 20 + 1)) + 20
                                }
                            )
                        }
                        data = returndata;*/

                        data.results = JobTypeStatus.transformer(data.results);
                    } else {
                        jobTypeStatusPoller.stop();
                    }
                    return data;
                });
            },
            getJobTypeStatusOnce: function (params) {
                var d = $q.defer();

                params = params || getJobTypeStatusParams();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'job-types/status/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = JobTypeStatus.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobTypeDetails: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.urls.apiPrefix + 'job-types/' + id + '/').success(function (data) {
                    d.resolve(JobTypeDetails.transformer(data));
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            updateJobType: function (data){
                var updatedJobType = function(data){
                    return {
                        error_mappings: data.error_mappings,
                        is_paused: data.is_paused
                    };
                };
                var updatedData = updatedJobType(data);
                var d = $q.defer();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'job-types/' + data.id + '/',
                    method: 'PATCH',
                    data: updatedData
                }).success(function (result) {
                    d.resolve(JobTypeDetails.transformer(result));
                }).error(function (error) {
                    d.reject(error);
                });                
                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('loadController', ['$scope', '$location', 'scaleService', 'stateService', 'navService', 'loadService', 'uiGridConstants', 'scaleConfig', 'subnavService', 'QueueStatus', 'gridFactory', function($scope, $location, scaleService, stateService, navService, loadService, uiGridConstants, scaleConfig, subnavService, QueueStatus, gridFactory) {
        var vm = this;
        
        vm.loading = true;
        vm.queueStatusError = null;
        vm.queueStatusErrorStatus = null;
        vm.totalQueued = 0;
        vm.subnavLinks = scaleConfig.subnavLinks.load;
        subnavService.setCurrentPath('load/queued');
        
        var jobsParams = stateService.getJobsParams();

        vm.getPage = function (pageNumber, pageSize) {
            vm.loading = true;
            loadService.getQueueStatus(pageNumber - 1, pageSize).then(function (data) {
                var newData = [];
                for (var i = 0; i < vm.gridOptions.paginationPageSize; i++) {
                    newData.push(data.jobs[i]);
                }
                vm.gridOptions.minRowsToShow = newData.length;
                vm.gridOptions.virtualizationThreshold = newData.length;
                vm.gridOptions.data = newData;
            }).catch(function (error) {
                vm.status = 'Unable to load queue status: ' + error.message;
                console.error(vm.status);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            vm.gridOptions = gridFactory.defaultGridOptions();
            vm.gridOptions.enableSorting = false;
            vm.gridOptions.columnDefs = [
                {
                    field: 'job_type.title',
                    displayName: 'Job Type',
                    enableFiltering: false,
                    cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }}</div>'
                },
                { field: 'job_type.version', displayName: 'Version', enableFiltering: false },
                { field: 'highest_priority', enableFiltering: false },
                {
                    field: 'longestQueued',
                    displayName: 'Duration of Longest Queued Job',
                    enableFiltering: false,
                    cellTemplate: '<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'
                },
                { field: 'count', enableFiltering: false }
            ];
            vm.gridOptions.data = [];
            vm.gridOptions.onRegisterApi = function (gridApi) {
                //set gridApi on scope
                vm.gridApi = gridApi;
                gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                    stateService.setJobsParams({job_type_id: row.entity.job_type.id, status: 'QUEUED', page: jobsParams.page, page_size: jobsParams.page_size, order: jobsParams.order});
                    $location.path('/jobs');
                });
                vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                    vm.getPage(currentPage, pageSize);
                });
            };


            loadService.getQueueStatus(0, vm.gridOptions.paginationPageSize).then(null, null, function (result) {
                if (result.$resolved) {
                    vm.gridOptions.minRowsToShow = result.results.length;
                    vm.gridOptions.virtualizationThreshold = result.results.length;
                    vm.gridOptions.data = result.results;
                    vm.gridOptions.totalItems = result.results.length;
                    vm.totalQueued = _.sum(result.results, 'count');
                    console.log('queue status updated');
                } else {
                    if (result.statusText && result.statusText !== '') {
                        vm.queueStatusErrorStatus = result.statusText;
                    }
                    vm.queueStatusError = 'Unable to retrieve queue status.';
                }
                vm.loading = false
            });

            navService.updateLocation('load');
        };
        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('loadDepthController', ['$scope', '$location', 'navService', 'scaleConfig', 'subnavService', function ($scope, $location, navService, scaleConfig, subnavService) {
        var vm = this;
        
        vm.subnavLinks = scaleConfig.subnavLinks.load;
        subnavService.setCurrentPath('load/depth');

        vm.loading = false;

        var initialize = function () {
            navService.updateLocation('load');
        };

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('queueRunningController', ['$scope', '$location', 'scaleService', 'stateService', 'navService', 'jobService', 'gridFactory', 'uiGridConstants', 'scaleConfig', 'subnavService', function($scope, $location, scaleService, stateService, navService, jobService, gridFactory, uiGridConstants, scaleConfig, subnavService) {
        var vm = this;
        
        vm.loading = true;
        vm.runningJobsError = null;
        vm.runningJobsErrorStatus = null;
        vm.totalRunning = 0;
        vm.subnavLinks = scaleConfig.subnavLinks.load;
        subnavService.setCurrentPath('load/running');

        var jobsParams = stateService.getJobsParams();

        vm.getPage = function (pageNumber, pageSize){
            vm.loading = true;
            jobService.getRunningJobsOnce(pageNumber - 1, pageSize).then(function (data) {
                var newData = [];
                for(var i = 0; i < vm.gridOptions.paginationPageSize; i++){
                    newData.push(data.results[i]);
                }
                vm.gridOptions.minRowsToShow = newData.length;
                vm.gridOptions.virtualizationThreshold = newData.length;
                vm.gridOptions.data = newData;
            }).catch(function (error) {
                vm.status = 'Unable to load queue running status: ' + error.message;
                console.error(vm.status);
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function () {
            vm.gridOptions = gridFactory.defaultGridOptions();
            vm.gridOptions.enableSorting = false;
            vm.gridOptions.columnDefs = [
                {
                    field: 'title',
                    displayName: 'Job Type',
                    enableFiltering: false,
                    cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.getIcon()"></span> {{ row.entity.job_type.title }}</div>'
                },
                {field: 'job_type.version', displayName: 'Version', enableFiltering: false},
                {field: 'count', displayName: 'Number of Jobs', enableFiltering: false},
                {
                    field: 'longestRunning',
                    displayName: 'Duration of Longest Running Job',
                    enableFiltering: false,
                    cellTemplate: '<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'
                }
            ];
            vm.gridOptions.data = [];
            vm.gridOptions.onRegisterApi = function (gridApi) {
                // set gridApi on scope
                vm.gridApi = gridApi;
                gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                    stateService.setJobsParams({job_type_id: row.entity.job_type.id, status: 'RUNNING', page: jobsParams.page, page_size: jobsParams.page_size, order: jobsParams.order});
                    $location.path('/jobs');
                });
                vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                    vm.getPage(currentPage, pageSize);
                });
            };

            jobService.getRunningJobs(0, vm.gridOptions.paginationPageSize).then(null, null, function (data) {
                if (data.$resolved) {
                    vm.gridOptions.minRowsToShow = data.results.length;
                    vm.gridOptions.virtualizationThreshold = data.results.length;
                    vm.gridOptions.data = data.results;
                    vm.gridOptions.totalItems = data.results.length;
                    vm.totalRunning = _.sum(data.results, 'count');
                    console.log('running jobs updated');
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.runningJobsErrorStatus = data.statusText;
                    }
                    vm.runningJobsError = 'Unable to retrieve running jobs.';
                }
                vm.loading = false;
            });
            navService.updateLocation('load');
        };
        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('QueueStatus', ['scaleConfig', 'scaleService', 'JobType', function (scaleConfig, scaleService, JobType) {
        var QueueStatus = function (job_type, count, longest_queued, highest_priority) {
            this.job_type = JobType.transformer(job_type);
            this.count = count;
            this.longest_queued = longest_queued;
            this.highest_priority = highest_priority;
        };

        // public methods
        QueueStatus.prototype = {
            getIcon: function () {
                return this.job_type.icon_code ? '<i class="fa">&#x' + this.job_type.icon_code + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            },
            getDuration: function () {
                return scaleService.calculateDuration(this.longest_queued, moment.utc().toISOString());
            }
        };

        // static methods, assigned to class
        QueueStatus.build = function (data) {
            if (data) {
                return new QueueStatus(
                    data.job_type,
                    data.count,
                    data.longest_queued,
                    data.highest_priority
                );
            }
            return new QueueStatus();
        };

        QueueStatus.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(QueueStatus.build);
            }
            return QueueStatus.build(data);
        };

        return QueueStatus;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('loadService', ['$http', '$q', '$resource', 'scaleConfig', 'poller', 'pollerFactory', 'QueueStatus', function($http, $q, $resource, scaleConfig, poller, pollerFactory, QueueStatus) {
        var getJobLoadParams = function (page, page_size, started, ended, order, status, job_type_id, job_type_name, job_type_category, url) {
            return {
                started: started,
                ended: ended,
                job_type_id: job_type_id,
                job_type_name: job_type_name,
                job_type_category: job_type_category,
                page_size: 1000,
                url: url
            };
        };

        var getRequeueJobsParams = function (started, ended, job_status, job_type_ids, job_type_names, job_type_categories, priority, url) {
            return {
                started: started,
                ended: ended,
                job_status: job_status,
                job_ids: job_ids,
                job_type_ids: job_type_ids,
                job_type_names: job_type_names,
                job_type_categories: job_type_categories,
                priority: priority,
                url: url
            };
        };

        return {
            getQueueStatus: function (pageNumber, pageSize) {
                var params = {
                    page_number: pageNumber,
                    page_size: pageSize
                };

                var queueStatusResource = $resource(scaleConfig.urls.apiPrefix + 'queue/status/', params),
                    queueStatusPoller = pollerFactory.newPoller(queueStatusResource, scaleConfig.pollIntervals.queueStatus);

                return queueStatusPoller.promise.then(null, null, function (result) {
                    if (result.$resolved) {
                        result.results = QueueStatus.transformer(result.results);
                    } else {
                        queueStatusPoller.stop();
                    }
                    return result;
                });
            },
            getQueueStatusOnce: function () {
                var d = $q.defer();

                $http.get(scaleConfig.urls.apiPrefix + 'queue/status/').success(function (data) {
                    data.results = QueueStatus.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            requeueJobs: function (params) {
                params = params || getRequeueJobsParams();
                params.url = params.url ? params.url : scaleConfig.urls.apiPrefix + 'queue/requeue-jobs/';

                var d = $q.defer();

                $http.post(params.url, params).success(function (result) {
                    d.resolve(result);
                }).error(function(error){
                    d.reject(error);
                });

                return d.promise;
            },
            getJobLoad: function (params) {
                params = params || getJobLoadParams();
                params.url = params.url ? params.url : scaleConfig.urls.apiPrefix + 'load/';

                var jobLoadResource = $resource(params.url, params),
                    jobLoadPoller = pollerFactory.newPoller(jobLoadResource, scaleConfig.pollIntervals.jobLoad);

                return jobLoadPoller.promise.then(null, null, function (data) {
                    if (!data.$resolved) {
                        jobLoadPoller.stop();
                    }
                    return data;
                });
            },
            getJobLoadOnce: function (params) {
                params = params || getJobLoadParams();
                var d = $q.defer();

                $http({
                    url: params.url ? params.url : scaleConfig.urls.apiPrefix + 'load/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('metricsController', ['$scope', '$location', 'scaleConfig', 'scaleService', 'navService', 'metricsService', 'moment', function ($scope, $location, scaleConfig, scaleService, navService, metricsService, moment) {
        var vm = this,
            chart = null,
            colArr = [],
            colNames = {},
            xArr = [],
            removeIds = [],
            yUnits = [];

        vm._ = _;
        vm.moment = moment;
        vm.loadingMetrics = false;
        vm.chartArr = [];
        vm.chartData = [];
        vm.chartStyle = '';
        vm.selectedDataType = {};
        vm.inputStartDate = moment.utc().subtract(1, 'M').toDate();
        vm.inputEndDate = moment.utc().toDate();
        vm.openInputStart = function ($event) {
            $event.stopPropagation();
            vm.inputStartOpened = true;
        };
        vm.inputStartOpened = false;
        vm.openInputEnd = function ($event) {
            $event.stopPropagation();
            vm.inputEndOpened = true;
        };
        vm.inputEndOpened = false;
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.dataTypeFilterText = '';
        vm.filtersApplied = [];
        vm.filteredChoices = [];
        vm.filteredChoicesOptions = [];
        vm.selectedMetrics = [];
        vm.columnGroupsOptions = [];
        vm.columns = [];
        vm.groups = [];
        vm.chartTitle = '';
        vm.chartDisplay = 'stacked';
        vm.stackedClass = 'btn-primary';
        vm.groupedClass = 'btn-default';
        vm.subchartClass = 'btn-primary';
        vm.subchartEnabled = false;
        vm.chartType = 'bar';
        vm.chartTypeDisplay = 'Bar';
        vm.barClass = 'btn-primary';
        vm.areaClass = 'btn-default';
        vm.lineClass = 'btn-default';
        vm.splineClass = 'btn-default';
        vm.scatterClass = 'btn-default';

        vm.getPlotDataParams = function (obj) {
            return {
                page: null,
                page_size: null,
                started: obj.started,
                ended: obj.ended,
                choice_id: obj.choice_id,
                column: obj.column,
                group: obj.group,
                dataType: obj.dataType.name
            };
        };

        vm.resetSelections = function () {
            vm.inputStartDate = moment.utc().subtract(1, 'M').toDate();
            vm.inputEndDate = moment.utc().toDate();
            vm.selectedDataType = {};
            vm.changeDataTypeSelection();
        };

        vm.updateChart = function () {
            vm.chartData = [];
            if (vm.chartArr.length === 0) {
                // nothing to show on chart
                chart.destroy();
                chart = null;
            } else {
                var callInit = _.after(vm.chartArr.length, function () {
                    // only initChart after this function has been called for all datasets in chartArr
                    vm.loadingMetrics = false;
                    vm.initChart();
                });

                _.forEach(vm.chartArr, function (obj) {
                    var params = vm.getPlotDataParams(obj);
                    metricsService.getPlotData(params).then(function (data) {
                    //metricsService.getGeneratedPlotData({query: obj, params: params}).then(function (data) {
                        vm.chartData.push({
                            query: obj,
                            results: data.results
                        });
                        callInit();
                    }).catch(function (error) {
                        vm.loadingMetrics = false;
                        console.log(error);
                        toastr['error'](error);
                    });
                });
            }
        };

        vm.addToChart = function () {
            vm.chartArr = []; // comment this out if allowing multiple adds
            vm.loadingMetrics = true;
            var filteredChoices = [],
                selectedColumns = [];
            // find the filter object associated with the chosen filter IDs
            _.forEach(vm.filtersApplied, function (id) {
                filteredChoices.push(_.find(vm.filteredChoices, { id: parseInt(id) }));
            });
            if (angular.isArray(vm.selectedMetrics)) {
                _.forEach(vm.selectedMetrics, function (metric) {
                    selectedColumns.push(_.find(vm.columns, { name: metric }));
                });
            } else {
                selectedColumns.push(_.find(vm.columns, { name: vm.selectedMetrics }));
            }
            vm.chartArr.push({
                started: vm.inputStartDate.toISOString(),
                ended: vm.inputEndDate.toISOString(),
                choice_id: vm.filtersApplied,
                column: _.pluck(selectedColumns, 'name'),
                group: null,
                dataType: vm.selectedDataType,
                filtersApplied: filteredChoices,
                selectedMetrics: selectedColumns
            });
            vm.updateChart();
            //vm.resetSelections();
        };

        vm.deleteFromChart = function (objToDelete) {
            _.remove(vm.chartArr, function (obj) {
                return JSON.stringify(obj) === JSON.stringify(objToDelete);
            });
            vm.updateChart();
        };

        vm.getFilterOptions = function (param) {
            return _.uniq(_.pluck(vm.filteredChoices, param));
        };

        vm.changeDataTypeSelection = function () {
            // reset options
            vm.filtersApplied = [];
            vm.selectedDataTypeOptions = [];
            vm.dataTypeFilterText = '';
            vm.selectedMetrics = [];
            vm.columns = [];

            if (!vm.selectedDataType.name || vm.selectedDataType.name === '') {
                vm.selectedDataType = {};
                vm.getDataTypes();
            } else {
                vm.getDataTypeOptions(vm.selectedDataType);
            }
        };

        vm.areFiltersApplied = function () {
            return vm.filtersApplied.length > 0;
        };

        vm.updateChartDisplay = function (display) {
            vm.chartDisplay = display;
            vm.stackedClass = display === 'stacked' ? 'btn-primary' : 'btn-default';
            vm.groupedClass = display === 'grouped' ? 'btn-primary' : 'btn-default';
            vm.initChart();
        };

        vm.updateChartType = function (type) {
            vm.chartType = type;
            vm.chartTypeDisplay = _.capitalize(type);
            vm.barClass = type === 'bar' ? 'btn-primary' : 'btn-default';
            vm.areaClass = type === 'area' ? 'btn-primary' : 'btn-default';
            vm.lineClass = type === 'line' ? 'btn-primary' : 'btn-default';
            vm.splineClass = type === 'spline' ? 'btn-primary' : 'btn-default';
            vm.scatterClass = type === 'scatter' ? 'btn-primary' : 'btn-default';
            vm.initChart();
        };

        vm.toggleSubchart = function () {
            vm.subchartEnabled = !vm.subchartEnabled;
            if (vm.subchartEnabled) {
                vm.subchartClass = 'btn-primary';
            } else {
                vm.subchartClass = 'btn-default';
            }
        };

        vm.initialize = function () {
            navService.updateLocation('metrics');
            vm.getDataTypes();
        };

        vm.getDataTypes = function () {
            metricsService.getDataTypes().then(function (result) {
                vm.availableDataTypes = result.results;
            }).catch(function (error) {
                console.log(error);
                toastr['error'](error);
            });
        };

        vm.getDataType = function (id) {
            metricsService.getDataTypeMetrics(id).then(function (result) {
                vm.selectedDataTypeAvailableMetrics = result.metrics;
            }).catch(function (error) {
                console.log(error);
            });
        };

        vm.getDataTypeOptions = function (dataType) {
            metricsService.getDataTypeOptions(dataType.name).then(function (result) {
                vm.selectedDataTypeOptions = result;
                _.forEach(result.filters, function (filter) {
                    vm.dataTypeFilterText = vm.dataTypeFilterText.length === 0 ? _.capitalize(filter.param) : vm.dataTypeFilterText + ', ' + _.capitalize(filter.param);
                });
                vm.filteredChoices = _.sortByOrder(result.choices, ['title','version'], ['asc','asc']);
                // format filteredChoices for use with multiselect directive
                var filteredChoicesOptions = [];
                _.forEach(vm.filteredChoices, function (choice) {
                    filteredChoicesOptions.push({
                        label: choice.version ? choice.title + ' ' + choice.version : choice.title,
                        title: choice.version ? choice.title + ' ' + choice.version : choice.title,
                        value: choice.id
                    });
                });
                vm.filteredChoicesOptions = filteredChoicesOptions;
                vm.columns = _.sortByOrder(result.columns, ['title'], ['asc']);
                vm.groups = result.groups;

                // create an array of objects containing grouped columns
                var columnGroupsOptions = [],
                    columnGroups = _.pairs(_.groupBy(result.columns, 'group'));
                _.forEach(columnGroups, function (group) {
                    var option = {
                        label: _.find(vm.groups, { name: group[0] }).title,
                        children: []
                    };
                    _.forEach(group[1], function (column) {
                        var child = {
                            label: column.title,
                            title: column.title,
                            value: column.name
                        };
                        option.children.push(child);
                    });
                    columnGroupsOptions.push(option);
                });
                columnGroupsOptions.unshift({
                    label: 'None Selected',
                    title: 'None Selected',
                    value: ''
                });
                vm.columnGroupsOptions = columnGroupsOptions;
            }).catch(function (error){
                console.log(error);
                toastr['error'](error);
            });
        };

        vm.initialize();

        $scope.$watch('vm.inputEndDate', function (value) {
            console.log(value)
        });

        // set up chart
        vm.initChart = function () {
            // mark any existing data for removal
            // compare currCols (columns currently in the chart) with displayCols (columns to display)
            removeIds = [];
            var currCols = [],
                displayCols = [];
            _.forEach(colArr, function (col, idx) {
                if (idx > 0) {
                    currCols.push(col[0]);
                }
            });
            _.forEach(vm.chartData, function (d) {
                displayCols = displayCols.concat(_.pluck(d.query.filtersApplied, 'name'));
            });
            // determine the exact differences between currCols and displayCols
            // if none are found, then removeIds stays empty
            _.forEach(currCols, function (currCol) {
                var displayCol = _.find(displayCols, function (dCol) {
                    return dCol === currCol;
                });
                if (!displayCol) {
                    removeIds.push(currCol);
                }
            });

            // init with new data
            colArr = [];
            xArr = [];
            colNames = {};

            // create xArr
            var numDays = moment.utc(vm.inputEndDate).endOf('d').diff(moment.utc(vm.inputStartDate.toISOString()).startOf('d'), 'd') + 1; // add 1 to include starting day in count
            for (var i = 0; i < numDays; i++) {
                xArr.push(moment.utc(vm.inputStartDate.toISOString()).startOf('d').add(i, 'd').toDate());
            }

            // iterate over datatypes and add values to colArr
            _.forEach(vm.chartData, function (data) {
                var valueArr = [],
                    query = data.query,
                    queryFilter = {},
                    queryDates = [];

                yUnits = _.pluck(query.selectedMetrics, 'units');

                if (query.filtersApplied.length > 0) {
                    // filters were applied, so build data source accordingly
                    _.forEach(data.results, function (result) {
                        if (result.values.length > 0) {
                            // values for all filters are returned in one array of arrays,
                            // so group results by id to isolate filter values
                            var groupedResult = _.groupBy(result.values, 'id'),
                                resultObj = {},
                                filterIds = _.pluck(query.filtersApplied, 'id');
                            // try to get each filter id from groupedResult.
                            // if it's undefined, an empty array will be returned
                            // this allows a zeroed array to appear in the chart,
                            // since we want to include all filters selected by the user
                            // regardless of value
                            if (filterIds.length > 1) {
                                // when more than one filter is requested, then an id
                                // value is present within data.results
                                _.forEach(filterIds, function (id) {
                                    resultObj[id] = _.get(groupedResult, id, []);
                                });
                            } else {
                                // when one filter is requested, no id value is included
                                // in data.results, so build resultObj with the other
                                // info we have
                                resultObj[query.choice_id[0]] = _.pairs(groupedResult)[0][1];
                            }
                            _.forEach(_.pairs(resultObj), function (d) {
                                valueArr = [];
                                // d[0] will be choice id, d[1] will be values
                                // if only one filter was selected, d[0] will return as string 'undefined' since no id is included in this case
                                queryFilter = d[0] === 'undefined' ? query.filtersApplied[0] : _.find(query.filtersApplied, {id: parseInt(d[0])});
                                queryDates = d[1];

                                // add result values to valueArr
                                _.forEach(xArr, function (xDate) {
                                    var valueObj = _.find(queryDates, function (qDate) {
                                        return moment.utc(qDate.date).isSame(xDate, 'day');
                                    });
                                    // push 0 if data for xDate is not present in queryDates
                                    valueArr.push(valueObj ? valueObj.value : 0);
                                });

                                // prepend valueArr with filter title, and push onto colArr
                                valueArr.unshift(queryFilter.name + queryFilter.id);
                                colNames[queryFilter.name + queryFilter.id] = queryFilter.version ? queryFilter.title + ' ' + queryFilter.version : queryFilter.title;
                                colArr.push(valueArr);
                            });
                        }
                    });
                } else {
                    // no filters were applied, so show aggregate statistics
                    _.forEach(data.results, function (result) {
                        // add result values to valueArr
                        _.forEach(xArr, function (xDate) {
                            var valueObj = _.find(result.values, function (qDate) {
                                return moment.utc(qDate.date).isSame(xDate, 'day');
                            });
                            // push 0 if data for xDate is not present in result.values
                            valueArr.push(valueObj ? valueObj.value : 0);
                        });

                        // prepend valueArr with filter title, and push onto colArr
                        var columnLabel = result.column.title + ' for all ' + query.dataType.title;
                        valueArr.unshift(columnLabel);
                        colNames['aggregate'] = columnLabel;
                        colArr.push(valueArr);
                    });
                }
            });

            // inform the user if the metrics they selected are empty
            if (_.sum(_.flatten(colArr)) === 0) {
                toastr['info']('There is no data to display.');
            }

            // prepend xArr with an 'x' label and add to colArr
            xArr.unshift('x');
            colArr.unshift(xArr);

            var types = {},
                type = {},
                groups = [];

            _.forEach(colArr, function (col) {
                type = {};
                if (col[0] !== 'x') {
                    type[col[0]] = vm.chartType;
                    if (vm.chartDisplay === 'stacked') {
                        groups.push(col[0]);
                    }
                }
                angular.extend(types, type);
            });

            if (chart) {
                // chart already exists, so update values
                chart.groups([groups]);
                chart.data.names(colNames);
                chart.axis.labels({
                    y: _.capitalize(yUnits[0])
                });
                chart.load({
                    columns: colArr,
                    types: types,
                    unload: removeIds
                });
            } else {
                // no chart yet, so set it up
                chart = c3.generate({
                    bindto: '#metrics',
                    data: {
                        x: 'x',
                        columns: colArr,
                        types: types,
                        groups: [groups],
                        names: colNames
                    },
                    subchart: {
                        show: vm.subchartEnabled
                    },
                    transition: {
                        duration: 700
                    },
                    color: {
                        pattern: scaleConfig.colors.patternD320
                    },
                    axis: {
                        type: 'timeseries',
                        x: {
                            tick: {
                                format: function (d) {
                                    return moment.utc(d).toISOString();
                                }
                            },
                            label: {
                                text: 'Dates',
                                position: 'outer-center'
                            }
                        },
                        y: {
                            tick: {
                                format: function (d) {
                                    if (yUnits[0] === 'seconds') {
                                        return scaleService.calculateDuration(moment.utc().startOf('d'), moment.utc().startOf('d').add(d, 's'));
                                    } else if (yUnits[0] === 'bytes') {
                                        return scaleService.calculateFileSizeFromBytes(d, 1);
                                    }
                                    return d;
                                }
                            },
                            label: {
                                text: _.capitalize(yUnits[0]),
                                position: 'outer-middle'
                            }
                        }
                    }
                });
            }
        };

        // set chart height
        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                chartMaxHeight = viewport.height - offset;

            vm.chartStyle = 'height: ' + chartMaxHeight + 'px; max-height: ' + chartMaxHeight + 'px;';
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('metricsService', ['$http', '$q', '$resource', 'scaleConfig', function ($http, $q, $resource, scaleConfig) {
        var getPlotDataParams = function (page, page_size, started, ended, choice_id, column, group, dataType) {
            console.log(choice_id);
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                choice_id: choice_id,
                column: column,
                group: group,
                dataType: dataType
            };
        };

        return {
            getDataTypes: function () {
                var d = $q.defer();
                $http.get(scaleConfig.urls.apiPrefix + 'metrics/').success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getDataTypeMetrics: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.urls.apiPrefix + 'metrics/' + id + '/').success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getDataTypeOptions: function (name) {
                var d = $q.defer();
                var url = scaleConfig.urls.apiPrefix + 'metrics/' + name + '/';
                $http.get(url).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getPlotData: function (params) {
                var params = params || getPlotDataParams(),
                    d = $q.defer();

                $http({
                    method: 'GET',
                    url: scaleConfig.urls.apiPrefix + 'metrics/' + params.dataType + '/plot-data/',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            getGeneratedPlotData: function (obj) {
                var d = $q.defer();

                var returnObj = {
                    count: 28,
                    next: null,
                    previous: null,
                    results: []
                };

                var numDays = moment.utc(obj.params.ended).diff(moment.utc(obj.params.started), 'd') + 1;

                _.forEach(obj.query.selectedMetrics, function (metric) {
                    var returnResult = {
                        column: metric,
                        min_x: moment.utc(obj.params.started).format('YYYY-MM-DD'),
                        max_x: moment.utc(obj.params.ended).format('YYYY-MM-DD'),
                        min_y: 1,
                        max_y: 100,
                        values: []
                    };

                    for (var i = 0; i < numDays; i++) {
                        if (obj.query.filtersApplied.length > 1) {
                            _.forEach(obj.query.filtersApplied, function (filter) {
                                returnResult.values.push({
                                    date: moment.utc(obj.params.started).add(i, 'd').format('YYYY-MM-DD'),
                                    value: Math.floor(Math.random() * (1000 - 1 + 1)) + 1,
                                    id: filter.id
                                });
                            });
                        } else {
                            returnResult.values.push({
                                date: moment.utc(obj.params.started).add(i, 'd').format('YYYY-MM-DD'),
                                value: Math.floor(Math.random() * (1000 - 1 + 1)) + 1
                            });
                        }
                    }
                    returnObj.results.push(returnResult);
                });

                d.resolve(returnObj);

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('navController', ['$scope', '$location', '$window', 'scaleConfig', 'scaleService', 'stateService', 'navService', function($scope, $location, $window, scaleConfig, scaleService, stateService, navService) {
        document.getElementsByTagName('body')[0].style.backgroundColor = scaleConfig.colors.nav_bg;

        var vm = this;

        vm.version = '';
        vm.activePage = 'overview';
        vm.docsUrl = scaleConfig.urls.documentation;

        vm.goto = function(loc) {
            $location.search('');
            $location.path(loc);
        };

        var locationUpdated = function() {
            vm.activePage = navService.location;
        };

        var initialize = function() {
            navService.registerObserver(locationUpdated);

            scaleService.getVersion().then(function (data) {
                vm.version = data.version;
                stateService.setVersion(data.version);
            });
        };
        initialize();
    }]);
})();

(function () {
    'use strict';
    /**
     * See: http://stackoverflow.com/questions/12576798/angularjs-how-to-watch-service-variables/17558885#17558885
     * Doing things this way so that ssNavbarController can get notified
     * when the location changes. Then, our controllers just need to call into
     * this service to updateLocation.
     *
     * The only thing I don't like about this is that the individual
     * controllers have to call in and tell the ssNavigationService what
     * page they are showing.
     */
    angular.module('scaleApp').service('navService', ['$location', function ($location) {

        this.location = 'overview'; // where the app starts

        var observers = [];

        this.registerObserver = function(callback) {
            observers.push(callback);
        };

        this.notifyObservers = function() {
            angular.forEach(observers, function(observer) {
                observer();
            });
        };

        this.updateLocation = function(locationIn) {
            this.location = locationIn;
            this.notifyObservers();
        };

    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('subnavService', ['$http', 'scaleConfig', function ($http, scaleConfig) {
        var currentPath = '';

        this.setCurrentPath = function (path) {
            currentPath = path;
        };

        this.getCurrentPath = function () {
            return currentPath;
        };
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('nodeDetailsController', ['$scope', '$location', '$routeParams', '$timeout', 'navService', 'nodeService', 'scaleService', function($scope, $location, $routeParams, $timeout, navService, nodeService, scaleService) {
        var vm = this;
        
        vm.loading = true;
        vm.nodeId = $routeParams.id;
        vm.scaleService = scaleService;

        var getNodeDetails = function (nodeId) {
            nodeService.getNode(nodeId).then( function (data) {
                vm.node = data;
            }).finally(function () {
                vm.loading = false;
            });
        };

        var initialize = function() {
            navService.updateLocation('nodes');
            getNodeDetails(vm.nodeId);
        };

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('nodesController', ['$scope', '$location', '$timeout', '$uibModal', 'navService', 'nodeService', 'stateService', 'userService', 'gridFactory', 'toastr', function($scope, $location, $timeout, $uibModal, navService, nodeService, stateService, userService, gridFactory, toastr) {
        var vm = this;

        vm.nodesParams = stateService.getNodesParams();

        vm.stateService = stateService;
        vm.nodeStatus = [];
        vm.loading = true;
        vm.loadingStatus = true;
        vm.readonly = true;
        vm.nodesError = null;
        vm.nodesErrorStatus = null;
        vm.statusError = null;
        vm.statusErrorStatus = null;
        vm.actionClicked = false;
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.paginationCurrentPage = vm.nodesParams.page || 1;
        vm.gridOptions.paginationPageSize = vm.nodesParams.page_size || vm.gridOptions.paginationPageSize;
        vm.gridOptions.data = [];

        $scope.pauseReason = '';

        var filteredByOrder = vm.nodesParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'hostname',
                displayName: 'Hostname',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents"><div class="pull-right" ng-show="!grid.appScope.vm.readonly && grid.appScope.vm.nodeStatus.length > 0"><button class="btn btn-xs btn-default" ng-click="grid.appScope.vm.pauseNode(row.entity.id)"><i class="fa" ng-class="{ \'fa-pause\': !row.entity.is_paused && !row.entity.is_paused_errors, \'fa-play\': row.entity.is_paused || row.entity.is_paused_errors }"></i></button></div> {{ row.entity.hostname }}</div>'
            },
            {
                field: 'is_online',
                displayName: 'Status',
                enableFiltering: false,
                enableSorting: false,
                cellTemplate: '<div class="ui-grid-cell-contents" ng-show="row.entity.status"><span ng-bind-html="row.entity.statusLabel"></span></div>'
            },
            {
                field: 'id',
                displayName: 'Statistics',
                enableFiltering: false,
                enableSorting: false,
                cellTemplate: '<div class="ui-grid-cell-contents" ng-show="row.entity.status">{{ row.entity.status.getCellError() }} / {{ row.entity.status.getCellTotal() }}</div>'
            },
            {
                field: 'id',
                displayName: 'Current Jobs',
                enableFiltering: false,
                enableSorting: false,
                cellTemplate: '<div class="ui-grid-cell-contents" ng-show="row.entity.status"><span ng-bind-html="row.entity.status.getCellJobs()"></span></div>'
            }
        ];

        vm.gridOptions.columnDefs = vm.colDefs;

        vm.pauseNode = function (id) {
            $scope.pauseReason = '';
            vm.actionClicked = true;
            var nodeStatus = _.find(vm.nodeStatus, { node: { id: id } });

            $scope.updateReason = function (value) {
                $scope.pauseReason = value;
            };

            var pauseResume = function () {
                nodeStatus.pauseResumeCell($scope.pauseReason).then(function (result) {
                    var node = _.find(vm.gridOptions.data, { id: result.id });
                    node.is_paused = result.is_paused;
                    if (node.isPaused()) {
                        toastr.info(node.hostname + ' Paused');
                    } else {
                        toastr.info(node.hostname + ' Resumed');
                    }
                });
            };

            // only prompt for reason when pausing (not resuming)
            if (!nodeStatus.node.is_paused && !nodeStatus.node.is_paused_errors) {
                var modalInstance = $uibModal.open({
                    animation: true,
                    templateUrl: 'pauseDialog.html',
                    scope: $scope
                });

                modalInstance.result.then(function () {
                    pauseResume();
                });
            } else {
                pauseResume();
            }
        };

        vm.getStatusLabel = function (status) {
            var online = status.is_online ? '<span class="label label-online">Online</span>' : '<span class="label label-offline">Offline</span>';
            var paused = status.node.is_paused ? '<span class="label label-paused">Paused</span>' : '';
            var pausedErrors = status.node.is_paused_errors ? '<span class="label label-paused-errors">Paused with Errors</span>' : '';
            return online + ' ' + paused + ' ' + pausedErrors;
        };

        vm.filterResults = function () {
            stateService.setNodesParams(vm.nodesParams);
            vm.loading = true;
            getNodes();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.nodesParams);
        };

        vm.updateNodeOrder = function (sortArr) {
            vm.nodesParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                if (vm.actionClicked) {
                    vm.actionClicked = false;
                } else {
                    $location.search({});
                    $location.path('/nodes/' + row.entity.id);
                }
            });
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.nodesParams.page = currentPage;
                vm.nodesParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setNodesColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateNodeOrder(sortArr);
            });
        };

        var getNodes = function () {
            nodeService.getNodes(vm.nodesParams).then(null, null, function (data) {
                if (data.$resolved) {
                    vm.nodesError = null;
                    vm.gridOptions.totalItems = data.count;
                    vm.gridOptions.minRowsToShow = data.results.length;
                    vm.gridOptions.virtualizationThreshold = data.results.length;
                    vm.gridOptions.data = data.results;
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.nodesErrorStatus = data.statusText;
                    }
                    vm.nodesError = 'Unable to retrieve nodes.';
                }
                vm.loading = false;
            })
        };

        var getNodeStatus = function () {
            nodeService.getNodeStatus(null, null, 'PT3H', null).then(null, null, function (data) {
                if (data.$resolved) {
                    vm.statusError = null;
                    vm.nodeStatus = data.results;
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.statusErrorStatus = data.statusText;
                    }
                    vm.statusError = 'Unable to retrieve node status.';
                }
                vm.loadingStatus = false;
            });
        };

        var initialize = function () {
            stateService.setNodesParams(vm.nodesParams);
            vm.updateColDefs();
            var user = userService.getUserCreds();
            vm.readonly = !(user && user.is_admin);
            getNodes();
            getNodeStatus();
            navService.updateLocation('nodes');
        };

        initialize();

        $scope.$watchCollection('vm.stateService.getNodesColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getNodesParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.nodesParams = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.nodeStatus', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            _.forEach(vm.gridOptions.data, function (node) {
                var status = _.find(newValue, { node: { id: node.id } });
                if (status) {
                    node.status = status;
                    node.statusLabel = vm.getStatusLabel(status);
                }
            });
        });
    }]);
})();
(function (){
    'use strict';

    angular.module('scaleApp').controller('aisNodeHealthController', ['$rootScope', '$scope', function ($rootScope, $scope) {
        var vm = this;
        
        vm.nodes = [];
        vm.nodesOffline = 0;
        vm.nodesPausedErrors = 0;
        vm.nodesPaused = 0;
        vm.nodesOfflineAndPaused = 0;
        vm.nodesOfflineAndPausedErrors = 0;
        vm.healthyNodes = 0;
        vm.totalNodes = 0;

        var getNodeStatus = function () {
            vm.totalNodes = vm.nodes.length;

            var nodesOffline = [],
                nodesPausedErrors = [],
                nodesPaused = [],
                nodesOfflineAndPausedErrors = [],
                nodesOfflineAndPaused = [];

            _.forEach(vm.nodes, function (n) {
                if (!n.is_online) {
                    // node is offline
                    if (n.node.is_paused_errors) {
                        nodesOfflineAndPausedErrors.push(n);
                    } else if (n.node.is_paused) {
                        nodesOfflineAndPaused.push(n);
                    } else {
                        nodesOffline.push(n);
                    }
                } else {
                    // node is online
                    if (n.node.is_paused_errors) {
                        nodesPausedErrors.push(n);
                    } else if (n.node.is_paused) {
                        nodesPaused.push(n);
                    }
                }
            });

            vm.nodesOffline = nodesOffline.length;
            vm.nodesPausedErrors = nodesPausedErrors.length;
            vm.nodesPaused = nodesPaused.length;
            vm.nodesOfflineAndPausedErrors = nodesOfflineAndPausedErrors.length;
            vm.nodesOfflineAndPaused = nodesOfflineAndPaused.length;

            // add the length of nodes both offline and paused to produce an accurate healthy count
            vm.healthyNodes = vm.totalNodes - vm.nodesOffline - vm.nodesPausedErrors - vm.nodesPaused - vm.nodesOfflineAndPaused - vm.nodesOfflineAndPausedErrors;

            var donutData = [];

            // determine percentage of healthy nodes, and breakdown of why nodes are unhealthy
            var gaugeData = vm.totalNodes > 0 ? ((vm.healthyNodes / vm.totalNodes) * 100).toFixed(2) : 0.00;

            if (vm.nodesOffline > 0) {
                donutData.push({
                    status: 'Offline',
                    count: vm.nodesOffline
                });
            }

            if (vm.nodesPausedErrors > 0) {
                donutData.push({
                    status: 'High Failure Rate',
                    count: vm.nodesPausedErrors
                });
            }

            if (vm.nodesPaused > 0) {
                donutData.push({
                    status: 'Paused',
                    count: vm.nodesPaused
                });
            }

            if (vm.nodesOfflineAndPaused) {
                donutData.push({
                    status: 'Offline and Paused',
                    count: vm.nodesOfflineAndPaused
                });
            }

            if (vm.nodesOfflineAndPausedErrors) {
                donutData.push({
                    status: 'Offline and Paused due to Errors',
                    count: vm.nodesOfflineAndPausedErrors
                });
            }

            vm.nodeHealth = {
                gaugeData: gaugeData,
                donutData: donutData
            };
        };

        $scope.$watch('data', function (newValue) {
            vm.nodes = newValue;
            getNodeStatus();
        });
    }]).directive('aisNodeHealth', function(){
        /**
         * Usage: <ais-node-health />
         **/
         return {
             controller: 'aisNodeHealthController',
             controllerAs: 'vm',
             templateUrl: 'modules/nodes/directives/nodeHealthTemplate.html',
             restrict: 'E',
             scope: {
                 data: '=',
                 duration: '=',
                 showDescription: '=',
                 loading: '='
             }
         };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('nodeStatusGridController', ['$scope', '$location', function ($scope, $location) {
        var vm = this,
            cellSize = $scope.cellSize || '10px';

        vm.nodes = [];
        vm.hours = $scope.hours || 3;
        vm.cellStyle = {
            width: cellSize,
            height: cellSize
        };

        vm.getNodeClass = function (node) {
            console.log('getNodeClass');
            if (!node.is_online) {
                return 'offline';
            } else {
                if (node.node.is_paused) {
                    return 'is-paused';
                } else if (node.node.is_paused_errors) {
                    return 'is-paused-errors';
                }
            }
            return 'online';
        };

        vm.viewNode = function (id) {
            $location.path('nodes/' + id);
        };

        $scope.$watch('data', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            _.forEach(newValue, function (node) {
                if (!node.is_online) {
                    node.class = 'offline';
                } else {
                    if (node.node.is_paused) {
                        node.class = 'is-paused';
                    } else if (node.node.is_paused_errors) {
                        node.class = 'is-paused-errors';
                    } else {
                        node.class = 'online';
                    }
                }
            });
            vm.nodes = newValue;
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').directive('aisNodeStatusGrid', function () {
        return {
            controller: 'nodeStatusGridController',
            controllerAs: 'vm',
            templateUrl: 'modules/nodes/directives/nodeStatusGridTemplate.html',
            restrict: 'E',
            scope: {
                data: '=',
                hours: '=',
                cellSize: '@'
            }
        };
    });
})();
(function(){
    'use strict';

    angular.module('scaleApp').factory('Node', ['NodeResources', 'scaleService', function (NodeResources, scaleService) {
        var Node = function (id, hostname, port, slave_id, is_paused, is_paused_errors, is_active, archived, created, last_offer, last_modified, job_exes_running, resources) {
            this.id = id;
            this.hostname = hostname;
            this.port = port;
            this.slave_id = slave_id;
            this.is_paused = is_paused;
            this.is_paused_errors = is_paused_errors;
            this.is_active = is_active;
            this.archived = archived;
            this.created = created;
            this.last_offer = last_offer;
            this.last_modified = last_modified;
            this.job_exes_running = job_exes_running;
            this.resources = NodeResources.transformer(resources);
        };

        //public methods
        Node.prototype = {
            toString: function () {
                return 'Node';
            },
            getDuration: function () {
                return scaleService.calculateDuration(this.created, this.last_modified);
            },
            getCellText: function () {
                // this is only used reveal = true on gridChart directive
                return this.hostname;
            },
            getCellTitle: function () {
                return this.hostname;
            },
            isPaused: function () {
                return !(!this.is_paused && !this.is_paused_errors);
            }
        };

        // static methods, assigned to class
        Node.build = function (data) {
            if (data) {
                return new Node(
                    data.id,
                    data.hostname,
                    data.port,
                    data.slave_id,
                    data.is_paused,
                    data.is_paused_errors,
                    data.is_active,
                    data.archived,
                    data.created,
                    data.last_offer,
                    data.last_modified,
                    data.job_exes_running,
                    data.resources
                );
            }
            return new Node();
        };

        Node.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Node.build);
            }
            return Node.build(data);
        };

        return Node;
    }]);
})();

(function(){
    'use strict';

    angular.module('scaleApp').factory('NodeResources', function(){
        var NodeResources = function (total, scheduled, used) {
            this.total = total;
            this.scheduled = scheduled;
            this.used = used;
        };

        //public methods
        NodeResources.prototype = {
            // getDuration: function() {
                //return scaleService.calculateDuration(this.created, this.last_modified);
            // }
        };

        // static methods, assigned to class
        NodeResources.build = function (data) {
            if (data) {
                return new NodeResources(
                    data.total,
                    data.scheduled,
                    data.used
                );
            }
            return new NodeResources();
        };

        NodeResources.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(NodeResources.build)
                    .filter(Boolean);
            }
            return NodeResources.build(data);
        };

        return NodeResources;
    });
})();

(function() {
    'use strict';

    angular.module('scaleApp').factory('NodeStatus', ['scaleConfig', 'nodeUpdateService', 'Node', 'JobExecution', function (scaleConfig, nodeUpdateService, Node, JobExecution) {
        var NodeStatus = function (node, is_online, job_exe_counts, job_exes_running) {
            this.node = Node.transformer(node);
            this.is_online = is_online;
            this.job_exe_counts = job_exe_counts;
            this.job_exes_running = JobExecution.transformer(job_exes_running);
        };

        //public methods
        NodeStatus.prototype = {
            toString: function () {
                return 'NodeStatus';
            },
            getCompleted: function () {
                var completed = _.find(this.job_exe_counts, 'status', 'COMPLETED');
                return completed ? completed.count : 0;
            },
            getFailed: function () {
                var failed = _.find(this.job_exe_counts, 'status', 'FAILED');
                return failed ? failed.count : 0;
            },
            getCellFill: function () {
                var color = '';
                if (this.is_online) {
                    if (this.node.is_paused_errors) {
                        color = scaleConfig.colors.chart_orange;
                    } else if (this.node.is_paused) {
                        color = scaleConfig.colors.chart_yellow;
                    } else {
                        color = scaleConfig.colors.chart_green;
                    }
                } else {
                    color = scaleConfig.colors.chart_red;
                }
                return color;
            },
            getRunning: function () {
                return { count: 0 };
            },
            getCellError: function () {
                return 'Failed: ' + this.getFailed();
            },
            getCellTotal: function () {
                return 'Completed: ' + this.getCompleted();
            },
            getCellStatus: function () {
                if (this.is_online) {
                    if (this.node.is_paused_errors) {
                        return 'High Failure Rate';
                    } else if (this.node.is_paused) {
                        return 'Paused';
                    } else {
                        return 'Online';
                    }
                } else {
                    return 'Offline';
                }
            },
            getCellJobs: function () {
                var text = '';
                _.forEach(this.job_exes_running, function (jobExecution) {
                    text = jobExecution.job.job_type.icon_code ?
                    text + ' ' + '<i class="fa fa-fw">&#x' + jobExecution.job.job_type.icon_code + '</i>' :
                    text + ' ' + '<i class="fa fa-fw">&#x' + scaleConfig.defaultIconCode + '</i>';
                });
                return text;
            },
            getCellPauseResume: function () {
                return this.node.is_paused ? '&#xf04b;' : '&#xf04c;';
            },
            pauseResumeCell: function (pause_reason) {
                var updateData = {
                    pause_reason: pause_reason || '',
                    is_paused: !this.node.is_paused
                };
                return nodeUpdateService.updateNode(this.node.id, updateData).then(function (result) {
                    return Node.transformer(result);
                }).catch(function (error) {
                    console.log(error);
                });
            }
        };

        // static methods, assigned to class
        NodeStatus.build = function (data) {
            if (data) {
                return new NodeStatus(
                    data.node,
                    data.is_online,
                    data.job_exe_counts,
                    data.job_exes_running
                );
            }
            return new NodeStatus();
        };

        NodeStatus.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(NodeStatus.build);
            }
            return NodeStatus.build(data);
        };

        return NodeStatus;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('nodeService', ['$http', '$q', '$resource', 'scaleConfig', 'Node', 'NodeStatus', 'poller', 'pollerFactory', function ($http, $q, $resource, scaleConfig, Node, NodeStatus, poller, pollerFactory) {
        var getNodesParams = function (page, page_size, started, ended, order, include_inactive, url) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order,
                include_inactive: include_inactive,
                url: url
            };
        };

        var getNodeStatusParams = function (page, page_size, started, ended) {
            var params = {};

            if(page) { params.page = page; }
            if(page_size) { params.page_size = page_size; }
            if(started) { params.started = started; }
            if(ended) { params.ended = ended; }

            return params;
        };

        return {
            getNodes: function (params) {
                params = params || getNodesParams();
                params.url = params.url ? params.url : scaleConfig.urls.apiPrefix + 'nodes/';

                var nodesResource = $resource(params.url, params),
                    nodesPoller = pollerFactory.newPoller(nodesResource, scaleConfig.pollIntervals.nodes);

                return nodesPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        data.results = Node.transformer(data.results);
                    } else {
                        nodesPoller.stop();
                    }
                    return data;
                });
            },
            getNodesOnce: function (params) {
                params = params || getNodesParams();
                var d = $q.defer();

                $http({
                    url: params.url ? params.url : scaleConfig.urls.apiPrefix + 'nodes/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    var returnData = Node.transformer(data.nodes);
                    d.resolve(returnData);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            getNode: function (slaveId) {
                var d = $q.defer();
                $http.get(scaleConfig.urls.apiPrefix + 'nodes/' + slaveId + '/').success(function (data) {
                    var returnData = Node.transformer(data);
                    d.resolve(returnData);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getNodeStatus: function (page, page_size, started, ended) {
                var params = getNodeStatusParams(page, page_size, started, ended);

                var nodeStatusResource = $resource(scaleConfig.urls.apiPrefix + 'nodes/status/', params),
                    nodeStatusPoller = pollerFactory.newPoller(nodeStatusResource, scaleConfig.pollIntervals.nodeStatus);

                return nodeStatusPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        data.results = NodeStatus.transformer(data.results);
                    } else {
                        nodeStatusPoller.stop();
                    }
                    return data;
                });
            },
            getNodeStatusOnce: function (page, page_size, started, ended) {
                var d = $q.defer();
                var params = getNodeStatusParams(page, page_size, started, ended);
                $http({
                    url: scaleConfig.urls.apiPrefix + 'nodes/status/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = NodeStatus.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getNodeData: function (slaveId, since) {
                var data = {},
                    self = this;

                since = since || 'PT3H';

                return self.getNodes().then(function (nodes) {
                    data.nodes = nodes;
                    return self.getNodeStatus(since).then(function (stats) {
                        data.stats = stats;
                        return data;
                    });
                });
            }
        };

    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('nodeUpdateService', ['$http', '$q', 'scaleConfig', 'Node', function ($http, $q, scaleConfig, Node) {
        var getNodeUpdateData = function (pause_reason, is_paused) {
            return {
                pause_reason: pause_reason,
                is_paused: is_paused
            };
        };

        return {
            updateNode: function (id, data) {
                data = data || getNodeUpdateData();
                var d = $q.defer();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'nodes/' + id + '/',
                    method: 'PATCH',
                    data: data
                }).success(function (result) {
                    d.resolve(Node.transformer(result));
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }])
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('ovController', ['$rootScope', '$scope', 'navService', 'nodeService', 'jobService', 'jobTypeService', 'statusService', 'gaugeFactory', 'scaleConfig', 'scaleService', 'schedulerService', 'userService', function($rootScope, $scope, navService, nodeService, jobService, jobTypeService, statusService, gaugeFactory, scaleConfig, scaleService, schedulerService, userService) {
        var vm = this;
        
        vm.date = new Date();
        vm.jobError = null;
        vm.jobErrorStatus = null;
        vm.loadingJobs = true;
        vm.loadingNodeHealth = true;
        vm.jobTypes = [];
        vm.nodes = [];
        vm.nodeHealthError = null;
        vm.nodeHealthErrorStatus = '';
        vm.hourValue = 3;
        vm.jobData = {
            data: null,
            status: null
        };
        vm.jobErrorBreakdown = [];
        vm.status = null;
        vm.statusError = null;
        vm.loadingStatus = true;
        vm.masterStatus = '';
        vm.masterStatusClass = 'alert-success';
        vm.schedulerStatus = '';
        vm.schedulerStatusClass = 'alert-success';
        vm.memCalc = '';
        vm.diskCalc = '';
        vm.schedulerIsPaused = false;
        vm.user = userService.getUserCreds();
        vm.schedulerContainerClass = vm.user ? vm.user.is_admin ? 'col-xs-8 col-lg-10' : 'col-xs-12' : 'col-xs-12';
        vm.schedulerBtnClass = 'fa-pause';

        vm.toggleScheduler = function () {
            vm.schedulerIsPaused = !vm.schedulerIsPaused;
            var schedulerData = {
                is_paused: vm.schedulerIsPaused
            };
            schedulerService.updateScheduler(schedulerData).then(function (data) {
                vm.schedulerStatus = data.is_paused ? 'Paused' : 'Running';
                vm.schedulerStatusClass = data.is_paused ? 'alert-warning' : 'alert-success';
                vm.schedulerBtnClass = data.is_paused ? 'fa-play' : 'fa-pause';
            }).catch(function (error) {
                console.log(error);
            });
        };

        var redrawGrid = function () {
            $scope.$broadcast('redrawGrid', vm.jobData);
        };

        var getJobTypes = function () {
            jobTypeService.getJobTypes().then(null, null, function (data) {
                if (data.$resolved) {
                    vm.jobError = null;
                    vm.jobData.data = data.results;
                    redrawGrid();
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.jobErrorStatus = data.statusText;
                    }
                    vm.jobError = 'Unable to retrieve job types.';
                }
                vm.loadingJobs = false;
            });
        };

        var getStatus = function () {
            var cpuGauge = gaugeFactory.createGauge('cpu', 'CPU', 0, 100, 180),
                memGauge = gaugeFactory.createGauge('memory', 'Memory', 0, 100, 180),
                diskGauge = gaugeFactory.createGauge('disk', 'Disk', 0, 100, 180);

            statusService.getStatus().then(null, null, function (result) {
                if (result.$resolved) {
                    vm.statusError = null;
                    vm.status = result;
                    cpuGauge.redraw(result.getCpuUsage());
                    memGauge.redraw(result.getMemUsage());
                    diskGauge.redraw(result.getDiskUsage());
                    vm.masterStatus = result.master.is_online ? 'Master is Online' : 'Master is Offline';
                    vm.masterStatusClass = result.master.is_online ? 'alert-success' : 'alert-danger';
                    if (result.scheduler.is_online) {
                        vm.schedulerStatus = result.scheduler.is_paused ? 'Scheduler is Paused' : 'Scheduler is Running';
                        vm.schedulerStatusClass = result.scheduler.is_paused ? 'alert-warning' : 'alert-success';
                        vm.schedulerIsPaused = result.scheduler.is_paused;
                        vm.schedulerBtnClass = result.scheduler.is_paused ? 'fa-play' : 'fa-pause';
                    } else {
                        vm.schedulerStatus = result.scheduler.is_paused ? 'Scheduler is Offline; Paused' : 'Scheduler is Offline';
                        vm.schedulerStatusClass = 'alert-danger';
                        vm.schedulerIsPaused = result.scheduler.is_paused;
                        vm.schedulerBtnClass = result.scheduler.is_paused ? 'fa-play' : 'fa-pause';
                    }
                    if (result.resources.scheduled.mem && result.resources.total.mem) {
                        vm.memCalc = scaleService.calculateFileSizeFromMib(result.resources.scheduled.mem) + ' / ' + scaleService.calculateFileSizeFromMib(result.resources.total.mem);
                    }
                    if (result.resources.scheduled.disk && result.resources.total.disk) {
                        vm.diskCalc = scaleService.calculateFileSizeFromMib(result.resources.scheduled.disk) + ' / ' + scaleService.calculateFileSizeFromMib(result.resources.total.disk);
                    }
                } else {
                    vm.statusError = result.statusText && result.statusText !== '' ? result.statusText : 'Unable to retrieve cluster status.';
                    cpuGauge.redraw(-1);
                    memGauge.redraw(-1);
                    diskGauge.redraw(-1);
                    vm.masterStatus = 'Master Status is Unknown';
                    vm.masterStatusClass = 'alert-danger';
                    vm.schedulerContainerClass = 'col-xs-12';
                    vm.schedulerStatus = 'Scheduler Status is Unknown';
                    vm.schedulerStatusClass = 'alert-danger';
                }
                vm.loadingStatus = false;
            });
        };

        var getNodeStatus = function () {
            nodeService.getNodeStatus(null, null, 'PT3H', null).then(null, null, function (data) {
                if (data.$resolved) {
                    vm.nodeHealthError = null;
                    vm.nodes = data.results;
                } else {
                    if (data.statusText && data.statusText !== '') {
                        vm.nodeHealthErrorStatus = data.statusText;
                    }
                    vm.nodeHealthError = 'Unable to retrieve nodes.';
                }
                vm.loadingNodeHealth = false;
            });
        };

        $rootScope.$on('jobTypeStatus', function (event, data) {
            vm.jobData.status = data;
            redrawGrid();
        });

        var initialize = function () {
            getJobTypes();
            getStatus();
            getNodeStatus();
            navService.updateLocation('overview');
        };

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('recipeDetailsController', ['$rootScope', '$scope', '$location', '$routeParams', 'navService', 'recipeService', 'scaleConfig', 'subnavService', 'userService', function ($rootScope, $scope, $location, $routeParams, navService, recipeService, scaleConfig, subnavService, userService) {

        var vm = this;

        vm.recipe = {};
        vm.recipeId = $routeParams.id;
        vm.subnavLinks = scaleConfig.subnavLinks.recipes;
        subnavService.setCurrentPath('recipes');
        vm.loadingRecipeDetail = true;
        vm.activeTab = 'status';
        vm.lastStatusChange = '';

        vm.getRecipeDetail = function (recipeId) {
            vm.loadingRecipeDetail = true;
            recipeService.getRecipeDetails(recipeId).then(function (data) {
                vm.recipe = data;
                recipeService.getRecipeTypeDetail(data.recipe_type.id).then(function(recipeType){
                    vm.recipeType = recipeType;
                }).catch(function(error){
                   console.log(error);
                });
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loadingRecipeDetail = false;
            });
        };

        vm.initialize = function () {
            navService.updateLocation('recipes');
            vm.getRecipeDetail(vm.recipeId);
        };



        vm.switchTab = function (tab) {
            $('#' + vm.activeTab).hide();
            vm.activeTab = tab;
            $('#' + vm.activeTab).show();
        };

        vm.initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('recipeTypesController', ['$rootScope', '$scope', '$routeParams', '$location', '$uibModal', 'hotkeys', 'scaleService', 'navService', 'recipeService', 'subnavService', 'jobTypeService', 'scaleConfig', 'RecipeType', 'userService', 'localStorage', function ($rootScope, $scope, $routeParams, $location, $uibModal, hotkeys, scaleService, navService, recipeService, subnavService, jobTypeService, scaleConfig, RecipeType, userService, localStorage) {
        var vm = this;
        
        vm.loading = true;
        vm.containerStyle = '';
        vm.recipeTypes = [];
        vm.recipeTypeIds = [];
        vm.requestedRecipeTypeId = parseInt($routeParams.id);
        vm.activeRecipeType = null;
        vm.percentage = 73;
        vm.date = new Date();
        vm.recipes = null;
        vm.mode = 'view'; // valid values are add, view, and edit
        vm.addBtnText = 'New Recipe';
        vm.addBtnClass = 'btn-primary';
        vm.addBtnIcon = 'fa-plus-circle';
        vm.editBtnText = 'Edit';
        vm.editBtnClass = 'btn-success';
        vm.editBtnIcon = 'fa-edit';
        vm.jobTypeValues = [];
        vm.isRecipeModified = false;
        vm.saveBtnClass = 'btn-default';
        vm.masterClass = 'col-xs-3';
        vm.detailClass = 'col-xs-9';
        vm.minimizeMaster = false;
        vm.minimizeBtnClass = 'fa fa-chevron-left';
        vm.user = userService.getUserCreds();
        vm.scaleConfig = scaleConfig;
        vm.localRecipeTypes = [];

        vm.subnavLinks = scaleConfig.subnavLinks.recipes;
        subnavService.setCurrentPath('recipes/types');

        var initialize = function () {
            navService.updateLocation('recipes');
            getRecipeTypes();
        };
        
        var getRecipeTypes = function () {
            recipeService.getRecipeTypes().then(function (data) {
                vm.recipeTypes = data.results;
                if (scaleConfig.static) {
                    var i = 0,
                        oJson = {},
                        sKey;
                    for (; sKey = localStorage.key(i); i++) {
                        oJson[sKey] = localStorage.getItem(sKey);
                    }
                    _.filter(_.pairs(oJson), function (o) {
                        if (_.contains(o[0], 'recipeType')) {
                            var type = JSON.parse(o[1]);
                            vm.localRecipeTypes.push(type);
                            vm.recipeTypes.push(type);
                        }
                    });
                }
                vm.recipeTypeIds = _.pluck(data, 'id');
                vm.viewRecipeTypeDetail(vm.requestedRecipeTypeId);
                hotkeys.bindTo($scope)
                    .add({
                        combo: 'ctrl+up',
                        description: 'Previous Recipe Type',
                        callback: function () {
                            if (vm.activeRecipeType) {
                                var idx = _.indexOf(vm.recipeTypeIds, vm.activeRecipeType.id);
                                if (idx > 0) {
                                    vm.loadRecipeType(vm.recipeTypeIds[idx - 1]);
                                }
                            }
                        }
                    }).add({
                        combo: 'ctrl+down',
                        description: 'Next Recipe Type',
                        callback: function () {
                            if (vm.activeRecipeType) {
                                var idx = _.indexOf(vm.recipeTypeIds, vm.activeRecipeType.id);
                                if (idx < (vm.recipeTypeIds.length - 1)) {
                                    vm.loadRecipeType(vm.recipeTypeIds[idx + 1]);
                                }
                            }
                        }
                    });
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                if (vm.loading) {
                    vm.loading = false;
                }
            })
        };

        vm.clearLocalRecipeTypes = function () {
            _.forEach(vm.localRecipeTypes, function (type) {
                localStorage.removeItem('recipeType' + type.id);
            });
            $location.path('/recipes/types');
        };

        vm.newRecipeType = function(){
            $location.path('/recipes/types/0');
        };

        vm.viewRecipeTypeDetail = function (recipeTypeId) {
            if (recipeTypeId > 0) {
                recipeService.getRecipeTypeDetail(recipeTypeId).then(function (data) {
                    vm.activeRecipeType = data;
                });
            } else if( recipeTypeId === 0) {
                vm.activeRecipeType = new RecipeType();
            }
        };

        vm.loadRecipeType = function (id) {
            if (vm.activeRecipeType && vm.activeRecipeType.modified) {
                confirmChangeRecipe().then(function () {
                    // OK
                    $location.path('/recipes/types/' + id);
                }, function () {
                    // Cancel

                });
            } else {
                $location.path('/recipes/types/' + id);
            }
        };

        var confirmChangeRecipe = function () {
            var modalInstance = $uibModal.open({
                animation: vm.animationsEnabled,
                templateUrl: 'confirmDialog.html',
                scope: $scope,
                size: 'sm'
            });

            return modalInstance.result;
        };

        vm.toggleMaster = function (minimizeMaster) {
            if (typeof minimizeMaster !== 'undefined') {
                vm.minimizeMaster = minimizeMaster;
            } else {
                vm.minimizeMaster = !vm.minimizeMaster;
            }
            vm.masterClass = vm.minimizeMaster ? 'col-xs-1 minimized' : 'col-xs-3';
            vm.detailClass = vm.minimizeMaster ? 'col-xs-11' : 'col-xs-9';
            vm.minimizeBtnClass = vm.minimizeMaster ? 'fa fa-chevron-right' : 'fa fa-chevron-left';
        };

        $rootScope.$on('toggleEdit', function (event, data) {
            vm.toggleMaster(data === 'edit');
        });

        initialize();

        $rootScope.$on('recipeModified', function () {
            vm.isRecipeModified = true;
            vm.saveBtnClass = 'btn-success';
        });

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                containerMaxHeight = viewport.height - offset;

            vm.containerStyle = 'height: ' + containerMaxHeight + 'px; max-height: ' + containerMaxHeight + 'px;';
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('recipesController', ['$scope', '$location', 'scaleConfig', 'scaleService', 'stateService', 'recipeService', 'navService', 'subnavService', 'gridFactory', function ($scope, $location, scaleConfig, scaleService, stateService, recipeService, navService, subnavService, gridFactory) {
        subnavService.setCurrentPath('recipes');

        var vm = this,
            recipeTypeViewAll = { name: 'VIEW ALL', title: 'VIEW ALL', version: '', id: 0 };

        vm.recipesParams = stateService.getRecipesParams();

        vm.stateService = stateService;
        vm.loading = true;
        vm.recipeTypeValues = [recipeTypeViewAll];
        vm.selectedRecipeType = vm.recipesParams.type_id ? vm.recipesParams.type_id : recipeTypeViewAll;
        vm.subnavLinks = scaleConfig.subnavLinks.recipes;
        vm.lastModifiedStart = moment.utc(vm.recipesParams.started).toDate();
        vm.lastModifiedStartPopup = {
            opened: false
        };
        vm.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStartPopup.opened = true;
        };
        vm.lastModifiedStop = moment.utc(vm.recipesParams.ended).toDate();
        vm.lastModifiedStopPopup = {
            opened: false
        };
        vm.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            vm.lastModifiedStopPopup.opened = true;
        };
        vm.dateModelOptions = {
            timezone: '+000'
        };
        vm.gridOptions = gridFactory.defaultGridOptions();
        vm.gridOptions.paginationCurrentPage = vm.recipesParams.page || 1;
        vm.gridOptions.paginationPageSize = vm.recipesParams.page_size || vm.gridOptions.paginationPageSize;
        vm.gridOptions.data = [];

        var filteredByRecipeType = vm.recipesParams.type_id ? true : false,
            filteredByOrder = vm.recipesParams.order ? true : false;

        vm.colDefs = [
            {
                field: 'recipe_type',
                displayName: 'Recipe Type',
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.recipe_type.title }} {{ row.entity.recipe_type.version }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.vm.selectedRecipeType" ng-options="recipeType as (recipeType.title + \' \' + recipeType.version) for recipeType in grid.appScope.vm.recipeTypeValues"></select>'
            },
            {
                field: 'created',
                displayName: 'Created (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'
            },
            {
                field: 'last_modified',
                displayName: 'Last Modified (Z)',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'
            },
            {
                field: 'duration',
                enableFiltering: false,
                enableSorting: false,
                width: 120,
                cellTemplate: '<div class="ui-grid-cell-contents text-right">{{ row.entity.getDuration() }}</div>'
            },
            {
                field: 'completed',
                enableFiltering: false,
                enableSorting: true,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.completed_formatted }}</div>'
            }
        ];

        vm.getRecipes = function () {
            recipeService.getRecipes(vm.recipesParams).then(function (data) {
                vm.gridOptions.minRowsToShow = data.results.length;
                vm.gridOptions.virtualizationThreshold = data.results.length;
                vm.gridOptions.totalItems = data.count;
                vm.gridOptions.data = data.results;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                vm.loading = false;
            });
        };

        vm.getRecipeTypes = function () {
            recipeService.getRecipeTypes().then(function (data) {
                vm.recipeTypeValues.push(data.results);
                vm.recipeTypeValues = _.flatten(vm.recipeTypeValues);
                vm.selectedRecipeType = _.find(vm.recipeTypeValues, { id: vm.recipesParams.type_id }) || recipeTypeViewAll;
                vm.getRecipes();
            }).catch(function (error) {
                vm.loading = false;
            });
        };

        vm.filterResults = function () {
            stateService.setRecipesParams(vm.recipesParams);
            vm.loading = true;
            vm.getRecipes();
        };

        vm.updateColDefs = function () {
            vm.gridOptions.columnDefs = gridFactory.applySortConfig(vm.colDefs, vm.recipesParams);
        };

        vm.updateRecipeOrder = function (sortArr) {
            vm.recipesParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            vm.filterResults();
        };

        vm.updateRecipeType = function (value) {
            if (value.id !== vm.recipesParams.type_id) {
                vm.recipesParams.page = 1;
            }
            vm.recipesParams.type_id = value.id === 0 ? null : value.id;
            vm.recipesParams.page_size = vm.gridOptions.paginationPageSize;
            if (!vm.loading) {
                vm.filterResults();
            }
        };

        vm.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            vm.gridApi = gridApi;
            vm.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                $location.path('/recipes/recipe/' + row.entity.id);
            });
            vm.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                vm.recipesParams.page = currentPage;
                vm.recipesParams.page_size = pageSize;
                vm.filterResults();
            });
            vm.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                _.forEach(vm.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                stateService.setRecipesColDefs(vm.gridApi.grid.options.columnDefs);
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                vm.updateRecipeOrder(sortArr);
            });
        };

        vm.initialize = function () {
            stateService.setRecipesParams(vm.recipesParams);
            vm.updateColDefs();
            vm.getRecipeTypes();
            navService.updateLocation('recipes');
        };

        vm.initialize();

        $scope.$watch('vm.selectedRecipeType', function (value) {
            if (parseInt(value)) {
                value = _.find(vm.recipeTypeValues, {id: parseInt(value)});
            }
            if (value) {
                if (vm.loading) {
                    if (filteredByRecipeType) {
                        vm.updateRecipeType(value);
                    }
                } else {
                    filteredByRecipeType = !angular.equals(value, recipeTypeViewAll);
                    vm.updateRecipeType(value);
                }
            }
        });

        $scope.$watch('vm.lastModifiedStart', function (value) {
            if (!vm.loading) {
                vm.recipesParams.started = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watch('vm.lastModifiedStop', function (value) {
            if (!vm.loading) {
                vm.recipesParams.ended = value.toISOString();
                vm.filterResults();
            }
        });

        $scope.$watchCollection('vm.stateService.getRecipesColDefs()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.colDefs = newValue;
            vm.updateColDefs();
        });

        $scope.$watchCollection('vm.stateService.getRecipesParams()', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.recipesParams = newValue;
            vm.updateColDefs();
        });
    }]);
})();
/**
 * <ais-scale-recipe-viewer />
 */
(function () {
    angular.module('scaleApp').controller('aisScaleRecipeGraphViewerController', ['$rootScope', '$scope', '$location', '$uibModal', 'scaleConfig', 'scaleService', 'jobTypeService', 'recipeService', 'workspacesService', 'RecipeType', 'RecipeTypeDetail', 'JobType', 'localStorage', function ($rootScope, $scope, $location, $uibModal, scaleConfig, scaleService, jobTypeService, recipeService, workspacesService, RecipeType, RecipeTypeDetail, JobType, localStorage) {
        var vm = this;
        
        vm.vertices = [];
        vm.edges = [];
        vm.selectedJob = null;
        vm.selectedInputProvider = null;
        vm.mode = null;
        vm.editMode = null;
        vm.dependencyBtnClass = 'fa-plus';
        vm.addBtnText = 'New Recipe';
        vm.addBtnClass = 'btn-primary';
        vm.addBtnIcon = 'fa-plus-circle';
        vm.editBtnText = 'Edit';
        vm.editBtnClass = 'btn-success';
        vm.editBtnIcon = 'fa-edit';
        vm.jobTypeValues = [];
        vm.saveBtnClass = 'btn-default';
        vm.savingRecipe = false;
        vm.warnings = [];
        vm.readonly = true;
        vm.detailMaxHeight = 0;
        vm.recipeTypeTrigger = { dataTypes: '' };
        vm.detailContainerStyle = '';
        vm.containerClass = $scope.hasContainer ? '' : 'detail-container no-tabs';
        vm.lastStatusChange = '';
        vm.availableWorkspaces = [];
        vm.recipeInputTypes = [
            {
                name: 'property',
                title: 'Property',
                fields: []
            },
            {
                name: 'file',
                title: 'File',
                fields: [
                    {
                        name: 'media_types',
                        title: 'Media Types',
                        value: []
                    }
                ]
            },
            {
                name: 'files',
                title: 'Files',
                fields: [
                    {
                        name: 'media_types',
                        title: 'Media Types',
                        value: []
                    }
                ]
            }
        ];
        vm.availableTriggerTypes = scaleConfig.triggerTypes;
        vm.selectedRecipeInputType = {};
        vm.recipeInput = {
            name: '',
            required: true,
            type: ''
        };
        vm.isIE = scaleService.isIE();

        var startJob = null;
        var zoomScale = 0;

        // Dagre variables
        var svg = null;
        var inner = null;
        var graph = null;
        var zoom = null;
        var render = null;

        var getClosestNode = function (name) {
            return d3.selectAll('.nodeRect').filter(function (d) {
                return d === name;
            });
        };

        var getOtherNodes = function (name) {
            return d3.selectAll('.nodeRect').filter(function (d) {
                return d !== name;
            });
        };

        var resetEditBtn = function () {
            vm.editBtnText = vm.mode === 'edit' ? 'Cancel Edit' : 'Edit';
            vm.editBtnClass = vm.mode === 'edit' ? 'btn-warning' : 'btn-success';
            vm.editBtnIcon = vm.mode === 'edit' ? 'fa-close' : 'fa-edit';
        };

        var resetAddBtn = function () {
            vm.addBtnText = vm.mode === 'add' ? 'Cancel' : 'New Recipe';
            vm.addBtnClass = vm.mode === 'add' ? 'btn-warning' : 'btn-primary';
            vm.addBtnIcon = vm.mode === 'add' ? 'fa-close' : 'fa-plus-circle';
        };

        var toggleAddRecipe = function () {
            vm.mode = vm.mode === 'add' ? 'view' : 'add';
            resetAddBtn();
        };

        var toggleEditRecipe = function () {
            if (vm.mode === 'edit') {
                vm.mode = 'view';
                vm.reloadRecipeTypeDetail($scope.recipeType.id);
            } else {
                vm.mode = 'edit';
            }
            vm.editMode = '';
            resetEditBtn();
        };

        var enableSaveRecipe = function () {
            $scope.recipeType.modified = true;
            vm.saveBtnClass = 'btn-success';
        };

        var disableSaveRecipe = function () {
            $scope.recipeType.modified = false;
            vm.saveBtnClass = 'btn-default;'
        };

        var confirmChangeRecipe = function () {
            var modalInstance = $uibModal.open({
                animation: vm.animationsEnabled,
                templateUrl: 'confirmDialog.html',
                scope: $scope,
                size: 'sm'
            });

            return modalInstance.result;
        };

        var getRecipeTypeJobClassName = function (job) {
            // default to 'nostatus'
            var className = 'nostatus';
            // find the associated job in the recipe.jobs
            if ($scope.recipe) {
                var recipejob = _.find($scope.recipe.jobs,{job_name: job.name});
                if (recipejob) {
                    className = recipejob.job.status.toLowerCase();
                }
            }
            return className;
        };

        vm.reloadRecipeTypeDetail = function (id) {
            var getRecipeDetail = function () {
                recipeService.getRecipeTypeDetail(id).then(function (data) {
                    $scope.recipeType = data;

                });
            };

            if ($scope.recipeType.modified) {
                confirmChangeRecipe().then(function () {
                    // OK
                    disableSaveRecipe();
                    resetAddBtn();
                    if (vm.mode === 'edit') {
                        toggleEditRecipe();
                    }
                    getRecipeDetail();
                }, function () {
                    // Cancel

                });
            } else {
                if (vm.mode === 'edit') {
                    toggleEditRecipe();
                }
                resetAddBtn();
                getRecipeDetail();
            }
        };

        vm.redraw = function () {
            initialize();
            //$rootScope.$broadcast('recipeModified');
        };

        vm.nodeClick = function (name) {
            // Remove selection class
            //$('div').removeClass('selected-node');
            d3.selectAll('.nodeRect').classed('selected-node', false);

            // find the job in the recipe definition
            var job = _.find($scope.recipeType.definition.jobs, { name: name });

            if (name === 'start') {
                job = startJob;
            }
            var $name = $('#' + name);
            var pos = $name.position();

            // click node different from selectedJob
            if (!vm.selectedJob || job.name !== vm.selectedJob.name) {
                if (vm.editMode === 'addDependency') {
                    addDependency(name);
                    enableSaveRecipe();
                    vm.redraw();

                } else if (vm.editMode === 'addInput') {
                    var contentStr = '';
                    if (job.name === 'start') {
                        contentStr = '<ul class="list-group">';
                        _.forEach($scope.recipeType.definition.input_data, function (recipeInput) {
                            contentStr = contentStr + '<li class="list-group-item">';
                            contentStr = contentStr + '<a onclick="mapInputRecipeInput(\'' + recipeInput.name + '\')">' + recipeInput.name + '</a>';
                            if (recipeInput.media_types) {
                                contentStr = contentStr + '<div class="input-media-types">' + recipeInput.media_types.join(',') + '</div>';
                            }
                            contentStr = contentStr + '</li>';
                        });
                        contentStr = contentStr + '</ul>';
                        $name.popover({
                            container: 'body',
                            content: contentStr,
                            html: true,
                            title: 'Select provider/output'
                        });
                        $name.popover('show');
                    } else {
                        if (job.job_type.job_type_interface.output_data.length > 0) {
                            contentStr = '<ul class="list-group">';
                            _.forEach(job.job_type.job_type_interface.output_data, function (jobOutput) {
                                contentStr = contentStr + '<li class="list-group-item">';
                                contentStr = contentStr + '<a onclick="mapInput(\'' + job.name + '\', \'' + jobOutput.name + '\')">' + jobOutput.name + '</a>';
                                if (jobOutput.media_type) {
                                    contentStr = contentStr + '<div class="input-media-types">' + jobOutput.media_type + '</div>';
                                }
                                contentStr = contentStr + '</li>';
                            });
                            contentStr = contentStr + '</ul>';
                            $name.popover({
                                container: 'body',
                                content: contentStr,
                                html: true,
                                title: 'Select provider/output'
                            });
                            $name.popover('show');
                        }
                    }
                } else if (vm.editMode === 'addOutput') {
                    vm.selectedOutputReceiver = job;
                    if (job.job_type.job_type_interface.input_data.length > 0) {
                        contentStr = '<ul class="list-group">';
                        _.forEach(job.job_type.job_type_interface.input_data, function (jobInput) {
                            contentStr = contentStr + '<li class="list-group-item">';
                            contentStr = contentStr + '<a onclick="mapOutput(\'' + job.name + '\', \'' + jobInput.name + '\')">' + jobInput.name + '</a>';
                            if (jobInput.media_types) {
                                contentStr = contentStr + '<div class="input-media-types">' + jobInput.media_types.join(',') + '</div>';
                            }
                            contentStr = contentStr + '</li>';
                        });
                        contentStr = contentStr + '</ul>';
                        $name.popover({
                            container: 'body',
                            content: contentStr,
                            html: true,
                            title: 'Select receiver/input'
                        });
                        $name.popover('show');
                    }
                } else {
                    // update the selected job
                    vm.selectedJob = job;
                    if ($scope.recipe) {
                        vm.selectedRecipeJob = _.find($scope.recipe.jobs, { job_name: job.name });
                    }
                    // apply the selected-node class
                    //$name.addClass('selected-node');
                    getClosestNode(name).classed('selected-node', true);
                }
            }
            else { // click selected node
                //$('div').removeClass('selected-node');
                d3.selectAll('.nodeRect').classed('selected-node', false);
                vm.selectedJob = null;
                vm.selectedRecipeJob = null;
                vm.selectedOutputReceiver = null;
                vm.selectedInputProvider = null;
                vm.editMode = '';
                vm.dependencyBtnClass = 'fa-plus';

                //$('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
                getOtherNodes(name).classed('selected-node-selectable', false);
            }
            if (vm.selectedJob) {
                //$('#' + vm.selectedJob.name).addClass('selected-node');
                getClosestNode(vm.selectedJob.name).classed('selected-node', true);
            }
        };
        vm.toggleEditMode = function () {
            if (vm.mode === 'edit') {
                vm.reloadRecipeTypeDetail($scope.recipeType.id);
            } else {
                toggleEditRecipe();
                resetAddBtn();
            }
            $rootScope.$broadcast('toggleEdit', vm.mode);
        };

        vm.openAddJob = function () {
            var modalInstance = $uibModal.open({
                animation: vm.animationsEnabled,
                templateUrl: 'addJobContent.html',
                scope: $scope,
                size: 'sm'
            });

            modalInstance.result.then(function () {
                if (vm.selectedJobType) {
                    jobTypeService.getJobTypeDetails(vm.selectedJobType.id).then(function (data) {
                        vm.addJobType(data);
                        enableSaveRecipe();
                    });
                }
            }, function () {

            });
        };

        vm.openEditTrigger = function () {
            var modalInstance = $uibModal.open({
                animation: vm.animationsEnabled,
                templateUrl: 'editTrigger.html',
                scope: $scope,
                size: 'md'
            });

            modalInstance.result.then(function () {
                if (vm.mode === 'edit' || vm.mode === 'add') {
                    $scope.recipeType.trigger_rule.configuration.condition.data_types = vm.recipeTypeTrigger.dataTypes ? vm.recipeTypeTrigger.dataTypes.split(',') : [];
                    enableSaveRecipe();
                }
            }, function () {

            });


        };

        vm.deleteRecipeInput = function (inputName) {
            var removedRecipeInput = _.remove($scope.recipeType.definition.input_data, function (recipeInput) {
                return recipeInput.name === inputName;
            });
            console.log('removed ' + removedRecipeInput.length + ' recipe inputs.');
            enableSaveRecipe();
            vm.redraw();

        };

        vm.openAddInput = function () {
            var modalInstance = $uibModal.open({
                animation: vm.animationsEnabled,
                templateUrl: 'addInput.html',
                scope: $scope
            });

            modalInstance.result.then(function () {
                // check for fields and add as necessary
                if ( vm.selectedRecipeInputType.fields.length > 0) {
                    var fieldArr = [];
                    _.forEach(vm.selectedRecipeInputType.fields, function (field) {
                        _.forEach(field.value.split(','), function (value) {
                            fieldArr.push(value);
                        });
                        vm.recipeInput[field.name] = fieldArr;
                    });
                }

                // add input to recipe type definition
                $scope.recipeType.definition.input_data.push(vm.recipeInput);
                _.forEach($scope.recipeType.definition.jobs, function (job) {
                    if (job.recipe_inputs.length === 0) {
                        job.recipe_inputs.push({
                            job_input: vm.recipeInput.name,
                            recipe_input: vm.recipeInput.name
                        });
                    }
                });
                getIoMappings();

                // reset form fields
                vm.recipeInput = {
                    name: '',
                    required: true,
                    type: ''
                };
                vm.selectedRecipeInputType = {};
            });
        };

        vm.changeInputType = function () {
            vm.selectedRecipeInputType = _.find(vm.recipeInputTypes, {'name': vm.recipeInput.type});
        };

        var getWarningsHtml = function (warnings) {
            var warningsHtml = '';
            _.forEach(warnings, function (warning) {
                warningsHtml += '<b>' + warning.id + ':</b> ' + warning.details + '<br /><br />';
            });
            warningsHtml += '<button type="button" class="btn btn-default btn-xs clear">Hide</button>';
            return warningsHtml;
        };

        vm.validateRecipeType = function () {
            recipeService.validateRecipeType($scope.recipeType).then(function (validationResult) {
                if (validationResult.warnings && validationResult.warnings.length > 0) {
                    // display the warnings
                    var warningsHtml = getWarningsHtml(validationResult.warnings);
                    toastr["error"](warningsHtml);
                } else {
                    toastr["success"]('Recipe is valid.');
                }
            }).catch(function (error) {
                if (error.detail) {
                    toastr["error"](error.detail);
                } else {
                    toastr["error"](error);
                }
            });

        };


        vm.saveRecipeType = function () {
            vm.savingRecipe = true;
            recipeService.validateRecipeType($scope.recipeType).then(function (validationResult) {
                if (validationResult.warnings && validationResult.warnings.length > 0) {
                    // display the warnings
                    var warningsHtml = getWarningsHtml(validationResult.warnings);
                    toastr["error"](warningsHtml);
                    vm.savingRecipe = false;
                } else {
                    recipeService.saveRecipeType($scope.recipeType).then(function (saveResult) {
                        vm.savingRecipe = false;
                        $scope.recipeType = RecipeTypeDetail.transformer(saveResult);
                        if (scaleConfig.static) {
                            console.log(JSON.stringify($scope.recipeType));
                            localStorage.setItem('recipeType' + $scope.recipeType.id, JSON.stringify($scope.recipeType));
                        }
                        vm.redraw();
                        $location.path('/recipes/types/' + $scope.recipeType.id);
                    });
                }
            }).catch(function (error) {
                if (error && error.detail) {
                    toastr['error'](error.detail);
                } else {
                    toastr['error'](error);
                }
                vm.savingRecipe = false;
            });

            disableSaveRecipe();
        };

        vm.addJobType = function (selectedJobType) {
            console.log(selectedJobType.name);
            $scope.recipeType.definition.addJob(selectedJobType);
            //$scope.$broadcast('redrawRecipes');
            vm.redraw();
        };

        vm.mapInput = function (providerName, providerOutput) {
            console.log('map selected job input to ' + providerName + '.' + providerOutput);
            var dependency = _.find(vm.selectedJob.dependencies, {name: providerName});

            if (dependency && dependency.connections && dependency.connections.length > 0) {
                var conn = _.find(dependency.connections, { output: providerOutput, input: vm.selectedJobInput.name });
                if (!conn) {
                    dependency.connections.push({ output: providerOutput, input: vm.selectedJobInput.name });
                }
            }
            else if (!dependency) {
                dependency = {name: providerName, connections: [{ output: providerOutput, input: vm.selectedJobInput.name }]};
                vm.selectedJob.dependencies.push(dependency);
            }
            else {
                dependency.connections = [{ output: providerOutput, input: vm.selectedJobInput.name }];
            }
            vm.selectedJob.depStart = false;
            vm.editMode = '';
            vm.selectedJobInput = null;
            vm.selectedInputProvider = null;
            enableSaveRecipe();
            vm.redraw();
        };

        vm.mapInputRecipeInput = function (recipeInput) {
            console.log('map selected job to recipe input ' + recipeInput);
            var existingInput = _.find(vm.selectedJob.recipe_inputs, { job_input: vm.selectedJobInput.name });
            if ( existingInput && existingInput.recipe_name !== recipeInput) {
                // update it
                existingInput.recipe_input = recipeInput;
                enableSaveRecipe();
                vm.redraw();
            } else if ( !existingInput ) {
                // create it
                vm.selectedJob.recipe_inputs.push({
                    job_input: vm.selectedJobInput.name,
                    recipe_input: recipeInput
                });
                enableSaveRecipe();
                vm.redraw();
            }
            vm.editMode = '';
            vm.selectedJobInput = null;
            vm.selectedInputProvider = null;
        };

        vm.mapOutput = function (receiverName, receiverInput) {
            var dependency = _.find(vm.selectedOutputReceiver.dependencies, {name: vm.selectedJob.name});

            if (dependency && dependency.connections && dependency.connections.length > 0) {
                var conn = _.find(dependency.connections, { output: vm.selectedJobOutput.name, input: receiverInput });
                if (!conn) {
                    dependency.connections.push({output: vm.selectedJobOutput.name, input: receiverInput});
                }
            }
            else if (!dependency) {
                dependency = {name: vm.selectedJob.name, connections: [{output: vm.selectedJobOutput.name, input: receiverInput}]};
                vm.selectedOutputReceiver.dependencies.push(dependency);
            }
            else {
                dependency.connections = [{output: vm.selectedJobOutput.name, input: receiverInput}];
            }
            vm.selectedOutputReceiver.depStart = false;
            vm.editMode = '';
            vm.selectedJobOutput = null;
            vm.selectedOutputReceiver = null;
            enableSaveRecipe();
            vm.redraw();
        };

        vm.toggleAddDependency = function () {
            if (vm.editMode === 'addDependency') {
                vm.editMode = '';
                vm.dependencyBtnClass = 'fa-plus';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', false);
                //$('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
            } else {
                console.log('toggle addDependency mode');
                vm.editMode = 'addDependency';
                vm.dependencyBtnClass = 'fa-remove';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', true);
                //$('.recipeNode:not(".selected-node")').addClass('selected-node-selectable');
            }
        };

        vm.toggleAddInput = function (jobinput) {
            if (vm.editMode === 'addInput') {
                vm.editMode = '';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', false);
                //$('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
            } else {
                vm.selectedJobInput = jobinput;
                console.log('toggle addInput mode');
                vm.editMode = 'addInput';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', true);
                //$('.recipeNode:not(".selected-node")').addClass('selected-node-selectable');
            }
        };

        vm.toggleAddOutput = function (joboutput) {
            if (vm.editMode === 'addOutput') {
                vm.editMode = '';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', false);
                //$('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
            } else {
                vm.selectedJobOutput = joboutput;
                console.log('toggle addOutput mode');
                vm.editMode = 'addOutput';
                getOtherNodes(vm.selectedJob.name).classed('selected-node-selectable', true);
                //$('.recipeNode:not(".selected-node")').addClass('selected-node-selectable');
            }
        };

        vm.removeDependency = function (depName) {
            var removedDeps = _.remove(vm.selectedJob.dependencies, function (dep) {
                return dep.name === depName;
            });
            console.log('removed ' + removedDeps.length + ' dependencies.');
            enableSaveRecipe();
            vm.redraw();
        };

        vm.removeInputMapping = function (depName, depOutput) {
            if ( depName === 'recipe' ) {
                // remove it from selectedJob.recipe_inputs
                var dep = _.remove(vm.selectedJob.recipe_inputs, { recipe_input: depOutput });
                enableSaveRecipe();
                vm.redraw();
            } else {
                var dep = _.find(vm.selectedJob.dependencies, {name: depName});
                if (dep && dep.connections) {
                    // it's an input from another job
                    var removedCon = _.remove(dep.connections, function (conn) {
                        return conn.output === depOutput;
                    });
                    console.log('removed ' + removedCon.length + ' input connections.');
                    enableSaveRecipe();
                    vm.redraw();
                }
            }

        };

        vm.deleteRecipeJob = function (jobName) {
            // remove dependent connections
            _.forEach($scope.recipeType.definition.jobs, function (job) {
                _.remove(job.dependencies, {name: jobName});
            });
            // remove job from definition.jobs
            _.remove($scope.recipeType.definition.jobs, { name: jobName });
            // enable save and redraw
            vm.selectedJob = null;
            enableSaveRecipe();
            vm.redraw();
        };

        vm.removeOutputMapping = function (jobName, depOutput) {
            // we have to remove output mapping from the job where the dependency is defined
            var receiver = _.find($scope.recipeType.definition.jobs,{name: jobName});
            // remove it from receiver.dependencies
            var dep = _.find(receiver.dependencies, {name: vm.selectedJob.name});
            if (dep && dep.connections) {
                var removedCon = _.remove(dep.connections, function (conn) {
                    return conn.output === depOutput;
                });
                console.log('removed ' + removedCon.length + ' output connections.');
                enableSaveRecipe();
                vm.redraw();
            }
        };

        vm.selectJobTypeToAdd = function (item) {
            vm.selectedJobType = item;
        };

        $scope.$on('redrawRecipes', function () {
            vm.redraw();
        });

        var addDependency = function (jobName) {
            console.log(vm.selectedJob.name + '->' + jobName);
            if (!vm.selectedJob.dependencies) {
                vm.selectedJob.dependencies = [];
            }
            var existingDependency = _.find(vm.selectedJob.dependencies, {name: jobName});

            if (!existingDependency) { vm.selectedJob.dependencies.push({name: jobName}); }
            vm.selectedJob.depStart = false;
            vm.editMode = '';
            vm.dependencyBtnClass = 'fa-plus';

        };

        var getIoMappings = function () {
            if ($scope.recipeType.definition) {
                _.forEach($scope.recipeType.definition.jobs, function (job) {
                    // populate the current jobType
                    /*var thisJobType = _.find($scope.recipeType.job_types,{id: job.job_type_id});
                    job.job_type = thisJobType;*/

                    // find dependents
                    if (job.job_type && job.job_type.job_type_interface) {
                        _.forEach(job.job_type.job_type_interface.output_data, function (jobOutput, key) {
                            if (jobOutput) {
                                var deps = getDependents(job.name,jobOutput.name);
                                jobOutput.dependents = deps;
                            }
                        });
                        // add dependency mappings
                        _.forEach(job.job_type.job_type_interface.input_data, function (jobInput, key) {
                            if (jobInput) {
                                var inputMappings = [];
                                _.forEach(job.dependencies, function (dependency,key) {
                                    _.forEach(dependency.connections, function (conn,key) {
                                        if (conn.input === jobInput.name) {
                                            inputMappings.push({
                                                name: dependency.name,
                                                output: conn.output,
                                                input: conn.input
                                            });
                                        }
                                    });
                                });
                                _.forEach(job.recipe_inputs, function (recipeInput, key) {
                                    if (recipeInput.job_input === jobInput.name) {
                                        inputMappings.push({
                                            name: 'recipe',
                                            output: recipeInput.recipe_input,
                                            input: recipeInput.job_input
                                        });
                                    }
                                });
                                jobInput.dependencies = inputMappings;
                            }
                        });

                    }
                });
            }

        };

        var initialize = function () {

            jobTypeService.getJobTypesOnce().then(function (data) {
                vm.jobTypeValues = data.results;
            });

            workspacesService.getWorkspaces().then(function (data) {
                vm.availableWorkspaces = data
            });

            $scope.$watch('recipeType', function (newValue, oldValue) {
                if (!$scope.recipeType) {
                    $scope.recipeType = new RecipeType();
                }

                if (typeof $scope.recipeType.id === 'undefined' || $scope.recipeType.id === null || $scope.recipeType.id === 0) {
                    vm.mode = 'add';
                } else {
                    if (vm.mode !== 'edit') {
                        vm.mode = 'view'
                    }
                }
                _.forEach($scope.recipeType.definition.jobs, function (job, idx) {
                    if (!job.job_type.job_type_interface && $scope.recipeType.job_types) {
                        var jobTypeData = _.find($scope.recipeType.job_types, {name: job.job_type.name, version: job.job_type.version});
                        $scope.recipeType.definition.jobs[idx].job_type = jobTypeData;
                    }

                });

                // setup string to bind comma delimited list of trigger rule configuration condition data types
                if ($scope.recipeType.trigger_rule) {
                    if ($scope.recipeType.trigger_rule.configuration) {
                        if ($scope.recipeType.trigger_rule.configuration.condition) {
                            if ($scope.recipeType.trigger_rule.configuration.condition.data_types) {
                                vm.recipeTypeTrigger.dataTypes = $scope.recipeType.trigger_rule.configuration.condition.data_types.join(',');
                            }
                        }
                    }
                }

                initGraph();
                getIoMappings();
                drawGraph();
            });
            if ($scope.$parent.vm.user) {
                vm.readonly = false;
            }
        };

        var initGraph = function () {
            // ******
            // setup D3 container and Graph
            // ******
            //vm.selectedJob = null;
            function clicked() {
                var d = d3.event;
                var x = d3.event.x;
                var y = d3.event.y;
                var width = parseInt(svg.style("width").replace(/px/, ""));
                var height = parseInt(svg.style("height").replace(/px/, ""));

                inner.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(2)translate(" + -x + "," + -y + ")");

                //inner.attr("transform", "translate(50px, 50px)scale(2,3)");

                console.log(d);
            }

            svg = d3.select("svg");
            inner = svg.select("g"); //.on("click", clicked);
            // Set up zoom support
            zoom = d3.behavior.zoom().on("zoom", function () {
                zoomScale = d3.event.scale;
                inner.attr("transform", "translate(" + d3.event.translate + ")" +
                    "scale(" + zoomScale + ")");
            });
            svg.call(zoom);

            render = new dagreD3.render();

            // Left-to-right layout
            graph = new dagreD3.graphlib.Graph();
            graph.setGraph({
                nodesep: 70,
                ranksep: 50,
                rankdir: "TB",
                marginx: 20,
                marginy: 20
            });
        };

        drawGraph = function () {
            // globals because dagre needs a reference to angular scope
            window.nodeClick = function (name) {
                var scope = angular.element(document.getElementById('recipeviewer')).scope();
                scope.$apply(function () {
                    scope.vm.nodeClick(name);
                });
            };

            window.mapInput = function (jobName, jobOutput) {
                $('#' + jobName).popover('destroy');
                var scope = angular.element(document.getElementById('recipeviewer')).scope();
                scope.$apply(function () {
                    scope.vm.mapInput(jobName, jobOutput);
                });
            };

            window.mapInputRecipeInput = function (recipeInputName) {
                $('#start').popover('destroy');
                var scope = angular.element(document.getElementById('recipeviewer')).scope();
                scope.$apply(function () {
                    scope.vm.mapInputRecipeInput(recipeInputName);
                });
            };

            window.mapOutput = function (jobName, jobInput) {
                $('#' + jobName).popover('destroy');
                var scope = angular.element(document.getElementById('recipeviewer')).scope();
                scope.$apply(function () {
                    scope.vm.mapOutput(jobName, jobInput);
                });
            };

            if ($scope.recipe) {
                vm.lastStatusChange = $scope.recipe.last_modified ? moment.duration(moment.utc($scope.recipe.last_modified).diff(moment.utc())).humanize(true) : '';
            }

            var jobs = [];
            if ($scope.recipeType.definition) {
                jobs = $scope.recipeType.definition.jobs;
            }
            var childCounts = [];
            // create graph objects
            for (var idx in jobs) {
                var job = jobs[idx];

                if (job.dependencies === undefined || job.dependencies.length < 1) {
                    job.depStart = true;
                }
                var className = getRecipeTypeJobClassName(job);

                var html = '<div class="recipeNode">';
                //var html = "<div onclick=\"console.log('" + job.job_type.name + "')\">";
                if (className !== 'nostatus') {
                    html += '<span class="status"></span>';
                }
                //   html += "<span class=consumers>"+worker.consumers+"</span>";
                html += '<span class="name">';
                if (job.job_type) {
                    //console.log(job.jobType);
                    html += '<div id="' + job.name + '" class="" onclick="nodeClick(\'' + job.name + '\')"><span class="name">' + job.job_type.getIcon() + ' ' + job.name + '</span></div>';
                    //if (jobType.name) {
                    //    html += '<div id="' + job.name + '" class="recipeNode" onclick="nodeClick(\'' + job.name + '\')"><span class="name">' + jobType.getIcon() + ' ' + jobType.title + '</span></div>';
                    //} else {
                    //    html += '<div id="' + job.name + '" class="recipeNode" onclick="nodeClick(\'' + job.name + '\')"><span class="name">' + jobType.getIcon() + ' ' + job.name + '</span></div>';
                    //}

                }
                html += '</span>';
                //   html += "<span class=queue><span class=counter>"+worker.count+"</span></span>";
                html += '</div>';
                graph.setNode(job.name, {
                    labelType: 'html',
                    label: html,
                    rx: 5,
                    ry: 5,
                    padding: 0,
                    class: className
                });
                // setup edges
                for (var d in job.dependencies) {
                    var dep = job.dependencies[d];

                    if (dep.name) {
                        graph.setEdge(dep.name, job.name, {
                            //labelType: 'html',
                            //label: dep.name + '-->' + job.name,
                            width: 20

                        });
                        if (childCounts[dep.name]) {
                            childCounts[dep.name] += 1;
                        } else {
                            childCounts[dep.name] = 1;
                        }
                    }
                }
            }

            // set start node and edges
            graph.setNode('start', {
                labelType: 'html',
                label: '<div id="start" class="recipeNode" onclick="nodeClick(\'start\')"><span class=name>Start</span></div>',
                rx: 5,
                ry: 5,
                padding: 0
            });
            startJob = {
                name: 'start',
                job_type: {
                    title: 'Start'
                },
                input_data: $scope.recipeType.input_data
            };
            var noDeps = _.filter(jobs, 'depStart', true);
            for (var n in noDeps) {
                graph.setEdge('start', noDeps[n].name, {
                    width: 20
                });
            }

            // set end node and edges
            graph.setNode('end', {
                labelType: 'html',
                label: '<div class="recipeNode"><span class="name">End</span></div>',
                rx: 5,
                ry: 5,
                padding: 0
            });
            var noChildren =_.filter(jobs, function (job) {
                return !childCounts[job.name];
            });
            for (var o in noChildren) {
                graph.setEdge(noChildren[o].name, 'end', {
                    width: 20
                });
            }

            // wait for current call stack to clear
            _.defer(function () {
                inner.call(render, graph);
                zoom.event(d3.select("svg"));

                $('.node rect').attr('class', 'nodeRect');

                // add selected class to appropriate node
                if (vm.selectedJob) {
                    //$('#' + vm.selectedJob.name).addClass('selected-node');
                    getClosestNode(vm.selectedJob.name).classed('selected-node', true);
                }
            });
        };

        var getDependents = function (name,outputName) {
            var results = [];

            _.forEach($scope.recipeType.definition.jobs, function (job, key) {
                if (job.name !== name) {
                    _.forEach(job.dependencies, function (dependency, key) {
                        if (dependency.name === name) {
                            _.forEach(dependency.connections, function (conn, key) {
                                if (conn.output === outputName) {
                                    results.push({
                                        name: job.name,
                                        output: conn.output,
                                        input: conn.input
                                    });
                                }
                            });
                        }
                    });
                }
            });
            return results;
        };

        initialize();

    }]).directive('aisScaleRecipeGraphViewer', function () {
        'use strict';
        /**
         * Usage: <ais-scale-recipe-viewer recipe="recipe" />
         */
        return {
            controller: 'aisScaleRecipeGraphViewerController',
            controllerAs: 'vm',
            templateUrl: 'modules/recipes/partials/recipeGraphViewerTemplate.html',
            restrict: 'E',
            scope: {
                recipeType: '=',
                recipe: '=',
                isModified: '=modified',
                allowEdit: '=',
                hasContainer: '='
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Recipe', ['scaleConfig', 'RecipeType', 'scaleService', function (scaleConfig, RecipeType, scaleService) {
        var Recipe = function (id, created, completed, last_modified, recipe_type) {
            this.id = id;
            this.created = created;
            this.created_formatted = moment.utc(created).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.completed = completed;
            this.completed_formatted = completed ? moment.utc(completed).format(scaleConfig.dateFormats.day_second_utc_nolabel) : '';
            this.last_modified = last_modified;
            this.last_modified_formatted = moment.utc(last_modified).format(scaleConfig.dateFormats.day_second_utc_nolabel);
            this.last_status_change = last_modified ? moment.duration(moment.utc(last_modified).diff(moment.utc())).humanize(true) : '';
            this.recipe_type = RecipeType.transformer(recipe_type);
        };

        // public methods
        Recipe.prototype = {
            getDuration: function () {
                return scaleService.calculateDuration(this.created, this.last_modified);
            }
        };

        // static methods, assigned to class
        Recipe.build = function (data) {
            if (data) {
                return new Recipe(
                    data.id,
                    data.created,
                    data.completed,
                    data.last_modified,
                    data.recipe_type
                );
            }
            return new Recipe();
        };

        Recipe.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Recipe.build)
                    .filter(Boolean);
            }
            return Recipe.build(data);
        };

        return Recipe;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeData', function () {
        var RecipeData = function (input_data, version, workspace_id) {
            this.input_data = input_data;
            this.version = version;
            this.workspace_id = workspace_id;
        };

        // static methods, assigned to class
        RecipeData.build = function (data) {
            if (data) {
                return new RecipeData(
                    data.input_data,
                    data.version,
                    data.workspace_id
                );
            }
            return new RecipeData();
        };

        RecipeData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeData.build)
                    .filter(Boolean);
            }
            return RecipeData.build(data);
        };

        return RecipeData;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeDetails', ['RecipeData', 'RecipeTypeDefinition', 'RecipeType', 'RecipeTypeDetail', 'RecipeJobContainer', 'scaleConfig', function (RecipeData, RecipeTypeDefinition, RecipeType, RecipeTypeDetail, RecipeJobContainer, scaleConfig) {
        var RecipeDetails = function (id, created, completed, last_modified, data, recipe_type, recipe_type_rev, jobs) {
            this.id = id;
            this.created = created;
            this.completed = completed;
            this.completed_formatted = this.completed ? moment.utc(this.completed).format(scaleConfig.dateFormats.day_second_utc) : this.completed;
            this.last_modified = last_modified;
            this.data = RecipeData.transformer(data);
            this.recipe_type = RecipeType.transformer(recipe_type);
            this.recipe_type_rev = RecipeTypeDetail.transformer(recipe_type_rev);
            this.jobs = RecipeJobContainer.transformer(jobs);
        };

        // static methods, assigned to class
        RecipeDetails.build = function (data) {
            if (data) {
                return new RecipeDetails(
                    data.id,
                    data.created,
                    data.completed,
                    data.last_modified,
                    data.data,
                    data.recipe_type,
                    data.recipe_type_rev,
                    data.jobs
                );
            }
            return new RecipeDetails();
        };

        RecipeDetails.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeDetails.build)
                    .filter(Boolean);
            }
            return RecipeDetails.build(data);
        };

        return RecipeDetails;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeJob', ['JobType', function (JobType) {
        var RecipeJob = function (id, status, job_type) {
            this.id = id;
            this.status = status;
            this.job_type = JobType.transformer(job_type);
        };

        // static methods, assigned to class
        RecipeJob.build = function (data) {
            if (data) {
                return new RecipeJob(
                    data.id,
                    data.status,
                    data.job_type
                );
            }
            return new RecipeJob();
        };

        RecipeJob.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeJob.build)
                    .filter(Boolean);
            }
            return RecipeJob.build(data);
        };

        return RecipeJob;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeJobContainer', ['RecipeJob', function (RecipeJob) {
        var RecipeJobContainer = function (job_name, job) {
            this.job_name = job_name;
            this.job = RecipeJob.transformer(job);
        };

        // static methods, assigned to class
        RecipeJobContainer.build = function (data) {
            if (data) {
                return new RecipeJobContainer(
                    data.job_name,
                    data.job
                );
            }
            return new RecipeJobContainer();
        };

        RecipeJobContainer.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeJobContainer.build)
                    .filter(Boolean);
            }
            return RecipeJobContainer.build(data);
        };

        return RecipeJobContainer;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeType', ['scaleConfig', 'RecipeTypeDefinition', function (scaleConfig, RecipeTypeDefinition) {
        var RecipeType = function (id, name, version, title, description, is_active, definition, revision_num, created,  last_modified, archived, trigger_rule) {
            this.id = id;
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            this.is_active = is_active;
            this.definition = definition ? RecipeTypeDefinition.transformer(definition) : new RecipeTypeDefinition();
            this.revision_num = revision_num;
            this.created = created;
            this.last_modified = last_modified;
            this.archived = archived;
            if (trigger_rule) {
                this.trigger_rule = trigger_rule;
            } else {
                this.trigger_rule = {
                    type: '',
                    name: '',
                    is_active: false,
                    configuration: {
                        condition: {
                            media_type: '',
                            data_types: []
                        },
                        data: {
                            workspace_name: '',
                            input_data_name: ''
                        }
                    }
                };
            }
            this.modified = false;
        };

        // static methods, assigned to class
        RecipeType.build = function (data) {
            if (data) {
                return new RecipeType(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.is_active,
                    data.definition,
                    data.revision_num,
                    data.created,
                    data.last_modified,
                    data.archived,
                    data.trigger_rule
                );
            }
            return new RecipeType();
        };

        RecipeType.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(RecipeType.build);
            }
            return RecipeType.build(data);
        };

        return RecipeType;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeDefinition', ['scaleConfig', 'RecipeTypeDefinitionJob', 'JobTypeInputData', function (scaleConfig, RecipeTypeDefinitionJob, JobTypeInputData) {

        var self = this;
        // private methods
        var RecipeTypeDefinition = function (input_data, version, jobs) {
            this.input_data = input_data ? JobTypeInputData.transformer(input_data) : [];
            this.version = version || '1.0';
            this.jobs = jobs ? RecipeTypeDefinitionJob.transformer(jobs) : [];
        };

        var getJobName = function(jobs, jobName){
            var theName = jobName;
            var existing = _.find(jobs, { 'name': jobName });
            var idx = 2;
            while(existing){
                theName = jobName + '-' + idx;
                existing = _.find(jobs, { 'name': theName });
                idx++;
            }
            return theName;
        };

        // public methods
        RecipeTypeDefinition.prototype = {
            addJob: function (jobType) {
                var jname = getJobName(this.jobs, jobType.name);
                console.log(jname);
                var job = {
                    dependencies: [],
                    recipe_inputs: [],
                    name: jname,
                    job_type_id: jobType.id,
                    job_type: jobType
                };
                this.jobs.push(job);
            }
        };

        // static methods, assigned to class
        RecipeTypeDefinition.build = function (data) {
            if(data){
                return new RecipeTypeDefinition(
                    data.input_data,
                    data.version,
                    data.jobs
                );
            }
            return new RecipeTypeDefinition();
        };

        RecipeTypeDefinition.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeDefinition.build);
            }
            return RecipeTypeDefinition.build(data);
        };

        return RecipeTypeDefinition;
    }]);
})();

(function(){
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeDefinitionJob', ['scaleConfig', 'JobTypeDetails', function (scaleConfig, JobTypeDetails) {
        // private methods
        var RecipeTypeDefinitionJob = function (recipe_inputs, name, job_type, dependencies) {
            this.recipe_inputs = recipe_inputs;
            this.name = name;
            this.job_type = job_type;
            //this.job_type = {
            //    name: job_type.name,
            //    version: job_type.version
            //};
            this.dependencies = dependencies || [];
        };

        // static methods, assigned to class
        RecipeTypeDefinitionJob.build = function (data) {
            if (data) {
                return new RecipeTypeDefinitionJob(
                    data.recipe_inputs,
                    data.name,
                    data.job_type,
                    data.dependencies
                );
            }
            return new RecipeTypeDefinitionJob();
        };

        RecipeTypeDefinitionJob.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeDefinitionJob.build);
            }
            return RecipeTypeDefinitionJob.build(data);
        };


        return RecipeTypeDefinitionJob;

    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeDetail', ['scaleConfig', 'RecipeTypeDefinition', 'JobTypeDetails', function (scaleConfig, RecipeTypeDefinition, JobTypeDetails) {
        var RecipeTypeDetail = function (id, name, version, title, description, is_active, definition, created, last_modified, archived, trigger_rule, job_types) {
            this.id = id;
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            this.is_active = is_active;
            this.definition = RecipeTypeDefinition.transformer(definition);
            this.created = created;
            this.last_modified = last_modified;
            this.archived = archived;
            this.trigger_rule = trigger_rule;
            this.job_types = JobTypeDetails.transformer(job_types);
            this.modified = false;
        };

        // static methods, assigned to class
        RecipeTypeDetail.build = function (data) {
            if (data) {
                return new RecipeTypeDetail(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.is_active,
                    data.definition,
                    data.created,
                    data.last_modified,
                    data.archived,
                    data.trigger_rule,
                    data.job_types
                );
            }
            return new RecipeTypeDetail();
        };

        RecipeTypeDetail.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeDetail.build);
            }
            return RecipeTypeDetail.build(data);
        };

        return RecipeTypeDetail;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeValidation', ['RecipeTypeDefinition', function (RecipeTypeDefinition) {

        var getRecipeTypeValidationJobs = function (jobs) {
            var jobsOut = [];
            _.forEach(jobs, function(job){
               jobsOut.push({
                   recipe_inputs: job.recipe_inputs,
                   name: job.name,
                   job_type: {
                       name: job.job_type.name,
                       version: job.job_type.version
                   },
                   dependencies: job.dependencies
               })
            });
            return jobsOut;
        };
        
        var RecipeTypeValidation = function (id, name, version, title, description, definition, trigger_rule) {
            if (id) {
                this.id = id;
            }
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            this.definition = {
                input_data: definition.input_data,
                jobs: getRecipeTypeValidationJobs(definition.jobs)
            };
            this.trigger_rule = trigger_rule;
        };

        // static methods, assigned to class
        RecipeTypeValidation.build = function (data) {
            if (data) {
                return new RecipeTypeValidation(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.definition,
                    data.trigger_rule
                );
            }
            return new RecipeTypeValidation();
        };

        RecipeTypeValidation.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeValidation.build);
            }
            return RecipeTypeValidation.build(data);
        };

        return RecipeTypeValidation;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('workspacesController', ['$scope', '$location', '$uibModal', '$routeParams', 'scaleConfig', 'navService', 'workspacesService', 'scaleService', 'stateService', 'userService', 'gridFactory', 'Workspace', 'toastr', function ($scope, $location, $uibModal, $routeParams, scaleConfig, navService, workspacesService, scaleService, stateService, userService, gridFactory, Workspace, toastr) {
        var vm = this,
            currWorkspace = {},
            activeWorkspaces = [],
            inactiveWorkspaces = [];

        vm.loading = true;
        vm.scaleConfig = scaleConfig;
        vm.showActive = stateService.getShowActiveWorkspaces();
        vm.workspaces = [];
        vm.localWorkspaces = [];
        vm.activeWorkspace = {};
        vm.addBtnClass = 'btn-primary';
        vm.addBtnIcon = 'fa-plus-circle';
        vm.saveBtnClass = 'btn-default';
        vm.mode = 'view';
        vm.user = userService.getUserCreds();
        vm.readonly = !(vm.user && vm.user.is_admin);
        vm.brokerDescription = '';
        vm.availableWorkspaceTypes = _.cloneDeep(scaleConfig.workspaceTypes);

        vm.cancelCreate = function () {
            vm.mode = 'view';
            // revert any changes to the workspace
            vm.activeWorkspace = Workspace.transformer(_.cloneDeep(currWorkspace));
            if ($routeParams.id === '0') {
                $location.path('/workspaces');
            }
        };

        vm.editWorkspace = function () {
            // store a reference of the workspace as it currently exists in case the user cancels the edit
            currWorkspace = Workspace.transformer(_.cloneDeep(vm.activeWorkspace));
            vm.mode = 'edit';
        };

        vm.saveWorkspace = function () {
            workspacesService.saveWorkspace(vm.activeWorkspace).then(function (workspace) {
                vm.activeWorkspace = Workspace.transformer(workspace);
                if (scaleConfig.static) {
                    localStorage.setItem('workspace' + vm.activeWorkspace.id, JSON.stringify(vm.activeWorkspace));
                }
                vm.mode = 'view';
                getWorkspaces();
            }).catch(function () {
                
            });
        };

        vm.clearLocalWorkspaces = function () {
            _.forEach(vm.localWorkspaces, function (workspace) {
                localStorage.removeItem('workspace' + workspace.id);
            });
            $location.path('/workspaces');
        };
        
        vm.newWorkspace = function () {
            vm.mode = 'add';
            vm.loadWorkspace(0);
        };

        vm.loadWorkspace = function (id) {
            $location.path('workspaces/' + id);
        };

        var getWarningsHtml = function (warnings) {
            var warningsHtml = '';
            _.forEach(warnings, function (warning) {
                warningsHtml += '<b>' + warning.id + ':</b> ' + warning.details + '<br /><br />';
            });
            warningsHtml += '<button type="button" class="btn btn-default btn-xs clear">Hide</button>';
            return warningsHtml;
        };

        vm.validateWorkspace = function () {
            vm.loading = true;
            workspacesService.validateWorkspace(vm.activeWorkspace).then(function (data) {
                if (data.warnings && data.warnings.length > 0) {
                    // display the warnings
                    var warningsHtml = getWarningsHtml(data.warnings);
                    toastr['error'](warningsHtml);
                } else {
                    toastr['success']('Workspace is valid.');
                }
            }).catch(function (error) {
                if (error.detail) {
                    toastr['error'](error.detail);
                } else {
                    toastr['error'](error);
                }
            }).finally(function () {
                vm.loading = false;
            });
        };

        $scope.$watch('vm.activeWorkspace.json_config.broker.type', function (newValue) {
            if (newValue === 'nfs') {
                vm.brokerDescription = scaleConfig.nfsBrokerDescription;
            } else if (newValue === 'host') {
                vm.brokerDescription = scaleConfig.hostBrokerDescription;
            } else if (newValue === 's3') {
                vm.brokerDescription = scaleConfig.s3BrokerDescription;
            }
        });

        $scope.$watch('vm.showActive', function (newValue, oldValue) {
            if (angular.equals(newValue, oldValue)) {
                return;
            }
            vm.showActive = newValue;
            stateService.setShowActiveWorkspaces(newValue);
            vm.workspaces = vm.showActive ? _.cloneDeep(activeWorkspaces) : _.cloneDeep(inactiveWorkspaces);
        });

        var getWorkspaces = function () {
            vm.loading = true;
            workspacesService.getWorkspaces().then(function (data) {
                if (scaleConfig.static) {
                    var i = 0,
                        oJson = {},
                        sKey;
                    for (; sKey = localStorage.key(i); i++) {
                        oJson[sKey] = localStorage.getItem(sKey);
                    }
                    _.filter(_.pairs(oJson), function (o) {
                        if (_.contains(o[0], 'workspace')) {
                            var type = JSON.parse(o[1]);
                            vm.localWorkspaces.push(type);
                            data.push(type);
                        }
                    });
                }
                activeWorkspaces = _.filter(data, { 'is_active': true });
                inactiveWorkspaces = _.filter(data, { 'is_active': false });
                vm.workspaces = vm.showActive ? _.cloneDeep(activeWorkspaces) : _.cloneDeep(inactiveWorkspaces);
                vm.loading = false;
            }).catch(function (error) {
                vm.loading = false;
                console.log(error);
            });
        };

        var initialize = function () {
            getWorkspaces();
            vm.activeWorkspace = null;
            vm.mode = 'view';

            if ($routeParams.id) {
                var id = parseInt($routeParams.id);
                if (id === 0) {
                    vm.mode = 'add';
                    vm.activeWorkspace = new Workspace();
                } else {
                    // set activeWorkspace = workspace details for id
                    workspacesService.getWorkspaceDetails(id).then(function (data) {
                        vm.activeWorkspace = Workspace.transformer(data);
                    });
                }
            }
            navService.updateLocation('workspaces');
        };

        initialize();

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                containerMaxHeight = viewport.height - offset + 60;

            vm.containerStyle = 'height: ' + containerMaxHeight + 'px; max-height: ' + containerMaxHeight + 'px;';
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('Workspace', ['scaleConfig', function (scaleConfig) {
        var Workspace = function (id, name, title, description, base_url, is_active, used_size, total_size, created, archived, last_modified, json_config) {
            this.id = id;
            this.name = name;
            this.title = title;
            this.description = description;
            this.base_url = base_url;
            this.is_active = is_active;
            this.used_size = used_size;
            this.total_size = total_size;
            this.created = created;
            this.archived = archived;
            this.last_modified = last_modified;
            this.json_config = json_config || _.cloneDeep(scaleConfig.workspaceTypes[0]);
        };

        Workspace.prototype = {
            clean: function () {
                return {
                    name: this.name,
                    title: this.title,
                    description: this.description,
                    base_url: this.base_url,
                    is_active: this.is_active,
                    json_config: this.json_config
                };
            }
        };

        // static methods, assigned to class
        Workspace.build = function (data) {
            if (data) {
                return new Workspace(
                    data.id,
                    data.name,
                    data.title,
                    data.description,
                    data.base_url,
                    data.is_active,
                    data.used_size,
                    data.total_size,
                    data.created,
                    data.archived,
                    data.last_modified,
                    data.json_config
                );
            }
            return new Workspace();
        };

        Workspace.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(Workspace.build);
            }
            return Workspace.build(data);
        };

        return Workspace;
    }]);
})();

(function () {
    'use strict';
    /**
     *
     */
    angular.module('scaleApp').service('recipeService', ['$http', '$q', '$timeout', 'scaleConfig', 'RecipeType', 'RecipeTypeDetail', 'Recipe', 'RecipeDetails', 'RecipeTypeValidation', function ($http, $q, $timeout, scaleConfig, RecipeType, RecipeTypeDetail, Recipe, RecipeDetails, RecipeTypeValidation) {
        var getRecipesParams = function (page, page_size, started, ended, order, completed, recipe_type_id, recipe_type_name, url) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order,
                completed: completed,
                recipe_type_id: recipe_type_id,
                recipe_type_name: recipe_type_name,
                url: url
            };
        };

        var getRecipeTypesParams = function (page, page_size, started, ended, order) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order ? order : ['title', 'version']
            };
        };

        return {
            getRecipeTypes: function (params) {
                params = params || getRecipeTypesParams();
                var d = $q.defer();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'recipe-types/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = RecipeType.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                
                return d.promise;
            },

            getRecipeTypeDetail: function (id) {
              var d = $q.defer();

              $http.get(scaleConfig.urls.apiPrefix + 'recipe-types/' + id + '/').success(function (data) {
                  var returnData = RecipeTypeDetail.transformer(data);
                  d.resolve(returnData);
              });
              return d.promise;
            },

            getRecipes: function (params) {
                params = params || getRecipesParams();
                var d = $q.defer();

                $http({
                    url: params.url ? params.url : scaleConfig.urls.apiPrefix + 'recipes/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = Recipe.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },

            getRecipeDetails: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.urls.apiPrefix + 'recipes/' + id + '/').success(function (data) {
                    var result = RecipeDetails.transformer(data);
                    d.resolve(result);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },

            saveRecipeType: function (recipeType) {
                var d = $q.defer();
                var cleanRecipeType = RecipeTypeValidation.transformer(recipeType);

                if (!cleanRecipeType.id) {
                    $http.post(scaleConfig.urls.apiPrefix + 'recipe-types/', cleanRecipeType).success(function (result) {
                        d.resolve(result);
                    }).error(function(error){
                        d.reject(error);
                    });
                } else {
                    $http.patch(scaleConfig.urls.apiPrefix + 'recipe-types/' + cleanRecipeType.id + '/', cleanRecipeType).success(function (result) {
                        recipeType = result;
                        d.resolve(recipeType);
                    }).error(function(error){
                        d.reject(error);
                    });
                }

                return d.promise;
            },

            validateRecipeType: function (recipeType) {
                var d = $q.defer();
                var cleanRecipeType = RecipeTypeValidation.transformer(recipeType);

                $http.post(scaleConfig.urls.apiPrefix + 'recipe-types/validation/', cleanRecipeType).success(function (result) {
                    d.resolve(result);
                }).error(function(error){
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('workspacesService', ['$http', '$q', '$resource', 'scaleConfig', function ($http, $q, $resource, scaleConfig) {
        return {
            getWorkspaces: function () {
                var d = $q.defer();
                var url = scaleConfig.urls.apiPrefix + 'workspaces/';

                $http({
                    url: url,
                    method: 'GET',
                    params: { order: '-title' }
                }).success(function (data) {
                    d.resolve(data.results);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getWorkspaceDetails: function (id) {
                var d = $q.defer();
                var url = scaleConfig.urls.apiPrefix + 'workspaces/' + id + '/';

                $http({
                    url: url,
                    method: 'GET'
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;

            },
            validateWorkspace: function (workspace) {
                var d = $q.defer();
                var cleanWorkspace = workspace.clean();

                $http.post(scaleConfig.urls.apiPrefix + 'workspaces/validation/', cleanWorkspace).success(function (result) {
                    d.resolve(result);
                }).error(function(error){
                    d.reject(error);
                });

                return d.promise;
            },
            saveWorkspace: function (workspace) {
                var d = $q.defer();

                if (!workspace.id) {
                    $http.post(scaleConfig.urls.apiPrefix + 'workspaces/', workspace.clean()).success(function (result) {
                        d.resolve(result);
                    }).error(function (error) {
                        d.reject(error);
                    });
                } else {
                    $http.patch(scaleConfig.urls.apiPrefix + 'workspaces/' + workspace.id + '/', workspace.clean()).success(function (result) {
                        workspace = result;
                        d.resolve(workspace);
                    }).error(function (error) {
                        d.reject(error);
                    });
                }

                return d.promise;
            }
        };
    }]);
})();

/**
 * @author Dimitry Kudrayvtsev
 * @version 2.1
 */

 var updateWindow = function(){
    //  x = w.innerWidth || e.clientWidth || g.clientWidth;
    //  y = w.innerHeight|| e.clientHeight|| g.clientHeight;
     //
    //  svg.attr("width", x).attr("height", y);
    console.log('resize');
 };

 window.onresize = updateWindow;

d3.gantt = function() {
    var FIT_TIME_DOMAIN_MODE = "fit";
    var FIXED_TIME_DOMAIN_MODE = "fixed";

    var margin = {
		top : 20,
		right : 20,
		bottom : 20,
		left : 60
    };
    var timeDomainStart = d3.time.day.offset(new Date(),-3);
    var timeDomainEnd = d3.time.hour.offset(new Date(),+3);
    var timeDomainMode = FIT_TIME_DOMAIN_MODE;// fixed or fit
    var taskTypes = [];
    var taskStatus = [];
    var height = document.body.clientHeight - margin.top - margin.bottom-5;
    var width = document.body.clientWidth - margin.right - margin.left-5;
	var renderTo = "body";
	var begin = '';
	var ended = '';

    var tickFormat = "%H:%M:%S";

    var keyFunction = function(d) {
		return d[begin] + d.taskName + d[ended];
    };

    var rectTransform = function(d) {
		return "translate(" + x(d[begin]) + "," + y(d.taskName) + ")";
    };

    var x = d3.time.scale().domain([ timeDomainStart, timeDomainEnd ]).range([ 0, width ]).clamp(true);

    var y = d3.scale.ordinal().domain(taskTypes).rangeRoundBands([ 0, height - margin.top - margin.bottom ], .1);

    var xAxis = d3.svg.axis().scale(x).orient("bottom").tickFormat(d3.time.format(tickFormat)).tickSubdivide(true)
	    .tickSize(8).tickPadding(8);

    var yAxis = d3.svg.axis().scale(y).orient("left").tickSize(0);

    var initTimeDomain = function(tasks) {
	if (timeDomainMode === FIT_TIME_DOMAIN_MODE) {
	    if (tasks === undefined || tasks.length < 1) {
		timeDomainStart = d3.time.day.offset(new Date(), -3);
		timeDomainEnd = d3.time.hour.offset(new Date(), +3);
		return;
	    }
	    tasks.sort(function(a, b) {
		return a[ended] - b[ended];
	    });
	    timeDomainEnd = tasks[tasks.length - 1][ended];
	    tasks.sort(function(a, b) {
		return a[begin] - b[begin];
	    });
	    timeDomainStart = tasks[0][begin];
	}
    };

    var initAxis = function() {
	x = d3.time.scale().domain([ timeDomainStart, timeDomainEnd ]).range([ 0, width ]).clamp(true);
	y = d3.scale.ordinal().domain(taskTypes).rangeRoundBands([ 0, height - margin.top - margin.bottom ], .1);
	xAxis = d3.svg.axis().scale(x).orient("bottom").ticks(Math.ceil(width/150)).tickFormat(d3.time.format(tickFormat)).tickSubdivide(true)
		.tickSize(8).tickPadding(8);

	yAxis = d3.svg.axis().scale(y).orient("left").tickSize(0);
    };

    function gantt(tasks) {

	initTimeDomain(tasks);
	initAxis();

	var svg = d3.select(renderTo)
	.append("svg")
	.attr("class", "chart")
	.attr("width", width + margin.left + margin.right)
	.attr("height", height + margin.top + margin.bottom)
	.append("g")
        .attr("class", "gantt-chart")
	.attr("width", width + margin.left + margin.right)
	.attr("height", height + margin.top + margin.bottom)
	.attr("transform", "translate(" + margin.left + ", " + margin.top + ")");

      svg.selectAll(".chart")
	 .data(tasks, keyFunction).enter()
	 .append("rect")
	 .attr("rx", 5)
         .attr("ry", 5)
	 .attr("class", function(d){
	     if(taskStatus[d.status] == null){ return "bar";}
	     return taskStatus[d.status];
	     })
	 .attr("y", 0)
	 .attr("transform", rectTransform)
	 .attr("height", function(d) { return y.rangeBand(); })
	 .attr("width", function(d) {
	     return (x(d[ended]) - x(d[begin]));
	     });


	 svg.append("g")
	 .attr("class", "x axis")
	 .attr("transform", "translate(0, " + (height - margin.top - margin.bottom) + ")")
	 .transition()
	 .call(xAxis);

	 svg.append("g").attr("class", "y axis").transition().call(yAxis);

	 return gantt;

    };

    gantt.redraw = function(tasks) {
        console.log('redraw');
	initTimeDomain(tasks);
	initAxis();

        var svg = d3.select("svg");

        var ganttChartGroup = svg.select(".gantt-chart");
        var rect = ganttChartGroup.selectAll("rect").data(tasks, keyFunction);

        rect.enter()
         .insert("rect",":first-child")
         .attr("rx", 5)
         .attr("ry", 5)
	 .attr("class", function(d){
	     if(taskStatus[d.status] == null){ return "bar";}
	     return taskStatus[d.status];
	     })
	 .transition()
	 .attr("y", 0)
	 .attr("transform", rectTransform)
	 .attr("height", function(d) { return y.rangeBand(); })
	  .attr("width", function(d) {
	     return (x(d[ended]) - x(d[begin]));
	     });

        rect.transition()
          .attr("transform", rectTransform)
	 .attr("height", function(d) { return y.rangeBand(); })
	 .attr("width", function(d) {
	     return (x(d[ended]) - x(d[begin]));
	     });

	rect.exit().remove();

	svg.select(".x").transition().call(xAxis);
	svg.select(".y").transition().call(yAxis);

	return gantt;
    };

    gantt.margin = function(value) {
	if (!arguments.length)
	    return margin;
	margin = value;
	return gantt;
    };

    gantt.timeDomain = function(value) {
	if (!arguments.length)
	    return [ timeDomainStart, timeDomainEnd ];
	timeDomainStart = +value[0], timeDomainEnd = +value[1];
	return gantt;
    };

    /**
     * @param {string}
     *                vale The value can be "fit" - the domain fits the data or
     *                "fixed" - fixed domain.
     */
    gantt.timeDomainMode = function(value) {
	if (!arguments.length)
	    return timeDomainMode;
        timeDomainMode = value;
        return gantt;

    };

    gantt.taskTypes = function(value) {
	if (!arguments.length)
	    return taskTypes;
	taskTypes = value;
	return gantt;
    };

    gantt.taskStatus = function(value) {
	if (!arguments.length)
	    return taskStatus;
	taskStatus = value;
	return gantt;
    };

	gantt.begin = function(value){
		if(!arguments.length){
			return begin;
		}
		begin = value;
		return gantt;
	};

	gantt.ended = function(value){
		if(!arguments.length){
			return ended;
		}
		ended = value;
		return gantt;
	};

    gantt.width = function(value) {
	if (!arguments.length)
	    return width;
	width = +value;
	return gantt;
    };

    gantt.height = function(value) {
	if (!arguments.length)
	    return height;
	height = +value;
	return gantt;
    };

    gantt.tickFormat = function(value) {
	if (!arguments.length)
	    return tickFormat;
	tickFormat = value;
	return gantt;
    };

	gantt.renderTo = function(value) {
		if(!arguments.length){
			return renderTo;
		}
		renderTo = value;
		return gantt;
	};



    return gantt;
};

function Gauge(placeholderName, configuration)
{
    this.placeholderName = placeholderName;

    var self = this; // for internal d3 functions

    this.configure = function(configuration)
    {
        this.config = configuration;

        this.config.size = this.config.size * 0.9;

        this.config.raduis = this.config.size * 0.97 / 2;
        this.config.cx = this.config.size / 2;
        this.config.cy = this.config.size / 2;

        this.config.min = undefined != configuration.min ? configuration.min : 0;
        this.config.max = undefined != configuration.max ? configuration.max : 100;
        this.config.range = this.config.max - this.config.min;

        this.config.majorTicks = configuration.majorTicks || 5;
        this.config.minorTicks = configuration.minorTicks || 2;

        this.config.greenColor 	= configuration.greenColor || "#8fca0e";
        this.config.yellowColor = configuration.yellowColor || "#ffc317";
        this.config.redColor 	= configuration.redColor || "#f54d36";

        this.config.transitionDuration = configuration.transitionDuration || 500;
    };

    this.render = function()
    {
        this.body = d3.select("#" + this.placeholderName)
            .append("svg:svg")
            .attr("class", "gauge")
            .attr("width", this.config.size)
            .attr("height", this.config.size);

        this.body.append("svg:circle")
            .attr("class", "outer-circle")
            .attr("cx", this.config.cx)
            .attr("cy", this.config.cy)
            .attr("r", this.config.raduis * 0.95)
            .style("fill", "#ccc");
            /*.style("stroke", "#000")
            .style("stroke-width", "0.5px");*/

        this.body.append("svg:circle")
            .attr("cx", this.config.cx)
            .attr("cy", this.config.cy)
            .attr("r", 0.9 * this.config.raduis)
            .style("fill", "#fff")
            .style("stroke", "#e0e0e0")
            .style("stroke-width", "2px");

        for (var greenIdx in this.config.greenZones)
        {
            this.drawBand(this.config.greenZones[greenIdx].from, this.config.greenZones[greenIdx].to, self.config.greenColor);
        }

        for (var yellowIdx in this.config.yellowZones)
        {
            this.drawBand(this.config.yellowZones[yellowIdx].from, this.config.yellowZones[yellowIdx].to, self.config.yellowColor);
        }

        for (var redIdx in this.config.redZones)
        {
            this.drawBand(this.config.redZones[redIdx].from, this.config.redZones[redIdx].to, self.config.redColor);
        }

        var fontSize = 0;

        if (undefined != this.config.label)
        {
            fontSize = Math.round(this.config.size / 9);
            this.body.append("svg:text")
                .attr("x", this.config.cx)
                .attr("y", this.config.cy / 2 + fontSize / 2)
                .attr("dy", fontSize / 2)
                .attr("text-anchor", "middle")
                .text(this.config.label)
                .style("font-size", fontSize + "px")
                .style("fill", "#333")
                .style("stroke-width", "0px");
        }

        fontSize = Math.round(this.config.size / 16);
        var majorDelta = this.config.range / (this.config.majorTicks - 1);
        for (var major = this.config.min; major <= this.config.max; major += majorDelta)
        {
            var minorDelta = majorDelta / this.config.minorTicks,
                point1 = 0,
                point2 = 0;
            for (var minor = major + minorDelta; minor < Math.min(major + majorDelta, this.config.max); minor += minorDelta)
            {
                point1 = this.valueToPoint(minor, 0.75);
                point2 = this.valueToPoint(minor, 0.85);

                this.body.append("svg:line")
                    .attr("x1", point1.x)
                    .attr("y1", point1.y)
                    .attr("x2", point2.x)
                    .attr("y2", point2.y)
                    .style("stroke", "#666")
                    .style("stroke-width", "1px");
            }

            point1 = this.valueToPoint(major, 0.7);
            point2 = this.valueToPoint(major, 0.85);

            this.body.append("svg:line")
                .attr("x1", point1.x)
                .attr("y1", point1.y)
                .attr("x2", point2.x)
                .attr("y2", point2.y)
                .style("stroke", "#333")
                .style("stroke-width", "2px");

            if (major == this.config.min || major == this.config.max)
            {
                var point = this.valueToPoint(major, 0.63);

                this.body.append("svg:text")
                    .attr("x", point.x)
                    .attr("y", point.y)
                    .attr("dy", fontSize / 3)
                    .attr("text-anchor", major == this.config.min ? "start" : "end")
                    .text(major)
                    .style("font-size", fontSize + "px")
                    .style("fill", "#333")
                    .style("stroke-width", "0px");
            }
        }

        var pointerContainer = this.body.append("svg:g").attr("class", "pointerContainer");

        var midValue = (this.config.min + this.config.max) / 2;

        var pointerPath = this.buildPointerPath(midValue);

        var pointerLine = d3.svg.line()
            .x(function(d) { return d.x })
            .y(function(d) { return d.y })
            .interpolate("basis");

        pointerContainer.selectAll("path")
            .data([pointerPath])
            .enter()
            .append("svg:path")
            .attr("d", pointerLine)
            .style("fill", "#888");

        pointerContainer.append("svg:circle")
            .attr("cx", this.config.cx)
            .attr("cy", this.config.cy)
            .attr("r", 0.12 * this.config.raduis)
            .style("fill", "#888");

        fontSize = Math.round(this.config.size / 10);
        pointerContainer.selectAll("text")
            .data([midValue])
            .enter()
            .append("svg:text")
            .attr("x", this.config.cx)
            .attr("y", this.config.size - this.config.cy / 4 - fontSize)
            .attr("dy", fontSize / 2)
            .attr("text-anchor", "middle")
            .style("font-size", fontSize + "px")
            .style("fill", "#000")
            .style("stroke-width", "0px");

        this.redraw(this.config.min, 0);
    };

    this.buildPointerPath = function(value)
    {
        var delta = this.config.range / 13;

        var head = valueToPoint(value, 0.85);
        var head1 = valueToPoint(value - delta, 0.12);
        var head2 = valueToPoint(value + delta, 0.12);

        var tailValue = value - (this.config.range * (1/(270/360)) / 2);
        var tail = valueToPoint(tailValue, 0.28);
        var tail1 = valueToPoint(tailValue - delta, 0.12);
        var tail2 = valueToPoint(tailValue + delta, 0.12);

        return [head, head1, tail2, tail, tail1, head2, head];

        function valueToPoint(value, factor)
        {
            var point = self.valueToPoint(value, factor);
            point.x -= self.config.cx;
            point.y -= self.config.cy;
            return point;
        }
    };

    this.drawBand = function(start, end, color)
    {
        if (0 >= end - start) return;

        this.body.append("svg:path")
            .style("fill", color)
            .attr("d", d3.svg.arc()
                .startAngle(this.valueToRadians(start))
                .endAngle(this.valueToRadians(end))
                .innerRadius(0.65 * this.config.raduis)
                .outerRadius(0.85 * this.config.raduis))
            .attr("transform", function() { return "translate(" + self.config.cx + ", " + self.config.cy + ") rotate(270)" });
    };

    this.redraw = function(value, transitionDuration)
    {
        var pointerContainer = this.body.select(".pointerContainer");

        pointerContainer.selectAll("text").text(Math.round(value));

        var pointer = pointerContainer.selectAll("path");
        pointer.transition()
            .duration(undefined != transitionDuration ? transitionDuration : this.config.transitionDuration)
            //.delay(0)
            //.ease("linear")
            //.attr("transform", function(d)
            .attrTween("transform", function()
            {
                var pointerValue = value;
                if (value > self.config.max) pointerValue = self.config.max + 0.02*self.config.range;
                else if (value < self.config.min) pointerValue = self.config.min - 0.02*self.config.range;
                var targetRotation = (self.valueToDegrees(pointerValue) - 90);
                var currentRotation = self._currentRotation || targetRotation;
                self._currentRotation = targetRotation;

                return function(step)
                {
                    var rotation = currentRotation + (targetRotation-currentRotation)*step;
                    return "translate(" + self.config.cx + ", " + self.config.cy + ") rotate(" + rotation + ")";
                }
            });

        var outerCircle = this.body.select(".outer-circle")
            .transition()
            .duration(750)
            .style("fill", function () {
                var i = parseInt(value);
                if (i > 0 && i < 75) {
                    return self.config.greenColor;
                } else if (i >= 75 && i < 90) {
                    return self.config.yellowColor;
                } else {
                    return self.config.redColor;
                }
            });
    };

    this.valueToDegrees = function(value)
    {
        // thanks @closealert
        //return value / this.config.range * 270 - 45;
        return value / this.config.range * 270 - (this.config.min / this.config.range * 270 + 45);
    };

    this.valueToRadians = function(value)
    {
        return this.valueToDegrees(value) * Math.PI / 180;
    };

    this.valueToPoint = function(value, factor)
    {
        return { 	x: this.config.cx - this.config.raduis * factor * Math.cos(this.valueToRadians(value)),
            y: this.config.cy - this.config.raduis * factor * Math.sin(this.valueToRadians(value)) 		};
    };

    // initialization
    this.configure(configuration);
}
/*! 
 * angular-hotkeys v1.5.0
 * https://chieffancypants.github.io/angular-hotkeys
 * Copyright (c) 2015 Wes Cruver
 * License: MIT
 */
!function(){"use strict";angular.module("cfp.hotkeys",[]).provider("hotkeys",["$injector",function(a){this.includeCheatSheet=!0,this.useNgRoute=a.has("ngViewDirective"),this.templateTitle="Keyboard Shortcuts:",this.templateHeader=null,this.templateFooter=null,this.template='<div class="cfp-hotkeys-container fade" ng-class="{in: helpVisible}" style="display: none;"><div class="cfp-hotkeys"><h4 class="cfp-hotkeys-title" ng-if="!header">{{ title }}</h4><div ng-bind-html="header" ng-if="header"></div><table><tbody><tr ng-repeat="hotkey in hotkeys | filter:{ description: \'!$$undefined$$\' }"><td class="cfp-hotkeys-keys"><span ng-repeat="key in hotkey.format() track by $index" class="cfp-hotkeys-key">{{ key }}</span></td><td class="cfp-hotkeys-text">{{ hotkey.description }}</td></tr></tbody></table><div ng-bind-html="footer" ng-if="footer"></div><div class="cfp-hotkeys-close" ng-click="toggleCheatSheet()"></div></div></div>',this.cheatSheetHotkey="?",this.cheatSheetDescription="Show / hide this help menu",this.$get=["$rootElement","$rootScope","$compile","$window","$document",function(a,b,c,d,e){function f(a){var b={command:"",shift:"",left:"",right:"",up:"",down:"","return":"",backspace:""};a=a.split("+");for(var c=0;c<a.length;c++)"mod"===a[c]&&(d.navigator&&d.navigator.platform.indexOf("Mac")>=0?a[c]="command":a[c]="ctrl"),a[c]=b[a[c]]||a[c];return a.join(" + ")}function g(a,b,c,d,e,f){this.combo=a instanceof Array?a:[a],this.description=b,this.callback=c,this.action=d,this.allowIn=e,this.persistent=f,this._formated=null}function h(){for(var a=o.hotkeys.length;a--;){var b=o.hotkeys[a];b&&!b.persistent&&k(b)}}function i(){o.helpVisible=!o.helpVisible,o.helpVisible?(t=l("esc"),k("esc"),j("esc",t.description,i,null,["INPUT","SELECT","TEXTAREA"])):(k("esc"),t!==!1&&j(t))}function j(a,b,c,d,e,f){var h,i=["INPUT","SELECT","TEXTAREA"],j=Object.prototype.toString.call(a);if("[object Object]"===j&&(b=a.description,c=a.callback,d=a.action,f=a.persistent,e=a.allowIn,a=a.combo),b instanceof Function?(d=c,c=b,b="$$undefined$$"):angular.isUndefined(b)&&(b="$$undefined$$"),void 0===f&&(f=!0),"function"==typeof c){h=c,e instanceof Array||(e=[]);for(var k,l=0;l<e.length;l++)e[l]=e[l].toUpperCase(),k=i.indexOf(e[l]),-1!==k&&i.splice(k,1);c=function(a){var b=!0,c=a.target||a.srcElement,d=c.nodeName.toUpperCase();if((" "+c.className+" ").indexOf(" mousetrap ")>-1)b=!0;else for(var e=0;e<i.length;e++)if(i[e]===d){b=!1;break}b&&n(h.apply(this,arguments))}}"string"==typeof d?Mousetrap.bind(a,n(c),d):Mousetrap.bind(a,n(c));var m=new g(a,b,c,d,e,f);return o.hotkeys.push(m),m}function k(a){var b=a instanceof g?a.combo:a;if(Mousetrap.unbind(b),angular.isArray(b)){for(var c=!0,d=b.length;d--;)c=k(b[d])&&c;return c}var e=o.hotkeys.indexOf(l(b));return e>-1?(o.hotkeys[e].combo.length>1?o.hotkeys[e].combo.splice(o.hotkeys[e].combo.indexOf(b),1):o.hotkeys.splice(e,1),!0):!1}function l(a){if(!a)return o.hotkeys;for(var b,c=0;c<o.hotkeys.length;c++)if(b=o.hotkeys[c],b.combo.indexOf(a)>-1)return b;return!1}function m(a){return a.$id in p||(p[a.$id]=[],a.$on("$destroy",function(){for(var b=p[a.$id].length;b--;)k(p[a.$id].pop())})),{add:function(b){var c;return c=arguments.length>1?j.apply(this,arguments):j(b),p[a.$id].push(c),this}}}function n(a){return function(c,d){if(a instanceof Array){var e=a[0],f=a[1];a=function(a){f.scope.$eval(e)}}b.$apply(function(){a(c,l(d))})}}Mousetrap.prototype.stopCallback=function(a,b){return(" "+b.className+" ").indexOf(" mousetrap ")>-1?!1:b.contentEditable&&"true"==b.contentEditable},g.prototype.format=function(){if(null===this._formated){for(var a=this.combo[0],b=a.split(/[\s]/),c=0;c<b.length;c++)b[c]=f(b[c]);this._formated=b}return this._formated};var o=b.$new();o.hotkeys=[],o.helpVisible=!1,o.title=this.templateTitle,o.header=this.templateHeader,o.footer=this.templateFooter,o.toggleCheatSheet=i;var p=[];if(this.useNgRoute&&b.$on("$routeChangeSuccess",function(a,b){h(),b&&b.hotkeys&&angular.forEach(b.hotkeys,function(a){var c=a[2];("string"==typeof c||c instanceof String)&&(a[2]=[c,b]),a[5]=!1,j.apply(this,a)})}),this.includeCheatSheet){var q=e[0],r=a[0],s=angular.element(this.template);j(this.cheatSheetHotkey,this.cheatSheetDescription,i),(r===q||r===q.documentElement)&&(r=q.body),angular.element(r).append(c(s)(o))}var t=!1,u={add:j,del:k,get:l,bindTo:m,template:this.template,toggleCheatSheet:i,includeCheatSheet:this.includeCheatSheet,cheatSheetHotkey:this.cheatSheetHotkey,cheatSheetDescription:this.cheatSheetDescription,useNgRoute:this.useNgRoute,purgeHotkeys:h,templateTitle:this.templateTitle};return u}]}]).directive("hotkey",["hotkeys",function(a){return{restrict:"A",link:function(b,c,d){var e,f;angular.forEach(b.$eval(d.hotkey),function(b,c){f="string"==typeof d.hotkeyAllowIn?d.hotkeyAllowIn.split(/[\s,]+/):[],e=c,a.add({combo:c,description:d.hotkeyDescription,callback:b,action:d.hotkeyAction,allowIn:f})}),c.bind("$destroy",function(){a.del(e)})}}}]).run(["hotkeys",function(a){}])}(),function(a,b,c){function d(a,b,c){return a.addEventListener?void a.addEventListener(b,c,!1):void a.attachEvent("on"+b,c)}function e(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase()),b}return r[a.which]?r[a.which]:s[a.which]?s[a.which]:String.fromCharCode(a.which).toLowerCase()}function f(a,b){return a.sort().join(",")===b.sort().join(",")}function g(a){var b=[];return a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),b}function h(a){return a.preventDefault?void a.preventDefault():void(a.returnValue=!1)}function i(a){return a.stopPropagation?void a.stopPropagation():void(a.cancelBubble=!0)}function j(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function k(){if(!q){q={};for(var a in r)a>95&&112>a||r.hasOwnProperty(a)&&(q[r[a]]=a)}return q}function l(a,b,c){return c||(c=k()[a]?"keydown":"keypress"),"keypress"==c&&b.length&&(c="keydown"),c}function m(a){return"+"===a?["+"]:(a=a.replace(/\+{2}/g,"+plus"),a.split("+"))}function n(a,b){var c,d,e,f=[];for(c=m(a),e=0;e<c.length;++e)d=c[e],u[d]&&(d=u[d]),b&&"keypress"!=b&&t[d]&&(d=t[d],f.push("shift")),j(d)&&f.push(d);return b=l(d,f,b),{key:d,modifiers:f,action:b}}function o(a,c){return a===b?!1:a===c?!0:o(a.parentNode,c)}function p(a){function c(a){a=a||{};var b,c=!1;for(b in u)a[b]?c=!0:u[b]=0;c||(x=!1)}function k(a,b,c,d,e,g){var h,i,k=[],l=c.type;if(!s._callbacks[a])return[];for("keyup"==l&&j(a)&&(b=[a]),h=0;h<s._callbacks[a].length;++h)if(i=s._callbacks[a][h],(d||!i.seq||u[i.seq]==i.level)&&l==i.action&&("keypress"==l&&!c.metaKey&&!c.ctrlKey||f(b,i.modifiers))){var m=!d&&i.combo==e,n=d&&i.seq==d&&i.level==g;(m||n)&&s._callbacks[a].splice(h,1),k.push(i)}return k}function l(a,b,c,d){s.stopCallback(b,b.target||b.srcElement,c,d)||a(b,c)===!1&&(h(b),i(b))}function m(a){"number"!=typeof a.which&&(a.which=a.keyCode);var b=e(a);if(b)return"keyup"==a.type&&v===b?void(v=!1):void s.handleKey(b,g(a),a)}function o(){clearTimeout(t),t=setTimeout(c,1e3)}function q(a,b,d,f){function g(b){return function(){x=b,++u[a],o()}}function h(b){l(d,b,a),"keyup"!==f&&(v=e(b)),setTimeout(c,10)}u[a]=0;for(var i=0;i<b.length;++i){var j=i+1===b.length,k=j?h:g(f||n(b[i+1]).action);r(b[i],k,f,a,i)}}function r(a,b,c,d,e){s._directMap[a+":"+c]=b,a=a.replace(/\s+/g," ");var f,g=a.split(" ");return g.length>1?void q(a,g,b,c):(f=n(a,c),s._callbacks[f.key]=s._callbacks[f.key]||[],k(f.key,f.modifiers,{type:f.action},d,a,e),void s._callbacks[f.key][d?"unshift":"push"]({callback:b,modifiers:f.modifiers,action:f.action,seq:d,level:e,combo:a}))}var s=this;if(a=a||b,!(s instanceof p))return new p(a);s.target=a,s._callbacks={},s._directMap={};var t,u={},v=!1,w=!1,x=!1;s._handleKey=function(a,b,d){var e,f=k(a,b,d),g={},h=0,i=!1;for(e=0;e<f.length;++e)f[e].seq&&(h=Math.max(h,f[e].level));for(e=0;e<f.length;++e)if(f[e].seq){if(f[e].level!=h)continue;i=!0,g[f[e].seq]=1,l(f[e].callback,d,f[e].combo,f[e].seq)}else i||l(f[e].callback,d,f[e].combo);var m="keypress"==d.type&&w;d.type!=x||j(a)||m||c(g),w=i&&"keydown"==d.type},s._bindMultiple=function(a,b,c){for(var d=0;d<a.length;++d)r(a[d],b,c)},d(a,"keypress",m),d(a,"keydown",m),d(a,"keyup",m)}for(var q,r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},s={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},t={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},u={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},v=1;20>v;++v)r[111+v]="f"+v;for(v=0;9>=v;++v)r[v+96]=v;p.prototype.bind=function(a,b,c){var d=this;return a=a instanceof Array?a:[a],d._bindMultiple.call(d,a,b,c),d},p.prototype.unbind=function(a,b){var c=this;return c.bind.call(c,a,function(){},b)},p.prototype.trigger=function(a,b){var c=this;return c._directMap[a+":"+b]&&c._directMap[a+":"+b]({},a),c},p.prototype.reset=function(){var a=this;return a._callbacks={},a._directMap={},a},p.prototype.stopCallback=function(a,b){var c=this;return(" "+b.className+" ").indexOf(" mousetrap ")>-1?!1:o(b,c.target)?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable},p.prototype.handleKey=function(){var a=this;return a._handleKey.apply(a,arguments)},p.init=function(){var a=p(b);for(var c in a)"_"!==c.charAt(0)&&(p[c]=function(b){return function(){return a[b].apply(a,arguments)}}(c))},p.init(),a.Mousetrap=p,"undefined"!=typeof module&&module.exports&&(module.exports=p),"function"==typeof define&&define.amd&&define(function(){return p})}(window,document);
if (!String.prototype.includes) {
    String.prototype.includes = function(search, start) {
        'use strict';
        if (typeof start !== 'number') {
            start = 0;
        }

        if (start + search.length > this.length) {
            return false;
        } else {
            return this.indexOf(search, start) !== -1;
        }
    };
}
(function () {
    'use strict';

    angular.module('scaleApp').config(['$provide', function ($provide) {
        $provide.decorator('$httpBackend', angular.mock.e2e.$httpBackendDecorator);
    }]).run(['$httpBackend', 'scaleConfig', 'XMLHttpRequest', function ($httpBackend, scaleConfig, XMLHttpRequest) {

        var getSync = function (url) {
            var request = new XMLHttpRequest();
            request.open('GET', url, false);
            request.send(null);
            return [request.status, request.response, {}];
        };

        var getUrlParams = function (url) {
            var obj = {};

            if (url && url.split('?').length > 1) {
                url.split('?')[1].split('&').forEach(function (item) {
                    var s = item.split('='),
                        k = s[0],
                        v = s[1] && decodeURIComponent(s[1]);
                    (k in obj) ? obj[k].push(v) : obj[k] = [v]
                });
            }

            return obj;
        };

        // Ingests Status
        var ingestsStatusRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'ingests/status/', 'i');
        $httpBackend.whenGET(ingestsStatusRegex).respond(function () {
            var strikes = JSON.parse(getSync('test/data/ingestStrikes.json')[1]),
                startDate = moment.utc().subtract(1, 'w').startOf('d').toISOString(),
                endDate = moment.utc().add(1, 'd').startOf('d').toISOString(),
                numHours = moment.utc(endDate).diff(moment.utc(startDate), 'h'),
                thisTime = '',
                values = [],
                results = [];

            _.forEach(strikes.results, function (strike) {
                values = [];

                for (var i = 0; i < numHours; i++) {
                    thisTime = moment.utc(startDate).add(i, 'h').toISOString();
                    values.push({
                        time: thisTime,
                        files: Math.floor(Math.random() * (500 - 5 + 1)) + 5,
                        size: Math.floor(Math.random() * (500000000 - 5000000 + 1)) + 5000000
                    });
                }

                results.push({
                    strike: strike,
                    most_recent: moment.utc().startOf('h').toISOString(),
                    files: 2,
                    size: 123456789,
                    values: values
                });
            });

            var data = {
                count: 2,
                next: null,
                previous: null,
                results: results
            };

            return [200, data, {}];
        });

        // Ingests
        var ingestsOverrideUrl = 'test/data/ingests.json';
        var ingestsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'ingests/', 'i');
        $httpBackend.whenGET(ingestsRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                returnObj = getSync(ingestsOverrideUrl),
                ingests = JSON.parse(returnObj[1]);

            if (urlParams.order && urlParams.order.length > 0) {
                var orders = [],
                    fields = [];
                _.forEach(urlParams.order, function (o) {
                    var order = o.charAt(0) === '-' ? 'desc' : 'asc',
                        field = order === 'desc' ? urlParams.order[0].substring(1) : urlParams.order[0];

                    orders.push(order);
                    fields.push(field);
                });

                ingests.results = _.sortByOrder(ingests.results, fields, orders);
            }

            if (urlParams.page && urlParams.page.length > 0) {
                var page = parseInt(urlParams.page[0]),
                    pageSize = parseInt(urlParams.page_size[0]);

                if (page === 1) {
                    ingests.results = _.take(ingests.results, pageSize);
                } else {
                    var startIdx = (page - 1) * pageSize,
                        idxArray = [];

                    for (var i = startIdx; i < ingests.results.length - 1; i++) {
                        idxArray.push(i);
                    }

                    ingests.results = _.at(ingests.results, idxArray);
                }
            }

            if (urlParams.status) {
                ingests.results = _.filter(ingests.results, function (ingest) {
                    return ingest.status === urlParams.status[0];
                });
            }

            returnObj[1] = JSON.stringify(ingests);

            return returnObj;
        });

        // Source details
        var sourceDetailsOverrideUrl = 'test/data/sourceDetails.json';
        var sourceDetailsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'sources/.*/', 'i');
        $httpBackend.whenGET(sourceDetailsRegex).respond(function (method, url) {
            // // get the jobType.id from the url
            // url = url.toString();
            // var filename = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            // sourceDetailsOverrideUrl = 'test/data/source-details/' + filename + '.json';
            return getSync(sourceDetailsOverrideUrl);
        });
        
        // Sources
        var sourcesOverrideUrl = 'test/data/sources.json';
        var sourcesRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'sources/', 'i');
        $httpBackend.whenGET(sourcesRegex).respond(function (method, url) {
            //return getSync(sourcesOverrideUrl);
            var urlParams = getUrlParams(url),
                returnObj = getSync(sourcesOverrideUrl),
                sources = JSON.parse(returnObj[1]);

            if (urlParams.file_name && urlParams.file_name.length > 0) {
                var orders = ['file_name'],
                    fields = ['asc'];

                sources.results = _.filter(sources.results, function (r) {
                    return r.file_name.toLowerCase().includes(urlParams.file_name[0].toLowerCase());
                });

                sources.results = _.sortByOrder(sources.results, fields, orders);
            }

            returnObj[1] = JSON.stringify(sources);

            return returnObj;
        });

        // Job load
        var jobLoadRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'load/', 'i');
        $httpBackend.whenGET(jobLoadRegex).respond(function () {
            var numHours = moment.utc().endOf('d').diff(moment.utc().subtract(7, 'd').startOf('d'), 'h');
            var startTime = moment.utc().subtract(7, 'd').startOf('d');
            var data = {
                count: numHours,
                next: null,
                previous: null,
                results: []
            };

            for (var i = 0; i < data.count; i++) {
                data.results.push({
                    time: moment.utc(startTime).add(i, 'h').toISOString(),
                    pending_count: Math.floor(Math.random() * (100 - 20 + 1)) + 20,
                    queued_count: Math.floor(Math.random() * (100 - 20 + 1)) + 20,
                    running_count: Math.floor(Math.random() * (100 - 20 + 1)) + 20
                });
            }

            return [200, data, {}];
        });

        // Job details
        var jobDetailsOverrideUrl = 'test/data/jobDetails.json';
        var jobDetailsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'jobs/.*/', 'i');
        $httpBackend.whenGET(jobDetailsRegex).respond(function (method, url) {
            // get the jobType.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            jobDetailsOverrideUrl = 'test/data/job-details/jobDetails' + id + '.json';
            return getSync(jobDetailsOverrideUrl);
        });

        // Jobs
        var jobsOverrideUrl = 'test/data/jobs.json';
        var jobsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'jobs/', 'i');
        $httpBackend.whenGET(jobsRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                returnObj = getSync(jobsOverrideUrl),
                jobs = JSON.parse(returnObj[1]);

            if (urlParams.order && urlParams.order.length > 0) {
                var orders = [],
                    fields = [];
                _.forEach(urlParams.order, function (o) {
                    var order = o.charAt(0) === '-' ? 'desc' : 'asc',
                        field = order === 'desc' ? urlParams.order[0].substring(1) : urlParams.order[0];

                    if (field === 'job_type') {
                        field = 'job_type.name';
                    }

                    orders.push(order);
                    fields.push(field);
                });

                jobs.results = _.sortByOrder(jobs.results, fields, orders);
            }

            if (urlParams.status) {
                jobs.results = _.filter(jobs.results, function (job) {
                    return job.status === urlParams.status[0];
                });
            }

            returnObj[1] = JSON.stringify(jobs);

            return returnObj;
        });

        // Job type status
        var jobTypeStatusOverrideUrl = 'test/data/jobTypeStatus.json';
        var jobTypeStatusRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'job-types/status/', 'i');
        $httpBackend.whenGET(jobTypeStatusRegex).respond(function () {
            return getSync(jobTypeStatusOverrideUrl);
        });

        // Running job types
        var runningJobsOverrideUrl = 'test/data/runningJobs.json';
        var runningJobsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'job-types/running/', 'i');
        $httpBackend.whenGET(runningJobsRegex).respond(function () {
            return getSync(runningJobsOverrideUrl);
        });

        // Job Type Details
        var jobTypeDetailsOverrideUrl = 'test/data/job-types/jobType1.json';
        var jobTypeDetailsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'job-types/.*/', 'i');
        $httpBackend.whenGET(jobTypeDetailsRegex).respond(function (method, url) {
            // get the jobType.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            jobTypeDetailsOverrideUrl = 'test/data/job-types/jobType' + id + '.json';
            return getSync(jobTypeDetailsOverrideUrl);
        });

        // Job types
        var jobTypesOverrideUrl = 'test/data/jobTypes.json';
        var jobTypesRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'job-types/', 'i');
        $httpBackend.whenGET(jobTypesRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                returnObj = getSync(jobTypesOverrideUrl),
                jobTypes = JSON.parse(returnObj[1]);

            if (urlParams.order && urlParams.order.length > 0) {
                var orders = [],
                    fields = [];
                _.forEach(urlParams.order, function (o) {
                    var order = o.charAt(0) === '-' ? 'desc' : 'asc',
                        field = order === 'desc' ? urlParams.order[0].substring(1) : urlParams.order[0];

                    orders.push(order);
                    fields.push(field);
                });

                jobTypes.results = _.sortByOrder(jobTypes.results, fields, orders);
            }

            returnObj[1] = JSON.stringify(jobTypes);

            return returnObj;
        });
        
        // Job execution logs
        var jobExecutionLogsOverrideUrl = 'test/data/jobExecutionLog.json';
        var jobExecutionLogRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'job-executions/.*/logs/', 'i');
        $httpBackend.whenGET(jobExecutionLogRegex).respond(function () {
            return getSync(jobExecutionLogsOverrideUrl);
        });


        // Metrics Plot Data Detail
        //var metricsPlotDataOverrideUrl = 'test/data/metricsJobTypesPlotData.json';
        var metricsPlotDataRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'metrics/.*/.*/','i');
        $httpBackend.whenGET(metricsPlotDataRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                random = 0;

            var returnObj = {
                count: 28,
                next: null,
                previous: null,
                results: []
            };

            var numDays = moment.utc(urlParams.ended[0]).diff(moment.utc(urlParams.started[0]), 'd') + 1;

            _.forEach(urlParams.column, function (metric) {
                var maxRandom = metric === 'total_count' ? 1000 : 200;
                var minRandom = metric === 'total_count' ? 800 : 10;
                var returnResult = {
                    column: { title: _.startCase(metric) },
                    min_x: moment.utc(urlParams.started[0]).format('YYYY-MM-DD'),
                    max_x: moment.utc(urlParams.ended[0]).format('YYYY-MM-DD'),
                    min_y: 1,
                    max_y: 1000,
                    values: []
                };

                for (var i = 0; i < numDays; i++) {
                    if (urlParams.choice_id && urlParams.choice_id.length > 1) {
                        _.forEach(urlParams.choice_id, function (id) {
                            random = Math.floor(Math.random() * (5 - 1 + 1)) + 1;
                            if (random <= 4) {
                                var value = Math.floor(Math.random() * (maxRandom - minRandom + 1)) + minRandom;
                                returnResult.values.push({
                                    date: moment.utc(urlParams.started[0]).add(i, 'd').format('YYYY-MM-DD'),
                                    value: value,
                                    id: parseInt(id)
                                });
                            }
                        });
                    } else {
                        random = Math.floor(Math.random() * (5 - 1 + 1)) + 1;
                        if (random <= 4) {
                            returnResult.values.push({
                                date: moment.utc(urlParams.started[0]).add(i, 'd').format('YYYY-MM-DD'),
                                value: Math.floor(Math.random() * (maxRandom - minRandom + 1)) + minRandom
                            });
                        }
                    }
                }
                returnObj.results.push(returnResult);
            });

            return [200, returnObj, {}];
        });

        // Metrics Detail
        var metricsDetailRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'metrics/.*/','i');
        $httpBackend.whenGET(metricsDetailRegex).respond(function (method, url) {
            var urlArr = url.split('/'),
                detailType = urlArr[urlArr.length - 2];

            if (detailType === 'job-types') {
                return getSync('test/data/metricsJobTypes.json');
            } else if (detailType === 'error-types') {
                return getSync('test/data/metricsErrorTypes.json');
            }
            return getSync('test/data/metricsIngest.json');
        });

        // Metrics
        var metricsOverrideUrl = 'test/data/metrics.json';
        var metricsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'metrics/','i');
        $httpBackend.whenGET(metricsRegex).respond(function () {
            return getSync(metricsOverrideUrl);
        });

        // Node status
        var nodeStatusOverrideUrl = 'test/data/nodeStatus.json';
        var nodeStatusRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'nodes/status/', 'i');
        $httpBackend.whenGET(nodeStatusRegex).respond(function () {
            return getSync(nodeStatusOverrideUrl);
        });

        // Node details
        var nodeOverrideUrl = 'test/data/node.json';
        var nodeRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'nodes/.*/', 'i');
        $httpBackend.whenGET(nodeRegex).respond(function () {
            return getSync(nodeOverrideUrl);
        });
        $httpBackend.whenPATCH(nodeRegex).respond(function () {
            return getSync(nodeOverrideUrl);
        });

        // Nodes
        var nodesOverrideUrl = 'test/data/nodes.json';
        var nodesRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'nodes/', 'i');
        $httpBackend.whenGET(nodesRegex).respond(function () {
            return getSync(nodesOverrideUrl);
        });

        // Queue Status service
        var queueStatusOverrideUrl = 'test/data/queueStatus.json';
        var queueStatusRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'queue/status/', 'i');
        $httpBackend.whenGET(queueStatusRegex).respond(function () {
            return getSync(queueStatusOverrideUrl);
        });
        
        // Recipe Details
        var recipeDetailsOverrideUrl = 'test/data/recipeDetails.json';
        var recipeDetailsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'recipes/.*/', 'i');
        $httpBackend.whenGET(recipeDetailsRegex).respond(function (method, url) {
            // get the recipeDetail.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            recipeDetailsOverrideUrl = 'test/data/recipe-details/recipeDetail' + id + '.json';
            return getSync(recipeDetailsOverrideUrl);
        });

        // Recipes service
        var recipesOverrideUrl = 'test/data/recipes.json';
        var recipesRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'recipes/', 'i');
        $httpBackend.whenGET(recipesRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                returnObj = getSync(recipesOverrideUrl),
                recipes = JSON.parse(returnObj[1]);

            if (urlParams.order && urlParams.order.length > 0) {
                var orders = [],
                    fields = [];
                _.forEach(urlParams.order, function (o) {
                    var order = o.charAt(0) === '-' ? 'desc' : 'asc',
                        field = order === 'desc' ? urlParams.order[0].substring(1) : urlParams.order[0];

                    if (field === 'recipe_type') {
                        field = 'recipe_type.name';
                    }

                    orders.push(order);
                    fields.push(field);
                });

                recipes.results = _.sortByOrder(recipes.results, fields, orders);
            }

            returnObj[1] = JSON.stringify(recipes);

            return returnObj;
        });

        // Recipe type validation service
        var recipeTypeValidationOverrideUrl = 'test/data/recipeTypeValidationSuccess.json';
        var recipeTypeValidationRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'recipe-types/validation/', 'i');
        $httpBackend.whenPOST(recipeTypeValidationRegex).respond(function () {
            return getSync(recipeTypeValidationOverrideUrl);
        });

        // Recipe Type Details
        var recipeTypeDetailsOverrideUrl = 'test/data/recipe-types/recipeType1.json';
        var recipeTypeDetailsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'recipe-types/.*/', 'i');
        $httpBackend.whenGET(recipeTypeDetailsRegex).respond(function (method, url) {
            // get the recipeType.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            recipeTypeDetailsOverrideUrl = 'test/data/recipe-types/recipeType' + id + '.json';
            var returnValue = getSync(recipeTypeDetailsOverrideUrl);
            if (returnValue[0] !== 200) {
                returnValue = localStorage.getItem('recipeType' + id);
                return [200, JSON.parse(returnValue), {}];
            } else {
                return returnValue;
            }
        });

        // Recipe Types service
        var recipeTypesOverrideUrl = 'test/data/recipeTypes.json';
        var recipeTypesRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'recipe-types/', 'i');
        $httpBackend.whenGET(recipeTypesRegex).respond(function (method, url) {
            var urlParams = getUrlParams(url),
                returnObj = getSync(recipeTypesOverrideUrl),
                recipeTypes = JSON.parse(returnObj[1]);

            if (urlParams.order && urlParams.order.length > 0) {
                var orders = [],
                    fields = [];
                _.forEach(urlParams.order, function (o) {
                    var order = o.charAt(0) === '-' ? 'desc' : 'asc',
                        field = order === 'desc' ? urlParams.order[0].substring(1) : urlParams.order[0];

                    orders.push(order);
                    fields.push(field);
                });

                recipeTypes.results = _.sortByOrder(recipeTypes.results, fields, orders);
            }

            returnObj[1] = JSON.stringify(recipeTypes);

            return returnObj;
        });

        // Save Recipe Type
        var recipeTypeSaveRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'recipe-types/', 'i');
        $httpBackend.whenPOST(recipeTypeSaveRegex).respond(function (method, url, data) {
            var recipeJobTypes = [],
                recipeJobTypesDetails = [],
                jobTypeData = getSync('test/data/jobTypes.json'),
                jobTypes = JSON.parse(jobTypeData[1]).results,
                recipeType = JSON.parse(data),
                uniqueRecipeTypeJobs = _.uniq(recipeType.definition.jobs, 'job_type');
            _.forEach(uniqueRecipeTypeJobs, function (job) {
                recipeJobTypes.push(_.find(jobTypes, function (jobType) {
                    return jobType.name === job.job_type.name && jobType.version === job.job_type.version;
                }));
            });
            _.forEach(recipeJobTypes, function (jobType) {
                var jt = getSync('test/data/job-types/jobType' + jobType.id + '.json');
                recipeJobTypesDetails.push(JSON.parse(jt[1]));
            });
            var returnRecipe = {
                id: Math.floor(Math.random() * (10000 - 5 + 1)) + 5,
                name: recipeType.name,
                version: recipeType.version,
                title: recipeType.title,
                description: recipeType.description,
                is_active: true,
                definition: recipeType.definition,
                revision_num: 1,
                created: new Date().toISOString(),
                last_modified: new Date().toISOString(),
                archived: null,
                trigger_rule: recipeType.trigger_rule,
                job_types: recipeJobTypesDetails
            };
            return [200, JSON.stringify(returnRecipe), {}];
        });

        // Status service
        var statusOverrideUrl = 'test/data/status.json';
        var statusRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'status/', 'i');
        $httpBackend.whenGET(statusRegex).respond(function () {
            return getSync(statusOverrideUrl);
        });

        // Version
        var versionOverrideUrl = 'test/data/version.json';
        var versionRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'v3/version/', 'i');
        $httpBackend.whenGET(versionRegex).respond(function () {
            return getSync(versionOverrideUrl);
        });

        // Workspace Details
        var workspaceDetailsOverrideUrl = 'test/data/workspaces/workspace1.json';
        var workspaceDetailsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'workspaces/.*/', 'i');
        $httpBackend.whenGET(workspaceDetailsRegex).respond(function (method, url) {
            // get the workspace.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            workspaceDetailsOverrideUrl = 'test/data/workspaces/workspace' + id + '.json';
            var returnValue = getSync(workspaceDetailsOverrideUrl);
            if (returnValue[0] !== 200) {
                returnValue = localStorage.getItem('workspace' + id);
                return [200, JSON.parse(returnValue), {}];
            } else {
                return returnValue;
            }
        });


        // Workspaces
        var workspacesOverrideUrl = 'test/data/workspaces.json';
        var workspacesRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'workspaces/', 'i');
        $httpBackend.whenGET(workspacesRegex).respond(function () {
            return getSync(workspacesOverrideUrl);
        });

        // Save Workspace
        var getReturn = function (data, id) {
            var workspace = JSON.parse(data);

            return {
                id: id || Math.floor(Math.random() * (10000 - 5 + 1)) + 5,
                name: workspace.name,
                title: workspace.title,
                description: workspace.description,
                base_url: workspace.base_url,
                is_active: workspace.is_active || false,
                used_size: 0,
                total_size: 0,
                created: new Date().toISOString(),
                archived: null,
                last_modified: new Date().toISOString(),
                json_config: workspace.json_config
            };
        };
        var workspaceCreateRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'workspaces/', 'i');
        $httpBackend.whenPOST(workspaceCreateRegex).respond(function (method, url, data) {
            var returnWorkspace = getReturn(data);
            return [200, JSON.stringify(returnWorkspace), {}];
        });
        $httpBackend.whenPATCH(workspaceDetailsRegex).respond(function (method, url, data) {
            // get the workspace.id from the url
            url = url.toString();
            var id = url.substring(url.substring(0,url.lastIndexOf('/')).lastIndexOf('/')+1,url.length-1);
            var returnWorkspace = getReturn(data, id);
            return [200, JSON.stringify(returnWorkspace), {}];
        });

        // For everything else, don't mock
        $httpBackend.whenGET(/^\w+.*/).passThrough();
        $httpBackend.whenPOST(/^\w+.*/).passThrough();
    }]);
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNjYWxlQ29uZmlnLmpzIiwiaGVhZGVyL2hlYWRlckRpcmVjdGl2ZS5qcyIsIm5hdmlnYXRpb24vbmF2RGlyZWN0aXZlLmpzIiwiYWJvdXQvY29udHJvbGxlcnMvYWJvdXRDb250cm9sbGVyLmpzIiwiYWRtaW4vY29udHJvbGxlcnMvYWRtaW5Mb2dpbkNvbnRyb2xsZXIuanMiLCJhZG1pbi9jb250cm9sbGVycy9sb2dvdXRDb250cm9sbGVyLmpzIiwiY2hhcnRzL2RhdGFGZWVkL2RhdGFGZWVkRGlyZWN0aXZlLmpzIiwiY2hhcnRzL2RvbnV0L2RvbnV0Q29udHJvbGxlci5qcyIsImNoYXJ0cy9kb251dC9kb251dERpcmVjdGl2ZS5qcyIsImNoYXJ0cy9ncmlkL2dyaWRDaGFydENvbnRyb2xsZXIuanMiLCJjaGFydHMvZ3JpZC9ncmlkQ2hhcnREaXJlY3RpdmUuanMiLCJjaGFydHMvaGVhbHRoL2hlYWx0aENvbnRyb2xsZXIuanMiLCJjaGFydHMvaGVhbHRoL2hlYWx0aERpcmVjdGl2ZS5qcyIsImNoYXJ0cy9qb2JMb2FkL2pvYkxvYWRDb250cm9sbGVyLmpzIiwiY2hhcnRzL2pvYkxvYWQvam9iTG9hZERpcmVjdGl2ZS5qcyIsImNoYXJ0cy9yYWRpYWxQZXJjZW50YWdlL3JhZGlhbFBlcmNlbnRhZ2VDb250cm9sbGVyLmpzIiwiY2hhcnRzL3JhZGlhbFBlcmNlbnRhZ2UvcmFkaWFsUGVyY2VudGFnZURpcmVjdGl2ZS5qcyIsImNoYXJ0cy90aW1lbGluZS90aW1lbGluZURpcmVjdGl2ZS5qcyIsImNvbW1vbi9kaXJlY3RpdmVzL2Fpc0dyaWRQYWdpbmF0aW9uLmpzIiwiY29tbW9uL2RpcmVjdGl2ZXMvYWlzTXVsdGlzZWxlY3QuanMiLCJjb21tb24vZmFjdG9yaWVzL2dhdWdlRmFjdG9yeS5qcyIsImNvbW1vbi9mYWN0b3JpZXMvZ3JpZEZhY3RvcnkuanMiLCJjb21tb24vZmFjdG9yaWVzL3BvbGxlckZhY3RvcnkuanMiLCJjb21tb24vbW9kZWxzL1N0YXR1cy5qcyIsImNvbW1vbi9tb2RlbHMvU3RhdHVzTWFzdGVyLmpzIiwiY29tbW9uL21vZGVscy9TdGF0dXNSZXNvdXJjZS5qcyIsImNvbW1vbi9tb2RlbHMvU3RhdHVzUmVzb3VyY2VzLmpzIiwiY29tbW9uL21vZGVscy9TdGF0dXNTY2hlZHVsZXIuanMiLCJjb21tb24vc2VydmljZXMvc2NhbGVTZXJ2aWNlLmpzIiwiY29tbW9uL3NlcnZpY2VzL3NjaGVkdWxlclNlcnZpY2UuanMiLCJjb21tb24vc2VydmljZXMvc3RhdGVTZXJ2aWNlLmpzIiwiY29tbW9uL3NlcnZpY2VzL3N0YXR1c1NlcnZpY2UuanMiLCJjb21tb24vc2VydmljZXMvdXNlclNlcnZpY2UuanMiLCJmZWVkL2NvbnRyb2xsZXJzL2ZlZWREZXRhaWxzQ29udHJvbGxlci5qcyIsImZlZWQvY29udHJvbGxlcnMvaW5nZXN0UmVjb3JkRGV0YWlsc0NvbnRyb2xsZXIuanMiLCJmZWVkL2NvbnRyb2xsZXJzL2luZ2VzdFJlY29yZHNDb250cm9sbGVyLmpzIiwiZmVlZC9kaXJlY3RpdmVzL2ZpbGVBbmNlc3RyeVRyZWVEaXJlY3RpdmUuanMiLCJmZWVkL21vZGVscy9GZWVkLmpzIiwiZmVlZC9tb2RlbHMvRmVlZFN0YXR1cy5qcyIsImZlZWQvbW9kZWxzL0luZ2VzdC5qcyIsImZlZWQvc2VydmljZXMvZmVlZFNlcnZpY2UuanMiLCJqb2JzL2NvbnRyb2xsZXJzL2pvYkRldGFpbENvbnRyb2xsZXIuanMiLCJqb2JzL2NvbnRyb2xsZXJzL2pvYkV4ZWN1dGlvbkRldGFpbENvbnRyb2xsZXIuanMiLCJqb2JzL2NvbnRyb2xsZXJzL2pvYkV4ZWN1dGlvbnNDb250cm9sbGVyLmpzIiwiam9icy9jb250cm9sbGVycy9qb2JUeXBlc0NvbnRyb2xsZXIuanMiLCJqb2JzL2NvbnRyb2xsZXJzL2pvYlR5cGVzRmFpbHVyZVJhdGVzQ29udHJvbGxlci5qcyIsImpvYnMvY29udHJvbGxlcnMvam9ic0NvbnRyb2xsZXIuanMiLCJqb2JzL2RpcmVjdGl2ZXMvam9iRXhlY3V0aW9uTG9nRGlyZWN0aXZlLmpzIiwiam9icy9kaXJlY3RpdmVzL2pvYkhlYWx0aERpcmVjdGl2ZS5qcyIsImpvYnMvZGlyZWN0aXZlcy9qb2JUeXBlSW50ZXJmYWNlRGlyZWN0aXZlLmpzIiwiam9icy9tb2RlbHMvSm9iLmpzIiwiam9icy9tb2RlbHMvSm9iRGV0YWlsRXZlbnQuanMiLCJqb2JzL21vZGVscy9Kb2JEZXRhaWxFdmVudFJ1bGUuanMiLCJqb2JzL21vZGVscy9Kb2JEZXRhaWxJbnB1dERhdGEuanMiLCJqb2JzL21vZGVscy9Kb2JEZXRhaWxPdXRwdXREYXRhLmpzIiwiam9icy9tb2RlbHMvSm9iRGV0YWlscy5qcyIsImpvYnMvbW9kZWxzL0pvYkV4ZWN1dGlvbi5qcyIsImpvYnMvbW9kZWxzL0pvYkV4ZWN1dGlvbkxvZy5qcyIsImpvYnMvbW9kZWxzL0pvYlR5cGUuanMiLCJqb2JzL21vZGVscy9Kb2JUeXBlRGV0YWlscy5qcyIsImpvYnMvbW9kZWxzL0pvYlR5cGVFcnJvci5qcyIsImpvYnMvbW9kZWxzL0pvYlR5cGVFcnJvck1hcHBpbmcuanMiLCJqb2JzL21vZGVscy9Kb2JUeXBlSW5wdXREYXRhLmpzIiwiam9icy9tb2RlbHMvSm9iVHlwZUludGVyZmFjZS5qcyIsImpvYnMvbW9kZWxzL0pvYlR5cGVPdXRwdXREYXRhLmpzIiwiam9icy9tb2RlbHMvSm9iVHlwZVN0YXR1cy5qcyIsImpvYnMvbW9kZWxzL1Byb2R1Y3QuanMiLCJqb2JzL21vZGVscy9SdW5uaW5nSm9iLmpzIiwiam9icy9tb2RlbHMvU3lzdGVtRmFpbHVyZS5qcyIsImpvYnMvc2VydmljZXMvam9iRXhlY3V0aW9uU2VydmljZS5qcyIsImpvYnMvc2VydmljZXMvam9iU2VydmljZS5qcyIsImpvYnMvc2VydmljZXMvam9iVHlwZVNlcnZpY2UuanMiLCJsb2FkL2NvbnRyb2xsZXJzL2xvYWRDb250cm9sbGVyLmpzIiwibG9hZC9jb250cm9sbGVycy9sb2FkRGVwdGhDb250cm9sbGVyLmpzIiwibG9hZC9jb250cm9sbGVycy9xdWV1ZVJ1bm5pbmdDb250cm9sbGVyLmpzIiwibG9hZC9tb2RlbHMvUXVldWVTdGF0dXMuanMiLCJsb2FkL3NlcnZpY2VzL2xvYWRTZXJ2aWNlLmpzIiwibWV0cmljcy9jb250cm9sbGVycy9tZXRyaWNzQ29udHJvbGxlci5qcyIsIm1ldHJpY3Mvc2VydmljZXMvbWV0cmljc1NlcnZpY2UuanMiLCJuYXZpZ2F0aW9uL2NvbnRyb2xsZXJzL25hdkNvbnRyb2xsZXIuanMiLCJuYXZpZ2F0aW9uL3NlcnZpY2VzL25hdlNlcnZpY2UuanMiLCJuYXZpZ2F0aW9uL3NlcnZpY2VzL3N1Ym5hdlNlcnZpY2UuanMiLCJub2Rlcy9jb250cm9sbGVycy9ub2RlRGV0YWlsc0NvbnRyb2xsZXIuanMiLCJub2Rlcy9jb250cm9sbGVycy9ub2Rlc0NvbnRyb2xsZXIuanMiLCJub2Rlcy9kaXJlY3RpdmVzL25vZGVIZWFsdGhEaXJlY3RpdmUuanMiLCJub2Rlcy9kaXJlY3RpdmVzL25vZGVTdGF0dXNHcmlkQ29udHJvbGxlci5qcyIsIm5vZGVzL2RpcmVjdGl2ZXMvbm9kZVN0YXR1c0dyaWREaXJlY3RpdmUuanMiLCJub2Rlcy9tb2RlbHMvTm9kZS5qcyIsIm5vZGVzL21vZGVscy9Ob2RlUmVzb3VyY2VzLmpzIiwibm9kZXMvbW9kZWxzL05vZGVTdGF0dXMuanMiLCJub2Rlcy9zZXJ2aWNlcy9ub2RlU2VydmljZS5qcyIsIm5vZGVzL3NlcnZpY2VzL25vZGVVcGRhdGVTZXJ2aWNlLmpzIiwib3ZlcnZpZXcvY29udHJvbGxlcnMvb3ZDb250cm9sbGVyLmpzIiwicmVjaXBlcy9jb250cm9sbGVycy9yZWNpcGVEZXRhaWxzQ29udHJvbGxlci5qcyIsInJlY2lwZXMvY29udHJvbGxlcnMvcmVjaXBlVHlwZXNDb250cm9sbGVyLmpzIiwicmVjaXBlcy9jb250cm9sbGVycy9yZWNpcGVzQ29udHJvbGxlci5qcyIsInJlY2lwZXMvZGlyZWN0aXZlcy9yZWNpcGVHcmFwaFZpZXdlckRpcmVjdGl2ZS5qcyIsInJlY2lwZXMvbW9kZWxzL1JlY2lwZS5qcyIsInJlY2lwZXMvbW9kZWxzL1JlY2lwZURhdGEuanMiLCJyZWNpcGVzL21vZGVscy9SZWNpcGVEZXRhaWxzLmpzIiwicmVjaXBlcy9tb2RlbHMvUmVjaXBlSm9iLmpzIiwicmVjaXBlcy9tb2RlbHMvUmVjaXBlSm9iQ29udGFpbmVyLmpzIiwicmVjaXBlcy9tb2RlbHMvUmVjaXBlVHlwZS5qcyIsInJlY2lwZXMvbW9kZWxzL1JlY2lwZVR5cGVEZWZpbml0aW9uLmpzIiwicmVjaXBlcy9tb2RlbHMvUmVjaXBlVHlwZURlZmluaXRpb25Kb2IuanMiLCJyZWNpcGVzL21vZGVscy9SZWNpcGVUeXBlRGV0YWlsLmpzIiwicmVjaXBlcy9tb2RlbHMvUmVjaXBlVHlwZVZhbGlkYXRpb24uanMiLCJ3b3Jrc3BhY2VzL2NvbnRyb2xsZXJzL3dvcmtzcGFjZXNDb250cm9sbGVyLmpzIiwid29ya3NwYWNlcy9tb2RlbHMvV29ya3NwYWNlLmpzIiwicmVjaXBlcy9zZXJ2aWNlcy9yZWNpcGVTZXJ2aWNlLmpzIiwid29ya3NwYWNlcy9zZXJ2aWNlcy93b3Jrc3BhY2VzU2VydmljZS5qcyIsImdhbnR0LWNoYXJ0LWQzLmpzIiwiZ2F1Z2UuanMiLCJob3RrZXlzLm1pbi5qcyIsImluY2x1ZGVzLmpzIiwiYmFja2VuZFN0dWJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLENBQUEsWUFBQTtJQUNBOztJQUVBLElBQUEsTUFBQSxRQUFBLE9BQUEsWUFBQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTs7O0lBR0EsSUFBQSwyRUFBQSxTQUFBLGdCQUFBLG1CQUFBLFVBQUEsY0FBQTs7O1FBR0EsU0FBQSxVQUFBLG1DQUFBLFVBQUEsV0FBQTtZQUNBLE9BQUEsVUFBQSxXQUFBLE9BQUE7Z0JBQ0EsVUFBQSxXQUFBO2dCQUNBLFdBQUEsV0FBQTtvQkFDQSxNQUFBOzs7Ozs7UUFNQSxhQUFBLG9CQUFBO1FBQ0EsYUFBQSxRQUFBOzs7UUFHQSxrQkFBQSxTQUFBLHVCQUFBOzs7UUFHQTthQUNBLEtBQUEsS0FBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTs7YUFFQSxLQUFBLGVBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxhQUFBOzthQUVBLEtBQUEsZ0JBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxhQUFBOzthQUVBLEtBQUEsVUFBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTs7YUFFQSxLQUFBLFNBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxjQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsZ0JBQUE7O2FBRUEsS0FBQSxpQkFBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTtnQkFDQSxnQkFBQTs7YUFFQSxLQUFBLHFCQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxhQUFBOzthQUVBLEtBQUEsWUFBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTtnQkFDQSxnQkFBQTs7YUFFQSxLQUFBLFVBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxjQUFBO2dCQUNBLGFBQUE7O2FBRUEsS0FBQSxjQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxhQUFBOzthQUVBLEtBQUEsZ0JBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxjQUFBO2dCQUNBLGFBQUE7O2FBRUEsS0FBQSxpQkFBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTs7YUFFQSxLQUFBLGVBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxjQUFBO2dCQUNBLGFBQUE7O2FBRUEsS0FBQSxZQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxhQUFBO2dCQUNBLGdCQUFBOzthQUVBLEtBQUEsdUJBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxjQUFBO2dCQUNBLGFBQUE7O2FBRUEsS0FBQSx1QkFBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTs7YUFFQSxLQUFBLFNBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxjQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsZ0JBQUE7O2FBRUEsS0FBQSxpQkFBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTs7YUFFQSxLQUFBLG9CQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxhQUFBOzthQUVBLEtBQUEsdUJBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxjQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsZ0JBQUE7O2FBRUEsS0FBQSxvQkFBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTs7YUFFQSxLQUFBLHdCQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxhQUFBOzthQUVBLEtBQUEsb0JBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxjQUFBO2dCQUNBLGFBQUE7O2FBRUEsVUFBQTtnQkFDQSxZQUFBOzs7S0FHQSxNQUFBLFVBQUEsT0FBQTtLQUNBLE1BQUEsZ0JBQUEsT0FBQTtLQUNBLE1BQUEsa0JBQUEsT0FBQTtLQUNBLE1BQUEsVUFBQSxPQUFBOzs7QUNyS0EsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLHFCQUFBLElBQUEsU0FBQSxlQUFBLFlBQUE7UUFDQSxJQUFBLGNBQUE7WUFDQSxtQkFBQTs7UUFFQSxLQUFBLE9BQUEsWUFBQTtZQUNBLElBQUEsU0FBQSxFQUFBLEtBQUE7Z0JBQ0EsTUFBQTtnQkFDQSxLQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsT0FBQTtnQkFDQSxhQUFBO2dCQUNBLFVBQUE7OztZQUdBLElBQUEsT0FBQSxXQUFBLEtBQUE7Z0JBQ0EsY0FBQSxPQUFBLGFBQUE7O2dCQUVBLElBQUEsY0FBQSxFQUFBLEtBQUE7b0JBQ0EsTUFBQTtvQkFDQSxLQUFBO29CQUNBLE9BQUE7b0JBQ0EsT0FBQTtvQkFDQSxhQUFBO29CQUNBLFVBQUE7OztnQkFHQSxJQUFBLFlBQUEsV0FBQSxLQUFBO29CQUNBLG1CQUFBLFlBQUEsYUFBQTs7O2dCQUdBLEVBQUEsTUFBQSxhQUFBOzs7WUFHQSxPQUFBOzs7OztBQ3BDQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxXQUFBLHlDQUFBLFNBQUEsZUFBQTtRQUNBLElBQUEsS0FBQTtRQUNBLEdBQUEsY0FBQSxjQUFBOztLQUVBLFVBQUEsYUFBQSxZQUFBOzs7O1FBSUEsT0FBQTtZQUNBLFlBQUE7WUFDQSxjQUFBO1lBQ0EsVUFBQTtZQUNBLGFBQUE7WUFDQSxPQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsV0FBQTtnQkFDQSxTQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsYUFBQTs7Ozs7OztBQ3JCQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxVQUFBLG1CQUFBLFlBQUE7UUFDQSxPQUFBO1lBQ0EsVUFBQTtZQUNBLGFBQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTs7Ozs7QUNSQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxXQUFBLHlFQUFBLFNBQUEsUUFBQSxXQUFBLFlBQUEsY0FBQTtRQUNBLElBQUEsS0FBQTs7UUFFQSxHQUFBLGVBQUE7UUFDQSxHQUFBLFVBQUE7O1FBRUEsSUFBQSxhQUFBLFdBQUE7WUFDQSxXQUFBLGVBQUE7OztRQUdBOztRQUVBLE9BQUEsT0FBQSxnQ0FBQSxVQUFBLFVBQUE7WUFDQSxHQUFBLFVBQUE7Ozs7O0FDaEJBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFdBQUEsaUZBQUEsVUFBQSxVQUFBLFdBQUEsY0FBQSxhQUFBOztRQUVBLElBQUEsYUFBQSxZQUFBO1lBQ0EsSUFBQSxPQUFBLFlBQUE7O1lBRUEsSUFBQSxDQUFBLE1BQUE7Z0JBQ0EsWUFBQSxNQUFBOzs7WUFHQSxTQUFBLFlBQUE7O2dCQUVBLFVBQUEsS0FBQTs7OztRQUlBOzs7QUNsQkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsV0FBQSwyRUFBQSxVQUFBLFVBQUEsWUFBQSxXQUFBLGFBQUE7O1FBRUEsSUFBQSxhQUFBLFlBQUE7WUFDQSxZQUFBO1lBQ0EsU0FBQSxVQUFBOztnQkFFQSxVQUFBLEtBQUE7Ozs7UUFJQTs7O0FDYkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsV0FBQSxrRkFBQSxVQUFBLFFBQUEsYUFBQSxhQUFBLGNBQUE7UUFDQSxJQUFBLE9BQUE7WUFDQSxRQUFBLENBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLEdBQUEsR0FBQSxHQUFBLEdBQUEsR0FBQSxHQUFBLEdBQUEsR0FBQSxHQUFBLEdBQUEsR0FBQSxHQUFBO1lBQ0EsU0FBQTs7UUFFQSxJQUFBLGlCQUFBLFlBQUE7WUFDQSxPQUFBO1lBQ0EsSUFBQSxNQUFBO1lBQ0EsSUFBQSxPQUFBLE1BQUE7Z0JBQ0EsRUFBQSxRQUFBLE9BQUEsS0FBQSxRQUFBLFVBQUEsS0FBQTtvQkFDQSxJQUFBLFNBQUEsT0FBQSxJQUFBLElBQUEsTUFBQSxPQUFBLFlBQUEsWUFBQTtvQkFDQSxJQUFBLFVBQUEsT0FBQSxJQUFBLElBQUEsTUFBQTtvQkFDQSxJQUFBLEtBQUEsU0FBQSxNQUFBO29CQUNBLE9BQUEsTUFBQTtvQkFDQSxJQUFBLFdBQUEsS0FBQTt3QkFDQSxNQUFBO3dCQUNBLEtBQUEsS0FBQTs7O2dCQUdBOzs7O1FBSUEsSUFBQSxhQUFBLFlBQUE7WUFDQSxJQUFBLFVBQUEsU0FBQSxNQUFBLE9BQUEsWUFBQSxZQUFBO1lBQ0EsSUFBQSxXQUFBLFNBQUEsTUFBQTs7WUFFQSxJQUFBLGFBQUE7WUFDQSxjQUFBO1lBQ0EsSUFBQSxPQUFBLE1BQUE7Z0JBQ0EsY0FBQSxrQ0FBQSxLQUFBLE9BQUEsZ0NBQUEsYUFBQSxhQUFBLE9BQUEsS0FBQSxNQUFBLFNBQUEsV0FBQSxPQUFBLEtBQUEsTUFBQSxPQUFBLFdBQUE7O1lBRUEsY0FBQTtZQUNBLElBQUEsSUFBQSxRQUFBLE9BQUE7Z0JBQ0EsT0FBQSxHQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsY0FBQSxnQkFBQSxNQUFBLFFBQUEsVUFBQSxNQUFBLFFBQUE7O2dCQUVBLElBQUEsSUFBQSxPQUFBLE1BQUE7b0JBQ0EsSUFBQSxPQUFBLEtBQUEsT0FBQSxNQUFBLE1BQUE7b0JBQ0EsSUFBQSxRQUFBLE9BQUEsS0FBQTtvQkFDQSxJQUFBLE9BQUEsT0FBQSxLQUFBO29CQUNBLElBQUEsTUFBQTtvQkFDQSxJQUFBLEtBQUEsU0FBQSxTQUFBO3dCQUNBLElBQUEsTUFBQSxVQUFBLFVBQUE7NEJBQ0EsTUFBQTs7NkJBRUEsSUFBQSxNQUFBLFFBQUEsVUFBQTs0QkFDQSxNQUFBOzs7b0JBR0EsSUFBQSxVQUFBLEtBQUEsU0FBQSxLQUFBLFFBQUEsYUFBQSxRQUFBLFVBQUE7d0JBQ0EsTUFBQTs7b0JBRUEsY0FBQSxhQUFBLE1BQUEsY0FBQSxLQUFBLE9BQUEsTUFBQSxNQUFBLFFBQUE7b0JBQ0EsSUFBQSxRQUFBLFVBQUE7d0JBQ0EsY0FBQSxrQkFBQSxNQUFBLGdCQUFBLEtBQUEsT0FBQSxNQUFBLE1BQUEsUUFBQTs7d0JBRUE7d0JBQ0EsY0FBQSxrQkFBQSxNQUFBLGdCQUFBLEtBQUEsT0FBQSxNQUFBLE1BQUEsUUFBQSwrQkFBQSxhQUFBLDJCQUFBLEtBQUEsS0FBQSxRQUFBLFFBQUE7Ozs7Z0JBSUEsY0FBQTs7WUFFQSxjQUFBO1lBQ0EsRUFBQSxZQUFBLEtBQUE7OztRQUdBLElBQUEsYUFBQSxZQUFBOztZQUVBLE9BQUEsT0FBQSxRQUFBLFVBQUEsT0FBQTtnQkFDQSxJQUFBLE9BQUEsTUFBQTtvQkFDQTs7Ozs7UUFLQTtRQUNBLFVBQUEsZUFBQSxZQUFBO1FBQ0EsT0FBQTtZQUNBLFlBQUE7WUFDQSxhQUFBO1lBQ0EsVUFBQTtZQUNBLE9BQUE7Z0JBQ0EsTUFBQTs7Ozs7OztBQ3hGQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxXQUFBLDREQUFBLFVBQUEsUUFBQSxVQUFBLGFBQUE7UUFDQSxJQUFBLFVBQUE7WUFDQSxRQUFBOztRQUVBLElBQUEsV0FBQSxZQUFBO1lBQ0EsSUFBQSxPQUFBO2dCQUNBLElBQUEsVUFBQTtvQkFDQSxZQUFBOzs7Z0JBR0EsRUFBQSxRQUFBLE1BQUEsUUFBQSxVQUFBLEdBQUE7b0JBQ0EsUUFBQSxLQUFBLENBQUEsRUFBQSxPQUFBLEdBQUEsSUFBQSxFQUFBLE9BQUEsR0FBQTs7OztnQkFJQSxFQUFBLFFBQUEsU0FBQSxVQUFBLElBQUE7b0JBQ0EsSUFBQSxPQUFBLEVBQUEsS0FBQSxTQUFBLFVBQUEsSUFBQTt3QkFDQSxPQUFBLEdBQUEsT0FBQSxHQUFBOztvQkFFQSxJQUFBLENBQUEsTUFBQTt3QkFDQSxVQUFBLEtBQUEsR0FBQTs7Ozs7Z0JBS0EsTUFBQSxLQUFBO29CQUNBLFNBQUE7b0JBQ0EsUUFBQTs7bUJBRUE7Z0JBQ0EsUUFBQSxHQUFBLFNBQUE7b0JBQ0EsUUFBQSxTQUFBO29CQUNBLE1BQUE7d0JBQ0EsU0FBQTt3QkFDQSxNQUFBLE9BQUE7d0JBQ0EsUUFBQTs0QkFDQSxNQUFBLFlBQUEsT0FBQTs0QkFDQSxTQUFBLFlBQUEsT0FBQTs0QkFDQSxJQUFBLFlBQUEsT0FBQTs0QkFDQSxXQUFBLFlBQUEsT0FBQTs0QkFDQSxNQUFBOzRCQUNBLE9BQUEsWUFBQSxPQUFBOzRCQUNBLFFBQUEsWUFBQSxPQUFBOzRCQUNBLFdBQUEsWUFBQSxPQUFBOzRCQUNBLE1BQUEsWUFBQSxPQUFBOzRCQUNBLFFBQUEsWUFBQSxPQUFBOzRCQUNBLFNBQUEsWUFBQSxPQUFBOzRCQUNBLHFCQUFBLFlBQUEsT0FBQTs0QkFDQSxRQUFBLFlBQUEsT0FBQTs7O29CQUdBLFlBQUE7d0JBQ0EsVUFBQTs7b0JBRUEsS0FBQTt3QkFDQSxPQUFBOzRCQUNBLFFBQUEsR0FBQSxPQUFBOzs7b0JBR0EsT0FBQTt3QkFDQSxPQUFBOzRCQUNBLFFBQUEsT0FBQSxZQUFBLEdBQUEsT0FBQSxPQUFBLFlBQUE7Z0NBQ0EsT0FBQTs7O3dCQUdBLE9BQUEsT0FBQTt3QkFDQSxPQUFBLE9BQUE7O29CQUVBLFNBQUE7d0JBQ0EsUUFBQTs0QkFDQSxPQUFBLEdBQUEsT0FBQTs7O29CQUdBLE1BQUE7d0JBQ0EsUUFBQSxPQUFBLFFBQUE7Ozs7WUFJQSxTQUFBLEdBQUEsTUFBQSxXQUFBOzs7UUFHQSxJQUFBLGlCQUFBLFdBQUE7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QkFDQSxNQUFBLFdBQUE7WUFDQSxHQUFBLFVBQUE7aUJBQ0EsTUFBQSxXQUFBOzs7UUFHQSxJQUFBLGFBQUEsVUFBQSxNQUFBO1lBQ0EsT0FBQSxPQUFBLFVBQUEsT0FBQSxVQUFBLEtBQUEsTUFBQSxRQUFBO1lBQ0EsT0FBQSxPQUFBLE9BQUEsT0FBQSxPQUFBLEtBQUEsS0FBQSxHQUFBLFdBQUEsU0FBQTs7WUFFQSxJQUFBLGFBQUEsTUFBQSxNQUFBLE1BQUEsQ0FBQSxRQUFBLE9BQUEsSUFBQSxPQUFBLE1BQUE7O1lBRUEsSUFBQSxPQUFBLEdBQUEsU0FBQTtpQkFDQSxZQUFBLENBQUEsR0FBQTs7aUJBRUEsR0FBQSxRQUFBOztZQUVBLElBQUEsWUFBQTtnQkFDQSxNQUFBLEdBQUEsT0FBQSxlQUFBLE9BQUE7cUJBQ0EsS0FBQSxTQUFBO3FCQUNBLEtBQUEsVUFBQTtxQkFDQSxPQUFBO3FCQUNBLEtBQUE7cUJBQ0EsT0FBQTttQkFDQSxJQUFBLGVBQUE7Z0JBQ0EsTUFBQSxHQUFBLE9BQUEsZUFBQSxPQUFBO3FCQUNBLEtBQUEsU0FBQTtxQkFDQSxLQUFBLFVBQUE7cUJBQ0EsT0FBQTtxQkFDQSxLQUFBO21CQUNBO2dCQUNBLE1BQUEsR0FBQSxPQUFBLGVBQUEsT0FBQTtxQkFDQSxLQUFBLFNBQUE7cUJBQ0EsS0FBQSxVQUFBO3FCQUNBLE9BQUE7OztZQUdBLElBQUEsT0FBQTtpQkFDQSxLQUFBLFNBQUE7aUJBQ0EsS0FBQSxTQUFBO2lCQUNBLEtBQUEsVUFBQTs7WUFFQSxJQUFBLEdBQUEsVUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQSxNQUFBO3FCQUNBLE9BQUEsQ0FBQSxHQUFBO3FCQUNBLE1BQUEsQ0FBQSxHQUFBLE9BQUE7O2dCQUVBLElBQUEsUUFBQSxHQUFBLElBQUE7cUJBQ0EsTUFBQTtxQkFDQSxPQUFBO3FCQUNBLFdBQUE7O2dCQUVBLElBQUEsS0FBQSxhQUFBLGVBQUEsS0FBQSxNQUFBLElBQUE7cUJBQ0EsT0FBQTtxQkFDQSxLQUFBLFNBQUE7cUJBQ0EsS0FBQSxhQUFBLGVBQUEsSUFBQSxNQUFBLGFBQUEsSUFBQTtxQkFDQSxLQUFBOzs7WUFHQSxjQUFBOztZQUVBLFNBQUEsU0FBQTtnQkFDQSxJQUFBLElBQUEsR0FBQSxNQUFBOztnQkFFQSxJQUFBLGNBQUE7b0JBQ0EsSUFBQSxJQUFBLEdBQUE7d0JBQ0E7MkJBQ0E7d0JBQ0E7OztnQkFHQSxJQUFBLE1BQUEsR0FBQTtvQkFDQSxJQUFBLE9BQUEsVUFBQTt3QkFDQSxLQUFBLFVBQUEsQ0FBQSxJQUFBOzJCQUNBO3dCQUNBLEtBQUEsVUFBQSxDQUFBLEdBQUE7OztnQkFHQSxJQUFBLEtBQUEsYUFBQSxlQUFBLEtBQUEsY0FBQSxZQUFBLEdBQUEsTUFBQSxRQUFBOzs7WUFHQSxHQUFBLFVBQUE7OztRQUdBLElBQUEsY0FBQTtZQUNBLGNBQUE7WUFDQSxlQUFBO1lBQ0EsZUFBQTs7UUFFQSxJQUFBLE9BQUEsR0FBQSxTQUFBO2FBQ0EsR0FBQSxhQUFBLFlBQUE7O2dCQUVBLGNBQUEsR0FBQSxNQUFBLFlBQUE7Z0JBQ0EsY0FBQSxHQUFBLE1BQUEsWUFBQTs7O1FBR0EsSUFBQSxjQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsS0FBQSxFQUFBLFFBQUE7Z0JBQ0EsT0FBQSxFQUFBLE9BQUE7O1lBRUEsT0FBQTs7O1FBR0EsSUFBQSxjQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsR0FBQTtnQkFDQSxPQUFBLEVBQUE7Ozs7UUFJQSxJQUFBLGtCQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsS0FBQSxFQUFBLFFBQUE7Z0JBQ0EsSUFBQSxFQUFBLGVBQUEsV0FBQTtvQkFDQSxPQUFBLEVBQUEsT0FBQTs7Ozs7UUFLQSxJQUFBLHFCQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsS0FBQSxFQUFBLFFBQUE7Z0JBQ0EsT0FBQSxFQUFBLE9BQUE7Ozs7UUFJQSxJQUFBLHVCQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsS0FBQSxFQUFBLFFBQUE7Z0JBQ0EsT0FBQSxFQUFBLE9BQUE7Ozs7UUFJQSxJQUFBLGVBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxHQUFBO2dCQUNBLE9BQUEsRUFBQTs7OztRQUlBLElBQUEsZUFBQSxVQUFBLEdBQUE7WUFDQSxJQUFBLEtBQUEsRUFBQSxRQUFBO2dCQUNBLE9BQUEsRUFBQSxPQUFBOztZQUVBLE9BQUE7OztRQUdBLElBQUEsZUFBQSxVQUFBLEdBQUE7WUFDQSxJQUFBLEtBQUEsRUFBQSxRQUFBO2dCQUNBLE9BQUEsRUFBQSxPQUFBOztZQUVBLE9BQUE7OztRQUdBLElBQUEsZ0JBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxLQUFBLEVBQUEsUUFBQTtnQkFDQSxJQUFBLEVBQUEsZUFBQSxRQUFBO29CQUNBLE9BQUEsRUFBQSxPQUFBOzs7WUFHQSxPQUFBOzs7UUFHQSxJQUFBLGNBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxLQUFBLEVBQUEsUUFBQTtnQkFDQSxJQUFBLEVBQUEsZUFBQSxRQUFBO29CQUNBLE9BQUEsRUFBQSxPQUFBOzs7OztRQUtBLElBQUEsa0JBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxLQUFBLEVBQUEsUUFBQTtnQkFDQSxJQUFBLEVBQUEsZUFBQSxXQUFBO29CQUNBLE9BQUEsRUFBQSxPQUFBOzs7OztRQUtBLElBQUEsbUJBQUEsVUFBQSxRQUFBOztZQUVBLGVBQUEsR0FBQSxNQUFBO1lBQ0EsZUFBQSxHQUFBLE1BQUE7WUFDQSxJQUFBLGdCQUFBLGdCQUFBLGdCQUFBLGNBQUE7O2dCQUVBLE9BQUEsT0FBQSxZQUFBO29CQUNBLElBQUEsT0FBQSxlQUFBLFdBQUE7d0JBQ0EsVUFBQSxLQUFBLFNBQUEsT0FBQSxlQUFBLE9BQUEsSUFBQSxPQUFBLFVBQUEsT0FBQSxPQUFBLFlBQUE7MkJBQ0EsSUFBQSxPQUFBLGVBQUEsUUFBQTt3QkFDQSxVQUFBLEtBQUEsWUFBQSxPQUFBOzs7Ozs7UUFNQSxJQUFBLFNBQUEsWUFBQTtZQUNBLElBQUEsT0FBQSxFQUFBO1lBQ0EsU0FBQSxHQUFBLE1BQUEsR0FBQTtnQkFDQSxVQUFBO2dCQUNBLGlCQUFBO2dCQUNBLFFBQUEsQ0FBQTtnQkFDQSxNQUFBLE9BQUE7Ozs7O1lB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QUEsVUFBQTtpQkFDQSxLQUFBLFVBQUEsVUFBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO2lCQUNBLEtBQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsbUJBQUE7OztZQUdBLGVBQUEsVUFBQTtpQkFDQSxLQUFBLFVBQUEsVUFBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO2lCQUNBLEtBQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsZ0JBQUE7OztZQUdBLGVBQUEsVUFBQTtpQkFDQSxLQUFBLFVBQUEsVUFBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO2lCQUNBLEtBQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsYUFBQTs7O1lBR0EsZUFBQSxVQUFBO2lCQUNBLEtBQUEsVUFBQSxVQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUE7aUJBQ0EsS0FBQSxVQUFBLEdBQUE7b0JBQ0EsT0FBQSxhQUFBLEdBQUE7OztZQUdBLGVBQUEsVUFBQTtpQkFDQSxLQUFBLFVBQUEsVUFBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO2lCQUNBLEtBQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsYUFBQTs7O1lBR0EsZUFBQSxVQUFBO2lCQUNBLEtBQUEsVUFBQSxVQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUE7aUJBQ0EsS0FBQSxVQUFBLEdBQUE7b0JBQ0EsT0FBQSxjQUFBOzs7WUFHQSxlQUFBLFVBQUE7aUJBQ0EsS0FBQSxVQUFBLFVBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQTtpQkFDQSxLQUFBLFVBQUEsR0FBQTtvQkFDQSxPQUFBLFlBQUE7OztZQUdBLGVBQUEsVUFBQTtpQkFDQSxLQUFBLFVBQUEsVUFBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO2lCQUNBLEdBQUEsU0FBQSxVQUFBLFFBQUE7b0JBQ0EsaUJBQUE7Ozs7O1lBS0EsSUFBQSxZQUFBLGVBQUE7aUJBQ0EsT0FBQTtpQkFDQSxLQUFBLFNBQUE7O1lBRUEsSUFBQSxPQUFBLFVBQUEsT0FBQTtZQUNBLElBQUEsV0FBQSxLQUFBLE9BQUE7aUJBQ0EsS0FBQSxNQUFBLFVBQUEsR0FBQTtvQkFDQSxPQUFBLEVB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QUNBLEdBQUEsWUFBQTtnQkFDQSxHQUFBLFdBQUE7Ozs7UUFJQSxJQUFBLFlBQUEsWUFBQTtZQUNBLE9BQUE7O1lBRUEsT0FBQSxFQUFBLE1BQUEsR0FBQSxZQUFBLFNBQUE7WUFDQSxFQUFBLFFBQUEsTUFBQSxVQUFBLEdBQUEsR0FBQTtnQkFDQSxLQUFBLEtBQUEsT0FBQSxJQUFBLEdBQUE7O1lBRUEsS0FBQSxRQUFBOztZQUVBLElBQUEsYUFBQSxFQUFBLE1BQUEsR0FBQSxZQUFBLFNBQUE7Z0JBQ0EsWUFBQSxFQUFBLE1BQUEsR0FBQSxZQUFBLFNBQUE7Z0JBQ0EsYUFBQSxFQUFBLE1BQUEsR0FBQSxZQUFBLFNBQUE7O1lBRUEsV0FBQSxRQUFBO1lBQ0EsVUFBQSxRQUFBO1lBQ0EsV0FBQSxRQUFBOzs7WUFHQSxTQUFBLENBQUEsTUFBQSxZQUFBLFdBQUE7O1lBRUEsSUFBQSxRQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsU0FBQTs7WUFFQSxFQUFBLFFBQUEsUUFBQSxTQUFBLElBQUE7Z0JBQ0EsT0FBQTtnQkFDQSxJQUFBLElBQUEsT0FBQSxLQUFBO29CQUNBLEtBQUEsSUFBQSxNQUFBO29CQUNBLE9BQUEsS0FBQSxJQUFBOztnQkFFQSxRQUFBLE9BQUEsT0FBQTs7O1lBR0EsSUFBQSxPQUFBO2dCQUNBLE1BQUE7OztZQUdBLFFBQUEsR0FBQSxTQUFBO2dCQUNBLFFBQUE7Z0JBQ0EsTUFBQTtvQkFDQSxHQUFBO29CQUNBLFNBQUE7b0JBQ0EsT0FBQTtvQkFDQSxRQUFBLENBQUE7b0JBQ0EsUUFBQTt3QkFDQSxTQUFBLFlBQUEsT0FBQTt3QkFDQSxRQUFBLFlBQUEsT0FBQTt3QkFDQSxTQUFBLFlBQUEsT0FBQTs7O2dCQUdBLFlBQUE7b0JBQ0EsVUFBQTs7Z0JBRUEsU0FBQTtvQkFDQSxRQUFBO3dCQUNBLE9BQUEsVUFBQSxHQUFBOzRCQUNBLE9BQUEsT0FBQSxJQUFBLEdBQUEsUUFBQSxLQUFBLE9BQUEsWUFBQSxZQUFBOzs7O2dCQUlBLE1BQUE7b0JBQ0EsR0FBQTt3QkFDQSxNQUFBO3dCQUNBLE1B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LElBQUEsTUFBQSxHQUFBLElBQUE7YUFDQSxXQUFBO2FBQ0EsWUFBQSxPQUFBLE9BQUE7YUFDQSxZQUFBLE9BQUEsT0FBQTs7UUFFQSxJQUFBLE1BQUEsR0FBQSxPQUFBLFNBQUEsSUFBQSxPQUFBLE9BQUEsS0FBQTtZQUNBLE9BQUE7WUFDQSxRQUFBO1dBQ0EsT0FBQSxLQUFBLEtBQUE7WUFDQSxhQUFBLGVBQUEsT0FBQSxJQUFBLE1BQUEsT0FBQSxJQUFBO1lBQ0EsU0FBQTs7O1FBR0EsSUFBQSxRQUFBLElBQUEsT0FBQSxLQUFBLEtBQUE7WUFDQSxhQUFBOztRQUVBLE1BQUEsT0FBQTthQUNBLE1BQUE7Z0JBQ0EsV0FBQSxJQUFBLEtBQUE7O2FBRUEsS0FBQSxTQUFBO2FBQ0EsS0FBQSxLQUFBOztRQUVBLGFBQUEsTUFBQSxPQUFBO2FBQ0EsTUFBQTtnQkFDQSxVQUFBOzthQUVBLEtBQUE7Z0JBQ0EsS0FBQTs7YUFFQSxNQUFBLFFBQUEsWUFBQTtnQkFDQSxPQUFBOzs7UUFHQSxPQUFBLElBQUEsT0FBQTthQUNBLE1BQUE7Z0JBQ0EsWUFBQTs7YUFFQSxLQUFBLGVBQUE7YUFDQSxLQUFBLE1BQUE7OztRQUdBLFlBQUEsVUFBQSxZQUFBLGVBQUE7WUFDQSxXQUFBLFVBQUEsUUFBQSxVQUFBLEdBQUE7Z0JBQ0EsSUFBQSxPQUFBLE1BQUEsYUFBQTtvQkFDQSxJQUFBOztnQkFFQSxJQUFBLElBQUEsR0FBQSxZQUFBLEVBQUEsWUFBQTtnQkFDQSxPQUFBLFVBQUEsR0FBQTtvQkFDQSxFQUFBLGFBQUEsRUFBQTtvQkFDQSxLQUFBLEtBQUEsY0FBQSxFQUFBO29CQUNBLE9BQUE7Ozs7UUFJQSxXQUFBLFVBQUEsWUFBQSxVQUFBO1lBQ0EsV0FBQSxVQUFBLEtBQUEsVUFBQSxHQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBLFlBQUEsRUFBQSxVQUFBO2dCQUNBLE9BQUEsVUFBQSxHQUFBO29CQUNBLEVBQUEsV0FBQSxFQUFBO29CQUNBLE9BQUEsSUFBQTs7Ozs7UUFLQSxnQkFBQTs7UUFFQSxPQUFBOzs7SUFHQSxJQUFBLFNBQUEsVUFBQSxPQUFBO1FBQ0EsSUFBQSxlQUFBO1lBQ0EsSUFBQSxhQUFBO1lBQ0EsSUFBQSxhQUFBLEdBQUE7Z0JBQ0EsY0FBQTs7O1lBR0EsV0FBQSxhQUFBLFNBQUE7aUJBQ0EsTUFBQSxRQUFBLFlBQUE7b0JBQ0EsT0FBQTs7aUJBRUEsS0FBQSxVQUFBLENBQUEsS0FBQSxLQUFBLEtBQUE7WUFDQSxLQUFBLGFBQUEsU0FBQSxNQUFBLEtBQUEsV0FBQTs7OztJQUlBLE9BQUEsT0FBQSxjQUFBLFVBQUEsT0FBQTtRQUNBLElBQUEsU0FBQSxDQUFBLGVBQUE7WUFDQTtlQUNBO1lBQ0EsT0FBQTs7Ozs7QUM5SEE7O0FBRUEsUUFBQSxPQUFBLFlBQUEsVUFBQSx1QkFBQSxZQUFBO0lBQ0EsT0FBQTtRQUNBLFlBQUE7UUFDQSxVQUFBO1FBQ0EsT0FBQTtZQUNBLFlBQUE7Ozs7O0FDUEEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsV0FBQSx3RUFBQSxVQUFBLFFBQUEsVUFBQSxhQUFBO1FBQ0EsSUFBQSxLQUFBO1lBQ0EsUUFBQTtZQUNBLFlBQUE7O1FBRUEsU0FBQSxHQUFBLFdBQUEsWUFBQTtZQUNBLFFBQUEsSUFBQTs7O1FBR0EsSUFBQSxhQUFBLFlBQUE7WUFDQSxPQUFBLE9BQUEsU0FBQSxVQUFBLE9BQUE7Z0JBQ0E7Ozs7UUFJQSxJQUFBLGVBQUEsWUFBQTtZQUNBLElBQUEsT0FBQSxTQUFBLE9BQUEsTUFBQSxTQUFBLEdBQUE7Z0JBQ0EsT0FBQSxNQUFBLEtBQUEsVUFBQSxHQUFBLEdBQUE7b0JBQ0EsT0FBQSxFQUFBLE9BQUEsU0FBQSxFQUFBLE9BQUE7OztnQkFHQSxZQUFBLEVBQUEsT0FBQSxPQUFBLE1BQUEsWUFBQSxPQUFBO2dCQUNBLElBQUEsU0FBQSxVQUFBLFNBQUEsS0FBQTs7Z0JBRUEsSUFBQSxRQUFBLFNBQUEsR0FBQTtnQkFDQSxJQUFBLENBQUEsU0FBQSxVQUFBLEdBQUEsRUFBQSxRQUFBOzs7Z0JBR0EsT0FBQSxNQUFBLEtBQUEsVUFBQSxHQUFBLEdBQUE7b0JBQ0EsT0FBQSxFQUFBLE9BQUEsV0FBQSxFQUFBLE9BQUE7O2dCQUVBLElBQUEsVUFBQSxPQUFBLE1BQUEsR0FBQSxPQUFBO2dCQUNBLElBQUEsVUFBQSxPQUFBLE1BQUEsT0FBQSxNQUFBLFNBQUEsR0FBQSxPQUFBO2dCQUNBLElBQUEsV0FBQSxPQUFBLElBQUEsU0FBQSxLQUFBLE9BQUEsSUFBQSxTQUFBO2dCQUNBLElBQUEsU0FBQTtnQkFDQSxJQUFBLFdBQUEsR0FBQTtvQkFDQSxTQUFBOzs7Z0JBR0EsUUFBQSxHQUFBLFFBQUEsU0FBQSxpQkFBQSxVQUFBLFdBQUEsV0FBQSxZQUFBLGtCQUFBLFdBQUEsUUFBQSxNQUFBLE9BQUEsU0FBQSxNQUFBLE9BQUEsT0FBQSxPQUFBLFFBQUEsTUFBQTs7Z0JBRUEsTUFBQSxlQUFBOztnQkFFQSxNQUFBLE9BQUE7Ozs7O1FBS0EsR0FBQSxhQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLE9BQUEsSUFBQSxNQUFBOztpQkFFQTtnQkFDQSxPQUFBOzs7UUFHQTs7UUFFQSxVQUFBLGVBQUEsWUFBQTtRQUNBLE9BQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTtZQUNBLGFBQUE7WUFDQSxVQUFBO1lBQ0EsT0FBQTtnQkFDQSxPQUFBO2dCQUNBLFNBQUE7Z0JBQ0EsT0FBQTs7Ozs7OztBQ3RFQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxVQUFBLHFCQUFBLFlBQUE7UUFDQSxPQUFBO1lBQ0EsYUFBQTtZQUNBLFVBQUE7Ozs7QUNOQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxVQUFBLGtCQUFBLFlBQUE7UUFDQSxPQUFBO1lBQ0EsVUFBQTtZQUNBLFNBQUE7WUFDQSxPQUFBO2dCQUNBLHlCQUFBO2dCQUNBLGlCQUFBO2dCQUNBLFdBQUE7Z0JBQ0EsaUJBQUE7Z0JBQ0Esd0JBQUE7Z0JBQ0EsaUJBQUE7Z0JBQ0EsU0FBQTs7WUFFQSxNQUFBLFNBQUEsT0FBQSxTQUFBLFlBQUE7Z0JBQ0EsVUFBQSxFQUFBLFFBQUE7O2dCQUVBLFFBQUEsWUFBQTtvQkFDQSxpQkFBQSxNQUFBO29CQUNBLGdDQUFBO29CQUNBLFdBQUEsTUFBQSxhQUFBO29CQUNBLGlCQUFBLE1BQUEsbUJBQUE7b0JBQ0Esd0JBQUEsTUFBQTtvQkFDQSxpQkFBQSxNQUFBLG1CQUFBO29CQUNBLFVBQUEsVUFBQSxlQUFBLFNBQUE7d0JBQ0EsTUFBQSxPQUFBLFlBQUE7NEJBQ0EsTUFBQSxVQUFBLFFBQUE7Ozs7O2dCQUtBLE1BQUEsaUJBQUEsMkJBQUEsVUFBQSxVQUFBLFVBQUE7b0JBQ0EsSUFBQSxRQUFBLE9BQUEsVUFBQSxXQUFBO3dCQUNBOztvQkFFQSxRQUFBLFlBQUEsZ0JBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDckNBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFFBQUEsZ0NBQUEsVUFBQSxhQUFBO1FBQ0EsSUFBQSxRQUFBLFVBQUEsaUJBQUE7UUFDQTtZQUNBLEtBQUEsa0JBQUE7O1lBRUEsSUFBQSxPQUFBOztZQUVBLEtBQUEsWUFBQSxTQUFBO1lBQ0E7Z0JBQ0EsS0FBQSxTQUFBOztnQkFFQSxLQUFBLE9BQUEsT0FBQSxLQUFBLE9BQUEsT0FBQTs7Z0JBRUEsS0FBQSxPQUFBLFNBQUEsS0FBQSxPQUFBLE9BQUEsT0FBQTtnQkFDQSxLQUFBLE9BQUEsS0FBQSxLQUFBLE9BQUEsT0FBQTtnQkFDQSxLQUFBLE9BQUEsS0FBQSxLQUFBLE9BQUEsT0FBQTs7Z0JBRUEsS0FBQSxPQUFBLE1BQUEsYUFBQSxjQUFBLE1BQUEsY0FBQSxNQUFBO2dCQUNBLEtBQUEsT0FBQSxNQUFBLGFBQUEsY0FBQSxNQUFBLGNBQUEsTUFBQTtnQkFDQSxLQUFBLE9BQUEsUUFBQSxLQUFBLE9BQUEsTUFBQSxLQUFBLE9BQUE7O2dCQUVBLEtBQUEsT0FBQSxhQUFBLGNBQUEsY0FBQTtnQkFDQSxLQUFBLE9BQUEsYUFBQSxjQUFBLGNBQUE7O2dCQUVBLEtBQUEsT0FBQSxjQUFBLGNBQUEsY0FBQTtnQkFDQSxLQUFBLE9BQUEsY0FBQSxjQUFBLGVBQUE7Z0JBQ0EsS0FBQSxPQUFBLFlBQUEsY0FBQSxZQUFBO2dCQUNBLEtBQUEsT0FBQSxjQUFBLGNBQUEsYUFBQTs7Z0JBRUEsS0FBQSxPQUFBLHFCQUFBLGNBQUEsc0JBQUE7OztZQUdBLEtBQUEsU0FBQTtZQUNBO2dCQUNBLEtBQUEsT0FBQSxHQUFBLE9BQUEsTUFBQSxLQUFBO3FCQUNBLE9BQUE7cUJBQ0EsS0FBQSxTQUFBO3FCQUNBLEtBQUEsU0FBQSxLQUFBLE9BQUE7cUJBQ0EsS0FBQSxVQUFBLEtBQUEsT0FBQTs7Z0JBRUEsS0FBQSxLQUFBLE9BQUE7cUJBQ0EsS0FBQSxTQUFBO3FCQUNBLEtBQUEsTUFBQSxLQUFBLE9BQUE7cUJBQ0EsS0FBQSxNQUFBLEtBQUEsT0FBQTtxQkFDQSxLQUFBLEtBQUEsS0FBQSxPQUFBO3FCQUNBLE1BQUEsUUFBQTs7OztnQkFJQSxLQUFBLEtBQUEsT0FBQTtxQkFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO3FCQUNBLEtBQUEsTUFBQSxLQUFBLE9BQUE7cUJBQ0EsS0FBQSxLQUFBLE1BQUEsS0FBQSxPQUFBO3FCQUNBLE1BQUEsUUFBQTtxQkFDQSxNQUFBLFVBQUE7cUJBQ0EsTUFBQSxnQkFBQTs7Z0JBRUEsS0FBQSxJQUFBLFlBQUEsS0FBQSxPQUFBO2dCQUNBO29CQUNBLEtBQUEsU0FBQSxLQUFBLE9BQUEsV0FBQSxVQUFBLE1BQUEsS0FBQSxPQUFBLFdBQUEsVUFBQSxJQUFBLEtBQUEsT0FBQTs7O2dCQUdBLEtBQUEsSUFBQSxhQUFBLEtBQUEsT0FBQTtnQkFDQTtvQkFDQSxLQUFBLFNBQUEsS0FBQSxPQUFBLFlBQUEsV0FBQSxNQUFBLEtBQUEsT0FBQSxZQUFBLFdBQUEsSUFBQSxLQUFBLE9BQUE7OztnQkFHQSxLQUFBLElBQUEsVUFBQSxLQUFBLE9BQUE7Z0JBQ0E7b0JBQ0EsS0FBQSxTQUFBLEtBQUEsT0FBQSxTQUFBLFFBQUEsTUFBQSxLQUFBLE9BQUEsU0FBQSxRQUFBLElBQUEsS0FBQSxPQUFBOzs7Z0JBR0EsSUFB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QUEsY0FBQSxLQUFBLElBQUEsR0FBQSxTQUFBLE1BQUE7WUFDQSxPQUFBLElBQUEsTUFBQSxjQUFBLElBQUEsY0FBQSxJQUFBLEdBQUEsS0FBQSxPQUFBOzs7UUFHQSxPQUFBO1lBQ0EsMEJBQUEsU0FBQSxJQUFBO2dCQUNBLElBQUEsTUFBQSxHQUFBO29CQUNBLElBQUEsTUFBQSxNQUFBO3dCQUNBLE9BQUEsSUFBQSxRQUFBLEtBQUE7O29CQUVBLElBQUEsT0FBQSxRQUFBLE1BQUEsS0FBQSxNQUFBO3dCQUNBLE9BQUEsQ0FBQSxJQUFBLE1BQUEsUUFBQSxLQUFBOztvQkFFQSxPQUFBLENBQUEsSUFBQSxLQUFBLE1BQUEsUUFBQSxLQUFBOztnQkFFQSxPQUFBOztZQUVBLDRCQUFBLFNBQUEsSUFBQSxTQUFBO2dCQUNBLElBQUEsTUFBQSxHQUFBO29CQUNBLElBQUEsTUFBQSxNQUFBO3dCQUNBLE9BQUEsSUFBQSxRQUFBLFlBQUE7O29CQUVBLElBQUEsT0FBQSxRQUFBLE1BQUEsS0FBQSxNQUFBO3dCQUNBLE9BQUEsQ0FBQSxJQUFBLE1BQUEsUUFBQSxZQUFBOztvQkFFQSxJQUFBLE9BQUEsS0FBQSxRQUFBLE1BQUEsS0FBQSxLQUFBLE1BQUE7d0JBQ0EsT0FBQSxDQUFBLElBQUEsS0FBQSxNQUFBLFFBQUEsWUFBQTs7b0JBRUEsSUFBQSxPQUFBLEtBQUEsS0FBQSxRQUFBLE1BQUEsS0FBQSxLQUFBLEtBQUEsTUFBQTt3QkFDQSxPQUFBLENBQUEsSUFBQSxLQUFBLEtBQUEsTUFBQSxRQUFBLFlBQUE7O29CQUVBLE9BQUEsQ0FBQSxJQUFBLEtBQUEsS0FBQSxLQUFBLE1BQUEsUUFBQSxZQUFBOztnQkFFQSxPQUFBOztZQUVBLGlCQUFBLFlBQUE7Z0JBQ0EsSUFBQSxJQUFBO29CQUNBLElBQUE7b0JBQ0EsSUFBQSxFQUFBO29CQUNBLElBQUEsU0FBQTtvQkFDQSxJQUFBLEVBQUEsY0FBQSxFQUFBLGVBQUEsRUFBQTtvQkFDQSxJQUFBLEVBQUEsZUFBQSxFQUFBLGdCQUFBLEVBQUE7O2dCQUVBLE9BQUE7b0JBQ0EsT0FBQTtvQkFDQSxRQUFBOzs7WUFHQSxtQkFBQSxVQUFBLE9BQUEsTUFBQTtnQkFDQSxJQUFBLEtBQUEsT0FBQSxJQUFBO29CQUNBLE9BQUEsT0FBQSxJQUFBO29CQUNBLE9BQUEsT0FBQSxJQUFBLElBQUEsS0FBQSxPQUFBLElBQUE7b0JBQ0EsY0FBQTs7Z0JBRUEsSUFBQSxXQUFBLE9BQUEsU0FBQTs7Z0JBRUEsY0FBQSxTQUFBLFNBQUEsSUFBQSxjQUFBLFlBQUEsU0FBQSxRQUFBLEtBQUEsUUFBQTtnQkFDQSxjQUFBLFNBQUEsVUFBQSxJQUFBLGNBQUEsWUFBQSxTQUFBLFNBQUEsS0FBQSxRQUFBO2dCQUNBLGNBQUEsU0FBQSxZQUFBLElBQUEsY0FBQSxZQUFBLFNBQUEsV0FBQSxLQUFBLFFBQUE7Z0JBQ0EsY0FBQSxjQUFBLFlBQUEsU0FBQSxXQUFBLEtBQUE7O2dCQUVBLE9BQUE7O1lBRUEsY0FBQSxTQUFBLFVBQUE7Z0JBQ0EsSUFBQSxTQUFBLENBQUEsU0FBQSxTQUFBLFVBQUEsWUFBQSxXQUFBLFNBQUE7Z0JBQ0EsT0FBQSxPQUFBOztZQUVBLE1BQUEsWUFBQTtnQkFDQSxJQUFBLEtBQUEsT0FBQSxVQUFBO29CQUNBLFFBQUEsR0FBQSxRQUFBO29CQUNBLFFBQUEsR0FBQSxRQUFBOztnQkFFQSxJQUFBLENBQUEsUUFBQSxDQUFBLE9BQUEsUUFBQSxDQUFBLElBQUE7b0JBQ0EsT0FBQTs7Z0JBRUEsT0FBQTs7WUFFQSxZQUFBLFlBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7O2dCQUVBLE1BQUE7b0JBQ0EsS0FBQSxZQUFBLEtBQUEsWUFBQSxNQUFBLFlBQUEsZUFBQTtvQkFDQSxRQUFBO21CQUNBLFFBQUEsVUFBQSxNQUFBO29CQUNBLEVBQUEsUUFBQTttQkFDQSxNQUFBLFVBQUEsT0FBQTtvQkFDQSxFQUFBLE9BQUE7OztnQkFHQSxPQUFBLEVBQUE7O1lBRUEsZUFBQSxVQUFBLFFBQUE7O2dCQUVBLFNBQUEsVUFBQSxZQUFBOztnQkFFQSxJQUFBLFdBQUEsS0FBQTtvQkFDQSxnQkFBQSxTQUFBLFNBQUE7O2dCQUVBLE9BQUEsYUFBQSxnQkFBQSxxQkFBQSxnQkFBQTs7Ozs7O0FDMUdBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFFBQUEsbURBQUEsVUFBQSxPQUFBLElBQUEsYUFBQTtRQUNBLElBQUEseUJBQUEsVUFBQSxXQUFBO1lBQ0EsT0FBQTtnQkFDQSxXQUFBOzs7O1FBSUEsT0FBQTtZQUNBLGlCQUFBLFVBQUEsTUFBQTtnQkFDQSxPQUFBLFFBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7O2dCQUVBLE1BQUE7b0JBQ0EsS0FBQSxZQUFBLEtBQUEsWUFBQTtvQkFDQSxRQUFBO29CQUNBLE1BQUE7bUJBQ0EsUUFBQSxVQUFBLFFBQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7O2dCQUdBLE9BQUEsRUFBQTs7Ozs7O0FDekJBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFFBQUEsOEJBQUEsVUFBQSxXQUFBO1FBQ0EsSUFBQSxVQUFBO1lBQ0EsY0FBQTtZQUNBLGFBQUE7WUFDQSxzQkFBQTtZQUNBLGlCQUFBO1lBQ0EsNkJBQUE7WUFDQSxnQkFBQTtZQUNBLGlCQUFBO1lBQ0EsZ0JBQUE7WUFDQSxlQUFBO1lBQ0EsbUJBQUE7WUFDQSx1QkFBQTtZQUNBLGNBQUE7O1FBRUEsSUFBQSxvQkFBQSxVQUFBLE1BQUE7O1lBRUEsS0FBQSxPQUFBLEtBQUEsUUFBQTtZQUNBLEtBQUEsWUFBQSxLQUFBLGFBQUE7WUFDQSxLQUFBLFVBQUEsS0FBQSxXQUFBLE9BQUEsTUFBQSxTQUFBLEdBQUEsU0FBQSxRQUFBLEtBQUE7WUFDQSxLQUFBLFFBQUEsS0FBQSxTQUFBLE9BQUEsTUFBQSxNQUFBLEtBQUE7WUFDQSxLQUFBLFFBQUEsS0FBQSxRQUFBLE1BQUEsUUFBQSxLQUFBLFNBQUEsS0FBQSxRQUFBLENBQUEsS0FBQSxTQUFBO1lBQ0EsS0FBQSxTQUFBLEtBQUEsVUFBQTs7WUFFQSxFQUFBLFFBQUEsRUFBQSxNQUFBLE9BQUEsVUFBQSxPQUFBO2dCQUNBLFVBQUEsT0FBQSxNQUFBLElBQUEsTUFBQTs7OztRQUlBLElBQUEsaUJBQUEsVUFBQSxNQUFBO1lBQ0EsT0FBQTtnQkFDQSxNQUFBLEtBQUEsT0FBQSxTQUFBLEtBQUEsUUFBQTtnQkFDQSxXQUFBLEtBQUEsWUFBQSxTQUFBLEtBQUEsYUFBQTtnQkFDQSxTQUFBLEtBQUEsVUFBQSxLQUFBLFVBQUEsT0FBQSxNQUFBLFNBQUEsR0FBQSxTQUFBLFFBQUEsS0FBQTtnQkFDQSxPQUFBLEtBQUEsUUFBQSxLQUFBLFFBQUEsT0FBQSxNQUFBLE1BQUEsS0FBQTtnQkFDQSxPQUFBLEtBQUEsUUFBQSxNQUFBLFFBQUEsS0FBQSxTQUFBLEtBQUEsUUFBQSxDQUFBLEtBQUEsU0FBQSxDQUFBO2dCQUNBLFFBQUEsS0FBQSxTQUFBLEtBQUEsU0FBQTtnQkFDQSxnQkFBQSxLQUFBLGlCQUFBLEtBQUEsaUJBQUE7Z0JBQ0EsYUFBQSxLQUFBLGNBQUEsU0FBQSxLQUFBLGVBQUE7Z0JBQ0EsZUFBQSxLQUFBLGdCQUFBLEtBQUEsZ0JBQUE7Z0JBQ0EsbUJBQUEsS0FBQSxvQkFBQSxLQUFBLG9CQUFBO2dCQUNBLEtBQUE7Ozs7UUFJQSxJQUFBLDBCQUFBLFVBQUEsTUFBQTtZQUNBLE9BQUE7Z0JBQ0EsTUFBQSxLQUFBLE9BQUEsU0FBQSxLQUFBLFFBQUE7Z0JBQ0EsV0FBQSxLQUFBLFlBQUEsU0FBQSxLQUFBLGFBQUE7Z0JBQ0EsU0FBQSxLQUFBLFVBQUEsS0FBQSxVQUFBLE9BQUEsTUFBQSxTQUFBLEdBQUEsU0FBQSxRQUFBLEtBQUE7Z0JBQ0EsT0FBQSxLQUFBLFFBQUEsS0FBQSxRQUFBLE9BQUEsTUFBQSxNQUFBLEtBQUE7Z0JBQ0EsT0FBQSxLQUFBLFFBQUEsTUFBQSxRQUFBLEtBQUEsU0FBQSxLQUFBLFFBQUEsQ0FBQSxLQUFBLFNBQUEsQ0FBQTtnQkFDQSxRQUFBLEtBQUEsU0FBQSxLQUFBLFNBQUE7Z0JBQ0EsYUFBQSxLQUFBLGNBQUEsU0FBQSxLQUFBLGVBQUE7Z0JBQ0EsZUFBQSxLQUFBLGdCQUFBLEtBQUEsZ0JBQUE7Z0JBQ0EsbUJBQUEsS0FBQSxvQkFBQSxLQUFBLG9CQUFBO2dCQUNBLFNBQUEsS0FBQSxVQUFBLEtBQUEsVUFBQTs7OztRQUlBLElBQUEsaUNBQUEsVUFBQSxNQUFBO1lBQ0EsT0FBQTtnQkFDQSxNQUFBO2dCQUNBLFdBQUE7Z0JBQ0EsU0FBQTtnQkFDQSxPQUFBO2dCQUNBLE1BQUEsS0FBQSxPQUFBLEtBQUEsT0FBQTtnQkFDQSxVQUFBO2dCQUNBLE9BQUE7Ozs7UUFJQSxJQUFBLG9CQUFBLFVBQUEsTUFBQTtZQUNBLE9BQUE7Z0JBQ0EsTUFBQSxLQUFBLE9BQUEsU0FBQSxLQUFBLFFBQUE7Z0JBQ0EsV0FBQSxLQUFBLFlBQUEsU0FBQSxLQUFBLGFBQUE7Z0JBQ0EsU0FBQSxLQUFBLFVBQUEsS0FBQSxVQUFBLE9BQUEsTUFBQSxTQUFBLEdBQUEsU0FBQSxRQUFBLEtBQUE7Z0JBQ0EsT0FBQSxLQUFBLFFBQUEsS0FBQSxRQUFBLE9BQUEsTUFBQSxNQUFBLEtBQUE7Z0JBQ0EsT0FBQSxLQUFBLFFBQUEsTUFBQSxRQUFBLEtBQUEsU0FBQSxLQUFBLFFBQUEsQ0FBQSxLQUFBLFNBQUEsQ0FBQTtnQkFDQSxTQUFBLEtBQUEsVUFBQSxTQUFBLEtBQUEsV0FBQTtnQkFDQSxXQUFBLEtBQUEsWUFBQSxLQUFBLFlBQUE7Z0JBQ0EsS0FBQTs7OztRQUlBLElBQUEsb0JBQUEsVUFBQSxNQUFBO1lBQ0EsT0FBQTtnQkFDQSxNQUFBLEtBQUEsT0FBQSxTQUFBLEtBQUEsUUFBQTtnQkFDQSxXQUFBLEtBQUEsWUFBQSxTQUFBLEtBQUEsYUFBQTtnQkFDQSxTQUFBLEtBQUEsVUFBQSxLQUFBLFVBQUEsT0FBQSxNQUFBLFNBQUEsR0FBQSxTQUFBLFFBQUEsS0FBQTtnQkFDQSxPQUFBLEtBQUEsUUFBQSxLQUFBLFFBQUEsT0FBQSxNQUFBLE1BQUEsS0FBQTtnQkFDQSxPQUFBLEtBQUEsUUFBQSxNQUFBLFFBQUEsS0FBQSxTQUFBLEtBQUEsUUFBQSxDQUFBLEtBQUEsU0FBQSxDQUFBO2dCQUNBLFFBQUEsS0FBQSxTQUFBLEtBQUEsU0FBQTs7OztRQUlBLElBQUEsa0JBQUEsVUFBQSxNQUFBO1lBQ0EsT0FBQTtnQkFDQSxNQUFBLEtBQUEsT0FBQSxTQUFBLEtBQUEsUUFBQTtnQkFDQSxXQUFBLEtBQUEsWUFBQSxTQUFBLEtBQUEsYUFBQTtnQkFDQSxTQUFBLEtBQUEsVUFBQSxLQUFBLFVBQUEsT0FBQSxNQUFBLFNBQUEsR0FBQSxTQUFBLFFBQUEsS0FBQTtnQkFDQSxPQUFBLEtBQUEsUUFBQSxLQUFBLFFBQUEsT0FBQSxNQUFBLE1BQUEsS0FBQTtnQkFDQSxPQUFBLEtBQUEsUUFBQSxNQUFBLFFBQUEsS0FBQSxTQUFBLEtBQUEsUUFBQSxDQUFBLEtBQUEsU0FBQSxDQUFBO2dCQUNBLGtCQUFBLEtBQUEsbUJBQUEsS0FBQSxtQkFBQTs7OztRQUlBLElBQUEsdUJBQUEsVUFBQSxNQUFBO1lBQ0EsT0FBQTtnQkFDQSxNQUFBLEtBQUEsT0FBQSxTQUFBLEtBQUEsUUFBQTtnQkFDQSxXQUFBLEtBQUEsWUFBQSxTQUFBLEtBQUEsYUFBQTtnQkFDQSxTQUFBLEtBQUEsVUFBQSxLQUFBLFVBQUEsT0FBQSxNQUFBLFNBQUEsR0FBQSxTQUFBO2dCQUNBLE9BQUEsS0FBQSxRQUFBLEtBQUEsUUFBQSxPQUFBLE1BQUE7Ozs7UUFJQSxPQUFBO1lBQ0EsWUFBQSxZQUFBO2dCQUNBLE9BQUE7O1lBRUEsWUFBQSxVQUFBLE1BQUE7Z0JBQ0EsVUFBQTs7WUFFQSxnQkFBQSxZQUFBO2dCQUNBLE9BQUE7O1lBRUEsZ0JBQUEsVUFBQSxNQUFBO2dCQUNBLGNBQUE7O1lBRUEsZUFBQSxZQUFBO2dCQUNBLElBQUEsRUFBQSxLQUFBLFlBQUEsV0FBQSxHQUFBO29CQUNBLE9BQUEsZUFBQSxVQUFBOztnQkFFQSxPQUFBOztZQUVBLGVBQUEsVUFBQSxNQUFBO2dCQUNBLGFBQUEsZUFBQTtnQkFDQSxrQkFBQTs7WUFFQSx3QkFBQSxZQUFBO2dCQUNBLElBQUEsRUFBQSxLQUFBLHFCQUFBLFdBQUEsR0FBQTtvQkFDQSxPQUFBLHdCQUFBLFVBQUE7O2dCQUVBLE9BQUE7O1lBRUEsd0JBQUEsVUFBQSxNQUFBO2dCQUNBLHNCQUFBLHdCQUFBO2dCQUNBLGtCQUFBOztZQUVBLCtCQUFBLFlBQUE7Z0JBQ0EsSUFBQSxFQUFBLEtBQUEsNEJBQUEsV0FBQSxHQUFBO29CQUNBLE9BQUEsK0JBQUEsVUFBQTs7Z0JBRUEsT0FBQTs7WUFFQSwrQkFBQSxVQUFBLE1BQUE7Z0JBQ0EsNkJBQUEsK0JBQUE7Z0JBQ0EsRUFBQSxRQUFBLEVBQUEsTUFBQSw2QkFBQSxVQUFBLE9BQUE7b0JBQ0EsVUFBQSxPQUFBLE1BQUEsSUFBQSxNQUFBOzs7WUFHQSxtQkFBQSxZQUFBO2dCQUNBLE9BQUE7O1lBRUEsbUJBQUEsVUFBQSxNQUFBO2dCQUNBLGlCQUFBOztZQUVBLGtCQUFBLFlBQUE7Z0JBQ0EsSUFBQSxFQUFBLEtBQUEsZUFBQSxXQUFBLEdBQUE7b0JBQ0EsT0FBQSxrQkFBQSxVQUFBOztnQkFFQSxPQUFBOztZQUVBLGtCQUFBLFVBQUEsTUFBQTtnQkFDQSxnQkFBQSxrQkFBQTtnQkFDQSxrQkFBQTs7WUFFQSxtQkFBQSxZQUFBO2dCQUNBLE9BQUE7O1lBRUEsbUJBQUEsVUFBQSxNQUFBO2dCQUNBLGlCQUFBOztZQUVBLGtCQUFBLFlBQUE7Z0JBQ0EsSUFBQSxFQUFBLEtBQUEsZUFBQSxXQUFBLEdBQUE7b0JBQ0EsT0FBQSxrQkFBQSxVQUFBOztnQkFFQSxPQUFBOztZQUVBLGtCQUFBLFVBQUEsTUFBQTtnQkFDQSxnQkFBQSxrQkFBQTtnQkFDQSxrQkFBQTs7WUFFQSxpQkFBQSxZQUFBO2dCQUNBLE9BQUE7O1lBRUEsaUJBQUEsVUFBQSxNQUFBO2dCQUNBLGVBQUE7O1lBRUEscUJBQUEsWUFBQTtnQkFDQSxJQUFBLEVBQUEsS0FBQSxrQkFBQSxXQUFBLEdBQUE7b0JBQ0EsT0FBQSxxQkFBQSxVQUFBOztnQkFFQSxPQUFBOztZQUVBLHFCQUFBLFVBQUEsTUFBQTtnQkFDQSxtQkFBQSxxQkFBQTtnQkFDQSxrQkFBQTs7WUFFQSx5QkFBQSxZQUFBO2dCQUNBLE9BQUE7O1lBRUEseUJBQUEsVUFBQSxNQUFBO2dCQUNBLHVCQUFBOztZQUVBLGdCQUFBLFlBQUE7Z0JBQ0EsSUFBQSxFQUFBLEtBQUEsYUFBQSxXQUFBLEdBQUE7b0JBQ0EsT0FBQSxnQkFBQSxVQUFBOztnQkFFQSxPQUFBOztZQUVBLGdCQUFBLFVBQUEsTUFBQTtnQkFDQSxjQUFBLGdCQUFBO2dCQUNBLGtCQUFBOzs7Ozs7QUNsT0EsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSxtRkFBQSxVQUFBLFdBQUEsYUFBQSxRQUFBLGVBQUEsUUFBQTtRQUNBLE9BQUE7WUFDQSxXQUFBLFlBQUE7Z0JBQ0EsSUFBQSxpQkFBQSxVQUFBLFlBQUEsS0FBQSxZQUFBO29CQUNBLGVBQUEsY0FBQSxVQUFBLGdCQUFBLFlBQUEsY0FBQTs7Z0JBRUEsT0FBQSxhQUFBLFFBQUEsS0FBQSxNQUFBLE1BQUEsVUFBQSxRQUFBO29CQUNBLElBQUEsT0FBQSxXQUFBO3dCQUNBLFNBQUEsT0FBQSxZQUFBOzJCQUNBO3dCQUNBLGFBQUE7O29CQUVBLE9BQUE7Ozs7OztBQ2ZBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFFBQUEsZUFBQSxZQUFBO1FBQ0EsT0FBQTtZQUNBLGNBQUEsWUFBQTtnQkFDQSxJQUFBLFFBQUEsYUFBQSxRQUFBO2dCQUNBLElBQUE7b0JBQ0EsT0FBQSxLQUFBLE1BQUE7a0JBQ0EsT0FBQSxHQUFBO29CQUNBLFFBQUEsSUFBQTtvQkFDQSxPQUFBOzs7WUFHQSxjQUFBLFVBQUEsTUFBQTtnQkFDQSxJQUFBLFNBQUEsTUFBQTtvQkFDQSxhQUFBLFFBQUEsYUFBQSxLQUFBLFVBQUE7dUJBQ0E7b0JBQ0EsYUFBQSxXQUFBOzs7O1lBSUEsT0FBQSxVQUFBLFVBQUE7Z0JBQ0EsSUFBQSxPQUFBO29CQUNBLFVBQUE7b0JBQ0EsVUFBQTs7Z0JBRUEsS0FBQSxhQUFBO2dCQUNBLE9BQUE7O1lBRUEsUUFBQSxZQUFBO2dCQUNBLEtBQUEsYUFBQTs7Ozs7O0FDL0JBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFdBQUEsd0hBQUEsVUFBQSxRQUFBLFdBQUEsYUFBQSxZQUFBLGVBQUEsYUFBQSxRQUFBO1FBQ0EsSUFBQSxLQUFBOztRQUVBLEdBQUEsVUFBQTtRQUNBLEdBQUEsV0FBQTtRQUNBLEdBQUEsY0FBQSxZQUFBLFlBQUE7UUFDQSxHQUFBLGdCQUFBO1FBQ0EsR0FBQSxjQUFBO1FBQ0EsR0FBQSxpQkFBQTs7UUFFQSxHQUFBLHNCQUFBLFdBQUE7WUFDQTs7OztRQUlBLEdBQUEsNEJBQUEsV0FBQTtZQUNBO1lBQ0E7OztRQUdBLElBQUEsZ0JBQUEsV0FBQTtZQUNBLElBQUEsU0FBQTtZQUNBLElBQUEsV0FBQSxHQUFBLGVBQUEsR0FBQSxhQUFBLE9BQUEsS0FBQTtZQUNBLElBQUEsZ0JBQUEsR0FBQSxnQkFBQSxHQUFBLGdCQUFBOztZQUVBLE9BQUEsVUFBQSxPQUFBLE1BQUEsU0FBQSxHQUFBLGFBQUEsR0FBQSxnQkFBQSxRQUFBLEtBQUE7WUFDQSxPQUFBLFFBQUEsT0FBQSxJQUFBLE9BQUEsU0FBQSxJQUFBLEdBQUEsR0FBQSxnQkFBQSxNQUFBLEtBQUE7O1lBRUEsSUFBQSxZQUFBLFVBQUEsU0FBQSxXQUFBO2dCQUNBLE9BQUEsWUFBQTttQkFDQSxJQUFBLFVBQUEsU0FBQSxXQUFBO2dCQUNBLE9BQUEsWUFBQSxVQUFBLFNBQUE7OztZQUdBLElBQUEsaUJBQUEsVUFBQSxTQUFBLGlCQUFBO2VBQ0EsT0FBQSxrQkFBQTttQkFDQSxJQUFBLFVBQUEsU0FBQSxpQkFBQTtlQUNBLFFBQUEsSUFBQSxvQ0FBQSxVQUFBLFNBQUE7ZUFDQSxPQUFBLGtCQUFBLFVBQUEsU0FBQTs7O1lBR0EsT0FBQTs7O1FBR0EsSUFBQSxVQUFBLFlBQUE7WUFDQSxHQUFBLFVBQUE7WUFDQSxJQUFBLFVBQUEsU0FBQSxpQkFBQTtnQkFDQSxHQUFBLGdCQUFBLFVBQUEsU0FBQTs7WUFFQSxJQUFBLGFBQUE7WUFDQSxVQUFBLE9BQUE7WUFDQSxZQUFBLFFBQUEsWUFBQSxLQUFBLFVBQUEsTUFBQTtnQkFDQSxHQUFBLFdBQUEsRUFBQSxZQUFBLEtBQUEsU0FBQSxDQUFBLGdCQUFBLENBQUE7Z0JBQ0EsSUFBQSxXQUFBLFVBQUEsU0FBQTtnQkFDQSxHQUFBLFNBQUE7O29CQUVBLElBQUEsT0FBQSxFQUFBLEtBQUEsR0FBQSxVQUFBLFVBQUEsS0FBQTt3QkFDQSxPQUFBLEtBQUEsT0FBQSxNQUFBOztvQkFFQSxHQUFBLGVBQUEsT0FBQSxPQUFBO3VCQUNBO29CQUNBLEdBQUEsZUFBQSxHQUFBLFNBQUE7b0JBQ0E7O2VBRUEsUUFBQSxXQUFBO2dCQUNBLEdBQUEsVUFBQTs7OztRQUlBLEdBQUEsa0JBQUEsVUFBQSxRQUFBO1lBQ0EsSUFBQSxXQUFBLFNBQUE7Z0JBQ0EsR0FBQTttQkFDQSxJQUFBLFdBQUEsU0FBQTtnQkFDQSxJQUFBLEdBQUEsY0FBQSxHQUFBO29CQUNBLEdBQUE7O21CQUVBLElBQUEsV0FBQSxTQUFBO2dCQUNBLEdBQUEsY0FBQTs7WUFFQTs7O1FBR0EsSUFBQSxhQUFBLFdBQUE7O1lBRUEsSUFBQSxTQUFBO1lBQ0EsVUFBQSxPQUFBOzs7UUFHQSxJQUFBLGFBQUEsWUFBQTtZQUNBLFdBQUEsZUFBQTtZQUNBLGNBQUEsZUFBQTtZQUNBOzs7UUFHQTs7UUFFQSxPQUFBLE9BQUEsa0JBQUEsVUFBQSxPQUFBO1lBQ0EsSUFBQSxhQUFBLEVBQUE7Z0JBQ0EsYUFBQSxFQUFBOztZQUVBLElBQUEsUUFBQSxHQUFBO2dCQUNBLFdBQUEsV0FBQTtnQkFDQSxXQUFBLFdBQUE7bUJBQ0E7Z0JBQ0EsV0FBQSxLQUFBLFlBQUE7Z0JBQ0EsV0FBQSxLQUFBLFlBQUE7Ozs7OztBQzVHQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxXQUFBLHlJQUFBLFVBQUEsUUFBQSxjQUFBLGFBQUEsY0FBQSxZQUFBLGVBQUEsYUFBQTtRQUNBLElBQUEsS0FBQTs7UUFFQSxHQUFBLFVBQUE7UUFDQSxHQUFBLGNBQUEsWUFBQSxZQUFBO1FBQ0EsR0FBQSxlQUFBO1FBQ0EsR0FBQSxTQUFBO1FBQ0EsR0FBQSxlQUFBOztRQUVBLElBQUEseUJBQUEsWUFBQTtZQUNBLEdBQUEsVUFBQTtZQUNBLFlBQUEsaUJBQUEsYUFBQSxJQUFBLEtBQUEsVUFBQSxNQUFBO2dCQUNBLEdBQUEsZUFBQTtlQUNBLE1BQUEsVUFBQSxPQUFBO2dCQUNBLFFBQUEsSUFBQTtlQUNBLFFBQUEsWUFBQTtnQkFDQSxHQUFBLFVBQUE7Ozs7UUFJQSxJQUFBLGFBQUEsWUFBQTtZQUNBLFdBQUEsZUFBQTtZQUNBLGNBQUEsZUFBQTtZQUNBOzs7UUFHQSxHQUFBLG9CQUFBLFVBQUEsTUFBQTtZQUNBLE9BQUEsYUFBQSwyQkFBQTs7O1FBR0E7OztBQ2pDQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxXQUFBLCtKQUFBLFVBQUEsUUFBQSxXQUFBLGFBQUEsY0FBQSxjQUFBLGFBQUEsWUFBQSxlQUFBLGFBQUE7UUFDQSxjQUFBLGVBQUE7O1FBRUEsSUFBQSxLQUFBOztRQUVBLEdBQUEsZ0JBQUEsYUFBQTs7UUFFQSxHQUFBLGVBQUE7UUFDQSxHQUFBLFVBQUE7UUFDQSxHQUFBLGNBQUEsWUFBQSxZQUFBO1FBQ0EsR0FBQSxxQkFBQSxZQUFBO1FBQ0EsR0FBQSx1QkFBQSxHQUFBLGNBQUEsVUFBQSxHQUFBLG1CQUFBO1FBQ0EsR0FBQSxvQkFBQSxPQUFBLElBQUEsR0FBQSxjQUFBLFNBQUE7UUFDQSxHQUFBLHlCQUFBO1lBQ0EsUUFBQTs7UUFFQSxHQUFBLDZCQUFBLFVBQUEsUUFBQTtZQUNBLE9BQUE7WUFDQSxHQUFBLHVCQUFBLFNBQUE7O1FBRUEsR0FBQSxtQkFBQSxPQUFBLElBQUEsR0FBQSxjQUFBLE9BQUE7UUFDQSxHQUFBLHdCQUFBO1lBQ0EsUUFBQTs7UUFFQSxHQUFBLDRCQUFBLFVBQUEsUUFBQTtZQUNBLE9BQUE7WUFDQSxHQUFBLHNCQUFBLFNBQUE7O1FBRUEsR0FBQSxtQkFBQTtZQUNBLFVBQUE7O1FBRUEsR0FBQSxhQUFBO1FBQ0EsR0FBQSxhQUFBO1FBQ0EsR0FBQSxjQUFBLFlBQUE7UUFDQSxHQUFBLFlBQUEsd0JBQUEsR0FBQSxjQUFBLFFBQUE7UUFDQSxHQUFBLFlBQUEscUJBQUEsR0FBQSxjQUFBLGFBQUEsR0FBQSxZQUFBO1FBQ0EsR0FBQSxZQUFBLE9BQUE7O1FBRUEsR0FBQSxjQUFBLFlBQUE7WUFDQSxJQUFBLGVBQUEsRUFBQSxPQUFBLEdBQUEsWUFBQSxVQUFBLEdBQUE7Z0JBQ0EsT0FBQSxFQUFBLFVBQUEsY0FBQSxTQUFBLEdBQUEsV0FBQTs7WUFFQSxHQUFBLFlBQUEsT0FBQSxhQUFBLFNBQUEsSUFBQSxlQUFBLEdBQUEsWUFBQTs7O1FBR0EsSUFBQSxtQkFBQSxHQUFBLGNBQUEsU0FBQSxPQUFBO1lBQ0Esa0JBQUEsR0FBQSxjQUFBLFFBQUEsT0FBQTs7UUFFQSxHQUFBLFVBQUE7WUFDQTtnQkFDQSxPQUFBO2dCQUNBLGFBQUE7O2dCQUVBLGlCQUFBOztZQUVBO2dCQUNBLE9BQUE7Z0JBQ0EsYUFBQTtnQkFDQSxpQkFBQTtnQkFDQSxjQUFBOztZQUVBO2dCQUNBLE9BQUE7Z0JBQ0EsYUFBQTtnQkFDQSxpQkFBQTtnQkFDQSxjQUFBOztZQUVBO2dCQUNBLE9BQUE7Z0JBQ0Esc0JBQUE7O1lBRUE7Z0JBQ0EsT0FBQTtnQkFDQSxpQkFBQTtnQkFDQSxjQUFBOztZQUVBO2dCQUNBLE9BQUE7Z0JBQ0EsaUJBQUE7Z0JBQ0EsY0FBQTs7WUFFQTtnQkFDQSxPQUFBO2dCQUNBLGlCQUFBO2dCQUNBLGNBQUE7O1lBRUE7Z0JBQ0EsT0FBQTtnQkFDQSxpQkFBQTtnQkFDQSxjQUFBOzs7O1FBSUEsR0FBQSxhQUFBLFlBQUE7WUFDQSxHQUFBLFVBQUE7WUFDQSxZQUFBLGVBQUEsR0FBQSxlQUFBLEtBQUEsVUFBQSxNQUFBO2dCQUNBLEdBQUEsYUFBQSxLQUFBO2dCQUNBLEdBQUEsWUFBQSxnQkFBQSxLQUFBLFFBQUE7Z0JBQ0EsR0FBQSxZQUFBLDBCQUFBLEtBQUEsUUFBQTtnQkFDQSxHQUFBLFlBQUEsYUFBQSxLQUFBO2dCQUNBLEdBQUEs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QSxVQUFBOzs7Ozs7Ozs7Ozs7b0JBWUE7d0JBQ0EsUUFBQTt3QkFDQSxVQUFBOzs7Ozs7OztRQVFBLElBQUEsU0FBQSxDQUFBLEtBQUEsSUFBQSxPQUFBLEtBQUEsUUFBQSxJQUFBLE1BQUE7UUFDQSxJQUFBLFFBQUEsTUFBQSxPQUFBLFFBQUEsT0FBQTtRQUNBLElBQUEsU0FBQSxNQUFBLE9BQUEsTUFBQSxPQUFBOztRQUVBLElBQUEsSUFBQTtZQUNBLFdBQUE7WUFDQTs7UUFFQSxJQUFBLE9BQUEsR0FBQSxPQUFBO2FBQ0EsS0FBQSxDQUFBLFFBQUE7O1FBRUEsSUFBQSxXQUFBLEdBQUEsSUFBQTthQUNBLFdBQUEsU0FBQSxHQUFBLEVBQUEsT0FBQSxDQUFBLEVBQUEsR0FBQSxFQUFBOztRQUVBLElBQUEsTUFBQSxHQUFBLE9BQUE7OztRQUdBLElBQUEsUUFBQSxJQUFBLE9BQUE7O1FBRUEsTUFBQSxLQUFBLGFBQUEsZUFBQSxPQUFBLEtBQUEsTUFBQSxNQUFBLE9BQUEsSUFBQSxJQUFBO2dCQUNBLFdBQUEsSUFBQTtRQUNBLE1BQUEsS0FBQSxTQUFBOzs7UUFHQSxPQUFBLFNBQUE7UUFDQSxLQUFBLEtBQUEsU0FBQTtRQUNBLEtBQUEsS0FBQTs7UUFFQSxPQUFBOztRQUVBLEdBQUEsT0FBQSxLQUFBLGNBQUEsTUFBQSxVQUFBOztRQUVBLFNBQUEsT0FBQSxRQUFBOzs7WUFHQSxJQUFBLFFBQUEsS0FBQSxNQUFBLE1BQUE7Z0JBQ0EsUUFBQSxLQUFBLE1BQUE7OztZQUdBLE1BQUEsUUFBQSxTQUFBLEdBQUEsRUFBQSxFQUFBLElBQUEsRUFBQSxRQUFBOzs7WUFHQSxJQUFBLE9BQUEsTUFBQSxVQUFBO2lCQUNBLEtBQUEsT0FBQSxTQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUEsT0FBQSxFQUFBLEtBQUEsRUFBQTs7O1lBR0EsSUFBQSxZQUFBLEtBQUEsUUFBQSxPQUFBO2lCQUNBLEtBQUEsU0FBQTtpQkFDQSxLQUFBLGFBQUEsU0FBQSxHQUFBLEVBQUEsT0FBQSxlQUFBLE9BQUEsS0FBQSxNQUFBLE9B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RUFBQSxTQUFBO1lBQ0EsSUFBQSxJQUFBO1lBQ0EsRUFBQSxZQUFBO1lBQ0EsRUFBQSxVQUFBLE9BQUEsVUFBQSxPQUFBLFVBQUEsT0FBQSxNQUFBLElBQUEsQ0FBQSxFQUFBLFFBQUEsUUFBQSxLQUFBO1lBQ0EsRUFBQSxRQUFBLE9BQUEsUUFBQSxPQUFBLFFBQUEsT0FBQSxNQUFBO1lBQ0EsRUFBQSxrQkFBQSxPQUFBLGtCQUFBLE9BQUEsa0JBQUE7WUFDQSxPQUFBOzs7UUFHQSxJQUFBLG1CQUFBLFVBQUEsUUFBQTtZQUNBLE9BQUE7OztRQUdBLElBQUEsa0JBQUEsVUFBQSxNQUFBLFdBQUEsU0FBQSxPQUFBLE9BQUEsV0FBQSxXQUFBO1lBQ0EsT0FBQTtnQkFDQSxNQUFBO2dCQUNBLFdBQUEsWUFBQSxZQUFBO2dCQUNBLFNBQUE7Z0JBQ0EsT0FBQTtnQkFDQSxPQUFBLFFBQUEsUUFBQTtnQkFDQSxXQUFBO2dCQUNBLFdBQUE7Ozs7UUFJQSxPQUFBO1lBQ0EsU0FBQSxVQUFBLFFBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7Z0JBQ0EsSUFBQSxTQUFBLGNBQUE7Z0JBQ0EsTUFBQTtvQkFDQSxLQUFBLFlBQUEsS0FBQSxZQUFBO29CQUNBLFFBQUE7b0JBQ0EsUUFBQTttQkFDQSxRQUFBLFVBQUEsTUFBQTtvQkFDQSxFQUFBLFFBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOztnQkFFQSxPQUFBLEVBQUE7O1lBRUEsZ0JBQUEsVUFBQSxRQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBO2dCQUNBLElBQUEsU0FBQSxpQkFBQTtnQkFDQSxNQUFBO29CQUNBLEtBQUEsWUFBQSxLQUFBLFlBQUE7b0JBQ0EsUUFBQTtvQkFDQSxRQUFBO21CQUNBLFFBQUEsVUFBQSxNQUFBO29CQUNBLEtBQUEsVUFBQSxPQUFBLFlBQUEsS0FBQTtvQkFDQSxFQUFBLFFBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOztnQkFFQSxPQUFBLEVBQUE7O1lBRUEsWUFBQSxVQUFBLFFB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QUFBLFlBQUEsR0FBQSxZQUFBO1lBQ0EsSUFBQSxDQUFBLEdBQUEsU0FBQTtnQkFDQSxHQUFBOzs7O1FBSUEsR0FBQSxrQkFBQSxVQUFBLE9BQUE7WUFDQSxJQUFBLFNBQUEsR0FBQSxvQkFBQSxRQUFBO2dCQUNBLEdBQUEsb0JBQUEsT0FBQTs7WUFFQSxHQUFBLG9CQUFBLFNBQUEsVUFBQSxhQUFBLE9BQUE7WUFDQSxHQUFBLG9CQUFBLFlBQUEsR0FBQSxZQUFBO1lBQ0EsSUFBQSxDQUFBLEdBQUEsU0FBQTtnQkFDQSxHQUFBOzs7O1FBSUEsR0FBQSxZQUFBLGdCQUFBLFVBQUEsU0FBQTs7WUFFQSxHQUFBLFVBQUE7WUFDQSxHQUFBLFFBQUEsVUFBQSxHQUFBLG9CQUFBLFFBQUEsVUFBQSxLQUFBO2dCQUNBLElBQUEsR0FBQSxlQUFBO29CQUNBLEdBQUEsZ0JBQUE7dUJBQ0E7b0JBQ0EsVUFBQSxLQUFBLGVBQUEsSUFBQSxPQUFBOzs7WUFHQSxHQUFBLFFBQUEsV0FBQSxHQUFBLGtCQUFBLFFBQUEsVUFBQSxhQUFBLFVBQUE7Z0JBQ0EsR0FBQSxvQkFBQSxPQUFBO2dCQUNBLEdBQUEsb0JBQUEsWUFBQTtnQkFDQSxHQUFBOztZQUVBLEdBQUEsUUFBQSxLQUFBLEdBQUEsWUFBQSxRQUFBLFVBQUEsTUFBQSxhQUFBO2dCQUNBLEVBQUEsUUFBQSxHQUFBLFFBQUEsS0FBQSxTQUFBLFVBQUEsS0FBQTtvQkFDQSxJQUFBLE9BQUEsT0FBQSxJQUFBOztnQkFFQSxhQUFBLGVBQUEsR0FBQSxRQUFBLEtBQUEsUUFBQTtnQkFDQSxJQUFBLFVBQUE7Z0JBQ0EsRUFBQSxRQUFBLGFBQUEsVUFBQSxLQUFBO29CQUNBLFFBQUEsS0FBQSxJQUFBLEtBQUEsY0FBQSxTQUFBLE1BQUEsSUFBQSxRQUFBLElBQUE7O2dCQUVBLEdBQUEsZUFBQTs7OztRQUlBLEdBQUEsYUFBQSxZQUFBO1lBQ0EsYUFBQSx1QkFBQSxHQUFBO1lBQ0EsR0FBQTtZQUNBLElBQUEsT0FBQSxZQUFBO1lBQ0EsR0FBQSxXQUFBLEVBQUEsUUFBQSxL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UUFBQSxRQUFBLE9BQUE7Z0JBQ0EsT0FBQTtxQkFDQSxJQUFBLGVBQUE7cUJBQ0EsT0FBQTs7WUFFQSxPQUFBLGVBQUEsTUFBQTs7O1FBR0EsT0FBQTs7OztBQ3RDQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLHNCQUFBLFlBQUE7UUFDQSxJQUFBLHFCQUFBLFVBQUEsSUFBQSxNQUFBLFdBQUEsU0FBQSxVQUFBLGVBQUE7WUFDQSxLQUFBLEtBQUE7WUFDQSxLQUFBLE9BQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLFdBQUE7WUFDQSxLQUFBLGdCQUFBOzs7O1FBSUEsbUJBQUEsWUFBQTs7Ozs7UUFLQSxtQkFBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7OztZQUdBLE9BQUEsSUFBQTs7O1FBR0EsbUJBQUEsY0FBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLFFBQUEsUUFBQSxPQUFBO2dCQUNBLE9BQUE7cUJBQ0EsSUFBQSxtQkFBQTtxQkFDQSxPQUFBOztZQUVBLE9BQUEsbUJBQUEsTUFBQTs7O1FBR0EsT0FBQTs7OztBQzFDQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLHNCQUFBLFlBQUE7UUFDQSxJQUFBLHFCQUFBLFVBQUEsTUFBQSxPQUFBLFNBQUEsVUFBQSxPQUFBO1lBQ0EsS0FBQSxPQUFBO1lBQ0EsS0FBQSxRQUFBO1lBQ0EsS0FBQSxVQUFBO1lBQ0EsS0FBQSxXQUFBO1lBQ0EsS0FBQSxRQUFBOzs7O1FBSUEsbUJBQUEsWUFBQTtZQUNBLFVBQUEsWUFBQTtnQkFDQSxJQUFBLEtBQUE7b0JBQ0EsT0FBQSxLQUFBO2dCQUNBLElBQUEsS0FBQTtvQkFDQSxPQUFBLEtBQUE7Z0JBQ0EsSUFBQSxLQUFBO29CQUNBLE9BQUEsS0FBQTs7Ozs7UUFLQSxtQkFBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBOzs7WUFHQSxPQUFBLElBQUE7OztRQUdBLG1CQUFBLGNBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxRQUFBLFFBQUEsT0FBQTtnQkFDQSxPQUFBO3FCQUNBLElBQUEsbUJBQUE7cUJBQ0EsT0FBQTs7WUFFQSxPQUFBLG1CQUFBLE1BQUE7OztRQUdBLE9BQUE7Ozs7QUMvQ0EsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSx1QkFBQSxZQUFBO1FBQ0EsSUFBQSxzQkFBQSxVQUFBLE1BQUEsY0FBQSxPQUFBO1lBQ0EsS0FBQSxPQUFBO1lBQ0EsS0FBQSxlQUFBO1lBQ0EsS0FBQSxRQUFBOzs7O1FBSUEsb0JBQUEsWUFBQTs7Ozs7UUFLQSxvQkFBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7OztZQUdBLE9BQUEsSUFBQTs7O1FBR0Esb0JBQUEsY0FBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLFFBQUEsUUFBQSxPQUFBO2dCQUNBLE9BQUE7cUJBQ0EsSUFBQSxvQkFBQTtxQkFDQSxPQUFBOztZQUVBLE9BQUEsb0JBQUEsTUFBQTs7O1FBR0EsT0FBQTs7OztBQ3BDQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLDZKQUFBLFVBQUEsYUFBQSxTQUFBLGNBQUEsU0FBQSxvQkFBQSxxQkFBQSxRQUFBLGdCQUFBLGNBQUE7UUFDQSxJQUFBLGFBQUEsVUFBQSxJQUFBLFVBQUEsY0FBQSxPQUFBLE9BQUEsUUFBQSxVQUFBLFVBQUEsU0FBQSxXQUFBLGVBQUEsY0FBQSxrQkFBQSxtQkFBQSxTQUFBLFFBQUEsU0FBQSxPQUFBLG9CQUFBLGVBQUEsTUFBQSxTQUFBLFNBQUEsVUFBQSxRQUFBLFNBQUE7WUFDQSxLQUFBLEtBQUE7WUFDQSxLQUFBLFdBQUEsUUFBQSxZQUFBO1lBQ0EsS0FBQSxlQUFBO1lBQ0EsS0FBQSxRQUFBLGVBQUEsWUFBQTtZQUNBLEtBQUEsUUFBQTtZQUNBLEtBQUEsU0FBQTtZQUNBLEtBQUEsV0FBQTtZQUNBLEtBQUEsV0FBQTtZQUNBLEtBQUEsVUFBQTtZQUNBLEtBQUEsWUFBQTtZQUNBLEtBQUEsZ0JBQUE7WUFDQSxLQUFBLGVBQUE7WUFDQSxLQUFBLG1CQUFBO1lBQ0EsS0FBQSxvQkFBQTtZQUNBLEtBQUEsVUFBQTtZQUNBLEtBQUEsb0JBQUEsT0FBQSxJQUFBLFNBQUEsT0FBQSxZQUFBLFlBQUE7WUFDQSxLQUFBLFNBQUE7WUFDQSxLQUFBLG1CQUFBLE9BQUEsSUFBQSxRQUFBLE9BQUEsWUFBQSxZQUFBO1lBQ0EsS0FBQSxVQUFBO1lBQ0EsS0FBQSxvQkFBQSxPQUFBLElBQUEsU0FBQSxPQUFBLFlBQUEsWUFBQTtZQUNBLEtBQUEsUUFBQTtZQUNBLEtBQUEsa0JBQUEsT0FBQSxJQUFBLE9BQUEsT0FBQSxZQUFBLFlBQUE7WUFDQSxLQUFBLHFCQUFBO1lBQ0EsS0FBQSxnQkFBQTtZQUNBLEtBQUEsT0FBQTtnQkFDQSxZQUFBLG1CQUFBLFlBQUEsS0FBQTtnQkFDQSxTQUFBLEtBQUE7Z0JBQ0EsYUFBQSxvQkFBQSxZQUFBLEtBQUE7O1lBRUEsS0FBQSxVQUFBO2dCQUNBLGFBQUEsb0JBQUEsWUFBQSxRQUFBO2dCQUNBLFNBQUEsUUFBQTs7WUFFQSxLQUFBLFVBQUEsT0FBQSxZQUFBO1lBQ0EsS0FBQSxXQUFBLGFBQUEsWUFBQTtZQUNBLEtBQUEsU0FBQTtZQUNBLEtBQUEsVUFBQTs7OztRQUlBLFdBQUEsWUFBQTtZQUNBLGFBQUEsWUFBQTtnQkFDQSxPQUFBLGFBQUEsa0JBQUEsS0FBQSxTQUFBLEtBQUE7O1lBRUEsb0JBQUEsVUFBQTtnQkFDQSxJQUFBLEtBQUEsV0FBQSxJQUFBO29CQUNBLE9BQUEsS0FBQSxTQUFBOztnQkFFQSxPQUFBOztZQUVBLGdCQUFB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QUFBLFFBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLGNBQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLGtCQUFBO1lBQ0EsS0FBQSxZQUFBO1lBQ0EsS0FBQSxpQkFBQTtZQUNBLEtBQUEsWUFBQTtZQUNBLEtBQUEsY0FBQTtZQUNBLEtBQUEsb0JBQUE7WUFDQSxLQUFBLGVBQUE7WUFDQSxLQUFBLFdBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxlQUFBO1lBQ0EsS0FBQSwwQkFBQTtZQUNBLEtBQUEseUJBQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLFdBQUE7WUFDQSxLQUFBLFNBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxxQkFBQSxpQkFBQSxZQUFBOzs7O1FBSUEsUUFBQSxZQUFBO1lBQ0EsVUFBQSxZQUFBO2dCQUNBLE9BQUE7O1lBRUEsU0FBQSxZQUFBO2dCQUNBLE9BQUEsS0FBQSxZQUFBLDRCQUFBLEtBQUEsWUFBQSxTQUFBLDRCQUFBLFlBQUEsa0JBQUE7O1lBRUEsYUFBQSxZQUFBO2dCQUNBLE9BQUEsS0FBQSxZQUFBLFFBQUEsS0FBQSxZQUFBLE1BQUEsUUFBQSxZQUFBLGtCQUFBOztZQUVBLGNBQUEsWUFBQTtnQkFDQSxPQUFBLEtBQUE7Ozs7O1FBS0EsUUFBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtv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Q0EsV0FBQSxFQUFBLElBQUEsYUFBQTtvQkFDQSxVQUFBLFlBQUEsU0FBQSxJQUFBLFdBQUEsWUFBQSxRQUFBLFlBQUE7b0JBQ0EsZ0JBQUEsWUFBQSxJQUFBLElBQUEsTUFBQSxDQUFBLENBQUEsV0FBQSxXQUFBLEtBQUEsUUFBQTs7Z0JBRUEsT0FBQTtvQkFDQSxPQUFBO3dCQUNBLE1BQUE7d0JBQ0EsUUFBQTt3QkFDQSxXQUFBLFdBQUE7d0JBQ0EsT0FBQTs7b0JBRUEsUUFBQTt3QkFDQSxNQUFBO3dCQUNBLFFBQUE7d0JBQ0EsV0FBQSxZQUFBO3dCQUNBLE9BQUE7O29CQUVBLFFBQUE7d0JBQ0EsTUFBQTt3QkFDQSxRQUFBO3dCQUNBLFdBQUEsWUFBQTt3QkFDQSxPQUFBOzs7O1lBSUEsYUFBQSxZQUFBO2dCQUNBLElBQUEsVUFBQSxFQUFBLE1BQUEsS0FBQSxlQUFBLEVBQUEsVUFBQTtvQkFDQSxnQkFBQSxFQUFBLE9BQUEsRUFBQSxRQUFBLFNBQUE7b0JBQ0EsV0FBQSxFQUFBLE1BQUEsS0FBQSxnQkFBQSxFQUFBLFVBQUE7b0JBQ0EsaUJBQUEsRUFBQSxPQUFBLEVBQUEsUUFBQSxVQUFBO29CQUNBLFdBQUEsRUFBQSxNQUFBLEtBQUEsZ0JBQUEsRUFBQSxVQUFBO29CQUNBLGlCQUFBLEVBQUEsT0FBQSxFQUFBLFFBQUEsVUFBQTs7Z0JBRUEsSUFBQSxtQkFBQSxVQUFBLFlBQUE7b0JBQ0EsSUFBQSxZQUFBO29CQUNBLEVBQUEsUUFBQSxZQUFBLFVBQUEsVUFBQTt3QkFDQSxFQUFBLFFBQUEsVUFBQSxVQUFBLEtBQUE7NEJBQ0EsVUFBQSxLQUFBLEVBQUEsUUFBQSxJQUFBLFVBQUEsT0FBQSxJQUFBOzs7b0JBR0EsT0FBQTs7O2dCQUdBLE9BQUE7b0JBQ0EsT0FBQSxpQkFBQTtvQkFDQSxRQUFBLGlCQUFBO29CQUNBLFFBQUEsaUJBQUE7Ozs7OztRQU1BLGVBQUEsUUFBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLE1BQUE7O2dCQUVBLElBQUEsbUJBQUEsS0FBQSxZQUFBLEtBQUEsWUFBQSxLQUFB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QUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOztnQkFFQSxPQUFBLEVBQUE7O1lBRUEsY0FBQSxVQUFBLElBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7Z0JBQ0EsTUFBQSxJQUFBLFlBQUEsS0FBQSxZQUFBLFVBQUEsS0FBQSxLQUFBLFFBQUEsVUFBQSxNQUFBO29CQUNBLEVBQUEsUUFBQSxXQUFBLFlBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOztnQkFFQSxPQUFBLEVBQUE7O1lBRUEsZ0JBQUEsVUFBQSxZQUFBLFVBQUE7Z0JBQ0EsSUFBQSxTQUFBO29CQUNBLFlBQUE7b0JBQ0EsVUFBQTs7Z0JBRUEsSUFBQSxzQkFBQSxVQUFBLFlBQUEsS0FBQSxZQUFBLHNCQUFBO29CQUNBLG9CQUFBLGNBQUEsVUFBQSxxQkFBQSxZQUFBLGNBQUE7O2dCQUVBLE9BQUEsa0JBQUEsUUFBQSxLQUFBLE1BQUEsTUFBQSxVQUFBLE1BQUE7b0JBQ0EsSUFBQSxLQUFBLFdBQUE7d0JBQ0EsS0FBQSxVQUFBLFdBQUEsWUFBQSxLQUFBOzJCQUNBO3dCQUNBLGtCQUFBOztvQkFFQSxPQUFBOzs7WUFHQSxvQkFBQSxVQUFBLFlBQUEsVUFBQTtnQkFDQSxJQUFBLFNBQUE7b0JBQ0EsWUFBQTtvQkFDQSxVQUFBOztnQkFFQSxJQUFBLElBQUEsR0FBQTs7Z0JBRUEsTUFBQSxJQUFBLFlBQUEsS0FBQSxZQUFBLHNCQUFBLFFBQUEsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsS0FBQSxVQUFBLFdBQUEsWUFBQSxLQUFBO29CQUNBLEVBQUEsUUFBQTttQkFDQSxNQUFBLFVBQUEsT0FBQTtvQkFDQSxFQUFBLE9BQUE7O2dCQUVBLE9BQUEsRUFBQTs7WUFFQSxXQUFBLFVBQUEsSUFBQSxNQUFBO2dCQUNBLE9BQUEsUUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTs7Z0JBRUEsTUFBQTtvQkFDQSxLQUFBLFlBQUEsS0FBQSxZQUFBLFVBQUEsS0FBQTtvQkFDQSxRQUFBO29CQUNBLE1BQUE7bUJB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Q0EsR0FBQSxVQUFBOztZQUVBLElBQUEsQ0FBQSxHQUFBLGlCQUFBLFFBQUEsR0FBQSxpQkFBQSxTQUFBLElBQUE7Z0JBQ0EsR0FBQSxtQkFBQTtnQkFDQSxHQUFBO21CQUNBO2dCQUNBLEdBQUEsbUJBQUEsR0FBQTs7OztRQUlBLEdBQUEsb0JBQUEsWUFBQTtZQUNBLE9BQUEsR0FBQSxlQUFBLFNBQUE7OztRQUdBLEdBQUEscUJBQUEsVUFBQSxTQUFBO1lBQ0EsR0FBQSxlQUFBO1lBQ0EsR0FBQSxlQUFBLFlBQUEsWUFBQSxnQkFBQTtZQUNBLEdBQUEsZUFBQSxZQUFBLFlBQUEsZ0JBQUE7WUFDQSxHQUFBOzs7UUFHQSxHQUFBLGtCQUFBLFVBQUEsTUFBQTtZQUNBLEdBQUEsWUFBQTtZQUNBLEdBQUEsbUJBQUEsRUFBQSxXQUFBO1lBQ0EsR0FBQSxXQUFBLFNBQUEsUUFBQSxnQkFBQTtZQUNBLEdBQUEsWUFBQSxTQUFBLFNBQUEsZ0JBQUE7WUFDQSxHQUFBLFlBQUEsU0FBQSxTQUFBLGdCQUFBO1lBQ0EsR0FBQSxjQUFBLFNBQUEsV0FBQSxnQkFBQTtZQUNBLEdBQUEsZUFBQSxTQUFBLFlBQUEsZ0JBQUE7WUFDQSxHQUFBOzs7UUFHQSxHQUFBLGlCQUFBLFlBQUE7WUFDQSxHQUFBLGtCQUFBLENBQUEsR0FBQTtZQUNBLElBQUEsR0FBQSxpQkFBQTtnQkFDQSxHQUFBLGdCQUFBO21CQUNBO2dCQUNBLEdBQUEsZ0JBQUE7Ozs7UUFJQSxHQUFBLGFBQUEsWUFBQTtZQUNBLFdBQUEsZUFBQTtZQUNBLEdBQUE7OztRQUdBLEdBQUEsZUFBQSxZQUFBO1lBQ0EsZUFBQSxlQUFBLEtBQUEsVUFBQSxRQUFBO2dCQUNBLEdBQUEscUJBQUEsT0FBQTtlQUNBLE1BQUEsVUFBQSxPQUFBO2dCQUNBLFFBQUEsSUFBQTtnQkFDQSxPQUFBLFNBQUE7Ozs7UUFJQSxHQUFBLGNBQUEsVUFBQSxJQUFBO1lBQ0EsZUFBQSxtQkFBQSxJQUFBLEtBQUEsVUFBQSxRQUFBO2dCQUNBLEdBQUEsbUNBQUEsT0FBQTtlQUNBLE1BQUEsVUFBQSxPQUFBO2dCQUNBLFFBQUEsSUFBQTs7OztRQUlBLEdBQUEscUJBQUEsVUFBQSxVQUFBO1lBQ0EsZUFBQSxtQkFBQSxTQUFBLE1BQUEsS0FBQSxVQUFBLFFBQUE7Z0JBQ0EsR0FBQSwwQkFBQTtnQkFDQSxFQUFBLFFBQUEsT0FBQSxTQUFBLFVBQUEsUUFBQTtvQkFDQSxHQUFBLHFCQUFBLEdBQUEsbUJBQUEsV0FBQSxJQUFBLEVBQUEsV0FBQSxPQUFBLFNBQUEsR0FBQSxxQkFBQSxPQUFBLEVBQUEsV0FBQSxPQUFBOztnQkFFQSxHQUFBLGtCQUFBLEVBQUEsWUFBQSxPQUFBLFNBQUEsQ0FBQSxRQUFBLFlBQUEsQ0FBQSxNQUFBOztnQkFFQSxJQUFBLHlCQUFBO2dCQUNBLEVBQUEsUUFBQSxHQUFBLGlCQUFBLFVBQUEsUUFBQTtvQkFDQSx1QkFBQSxLQUFBO3dCQUNBLE9BQUEsT0FBQSxVQUFBLE9BQUEsUUFBQSxNQUFBLE9BQUEsVUFBQSxPQUFBO3dCQUNBLE9BQUEsT0FBQSxVQUFBLE9BQUEsUUFBQSxNQUFBLE9BQUEsVUFBQSxPQUFBO3dCQUNBLE9BQUEsT0FBQTs7O2dCQUdBLEdBQUEseUJBQUE7Z0JBQ0EsR0FBQSxVQUFBLEVBQUEsWUFBQSxPQUFBLFNBQUEsQ0FBQSxVQUFBLENBQUE7Z0JBQ0EsR0FBQSxTQUFBLE9BQUE7OztnQkFHQSxJQUFBLHNCQUFBO29CQUNBLGVBQUEsRUFBQSxNQUFBLEVBQUEsUUFBQSxPQUFBLFNBQUE7Z0JBQ0EsRUFBQSxRQUFBLGNBQUEsVUFBQSxPQUFBO29CQUNBLElBQUEsU0FBQTt3QkFDQSxPQUFBLEVBQUEsS0FBQSxHQUFBLFFBQUEsRUFBQSxNQUFBLE1BQUEsTUFBQTt3QkFDQSxVQUFBOztvQkFFQSxFQUFBLFFBQUEsTUFBQSxJQUFBLFVBQUEsUUFBQTt3QkFDQSxJQUFBLFFBQUE7NEJBQ0EsT0FBQSxPQUFBOzRCQUNBLE9BQUEsT0FBQTs0QkFDQSxPQUFBLE9BQUE7O3dCQUVBLE9BQUEsU0FBQSxLQUFBOztvQkFFQSxvQkFBQSxLQUFBOztnQkFFQSxvQkFBQSxRQUFBO29CQUNBLE9BQUE7b0JBQ0EsT0FBQTtvQkFDQSxPQUFBOztnQkFFQSxHQUFBLHNCQUFBO2VBQ0EsTUFBQSxVQUFBLE1BQUE7Z0JBQ0EsUUFBQSxJQUFBO2dCQUNBLE9BQUEsU0FBQTs7OztRQUlBLEdBQUE7O1FBRUEsT0FBQSxPQUFBLG1CQUFBLFVBQUEsT0FBQTtZQUNBLFFBQUEsSUFBQTs7OztRQUlBLEdBQUEsWUFBQSxZQUFBOzs7WUFHQSxZQUFBO1lBQ0EsSUFBQSxXQUFBO2dCQUNBLGNBQUE7WUFDQSxFQUFBLFFBQUEsUUFBQSxVQUFBLEtBQUEsS0FBQTtnQkFDQSxJQUFBLE1BQUEsR0FBQTtvQkFDQSxTQUFBLEtBQUEsSUFBQTs7O1lBR0EsRUFBQSxRQUFBLEdBQUEsV0FBQSxVQUFBLEdBQUE7Z0JBQ0EsY0FBQSxZQUFBLE9BQUEsRUFBQSxNQUFBLEVBQUEsTUFBQSxnQkFBQTs7OztZQUlBLEVBQUEsUUFBQSxVQUFBLFVBQUEsU0FBQTtnQkFDQSxJQUFBLGFBQUEsRUFBQSxLQUFBLGFBQUEsVUFBQSxNQUFBO29CQUNBLE9BQUEsU0FBQTs7Z0JBRUEsSUFBQSxDQUFBLFlBQUE7b0JBQ0EsVUFBQSxLQUFBOzs7OztZQUtBLFNBQUE7WUFDQSxPQUFBO1lBQ0EsV0FBQTs7O1lBR0EsSUFBQSxVQUFBLE9BQUEsSUFBQSxHQUFBLGNBQUEsTUFBQSxLQUFBLEtBQUEsT0FBQSxJQUFBLEdBQUEsZUFBQSxlQUFBLFFBQUEsTUFBQSxPQUFBO1lBQ0EsS0FBQSxJQUFBLElBQUEsR0FBQSxJQUFBLFNBQUEsS0FBQTtnQkFDQSxLQUFBLEtBQUEsT0FBQSxJQUFBLEdBQUEsZUFBQSxlQUFBLFFBQUEsS0FBQSxJQUFBLEdBQUEsS0FBQTs7OztZQUlBLEVBQUEsUUFBQSxHQUFBLFdBQUEsVUFBQSxNQUFBO2dCQUNBLElBQUEsV0FBQTtvQkFDQSxRQUFBLEtBQUE7b0JBQ0EsY0FBQTtvQkFDQSxhQUFBOztnQkFFQSxTQUFBLEVBQUEsTUFBQSxNQUFBLGlCQUFBOztnQkFFQSxJQUFBLE1BQUEsZUFBQSxTQUFBLEdBQUE7O29CQUVBLEVBQUEsUUFBQSxLQUFBLFNBQUEsVUFBQSxRQUFBO3dCQUNBLElBQUEsT0FBQSxPQUFBLFNBQUEsR0FBQTs7OzRCQUdBLElBQUEsZ0JBQUEsRUFBQSxRQUFBLE9BQUEsUUFBQTtnQ0FDQSxZQUFBO2dDQUNBLFlBQUEsRUFBQSxNQUFBLE1BQUEsZ0JBQUE7Ozs7Ozs0QkFNQSxJQUFBLFVBQUEsU0FBQSxHQUFBOzs7Z0NBR0EsRUFBQSxRQUFBLFdBQUEsVUFBQSxJQUFBO29DQUNBLFVBQUEsTUFBQSxFQUFBLElBQUEsZUFBQSxJQUFBOzttQ0FFQTs7OztnQ0FJQSxVQUFBLE1BQUEsVUFBQSxNQUFBLEVBQUEsTUFBQSxlQUFBLEdBQUE7OzRCQUVBLEVBQUEsUUFBQSxFQUFBLE1BQUEsWUFBQSxVQUFBLEdBQUE7Z0NBQ0EsV0FBQTs7O2dDQUdBLGNBQUEsRUFBQSxPQUFBLGNBQUEsTUFBQSxlQUFBLEtBQUEsRUFBQSxLQUFBLE1BQUEsZ0JBQUEsQ0FBQSxJQUFBLFNBQUEsRUFBQTtnQ0FDQSxhQUFBLEVBQUE7OztnQ0FHQSxFQUFBLFFBQUEsTUFBQSxVQUFBLE9BQUE7b0NBQ0EsSUFBQSxXQUFBLEVBQUEsS0FBQSxZQUFBLFVBQUEsT0FBQTt3Q0FDQSxPQUFBLE9BQUEsSUFBQSxNQUFBLE1BQUEsT0FBQSxPQUFBOzs7b0NBR0EsU0FBQSxLQUFBLFdBQUEsU0FBQSxRQUFBOzs7O2dDQUlBLFNBQUEsUUFBQSxZQUFBLE9BQUEsWUFBQTtnQ0FDQSxTQUFBLFlBQUEsT0FBQSxZQUFBLE1BQUEsWUFBQSxVQUFBLFlBQUEsUUFBQSxNQUFBLFlBQUEsVUFBQSxZQUFBO2dDQUNBLE9BQUEsS0FBQTs7Ozt1QkFJQTs7b0JBRUEsRUFBQSxRQUFBLEtBQUEsU0FBQSxVQUFBLFFBQUE7O3dCQUVBLEVBQUEsUUFBQSxNQUFBLFVBQUEsT0FBQTs0QkFDQSxJQUFBLFdBQUEsRUFBQSxLQUFBLE9BQUEsUUFBQSxVQUFBLE9BQUE7Z0NBQ0EsT0FBQSxPQUFBLElBQUEsTUFBQSxNQUFBLE9BQUEs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WUFBQSxhQUFBLEtBQUEsS0FBQSxRQUFBLFVBQUEsTUFBQTtvQkFDQSxFQUFBLFFBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOztnQkFFQSxPQUFBLEVBQUE7O1lBRUEsb0JBQUEsVUFBQSxNQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBO2dCQUNBLElBQUEsTUFBQSxZQUFBLEtBQUEsWUFBQSxhQUFBLE9BQUE7Z0JBQ0EsTUFBQSxJQUFBLEtBQUEsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7Z0JBRUEsT0FBQSxFQUFBOztZQUVBLGFBQUEsVUFBQSxRQUFBO2dCQUNBLElBQUEsU0FBQSxVQUFBO29CQUNBLElBQUEsR0FBQTs7Z0JBRUEsTUFBQTtvQkFDQSxRQUFBO29CQUNBLEtBQUEsWUFBQSxLQUFBLFlBQUEsYUFBQSxPQUFBLFdBQUE7b0JBQ0EsUUFBQTttQkFDQSxRQUFBLFVBQUEsTUFBQTtvQkFDQSxFQUFBLFFBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOzs7Z0JBR0EsT0FBQSxFQUFBOztZQUVBLHNCQUFBLFVBQUEsS0FBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTs7Z0JBRUEsSUFBQSxZQUFBO29CQUNBLE9BQUE7b0JBQ0EsTUFBQTtvQkFDQSxVQUFBO29CQUNBLFNBQUE7OztnQkFHQSxJQUFBLFVBQUEsT0FBQSxJQUFBLElBQUEsT0FBQSxPQUFBLEtBQUEsT0FBQSxJQUFBLElBQUEsT0FBQSxVQUFBLE9BQUE7O2dCQUVBLEVBQUEsUUFBQSxJQUFBLE1BQUEsaUJBQUEsVUFBQSxRQUFBO29CQUNBLElBQUEsZUFBQTt3QkFDQSxRQUFBO3dCQUNBLE9BQUEsT0FBQSxJQUFBLElBQUEsT0FBQSxTQUFBLE9BQUE7d0JBQ0EsT0FBQSxPQUFBLElBQUEsSUFBQSxPQUFBLE9BQUEsT0FBQTt3QkFDQSxPQUFBO3dCQUNBLE9BQUE7d0JBQ0EsUUFBQTs7O29CQUdBLEtBQUEs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OzRCQUNBLElBQUEsR0FBQSxrQkFBQTtnQ0FDQSxJQUFBLE1BQUEsRUFBQSxRQUFBLEdBQUEsZUFBQSxHQUFBLGlCQUFBO2dDQUNBLElBQUEsT0FBQSxHQUFBLGNBQUEsU0FBQSxJQUFBO29DQUNBLEdBQUEsZUFBQSxHQUFBLGNBQUEsTUFBQTs7Ozs7ZUFLQSxNQUFBLFVBQUEsT0FBQTtnQkFDQSxRQUFBLElBQUE7ZUFDQSxRQUFBLFlBQUE7Z0JBQ0EsSUFBQSxHQUFBLFNBQUE7b0JBQ0EsR0FBQSxVQUFBOzs7OztRQUtBLEdBQUEsd0JBQUEsWUFBQTtZQUNBLEVBQUEsUUFBQSxHQUFBLGtCQUFBLFVBQUEsTUFBQTtnQkFDQSxhQUFBLFdBQUEsZUFBQSxLQUFBOztZQUVBLFVBQUEsS0FBQTs7O1FBR0EsR0FBQSxnQkFBQSxVQUFBO1lBQ0EsVUFBQSxLQUFBOzs7UUFHQSxHQUFBLHVCQUFBLFVBQUEsY0FBQTtZQUNBLElBQUEsZUFBQSxHQUFBO2dCQUNBLGNBQUEsb0JBQUEsY0FBQSxLQUFBLFVBQUEsTUFBQTtvQkFDQSxHQUFBLG1CQUFBOzttQkFFQSxJQUFBLGlCQUFBLEdBQUE7Z0JBQ0EsR0FBQSxtQkFBQSxJQUFBOzs7O1FBSUEsR0FBQSxpQkFBQSxVQUFBLElBQUE7WUFDQSxJQUFBLEdBQUEsb0JBQUEsR0FBQSxpQkFBQSxVQUFBO2dCQUNBLHNCQUFBLEtBQUEsWUFBQTs7b0JBRUEsVUFBQSxLQUFBLG9CQUFBO21CQUNBLFlBQUE7Ozs7bUJBSUE7Z0JBQ0EsVUFBQSxLQUFBLG9CQUFBOzs7O1FBSUEsSUFBQSxzQkFBQSxZQUFBO1lBQ0EsSUFBQSxnQkFBQSxVQUFBLEtBQUE7Z0JBQ0EsV0FBQSxHQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsT0FBQTtnQkFDQSxNQUFBOzs7WUFHQSxPQUFBLGNBQUE7OztRQUdBLEdBQUEsZUFBQSxVQUFBLGdCQUFBO1lBQ0EsSUFBQSxPQUFBLG1CQUFBLGFBQUE7Z0JBQ0EsR0FBQSxpQkFBQTttQkFDQTtnQkFDQSxHQUFBLGlCQUFBLENBQUEsR0FBQTs7WUFFQSxHQUFBLGNBQUEsR0FBQSxpQkFBQSx1QkFBQTtZQUNBLEdBQUEsY0FBQSxHQUFBLGlCQUFBLGNBQUE7WUFDQSxHQUFBLG1CQUFBLEdBQUEsaUJBQUEsd0JBQUE7OztRQUdBLFdBQUEsSUFBQSxjQUFBLFVBQUEsT0FBQSxNQUFBO1lBQ0EsR0FBQSxhQUFBLFNBQUE7OztRQUdBOztRQUVBLFdBQUEsSUFBQSxrQkFBQSxZQUFBO1lBQ0EsR0FBQSxtQkFBQTtZQUNBLEdBQUEsZUFBQTs7O1FBR0EsUUFBQSxRQUFBLFVBQUEsTUFBQSxZQUFBOztZQUVBLElBQUEsV0FBQSxhQUFBO2dCQUNBLFNBQUEsWUFBQTtnQkFDQSxxQkFBQSxTQUFBLFNBQUE7O1lBRUEsR0FBQSxpQkFBQSxhQUFBLHFCQUFBLHFCQUFBLHFCQUFBOzs7O0FDeEtBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFdBQUEsMkpBQUEsVUFBQSxRQUFBLFdBQUEsYUFBQSxjQUFBLGNBQUEsZUFBQSxZQUFBLGVBQUEsYUFBQTtRQUNBLGNBQUEsZUFBQTs7UUFFQSxJQUFBLEtBQUE7WUFDQSxvQkFBQSxFQUFBLE1BQUEsWUFBQSxPQUFBLFlBQUEsU0FBQSxJQUFBLElBQUE7O1FBRUEsR0FBQSxnQkFBQSxhQUFBOztRQUVBLEdBQUEsZUFBQTtRQUNBLEdBQUEsVUFBQTtRQUNBLEdBQUEsbUJBQUEsQ0FBQTtRQUNBLEdBQUEscUJBQUEsR0FBQSxjQUFBLFVBQUEsR0FBQSxjQUFBLFVBQUE7UUFDQSxHQUFBLGNBQUEsWUFBQSxZQUFBO1FBQ0EsR0FBQSxvQkFBQSxPQUFBLElBQUEsR0FBQSxjQUFBLFNBQUE7UUFDQSxHQUFBLHlCQUFBO1lBQ0EsUUFBQTs7UUFFQSxHQUFBLDZCQUFBLFVBQUEsUUFBQTtZQUNBLE9BQUE7WUFDQSxHQUFBLHVCQUFBLFNBQUE7O1FBRUEsR0FBQSxtQkFBQSxPQUFBLElBQUEsR0FBQSxjQUFBLE9BQUE7UUFDQSxHQUFBLHdCQUFBO1lBQ0EsUUFBQTs7UUFFQSxHQUFBLDRCQUFBLFVBQUEsUUFBQTtZQUNBLE9BQUE7WUFDQSxHQUFBLHNCQUFBLFNBQUE7O1FBRUEsR0FBQSxtQkFBQTtZQUNBLFVBQUE7O1FBRUEsR0FBQSxjQUFBLFlBQUE7UUFDQSxHQUFBLFlBQUEsd0JBQUEsR0FBQSxjQUFBLFFBQUE7UUFDQSxHQUFBLFlBQUEscUJBQUEsR0FBQSxjQUFBLGFBQUEsR0FBQSxZQUFBO1FBQ0EsR0FBQSxZQUFBLE9BQUE7O1FBRUEsSUFBQSx1QkFBQSxHQUFBLGNBQUEsVUFBQSxPQUFBO1lBQ0Esa0JBQUEsR0FBQSxjQUFBLFFBQUEsT0FBQTs7UUFFQSxHQUFBLFVBQUE7WUFDQTtnQkFDQSxPQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxzQkFBQTs7WUFFQTtnQkFDQSxPQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsaUJBQUE7Z0JBQ0EsY0FBQTs7WUFFQTtnQkFDQSxPQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsaUJBQUE7Z0JBQ0EsY0FBQTs7WUFFQTtnQkFDQSxPQUFBO2dCQUNBLGlCQUFBO2dCQUNBLGVBQUE7Z0JBQ0EsT0FBQTtnQkFDQSxjQUFBOztZQUVBO2dCQUNBLE9BQUE7Z0JBQ0EsaUJBQUE7Z0JBQ0EsZUFBQTtnQkFDQSxjQUFBOzs7O1FBSUEsR0FBQSxhQUFBLFlBQUE7WUFDQSxjQUFBLFdBQUEsR0FBQSxlQUFBLEtBQUEsVUFBQSxNQUFBO2dCQUNBLEdBQUEsWUFBQSxnQkFBQSxLQUFBLFFBQUE7Z0JBQ0EsR0FBQSxZQUFBLDBCQUFBLEtBQUEsUUFBQTtnQkFDQSxHQUFBLFlBQUEsYUFBQSxLQUFBO2dCQUNBLEdBQUEsWUFBQSxPQUFBLEtBQUE7ZUFDQSxNQUFBLFVBQUEsT0FBQTtnQkFDQSxRQUFBLElBQUE7ZUFDQSxRQUFBLFlBQUE7Z0JBQ0EsR0FBQSxVQUFBOzs7O1FBSUEsR0FBQSxpQkFBQSxZQUFBO1lBQ0EsY0FBQSxpQkFBQSxLQUFBLFVBQUEsTUFBQTtnQkFDQSxHQUFBLGlCQUFBLEtBQUEsS0FBQTtnQkFDQSxHQUFBLG1CQUFBLEVBQUEsUUFBQSxHQUFBO2dCQUNBLEdBQUEscUJBQUEs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QUFBO1FBQ0EsSUFBQSxTQUFBOztRQUVBLElBQUEsaUJBQUEsVUFBQSxNQUFBO1lBQ0EsT0FBQSxHQUFBLFVBQUEsYUFBQSxPQUFBLFVBQUEsR0FBQTtnQkFDQSxPQUFBLE1BQUE7Ozs7UUFJQSxJQUFBLGdCQUFBLFVBQUEsTUFBQTtZQUNBLE9BQUEsR0FBQSxVQUFBLGFBQUEsT0FBQSxVQUFBLEdBQUE7Z0JBQ0EsT0FBQSxNQUFBOzs7O1FBSUEsSUFBQSxlQUFBLFlBQUE7WUFDQSxHQUFBLGNBQUEsR0FBQSxTQUFBLFNBQUEsZ0JBQUE7WUFDQSxHQUFBLGVBQUEsR0FBQSxTQUFBLFNBQUEsZ0JBQUE7WUFDQSxHQUFBLGNBQUEsR0FBQSxTQUFBLFNBQUEsYUFBQTs7O1FBR0EsSUFBQSxjQUFBLFlBQUE7WUFDQSxHQUFBLGFBQUEsR0FBQSxTQUFBLFFBQUEsV0FBQTtZQUNBLEdBQUEsY0FBQSxHQUFBLFNBQUEsUUFBQSxnQkFBQTtZQUNBLEdBQUEsYUFBQSxHQUFBLFNBQUEsUUFBQSxhQUFBOzs7UUFHQSxJQUFBLGtCQUFBLFlBQUE7WUFDQSxHQUFBLE9BQUEsR0FBQSxTQUFBLFFBQUEsU0FBQTtZQUNBOzs7UUFHQSxJQUFBLG1CQUFBLFlBQUE7WUFDQSxJQUFBLEdBQUEsU0FBQSxRQUFBO2dCQUNBLEdBQUEsT0FBQTtnQkFDQSxHQUFBLHVCQUFBLE9BQUEsV0FBQTttQkFDQTtnQkFDQSxHQUFBLE9BQUE7O1lBRUEsR0FBQSxXQUFBO1lBQ0E7OztRQUdBLElBQUEsbUJBQUEsWUFBQTtZQUNBLE9BQUEsV0FBQSxXQUFBO1lBQ0EsR0FBQSxlQUFBOzs7UUFHQSxJQUFBLG9CQUFBLFlBQUE7WUFDQSxPQUFBLFdBQUEsV0FBQTtZQUNBLEdBQUEsZUFBQTs7O1FBR0EsSUFBQSxzQkFBQSxZQUFBO1lBQ0EsSUFBQSxnQkFBQSxVQUFBLEtBQUE7Z0JBQ0EsV0FBQSxHQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsT0FBQTtnQkFDQSxNQUFBOzs7WUFHQSxPQUFBLGNBQUE7OztRQUdBLElBQUEsNEJBQUEsVUFBQSxLQUFB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QSxHQUFBLFNBQUEsUUFBQTt3QkFDQSxHQUFBLE9BQUE7OztnQkFHQSxFQUFBLFFBQUEsT0FBQSxXQUFBLFdBQUEsTUFBQSxVQUFBLEtBQUEsS0FBQTtvQkFDQSxJQUFBLENBQUEsSUFBQSxTQUFBLHNCQUFBLE9BQUEsV0FBQSxXQUFBO3dCQUNBLElBQUEsY0FBQSxFQUFBLEtBQUEsT0FBQSxXQUFBLFdBQUEsQ0FBQSxNQUFBLElBQUEsU0FBQSxNQUFBLFNBQUEsSUFBQSxTQUFBO3dCQUNBLE9BQUEsV0FBQSxXQUFBLEtBQUEsS0FBQSxXQUFBOzs7Ozs7Z0JBTUEsSUFBQSxPQUFBLFdBQUEsY0FBQTtvQkFDQSxJQUFBLE9BQUEsV0FBQSxhQUFBLGVBQUE7d0JBQ0EsSUFBQSxPQUFBLFdBQUEsYUFBQSxjQUFBLFdBQUE7NEJBQ0EsSUFBQSxPQUFBLFdBQUEsYUFBQSxjQUFBLFVBQUEsWUFBQTtnQ0FDQSxHQUFBLGtCQUFBLFlBQUEsT0FBQSxXQUFBLGFBQUEsY0FBQSxVQUFBLFdBQUEsS0FBQTs7Ozs7O2dCQU1BO2dCQUNBO2dCQUNBOztZQUVBLElBQUEsT0FBQSxRQUFBLEdBQUEsTUFBQTtnQkFDQSxHQUFBLFdBQUE7Ozs7UUFJQSxJQUFBLFlBQUEsWUFBQTs7Ozs7WUFLQSxTQUFBLFVBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUEsTUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQSxNQUFBO2dCQUNBLElBQUEsUUFBQSxTQUFBLElBQUEsTUFBQSxTQUFBLFFBQUEsTUFBQTtnQkFDQSxJQUFBLFNBQUEsU0FBQSxJQUFBLE1BQUEsVUFBQSxRQUFBLE1BQUE7O2dCQUVBLE1BQUEsS0FBQSxhQUFBLGVBQUEsUUFBQSxJQUFBLE1BQUEsU0FBQSxJQUFBLHdCQUFBLENBQUEsSUFBQSxNQUFBLENBQUEsSUFBQTs7OztnQkFJQSxRQUFBLElBQUE7OztZQUdBLE1BQUEsR0FBQSxPQUFBO1lBQ0EsUUFBQSxJQUFBLE9BQUE7O1lBRUEsT0FBQSxHQUFBLFNBQUEsT0FBQSxHQUFBLFFBQUEsWUFBQTtnQkFDQSxZQUFBLEdBQUEsTUFBQTtnQkFDQSxNQUFBLEtBQUEsYUFBQSxlQUFBLEdBQUEsTUFBQSxZQUFBO29CQUNBLFdBQUEsWUFBQTs7WUFFQSxJQUFBLEtBQUE7O1lBRUEsU0FBQSxJQUFBLFFBQUE7OztZQUdBLFFBQUEsSUFBQSxRQUFBLFNBQUE7WUFDQSxNQUFBLFNBQUE7Z0JBQ0EsU0FBQTtnQkFDQSxTQUFBO2dCQUNBLFNBQUE7Z0JBQ0EsU0FBQTtnQkFDQSxTQUFBOzs7O1FBSUEsWUFBQSxZQUFBOztZQUVBLE9BQUEsWUFBQSxVQUFBLE1BQUE7Z0JBQ0EsSUFBQSxRQUFBLFFBQUEsUUFBQSxTQUFBLGVBQUEsaUJBQUE7Z0JBQ0EsTUFBQSxPQUFBLFlBQUE7b0JBQ0EsTUFBQSxHQUFBLFVBQUE7Ozs7WUFJQSxPQUFBLFdBQUEsVUFBQSxTQUFBLFdBQUE7Z0JBQ0EsRUFBQSxNQUFBLFNBQUEsUUFBQTtnQkFDQSxJQUFBLFFBQUEsUUFBQSxRQUFBLFNBQUEsZUFBQSxpQkFBQTtnQkFDQSxNQUFBLE9BQUEsWUFBQTtvQkFDQSxNQUFBLEdBQUEsU0FBQSxTQUFBOzs7O1lBSUEsT0FBQSxzQkFBQSxVQUFBLGlCQUFBO2dCQUNBLEVBQUEsVUFBQSxRQUFBO2dCQUNBLElBQUEsUUFBQSxRQUFBLFFBQUEsU0FBQSxlQUFBLGlCQUFBO2dCQUNBLE1BQUEsT0FBQSxZQUFBO29CQUNBLE1BQUEsR0FBQSxvQkFBQTs7OztZQUlBLE9BQUEsWUFBQSxVQUFBLFNBQUEsVUFBQTtnQkFDQSxFQUFBLE1BQUEsU0FBQSxRQUFBO2dCQUNBLElBQUEsUUFBQSxRQUFBLFFBQUEsU0FBQSxlQUFBLGlCQUFBO2dCQUNBLE1BQUEsT0FBQSxZQUFBO29CQUNBLE1BQUEsR0FBQSxVQUFBLFNBQUE7Ozs7WUFJQSxJQUFBLE9BQUEsUUFBQTtnQkFDQSxHQUFBLG1CQUFBLE9BQUEsT0FBQSxnQkFBQSxPQUFBLFNBQUEsT0FBQSxJQUFBLE9BQUEsT0FBQSxlQUFBLEtBQUEsT0FBQSxRQUFBLFNBQUEsUUFBQTs7O1lB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Z0JBQ0EsT0FBQTtnQkFDQSxPQUFBO2dCQUNBLFdBQUE7Z0JBQ0EsZ0JBQUE7Z0JBQ0Esa0JBQUE7Z0JBQ0EsS0FBQTs7OztRQUlBLElBQUEsdUJBQUEsVUFBQSxNQUFBLFdBQUEsU0FBQSxPQUFBLE9BQUE7WUFDQSxPQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsV0FBQTtnQkFDQSxTQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsT0FBQSxRQUFBLFFBQUEsQ0FBQSxTQUFBOzs7O1FBSUEsT0FBQTtZQUNBLGdCQUFBLFVBQUEsUUFBQTtnQkFDQSxTQUFBLFVBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUE7O2dCQUVBLE1BQUE7b0JBQ0EsS0FBQSxZQUFBLEtBQUEsWUFBQTtvQkFDQSxRQUFBO29CQUNBLFFBQUE7bUJBQ0EsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsS0FBQSxVQUFBLFdBQUEsWUFBQSxLQUFBO29CQUNBLEVBQUEsUUFBQTttQkFDQSxNQUFBLFVBQUEsT0FBQTtvQkFDQSxFQUFBLE9BQUE7OztnQkFHQSxPQUFBLEVBQUE7OztZQUdBLHFCQUFBLFVBQUEsSUFBQTtjQUNBLElBQUEsSUFBQSxHQUFBOztjQUVBLE1BQUEsSUFBQSxZQUFBLEtBQUEsWUFBQSxrQkFBQSxLQUFBLEtBQUEsUUFBQSxVQUFBLE1BQUE7a0JBQ0EsSUFBQSxhQUFBLGlCQUFBLFlBQUE7a0JBQ0EsRUFBQSxRQUFBOztjQUVBLE9BQUEsRUFBQTs7O1lBR0EsWUFBQSxVQUFBLFFBQUE7Z0JBQ0EsU0FBQSxVQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBOztnQkFFQSxNQUFBO29CQUNBLEtBQUEsT0FBQSxNQUFBLE9BQUEsTUFBQSxZQUFBLEtBQUEsWUFBQTtvQkFDQSxRQUFBO29CQUNBLFFBQUE7bUJBQ0EsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsS0FBQSxVQUFBLE9BQUEsWUFBQSxLQUFBO29CQUNBLEVBQUEsUUFBQTttQkFDQSxNQUFBLFVBQUEsT0FBQTtvQkFDQSxFQUFBLE9BQUE7OztnQkFHQSxPQUFBLEVBQUE7OztZQUdBLGtCQUFBLFVBQUEsSUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTtnQkFDQSxNQUFBLElBQUEsWUFBQSxLQUFBLFlBQUEsYUFBQSxLQUFBLEtBQUEsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsSUFBQSxTQUFBLGNBQUEsWUFBQTtvQkFDQSxFQUFBLFFBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOztnQkFFQSxPQUFBLEVBQUE7OztZQUdBLGdCQUFBLFVBQUEsWUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTtnQkFDQSxJQUFBLGtCQUFBLHFCQUFBLFlBQUE7O2dCQUVBLElBQUEsQ0FBQSxnQkFBQSxJQUFBO29CQUNBLE1BQUEsS0FBQSxZQUFBLEtBQUEsWUFBQSxpQkFBQSxpQkFBQSxRQUFBLFVBQUEsUUFBQTt3QkFDQSxFQUFBLFFBQUE7dUJBQ0EsTUFBQSxTQUFBLE1BQUE7d0JBQ0EsRUFBQSxPQUFBOzt1QkFFQTtvQkFDQSxNQUFBLE1BQUEsWUFBQSxLQUFBLFlBQUEsa0JBQUEsZ0JBQUEsS0FBQSxLQUFBLGlCQUFBLFFBQUEsVUFBQSxRQUFBO3dCQUNBLGFBQUE7d0JBQ0EsRUFBQSxRQUFBO3VCQUNBLE1BQUEsU0FBQSxNQUFBO3dCQUNBLEVBQUEsT0FBQTs7OztnQkFJQSxPQUFBLEVBQUE7OztZQUdBLG9CQUFBLFVBQUEsWUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTtnQkFDQSxJQUFBLGtCQUFBLHFCQUFBLFlBQUE7O2dCQUVBLE1BQUEsS0FBQSxZQUFBLEtBQUEsWUFBQSw0QkFBQSxpQkFBQSxRQUFBLFVBQUEsUUFBQTtvQkFDQSxFQUFBLFFBQUE7bUJBQ0EsTUFBQSxTQUFBLE1BQUE7b0JBQ0EsRUFBQSxPQUFBOzs7Z0JBR0EsT0FBQSxFQUFBOzs7Ozs7QUN4SEEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSxpRUFBQSxVQUFBLE9BQUEsSUFBQSxXQUFBLGFBQUE7UUFDQSxPQUFBO1lBQ0EsZUFBQSxZQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBO2dCQUNBLElBQUEsTUFBQSxZQUFBLEtBQUEsWUFBQTs7Z0JBRUEsTUFBQTtvQkFDQSxLQUFBO29CQUNBLFFBQUE7b0JBQ0EsUUFBQSxFQUFBLE9BQUE7bUJBQ0EsUUFBQSxVQUFBLE1BQUE7b0JBQ0EsRUFBQSxRQUFBLEtBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOztnQkFFQSxPQUFBLEVBQUE7O1lBRUEscUJBQUEsVUFBQSxJQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBO2dCQUNBLElBQUEsTUFBQSxZQUFBLEtBQUEsWUFBQSxnQkFBQSxLQUFBOztnQkFFQSxNQUFBO29CQUNBLEtBQUE7b0JBQ0EsUUFBQTttQkFDQSxRQUFBLFVBQUEsTUFBQTtvQkFDQSxFQUFBLFFBQUE7bUJBQ0EsTUFBQSxVQUFBLE9BQUE7b0JBQ0EsRUFBQSxPQUFBOztnQkFFQSxPQUFBLEVBQUE7OztZQUdBLG1CQUFBLFVBQUEsV0FBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTtnQkFDQSxJQUFBLGlCQUFBLFVBQUE7O2dCQUVBLE1BQUEsS0FBQSxZQUFBLEtBQUEsWUFBQSwwQkFBQSxnQkFBQSxRQUFBLFVBQUEsUUFBQTtvQkFDQSxFQUFBLFFBQUE7bUJBQ0EsTUFBQSxTQUFBLE1BQUE7b0JBQ0EsRUFBQSxPQUFBOzs7Z0JBR0EsT0FBQSxFQUFBOztZQUVBLGVBQUEsVUFBQSxXQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBOztnQkFFQSxJQUFBLENBQUEsVUFBQSxJQUFBO29CQUNBLE1BQUEsS0FBQSxZQUFBLEtBQUEsWUFBQSxlQUFBLFVBQUEsU0FBQSxRQUFBLFVBQUEsUUFBQTt3QkFDQSxFQUFBLFFBQUE7dUJBQ0EsTUFBQSxVQUFBLE9BQUE7d0JBQ0EsRUFBQSxPQUFBOzt1QkFFQTtvQkFDQSxNQUFBLE1BQUEsWUFBQSxLQUFBLFlBQUEsZ0JBQUEsVUFBQSxLQUFBLEtBQUEsVUFBQSxTQUFBLFFBQUEsVUFBQSxRQUFBO3dCQUNBLFlBQUE7d0JBQ0EsRUFBQSxRQUFBO3VCQUNBLE1BQUEsVUFBQSxPQUFBO3dCQUNBLEVBQUEsT0FBQTs7OztnQkFJQSxPQUFBLEVBQUE7Ozs7Ozs7Ozs7O0NDNURBLElBQUEsZUFBQSxVQUFBOzs7OztJQUtBLFFBQUEsSUFBQTs7O0NBR0EsT0FBQSxXQUFBOztBQUVBLEdBQUEsUUFBQSxXQUFBO0lBQ0EsSUFBQSx1QkFBQTtJQUNBLElBQUEseUJBQUE7O0lBRUEsSUFBQSxTQUFBO0VBQ0EsTUFBQTtFQUNBLFFBQUE7RUFDQSxTQUFBO0VBQ0EsT0FBQTs7SUFFQSxJQUFBLGtCQUFBLEdBQUEsS0FBQSxJQUFBLE9BQUEsSUFBQSxPQUFBLENBQUE7SUFDQSxJQUFBLGdCQUFBLEdBQUEsS0FBQSxLQUFBLE9BQUEsSUFBQSxPQUFBLENBQUE7SUFDQSxJQUFBLGlCQUFBO0lBQ0EsSUFBQSxZQUFBO0lBQ0EsSUFBQSxhQUFBO0lBQ0EsSUFBQSxTQUFBLFNBQUEsS0FBQSxlQUFBLE9BQUEsTUFBQSxPQUFBLE9BQUE7SUFDQSxJQUFBLFFBQUEsU0FBQSxLQUFBLGNBQUEsT0FBQSxRQUFBLE9BQUEsS0FBQTtDQUNBLElBQUEsV0FBQTtDQUNBLElBQUEsUUFBQTtDQUNBLElBQUEsUUFBQTs7SUFFQSxJQUFBLGFBQUE7O0lBRUEsSUFBQSxjQUFBLFNBQUEsR0FBQTtFQUNBLE9BQUEsRUFBQSxTQUFBLEVBQUEsV0FBQSxFQUFBOzs7SUFHQSxJQUFBLGdCQUFBLFNBQUEsR0FBQTtFQUNBLE9BQUEsZUFBQSxFQUFBLEVBQUEsVUFBQSxNQUFBLEVBQUEsRUFBQSxZQUFBOzs7SUFHQSxJQUFBLElBQUEsR0FBQSxLQUFBLFFBQUEsT0FBQSxFQUFBLGlCQUFBLGlCQUFBLE1BQUEsRUFBQSxHQUFBLFNBQUEsTUFBQTs7SUFFQSxJQUFBLElBQUEsR0FBQSxNQUFBLFVBQUEsT0FBQSxXQUFBLGdCQUFBLEVBQUEsR0FBQSxTQUFBLE9BQUEsTUFBQSxPQUFBLFVBQUE7O0lBRUEsSUFBQSxRQUFBLEdBQUEsSUFBQSxPQUFBLE1BQUEsR0FBQSxPQUFBLFVBQUEsV0FBQSxHQUFBLEtBQUEsT0FBQSxhQUFBLGNBQUE7TUFDQSxTQUFBLEdBQUEsWUFBQTs7SUFFQSxJQUFBLFFBQUEsR0FBQSxJQUFBLE9BQUEsTUFBQSxHQUFBLE9BQUEsUUFBQSxTQUFBOztJQUVBLElBQUEsaUJBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxtQkFBQSxzQkFBQTtLQUNBLElBQUEsVUFBQSxhQUFBLE1BQUEsU0FBQSxHQUFBO0VBQ0Esa0JBQUEsR0FBQSxLQUFBLElBQUEsT0FBQSxJQUFBLFFBQUEsQ0FBQTtFQUNBLGdCQUFBLEdBQUEsS0FBQSxLQUFBLE9BQUEsSUFBQSxRQUFBLENBQUE7RUFDQTs7S0FFQSxNQUFBLEtBQUEsU0FBQSxHQUFBLEdBQUE7RUFDQSxPQUFBLEVBQUEsU0FBQSxFQUFBOztLQUVBLGdCQUFBLE1BQUEsTUFBQSxTQUFBLEdBQUE7S0FDQSxNQUFBLEtBQUEsU0FBQSxHQUFBLEdBQUE7RUFDQSxPQUFBLEVBQUEsU0FBQSxFQUFBOztLQUVBLGtCQUFBLE1BQUEsR0FBQTs7OztJQUlBLElBQUEsV0FBQSxXQUFBO0NBQ0EsSUFBQSxHQUFBLEtBQUEsUUFBQSxPQUFBLEVBQUEsaUJBQUEsaUJBQUEsTUFBQSxFQUFBLEdBQUEsU0FBQSxNQUFBO0NBQ0EsSUFBQSxHQUFBLE1BQUEsVUFBQSxPQUFBLFdBQUEsZ0JBQUEsRUFBQSxHQUFBLFNBQUEsT0FBQSxNQUFBLE9BQUEsVUFBQTtDQUNBLFFBQUEsR0FBQSxJQUFBLE9BQUEsTUFBQSxHQUFBLE9BQUEsVUFBQSxNQUFBLEtBQUEsS0FBQSxNQUFBLE1BQUEsV0FBQSxHQUFBLEtBQUEsT0FBQSxhQUFBLGNBQUE7R0FDQSxTQUFBLEdBQUEsWUFBQTs7Q0FFQSxRQUFBLEdBQUEsSUFBQSxPQUFBLE1BQUEsR0FBQSxPQUFBLFFBQUEsU0FBQTs7O0lBR0EsU0FBQSxNQUFBLE9BQUE7O0NBRUEsZUFBQTtDQUNBOztDQUVBLElBQUEsTUFBQSxHQUFBLE9BQUE7RUFDQSxPQUFBO0VBQ0EsS0FBQSxTQUFBO0VBQ0EsS0FBQSxTQUFBLFFBQUEsT0FBQSxPQUFBLE9BQUE7RUFDQSxLQUFBLFVBQUEsU0FBQSxPQUFBLE1BQUEsT0FBQTtFQUNBLE9BQUE7U0FDQSxLQUFBLFNBQUE7RUFDQSxLQUFBLFNBQUEsUUFBQSxPQUFBLE9BQUEsT0FBQTtFQUNBLEtBQUEsVUFBQSxTQUFBLE9BQUEsTUFBQSxPQUFBO0VBQ0EsS0FBQSxhQUFBLGVBQUEsT0FBQSxPQUFBLE9BQUEsT0FBQSxNQUFBOztNQUVBLElBQUEsVUFBQTtHQUNBLEtBQUEsT0FBQSxhQUFBO0dBQ0EsT0FBQTtHQUNBLEtBQUEsTUFBQTtVQUNBLEtBQUEsTUFBQTtHQUNBLEtBQUEsU0FBQSxTQUFBLEVBQUE7TUFDQSxHQUFBLFdBQUEsRUFBQSxXQUFBLEtBQUEsRUFBQSxPQUFBO01BQ0EsT0FBQSxXQUFBLEVBQUE7O0dBRUEsS0FBQSxLQUFBO0dBQ0EsS0FBQSxhQUFBO0dBQ0EsS0FBQSxVQUFBLFNBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQTtHQUNBLEtBQUEsU0FBQSxTQUFBLEdBQUE7TUFDQSxRQUFBLEVBQUEsRUFBQSxVQUFBLEVBQUEsRUFBQTs7OztFQUlBLElBQUEsT0FBQTtHQUNBLEtBQUEsU0FBQTtHQUNBLEtBQUEsYUFBQSxtQkFBQSxTQUFBLE9BQUEsTUFBQSxPQUFBLFVBQUE7R0FDQTtHQUNBLEtBQUE7O0VBRUEsSUFBQSxPQUFBLEtBQUEsS0FBQSxTQUFBLFVBQUEsYUFBQSxLQUFBOztFQUVBLE9BQUE7O0tBRUE7O0lBRUEsTUFBQSxTQUFBLFNBQUEsT0FBQTtRQUNBLFFBQUEsSUFBQTtDQUNBLGVBQUE7Q0FDQTs7UUFFQSxJQUFBLE1BQUEsR0FBQSxPQUFBOztRQUVBLElBQUEsa0JBQUEsSUFBQSxPQUFBO1FBQ0EsSUFBQSxPQUFBLGdCQUFBLFVBQUEsUUFBQSxLQUFBLE9BQUE7O1FBRUEsS0FBQTtVQUNBLE9BQUEsT0FBQTtVQUNBLEtBQUEsTUFBQTtVQUNBLEtBQUEsTUFBQTtHQUNBLEtBQUEsU0FBQSxTQUFBLEVBQUE7TUFDQSxHQUFBLFdBQUEsRUFBQSxXQUFBLEtBQUEsRUFBQSxPQUFBO01BQ0EsT0FBQSxXQUFBLEVBQUE7O0dBRUE7R0FDQSxLQUFBLEtBQUE7R0FDQSxLQUFBLGFBQUE7R0FDQSxLQUFBLFVBQUEsU0FBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO0lBQ0EsS0FBQSxTQUFBLFNBQUEsR0FBQTtNQUNBLFFBQUEsRUFBQSxFQUFBLFVBQUEsRUFBQSxFQUFBOzs7UUFHQSxLQUFBO1dBQ0EsS0FBQSxhQUFBO0dBQ0EsS0FBQSxVQUFBLFNBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQTtHQUNBLEtBQUEsU0FBQSxTQUFBLEdBQUE7TUFDQSxRQUFBLEVBQUEsRUFBQSxVQUFBLEVBQUEsRUFBQTs7O0NBR0EsS0FBQSxPQUFBOztDQUVBLElBQUEsT0FBQSxNQUFBLGFBQUEsS0FBQTtDQUNBLElBQUEsT0FBQSxNQUFBLGFBQUEsS0FBQTs7Q0FFQSxPQUFBOzs7SUFHQSxNQUFBLFNBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxDQUFBLFVBQUE7S0FDQSxPQUFBO0NBQ0EsU0FBQTtDQUNBLE9BQUE7OztJQUdBLE1BQUEsYUFBQSxTQUFBLE9BQUE7Q0FDQSxJQUFBLENBQUEsVUFBQTtLQUNBLE9BQUEsRUFBQSxpQkFBQTtDQUNBLGtCQUFBLENBQUEsTUFBQSxJQUFBLGdCQUFBLENBQUEsTUFBQTtDQUNBLE9BQUE7Ozs7Ozs7O0lBUUEsTUFBQSxpQkFBQSxTQUFBLE9BQUE7Q0FDQSxJQUFBLENBQUEsVUFBQTtLQUNBLE9BQUE7UUFDQSxpQkFBQTtRQUNBLE9BQUE7Ozs7SUFJQSxNQUFBLFlBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxDQUFBLFVBQUE7S0FDQSxPQUFBO0NBQ0EsWUFBQTtDQUNBLE9BQUE7OztJQUdBLE1BQUEsYUFBQSxTQUFBLE9BQUE7Q0FDQSxJQUFBLENBQUEsVUFBQTtLQUNBLE9BQUE7Q0FDQSxhQUFBO0NBQ0EsT0FBQTs7O0NBR0EsTUFBQSxRQUFBLFNBQUEsTUFBQTtFQUNBLEdBQUEsQ0FBQSxVQUFBLE9BQUE7R0FDQSxPQUFBOztFQUVBLFFBQUE7RUFDQSxPQUFBOzs7Q0FHQSxNQUFBLFFBQUEsU0FBQSxNQUFBO0VBQ0EsR0FBQSxDQUFBLFVBQUEsT0FBQTtHQUNBLE9BQUE7O0VBRUEsUUFBQTtFQUNBLE9BQUE7OztJQUdBLE1BQUEsUUFBQSxTQUFBLE9BQUE7Q0FDQSxJQUFBLENBQUEsVUFBQTtLQUNBLE9BQUE7Q0FDQSxRQUFBLENBQUE7Q0FDQSxPQUFBOzs7SUFHQSxNQUFBLFNBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxDQUFBLFVBQUE7S0FDQSxPQUFBO0NBQ0EsU0FBQSxDQUFBO0NBQ0EsT0FBQTs7O0lBR0EsTUFBQSxhQUFBLFNBQUEsT0FBQTtDQUNBLElBQUEsQ0FBQSxVQUFBO0tBQ0EsT0FBQTtDQUNBLGFBQUE7Q0FDQSxPQUFBOzs7Q0FHQSxNQUFBLFdBQUEsU0FBQSxPQUFBO0VBQ0EsR0FBQSxDQUFBLFVBQUEsT0FBQTtHQUNBLE9BQUE7O0VBRUEsV0FBQTtFQUNBLE9BQUE7Ozs7O0lBS0EsT0FBQTs7O0FDaFFBLFNBQUEsTUFBQSxpQkFBQTtBQUNBO0lBQ0EsS0FBQSxrQkFBQTs7SUFFQSxJQUFBLE9BQUE7O0lBRUEsS0FBQSxZQUFBLFNBQUE7SUFDQTtRQUNBLEtBQUEsU0FBQTs7UUFFQSxLQUFBLE9BQUEsT0FBQSxLQUFBLE9BQUEsT0FBQTs7UUFFQSxLQUFBLE9BQUEsU0FBQSxLQUFBLE9BQUEsT0FBQSxPQUFBO1FBQ0EsS0FBQSxPQUFBLEtBQUEsS0FBQSxPQUFBLE9BQUE7UUFDQSxLQUFBLE9BQUEsS0FBQSxLQUFBLE9BQUEsT0FBQTs7UUFFQSxLQUFBLE9BQUEsTUFBQSxhQUFBLGNBQUEsTUFBQSxjQUFBLE1BQUE7UUFDQSxLQUFBLE9BQUEsTUFBQSxhQUFBLGNBQUEsTUFBQSxjQUFBLE1BQUE7UUFDQSxLQUFBLE9BQUEsUUFBQSxLQUFBLE9BQUEsTUFBQSxLQUFBLE9BQUE7O1FBRUEsS0FBQSxPQUFBLGFBQUEsY0FBQSxjQUFBO1FBQ0EsS0FBQSxPQUFBLGFBQUEsY0FBQSxjQUFBOztRQUVBLEtBQUEsT0FBQSxjQUFBLGNBQUEsY0FBQTtRQUNBLEtBQUEsT0FBQSxjQUFBLGNBQUEsZUFBQTtRQUNBLEtBQUEsT0FBQSxZQUFBLGNBQUEsWUFBQTs7UUFFQSxLQUFBLE9BQUEscUJBQUEsY0FBQSxzQkFBQTs7O0lBR0EsS0FBQSxTQUFBO0lBQ0E7UUFDQSxLQUFBLE9BQUEsR0FBQSxPQUFBLE1BQUEsS0FBQTthQUNBLE9BQUE7YUFDQSxLQUFBLFNBQUE7YUFDQSxLQUFBLFNBQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxVQUFBLEtBQUEsT0FBQTs7UUFFQSxLQUFBLEtBQUEsT0FBQTthQUNBLEtBQUEsU0FBQTthQUNBLEtBQUEsTUFBQSxLQUFBLE9BQUE7YUFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxLQUFBLEtBQUEsT0FBQSxTQUFBO2FBQ0EsTUFBQSxRQUFBOzs7O1FBSUEsS0FBQSxLQUFBLE9BQUE7YUFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxNQUFBLEtBQUEsT0FBQTthQUNBLEtBQUEsS0FBQSxNQUFBLEtBQUEsT0FBQTthQUNBLE1BQUEsUUFBQTthQUNBLE1BQUEsVUFBQTthQUNBLE1BQUEsZ0JBQUE7O1FBRUEsS0FBQSxJQUFBLFlBQUEsS0FBQSxPQUFBO1FBQ0E7WUFDQSxLQUFBLFNBQUEsS0FBQSxPQUFBLFdBQUEsVUFBQSxNQUFBLEtBQUEsT0FBQSxXQUFBLFVBQUEsSUFBQSxLQUFBLE9BQUE7OztRQUdBLEtBQUEsSUFBQSxhQUFBLEtBQUEsT0FBQTtRQUNBO1lBQ0EsS0FBQSxTQUFBLEtBQUEsT0FBQSxZQUFBLFdBQUEsTUFBQSxLQUFBLE9BQUEsWUFBQSxXQUFBLElBQUEsS0FBQSxPQUFBOzs7UUFHQSxLQUFBLElBQUEsVUFBQSxLQUFBLE9BQUE7UUFDQTtZQUNBLEtBQUEsU0FBQSxLQUFBLE9BQUEsU0FBQSxRQUFBLE1BQUEsS0FBQSxPQUFBLFNBQUEsUUFBQSxJQUFBLEtBQUEsT0FBQTs7O1FBR0EsSUFBQSxXQUFBOztRQUVBLElBQUEsYUFBQSxLQUFBLE9BQUE7UUFDQTtZQUNBLFdBQUEsS0FBQSxNQUFBLEtBQUEsT0FBQSxPQUFBO1lBQ0EsS0FBQSxLQUFBLE9BQUE7aUJBQ0EsS0FBQSxLQUFBLEtBQUEsT0FBQTtpQkFDQSxLQUFBLEtBQUEsS0FBQSxPQUFBLEtBQUEsSUFBQSxXQUFBO2lCQUNBLEtBQUEsTUFBQSxXQUFBO2lCQUNBLEtBQUEsZUFBQTtpQkFDQSxLQUFBLEtBQUEsT0FBQTtpQkFDQSxNQUFBLGFBQUEsV0FBQTtpQkFDQSxNQUFBLFFBQUE7aUJBQ0EsTUFBQSxnQkFBQTs7O1FBR0EsV0FBQSxLQUFBLE1BQUEsS0FBQSxPQUFBLE9BQUE7UUFDQSxJQUFBLGFBQUEsS0FBQSxPQUFBLFNBQUEsS0FBQSxPQUFBLGFBQUE7UUFDQSxLQUFBLElBQUEsUUFBQSxLQUFBLE9BQUEsS0FBQSxTQUFBLEtBQUEsT0FBQSxLQUFBLFNBQUE7UUFDQTtZQUNBLElBQUEsYUFBQSxhQUFBLEtBQUEsT0FBQTtnQkFDQSxTQUFBO2dCQUNBLFNBQUE7WUFDQSxLQUFBLElBQUEsUUFBQSxRQUFBLFlBQUEsUUFBQSxLQUFBLElBQUEsUUFBQSxZQUFBLEtBQUEsT0FBQSxNQUFBLFNBQUE7WUFDQTtnQkFDQSxTQUFBLEtBQUEsYUFBQSxPQUFBO2dCQUNBLFNBQUEsS0FBQSxhQUFBLE9BQUE7O2dCQUVBLEtBQUEsS0FBQSxPQUFBO3FCQUNBLEtBQUEsTUFBQSxPQUFBO3FCQUNBLEtBQUEsTUFBQSxPQUFBO3FCQUNBLEtBQUEsTUFBQSxPQUFBO3FCQUNBLEtBQUEsTUFBQSxPQUFBO3FCQUNBLE1BQUEsVUFBQTtxQkFDQSxNQUFBLGdCQUFBOzs7WUFHQSxTQUFBLEtBQUEsYUFBQSxPQUFBO1lBQ0EsU0FBQSxLQUFBLGFBQUEsT0FBQTs7WUFFQSxLQUFBLEtBQUEsT0FBQTtpQkFDQSxLQUFBLE1BQUEsT0FBQTtpQkFDQSxLQUFBLE1BQUEsT0FBQTtpQkFDQSxLQUFBLE1BQUEsT0FBQTtpQkFDQSxLQUFBLE1BQUEsT0FBQTtpQkFDQSxNQUFBLFVBQUE7aUJBQ0EsTUFBQSxnQkFBQTs7WUFFQSxJQUFBLFNBQUEsS0FBQSxPQUFBLE9BQUEsU0FBQSxLQUFBLE9BQUE7WUFDQTtnQkFDQSxJQUFBLFFBQUEsS0FBQSxhQUFBLE9BQUE7O2dCQUVBLEtBQUEsS0FBQSxPQUFBO3FCQUNBLEtBQUEsS0FBQSxNQUFBO3FCQUNBLEtBQUEsS0FBQSxNQUFBO3FCQUNBLEtBQUEsTUFBQSxXQUFBO3FCQUNBLEtBQUEsZUFBQSxTQUFBLEtBQUEsT0FBQSxNQUFBLFVBQUE7cUJBQ0EsS0FBQTtxQkFDQSxNQUFBLGFBQUEsV0FBQTtxQkFDQSxNQUFBLFFBQUE7cUJBQ0EsTUFBQSxnQkFBQTs7OztRQUlBLElBQUEsbUJBQUEsS0FBQSxLQUFBLE9BQUEsU0FBQSxLQUFBLFNBQUE7O1FBRUEsSUFBQSxXQUFBLENBQUEsS0FBQSxPQUFBLE1BQUEsS0FBQSxPQUFBLE9BQUE7O1FBRUEsSUFBQSxjQUFBLEtBQUEsaUJBQUE7O1FBRUEsSUFBQSxjQUFBLEdBQUEsSUFBQTthQUNBLEVBQUEsU0FBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO2FBQ0EsRUFBQSxTQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUE7YUFDQSxZQUFBOztRQUVBLGlCQUFBLFVBQUE7YUFDQSxLQUFBLENBQUE7YUFDQTthQUNBLE9BQUE7YUFDQSxLQUFBLEtBQUE7YUFDQSxNQUFBLFFBQUE7O1FBRUEsaUJBQUEsT0FBQTthQUNBLEtBQUEsTUFBQSxLQUFBLE9BQUE7YUFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxLQUFBLE9BQUEsS0FBQSxPQUFBO2FBQ0EsTUFBQSxRQUFBOztRQUVBLFdBQUEsS0FBQSxNQUFBLEtBQUEsT0FBQSxPQUFBO1FBQ0EsaUJBQUEsVUFBQTthQUNBLEtBQUEsQ0FBQTthQUNBO2FBQ0EsT0FBQTthQUNBLEtBQUEsS0FBQSxLQUFBLE9BQUE7YUFDQSxLQUFBLEtBQUEsS0FBQSxPQUFBLE9BQUEsS0FBQSxPQUFBLEtBQUEsSUFBQTthQUNBLEtBQUEsTUFBQSxXQUFBO2FBQ0EsS0FBQSxlQUFBO2FBQ0EsTUFBQSxhQUFBLFdBQUE7YUFDQSxNQUFBLFFBQUE7YUFDQSxNQUFBLGdCQUFBOztRQUVBLEtBQUEsT0FBQSxLQUFBLE9BQUEsS0FBQTs7O0lBR0EsS0FBQSxtQkFBQSxTQUFBO0lBQ0E7UUFDQSxJQUFBLFFBQUEsS0FBQSxPQUFBLFFBQUE7O1FBRUEsSUFBQSxPQUFBLGFBQUEsT0FBQTtRQUNBLElBQUEsUUFBQSxhQUFBLFFBQUEsT0FBQTtRQUNBLElBQUEsUUFBQSxhQUFBLFFBQUEsT0FBQTs7UUFFQSxJQUFBLFlBQUEsU0FBQSxLQUFBLE9BQUEsU0FBQSxHQUFBLElBQUEsUUFBQTtRQUNBLElBQUEsT0FBQSxhQUFBLFdBQUE7UUFDQSxJQUFBLFFBQUEsYUFBQSxZQUFBLE9BQUE7UUFDQSxJQUFBLFFBQUEsYUFBQSxZQUFBLE9BQUE7O1FBRUEsT0FBQSxDQUFBLE1BQUEsT0FBQSxPQUFBLE1BQUEsT0FBQSxPQUFBOztRQUVBLFNBQUEsYUFBQSxPQUFBO1FBQ0E7WUFDQSxJQUFBLFFBQUEsS0FBQSxhQUFBLE9BQUE7WUFDQSxNQUFBLEtBQUEsS0FBQSxPQUFBO1lBQ0EsTUFBQSxLQUFBLEtBQUEsT0FBQTtZQUNBLE9BQUE7Ozs7SUFJQSxLQUFBLFdBQUEsU0FBQSxPQUFBLEtBQUE7SUFDQTtRQUNBLElBQUEsS0FBQSxNQUFBLE9BQUE7O1FBRUEsS0FBQSxLQUFBLE9BQUE7YUFDQSxNQUFBLFFBQUE7YUFDQSxLQUFBLEtBQUEsR0FBQSxJQUFBO2lCQUNBLFdBQUEsS0FBQSxlQUFBO2lCQUNBLFNBQUEsS0FBQSxlQUFBO2lCQUNBLFlBQUEsT0FBQSxLQUFBLE9BQUE7aUJBQ0EsWUFBQSxPQUFBLEtBQUEsT0FBQTthQUNBLEtBQUEsYUFBQSxXQUFBLEVBQUEsT0FBQSxlQUFBLEtBQUEsT0FBQSxLQUFBLE9BQUEsS0FBQSxPQUFBLEtBQUE7OztJQUdBLEtBQUEsU0FBQSxTQUFBLE9BQUE7SUFDQTtRQUNBLElBQUEsbUJBQUEsS0FBQSxLQUFBLE9BQUE7O1FBRUEsaUJBQUEsVUFBQSxRQUFBLEtBQUEsS0FBQSxNQUFBOztRQUVBLElBQUEsVUFBQSxpQkFBQSxVQUFBO1FBQ0EsUUFBQTthQUNBLFNBQUEsYUFBQSxxQkFBQSxxQkFBQSxLQUFBLE9BQUE7Ozs7YUFJQSxVQUFBLGFBQUE7WUFDQTtnQkFDQSxJQUFBLGVBQUE7Z0JBQ0EsSUFBQSxRQUFBLEtBQUEsT0FBQSxLQUFBLGVBQUEsS0FBQSxPQUFBLE1BQUEsS0FBQSxLQUFBLE9BQUE7cUJBQ0EsSUFBQSxRQUFBLEtBQUEsT0FBQSxLQUFBLGVBQUEsS0FBQSxPQUFBLE1BQUEsS0FBQSxLQUFBLE9BQUE7Z0JBQ0EsSUFBQSxrQkFBQSxLQUFBLGVBQUEsZ0JBQUE7Z0JBQ0EsSUFBQSxrQkFBQSxLQUFBLG9CQUFBO2dCQUNBLEtBQUEsbUJBQUE7O2dCQUVBLE9BQUEsU0FBQTtnQkFDQTtvQkFDQSxJQUFBLFdBQUEsa0JBQUEsQ0FBQSxlQUFBLGlCQUFBO29CQUNBLE9BQUEsZUFBQSxLQUFBLE9BQUEsS0FBQSxPQUFBLEtBQUEsT0FBQSxLQUFBLGNBQUEsV0FBQTs7OztRQUlBLElBQUEsY0FBQSxLQUFBLEtBQUEsT0FBQTthQUNBO2FBQ0EsU0FBQTthQUNBLE1BQUEsUUFBQSxZQUFBO2dCQUNBLElBQUEsSUFBQSxTQUFBO2dCQUNBLElBQUEsSUFBQSxLQUFBLElBQUEsSUFBQTtvQkFDQSxPQUFBLEtBQUEsT0FBQTt1QkFDQSxJQUFBLEtBQUEsTUFBQSxJQUFBLElBQUE7b0JBQ0EsT0FBQSxLQUFBLE9BQUE7dUJBQ0E7b0JBQ0EsT0FBQSxLQUFBLE9BQUE7Ozs7O0lBS0EsS0FBQSxpQkFBQSxTQUFBO0lBQ0E7OztRQUdBLE9BQUEsUUFBQSxLQUFBLE9BQUEsUUFBQSxPQUFBLEtBQUEsT0FBQSxNQUFBLEtBQUEsT0FBQSxRQUFBLE1BQUE7OztJQUdBLEtBQUEsaUJBQUEsU0FBQTtJQUNBO1FBQ0EsT0FBQSxLQUFBLGVBQUEsU0FBQSxLQUFBLEtBQUE7OztJQUdBLEtBQUEsZUFBQSxTQUFBLE9BQUE7SUFDQTtRQUNBLE9BQUEsR0FBQSxHQUFBLEtBQUEsT0FBQSxLQUFBLEtBQUEsT0FBQSxTQUFBLFNBQUEsS0FBQSxJQUFBLEtBQUEsZUFBQTtZQUNBLEdBQUEsS0FBQSxPQUFBLEtBQUEsS0FBQSxPQUFBLFNBQUEsU0FBQSxLQUFBLElBQUEsS0FBQSxlQUFBOzs7O0lBSUEsS0FBQSxVQUFBOzs7Ozs7OztBQzVRQSxDQUFBLFVBQUEsQ0FBQSxhQUFBLFFBQUEsT0FBQSxjQUFBLElBQUEsU0FBQSxVQUFBLENBQUEsWUFBQSxTQUFBLEVBQUEsQ0FBQSxLQUFBLGtCQUFBLENBQUEsRUFBQSxLQUFBLFdBQUEsRUFBQSxJQUFBLG1CQUFBLEtBQUEsY0FBQSxzQkFBQSxLQUFBLGVBQUEsS0FBQSxLQUFBLGVBQUEsS0FBQSxLQUFBLFNBQUEscXBCQUFBLEtBQUEsaUJBQUEsSUFBQSxLQUFBLHNCQUFBLDZCQUFBLEtBQUEsS0FBQSxDQUFBLGVBQUEsYUFBQSxXQUFBLFVBQUEsWUFBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLENBQUEsUUFBQSxJQUFBLE1BQUEsSUFBQSxLQUFBLElBQUEsTUFBQSxJQUFBLEdBQUEsSUFBQSxLQUFBLElBQUEsU0FBQSxJQUFBLFVBQUEsS0FBQSxFQUFBLEVBQUEsTUFBQSxLQUFBLElBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsSUFBQSxRQUFBLEVBQUEsS0FBQSxFQUFBLFdBQUEsRUFBQSxVQUFBLFNBQUEsUUFBQSxRQUFBLEVBQUEsRUFBQSxHQUFBLFVBQUEsRUFBQSxHQUFBLFFBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxLQUFBLEVBQUEsR0FBQSxPQUFBLEVBQUEsS0FBQSxPQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLEtBQUEsTUFBQSxhQUFBLE1BQUEsRUFBQSxDQUFBLEdBQUEsS0FBQSxZQUFBLEVBQUEsS0FBQSxTQUFBLEVBQUEsS0FBQSxPQUFBLEVBQUEsS0FBQSxRQUFBLEVBQUEsS0FBQSxXQUFBLEVBQUEsS0FBQSxVQUFBLEtBQUEsU0FBQSxHQUFBLENBQUEsSUFBQSxJQUFBLEVBQUEsRUFBQSxRQUFBLE9BQUEsS0FBQSxDQUFBLElBQUEsRUFBQSxFQUFBLFFBQUEsR0FBQSxHQUFBLENBQUEsRUFBQSxZQUFBLEVBQUEsSUFBQSxTQUFBLEdBQUEsQ0FBQSxFQUFBLFlBQUEsQ0FBQSxFQUFBLFlBQUEsRUFBQSxhQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsT0FBQSxFQUFBLE1BQUEsRUFBQSxZQUFBLEVBQUEsS0FBQSxDQUFBLFFBQUEsU0FBQSxlQUFBLEVBQUEsT0FBQSxJQUFBLENBQUEsR0FBQSxFQUFBLElBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsQ0FBQSxRQUFBLFNBQUEsWUFBQSxFQUFBLE9BQUEsVUFBQSxTQUFBLEtBQUEsR0FBQSxHQUFBLG9CQUFBLElBQUEsRUFBQSxFQUFBLFlBQUEsRUFBQSxFQUFBLFNBQUEsRUFBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLFdBQUEsRUFBQSxFQUFBLFFBQUEsRUFBQSxFQUFBLE9BQUEsYUFBQSxVQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxpQkFBQSxRQUFBLFlBQUEsS0FBQSxFQUFBLGlCQUFBLEtBQUEsSUFBQSxJQUFBLEVBQUEsQ0FBQSxHQUFBLFlBQUEsT0FBQSxFQUFBLENBQUEsRUFBQSxFQUFBLGFBQUEsUUFBQSxFQUFBLElBQUEsSUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLElBQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxjQUFBLEVBQUEsRUFBQSxRQUFBLEVBQUEsSUFBQSxDQUFBLElBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQSxHQUFBLEVBQUEsU0FBQSxFQUFBLENBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxFQUFBLEVBQUEsUUFBQSxFQUFBLFdBQUEsRUFBQSxFQUFBLFNBQUEsY0FBQSxHQUFBLENBQUEsSUFBQSxFQUFBLFVBQUEsS0FBQSxRQUFBLGVBQUEsQ0FBQSxFQUFBLEVBQUEsQ0FBQSxPQUFBLElBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsSUFBQSxHQUFBLEVBQUEsS0FBQSxFQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsTUFBQSxHQUFBLEVBQUEsRUFBQSxNQUFBLEtBQUEsYUFBQSxVQUFBLE9BQUEsRUFBQSxVQUFBLEtBQUEsRUFBQSxFQUFBLEdBQUEsR0FBQSxVQUFBLEtBQUEsRUFBQSxFQUFBLElBQUEsSUFBQSxFQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxPQUFBLEVBQUEsUUFBQSxLQUFBLEdBQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxhQUFBLEVBQUEsRUFBQSxNQUFBLEVBQUEsR0FBQSxVQUFBLE9BQUEsR0FBQSxRQUFBLFFBQUEsR0FBQSxDQUFBLElBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxLQUFBLEVBQUEsRUFBQSxFQUFBLEtBQUEsRUFBQSxPQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsUUFBQSxRQUFBLEVBQUEsSUFBQSxPQUFBLEVBQUEsQ0FBQSxHQUFBLEVBQUEsUUFBQSxHQUFBLE1BQUEsT0FBQSxFQUFBLEVBQUEsUUFBQSxHQUFBLE1BQUEsT0FBQSxFQUFBLFFBQUEsR0FBQSxNQUFBLFFBQUEsR0FBQSxHQUFBLEVBQUEsUUFBQSxPQUFBLEVBQUEsR0FBQSxDQUFBLEdBQUEsQ0FBQSxFQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsR0FBQSxDQUFBLEVBQUEsT0FBQSxFQUFBLFFBQUEsSUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxRQUFBLE9BQUEsSUFBQSxHQUFBLEVBQUEsRUFBQSxRQUFBLEdBQUEsRUFBQSxNQUFBLFFBQUEsR0FBQSxDQUFBLEVBQUEsT0FBQSxFQUFBLE1BQUEsQ0FBQSxFQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsT0FBQSxFQUFBLE9BQUEsSUFBQSxFQUFBLEVBQUEsS0FBQSxHQUFBLEVBQUEsSUFBQSxXQUFBLFVBQUEsQ0FBQSxJQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsS0FBQSxPQUFBLEtBQUEsRUFBQSxFQUFBLEVBQUEsS0FBQSxVQUFBLENBQUEsSUFBQSxTQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsT0FBQSxFQUFBLFVBQUEsT0FBQSxFQUFBLEVBQUEsTUFBQSxLQUFBLFdBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxLQUFBLEtBQUEsR0FBQSxPQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsT0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLEdBQUEsYUFBQSxNQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLFNBQUEsRUFBQSxDQUFBLEVBQUEsTUFBQSxNQUFBLElBQUEsRUFBQSxPQUFBLFVBQUEsQ0FBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLFVBQUEsVUFBQSxhQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsTUFBQSxDQUFBLElBQUEsRUFBQSxVQUFBLEtBQUEsUUFBQSxlQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxpQkFBQSxRQUFBLEVBQUEsaUJBQUEsRUFBQSxVQUFBLE9BQUEsVUFBQSxDQUFBLEdBQUEsT0FBQSxLQUFBLFVBQUEsQ0FBQSxJQUFBLElBQUEsRUFBQSxLQUFBLE1BQUEsR0FBQSxFQUFBLEVBQUEsTUFBQSxRQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsSUFBQSxLQUFBLFVBQUEsRUFBQSxPQUFBLEtBQUEsV0FBQSxJQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsUUFBQSxHQUFBLEVBQUEsWUFBQSxDQUFBLEVBQUEsRUFBQSxNQUFBLEtBQUEsY0FBQSxFQUFBLE9BQUEsS0FBQSxlQUFBLEVBQUEsT0FBQSxLQUFBLGVBQUEsRUFBQSxpQkFBQSxFQUFBLElBQUEsRUFBQSxHQUFBLEdBQUEsS0FBQSxZQUFBLEVBQUEsSUFBQSxzQkFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsR0FBQSxFQUFBLFNBQUEsUUFBQSxRQUFBLEVBQUEsUUFBQSxTQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsRUFBQSxHQUFBLENBQUEsVUFBQSxPQUFBLEdBQUEsYUFBQSxVQUFBLEVBQUEsR0FBQSxDQUFBLEVBQUEsSUFBQSxFQUFBLEdBQUEsQ0FBQSxFQUFBLEVBQUEsTUFBQSxLQUFBLE9BQUEsS0FBQSxrQkFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxRQUFBLFFBQUEsS0FBQSxVQUFBLEVBQUEsS0FBQSxpQkFBQSxLQUFBLHNCQUFBLEdBQUEsQ0FBQSxJQUFBLEdBQUEsSUFBQSxFQUFBLG1CQUFBLEVBQUEsRUFBQSxNQUFBLFFBQUEsUUFBQSxHQUFBLE9BQUEsRUFBQSxHQUFBLElBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsT0FBQSxFQUFBLFNBQUEsS0FBQSxTQUFBLGlCQUFBLEVBQUEsa0JBQUEsS0FBQSxrQkFBQSxpQkFBQSxLQUFBLGlCQUFBLHNCQUFBLEtBQUEsc0JBQUEsV0FBQSxLQUFBLFdBQUEsYUFBQSxFQUFBLGNBQUEsS0FBQSxlQUFBLE9BQUEsT0FBQSxVQUFBLFNBQUEsQ0FBQSxVQUFBLFNBQUEsRUFBQSxDQUFBLE1BQUEsQ0FBQSxTQUFBLElBQUEsS0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsUUFBQSxRQUFBLEVBQUEsTUFBQSxFQUFBLFFBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLFVBQUEsT0FBQSxFQUFBLGNBQUEsRUFBQSxjQUFBLE1BQUEsVUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLElBQUEsQ0FBQSxNQUFBLEVBQUEsWUFBQSxFQUFBLGtCQUFBLFNBQUEsRUFBQSxPQUFBLEVBQUEsYUFBQSxRQUFBLE1BQUEsRUFBQSxLQUFBLFdBQUEsVUFBQSxDQUFBLEVBQUEsSUFBQSxVQUFBLElBQUEsQ0FBQSxVQUFBLFNBQUEsRUFBQSxRQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxPQUFBLEVBQUEsaUJBQUEsS0FBQSxFQUFBLGlCQUFBLEVBQUEsRUFBQSxDQUFBLEdBQUEsS0FBQSxFQUFBLFlBQUEsS0FBQSxFQUFBLEdBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxHQUFBLFlBQUEsRUFBQSxLQUFBLENBQUEsSUFBQSxFQUFBLE9BQUEsYUFBQSxFQUFBLE9BQUEsT0FBQSxFQUFBLFdBQUEsRUFBQSxFQUFBLGVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxPQUFBLE9BQUEsYUFBQSxFQUFBLE9BQUEsY0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsT0FBQSxFQUFBLE9BQUEsS0FBQSxPQUFBLEVBQUEsT0FBQSxLQUFBLEtBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsR0FBQSxPQUFBLEVBQUEsVUFBQSxFQUFBLEtBQUEsU0FBQSxFQUFBLFFBQUEsRUFBQSxLQUFBLE9BQUEsRUFBQSxTQUFBLEVBQUEsS0FBQSxRQUFBLEVBQUEsU0FBQSxFQUFBLEtBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsT0FBQSxFQUFBLGVBQUEsS0FBQSxFQUFBLGlCQUFBLEtBQUEsRUFBQSxZQUFBLENBQUEsR0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE9BQUEsRUFBQSxnQkFBQSxLQUFBLEVBQUEsa0JBQUEsS0FBQSxFQUFBLGFBQUEsQ0FBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsTUFBQSxTQUFBLEdBQUEsUUFBQSxHQUFBLE9BQUEsR0FBQSxRQUFBLEVBQUEsU0FBQSxHQUFBLENBQUEsR0FBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsSUFBQSxJQUFBLEtBQUEsRUFBQSxFQUFBLElBQUEsSUFBQSxHQUFBLEVBQUEsZUFBQSxLQUFBLEVBQUEsRUFBQSxJQUFBLEdBQUEsT0FBQSxFQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLE9BQUEsSUFBQSxFQUFBLElBQUEsR0FBQSxVQUFBLFlBQUEsWUFBQSxHQUFBLEVBQUEsU0FBQSxFQUFBLFdBQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE1BQUEsTUFBQSxFQUFBLENBQUEsTUFBQSxFQUFBLEVBQUEsUUFBQSxTQUFBLFNBQUEsRUFBQSxNQUFBLE1BQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLElBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUEsRUFBQSxFQUFBLElBQUEsR0FBQSxZQUFBLEdBQUEsRUFBQSxLQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsS0FBQSxVQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUEsR0FBQSxPQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxDQUFBLElBQUEsRUFBQSxVQUFBLEVBQUEsT0FBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxPQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxFQUFBLEVBQUEsV0FBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsR0FBQSxJQUFBLEVBQUEsRUFBQSxDQUFBLEVBQUEsSUFBQSxLQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLElBQUEsRUFBQSxDQUFBLEdBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxLQUFBLEdBQUEsQ0FBQSxFQUFBLFdBQUEsR0FBQSxNQUFBLEdBQUEsSUFBQSxTQUFBLEdBQUEsRUFBQSxLQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsV0FBQSxHQUFBLE9BQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLFdBQUEsR0FBQSxHQUFBLENBQUEsR0FBQSxDQUFBLEVBQUEsS0FBQSxFQUFBLEVBQUEsTUFBQSxFQUFBLFFBQUEsR0FBQSxFQUFBLFNBQUEsWUFBQSxHQUFBLENBQUEsRUFBQSxTQUFBLENBQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLFlBQUEsQ0FBQSxJQUFBLEVBQUEsQ0FBQSxHQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQSxDQUFBLEdBQUEsSUFBQSxFQUFBLFdBQUEsR0FBQSxPQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUEsR0FBQSxPQUFBLEVBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLGFBQUEsRUFBQSxFQUFBLFFBQUEsRUFBQSxXQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsS0FBQSxDQUFBLElBQUEsRUFBQSxHQUFBLEVBQUEsSUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLFVBQUEsT0FBQSxFQUFBLFFBQUEsRUFBQSxNQUFBLEVBQUEsU0FBQSxJQUFBLEVBQUEsRUFBQSxHQUFBLEdBQUEsRUFBQSxNQUFBLFNBQUEsRUFBQSxNQUFBLElBQUEsRUFBQSxLQUFBLEVBQUEsQ0FBQSxHQUFBLEtBQUEsRUFBQSxVQUFBLEVBQUEsRUFBQSxHQUFBLEdBQUEsU0FBQSxHQUFBLENBQUEsYUFBQSxHQUFBLEVBQUEsV0FBQSxFQUFBLEtBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE9BQUEsVUFBQSxDQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxLQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxVQUFBLElBQUEsRUFBQSxFQUFBLElBQUEsV0FBQSxFQUFBLElBQUEsRUFBQSxHQUFBLEVBQUEsSUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsRUFBQSxJQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLEVBQUEsSUFBQSxRQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLElBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLEVBQUEsV0FBQSxFQUFBLElBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxRQUFBLE9BQUEsS0FBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLE1BQUEsS0FBQSxPQUFBLEVBQUEsT0FBQSxFQUFBLEtBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxXQUFBLEVBQUEsS0FBQSxFQUFBLFdBQUEsRUFBQSxNQUFBLEdBQUEsRUFBQSxFQUFBLElBQUEsRUFBQSxVQUFBLENBQUEsS0FBQSxFQUFBLFFBQUEsRUFBQSxFQUFBLEdBQUEsS0FBQSxFQUFBLFdBQUEsRUFBQSxLQUFBLEVBQUEsVUFBQSxRQUFBLENBQUEsU0FBQSxFQUFBLFVBQUEsRUFBQSxVQUFBLE9BQUEsRUFBQSxPQUFBLElBQUEsRUFBQSxNQUFBLEVBQUEsTUFBQSxLQUFBLElBQUEsRUFBQSxLQUFBLEdBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxhQUFBLEdBQUEsT0FBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLFdBQUEsR0FBQSxFQUFBLFdBQUEsR0FBQSxJQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsV0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsTUFBQSxFQUFBLEtBQUEsSUFBQSxFQUFBLEVBQUEsR0FBQSxRQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxJQUFBLENBQUEsR0FBQSxFQUFBLEdBQUEsT0FBQSxFQUFBLFNBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsS0FBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLEdBQUEsTUFBQSxFQUFBLEdBQUEsVUFBQSxHQUFBLEVBQUEsRUFBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLEdBQUEsT0FBQSxJQUFBLEVBQUEsWUFBQSxFQUFBLE1BQUEsRUFBQSxFQUFBLE1BQUEsR0FBQSxFQUFBLElBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxHQUFBLFdBQUEsRUFBQSxNQUFBLEVBQUEsY0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxXQUFBLEdBQUEsRUFBQSxFQUFBLFVBQUEsR0FBQSxFQUFBLEVBQUEsUUFBQSxHQUFBLElBQUEsSUFBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLFlBQUEsRUFBQSxNQUFBLEdBQUEsUUFBQSxHQUFBLFFBQUEsR0FBQSxPQUFBLEdBQUEsTUFBQSxHQUFBLFdBQUEsR0FBQSxNQUFBLEdBQUEsUUFBQSxHQUFBLFNBQUEsR0FBQSxXQUFBLEdBQUEsTUFBQSxHQUFBLE9BQUEsR0FBQSxPQUFBLEdBQUEsS0FBQSxHQUFBLFFBQUEsR0FBQSxPQUFBLEdBQUEsTUFBQSxHQUFBLE1BQUEsR0FBQSxPQUFBLEdBQUEsT0FBQSxJQUFBLFFBQUEsRUFBQSxDQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLEtBQUEsSUFBQSxJQUFBLElBQUEsS0FBQSxFQUFBLENBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLEVBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxFQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxNQUFBLEVBQUEsQ0FBQSxPQUFBLE1BQUEsUUFBQSxPQUFBLFNBQUEsUUFBQSxPQUFBLE1BQUEsS0FBQSxJQUFBLElBQUEsdUJBQUEsS0FBQSxVQUFBLFVBQUEsT0FBQSxRQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsSUFBQSxHQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxVQUFBLEtBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxLQUFBLE9BQUEsRUFBQSxhQUFBLE1BQUEsRUFBQSxDQUFBLEdBQUEsRUFBQSxjQUFBLEtBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxHQUFBLEVBQUEsVUFBQSxPQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEtBQUEsT0FBQSxFQUFBLEtBQUEsS0FBQSxFQUFBLEVBQUEsVUFBQSxHQUFBLElBQUEsRUFBQSxVQUFBLFFBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsS0FBQSxPQUFBLEVBQUEsV0FBQSxFQUFBLElBQUEsSUFBQSxFQUFBLFdBQUEsRUFBQSxJQUFBLEdBQUEsR0FBQSxHQUFBLEdBQUEsRUFBQSxVQUFBLE1BQUEsVUFBQSxDQUFBLElBQUEsRUFBQSxLQUFBLE9BQUEsRUFBQSxXQUFBLEdBQUEsRUFBQSxXQUFBLEdBQUEsR0FBQSxFQUFBLFVBQUEsYUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxLQUFBLE1BQUEsQ0FBQSxJQUFBLEVBQUEsVUFBQSxLQUFBLFFBQUEsZUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLFFBQUEsQ0FBQSxFQUFBLFNBQUEsRUFBQSxTQUFBLFVBQUEsRUFBQSxTQUFBLFlBQUEsRUFBQSxTQUFBLEVBQUEsbUJBQUEsRUFBQSxVQUFBLFVBQUEsVUFBQSxDQUFBLElBQUEsRUFBQSxLQUFBLE9BQUEsRUFBQSxXQUFBLE1BQUEsRUFBQSxZQUFBLEVBQUEsS0FBQSxVQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsR0FBQSxJQUFBLElBQUEsS0FBQSxFQUFBLE1BQUEsRUFBQSxPQUFBLEtBQUEsRUFBQSxHQUFBLFNBQUEsRUFBQSxDQUFBLE9BQUEsVUFBQSxDQUFBLE9BQUEsRUFBQSxHQUFBLE1BQUEsRUFBQSxhQUFBLEtBQUEsRUFBQSxPQUFBLEVBQUEsVUFBQSxFQUFBLGFBQUEsT0FBQSxRQUFBLE9BQUEsVUFBQSxPQUFBLFFBQUEsR0FBQSxZQUFBLE9BQUEsUUFBQSxPQUFBLEtBQUEsT0FBQSxVQUFBLENBQUEsT0FBQSxLQUFBLE9BQUE7QUNOQSxJQUFBLENBQUEsT0FBQSxVQUFBLFVBQUE7SUFDQSxPQUFBLFVBQUEsV0FBQSxTQUFBLFFBQUEsT0FBQTtRQUNBO1FBQ0EsSUFBQSxPQUFBLFVBQUEsVUFBQTtZQUNBLFFBQUE7OztRQUdBLElBQUEsUUFBQSxPQUFBLFNBQUEsS0FBQSxRQUFBO1lBQ0EsT0FBQTtlQUNBO1lBQ0EsT0FBQSxLQUFBLFFBQUEsUUFBQSxXQUFBLENBQUE7Ozs7QUNWQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxvQkFBQSxVQUFBLFVBQUE7UUFDQSxTQUFBLFVBQUEsZ0JBQUEsUUFBQSxLQUFBLElBQUE7UUFDQSxzREFBQSxVQUFBLGNBQUEsYUFBQSxnQkFBQTs7UUFFQSxJQUFBLFVBQUEsVUFBQSxLQUFBO1lBQ0EsSUFBQSxVQUFBLElBQUE7WUFDQSxRQUFBLEtBQUEsT0FBQSxLQUFBO1lBQ0EsUUFBQSxLQUFBO1lBQ0EsT0FBQSxDQUFBLFFBQUEsUUFBQSxRQUFBLFVBQUE7OztRQUdBLElBQUEsZUFBQSxVQUFBLEtBQUE7WUFDQSxJQUFBLE1BQUE7O1lBRUEsSUFBQSxPQUFBLElBQUEsTUFBQSxLQUFBLFNBQUEsR0FBQTtnQkFDQSxJQUFBLE1BQUEsS0FBQSxHQUFBLE1BQUEsS0FBQSxRQUFBLFVBQUEsTUFBQTtvQkFDQSxJQUFBLElBQUEsS0FBQSxNQUFBO3dCQUNBLElBQUEsRUFBQTt3QkFDQSxJQUFBLEVBQUEsTUFBQSxtQkFBQSxFQUFBO29CQUNBLENBQUEsS0FBQSxPQUFBLElBQUEsR0FBQSxLQUFBLEtBQUEsSUFBQSxLQUFBLENBQUE7Ozs7WUFJQSxPQUFBOzs7O1FBSUEsSUFBQSxxQkFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLEtBQUEsWUFBQSxtQkFBQTtRQUNBLGFBQUEsUUFBQSxvQkFBQSxRQUFBLFlBQUE7WUFDQSxJQUFBLFVBQUEsS0FBQSxNQUFBLFFBQUEsZ0NBQUE7Z0JBQ0EsWUFBQSxPQUFBLE1BQUEsU0FBQSxHQUFBLEtBQUEsUUFBQSxLQUFBO2dCQUNBLFVBQUEsT0FBQSxNQUFBLElBQUEsR0FBQSxLQUFBLFFBQUEsS0FBQTtnQkFDQSxXQUFBLE9BQUEsSUFBQSxTQUFBLEtBQUEsT0FBQSxJQUFBLFlBQUE7Z0JBQ0EsV0FBQTtnQkFDQSxTQUFBO2dCQUNBLFVBQUE7O1lBRUEsRUFBQSxRQUFBLFFBQUEsU0FBQSxVQUFBLFFBQUE7Z0JBQ0EsU0FBQTs7Z0JBRUEsS0FBQSxJQUFBLElBQUEsR0FBQSxJQUFBLFVBQUEsS0FBQTtvQkFDQSxXQUFBLE9BQUEsSUFBQSxXQUFBLElBQUEsR0FBQSxLQUFBO29CQUNBLE9BQUEsS0FBQTt3QkFDQSxNQUFBO3dCQUNBLE9BQUEsS0FBQSxNQUFBLEtBQUEsWUFBQSxNQUFBLElBQUEsTUFBQTt3QkFDQSxNQUFBLEtBQUEsTUFBQSxLQUFBLFlBQUEsWUFBQSxVQUFBLE1BQUE7Ozs7Z0JBSUEsUUFBQSxLQUFBO29CQUNBLFFBQUE7b0JBQ0EsYUFBQSxPQUFBLE1BQUEsUUFBQSxLQUFBO29CQUNBLE9BQUE7b0JBQ0EsTUFBQTtvQkFDQSxRQUFBOzs7O1lBSUEsSUFBQSxPQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsTUFBQTtnQkFDQSxVQUFBO2dCQUNBLFNBQUE7OztZQUdBLE9BQUEsQ0FBQSxLQUFBLE1BQUE7Ozs7UUFJQSxJQUFBLHFCQUFBO1FBQ0EsSUFBQSxlQUFBLElBQUEsT0FBQSxNQUFBLFlBQUEsS0FBQSxZQUFBLFlBQUE7UUFDQSxhQUFBLFFBQUEsY0FBQSxRQUFBLFVBQUEsUUFBQSxLQUFBO1lBQ0EsSUFBQSxZQUFBLGFBQUE7Z0JBQ0EsWUFBQSxRQUFBO2dCQUNBLFVBQUEsS0FBQSxNQUFBLFVBQUE7O1lBRUEsSUFBQSxVQUFBLFNBQUEsVUFBQSxNQUFBLFNBQUEsR0FBQTtnQkFDQSxJQUFBLFNBQUE7b0JBQ0EsU0FBQTtnQkFDQSxFQUFBLFFBQUEsVUFBQSxPQUFBLFVBQUEsR0FBQTtvQkFDQSxJQUFBLFFBQUEsRUFBQSxPQUFBLE9BQUEsTUFBQSxTQUFBO3dCQUNBLFFBQUEsVUFBQSxTQUFBLFVBQUEsTUFBQSxHQUFBLFVBQUEsS0FBQSxVQUFBLE1BQUE7O29CQUVBLE9BQUEsS0FBQTtvQkFDQSxPQUFBLEtBQUE7OztnQkFHQSxRQUFBLFVBQUEsRUFBQSxZQUFBLFFBQUEsU0FBQSxRQUFBOzs7WUFHQSxJQUFBLFVBQUEsUUFBQSxVQUFBLEtBQUEsU0FBQSxHQUFBO2dCQUNBLElBQUEsT0FBQSxTQUFBLFVBQUEsS0FBQTtvQkFDQSxXQUFBLFNBQUEsVUFBQSxVQUFBOztnQkFFQSxJQUFBLFNBQUEsR0FBQTtvQkFDQSxRQUFBLFVBQUEsRUFBQSxLQUFBLFFBQUEsU0FBQTt1QkFDQTtvQkFDQSxJQUFBLFdBQUEsQ0FBQSxPQUFBLEtBQUE7d0JBQ0EsV0FBQTs7b0JBRUEsS0FBQSxJQUFBLElBQUEsVUFBQSxJQUFBLFFBQUEsUUFBQSxTQUFBLEdBQUEsS0FBQTt3QkFDQSxTQUFBLEtBQUE7OztvQkFHQSxRQUFBLFVBQUEsRUFBQSxHQUFBLFFBQUEsU0FBQTs7OztZQUlBLElBQUEsVUFBQSxRQUFBO2dCQUNBLFFBQUEsVUFBQSxFQUFBLE9BQUEsUUFBQSxTQUFBLFVBQUEsUUFBQTtvQkFDQSxPQUFBLE9BQUEsV0FBQSxVQUFBLE9BQUE7Ozs7WUFJQSxVQUFBLEtBQUEsS0FBQSxVQUFBOztZQUVBLE9BQUE7Ozs7UUFJQSxJQUFBLDJCQUFBO1FBQ0EsSUFBQSxxQkFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLEtBQUEsWUFBQSxlQUFBO1FBQ0EsYUFBQSxRQUFBLG9CQUFBLFFBQUEsVUFBQSxRQUFBLEtBQUE7Ozs7O1lBS0EsT0FBQSxRQUFBOzs7O1FBSUEsSUFBQSxxQkFBQTtRQUNBLElBQUEsZUFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLEtBQUEsWUFBQSxZQUFBO1FBQ0EsYUFBQSxRQUFBLGNBQUEsUUFBQSxVQUFBLFFBQUEsS0FBQTs7WUFFQSxJQUFBLFlBQUEsYUFBQTtnQkFDQSxZQUFBLFFBQUE7Z0JBQ0EsVUFBQSxLQUFBLE1BQUEsVUFBQTs7WUFFQSxJQUFBLFVBQUEsYUFBQSxVQUFBLFVBQUEsU0FBQSxHQUFBO2dCQUNBLElBQUEsU0FBQSxDQUFBO29CQUNBLFNBQUEsQ0FBQTs7Z0JBRUEsUUFBQSxVQUFBLEVBQUEsT0FBQSxRQUFBLFNBQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsRUFBQSxVQUFBLGNBQUEsU0FBQSxVQUFBLFVBQUEsR0FBQTs7O2dCQUdBLFFBQUEsVUFBQSxFQUFBLFlBQUEsUUFBQSxTQUFBLFFBQUE7OztZQUdBLFVBQUEsS0FBQSxLQUFBLFVBQUE7O1lBRUEsT0FBQTs7OztRQUlBLElBQUEsZUFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLEtBQUEsWUFBQSxTQUFBO1FBQ0EsYUFBQSxRQUFBLGNBQUEsUUFBQSxZQUFBO1lBQ0EsSUFBQSxXQUFBLE9BQUEsTUFBQSxNQUFBLEtBQUEsS0FBQSxPQUFBLE1BQUEsU0FBQSxHQUFBLEtBQUEsUUFBQSxNQUFBO1lBQ0EsSUFBQSxZQUFBLE9BQUEsTUFBQSxTQUFBLEdBQUEsS0FBQSxRQUFBO1lBQ0EsSUFBQSxPQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsTUFBQTtn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LE1BQUEsVUFBQTs7WUFFQSxJQUFBLFVBQUEsU0FBQSxVQUFBLE1BQUEsU0FBQSxHQUFBO2dCQUNBLElBQUEsU0FBQTtvQkFDQSxTQUFBO2dCQUNBLEVBQUEsUUFBQSxVQUFBLE9BQUEsVUFBQSxHQUFBO29CQUNBLElBQUEsUUFBQSxFQUFBLE9BQUEsT0FBQSxNQUFBLFNBQUE7d0JBQ0EsUUFBQSxVQUFBLFNBQUEsVUFBQSxNQUFBLEdBQUEsVUFBQSxLQUFBLFVBQUEsTUFBQTs7b0JBRUEsT0FBQSxLQUFBO29CQUNBLE9BQUEsS0FBQTs7O2dCQUdBLFNBQUEsVUFBQSxFQUFBLFlBQUEsU0FBQSxTQUFBLFFBQUE7OztZQUdBLFVBQUEsS0FBQSxLQUFBLFVBQUE7O1lBRUEsT0FBQTs7OztRQUlBLElBQUEsOEJBQUE7UUFDQSxJQUFBLHVCQUFBLElBQUEsT0FBQSxNQUFBLFlBQUEsS0FBQSxZQUFBLDJCQUFBO1FBQ0EsYUFBQSxRQUFBLHNCQUFBLFFBQUEsWUFBQTtZQUNBLE9BQUEsUUFBQTs7Ozs7O1FBTUEsSUFBQSx1QkFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLEtBQUEsWUFBQSxpQkFBQTtRQUNBLGFBQUEsUUFBQSxzQkFBQSxRQUFBLFVBQUEsUUFBQSxLQUFBO1lBQ0EsSUFBQSxZQUFBLGFBQUE7Z0JBQ0EsU0FBQTs7WUFFQSxJQUFBLFlBQUE7Z0JBQ0EsT0FBQTtnQkFDQSxNQUFBO2dCQUNBLFVBQUE7Z0JBQ0EsU0FBQTs7O1lBR0EsSUFBQSxVQUFBLE9BQUEsSUFBQSxVQUFBLE1BQUEsSUFBQSxLQUFBLE9BQUEsSUFBQSxVQUFBLFFBQUEsS0FBQSxPQUFBOztZQUVBLEVBQUEsUUFBQSxVQUFBLFFBQUEsVUFBQSxRQUFBO2dCQUNBLElBQUEsWUFBQSxXQUFBLGdCQUFBLE9BQUE7Z0JBQ0EsSUFBQSxZQUFBLFdBQUEsZ0JBQUEsTUFBQTtnQkFDQSxJQUFBLGVBQUE7b0JBQ0EsUUFBQSxFQUFBLE9BQUEsRUFBQSxVQUFBO29CQUNBLE9BQUEsT0FBQSxJQUFBLFVBQUEsUUFBQSxJQUFBLE9BQUE7b0JB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ZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcsIFtcbiAgICAgICAgJ3NjYWxlQ29uZmlnTW9kdWxlJyxcbiAgICAgICAgJ25nUmVzb3VyY2UnLFxuICAgICAgICAnbmdTYW5pdGl6ZScsXG4gICAgICAgICduZ1JvdXRlJyxcbiAgICAgICAgJ2VtZ3VvLnBvbGxlcicsXG4gICAgICAgICd1aS5ib290c3RyYXAnLFxuICAgICAgICAndWkuZ3JpZCcsXG4gICAgICAgICd1aS5ncmlkLnNlbGVjdGlvbicsXG4gICAgICAgICd1aS5ncmlkLnBhZ2luYXRpb24nLFxuICAgICAgICAndWkuZ3JpZC5yZXNpemVDb2x1bW5zJyxcbiAgICAgICAgJ2NmcC5ob3RrZXlzJyxcbiAgICAgICAgJ3RvZ2dsZS1zd2l0Y2gnXG4gICAgXSk7XG5cbiAgICBhcHAuY29uZmlnKGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyLCAkcmVzb3VyY2VQcm92aWRlciwgJHByb3ZpZGUsIHBvbGxlckNvbmZpZykge1xuICAgICAgICAvLyBGaXggc291cmNlbWFwc1xuICAgICAgICAvLyBAdXJsIGh0dHBzOi8vZ2l0aHViLmNvbS9hbmd1bGFyL2FuZ3VsYXIuanMvaXNzdWVzLzUyMTcjaXNzdWVjb21tZW50LTUwOTkzNTEzXG4gICAgICAgICRwcm92aWRlLmRlY29yYXRvcignJGV4Y2VwdGlvbkhhbmRsZXInLCBmdW5jdGlvbiAoJGRlbGVnYXRlKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGV4Y2VwdGlvbiwgY2F1c2UpIHtcbiAgICAgICAgICAgICAgICAkZGVsZWdhdGUoZXhjZXB0aW9uLCBjYXVzZSk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXhjZXB0aW9uO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gc3RvcCBwb2xsZXJzIHdoZW4gcm91dGUgY2hhbmdlc1xuICAgICAgICBwb2xsZXJDb25maWcuc3RvcE9uUm91dGVDaGFuZ2UgPSB0cnVlO1xuICAgICAgICBwb2xsZXJDb25maWcuc21hcnQgPSB0cnVlO1xuXG4gICAgICAgIC8vIHByZXNlcnZlIHRyYWlsaW5nIHNsYXNoZXNcbiAgICAgICAgJHJlc291cmNlUHJvdmlkZXIuZGVmYXVsdHMuc3RyaXBUcmFpbGluZ1NsYXNoZXMgPSBmYWxzZTtcblxuICAgICAgICAvL3JvdXRpbmdcbiAgICAgICAgJHJvdXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC53aGVuKCcvJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdvdkNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvb3ZlcnZpZXcvcGFydGlhbHMvb3ZUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvYWRtaW4vbG9naW4nLHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnYWRtaW5Mb2dpbkNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9hZG1pbi9wYXJ0aWFscy9hZG1pbkxvZ2luVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2FkbWluL2xvZ291dCcse1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdsb2dvdXRDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvYWRtaW4vcGFydGlhbHMvYWRtaW5Mb2dpblRlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9hYm91dCcsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnYWJvdXRDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2Fib3V0L3BhcnRpYWxzL2Fib3V0VGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2ZlZWQnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2ZlZWREZXRhaWxzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9mZWVkL3BhcnRpYWxzL2ZlZWREZXRhaWxzVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICAgICAgcmVsb2FkT25TZWFyY2g6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9mZWVkL2luZ2VzdHMnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2luZ2VzdFJlY29yZHNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2ZlZWQvcGFydGlhbHMvaW5nZXN0UmVjb3Jkc1RlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvZmVlZC9pbmdlc3RzLzppZCcsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnaW5nZXN0UmVjb3JkRGV0YWlsc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvZmVlZC9wYXJ0aWFscy9pbmdlc3RSZWNvcmREZXRhaWxzVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL21ldHJpY3MnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ21ldHJpY3NDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL21ldHJpY3MvcGFydGlhbHMvbWV0cmljc1RlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvbm9kZXMnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ25vZGVzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9ub2Rlcy9wYXJ0aWFscy9ub2Rlc1RlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9ub2Rlcy86aWQnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ25vZGVEZXRhaWxzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9ub2Rlcy9wYXJ0aWFscy9ub2RlRGV0YWlsc1RlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9sb2FkL3F1ZXVlZCcsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnbG9hZENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvbG9hZC9wYXJ0aWFscy9sb2FkVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2xvYWQvcnVubmluZycsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAncXVldWVSdW5uaW5nQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9sb2FkL3BhcnRpYWxzL3F1ZXVlUnVubmluZ1RlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9sb2FkL2RlcHRoJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdsb2FkRGVwdGhDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2xvYWQvcGFydGlhbHMvbG9hZERlcHRoVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL3JlY2lwZXMnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3JlY2lwZXNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL3JlY2lwZXMvcGFydGlhbHMvcmVjaXBlc1RlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvcmVjaXBlcy9yZWNpcGUvOmlkJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdyZWNpcGVEZXRhaWxzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9yZWNpcGVzL3BhcnRpYWxzL3JlY2lwZURldGFpbHNUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvcmVjaXBlcy90eXBlcy86aWQ/Jywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdyZWNpcGVUeXBlc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvcmVjaXBlcy9wYXJ0aWFscy9yZWNpcGVUeXBlc1RlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9qb2JzJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdqb2JzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9qb2JzL3BhcnRpYWxzL2pvYnNUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMvam9iLzppZCcsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnam9iRGV0YWlsQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9qb2JzL3BhcnRpYWxzL2pvYkRldGFpbFRlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9qb2JzL3R5cGVzLzppZD8nLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2pvYlR5cGVzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9qb2JzL3BhcnRpYWxzL2pvYlR5cGVzVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMvZmFpbHVyZS1yYXRlcycsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnam9iVHlwZXNGYWlsdXJlUmF0ZXNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2pvYnMvcGFydGlhbHMvam9iVHlwZXNGYWlsdXJlUmF0ZXNUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMvZXhlY3V0aW9ucycsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnam9iRXhlY3V0aW9uc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvam9icy9wYXJ0aWFscy9qb2JFeGVjdXRpb25zVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMvZXhlY3V0aW9ucy86aWQnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2pvYkV4ZWN1dGlvbkRldGFpbENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvam9icy9wYXJ0aWFscy9qb2JFeGVjdXRpb25EZXRhaWxUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvd29ya3NwYWNlcy86aWQ/Jywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICd3b3Jrc3BhY2VzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy93b3Jrc3BhY2VzL3BhcnRpYWxzL3dvcmtzcGFjZXNUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vdGhlcndpc2Uoe1xuICAgICAgICAgICAgICAgIHJlZGlyZWN0VG86ICcvJ1xuICAgICAgICAgICAgfSk7XG4gICAgfSlcbiAgICAudmFsdWUoJ21vbWVudCcsIHdpbmRvdy5tb21lbnQpXG4gICAgLnZhbHVlKCdsb2NhbFN0b3JhZ2UnLCB3aW5kb3cubG9jYWxTdG9yYWdlKVxuICAgIC52YWx1ZSgnWE1MSHR0cFJlcXVlc3QnLCB3aW5kb3cuWE1MSHR0cFJlcXVlc3QpXG4gICAgLnZhbHVlKCd0b2FzdHInLCB3aW5kb3cudG9hc3RyKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUNvbmZpZ01vZHVsZScsIFtdKS5wcm92aWRlcignc2NhbGVDb25maWcnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzY2FsZUNvbmZpZyA9IHt9LFxuICAgICAgICAgICAgc2NhbGVDb25maWdMb2NhbCA9IHt9O1xuXG4gICAgICAgIHRoaXMuJGdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgICAgICAgICAgIHVybDogJ2NvbmZpZy9zY2FsZUNvbmZpZy5qc29uJyxcbiAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChjb25maWcuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICBzY2FsZUNvbmZpZyA9IGNvbmZpZy5yZXNwb25zZUpTT04uc2NhbGVDb25maWc7XG5cbiAgICAgICAgICAgICAgICB2YXIgY29uZmlnTG9jYWwgPSAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnY29uZmlnL3NjYWxlQ29uZmlnLmxvY2FsLmpzb24nLFxuICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ0xvY2FsLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjYWxlQ29uZmlnTG9jYWwgPSBjb25maWdMb2NhbC5yZXNwb25zZUpTT04uc2NhbGVDb25maWdMb2NhbDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBfLm1lcmdlKHNjYWxlQ29uZmlnLCBzY2FsZUNvbmZpZ0xvY2FsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHNjYWxlQ29uZmlnO1xuICAgICAgICB9XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhaXNIZWFkZXJDb250cm9sbGVyJywgZnVuY3Rpb24oc3VibmF2U2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5jdXJyZW50UGF0aCA9IHN1Ym5hdlNlcnZpY2UuZ2V0Q3VycmVudFBhdGgoKTtcbiAgICB9KVxuICAgIC5kaXJlY3RpdmUoJ2Fpc0hlYWRlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVzYWdlOiA8YWlzLWhlYWRlciBuYW1lPXtuYW1lfT48L2Fpcy1oZWFkZXI+XG4gICAgICAgICAqL1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fpc0hlYWRlckNvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9oZWFkZXIvaGVhZGVyVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIG5hbWU6ICc9JyxcbiAgICAgICAgICAgICAgICBoaWRlVGl0bGU6ICc9JyxcbiAgICAgICAgICAgICAgICBsb2FkaW5nOiAnPScsIC8vIG9wdGlvbmFsIC0gd2lsbCBvdmVybGF5IGEgbG9hZGluZyBzcGlubmVyIG9uIHRoZSBwYWdlIGJhc2VkIG9uIHRoZSBwYXNzZWQtaW4gdmFsdWVcbiAgICAgICAgICAgICAgICBzaG93U3VibmF2OiAnPScsXG4gICAgICAgICAgICAgICAgc3VibmF2TGlua3M6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5kaXJlY3RpdmUoJ3NjYWxlTmF2aWdhdGlvbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvbmF2aWdhdGlvbi9wYXJ0aWFscy9uYXZUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICduYXZDb250cm9sbGVyJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWJvdXRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sIG5hdlNlcnZpY2UsIHN0YXRlU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0uc3RhdGVTZXJ2aWNlID0gc3RhdGVTZXJ2aWNlO1xuICAgICAgICB2bS52ZXJzaW9uID0gJyc7XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2Fib3V0Jyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnN0YXRlU2VydmljZS5nZXRWZXJzaW9uKCknLCBmdW5jdGlvbiAobmV3VmFsdWUpIHtcbiAgICAgICAgICAgIHZtLnZlcnNpb24gPSBuZXdWYWx1ZTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhZG1pbkxvZ2luQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkdGltZW91dCwgJGxvY2F0aW9uLCBzdGF0ZVNlcnZpY2UsIHVzZXJTZXJ2aWNlKSB7XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJDcmVkcygpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgICAgICAgICB1c2VyU2VydmljZS5sb2dpbignYWRtaW4nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vIEFueSBjb2RlIGluIGhlcmUgd2lsbCBhdXRvbWF0aWNhbGx5IGhhdmUgYW4gJHNjb3BlLmFwcGx5KCkgcnVuIGFmdGVyd2FyZHNcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2xvZ291dENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHRpbWVvdXQsICRyb290U2NvcGUsICRsb2NhdGlvbiwgdXNlclNlcnZpY2UpIHtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHVzZXJTZXJ2aWNlLmxvZ291dCgpO1xuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAvLyBBbnkgY29kZSBpbiBoZXJlIHdpbGwgYXV0b21hdGljYWxseSBoYXZlIGFuICRzY29wZS5hcHBseSgpIHJ1biBhZnRlcndhcmRzXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc0RhdGFGZWVkQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsIHNjYWxlQ29uZmlnLCBsb2FkU2VydmljZSwgc2NhbGVTZXJ2aWNlKSB7XG4gICAgICAgIHZhciBkYXlzID0gW10sXG4gICAgICAgICAgICBob3VycyA9IFswLDEsMiwzLDQsNSw2LDcsOCw5LDEwLDExLDEyLDEzLDE0LDE1LDE2LDE3LDE4LDE5LDIwLDIxLDIyLDIzXSxcbiAgICAgICAgICAgIHZhbHVlcyA9IHt9O1xuICAgICAgICBcbiAgICAgICAgdmFyIHByb2Nlc3NOZXdGZWVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZGF5cyA9IFtdO1xuICAgICAgICAgICAgdmFyIGRheSA9ICcnO1xuICAgICAgICAgICAgaWYgKCRzY29wZS5mZWVkKSB7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKCRzY29wZS5mZWVkLnZhbHVlcywgZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsZGF5ID0gbW9tZW50LnV0Yyh2YWwudGltZSkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWxob3VyID0gbW9tZW50LnV0Yyh2YWwudGltZSkuaG91cigpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaWQgPSB2YWxkYXkgKyAnXycgKyB2YWxob3VyO1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbaWRdID0gdmFsO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsZGF5ICE9PSBkYXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRheSA9IHZhbGRheTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRheXMucHVzaCh2YWxkYXkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnVpbGRUYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBidWlsZFRhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGN1cnJEYXkgPSBtb21lbnQoKS51dGMoKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5KTtcbiAgICAgICAgICAgIHZhciBjdXJySG91ciA9IG1vbWVudCgpLnV0YygpLmhvdXIoKTtcblxuICAgICAgICAgICAgdmFyIHRhYmxlX2h0bWwgPSAnPGRpdiBjbGFzcz1cInRhYmxlLXJlc3BvbnNpdmVcIj48dGFibGU+JztcbiAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzx0cj48dGg+SG91ciAoVVRDKTwvdGg+JztcbiAgICAgICAgICAgIGZvcihkYXkgaW4gZGF5cykge1xuICAgICAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzx0ZCBjbGFzcz1cImRheS1sYWJlbFwiIHRpdGxlPVwiJyArIGRheXNbZGF5XSArICdcIj48ZGl2IGNsYXNzPVwiZGF5LW9mLXdlZWtcIj4nICsgc2NhbGVTZXJ2aWNlLmdldERheVN0cmluZyhtb21lbnQoZGF5c1tkYXldKS5kYXkoKSkgKyAnPC9kaXY+JyArIG1vbWVudChkYXlzW2RheV0pLmZvcm1hdCgnTU0vREQnKSArICc8L3RkPic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0YWJsZV9odG1sICs9ICc8L3RyPic7XG4gICAgICAgICAgICBmb3IodmFyIGhvdXIgaW4gaG91cnMpIHtcbiAgICAgICAgICAgICAgICBob3VyID0gMjMtaG91cjtcbiAgICAgICAgICAgICAgICB0YWJsZV9odG1sICs9ICc8dHI+JztcbiAgICAgICAgICAgICAgICB0YWJsZV9odG1sICs9ICc8dGggdGl0bGU9XCInICsgaG91cnNbaG91cl0gKyAnOjAwXCI+JyArIGhvdXJzW2hvdXJdICsgJzwvdGg+JztcblxuICAgICAgICAgICAgICAgIGZvcih2YXIgZGF5IGluIGRheXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9ICBkYXlzW2RheV0gKyAnXycgKyBob3Vyc1tob3VyXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVzID0gdmFsdWVzW2tleV0uZmlsZXM7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzaXplID0gdmFsdWVzW2tleV0uc2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNscyA9ICdnb29kJztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRheXNbZGF5XSA9PT0gY3VyckRheSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhvdXJzW2hvdXJdID09PSBjdXJySG91cikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNscyA9ICdjdXJyZW50JztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGhvdXJzW2hvdXJdID4gY3VyckhvdXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbHMgPSAnZnV0dXJlJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZXMgPT09IDAgJiYgc2l6ZSA9PT0gMCAmJiBjbHMgIT09ICdjdXJyZW50JyAmJiBjbHMgIT09ICdmdXR1cmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbHMgPSAndW5rbm93bic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGFibGVfaHRtbCArPSAnPHRkIGlkPVwiJyArIGtleSArICdcIiB0aXRsZT1cIicgKyBkYXlzW2RheV0gKyAnICcgKyBob3Vyc1tob3VyXSArICc6MDBcIj4nO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2xzID09PSAnZnV0dXJlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVfaHRtbCArPSAnPHNwYW4gY2xhc3M9XCInICsgY2xzICsgJ1wiIGlkPVwic3Bhbl8nICsgZGF5c1tkYXldICsgJ18nICsgaG91cnNbaG91cl0gKyAnXCIgc3R5bGU9XCJkaXNwbGF5OiBibG9jaztcIj4mbmJzcDs8L3NwYW4+PC90ZD4nO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZV9odG1sICs9ICc8c3BhbiBjbGFzcz1cIicgKyBjbHMgKyAnXCIgaWQ9XCJzcGFuXycgKyBkYXlzW2RheV0gKyAnXycgKyBob3Vyc1tob3VyXSArICdcIiBzdHlsZT1cImRpc3BsYXk6IGJsb2NrO1wiPicgKyBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tQnl0ZXMoc2l6ZSwxKSArICcgLyAnICsgZmlsZXMgKyAnPC9zcGFuPjwvdGQ+JztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzwvdHI+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzwvdGFibGU+PC9kaXY+JztcbiAgICAgICAgICAgICQoJyNoaXN0b3J5JykuaHRtbCh0YWJsZV9odG1sKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnZmVlZCcsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZmVlZCkge1xuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzTmV3RmVlZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcbiAgICB9KS5kaXJlY3RpdmUoJ2Fpc0RhdGFGZWVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fpc0RhdGFGZWVkQ29udHJvbGxlcicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvY2hhcnRzL2RhdGFGZWVkL2RhdGFGZWVkVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBmZWVkOiAnPScgLy8gRmVlZCBkYXRhXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc0RvbnV0Q29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRlbGVtZW50LCBzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgY29sRGF0YSA9IFtdLFxuICAgICAgICAgICAgY2hhcnQgPSBudWxsO1xuXG4gICAgICAgIHZhciBnZW5DaGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChjaGFydCkge1xuICAgICAgICAgICAgICAgIHZhciBvbGREYXRhID0gW10sXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZUlkcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgLy8gcmVhc3NlbWJsZSBjdXJyZW50bHkgZGlzcGxheWVkIGRhdGEgdG8gbWF0Y2ggY29sRGF0YVxuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChjaGFydC5kYXRhKCksIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIG9sZERhdGEucHVzaChbZC52YWx1ZXNbMF0uaWQsIGQudmFsdWVzWzBdLnZhbHVlXSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBkZXRlcm1pbmUgd2hpY2ggZWxlbWVudHMgdG8gcmVtb3ZlXG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKG9sZERhdGEsIGZ1bmN0aW9uIChvZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIga2VlcCA9IF8uZmluZChjb2xEYXRhLCBmdW5jdGlvbiAoY2QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZFswXSA9PT0gb2RbMF07XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWtlZXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUlkcy5wdXNoKG9kWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gdXBkYXRlIGNoYXJ0XG4gICAgICAgICAgICAgICAgY2hhcnQubG9hZCh7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbnM6IGNvbERhdGEsXG4gICAgICAgICAgICAgICAgICAgIHVubG9hZDogcmVtb3ZlSWRzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNoYXJ0ID0gYzMuZ2VuZXJhdGUoe1xuICAgICAgICAgICAgICAgICAgICBiaW5kdG86ICRlbGVtZW50WzBdLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zOiBjb2xEYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJHNjb3BlLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb3duOiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfcmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmc6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF95ZWxsb3csXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXA6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9ncmVlbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb21wbGV0ZWQ6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9ncmVlbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEb25lOiAnIzM2ODFiZicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUXVldWU6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF95ZWxsb3csXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFpbGVkOiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfcmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFMR09SSVRITTogc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfYWxnb3JpdGhtLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIERBVEE6IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX2RhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU1lTVEVNOiBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9zeXN0ZW0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgT2ZmbGluZTogc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X3JlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnSGlnaCBGYWlsdXJlIFJhdGUnOiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfb3JhbmdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhdXNlZDogc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X3llbGxvd1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogNzAwXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHBpZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IGQzLmZvcm1hdCgnLCcpXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGRvbnV0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogJHNjb3BlLnNob3dMYWJlbCA/IGQzLmZvcm1hdCgnLCcpIDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAkc2NvcGUud2lkdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJHNjb3BlLm5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdG9vbHRpcDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGQzLmZvcm1hdCgnLCcpXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogJHNjb3BlLnNpemUgfHwgMzIwXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRlbGVtZW50WzBdLnN0eWxlLnBvc2l0aW9uID0gJ3N0YXRpYyc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRDb2x1bW5EYXRhID0gZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICBjb2xEYXRhID0gW107XG4gICAgICAgICAgICAkc2NvcGUuZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChvYmope1xuICAgICAgICAgICAgICAgIGNvbERhdGEucHVzaChbb2JqLnN0YXR1cyxvYmouY291bnRdKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaW5pdENvbHVtbkRhdGEoKTtcbiAgICAgICAgICAgIGdlbkNoYXJ0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQoJGVsZW1lbnRbMF0pLmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB3aW5kb3cub25yZXNpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBnZW5DaGFydCgpO1xuICAgICAgICB9XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5kaXJlY3RpdmUoJ2Fpc0RvbnV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fpc0RvbnV0Q29udHJvbGxlcicsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBkYXRhOiAnPScsXG4gICAgICAgICAgICAgICAgdHlwZTogJz0nLFxuICAgICAgICAgICAgICAgIHNpemU6ICc9JyxcbiAgICAgICAgICAgICAgICBzaG93TGFiZWw6ICc9JyxcbiAgICAgICAgICAgICAgICB3aWR0aDogJz0nLFxuICAgICAgICAgICAgICAgIG5hbWU6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWlzR3JpZENoYXJ0Q29udHJvbGxlcicsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRsb2NhdGlvbiwgJHVpYk1vZGFsLCB1c2VyU2VydmljZSwgc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgc3ZnID0gbnVsbCxcbiAgICAgICAgICAgIHJlY3QgPSBudWxsLFxuICAgICAgICAgICAgc2NhbGUgPSBwYXJzZUZsb2F0KCRzY29wZS5zY2FsZSksXG4gICAgICAgICAgICB0aXAgPSBkMy50aXAoKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdkMy10aXAnKVxuICAgICAgICAgICAgICAgIC5vZmZzZXQoWy0xMCwgMF0pXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBkLnN0YXR1cy5nZXRGYWlsdXJlcygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbFN0ciA9IGZhaWx1cmVzLmxlbmd0aCA+IDAgPyAnPGJyIC8+PGJyIC8+JyA6ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgcnVubmluZyA9IGdldENlbGxBY3Rpdml0eVRvdGFsKGQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gZ2V0Q2VsbFRvdGFsKGQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzU3RyID0gcnVubmluZyA+IDAgfHwgY29tcGxldGVkID4gMCA/ICc8YnIgLz4nIDogJyc7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJ1bm5pbmcgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNTdHIgPSBzdGF0dXNTdHIgKyAnPHNwYW4gY2xhc3M9XCJsYWJlbCBsYWJlbC1ydW5uaW5nXCI+UnVubmluZzogJyArIHJ1bm5pbmcgKyAnPC9zcGFuPic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBsZXRlZCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1N0ciA9IHN0YXR1c1N0ciArICcgPHNwYW4gY2xhc3M9XCJsYWJlbCBsYWJlbC1jb21wbGV0ZWRcIj5Db21wbGV0ZWQ6ICcgKyBjb21wbGV0ZWQgKyAnPC9zcGFuPic7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBmYWlsdXJlcyA9IF8uc29ydEJ5T3JkZXIoZmFpbHVyZXMsIFsnb3JkZXInXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGZhaWx1cmVzLCBmdW5jdGlvbiAoZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbFN0ciA9IGZhaWxTdHIgKyAnPHNwYW4gY2xhc3M9XCJsYWJlbCBsYWJlbC0nICsgZi5zdGF0dXMudG9Mb3dlckNhc2UoKSArICdcIj4nICsgXy5jYXBpdGFsaXplKGYuc3RhdHVzLnRvTG93ZXJDYXNlKCkpICsgJzogJyArIGYuY291bnQgKyAnPC9zcGFuPiAnO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQudGl0bGUgKyAnICcgKyBkLnZlcnNpb24gKyAnPGJyIC8+JyArIHN0YXR1c1N0ciArIGZhaWxTdHI7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBjZWxsV2lkdGggPSA1MCAqIHNjYWxlLFxuICAgICAgICAgICAgY2VsbEhlaWdodCA9IDUwICogc2NhbGUsXG4gICAgICAgICAgICBlbmFibGVab29tID0gdHlwZW9mICRzY29wZS5tb2RlICE9PSAndW5kZWZpbmVkJyA/ICRzY29wZS5tb2RlID09PSAnem9vbScgOiB0cnVlLFxuICAgICAgICAgICAgZW5hYmxlVG9vbHRpcCA9IHR5cGVvZiAkc2NvcGUubW9kZSAhPT0gJ3VuZGVmaW5lZCcgPyAkc2NvcGUubW9kZSA9PT0gJ3Rvb2x0aXAnIDogZmFsc2UsXG4gICAgICAgICAgICBlbmFibGVSZXZlYWwgPSB0eXBlb2YgJHNjb3BlLnJldmVhbCAhPT0gJ3VuZGVmaW5lZCcgPyAkc2NvcGUucmV2ZWFsIDogdHJ1ZSxcbiAgICAgICAgICAgIHVzZXIgPSB1c2VyU2VydmljZS5nZXRVc2VyQ3JlZHMoKSxcbiAgICAgICAgICAgIGdyaWREYXRhID0gW10sXG4gICAgICAgICAgICB3aWR0aCA9ICQoJy5ncmlkLWNoYXJ0Jykud2lkdGgoKSxcbiAgICAgICAgICAgIGhlaWdodCA9IChNYXRoLmNlaWwod2lkdGggLyBjZWxsV2lkdGgpICogY2VsbEhlaWdodCksXG4gICAgICAgICAgICBjb2xzID0gMCxcbiAgICAgICAgICAgIHJvd3MgPSAwLFxuICAgICAgICAgICAgY2VsbEZvbnRMZyA9IC40LFxuICAgICAgICAgICAgY2VsbEZvbnRTbSA9IC4zO1xuICAgICAgICBcbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLnBhdXNlUmVhc29uID0gJyc7XG4gICAgICAgIHZtLmRhdGFWYWx1ZXMgPSBbXTtcbiAgICAgICAgdm0uZ3JpZENsYXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZS5pY29ucyA9PT0gdHJ1ZSA/ICdpY29ucycgOiAnJztcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigndm0uZGF0YVZhbHVlcycsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaGVpZ2h0ID0gKE1hdGguY2VpbChuZXdWYWx1ZS5sZW5ndGggLyAoTWF0aC5mbG9vcih3aWR0aCAvIGNlbGxXaWR0aCkpKSAqIGNlbGxIZWlnaHQpO1xuICAgICAgICAgICAgaWYgKGVuYWJsZVpvb20pIHtcbiAgICAgICAgICAgICAgICBoZWlnaHQgPSBoZWlnaHQgKiA2O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZDMuc2VsZWN0KCcuZ3JpZC1jaGFydC1jb250YWluZXIgc3ZnJykuYXR0cignaGVpZ2h0JywgaGVpZ2h0KTtcbiAgICAgICAgICAgIGQzLnNlbGVjdCgnLm92ZXJsYXknKS5hdHRyKCdoZWlnaHQnLCBoZWlnaHQpO1xuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgZ2V0RGF0YVZhbHVlcyA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBncmlkRGF0YSA9IFtdO1xuICAgICAgICAgICAgdm0uZGF0YVZhbHVlcyA9IFtdO1xuICAgICAgICAgICAgaWYgKGRhdGEuZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhVHlwZSA9IGRhdGEuZGF0YS50b1N0cmluZygpLnNwbGl0KCcsJylbMF07XG4gICAgICAgICAgICAgICAgaWYgKGRhdGFUeXBlID09PSAnSm9iVHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uZGF0YVZhbHVlcyA9IF8uc29ydEJ5T3JkZXIoXy52YWx1ZXMoZGF0YS5kYXRhKSwgWyduYW1lJ10sIFsnYXNjJ10pO1xuICAgICAgICAgICAgICAgICAgICAvLyBhc3NvY2lhdGUgSm9iVHlwZSB3aXRoIEpvYlR5cGVTdGF0dXNcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmRhdGFWYWx1ZXMsIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbC5zdGF0dXMgPSBfLmZpbmQoZGF0YS5zdGF0dXMsICdqb2JfdHlwZS5pZCcsIHZhbC5pZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB2bS5kYXRhVmFsdWVzID0gXy5zb3J0QnlPcmRlcihfLnZhbHVlcyhkYXRhLmRhdGEpLCBbJ3N0YXR1cy5oYXNfcnVubmluZycsICdzdGF0dXMuZGVzY3JpcHRpb24nLCAnbmFtZSddLCBbJ2FzYycsICdhc2MnLCAnYXNjJ10pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YVR5cGUgPT09ICdOb2RlJykge1xuICAgICAgICAgICAgICAgICAgICB2bS5kYXRhVmFsdWVzID0gXy52YWx1ZXMoZGF0YS5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgLy92bS5kYXRhVmFsdWVzID0gXy5zb3J0QnlPcmRlcihfLnZhbHVlcyhkYXRhLmRhdGEpLCBbJ2hvc3RuYW1lJ10sIFsnYXNjJ10pO1xuICAgICAgICAgICAgICAgICAgICAvLyBhc3NvY2lhdGUgTm9kZSB3aXRoIE5vZGVTdGF0dXNcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmRhdGFWYWx1ZXMsIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbC5zdGF0dXMgPSBfLmZpbmQoZGF0YS5zdGF0dXMsICdub2RlLmlkJywgdmFsLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIC8vdm0uZGF0YVZhbHVlcyA9IF8uc29ydEJ5T3JkZXIodm0uZGF0YVZhbHVlcywgWydob3N0bmFtZSddLCBbJ2FzYyddKTsgLy8gc29ydCBieSBob3N0TmFtZSBhc2NcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2bS5kYXRhVmFsdWVzID0gZGF0YS5kYXRhO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbHMgPSAkc2NvcGUuY29sdW1ucyA/ICRzY29wZS5jb2x1bW5zIDogTWF0aC5mbG9vcih3aWR0aCAvIGNlbGxXaWR0aCk7XG4gICAgICAgICAgICAgICAgcm93cyA9ICRzY29wZS5yb3dzID8gJHNjb3BlLnJvd3MgOiBNYXRoLmNlaWwodm0uZGF0YVZhbHVlcy5sZW5ndGggLyBjb2xzKTtcblxuICAgICAgICAgICAgICAgIGQzLnJhbmdlKHJvd3MpLm1hcChmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgICAgICAgIGQzLnJhbmdlKGNvbHMpLm1hcChmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sIDw9IHZtLmRhdGFWYWx1ZXMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhT2JqID0gdm0uZGF0YVZhbHVlc1soY29scyAqIHJvdykgKyBjb2xdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhT2JqKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFPYmouY29vcmRzID0gW2NvbCAqIGNlbGxIZWlnaHQsIHJvdyAqIGNlbGxXaWR0aF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyaWREYXRhLnB1c2goZGF0YU9iaik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHVwZGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciByZXZlYWxEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZDMuc2VsZWN0QWxsKCcuY2VsbC10ZXh0JylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICAgICAgZDMuc2VsZWN0QWxsKCcuY2VsbC10ZXh0LWRldGFpbCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5jZWxsLXBhdXNlLXJlc3VtZS1pY29uJylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaGlkZURhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5jZWxsLXRleHQnKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICAgICAgZDMuc2VsZWN0QWxsKCcuY2VsbC10ZXh0LWRldGFpbCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgIGQzLnNlbGVjdEFsbCgnLmNlbGwtcGF1c2UtcmVzdW1lLWljb24nKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgY29scyA9ICRzY29wZS5jb2x1bW5zID8gJHNjb3BlLmNvbHVtbnMgOiBNYXRoLmZsb29yKHdpZHRoIC8gY2VsbFdpZHRoKTtcbiAgICAgICAgICAgIHJvd3MgPSAkc2NvcGUucm93cyA/ICRzY29wZS5yb3dzIDogTWF0aC5jZWlsKHZtLmRhdGFWYWx1ZXMubGVuZ3RoIC8gY29scyk7XG5cbiAgICAgICAgICAgIHZhciB0aWNrVmFsdWVzID0gQXJyYXkuYXBwbHkobnVsbCwge2xlbmd0aDogcm93c30pLm1hcChOdW1iZXIuY2FsbCwgTnVtYmVyKTtcblxuICAgICAgICAgICAgdmFyIHpvb20gPSBkMy5iZWhhdmlvci56b29tKClcbiAgICAgICAgICAgICAgICAuc2NhbGVFeHRlbnQoWzEsIDZdKVxuICAgICAgICAgICAgICAgIC8vLmNlbnRlcihbMCwgMF0pXG4gICAgICAgICAgICAgICAgLm9uKCd6b29tJywgem9vbWVkKTtcblxuICAgICAgICAgICAgaWYgKGVuYWJsZVpvb20pIHtcbiAgICAgICAgICAgICAgICBzdmcgPSBkMy5zZWxlY3QoJy5ncmlkLWNoYXJ0JykuYXBwZW5kKCdzdmcnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignd2lkdGgnLCB3aWR0aClcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2hlaWdodCcsIGhlaWdodClcbiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKHpvb20pXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJ2cnKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZW5hYmxlVG9vbHRpcCkge1xuICAgICAgICAgICAgICAgIHN2ZyA9IGQzLnNlbGVjdCgnLmdyaWQtY2hhcnQnKS5hcHBlbmQoJ3N2ZycpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHdpZHRoKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgaGVpZ2h0KVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCdnJylcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwodGlwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc3ZnID0gZDMuc2VsZWN0KCcuZ3JpZC1jaGFydCcpLmFwcGVuZCgnc3ZnJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgd2lkdGgpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCBoZWlnaHQpXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJ2cnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3ZnLmFwcGVuZCgncmVjdCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ292ZXJsYXknKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHdpZHRoKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCBoZWlnaHQpO1xuXG4gICAgICAgICAgICBpZiAodm0uc2hvd0F4ZXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgeSA9IGQzLnNjYWxlLmxpbmVhcigpXG4gICAgICAgICAgICAgICAgICAgIC5kb21haW4oWzAsIHJvd3NdKVxuICAgICAgICAgICAgICAgICAgICAucmFuZ2UoWzAsIGhlaWdodC0xMF0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHlBeGlzID0gZDMuc3ZnLmF4aXMoKVxuICAgICAgICAgICAgICAgICAgICAuc2NhbGUoeSlcbiAgICAgICAgICAgICAgICAgICAgLm9yaWVudCgnbGVmdCcpXG4gICAgICAgICAgICAgICAgICAgIC50aWNrVmFsdWVzKHRpY2tWYWx1ZXMpO1xuXG4gICAgICAgICAgICAgICAgc3ZnLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIDI1ICsgJywnICsgMCArICcpJylcbiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICd5IGF4aXMnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgMCArICcsJyArIGNlbGxIZWlnaHQgLyAyICsgJyknKVxuICAgICAgICAgICAgICAgICAgICAuY2FsbCh5QXhpcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGdldERhdGFWYWx1ZXMoZGF0YSk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHpvb21lZCgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcyA9IGQzLmV2ZW50LnNjYWxlO1xuXG4gICAgICAgICAgICAgICAgaWYgKGVuYWJsZVJldmVhbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocyA+IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldmVhbERhdGEoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpZGVEYXRhKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHMgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5zaG93QXhlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgem9vbS50cmFuc2xhdGUoWzI1LCAwXSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB6b29tLnRyYW5zbGF0ZShbMCwgMF0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN2Zy5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyB6b29tLnRyYW5zbGF0ZSgpICsgJylzY2FsZSgnICsgZDMuZXZlbnQuc2NhbGUgKyAnKScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGRyYWdPZmZzZXRYID0gMCxcbiAgICAgICAgICAgIGRyYWdPZmZzZXRZID0gMCxcbiAgICAgICAgICAgIGNsaWNrT2Zmc2V0WCA9IDAsXG4gICAgICAgICAgICBjbGlja09mZnNldFkgPSAwO1xuXG4gICAgICAgIHZhciBkcmFnID0gZDMuYmVoYXZpb3IuZHJhZygpXG4gICAgICAgICAgICAub24oJ2RyYWdzdGFydCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyB0cmFjayBvZmZzZXRYIGFuZCBvZmZzZXRZIHRvIGRpc3Rpbmd1aXNoIGJldHdlZW4gZHJhZyBhbmQgY2xpY2tcbiAgICAgICAgICAgICAgICBkcmFnT2Zmc2V0WCA9IGQzLmV2ZW50LnNvdXJjZUV2ZW50LmxheWVyWDtcbiAgICAgICAgICAgICAgICBkcmFnT2Zmc2V0WSA9IGQzLmV2ZW50LnNvdXJjZUV2ZW50LmxheWVyWTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBnZXRDZWxsRmlsbCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBpZiAoZCAmJiBkLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnN0YXR1cy5nZXRDZWxsRmlsbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICdub25lJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbFRleHQgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5nZXRDZWxsVGV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRDZWxsQWN0aXZpdHkgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQgJiYgZC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnSm9iVHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuc3RhdHVzLmdldENlbGxBY3Rpdml0eSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbFBhdXNlUmVzdW1lID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGlmIChkICYmIGQuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQuc3RhdHVzLmdldENlbGxQYXVzZVJlc3VtZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRDZWxsQWN0aXZpdHlUb3RhbCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBpZiAoZCAmJiBkLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnN0YXR1cy5nZXRDZWxsQWN0aXZpdHlUb3RhbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRDZWxsVGl0bGUgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5nZXRDZWxsVGl0bGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbEVycm9yID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGlmIChkICYmIGQuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQuc3RhdHVzLmdldENlbGxFcnJvcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICdGYWlsZWQ6IFVuYXZhaWxhYmxlJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbFRvdGFsID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGlmIChkICYmIGQuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQuc3RhdHVzLmdldENlbGxUb3RhbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICdDb21wbGV0ZWQ6IFVuYXZhaWxhYmxlJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbFN0YXR1cyA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBpZiAoZCAmJiBkLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIGlmIChkLnRvU3RyaW5nKCkgPT09ICdOb2RlJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5zdGF0dXMuZ2V0Q2VsbFN0YXR1cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAnU3RhdHVzIFVuYXZhaWxhYmxlJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbEpvYnMgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQgJiYgZC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnTm9kZScpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuc3RhdHVzLmdldENlbGxKb2JzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRDZWxsRmFpbHVyZXMgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQgJiYgZC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnSm9iVHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuc3RhdHVzLmdldENlbGxGYWlsdXJlcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY2VsbENsaWNrSGFuZGxlciA9IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgICAgICAgIC8vIHRyYWNrIG9mZnNldFggYW5kIG9mZnNldFkgdG8gZGlzdGluZ3Vpc2ggYmV0d2VlbiBkcmFnIGFuZCBjbGlja1xuICAgICAgICAgICAgY2xpY2tPZmZzZXRYID0gZDMuZXZlbnQubGF5ZXJYO1xuICAgICAgICAgICAgY2xpY2tPZmZzZXRZID0gZDMuZXZlbnQubGF5ZXJZO1xuICAgICAgICAgICAgaWYgKGRyYWdPZmZzZXRYID09PSBjbGlja09mZnNldFggJiYgZHJhZ09mZnNldFkgPT09IGNsaWNrT2Zmc2V0WSkge1xuICAgICAgICAgICAgICAgIC8vIG9mZnNldHMgYXJlIHRoZSBzYW1lOyBubyBkcmFnZ2luZyBvY2N1cnJlZDsgcHJvY2VzcyBhcyBjbGljayBldmVudFxuICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LnRvU3RyaW5nKCkgPT09ICdKb2JUeXBlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9qb2JzJykuc2VhcmNoKCdqb2JfdHlwZV9pZCcsIHRhcmdldC5pZCkuc2VhcmNoKCdzdGF0dXMnLCB0YXJnZXQuc3RhdHVzLmhhc19ydW5uaW5nLnN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0LnRvU3RyaW5nKCkgPT09ICdOb2RlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ub2Rlcy8nICsgdGFyZ2V0LmlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciB1cGRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZWxlbSA9ICQoJy5jZWxsLWFjdGl2aXR5LWljb24nKTtcbiAgICAgICAgICAgIFR3ZWVuTWF4LnRvKGVsZW0sIDEsIHtcbiAgICAgICAgICAgICAgICByb3RhdGlvbjogMzYwLFxuICAgICAgICAgICAgICAgIHRyYW5zZm9ybU9yaWdpbjogJzUwJSA1MCUnLFxuICAgICAgICAgICAgICAgIHJlcGVhdDogLTEsXG4gICAgICAgICAgICAgICAgZWFzZTogTGluZWFyLmVhc2VOb25lXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gREFUQSBKT0lOXG4gICAgICAgICAgICAvLyBKb2luIG5ldyBkYXRhIHdpdGggb2xkIGVsZW1lbnRzLCBpZiBhbnkuXG4gICAgICAgICAgICBpZiAoZW5hYmxlVG9vbHRpcCkge1xuICAgICAgICAgICAgICAgIHZhciBjb250YWluZXJHcm91cCA9IHN2Zy5zZWxlY3RBbGwoJy5jZWxsLWdyb3VwJylcbiAgICAgICAgICAgICAgICAgICAgLmRhdGEoZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSlcbiAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCB0aXAuc2hvdylcbiAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZW91dCcsIHRpcC5oaWRlKVxuICAgICAgICAgICAgICAgICAgICAub24oJ2NsaWNrJywgdGlwLmhpZGUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyR3JvdXAgPSBzdmcuc2VsZWN0QWxsKCcuY2VsbC1ncm91cCcpXG4gICAgICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBVUERBVEVcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBvbGQgZWxlbWVudHMgYXMgbmVlZGVkLlxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuc3RvcDEnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdvZmZzZXQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcxMDAlJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnMCUnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnMCUnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3N0b3AtY29sb3InLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFpbHVyZXNbMF0gPT09ICdTWVNURU0nID8gc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfc3lzdGVtIDogZmFpbHVyZXNbMF0gPT09ICdEQVRBJyA/IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX2RhdGEgOiBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9hbGdvcml0aG07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxGaWxsKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5zdG9wMicpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ29mZnNldCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcy5sZW5ndGggPT09IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzUwJSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZhaWx1cmVzLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnMTAwJSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcwJSc7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cignc3RvcC1jb2xvcicsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWlsdXJlc1sxXSA9PT0gJ1NZU1RFTScgPyBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9zeXN0ZW0gOiBmYWlsdXJlc1sxXSA9PT0gJ0RBVEEnID8gc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfZGF0YSA6IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX2FsZ29yaXRobTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEZpbGwoZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLnN0b3AzJylcbiAgICAgICAgICAgICAgICAuYXR0cignb2Zmc2V0JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmVzID0gZ2V0Q2VsbEZhaWx1cmVzKGQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMgJiYgZmFpbHVyZXMubGVuZ3RoID4gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzLmxlbmd0aCA9PT0gMykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnMTAwJSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcwJSc7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cignc3RvcC1jb2xvcicsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWlsdXJlc1syXSA9PT0gJ1NZU1RFTScgPyBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9zeXN0ZW0gOiBmYWlsdXJlc1syXSA9PT0gJ0RBVEEnID8gc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfZGF0YSA6IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX2FsZ29yaXRobTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEZpbGwoZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwnKVxuICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgIC5kdXJhdGlvbig3NTApXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2UnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZCA/ICcjZmZmJyA6ICdub25lJztcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkLnRvU3RyaW5nKCkgPT09ICdOb2RlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxGaWxsKGQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciBjZyA9IGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtZ3JhZGllbnQnKTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC10ZXh0JylcbiAgICAgICAgICAgICAgICAuZGF0YShncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsVGV4dChkKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGQudG9TdHJpbmcoKSA9PT0gJ0pvYlR5cGUnICYmIGdldENlbGxBY3Rpdml0eVRvdGFsKGQpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbGxIZWlnaHQgLyAyO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoY2VsbEhlaWdodCAvIDIpICsgMTA7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtdG90YWwtYWN0aXZlJylcbiAgICAgICAgICAgICAgICAuZGF0YShncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkLnRvU3RyaW5nKCkgPT09ICdKb2JUeXBlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxBY3Rpdml0eVRvdGFsKGQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtcGF1c2UtcmVzdW1lLWljb24nKVxuICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxQYXVzZVJlc3VtZShkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC1hY3Rpdml0eS1pY29uJylcbiAgICAgICAgICAgICAgICAuZGF0YShncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsQWN0aXZpdHkoZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtdGl0bGUnKVxuICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxUaXRsZShkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC1lcnJvcicpXG4gICAgICAgICAgICAgICAgLmRhdGEoZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSlcbiAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEVycm9yKGQsIHRydWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLXRvdGFsJylcbiAgICAgICAgICAgICAgICAuZGF0YShncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsVG90YWwoZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtc3RhdHVzJylcbiAgICAgICAgICAgICAgICAuZGF0YShncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsU3RhdHVzKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLWpvYnMnKVxuICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxKb2JzKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLW92ZXJsYXknKVxuICAgICAgICAgICAgICAgIC5kYXRhKGdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLm9uKCdjbGljaycsIGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbENsaWNrSGFuZGxlcih0YXJnZXQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBFTlRFUlxuICAgICAgICAgICAgLy8gQ3JlYXRlIG5ldyBlbGVtZW50cyBhcyBuZWVkZWQuXG4gICAgICAgICAgICB2YXIgY2VsbEdyb3VwID0gY29udGFpbmVyR3JvdXAuZW50ZXIoKVxuICAgICAgICAgICAgICAgIC5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLWdyb3VwJyk7XG5cbiAgICAgICAgICAgIHZhciBkZWZzID0gY2VsbEdyb3VwLmFwcGVuZCgnZGVmcycpO1xuICAgICAgICAgICAgdmFyIGdyYWRpZW50ID0gZGVmcy5hcHBlbmQoJ2xpbmVhckdyYWRpZW50JylcbiAgICAgICAgICAgICAgICAuYXR0cignaWQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC5uYW1lO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtZ3JhZGllbnQnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4MScsIDApXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3kxJywgMClcbiAgICAgICAgICAgICAgICAuYXR0cigneDInLCAwKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5MicsIDEpO1xuICAgICAgICAgICAgZ3JhZGllbnQuYXBwZW5kKCdzdG9wJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnc3RvcDEnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdvZmZzZXQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcxMDAlJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnMCUnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnMCUnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3N0b3AtY29sb3InLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFpbHVyZXNbMF0gPT09ICdTWVNURU0nID8gc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfc3lzdGVtIDogZmFpbHVyZXNbMF0gPT09ICdEQVRBJyA/IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX2RhdGEgOiBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9hbGdvcml0aG07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxGaWxsKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZ3JhZGllbnQuYXBwZW5kKCdzdG9wJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnc3RvcDInKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdvZmZzZXQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMubGVuZ3RoID09PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc1MCUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmYWlsdXJlcy5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzEwMCUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnMCUnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3N0b3AtY29sb3InLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFpbHVyZXNbMV0gPT09ICdTWVNURU0nID8gc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfc3lzdGVtIDogZmFpbHVyZXNbMV0gPT09ICdEQVRBJyA/IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX2RhdGEgOiBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9hbGdvcml0aG07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxGaWxsKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZ3JhZGllbnQuYXBwZW5kKCdzdG9wJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnc3RvcDMnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdvZmZzZXQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMubGVuZ3RoID09PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcxMDAlJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzAlJztcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKCdzdG9wLWNvbG9yJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmVzID0gZ2V0Q2VsbEZhaWx1cmVzKGQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMgJiYgZmFpbHVyZXMubGVuZ3RoID4gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhaWx1cmVzWzJdID09PSAnU1lTVEVNJyA/IHNjYWxlQ29uZmlnLmNvbG9ycy5mYWlsdXJlX3N5c3RlbSA6IGZhaWx1cmVzWzJdID09PSAnREFUQScgPyBzY2FsZUNvbmZpZy5jb2xvcnMuZmFpbHVyZV9kYXRhIDogc2NhbGVDb25maWcuY29sb3JzLmZhaWx1cmVfYWxnb3JpdGhtO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsRmlsbChkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY2VsbEdyb3VwLmFwcGVuZCgncmVjdCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIGNlbGxXaWR0aClcbiAgICAgICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgY2VsbEhlaWdodClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnTm9kZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsRmlsbChkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2ZpbGwnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnSm9iVHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAndXJsKCMnICsgZC5uYW1lICsgJyknO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkID8gJyNmZmYnIDogJ25vbmUnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgIC5kdXJhdGlvbig3NTApO1xuXG4gICAgICAgICAgICBjZWxsR3JvdXAuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC10ZXh0JylcbiAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbFRleHQoZCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnbWlkZGxlJylcbiAgICAgICAgICAgICAgICAuYXR0cigneCcsIGNlbGxXaWR0aCAvIDIpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3knLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnSm9iVHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnZXRDZWxsQWN0aXZpdHlUb3RhbChkKSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2VsbEhlaWdodCAvIDI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGNlbGxIZWlnaHQgLyAyKSArIDEwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjZWxsSGVpZ2h0IC8gMjtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGQudG9TdHJpbmcoKSA9PT0gJ05vZGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnNjYWxlICogOCArICdweCc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgZW5hYmxlUmV2ZWFsID8gJ2Jsb2NrJyA6ICdub25lJyk7XG5cbiAgICAgICAgICAgIGNlbGxHcm91cC5hcHBlbmQoJ3RleHQnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLXRvdGFsLWFjdGl2ZScpXG4gICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGQudG9TdHJpbmcoKSA9PT0gJ0pvYlR5cGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEFjdGl2aXR5VG90YWwoZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgY2VsbFdpZHRoIC8gMilcbiAgICAgICAgICAgICAgICAuYXR0cigneScsIGNlbGxIZWlnaHQgLSA1KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsIGVuYWJsZVJldmVhbCA/ICdibG9jaycgOiAnbm9uZScpO1xuXG4gICAgICAgICAgICBjZWxsR3JvdXAuYXBwZW5kKCdnJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC1hY3Rpdml0eScpXG4gICAgICAgICAgICAgICAgLmFwcGVuZCgndGV4dCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtYWN0aXZpdHktaWNvbicpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2ZvbnQtc2l6ZScsIDExKVxuICAgICAgICAgICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsQWN0aXZpdHkoZCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnZW5kJylcbiAgICAgICAgICAgICAgICAuYXR0cigneCcsIGNlbGxXaWR0aCAtIDIpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3knLCAxMyk7XG5cbiAgICAgICAgICAgIHZhciBkZXRhaWwgPSBjZWxsR3JvdXAuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC10ZXh0LWRldGFpbCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCBjZWxsV2lkdGggLyAyKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgTWF0aC5mbG9vcihjZWxsSGVpZ2h0ICouMTUpKSAvLyAxNSUgZnJvbSB0b3Agb2YgY2VsbFxuICAgICAgICAgICAgICAgIC5hdHRyKCdkeScsIDApXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgZW5hYmxlUmV2ZWFsID8gJ25vbmUnIDogJ2Jsb2NrJyk7XG5cbiAgICAgICAgICAgIGRldGFpbC5hcHBlbmQoJ3RzcGFuJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC10aXRsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCBjZWxsV2lkdGggLyAyKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgTWF0aC5mbG9vcihjZWxsSGVpZ2h0ICogLjE1KSkgLy8gMTUlIGZyb20gdG9wIG9mIGNlbGxcbiAgICAgICAgICAgICAgICAuYXR0cignZHknLCAwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgY2VsbEZvbnRTbSAqIHNjYWxlICsgJ2VtJylcbiAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbFRpdGxlKGQpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhbGwod3JhcCk7XG5cbiAgICAgICAgICAgIGRldGFpbC5hcHBlbmQoJ3RzcGFuJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC1lcnJvcicpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCBjZWxsV2lkdGggLyAyKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgTWF0aC5mbG9vcihjZWxsSGVpZ2h0ICouMykpIC8vIDMwJSBmcm9tIHRvcCBvZiBjZWxsXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2R5JywgMClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZvbnQtc2l6ZScsIGNlbGxGb250U20gKiBzY2FsZSArICdlbScpXG4gICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxFcnJvcihkKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYWxsKHdyYXApO1xuXG4gICAgICAgICAgICBkZXRhaWwuYXBwZW5kKCd0c3BhbicpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtdG90YWwnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgY2VsbFdpZHRoIC8gMilcbiAgICAgICAgICAgICAgICAuYXR0cigneScsIE1hdGguZmxvb3IoY2VsbEhlaWdodCAqLjQpKSAvLyA0MCUgZnJvbSB0b3Agb2YgY2VsbFxuICAgICAgICAgICAgICAgIC5hdHRyKCdkeScsIDApXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdmb250LXNpemUnLCBjZWxsRm9udFNtICogc2NhbGUgKyAnZW0nKVxuICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsVG90YWwoZCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2FsbCh3cmFwKTtcblxuICAgICAgICAgICAgZGV0YWlsLmFwcGVuZCgndHNwYW4nKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLXN0YXR1cycpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCBjZWxsV2lkdGggLyAyKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgTWF0aC5mbG9vcihjZWxsSGVpZ2h0ICogLjU1KSkgLy8gNTUlIGZyb20gdG9wIG9mIGNlbGxcbiAgICAgICAgICAgICAgICAuYXR0cignZHknLCAwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgY2VsbEZvbnRMZyAqIHNjYWxlICsgJ2VtJylcbiAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbFN0YXR1cyhkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZGV0YWlsLmFwcGVuZCgndHNwYW4nKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLWpvYnMnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgY2VsbFdpZHRoIC8gMilcbiAgICAgICAgICAgICAgICAuYXR0cigneScsIE1hdGguZmxvb3IoY2VsbEhlaWdodCAqIC43NSkpIC8vIDc1JSBmcm9tIHRvcCBvZiBjZWxsXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2R5JywgMClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZvbnQtc2l6ZScsIGNlbGxGb250U20gKiBzY2FsZSArICdlbScpXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxKb2JzKGQpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhbGwod3JhcCk7XG5cbiAgICAgICAgICAgIGNlbGxHcm91cC5hcHBlbmQoJ3JlY3QnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLW92ZXJsYXknKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIGNlbGxXaWR0aClcbiAgICAgICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgY2VsbEhlaWdodClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnI2ZmZicpXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsLW9wYWNpdHknLCAnMC4yNScpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwtb3BhY2l0eScsICcwJyk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbENsaWNrSGFuZGxlcihkKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYWxsKGRyYWcpO1xuXG4gICAgICAgICAgICBpZiAodXNlciAmJiB1c2VyLmlzX2FkbWluKSB7XG4gICAgICAgICAgICAgICAgY2VsbEdyb3VwLmFwcGVuZCgndGV4dCcpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLXBhdXNlLXJlc3VtZS1pY29uJylcbiAgICAgICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsUGF1c2VSZXN1bWUoZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdzdGFydCcpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgZW5hYmxlUmV2ZWFsID8gMiA6IDUpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgZW5hYmxlUmV2ZWFsID8gJHNjb3BlLnNjYWxlICogOCA6IDIwKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2Rpc3BsYXknLCBlbmFibGVSZXZlYWwgPyAnbm9uZScgOiAnYmxvY2snKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZvbnQtc2l6ZScsIGVuYWJsZVJldmVhbCA/ICRzY29wZS5zY2FsZSAqIDcgKyAncHgnIDogJzEuM2VtJylcbiAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2N1cnNvcicsICdwb2ludGVyJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfYmx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnd2hpdGUnKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEVOVEVSICsgVVBEQVRFXG4gICAgICAgICAgICAvLyBBcHBlbmRpbmcgdG8gdGhlIGVudGVyIHNlbGVjdGlvbiBleHBhbmRzIHRoZSB1cGRhdGUgc2VsZWN0aW9uIHRvIGluY2x1ZGVcbiAgICAgICAgICAgIC8vIGVudGVyaW5nIGVsZW1lbnRzOyBzbywgb3BlcmF0aW9ucyBvbiB0aGUgdXBkYXRlIHNlbGVjdGlvbiBhZnRlciBhcHBlbmRpbmcgdG9cbiAgICAgICAgICAgIC8vIHRoZSBlbnRlciBzZWxlY3Rpb24gd2lsbCBhcHBseSB0byBib3RoIGVudGVyaW5nIGFuZCB1cGRhdGluZyBub2Rlcy5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgIC5kdXJhdGlvbig3NTApXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAndHJhbnNsYXRlKCcgKyBkLmNvb3JkcyArICcpJztcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyIHVwZGF0ZUNlbGxGaWxsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwnKVxuICAgICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgICAgIC5kdXJhdGlvbigyNTApXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkID8gJyNmZmYnIDogJ25vbmUnO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxGaWxsKGQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciB1cGRhdGVQYXVzZVJlc3VtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLXBhdXNlLXJlc3VtZS1pY29uJylcbiAgICAgICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsUGF1c2VSZXN1bWUoZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHVwZGF0ZUNlbGxTdGF0dXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC1zdGF0dXMnKVxuICAgICAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxTdGF0dXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gRVhJVFxuICAgICAgICAgICAgLy8gUmVtb3ZlIG9sZCBlbGVtZW50cyBhcyBuZWVkZWQuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5leGl0KClcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC1leGl0JylcbiAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgLmR1cmF0aW9uKDc1MClcbiAgICAgICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLDApJylcbiAgICAgICAgICAgICAgICAucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHdyYXAgKHRleHQsIHdpZHRoKSB7XG4gICAgICAgICAgICAgICAgdGV4dC5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRleHQgPSBkMy5zZWxlY3QodGhpcyksXG4gICAgICAgICAgICAgICAgICAgICAgICB3b3JkcyA9IHRleHQudGV4dCgpLnNwbGl0KC9cXHMrLykucmV2ZXJzZSgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVOdW1iZXIgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZUhlaWdodCA9IDEuMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHkgPSB0ZXh0LmF0dHIoJ3knKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGR5ID0gcGFyc2VGbG9hdCh0ZXh0LmF0dHIoJ2R5JykpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHNwYW4gPSB0ZXh0LnRleHQobnVsbCkuYXBwZW5kKCd0c3BhbicpLmF0dHIoJ3gnLCBjZWxsV2lkdGggLyAyKS5hdHRyKCd5JywgeSkuYXR0cignZHknLCBkeSArICdlbScpO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZSAod29yZCA9IHdvcmRzLnBvcCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAod29yZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lLnB1c2god29yZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHNwYW4udGV4dChsaW5lLmpvaW4oJyAnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRzcGFuLm5vZGUoKS5nZXRDb21wdXRlZFRleHRMZW5ndGgoKSA+IChjZWxsV2lkdGggLSAxMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZS5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHNwYW4udGV4dChsaW5lLmpvaW4oJyAnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSBbd29yZF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRzcGFuID0gdGV4dC5hcHBlbmQoJ3RzcGFuJykuYXR0cigneCcsIGNlbGxXaWR0aCAvIDIpLmF0dHIoJ3knLCB5KS5hdHRyKCdkeScsICsrbGluZU51bWJlciAqIGxpbmVIZWlnaHQgKyBkeSArICdlbScpLnRleHQod29yZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoXy5rZXlzKGRhdGEpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAkKCcuZ3JpZC1jaGFydCcpLmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgaW5pdGlhbGl6ZShkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiRvbigncmVkcmF3R3JpZCcsIGZ1bmN0aW9uIChldmVudCwgZGF0YSkge1xuICAgICAgICAgICAgZ2V0RGF0YVZhbHVlcyhkYXRhKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5kaXJlY3RpdmUoJ2Fpc0dyaWRDaGFydCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhaXNHcmlkQ2hhcnRDb250cm9sbGVyJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9jaGFydHMvZ3JpZC9ncmlkQ2hhcnRUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGRhdGE6ICc9JyxcbiAgICAgICAgICAgICAgICBpY29uczogJz0nLCAvLyBpbmRpY2F0ZXMgd2hldGhlciBjZWxsLXRleHQgaXMgZW50aXJlbHkgbWFkZSB1cCBvZiBpY29uc1xuICAgICAgICAgICAgICAgIHNjYWxlOiAnPScsIC8vIG11bHRpcGxpZXIgdG8gaW5jcmVhc2UgY2VsbCBzaXplXG4gICAgICAgICAgICAgICAgcmV2ZWFsOiAnPScsIC8vIGlmIHRydWUsIGxlc3MgZGF0YSB3aWxsIHNob3cgd2hlbiB6b29tZWQgb3V0XG4gICAgICAgICAgICAgICAgbW9kZTogJ0AnLCAvLyB2YWxpZCB2YWx1ZXMgYXJlIHpvb20gb3IgdG9vbHRpcFxuICAgICAgICAgICAgICAgIGNvbHVtbnM6ICc9JyxcbiAgICAgICAgICAgICAgICByb3dzOiAnPScsXG4gICAgICAgICAgICAgICAgc2hvd0F4ZXM6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWlzSGVhbHRoQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcyxcbiAgICAgICAgICAgIGluaXRpYWxpemVkID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpbml0aWFsaXplZCA9IHRydWU7XG4gICAgICAgICAgICB2YXIgc2NhbGUgPSAkc2NvcGUuc2NhbGUgfHwgMTtcbiAgICAgICAgICAgIHZtLmRvbnV0U2l6ZSA9IDI3NSAqIHNjYWxlO1xuICAgICAgICAgICAgdm0uZG9udXRXaWR0aCA9IDI1ICogc2NhbGU7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChfLmtleXMoZGF0YSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmRpcmVjdGl2ZSgnYWlzSGVhbHRoJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fpc0hlYWx0aENvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2NoYXJ0cy9oZWFsdGgvaGVhbHRoVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnPScsXG4gICAgICAgICAgICAgICAgZGF0YTogJz0nLFxuICAgICAgICAgICAgICAgIHNjYWxlOiAnPScsXG4gICAgICAgICAgICAgICAgZXJyb3JMYWJlbDogJz0nLFxuICAgICAgICAgICAgICAgIHR5cGU6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWlzSm9iTG9hZENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBsb2FkU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgY2hhcnQgPSBudWxsLFxuICAgICAgICAgICAgY29sQXJyID0gW10sXG4gICAgICAgICAgICB4QXJyID0gW107XG5cbiAgICAgICAgdm0uZmlsdGVyVmFsdWUgPSAxO1xuICAgICAgICB2bS5maWx0ZXJEdXJhdGlvbiA9ICd3JztcbiAgICAgICAgdm0uZmlsdGVyRHVyYXRpb25zID0gWydNJywgJ3cnLCAnZCddO1xuICAgICAgICB2bS56b29tRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICB2bS56b29tQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICB2bS56b29tVGV4dCA9ICdFbmFibGUgWm9vbSc7XG4gICAgICAgIHZtLmpvYkxvYWREYXRhID0ge307XG4gICAgICAgIHZtLmxvYWRpbmdKb2JMb2FkID0gdHJ1ZTtcbiAgICAgICAgdm0uam9iTG9hZEVycm9yID0gbnVsbDtcbiAgICAgICAgdm0uam9iTG9hZEVycm9yU3RhdHVzID0gbnVsbDtcbiAgICAgICAgdm0udG90YWwgPSAwO1xuICAgICAgICB2bS5jaGFydFN0eWxlID0gJyc7XG5cbiAgICAgICAgdmFyIGpvYkxvYWRQYXJhbXMgPSB7XG4gICAgICAgICAgICBzdGFydGVkOiBtb21lbnQudXRjKCkuc3VidHJhY3Qodm0uZmlsdGVyVmFsdWUsIHZtLmZpbHRlckR1cmF0aW9uKS5zdGFydE9mKCdkJykudG9EYXRlKCksIGVuZGVkOiBtb21lbnQudXRjKCkuZW5kT2YoJ2QnKS50b0RhdGUoKSwgam9iX3R5cGVfaWQ6IG51bGwsIGpvYl90eXBlX25hbWU6IG51bGwsIGpvYl90eXBlX2NhdGVnb3J5OiBudWxsLCB1cmw6IG51bGxcbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVab29tID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uem9vbUVuYWJsZWQgPSAhdm0uem9vbUVuYWJsZWQ7XG4gICAgICAgICAgICBjaGFydC56b29tLmVuYWJsZSh2bS56b29tRW5hYmxlZCk7XG4gICAgICAgICAgICBpZiAodm0uem9vbUVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICB2bS56b29tQ2xhc3MgPSAnYnRuLXByaW1hcnknO1xuICAgICAgICAgICAgICAgIHZtLnpvb21UZXh0ID0gJ0Rpc2FibGUgWm9vbSc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLnpvb21DbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgICAgICAgICAgdm0uem9vbVRleHQgPSAnRW5hYmxlIFpvb20nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0Q2hhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB4QXJyID0gW107XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHhBcnIgPSBfLnBsdWNrKHZtLmpvYkxvYWREYXRhLnJlc3VsdHMsICd0aW1lJyk7XG4gICAgICAgICAgICBfLmZvckVhY2goeEFyciwgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgICAgICB4QXJyW2ldID0gbW9tZW50LnV0YyhkKS50b0RhdGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgeEFyci51bnNoaWZ0KCd4Jyk7XG5cbiAgICAgICAgICAgIHZhciBwZW5kaW5nQXJyID0gXy5wbHVjayh2bS5qb2JMb2FkRGF0YS5yZXN1bHRzLCAncGVuZGluZ19jb3VudCcpLFxuICAgICAgICAgICAgICAgIHF1ZXVlZEFyciA9IF8ucGx1Y2sodm0uam9iTG9hZERhdGEucmVzdWx0cywgJ3F1ZXVlZF9jb3VudCcpLFxuICAgICAgICAgICAgICAgIHJ1bm5pbmdBcnIgPSBfLnBsdWNrKHZtLmpvYkxvYWREYXRhLnJlc3VsdHMsICdydW5uaW5nX2NvdW50Jyk7XG5cbiAgICAgICAgICAgIHBlbmRpbmdBcnIudW5zaGlmdCgnUGVuZGluZycpO1xuICAgICAgICAgICAgcXVldWVkQXJyLnVuc2hpZnQoJ1F1ZXVlZCcpO1xuICAgICAgICAgICAgcnVubmluZ0Fyci51bnNoaWZ0KCdSdW5uaW5nJyk7XG5cbiAgICAgICAgICAgIC8vIGFkZCB0byBjb2xBcnJcbiAgICAgICAgICAgIGNvbEFyciA9IFt4QXJyLCBwZW5kaW5nQXJyLCBxdWV1ZWRBcnIsIHJ1bm5pbmdBcnJdO1xuXG4gICAgICAgICAgICB2YXIgdHlwZXMgPSB7fSxcbiAgICAgICAgICAgICAgICB0eXBlID0ge30sXG4gICAgICAgICAgICAgICAgZ3JvdXBzID0gW107XG5cbiAgICAgICAgICAgIF8uZm9yRWFjaChjb2xBcnIsIGZ1bmN0aW9uKGNvbCl7XG4gICAgICAgICAgICAgICAgdHlwZSA9IHt9O1xuICAgICAgICAgICAgICAgIGlmIChjb2xbMF0gIT09ICd4Jykge1xuICAgICAgICAgICAgICAgICAgICB0eXBlW2NvbFswXV0gPSAnYXJlYSc7XG4gICAgICAgICAgICAgICAgICAgIGdyb3Vwcy5wdXNoKGNvbFswXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHR5cGVzLCB0eXBlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoY2hhcnQpIHtcbiAgICAgICAgICAgICAgICBjaGFydC5mbHVzaCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gY2hhcnQgY29uZmlnXG4gICAgICAgICAgICBjaGFydCA9IGMzLmdlbmVyYXRlKHtcbiAgICAgICAgICAgICAgICBiaW5kdG86ICcjam9iLWxvYWQnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgeDogJ3gnLFxuICAgICAgICAgICAgICAgICAgICBjb2x1bW5zOiBjb2xBcnIsXG4gICAgICAgICAgICAgICAgICAgIHR5cGVzOiB0eXBlcyxcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBzOiBbZ3JvdXBzXSxcbiAgICAgICAgICAgICAgICAgICAgY29sb3JzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBQZW5kaW5nOiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfcGluayxcbiAgICAgICAgICAgICAgICAgICAgICAgIFF1ZXVlZDogc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X3B1cnBsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFJ1bm5pbmc6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9ibHVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDcwMFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdG9vbHRpcDoge1xuICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBmdW5jdGlvbiAoeCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQudXRjKHgpLnN0YXJ0T2YoJ2gnKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGF4aXM6IHtcbiAgICAgICAgICAgICAgICAgICAgeDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RpbWVzZXJpZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGljazoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vbWVudC51dGMoZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5sb2FkaW5nSm9iTG9hZCA9IGZhbHNlO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRKb2JMb2FkID0gZnVuY3Rpb24gKHNob3dQYWdlTG9hZCkge1xuICAgICAgICAgICAgaWYgKHNob3dQYWdlTG9hZCkge1xuICAgICAgICAgICAgICAgICRzY29wZS4kcGFyZW50LmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nSm9iTG9hZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBqb2JMb2FkUGFyYW1zLnN0YXJ0ZWQgPSBtb21lbnQudXRjKCkuc3VidHJhY3Qodm0uZmlsdGVyVmFsdWUsIHZtLmZpbHRlckR1cmF0aW9uKS5zdGFydE9mKCdkJykudG9EYXRlKCk7XG4gICAgICAgICAgICBqb2JMb2FkUGFyYW1zLmVuZGVkID0gbW9tZW50LnV0Yyhqb2JMb2FkUGFyYW1zLnN0YXJ0ZWQpLmFkZCgxLCB2bS5maWx0ZXJEdXJhdGlvbikuZW5kT2YoJ2QnKS50b0RhdGUoKTtcbiAgICAgICAgICAgIGpvYkxvYWRQYXJhbXMucGFnZV9zaXplID0gMTAwMDtcblxuICAgICAgICAgICAgbG9hZFNlcnZpY2UuZ2V0Sm9iTG9hZChqb2JMb2FkUGFyYW1zKS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5qb2JMb2FkRGF0YSA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgaW5pdENoYXJ0KCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXNUZXh0ICYmIHJlc3VsdC5zdGF0dXNUZXh0ICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uam9iTG9hZEVycm9yU3RhdHVzID0gcmVzdWx0LnN0YXR1c1RleHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdm0uam9iTG9hZEVycm9yID0gJ1VuYWJsZSB0byByZXRyaWV2ZSBqb2IgbG9hZC4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoc2hvd1BhZ2VMb2FkKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kcGFyZW50LmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2bS5sb2FkaW5nSm9iTG9hZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUpvYkxvYWRSYW5nZSA9IGZ1bmN0aW9uIChhY3Rpb24pIHtcbiAgICAgICAgICAgIGlmIChhY3Rpb24gPT09ICdvbGRlcicpIHtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJWYWx1ZSsrO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICduZXdlcicpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0uZmlsdGVyVmFsdWUgPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmZpbHRlclZhbHVlLS07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICd0b2RheScpIHtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJWYWx1ZSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBnZXRKb2JMb2FkKHRydWUpO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmZpbHRlclZhbHVlJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICB2YXIgJGpvYkxvYWROZXdlciA9ICQoJy5qb2ItbG9hZC1uZXdlcicpLFxuICAgICAgICAgICAgICAgICRqb2JMb2FkVG9kYXkgPSAkKCcuam9iLWxvYWQtdG9kYXknKTtcblxuICAgICAgICAgICAgaWYgKHZhbHVlID4gMSkge1xuICAgICAgICAgICAgICAgICRqb2JMb2FkTmV3ZXIucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICAkam9iTG9hZFRvZGF5LnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRqb2JMb2FkTmV3ZXIuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICAkam9iTG9hZFRvZGF5LmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG5cbiAgICAgICAgaWYgKCRzY29wZS5hdXRvSGVpZ2h0KSB7XG4gICAgICAgICAgICAvLyBzZXQgY2hhcnQgaGVpZ2h0XG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyBzZXQgY29udGFpbmVyIGhlaWdodHMgZXF1YWwgdG8gYXZhaWxhYmxlIHBhZ2UgaGVpZ2h0XG4gICAgICAgICAgICAgICAgdmFyIHZpZXdwb3J0ID0gc2NhbGVTZXJ2aWNlLmdldFZpZXdwb3J0U2l6ZSgpLFxuICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBzY2FsZUNvbmZpZy5oZWFkZXJPZmZzZXQsXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlck9mZnNldCA9ICQoJy5qb2ItbG9hZC1oZWFkZXInKS5oZWlnaHQoKSxcbiAgICAgICAgICAgICAgICAgICAgbGVnZW5kT2Zmc2V0ID0gJCgnLmpvYi1sb2FkLWxlZ2VuZC1sYWJlbCcpLmhlaWdodCgpLFxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJPZmZzZXQgPSAkKCcuam9iLWxvYWQtZmlsdGVyJykub3V0ZXJIZWlnaHQodHJ1ZSksXG4gICAgICAgICAgICAgICAgICAgIGNoYXJ0TWF4SGVpZ2h0ID0gdmlld3BvcnQuaGVpZ2h0IC0gb2Zmc2V0IC0gaGVhZGVyT2Zmc2V0IC0gbGVnZW5kT2Zmc2V0IC0gZmlsdGVyT2Zmc2V0IC0gNTtcblxuICAgICAgICAgICAgICAgIHZtLmNoYXJ0U3R5bGUgPSAnaGVpZ2h0OiAnICsgY2hhcnRNYXhIZWlnaHQgKyAncHg7IG1heC1oZWlnaHQ6ICcgKyBjaGFydE1heEhlaWdodCArICdweDsnO1xuICAgICAgICAgICAgICAgIGdldEpvYkxvYWQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2V0Sm9iTG9hZCgpO1xuICAgICAgICB9XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5kaXJlY3RpdmUoJ2Fpc0pvYkxvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzSm9iTG9hZENvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2NoYXJ0cy9qb2JMb2FkL2pvYkxvYWRUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIHNob3dGaWx0ZXI6ICc9JywgLy8gc2hvdyB0aW1lIHJhbmdlIGZpbHRlciBVSVxuICAgICAgICAgICAgICAgIGN1bGxMZWdlbmQ6ICc9JywgLy8gb25seSBzaG93IGpvYiB0eXBlcyBpbiBsZWdlbmQgd2hvc2UgdmFsdWUgaXMgPiAwXG4gICAgICAgICAgICAgICAgaGlkZVRpdGxlOiAnPScsXG4gICAgICAgICAgICAgICAgYXV0b0hlaWdodDogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhaXNSYWRpYWxQZXJjZW50YWdlQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRlbGVtZW50LCBzY2FsZUNvbmZpZykge1xuICAgIHZhciBpc0luaXRpYWxpemVkID0gZmFsc2UsXG4gICAgICAgIGZvcmVncm91bmQgPSAnJyxcbiAgICAgICAgdGV4dCA9ICcnLFxuICAgICAgICBhcmNUd2VlbiA9ICcnLFxuICAgICAgICB0ZXh0VHdlZW4gPSAnJztcblxuICAgIHZhciBnZXRGb3JlZ3JvdW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdmFsdWUgPSBwYXJzZUZsb2F0KCRzY29wZS5wZXJjZW50YWdlKTtcbiAgICAgICAgaWYgKHZhbHVlID49IDc1KSB7XG4gICAgICAgICAgICByZXR1cm4gc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X2dyZWVuO1xuICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIDwgNzUgJiYgdmFsdWUgPj0gNTApIHtcbiAgICAgICAgICAgIHJldHVybiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfeWVsbG93O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9yZWQ7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIGhhbmRsZSBpbnB1dCBlaXRoZXIgLjgzIG9yIDgzXG4gICAgICAgIHZhciBwZXJjZW50YWdlID0gJHNjb3BlLnBlcmNlbnRhZ2UgfHwgMDtcbiAgICAgICAgaWYgKHBlcmNlbnRhZ2UgPiAxKSB7XG4gICAgICAgICAgICBwZXJjZW50YWdlIC89IDEwMDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHNpemUgdGhlIGNoYXJ0IHRvIHRoZSBwYXJlbnQgY29udGFpbmVyLiBJdCdzIHNxdWFyZSwgc28gdGFrZSB0aGVcbiAgICAgICAgLy8gc21hbGxlciBvZiB3aWR0aC9oZWlnaHRcbiAgICAgICAgdmFyIHNpemUgPSAkZWxlbWVudFswXS5wYXJlbnROb2RlLmNsaWVudFdpZHRoO1xuICAgICAgICBpZiAoJGVsZW1lbnRbMF0ucGFyZW50Tm9kZS5jbGllbnRIZWlnaHQgPCBzaXplKSB7XG4gICAgICAgICAgICBzaXplID0gJGVsZW1lbnRbMF0ucGFyZW50Tm9kZS5jbGllbnRIZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHZhciBmb3JtYXRQZXJjZW50ID0gZDMuZm9ybWF0KCcuMCUnKTtcblxuICAgICAgICB2YXIgYXJjID0gZDMuc3ZnLmFyYygpXG4gICAgICAgICAgICAuc3RhcnRBbmdsZSgwKVxuICAgICAgICAgICAgLm91dGVyUmFkaXVzKHNpemUgKiAwLjk1IC8gMilcbiAgICAgICAgICAgIC5pbm5lclJhZGl1cyhzaXplICogMC44MCAvIDIpO1xuXG4gICAgICAgIHZhciBzdmcgPSBkMy5zZWxlY3QoJGVsZW1lbnRbMF0pLmFwcGVuZCgnc3ZnJykuYXR0cih7XG4gICAgICAgICAgICB3aWR0aDogc2l6ZSxcbiAgICAgICAgICAgIGhlaWdodDogc2l6ZVxuICAgICAgICB9KS5hcHBlbmQoJ2cnKS5hdHRyKHtcbiAgICAgICAgICAgICd0cmFuc2Zvcm0nOiAndHJhbnNsYXRlKCcgKyBzaXplIC8gMiArICcsJyArIHNpemUgLyAyICsgJyknLFxuICAgICAgICAgICAgJ2NsYXNzJzogJ2Fpc1JhZGlhbCdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIG1ldGVyID0gc3ZnLmFwcGVuZCgnZycpLmF0dHIoe1xuICAgICAgICAgICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMTgwKSdcbiAgICAgICAgfSk7XG4gICAgICAgIG1ldGVyLmFwcGVuZCgncGF0aCcpXG4gICAgICAgICAgICAuZGF0dW0oe1xuICAgICAgICAgICAgICAgIGVuZEFuZ2xlOiAoMiAqIE1hdGguUEkpLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdiYWNrZ3JvdW5kJylcbiAgICAgICAgICAgIC5hdHRyKCdkJywgYXJjKTtcblxuICAgICAgICBmb3JlZ3JvdW5kID0gbWV0ZXIuYXBwZW5kKCdwYXRoJylcbiAgICAgICAgICAgIC5kYXR1bSh7XG4gICAgICAgICAgICAgICAgZW5kQW5nbGU6IDBcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYXR0cih7XG4gICAgICAgICAgICAgICAgJ2QnOiBhcmNcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldEZvcmVncm91bmQoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHRleHQgPSBzdmcuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgICAgIC5kYXR1bSh7XG4gICAgICAgICAgICAgICAgcGVyY2VudGFnZTogMFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgLmF0dHIoJ2R5JywgJy4zNWVtJyk7XG5cblxuICAgICAgICB0ZXh0VHdlZW4gPSBmdW5jdGlvbiAodHJhbnNpdGlvbiwgbmV3UGVyY2VudGFnZSkge1xuICAgICAgICAgICAgdHJhbnNpdGlvbi5hdHRyVHdlZW4oJ3RleHQnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgZCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBpID0gZDMuaW50ZXJwb2xhdGUoZC5wZXJjZW50YWdlLCBuZXdQZXJjZW50YWdlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5wZXJjZW50YWdlID0gaSh0KTtcbiAgICAgICAgICAgICAgICAgICAgdGV4dC50ZXh0KGZvcm1hdFBlcmNlbnQoaSh0KSkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgYXJjVHdlZW4gPSBmdW5jdGlvbiAodHJhbnNpdGlvbiwgbmV3QW5nbGUpIHtcbiAgICAgICAgICAgIHRyYW5zaXRpb24uYXR0clR3ZWVuKCdkJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IGQzLmludGVycG9sYXRlKGQuZW5kQW5nbGUsIG5ld0FuZ2xlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5lbmRBbmdsZSA9IGkodCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhcmMoZCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGlzSW5pdGlhbGl6ZWQgPSB0cnVlO1xuXG4gICAgICAgIHJlZHJhdyhwZXJjZW50YWdlKTtcbiAgICB9O1xuXG4gICAgdmFyIHJlZHJhdyA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICBpZiAoaXNJbml0aWFsaXplZCkge1xuICAgICAgICAgICAgdmFyIHBlcmNlbnRhZ2UgPSB2YWx1ZTtcbiAgICAgICAgICAgIGlmIChwZXJjZW50YWdlID4gMSkge1xuICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2UgLz0gMTAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3JlZ3JvdW5kLnRyYW5zaXRpb24oKS5kdXJhdGlvbigxMDAwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldEZvcmVncm91bmQoKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYWxsKGFyY1R3ZWVuLCAoTWF0aC5QSSAqIDIpICogcGVyY2VudGFnZSk7XG4gICAgICAgICAgICB0ZXh0LnRyYW5zaXRpb24oKS5kdXJhdGlvbigxMDAwKS5jYWxsKHRleHRUd2VlbiwgcGVyY2VudGFnZSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLiR3YXRjaCgncGVyY2VudGFnZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgJiYgIWlzSW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIGluaXRpYWxpemUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlZHJhdyh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9KVxufSk7XG4iLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmRpcmVjdGl2ZSgnYWlzUmFkaWFsUGVyY2VudGFnZScsIGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBjb250cm9sbGVyOiAnYWlzUmFkaWFsUGVyY2VudGFnZUNvbnRyb2xsZXInLFxuICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgcGVyY2VudGFnZTogJ0AnXG4gICAgICAgIH1cbiAgICB9O1xufSk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc1RpbWVsaW5lRGlyZWN0aXZlQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRlbGVtZW50LCBzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgZ2FudHQgPSBudWxsLFxuICAgICAgICAgICAgdGFza05hbWVzID0gW107XG5cbiAgICAgICAgJGVsZW1lbnRbMF0ub25yZXNpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZWxlbWVudCByZXNpemUnKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ3Rhc2tzJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgZHJhd1RpbWVsaW5lKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZHJhd1RpbWVsaW5lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCRzY29wZS50YXNrcyAmJiAkc2NvcGUudGFza3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICRzY29wZS50YXNrcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhWyRzY29wZS5lbmRlZF0gLSBiWyRzY29wZS5lbmRlZF07XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB0YXNrTmFtZXMgPSBfKCRzY29wZS50YXNrcykucGx1Y2soJ3Rhc2tOYW1lJykudW5pcSgpLnZhbHVlKCk7XG4gICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IHRhc2tOYW1lcy5sZW5ndGggKiAzMCArIDIwO1xuXG4gICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gJGVsZW1lbnRbMF0uY2xpZW50V2lkdGg7XG4gICAgICAgICAgICAgICAgaWYgKCF3aWR0aCB8fCB3aWR0aCA9PT0gMCkgeyB3aWR0aCA9IDYwMDsgfVxuXG5cbiAgICAgICAgICAgICAgICAkc2NvcGUudGFza3Muc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYVskc2NvcGUuc3RhcnRlZF0gLSBiWyRzY29wZS5zdGFydGVkXTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2YXIgbWluRGF0ZSA9ICRzY29wZS50YXNrc1swXVskc2NvcGUuc3RhcnRlZF07XG4gICAgICAgICAgICAgICAgdmFyIG1heERhdGUgPSAkc2NvcGUudGFza3NbJHNjb3BlLnRhc2tzLmxlbmd0aCAtIDFdWyRzY29wZS5lbmRlZF07XG4gICAgICAgICAgICAgICAgdmFyIGRheXNEaWZmID0gbW9tZW50LnV0YyhtYXhEYXRlKS5kaWZmKG1vbWVudC51dGMobWluRGF0ZSksJ2RheXMnKTtcbiAgICAgICAgICAgICAgICB2YXIgZm9ybWF0ID0gJyVIOiVNOiVTLiVtJztcbiAgICAgICAgICAgICAgICBpZiAoZGF5c0RpZmYgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdCA9IFwiJW0vJWQvJXkgJUg6JU1cIjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBnYW50dCA9IGQzLmdhbnR0KCkucmVuZGVyVG8oXCIjYWlzLXRpbWVsaW5lXCIpLnRhc2tUeXBlcyh0YXNrTmFtZXMpLnRhc2tTdGF0dXMoc2NhbGVDb25maWcudGFza1N0YXR1c1N0eWxlcykudGlja0Zvcm1hdChmb3JtYXQpLmJlZ2luKCRzY29wZS5zdGFydGVkKS5lbmRlZCgkc2NvcGUuZW5kZWQpLmhlaWdodChoZWlnaHQpLndpZHRoKHdpZHRoKTtcblxuICAgICAgICAgICAgICAgIGdhbnR0LnRpbWVEb21haW5Nb2RlKFwiZml0XCIpO1xuXG4gICAgICAgICAgICAgICAgZ2FudHQoJHNjb3BlLnRhc2tzKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmZvcm1hdERhdGUgPSBmdW5jdGlvbiAoZGF0ZSkge1xuICAgICAgICAgICAgaWYgKGRhdGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50LnV0YyhkYXRlKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgIH0pLmRpcmVjdGl2ZSgnYWlzVGltZWxpbmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzVGltZWxpbmVEaXJlY3RpdmVDb250cm9sbGVyJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9jaGFydHMvdGltZWxpbmUvdGltZWxpbmVEaXJlY3RpdmVUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIHRhc2tzOiAnPScsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogJz0nLFxuICAgICAgICAgICAgICAgIGVuZGVkOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZGlyZWN0aXZlKCdhaXNHcmlkUGFnaW5hdGlvbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9jb21tb24vZGlyZWN0aXZlcy9haXNHcmlkUGFnaW5hdGlvblRlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJ1xuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmRpcmVjdGl2ZSgnYWlzTXVsdGlzZWxlY3QnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgcmVxdWlyZTogJ15uZ01vZGVsJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgbXVsdGlzZWxlY3REYXRhUHJvdmlkZXI6ICc9JyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6ICc9JyxcbiAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6ICc9JyxcbiAgICAgICAgICAgICAgICBudW1iZXJEaXNwbGF5ZWQ6ICc9JyxcbiAgICAgICAgICAgICAgICBpbmNsdWRlU2VsZWN0QWxsT3B0aW9uOiAnPScsXG4gICAgICAgICAgICAgICAgbm9uU2VsZWN0ZWRUZXh0OiAnPScsXG4gICAgICAgICAgICAgICAgbmdNb2RlbDogJz0nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50WzBdKTtcblxuICAgICAgICAgICAgICAgIGVsZW1lbnQubXVsdGlzZWxlY3Qoe1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IHNjb3BlLmVuYWJsZUZpbHRlcmluZyxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlQ2FzZUluc2Vuc2l0aXZlRmlsdGVyaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBtYXhIZWlnaHQ6IHNjb3BlLm1heEhlaWdodCB8fCAzMDAsXG4gICAgICAgICAgICAgICAgICAgIG51bWJlckRpc3BsYXllZDogc2NvcGUubnVtYmVyRGlzcGxheWVkIHx8IDMsXG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGVTZWxlY3RBbGxPcHRpb246IHNjb3BlLmluY2x1ZGVTZWxlY3RBbGxPcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIG5vblNlbGVjdGVkVGV4dDogc2NvcGUubm9uU2VsZWN0ZWRUZXh0IHx8ICdOb25lIFNlbGVjdGVkJyxcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIChvcHRpb25FbGVtZW50LCBjaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5nTW9kZWwgPSBlbGVtZW50LnZhbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ211bHRpc2VsZWN0RGF0YVByb3ZpZGVyJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQubXVsdGlzZWxlY3QoJ2RhdGFwcm92aWRlcicsIG5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgLy8gV2F0Y2ggZm9yIGFueSBjaGFuZ2VzIHRvIHRoZSBsZW5ndGggb2Ygb3VyIHNlbGVjdCBlbGVtZW50XG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRbMF07XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlYnVnZ2VyO1xuICAgICAgICAgICAgICAgICAgICAvL2VsZW1lbnQubXVsdGlzZWxlY3QoJ3NldE9wdGlvbnMnLCBlbGVtZW50WzBdKTtcbiAgICAgICAgICAgICAgICAgICAgLy9lbGVtZW50Lm11bHRpc2VsZWN0KCdyZWJ1aWxkJyk7XG4gICAgICAgICAgICAgICAgfSwgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICAvLyBXYXRjaCBmb3IgYW55IGNoYW5nZXMgZnJvbSBvdXRzaWRlIHRoZSBkaXJlY3RpdmUgYW5kIHJlZnJlc2hcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goYXR0cmlidXRlcy5uZ01vZGVsLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQubXVsdGlzZWxlY3QoJ3JlZnJlc2gnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdnYXVnZUZhY3RvcnknLCBmdW5jdGlvbiAoc2NhbGVDb25maWcpIHtcbiAgICAgICAgdmFyIEdhdWdlID0gZnVuY3Rpb24gKHBsYWNlaG9sZGVyTmFtZSwgY29uZmlndXJhdGlvbilcbiAgICAgICAge1xuICAgICAgICAgICAgdGhpcy5wbGFjZWhvbGRlck5hbWUgPSBwbGFjZWhvbGRlck5hbWU7XG5cbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsgLy8gZm9yIGludGVybmFsIGQzIGZ1bmN0aW9uc1xuXG4gICAgICAgICAgICB0aGlzLmNvbmZpZ3VyZSA9IGZ1bmN0aW9uKGNvbmZpZ3VyYXRpb24pXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcgPSBjb25maWd1cmF0aW9uO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcuc2l6ZSA9IHRoaXMuY29uZmlnLnNpemUgKiAwLjk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5yYWRpdXMgPSB0aGlzLmNvbmZpZy5zaXplICogMC45NyAvIDI7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcuY3ggPSB0aGlzLmNvbmZpZy5zaXplIC8gMjtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5jeSA9IHRoaXMuY29uZmlnLnNpemUgLyAyO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcubWluID0gdW5kZWZpbmVkICE9IGNvbmZpZ3VyYXRpb24ubWluID8gY29uZmlndXJhdGlvbi5taW4gOiAwO1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLm1heCA9IHVuZGVmaW5lZCAhPSBjb25maWd1cmF0aW9uLm1heCA/IGNvbmZpZ3VyYXRpb24ubWF4IDogMTAwO1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLnJhbmdlID0gdGhpcy5jb25maWcubWF4IC0gdGhpcy5jb25maWcubWluO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcubWFqb3JUaWNrcyA9IGNvbmZpZ3VyYXRpb24ubWFqb3JUaWNrcyB8fCA1O1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLm1pbm9yVGlja3MgPSBjb25maWd1cmF0aW9uLm1pbm9yVGlja3MgfHwgMjtcblxuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmdyZWVuQ29sb3IgXHQ9IGNvbmZpZ3VyYXRpb24uZ3JlZW5Db2xvciB8fCAnIzhmY2EwZSc7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcueWVsbG93Q29sb3IgPSBjb25maWd1cmF0aW9uLnllbGxvd0NvbG9yIHx8ICcjZmZjMzE3JztcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5yZWRDb2xvciBcdD0gY29uZmlndXJhdGlvbi5yZWRDb2xvciB8fCAnI2Y1NGQzNic7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcuZ3JheUNvbG9yICAgPSBjb25maWd1cmF0aW9uLmdyYXlDb2xvciB8fCAnI2FhYSc7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy50cmFuc2l0aW9uRHVyYXRpb24gPSBjb25maWd1cmF0aW9uLnRyYW5zaXRpb25EdXJhdGlvbiB8fCA1MDA7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLnJlbmRlciA9IGZ1bmN0aW9uKClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJvZHkgPSBkMy5zZWxlY3QoJyMnICsgdGhpcy5wbGFjZWhvbGRlck5hbWUpXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJ3N2ZzpzdmcnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnZ2F1Z2UnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignd2lkdGgnLCB0aGlzLmNvbmZpZy5zaXplKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgdGhpcy5jb25maWcuc2l6ZSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKCdzdmc6Y2lyY2xlJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ291dGVyLWNpcmNsZScpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjeCcsIHRoaXMuY29uZmlnLmN4KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignY3knLCB0aGlzLmNvbmZpZy5jeSlcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3InLCB0aGlzLmNvbmZpZy5yYWRpdXMpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsICcjY2NjJyk7XG4gICAgICAgICAgICAgICAgLyouc3R5bGUoJ3N0cm9rZScsICcjMDAwJylcbiAgICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2Utd2lkdGgnLCAnMC41cHgnKTsqL1xuXG4gICAgICAgICAgICAgICAgdGhpcy5ib2R5LmFwcGVuZCgnc3ZnOmNpcmNsZScpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjeCcsIHRoaXMuY29uZmlnLmN4KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignY3knLCB0aGlzLmNvbmZpZy5jeSlcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3InLCAwLjkgKiB0aGlzLmNvbmZpZy5yYWRpdXMpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsICcjZmZmJylcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2UnLCAnI2UwZTBlMCcpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlLXdpZHRoJywgJzJweCcpO1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgZ3JlZW5JZHggaW4gdGhpcy5jb25maWcuZ3JlZW5ab25lcylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhd0JhbmQodGhpcy5jb25maWcuZ3JlZW5ab25lc1tncmVlbklkeF0uZnJvbSwgdGhpcy5jb25maWcuZ3JlZW5ab25lc1tncmVlbklkeF0udG8sIHNlbGYuY29uZmlnLmdyZWVuQ29sb3IpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGZvciAodmFyIHllbGxvd0lkeCBpbiB0aGlzLmNvbmZpZy55ZWxsb3dab25lcylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhd0JhbmQodGhpcy5jb25maWcueWVsbG93Wm9uZXNbeWVsbG93SWR4XS5mcm9tLCB0aGlzLmNvbmZpZy55ZWxsb3dab25lc1t5ZWxsb3dJZHhdLnRvLCBzZWxmLmNvbmZpZy55ZWxsb3dDb2xvcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgcmVkSWR4IGluIHRoaXMuY29uZmlnLnJlZFpvbmVzKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmF3QmFuZCh0aGlzLmNvbmZpZy5yZWRab25lc1tyZWRJZHhdLmZyb20sIHRoaXMuY29uZmlnLnJlZFpvbmVzW3JlZElkeF0udG8sIHNlbGYuY29uZmlnLnJlZENvbG9yKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgZm9udFNpemUgPSAwO1xuXG4gICAgICAgICAgICAgICAgaWYgKHVuZGVmaW5lZCAhPSB0aGlzLmNvbmZpZy5sYWJlbClcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGZvbnRTaXplID0gTWF0aC5yb3VuZCh0aGlzLmNvbmZpZy5zaXplIC8gOSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYm9keS5hcHBlbmQoJ3N2Zzp0ZXh0JylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneScsIHRoaXMuY29uZmlnLmN5IC8gMiArIGZvbnRTaXplIC8gMilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdkeScsIGZvbnRTaXplIC8gMilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQodGhpcy5jb25maWcubGFiZWwpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZvbnQtc2l6ZScsIGZvbnRTaXplICsgJ3B4JylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsICcjMzMzJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlLXdpZHRoJywgJzBweCcpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGZvbnRTaXplID0gTWF0aC5yb3VuZCh0aGlzLmNvbmZpZy5zaXplIC8gMTYpO1xuICAgICAgICAgICAgICAgIHZhciBtYWpvckRlbHRhID0gdGhpcy5jb25maWcucmFuZ2UgLyAodGhpcy5jb25maWcubWFqb3JUaWNrcyAtIDEpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIG1ham9yID0gdGhpcy5jb25maWcubWluOyBtYWpvciA8PSB0aGlzLmNvbmZpZy5tYXg7IG1ham9yICs9IG1ham9yRGVsdGEpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWlub3JEZWx0YSA9IG1ham9yRGVsdGEgLyB0aGlzLmNvbmZpZy5taW5vclRpY2tzLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQxID0gMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50MiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIG1pbm9yID0gbWFqb3IgKyBtaW5vckRlbHRhOyBtaW5vciA8IE1hdGgubWluKG1ham9yICsgbWFqb3JEZWx0YSwgdGhpcy5jb25maWcubWF4KTsgbWlub3IgKz0gbWlub3JEZWx0YSlcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQxID0gdGhpcy52YWx1ZVRvUG9pbnQobWlub3IsIDAuNzUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQyID0gdGhpcy52YWx1ZVRvUG9pbnQobWlub3IsIDAuODUpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKCdzdmc6bGluZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3gxJywgcG9pbnQxLngpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3kxJywgcG9pbnQxLnkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3gyJywgcG9pbnQyLngpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3kyJywgcG9pbnQyLnkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2UnLCAnIzY2NicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2Utd2lkdGgnLCAnMXB4Jyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBwb2ludDEgPSB0aGlzLnZhbHVlVG9Qb2ludChtYWpvciwgMC43KTtcbiAgICAgICAgICAgICAgICAgICAgcG9pbnQyID0gdGhpcy52YWx1ZVRvUG9pbnQobWFqb3IsIDAuODUpO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYm9keS5hcHBlbmQoJ3N2ZzpsaW5lJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd4MScsIHBvaW50MS54KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3kxJywgcG9pbnQxLnkpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneDInLCBwb2ludDIueClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd5MicsIHBvaW50Mi55KVxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2UnLCAnIzMzMycpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZS13aWR0aCcsICcycHgnKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAobWFqb3IgPT0gdGhpcy5jb25maWcubWluIHx8IG1ham9yID09IHRoaXMuY29uZmlnLm1heClcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50ID0gdGhpcy52YWx1ZVRvUG9pbnQobWFqb3IsIDAuNjMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKCdzdmc6dGV4dCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCBwb2ludC54KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgcG9pbnQueSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cignZHknLCBmb250U2l6ZSAvIDMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgbWFqb3IgPT0gdGhpcy5jb25maWcubWluID8gJ3N0YXJ0JyA6ICdlbmQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KG1ham9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgZm9udFNpemUgKyAncHgnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsICcjMzMzJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZS13aWR0aCcsICcwcHgnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBwb2ludGVyQ29udGFpbmVyID0gdGhpcy5ib2R5LmFwcGVuZCgnc3ZnOmcnKS5hdHRyKCdjbGFzcycsICdwb2ludGVyQ29udGFpbmVyJyk7XG5cbiAgICAgICAgICAgICAgICB2YXIgbWlkVmFsdWUgPSAodGhpcy5jb25maWcubWluICsgdGhpcy5jb25maWcubWF4KSAvIDI7XG5cbiAgICAgICAgICAgICAgICB2YXIgcG9pbnRlclBhdGggPSB0aGlzLmJ1aWxkUG9pbnRlclBhdGgobWlkVmFsdWUpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHBvaW50ZXJMaW5lID0gZDMuc3ZnLmxpbmUoKVxuICAgICAgICAgICAgICAgICAgICAueChmdW5jdGlvbihkKSB7IHJldHVybiBkLnggfSlcbiAgICAgICAgICAgICAgICAgICAgLnkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC55IH0pXG4gICAgICAgICAgICAgICAgICAgIC5pbnRlcnBvbGF0ZSgnYmFzaXMnKTtcblxuICAgICAgICAgICAgICAgIHBvaW50ZXJDb250YWluZXIuc2VsZWN0QWxsKCdwYXRoJylcbiAgICAgICAgICAgICAgICAgICAgLmRhdGEoW3BvaW50ZXJQYXRoXSlcbiAgICAgICAgICAgICAgICAgICAgLmVudGVyKClcbiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgnc3ZnOnBhdGgnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignZCcsIHBvaW50ZXJMaW5lKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnIzg4OCcpO1xuXG4gICAgICAgICAgICAgICAgcG9pbnRlckNvbnRhaW5lci5hcHBlbmQoJ3N2ZzpjaXJjbGUnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignY3gnLCB0aGlzLmNvbmZpZy5jeClcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2N5JywgdGhpcy5jb25maWcuY3kpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdyJywgMC4wNyAqIHRoaXMuY29uZmlnLnJhZGl1cylcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgJyM4ODgnKTtcblxuICAgICAgICAgICAgICAgIGZvbnRTaXplID0gTWF0aC5yb3VuZCh0aGlzLmNvbmZpZy5zaXplIC8gMTApO1xuICAgICAgICAgICAgICAgIHBvaW50ZXJDb250YWluZXIuc2VsZWN0QWxsKCd0ZXh0JylcbiAgICAgICAgICAgICAgICAgICAgLmRhdGEoW21pZFZhbHVlXSlcbiAgICAgICAgICAgICAgICAgICAgLmVudGVyKClcbiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgnc3ZnOnRleHQnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cigneCcsIHRoaXMuY29uZmlnLmN4KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cigneScsIHRoaXMuY29uZmlnLnNpemUgLSB0aGlzLmNvbmZpZy5jeSAvIDQgLSBmb250U2l6ZSlcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2R5JywgZm9udFNpemUgLyAyKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnbWlkZGxlJylcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmb250LXNpemUnLCBmb250U2l6ZSArICdweCcpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsICcjMDAwJylcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2Utd2lkdGgnLCAnMHB4Jyk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnJlZHJhdyh0aGlzLmNvbmZpZy5taW4sIDApO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy5idWlsZFBvaW50ZXJQYXRoID0gZnVuY3Rpb24odmFsdWUpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIGRlbHRhID0gdGhpcy5jb25maWcucmFuZ2UgLyAxMztcblxuICAgICAgICAgICAgICAgIHZhciBoZWFkID0gdmFsdWVUb1BvaW50KHZhbHVlLCAwLjg1KTtcbiAgICAgICAgICAgICAgICB2YXIgaGVhZDEgPSB2YWx1ZVRvUG9pbnQodmFsdWUgLSBkZWx0YSwgMC4xMik7XG4gICAgICAgICAgICAgICAgdmFyIGhlYWQyID0gdmFsdWVUb1BvaW50KHZhbHVlICsgZGVsdGEsIDAuMTIpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHRhaWxWYWx1ZSA9IHZhbHVlIC0gKHRoaXMuY29uZmlnLnJhbmdlICogKDEvKDI3MC8zNjApKSAvIDIpO1xuICAgICAgICAgICAgICAgIHZhciB0YWlsID0gdmFsdWVUb1BvaW50KHRhaWxWYWx1ZSwgMC4yOCk7XG4gICAgICAgICAgICAgICAgdmFyIHRhaWwxID0gdmFsdWVUb1BvaW50KHRhaWxWYWx1ZSAtIGRlbHRhLCAwLjEyKTtcbiAgICAgICAgICAgICAgICB2YXIgdGFpbDIgPSB2YWx1ZVRvUG9pbnQodGFpbFZhbHVlICsgZGVsdGEsIDAuMTIpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtoZWFkLCBoZWFkMSwgdGFpbDIsIHRhaWwsIHRhaWwxLCBoZWFkMiwgaGVhZF07XG5cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiB2YWx1ZVRvUG9pbnQodmFsdWUsIGZhY3RvcilcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwb2ludCA9IHNlbGYudmFsdWVUb1BvaW50KHZhbHVlLCBmYWN0b3IpO1xuICAgICAgICAgICAgICAgICAgICBwb2ludC54IC09IHNlbGYuY29uZmlnLmN4O1xuICAgICAgICAgICAgICAgICAgICBwb2ludC55IC09IHNlbGYuY29uZmlnLmN5O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9pbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy5kcmF3QmFuZCA9IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGNvbG9yKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlmICgwID49IGVuZCAtIHN0YXJ0KSByZXR1cm47XG5cbiAgICAgICAgICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKCdzdmc6cGF0aCcpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIGNvbG9yKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignZCcsIGQzLnN2Zy5hcmMoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0YXJ0QW5nbGUodGhpcy52YWx1ZVRvUmFkaWFucyhzdGFydCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZW5kQW5nbGUodGhpcy52YWx1ZVRvUmFkaWFucyhlbmQpKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmlubmVyUmFkaXVzKDAuNjUgKiB0aGlzLmNvbmZpZy5yYWRpdXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAub3V0ZXJSYWRpdXMoMC44NSAqIHRoaXMuY29uZmlnLnJhZGl1cykpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbigpIHsgcmV0dXJuICd0cmFuc2xhdGUoJyArIHNlbGYuY29uZmlnLmN4ICsgJywgJyArIHNlbGYuY29uZmlnLmN5ICsgJykgcm90YXRlKDI3MCknIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy5yZWRyYXcgPSBmdW5jdGlvbih2YWx1ZSwgdHJhbnNpdGlvbkR1cmF0aW9uKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhciBpc0Rpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICBpc0Rpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgcG9pbnRlckNvbnRhaW5lciA9IHRoaXMuYm9keS5zZWxlY3QoJy5wb2ludGVyQ29udGFpbmVyJyk7XG5cbiAgICAgICAgICAgICAgICBwb2ludGVyQ29udGFpbmVyLnNlbGVjdEFsbCgndGV4dCcpLnRleHQocGFyc2VGbG9hdCh2YWx1ZSkudG9GaXhlZCgyKSArICclJyk7XG5cbiAgICAgICAgICAgICAgICB2YXIgcG9pbnRlciA9IHBvaW50ZXJDb250YWluZXIuc2VsZWN0QWxsKCdwYXRoJyk7XG4gICAgICAgICAgICAgICAgcG9pbnRlci50cmFuc2l0aW9uKClcbiAgICAgICAgICAgICAgICAgICAgLmR1cmF0aW9uKHVuZGVmaW5lZCAhPSB0cmFuc2l0aW9uRHVyYXRpb24gPyB0cmFuc2l0aW9uRHVyYXRpb24gOiB0aGlzLmNvbmZpZy50cmFuc2l0aW9uRHVyYXRpb24pXG4gICAgICAgICAgICAgICAgICAgIC8vLmRlbGF5KDApXG4gICAgICAgICAgICAgICAgICAgIC8vLmVhc2UoJ2xpbmVhcicpXG4gICAgICAgICAgICAgICAgICAgIC8vLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uKGQpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyVHdlZW4oJ3RyYW5zZm9ybScsIGZ1bmN0aW9uKClcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50ZXJWYWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gc2VsZi5jb25maWcubWF4KSBwb2ludGVyVmFsdWUgPSBzZWxmLmNvbmZpZy5tYXggKyAwLjAyKnNlbGYuY29uZmlnLnJhbmdlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPCBzZWxmLmNvbmZpZy5taW4pIHBvaW50ZXJWYWx1ZSA9IHNlbGYuY29uZmlnLm1pbiAtIDAuMDIqc2VsZi5jb25maWcucmFuZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0Um90YXRpb24gPSAoc2VsZi52YWx1ZVRvRGVncmVlcyhwb2ludGVyVmFsdWUpIC0gOTApO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRSb3RhdGlvbiA9IHNlbGYuX2N1cnJlbnRSb3RhdGlvbiB8fCB0YXJnZXRSb3RhdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2N1cnJlbnRSb3RhdGlvbiA9IHRhcmdldFJvdGF0aW9uO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oc3RlcClcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm90YXRpb24gPSBjdXJyZW50Um90YXRpb24gKyAodGFyZ2V0Um90YXRpb24tY3VycmVudFJvdGF0aW9uKSpzdGVwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAndHJhbnNsYXRlKCcgKyBzZWxmLmNvbmZpZy5jeCArICcsICcgKyBzZWxmLmNvbmZpZy5jeSArICcpIHJvdGF0ZSgnICsgcm90YXRpb24gKyAnKSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIG91dGVyQ2lyY2xlID0gdGhpcy5ib2R5LnNlbGVjdCgnLm91dGVyLWNpcmNsZScpXG4gICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgICAgICAgICAgLmR1cmF0aW9uKDc1MClcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBwYXJzZUludCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA+PSAwICYmIGkgPCA3NSAmJiAhaXNEaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy5ncmVlbkNvbG9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpID49IDc1ICYmIGkgPCA5MCAmJiAhaXNEaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy55ZWxsb3dDb2xvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA9PT0gMCAmJiBpc0Rpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuY29uZmlnLnJlZENvbG9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcucmVkQ29sb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy52YWx1ZVRvRGVncmVlcyA9IGZ1bmN0aW9uKHZhbHVlKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIC8vIHRoYW5rcyBAY2xvc2VhbGVydFxuICAgICAgICAgICAgICAgIC8vcmV0dXJuIHZhbHVlIC8gdGhpcy5jb25maWcucmFuZ2UgKiAyNzAgLSA0NTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgLyB0aGlzLmNvbmZpZy5yYW5nZSAqIDI3MCAtICh0aGlzLmNvbmZpZy5taW4gLyB0aGlzLmNvbmZpZy5yYW5nZSAqIDI3MCArIDQ1KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMudmFsdWVUb1JhZGlhbnMgPSBmdW5jdGlvbih2YWx1ZSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZVRvRGVncmVlcyh2YWx1ZSkgKiBNYXRoLlBJIC8gMTgwO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy52YWx1ZVRvUG9pbnQgPSBmdW5jdGlvbih2YWx1ZSwgZmFjdG9yKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHJldHVybiB7IFx0eDogdGhpcy5jb25maWcuY3ggLSB0aGlzLmNvbmZpZy5yYWRpdXMgKiBmYWN0b3IgKiBNYXRoLmNvcyh0aGlzLnZhbHVlVG9SYWRpYW5zKHZhbHVlKSksXG4gICAgICAgICAgICAgICAgICAgIHk6IHRoaXMuY29uZmlnLmN5IC0gdGhpcy5jb25maWcucmFkaXVzICogZmFjdG9yICogTWF0aC5zaW4odGhpcy52YWx1ZVRvUmFkaWFucyh2YWx1ZSkpIFx0XHR9O1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gaW5pdGlhbGl6YXRpb25cbiAgICAgICAgICAgIHRoaXMuY29uZmlndXJlKGNvbmZpZ3VyYXRpb24pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjcmVhdGVHYXVnZTogZnVuY3Rpb24gKG5hbWUsIGxhYmVsLCBtaW4sIG1heCwgc2l6ZSkge1xuICAgICAgICAgICAgICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgICAgICAgICAgICAgIHNpemU6IHNpemUgfHwgc2NhbGVDb25maWcuZGVmYXVsdEdhdWdlV2lkdGgsXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBsYWJlbCxcbiAgICAgICAgICAgICAgICAgICAgbWluOiBtaW4gfHwgMCxcbiAgICAgICAgICAgICAgICAgICAgbWF4OiBtYXggfHwgMTAwLFxuICAgICAgICAgICAgICAgICAgICBtaW5vclRpY2tzOiA1XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IGNvbmZpZy5tYXggLSBjb25maWcubWluO1xuICAgICAgICAgICAgICAgIGNvbmZpZy55ZWxsb3dab25lcyA9IFt7IGZyb206IGNvbmZpZy5taW4gKyByYW5nZSowLjc1LCB0bzogY29uZmlnLm1pbiArIHJhbmdlKjAuOSB9XTtcbiAgICAgICAgICAgICAgICBjb25maWcucmVkWm9uZXMgPSBbeyBmcm9tOiBjb25maWcubWluICsgcmFuZ2UqMC45LCB0bzogY29uZmlnLm1heCB9XTtcblxuICAgICAgICAgICAgICAgIHZhciBnYXVnZSA9IG5ldyBHYXVnZShuYW1lICsgJ0dhdWdlQ29udGFpbmVyJywgY29uZmlnKTtcbiAgICAgICAgICAgICAgICBnYXVnZS5yZW5kZXIoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2F1Z2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdncmlkRmFjdG9yeScsIGZ1bmN0aW9uICh1aUdyaWRDb25zdGFudHMpIHtcblxuICAgICAgICB2YXIgZ2V0U29ydENvbmZpZyA9IGZ1bmN0aW9uIChvcmRlclBhcmFtKSB7XG4gICAgICAgICAgICB2YXIgc29ydEFyciA9IFtdO1xuXG4gICAgICAgICAgICBpZiAob3JkZXJQYXJhbSkge1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChvcmRlclBhcmFtLCBmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNvcnRGaWVsZCA9IHBhcmFtO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc29ydERpcmVjdGlvbiA9ICdhc2MnO1xuICAgICAgICAgICAgICAgICAgICBpZiAoXy5zdGFydHNXaXRoKHBhcmFtLCAnLScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3J0RGlyZWN0aW9uID0gJ2Rlc2MnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHNvcnRBcnIucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246IHNvcnREaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogc29ydEZpZWxkXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBzb3J0QXJyO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBkZWZhdWx0R3JpZE9wdGlvbnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVSb3dTZWxlY3Rpb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZVJvd0hlYWRlclNlbGVjdGlvbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZUhvcml6b250YWxTY3JvbGxiYXI6IHVpR3JpZENvbnN0YW50cy5zY3JvbGxiYXJzLk5FVkVSLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVWZXJ0aWNhbFNjcm9sbGJhcjogdWlHcmlkQ29uc3RhbnRzLnNjcm9sbGJhcnMuTkVWRVIsXG4gICAgICAgICAgICAgICAgICAgIG11bHRpU2VsZWN0OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB1c2VFeHRlcm5hbFNvcnRpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHVzZUV4dGVybmFsRmlsdGVyaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVTb3J0aW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBtaW5Sb3dzVG9TaG93OiAxNyxcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvblBhZ2VTaXplczogWzI1LCA1MCwgNzUsIDEwMF0sXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb25QYWdlU2l6ZTogMjUsXG4gICAgICAgICAgICAgICAgICAgIHVzZUV4dGVybmFsUGFnaW5hdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlUGFnaW5hdGlvbkNvbnRyb2xzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbkN1cnJlbnRQYWdlOiAxXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFwcGx5U29ydENvbmZpZzogZnVuY3Rpb24gKGNvbHVtbkRlZnMsIGdyaWRQYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgc29ydENvbmZpZyA9IGdldFNvcnRDb25maWcoZ3JpZFBhcmFtcy5vcmRlcik7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHNvcnRDb25maWcsIGZ1bmN0aW9uIChjb25maWcsIGlkeCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGQgPSBfLnN0YXJ0c1dpdGgoY29uZmlnLmZpZWxkLCAnLScpID8gY29uZmlnLmZpZWxkLnN1YnN0cmluZygxKSA6IGNvbmZpZy5maWVsZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbERlZiA9IF8uZmluZChjb2x1bW5EZWZzLCB7ZmllbGQ6IGZpZWxkfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbERlZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sRGVmLnNvcnQgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBjb25maWcuZGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW9yaXR5OiBpZHhcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sdW1uRGVmcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgncG9sbGVyRmFjdG9yeScsIGZ1bmN0aW9uIChwb2xsZXIpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5ld1BvbGxlcjogZnVuY3Rpb24gKHJlc291cmNlLCBpbnRlcnZhbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwb2xsZXIuZ2V0KHJlc291cmNlLCB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGF5OiBpbnRlcnZhbCxcbiAgICAgICAgICAgICAgICAgICAgY2F0Y2hFcnJvcjogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnU3RhdHVzJywgZnVuY3Rpb24gKFN0YXR1c01hc3RlciwgU3RhdHVzU2NoZWR1bGVyLCBTdGF0dXNSZXNvdXJjZXMpIHtcbiAgICAgICAgdmFyIFN0YXR1cyA9IGZ1bmN0aW9uICgkcmVzb2x2ZWQsIG1hc3Rlciwgc2NoZWR1bGVyLCBxdWV1ZV9kZXB0aCwgcmVzb3VyY2VzKSB7XG4gICAgICAgICAgICB0aGlzLiRyZXNvbHZlZCA9ICRyZXNvbHZlZDtcbiAgICAgICAgICAgIHRoaXMubWFzdGVyID0gU3RhdHVzTWFzdGVyLnRyYW5zZm9ybWVyKG1hc3Rlcik7XG4gICAgICAgICAgICB0aGlzLnNjaGVkdWxlciA9IFN0YXR1c1NjaGVkdWxlci50cmFuc2Zvcm1lcihzY2hlZHVsZXIpO1xuICAgICAgICAgICAgdGhpcy5xdWV1ZV9kZXB0aCA9IHF1ZXVlX2RlcHRoO1xuICAgICAgICAgICAgdGhpcy5yZXNvdXJjZXMgPSBTdGF0dXNSZXNvdXJjZXMudHJhbnNmb3JtZXIocmVzb3VyY2VzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBTdGF0dXMucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgZ2V0Q3B1VXNhZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXNvdXJjZXMuc2NoZWR1bGVkLmNwdXMgJiYgdGhpcy5yZXNvdXJjZXMudG90YWwuY3B1cykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXNvdXJjZXMudG90YWwuY3B1cyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoKHRoaXMucmVzb3VyY2VzLnNjaGVkdWxlZC5jcHVzIC8gdGhpcy5yZXNvdXJjZXMudG90YWwuY3B1cykgKiAxMDApLnRvRml4ZWQoMik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIDAuMDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0TWVtVXNhZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXNvdXJjZXMuc2NoZWR1bGVkLm1lbSAmJiB0aGlzLnJlc291cmNlcy50b3RhbC5tZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzb3VyY2VzLnRvdGFsLm1lbSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoKHRoaXMucmVzb3VyY2VzLnNjaGVkdWxlZC5tZW0gLyB0aGlzLnJlc291cmNlcy50b3RhbC5tZW0pICogMTAwKS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiAwLjAwO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldERpc2tVc2FnZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlc291cmNlcy5zY2hlZHVsZWQuZGlzayAmJiB0aGlzLnJlc291cmNlcy50b3RhbC5kaXNrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlc291cmNlcy50b3RhbC5kaXNrID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgodGhpcy5yZXNvdXJjZXMuc2NoZWR1bGVkLmRpc2sgLyB0aGlzLnJlc291cmNlcy50b3RhbC5kaXNrKSAqIDEwMCkudG9GaXhlZCgyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gMC4wMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgU3RhdHVzLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0dXMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuJHJlc29sdmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1hc3RlcixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zY2hlZHVsZXIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucXVldWVfZGVwdGgsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzb3VyY2VzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdHVzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgU3RhdHVzLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFN0YXR1cy5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBTdGF0dXMuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFN0YXR1cztcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnU3RhdHVzTWFzdGVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgU3RhdHVzTWFzdGVyID0gZnVuY3Rpb24gKGlzX29ubGluZSwgaG9zdG5hbWUsIHBvcnQpIHtcbiAgICAgICAgICAgIHRoaXMuaXNfb25saW5lID0gaXNfb25saW5lO1xuICAgICAgICAgICAgdGhpcy5ob3N0bmFtZSA9IGhvc3RuYW1lO1xuICAgICAgICAgICAgdGhpcy5wb3J0ID0gcG9ydDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBTdGF0dXNNYXN0ZXIucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFN0YXR1c01hc3Rlci5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdHVzTWFzdGVyKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX29ubGluZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5ob3N0bmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wb3J0XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdHVzTWFzdGVyKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgU3RhdHVzTWFzdGVyLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFN0YXR1c01hc3Rlci5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBTdGF0dXNNYXN0ZXIuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFN0YXR1c01hc3RlcjtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdTdGF0dXNSZXNvdXJjZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIFN0YXR1c1Jlc291cmNlID0gZnVuY3Rpb24gKGNwdXMsIG1lbSwgZGlzaykge1xuICAgICAgICAgICAgdGhpcy5jcHVzID0gY3B1cztcbiAgICAgICAgICAgIHRoaXMubWVtID0gbWVtO1xuICAgICAgICAgICAgdGhpcy5kaXNrID0gZGlzaztcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBTdGF0dXNSZXNvdXJjZS5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgU3RhdHVzUmVzb3VyY2UuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN0YXR1c1Jlc291cmNlKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNwdXMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVtLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0dXNSZXNvdXJjZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFN0YXR1c1Jlc291cmNlLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFN0YXR1c1Jlc291cmNlLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFN0YXR1c1Jlc291cmNlLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBTdGF0dXNSZXNvdXJjZTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdTdGF0dXNSZXNvdXJjZXMnLCBmdW5jdGlvbiAoU3RhdHVzUmVzb3VyY2UpIHtcbiAgICAgICAgdmFyIFN0YXR1c1Jlc291cmNlcyA9IGZ1bmN0aW9uICh0b3RhbCwgc2NoZWR1bGVkLCB1c2VkKSB7XG4gICAgICAgICAgICB0aGlzLnRvdGFsID0gU3RhdHVzUmVzb3VyY2UudHJhbnNmb3JtZXIodG90YWwpO1xuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZWQgPSBTdGF0dXNSZXNvdXJjZS50cmFuc2Zvcm1lcihzY2hlZHVsZWQpO1xuICAgICAgICAgICAgdGhpcy51c2VkID0gU3RhdHVzUmVzb3VyY2UudHJhbnNmb3JtZXIodXNlZCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgU3RhdHVzUmVzb3VyY2VzLnByb3RvdHlwZSA9IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBTdGF0dXNSZXNvdXJjZXMuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN0YXR1c1Jlc291cmNlcyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50b3RhbCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zY2hlZHVsZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudXNlZFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFN0YXR1c1Jlc291cmNlcygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFN0YXR1c1Jlc291cmNlcy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChTdGF0dXNSZXNvdXJjZXMuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gU3RhdHVzUmVzb3VyY2VzLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBTdGF0dXNSZXNvdXJjZXM7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnU3RhdHVzU2NoZWR1bGVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgU3RhdHVzU2NoZWR1bGVyID0gZnVuY3Rpb24gKGlzX29ubGluZSwgaXNfcGF1c2VkLCBob3N0bmFtZSkge1xuICAgICAgICAgICAgdGhpcy5pc19vbmxpbmUgPSBpc19vbmxpbmU7XG4gICAgICAgICAgICB0aGlzLmlzX3BhdXNlZCA9IGlzX3BhdXNlZDtcbiAgICAgICAgICAgIHRoaXMuaG9zdG5hbWUgPSBob3N0bmFtZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBTdGF0dXNTY2hlZHVsZXIucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFN0YXR1c1NjaGVkdWxlci5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdHVzU2NoZWR1bGVyKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX29ubGluZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19wYXVzZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaG9zdG5hbWVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0dXNTY2hlZHVsZXIoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBTdGF0dXNTY2hlZHVsZXIudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoU3RhdHVzU2NoZWR1bGVyLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFN0YXR1c1NjaGVkdWxlci5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gU3RhdHVzU2NoZWR1bGVyO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ3NjYWxlU2VydmljZScsIGZ1bmN0aW9uICgkcSwgJGh0dHAsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIGZ1bmN0aW9uIHBhZFdpdGhaZXJvIChpbnB1dCwgbGVuZ3RoKSB7XG4gICAgICAgICAgICAvLyBDYXN0IGlucHV0IHRvIHN0cmluZ1xuICAgICAgICAgICAgaW5wdXQgPSAnJyArIGlucHV0O1xuXG4gICAgICAgICAgICB2YXIgcGFkZGluZ1NpemUgPSBNYXRoLm1heCgwLCBsZW5ndGggLSBpbnB1dC5sZW5ndGgpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBBcnJheShwYWRkaW5nU2l6ZSA+IDAgPyBwYWRkaW5nU2l6ZSArIDEgOiAwKS5qb2luKCcwJykgKyBpbnB1dDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjYWxjdWxhdGVGaWxlU2l6ZUZyb21NaWI6IGZ1bmN0aW9uKG51bSl7XG4gICAgICAgICAgICAgICAgaWYgKG51bSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bSA8IDEwMjQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudW0udG9GaXhlZCgyKSArICcgTUInO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChudW0gPj0gMTAyNCAmJiBudW0gPCAxMDI0KjEwMjQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAobnVtLzEwMjQpLnRvRml4ZWQoMikgKyAnIEdCJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKG51bS8xMDI0LzEwMjQpLnRvRml4ZWQoMikgKyAnIFRCJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYWxjdWxhdGVGaWxlU2l6ZUZyb21CeXRlczogZnVuY3Rpb24obnVtLGRlY2ltYWxzKXtcbiAgICAgICAgICAgICAgICBpZiAobnVtID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobnVtIDwgMTAyNCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bS50b0ZpeGVkKGRlY2ltYWxzKSArICcgQnl0ZXMnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChudW0gPj0gMTAyNCAmJiBudW0gPCAxMDI0KjEwMjQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAobnVtLzEwMjQpLnRvRml4ZWQoZGVjaW1hbHMpICsgJyBLQic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bSA+PSAxMDI0KjEwMjQgJiYgbnVtIDwgMTAyNCoxMDI0KjEwMjQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAobnVtLzEwMjQvMTAyNCkudG9GaXhlZChkZWNpbWFscykgKyAnIE1CJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobnVtID49IDEwMjQqMTAyNCoxMDI0ICYmIG51bSA8IDEwMjQqMTAyNCoxMDI0KjEwMjQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAobnVtLzEwMjQvMTAyNC8xMDI0KS50b0ZpeGVkKGRlY2ltYWxzKSArICcgR0InO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAobnVtLzEwMjQvMTAyNC8xMDI0LzEwMjQpLnRvRml4ZWQoZGVjaW1hbHMpICsgJyBUQic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBudW07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Vmlld3BvcnRTaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHcgPSB3aW5kb3csXG4gICAgICAgICAgICAgICAgICAgIGQgPSBkb2N1bWVudCxcbiAgICAgICAgICAgICAgICAgICAgZSA9IGQuZG9jdW1lbnRFbGVtZW50LFxuICAgICAgICAgICAgICAgICAgICBnID0gZG9jdW1lbnQuYm9keSxcbiAgICAgICAgICAgICAgICAgICAgeCA9IHcuaW5uZXJXaWR0aCB8fCBlLmNsaWVudFdpZHRoIHx8IGcuY2xpZW50V2lkdGgsXG4gICAgICAgICAgICAgICAgICAgIHkgPSB3LmlubmVySGVpZ2h0IHx8IGUuY2xpZW50SGVpZ2h0IHx8IGcuY2xpZW50SGVpZ2h0O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHgsXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogeVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2FsY3VsYXRlRHVyYXRpb246IGZ1bmN0aW9uIChzdGFydCwgc3RvcCkge1xuICAgICAgICAgICAgICAgIHZhciB0byA9IG1vbWVudC51dGMoc3RvcCksXG4gICAgICAgICAgICAgICAgICAgIGZyb20gPSBtb21lbnQudXRjKHN0YXJ0KSxcbiAgICAgICAgICAgICAgICAgICAgZGlmZiA9IG1vbWVudC51dGModG8pLmRpZmYobW9tZW50LnV0Yyhmcm9tKSksXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uU3RyID0gJyc7XG5cbiAgICAgICAgICAgICAgICB2YXIgZHVyYXRpb24gPSBtb21lbnQuZHVyYXRpb24oZGlmZik7XG5cbiAgICAgICAgICAgICAgICBkdXJhdGlvblN0ciA9IGR1cmF0aW9uLmRheXMoKSA+IDAgPyBkdXJhdGlvblN0ciArIHBhZFdpdGhaZXJvKGR1cmF0aW9uLmRheXMoKSwgMikgKyAnZCwgJyA6IGR1cmF0aW9uU3RyO1xuICAgICAgICAgICAgICAgIGR1cmF0aW9uU3RyID0gZHVyYXRpb24uaG91cnMoKSA+IDAgPyBkdXJhdGlvblN0ciArIHBhZFdpdGhaZXJvKGR1cmF0aW9uLmhvdXJzKCksIDIpICsgJ2gsICcgOiBkdXJhdGlvblN0cjtcbiAgICAgICAgICAgICAgICBkdXJhdGlvblN0ciA9IGR1cmF0aW9uLm1pbnV0ZXMoKSA+IDAgPyBkdXJhdGlvblN0ciArIHBhZFdpdGhaZXJvKGR1cmF0aW9uLm1pbnV0ZXMoKSwgMikgKyAnbSwgJyA6IGR1cmF0aW9uU3RyO1xuICAgICAgICAgICAgICAgIGR1cmF0aW9uU3RyID0gZHVyYXRpb25TdHIgKyBwYWRXaXRoWmVybyhkdXJhdGlvbi5zZWNvbmRzKCksIDIpICsgJ3MnO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHJldHVybiBkdXJhdGlvblN0cjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXREYXlTdHJpbmc6IGZ1bmN0aW9uKGRheU51bWJlcil7XG4gICAgICAgICAgICAgICAgdmFyIGRheUFyciA9IFsnU3VuZGF5JywnTW9uZGF5JywnVHVlc2RheScsJ1dlZG5lc2RheScsJ1RodXJzZGF5JywnRnJpZGF5JywnU2F0dXJkYXknXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF5QXJyW2RheU51bWJlcl07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNJRTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciB1YSA9IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LFxuICAgICAgICAgICAgICAgICAgICBvbGRJRSA9IHVhLmluZGV4T2YoJ01TSUUnKSxcbiAgICAgICAgICAgICAgICAgICAgbmV3SUUgPSB1YS5pbmRleE9mKCdUcmlkZW50LycpO1xuXG4gICAgICAgICAgICAgICAgaWYgKChvbGRJRSA+IC0xKSB8fCAobmV3SUUgPiAtMSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRWZXJzaW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3YnICsgc2NhbGVDb25maWcubWFqb3JWZXJzaW9uICsgJy92ZXJzaW9uLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCdcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRHcmlkSGVpZ2h0OiBmdW5jdGlvbiAob2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgLy8gc2V0IGNvbnRhaW5lciBoZWlnaHRzIGVxdWFsIHRvIGF2YWlsYWJsZSBwYWdlIGhlaWdodFxuICAgICAgICAgICAgICAgIG9mZnNldCA9IG9mZnNldCB8fCBzY2FsZUNvbmZpZy5oZWFkZXJPZmZzZXQ7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIHZpZXdwb3J0ID0gdGhpcy5nZXRWaWV3cG9ydFNpemUoKSxcbiAgICAgICAgICAgICAgICAgICAgZ3JpZE1heEhlaWdodCA9IHZpZXdwb3J0LmhlaWdodCAtIG9mZnNldDtcblxuICAgICAgICAgICAgICAgIHJldHVybiAnaGVpZ2h0OiAnICsgZ3JpZE1heEhlaWdodCArICdweDsgbWF4LWhlaWdodDogJyArIGdyaWRNYXhIZWlnaHQgKyAncHg7IG92ZXJmbG93LXk6IGF1dG87JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnc2NoZWR1bGVyU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCwgJHEsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBnZXRVcGRhdGVTY2hlZHVsZXJEYXRhID0gZnVuY3Rpb24gKGlzX3BhdXNlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBpc19wYXVzZWQ6IGlzX3BhdXNlZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdXBkYXRlU2NoZWR1bGVyOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhIHx8IGdldFVwZGF0ZVNjaGVkdWxlckRhdGEoKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnc2NoZWR1bGVyLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BBVENIJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnc3RhdGVTZXJ2aWNlJywgZnVuY3Rpb24gKCRsb2NhdGlvbikge1xuICAgICAgICB2YXIgdmVyc2lvbiA9ICcnLFxuICAgICAgICAgICAgam9ic0NvbERlZnMgPSBbXSxcbiAgICAgICAgICAgIGpvYnNQYXJhbXMgPSB7fSxcbiAgICAgICAgICAgIGpvYkV4ZWN1dGlvbnNQYXJhbXMgPSB7fSxcbiAgICAgICAgICAgIHJlY2lwZXNDb2xEZWZzID0gW10sXG4gICAgICAgICAgICBqb2JUeXBlc0ZhaWx1cmVSYXRlc1BhcmFtcyA9IHt9LFxuICAgICAgICAgICAgcmVjaXBlc1BhcmFtcyA9IHt9LFxuICAgICAgICAgICAgaW5nZXN0c0NvbERlZnMgPSBbXSxcbiAgICAgICAgICAgIGluZ2VzdHNQYXJhbXMgPSB7fSxcbiAgICAgICAgICAgIG5vZGVzQ29sRGVmcyA9IFtdLFxuICAgICAgICAgICAgbm9kZVN0YXR1c1BhcmFtcyA9IHt9LFxuICAgICAgICAgICAgc2hvd0FjdGl2ZVdvcmtzcGFjZXMgPSB0cnVlLFxuICAgICAgICAgICAgbm9kZXNQYXJhbXMgPSB7fTtcblxuICAgICAgICB2YXIgdXBkYXRlUXVlcnlzdHJpbmcgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgLy8gc2V0IGRlZmF1bHRzXG4gICAgICAgICAgICBkYXRhLnBhZ2UgPSBkYXRhLnBhZ2UgfHwgMTtcbiAgICAgICAgICAgIGRhdGEucGFnZV9zaXplID0gZGF0YS5wYWdlX3NpemUgfHwgMjU7XG4gICAgICAgICAgICBkYXRhLnN0YXJ0ZWQgPSBkYXRhLnN0YXJ0ZWQgfHwgbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICd3ZWVrcycpLnN0YXJ0T2YoJ2QnKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgZGF0YS5lbmRlZCA9IGRhdGEuZW5kZWQgfHwgbW9tZW50LnV0YygpLmVuZE9mKCdkJykudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgIGRhdGEub3JkZXIgPSBkYXRhLm9yZGVyID8gQXJyYXkuaXNBcnJheShkYXRhLm9yZGVyKSA/IGRhdGEub3JkZXIgOiBbZGF0YS5vcmRlcl0gOiBudWxsO1xuICAgICAgICAgICAgZGF0YS5zdGF0dXMgPSBkYXRhLnN0YXR1cyB8fCBudWxsO1xuICAgICAgICAgICAgLy8gY2hlY2sgZm9yIHBhcmFtcyBpbiBxdWVyeXN0cmluZywgYW5kIHVwZGF0ZSBhcyBuZWNlc3NhcnlcbiAgICAgICAgICAgIF8uZm9yRWFjaChfLnBhaXJzKGRhdGEpLCBmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKHBhcmFtWzBdLCBwYXJhbVsxXSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdEpvYnNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBkYXRhLnBhZ2UgPyBwYXJzZUludChkYXRhLnBhZ2UpIDogMSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IGRhdGEucGFnZV9zaXplID8gcGFyc2VJbnQoZGF0YS5wYWdlX3NpemUpIDogMjUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogZGF0YS5zdGFydGVkID8gZGF0YS5zdGFydGVkIDogbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICd3ZWVrcycpLnN0YXJ0T2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBkYXRhLmVuZGVkID8gZGF0YS5lbmRlZCA6IG1vbWVudC51dGMoKS5lbmRPZignZCcpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgb3JkZXI6IGRhdGEub3JkZXIgPyBBcnJheS5pc0FycmF5KGRhdGEub3JkZXIpID8gZGF0YS5vcmRlciA6IFtkYXRhLm9yZGVyXSA6IFsnLWxhc3RfbW9kaWZpZWQnXSxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IGRhdGEuc3RhdHVzID8gZGF0YS5zdGF0dXMgOiBudWxsLFxuICAgICAgICAgICAgICAgIGVycm9yX2NhdGVnb3J5OiBkYXRhLmVycm9yX2NhdGVnb3J5ID8gZGF0YS5lcnJvcl9jYXRlZ29yeSA6IG51bGwsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfaWQ6IGRhdGEuam9iX3R5cGVfaWQgPyBwYXJzZUludChkYXRhLmpvYl90eXBlX2lkKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfbmFtZTogZGF0YS5qb2JfdHlwZV9uYW1lID8gZGF0YS5qb2JfdHlwZV9uYW1lIDogbnVsbCxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9jYXRlZ29yeTogZGF0YS5qb2JfdHlwZV9jYXRlZ29yeSA/IGRhdGEuam9iX3R5cGVfY2F0ZWdvcnkgOiBudWxsLFxuICAgICAgICAgICAgICAgIHVybDogbnVsbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdEpvYkV4ZWN1dGlvbnNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBkYXRhLnBhZ2UgPyBwYXJzZUludChkYXRhLnBhZ2UpIDogMSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IGRhdGEucGFnZV9zaXplID8gcGFyc2VJbnQoZGF0YS5wYWdlX3NpemUpIDogMjUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogZGF0YS5zdGFydGVkID8gZGF0YS5zdGFydGVkIDogbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICd3ZWVrcycpLnN0YXJ0T2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBkYXRhLmVuZGVkID8gZGF0YS5lbmRlZCA6IG1vbWVudC51dGMoKS5lbmRPZignZCcpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgb3JkZXI6IGRhdGEub3JkZXIgPyBBcnJheS5pc0FycmF5KGRhdGEub3JkZXIpID8gZGF0YS5vcmRlciA6IFtkYXRhLm9yZGVyXSA6IFsnLWxhc3RfbW9kaWZpZWQnXSxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IGRhdGEuc3RhdHVzID8gZGF0YS5zdGF0dXMgOiBudWxsLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2lkOiBkYXRhLmpvYl90eXBlX2lkID8gcGFyc2VJbnQoZGF0YS5qb2JfdHlwZV9pZCkgOiBudWxsLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX25hbWU6IGRhdGEuam9iX3R5cGVfbmFtZSA/IGRhdGEuam9iX3R5cGVfbmFtZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfY2F0ZWdvcnk6IGRhdGEuam9iX3R5cGVfY2F0ZWdvcnkgPyBkYXRhLmpvYl90eXBlX2NhdGVnb3J5IDogbnVsbCxcbiAgICAgICAgICAgICAgICBub2RlX2lkOiBkYXRhLm5vZGVfaWQgPyBkYXRhLm5vZGVfaWQgOiBudWxsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0Sm9iVHlwZXNGYWlsdXJlUmF0ZXNQYXJhbXMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBudWxsLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogbnVsbCxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBudWxsLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBudWxsLFxuICAgICAgICAgICAgICAgIG5hbWU6IGRhdGEubmFtZSA/IGRhdGEubmFtZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnk6IG51bGwsXG4gICAgICAgICAgICAgICAgb3JkZXI6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRSZWNpcGVzUGFyYW1zID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogZGF0YS5wYWdlID8gcGFyc2VJbnQoZGF0YS5wYWdlKSA6IDEsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBkYXRhLnBhZ2Vfc2l6ZSA/IHBhcnNlSW50KGRhdGEucGFnZV9zaXplKSA6IDI1LFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IGRhdGEuc3RhcnRlZCA/IGRhdGEuc3RhcnRlZCA6IG1vbWVudC51dGMoKS5zdWJ0cmFjdCgxLCAnd2Vla3MnKS5zdGFydE9mKCdkJykudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBlbmRlZDogZGF0YS5lbmRlZCA/IGRhdGEuZW5kZWQgOiBtb21lbnQudXRjKCkuZW5kT2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG9yZGVyOiBkYXRhLm9yZGVyID8gQXJyYXkuaXNBcnJheShkYXRhLm9yZGVyKSA/IGRhdGEub3JkZXIgOiBbZGF0YS5vcmRlcl0gOiBbJy1sYXN0X21vZGlmaWVkJ10sXG4gICAgICAgICAgICAgICAgdHlwZV9pZDogZGF0YS50eXBlX2lkID8gcGFyc2VJbnQoZGF0YS50eXBlX2lkKSA6IG51bGwsXG4gICAgICAgICAgICAgICAgdHlwZV9uYW1lOiBkYXRhLnR5cGVfbmFtZSA/IGRhdGEudHlwZV9uYW1lIDogbnVsbCxcbiAgICAgICAgICAgICAgICB1cmw6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRJbmdlc3RzUGFyYW1zID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogZGF0YS5wYWdlID8gcGFyc2VJbnQoZGF0YS5wYWdlKSA6IDEsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBkYXRhLnBhZ2Vfc2l6ZSA/IHBhcnNlSW50KGRhdGEucGFnZV9zaXplKSA6IDI1LFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IGRhdGEuc3RhcnRlZCA/IGRhdGEuc3RhcnRlZCA6IG1vbWVudC51dGMoKS5zdWJ0cmFjdCgxLCAnd2Vla3MnKS5zdGFydE9mKCdkJykudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBlbmRlZDogZGF0YS5lbmRlZCA/IGRhdGEuZW5kZWQgOiBtb21lbnQudXRjKCkuZW5kT2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG9yZGVyOiBkYXRhLm9yZGVyID8gQXJyYXkuaXNBcnJheShkYXRhLm9yZGVyKSA/IGRhdGEub3JkZXIgOiBbZGF0YS5vcmRlcl0gOiBbJy1pbmdlc3Rfc3RhcnRlZCddLFxuICAgICAgICAgICAgICAgIHN0YXR1czogZGF0YS5zdGF0dXMgPyBkYXRhLnN0YXR1cyA6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXROb2Rlc1BhcmFtcyA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHBhZ2U6IGRhdGEucGFnZSA/IHBhcnNlSW50KGRhdGEucGFnZSkgOiAxLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogZGF0YS5wYWdlX3NpemUgPyBwYXJzZUludChkYXRhLnBhZ2Vfc2l6ZSkgOiAyNSxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBkYXRhLnN0YXJ0ZWQgPyBkYXRhLnN0YXJ0ZWQgOiBtb21lbnQudXRjKCkuc3VidHJhY3QoMSwgJ3dlZWtzJykuc3RhcnRPZignZCcpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgZW5kZWQ6IGRhdGEuZW5kZWQgPyBkYXRhLmVuZGVkIDogbW9tZW50LnV0YygpLmVuZE9mKCdkJykudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBvcmRlcjogZGF0YS5vcmRlciA/IEFycmF5LmlzQXJyYXkoZGF0YS5vcmRlcikgPyBkYXRhLm9yZGVyIDogW2RhdGEub3JkZXJdIDogWydob3N0bmFtZSddLFxuICAgICAgICAgICAgICAgIGluY2x1ZGVfaW5hY3RpdmU6IGRhdGEuaW5jbHVkZV9pbmFjdGl2ZSA/IGRhdGEuaW5jbHVkZV9pbmFjdGl2ZSA6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXROb2RlU3RhdHVzUGFyYW1zID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogZGF0YS5wYWdlID8gcGFyc2VJbnQoZGF0YS5wYWdlKSA6IDEsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBkYXRhLnBhZ2Vfc2l6ZSA/IHBhcnNlSW50KGRhdGEucGFnZV9zaXplKSA6IDI1LFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IGRhdGEuc3RhcnRlZCA/IGRhdGEuc3RhcnRlZCA6IG1vbWVudC51dGMoKS5zdWJ0cmFjdCgzLCAnaG91cnMnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBkYXRhLmVuZGVkID8gZGF0YS5lbmRlZCA6IG1vbWVudC51dGMoKS50b0lTT1N0cmluZygpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRWZXJzaW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZlcnNpb247XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0VmVyc2lvbjogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2ZXJzaW9uID0gZGF0YTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JzQ29sRGVmczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBqb2JzQ29sRGVmcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRKb2JzQ29sRGVmczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBqb2JzQ29sRGVmcyA9IGRhdGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9ic1BhcmFtczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChfLmtleXMoam9ic1BhcmFtcykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbml0Sm9ic1BhcmFtcygkbG9jYXRpb24uc2VhcmNoKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gam9ic1BhcmFtcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRKb2JzUGFyYW1zOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGpvYnNQYXJhbXMgPSBpbml0Sm9ic1BhcmFtcyhkYXRhKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVRdWVyeXN0cmluZyhqb2JzUGFyYW1zKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JFeGVjdXRpb25zUGFyYW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKF8ua2V5cyhqb2JFeGVjdXRpb25zUGFyYW1zKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluaXRKb2JFeGVjdXRpb25zUGFyYW1zKCRsb2NhdGlvbi5zZWFyY2goKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBqb2JFeGVjdXRpb25zUGFyYW1zO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEpvYkV4ZWN1dGlvbnNQYXJhbXM6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgam9iRXhlY3V0aW9uc1BhcmFtcyA9IGluaXRKb2JFeGVjdXRpb25zUGFyYW1zKGRhdGEpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVF1ZXJ5c3RyaW5nKGpvYkV4ZWN1dGlvbnNQYXJhbXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKF8ua2V5cyhqb2JUeXBlc0ZhaWx1cmVSYXRlc1BhcmFtcykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbml0Sm9iVHlwZXNGYWlsdXJlUmF0ZXNQYXJhbXMoJGxvY2F0aW9uLnNlYXJjaCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zID0gaW5pdEpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zKGRhdGEpO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChfLnBhaXJzKGpvYlR5cGVzRmFpbHVyZVJhdGVzUGFyYW1zKSwgZnVuY3Rpb24gKHBhcmFtKSB7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2gocGFyYW1bMF0sIHBhcmFtWzFdKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRSZWNpcGVzQ29sRGVmczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZWNpcGVzQ29sRGVmcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRSZWNpcGVzQ29sRGVmczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZWNpcGVzQ29sRGVmcyA9IGRhdGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UmVjaXBlc1BhcmFtczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChfLmtleXMocmVjaXBlc1BhcmFtcykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbml0UmVjaXBlc1BhcmFtcygkbG9jYXRpb24uc2VhcmNoKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVjaXBlc1BhcmFtcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRSZWNpcGVzUGFyYW1zOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJlY2lwZXNQYXJhbXMgPSBpbml0UmVjaXBlc1BhcmFtcyhkYXRhKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVRdWVyeXN0cmluZyhyZWNpcGVzUGFyYW1zKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRJbmdlc3RzQ29sRGVmczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpbmdlc3RzQ29sRGVmcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRJbmdlc3RzQ29sRGVmczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpbmdlc3RzQ29sRGVmcyA9IGRhdGE7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0SW5nZXN0c1BhcmFtczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChfLmtleXMoaW5nZXN0c1BhcmFtcykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbml0SW5nZXN0c1BhcmFtcygkbG9jYXRpb24uc2VhcmNoKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gaW5nZXN0c1BhcmFtcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRJbmdlc3RzUGFyYW1zOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGluZ2VzdHNQYXJhbXMgPSBpbml0SW5nZXN0c1BhcmFtcyhkYXRhKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVRdWVyeXN0cmluZyhpbmdlc3RzUGFyYW1zKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXROb2Rlc0NvbERlZnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZXNDb2xEZWZzO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldE5vZGVzQ29sRGVmczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBub2Rlc0NvbERlZnMgPSBkYXRhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldE5vZGVTdGF0dXNQYXJhbXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoXy5rZXlzKG5vZGVTdGF0dXNQYXJhbXMpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5pdE5vZGVTdGF0dXNQYXJhbXMoJGxvY2F0aW9uLnNlYXJjaCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vZGVTdGF0dXNQYXJhbXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0Tm9kZVN0YXR1c1BhcmFtczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBub2RlU3RhdHVzUGFyYW1zID0gaW5pdE5vZGVTdGF0dXNQYXJhbXMoZGF0YSk7XG4gICAgICAgICAgICAgICAgdXBkYXRlUXVlcnlzdHJpbmcobm9kZVN0YXR1c1BhcmFtcyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0U2hvd0FjdGl2ZVdvcmtzcGFjZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2hvd0FjdGl2ZVdvcmtzcGFjZXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0U2hvd0FjdGl2ZVdvcmtzcGFjZXM6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgc2hvd0FjdGl2ZVdvcmtzcGFjZXMgPSBkYXRhO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldE5vZGVzUGFyYW1zOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKF8ua2V5cyhub2Rlc1BhcmFtcykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbml0Tm9kZXNQYXJhbXMoJGxvY2F0aW9uLnNlYXJjaCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vZGVzUGFyYW1zO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldE5vZGVzUGFyYW1zOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIG5vZGVzUGFyYW1zID0gaW5pdE5vZGVzUGFyYW1zKGRhdGEpO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVF1ZXJ5c3RyaW5nKG5vZGVzUGFyYW1zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ3N0YXR1c1NlcnZpY2UnLCBmdW5jdGlvbiAoJHJlc291cmNlLCBzY2FsZUNvbmZpZywgcG9sbGVyLCBwb2xsZXJGYWN0b3J5LCBTdGF0dXMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldFN0YXR1czogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0dXNSZXNvdXJjZSA9ICRyZXNvdXJjZShzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdzdGF0dXMvJyksXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1c1BvbGxlciA9IHBvbGxlckZhY3RvcnkubmV3UG9sbGVyKHN0YXR1c1Jlc291cmNlLCBzY2FsZUNvbmZpZy5wb2xsSW50ZXJ2YWxzLnN0YXR1cyk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdHVzUG9sbGVyLnByb21pc2UudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBTdGF0dXMudHJhbnNmb3JtZXIocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1BvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ3VzZXJTZXJ2aWNlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0VXNlckNyZWRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNyZWRzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXJDcmVkcycpO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGNyZWRzKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBwYXJzaW5nIHVzZXIgY3JlZGVudGlhbHMnKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNyZWRzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRVc2VyQ3JlZHM6IGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgICAgICAgICAgaWYgKHVzZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3VzZXJDcmVkcycsIEpTT04uc3RyaW5naWZ5KHVzZXIpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlckNyZWRzJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbG9naW46IGZ1bmN0aW9uICh1c2VybmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciB1c2VyID0ge1xuICAgICAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGlzX2FkbWluOiB0cnVlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFVzZXJDcmVkcyh1c2VyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXNlcjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsb2dvdXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFVzZXJDcmVkcyhudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignZmVlZERldGFpbHNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBzY2FsZUNvbmZpZywgbmF2U2VydmljZSwgc3VibmF2U2VydmljZSwgZmVlZFNlcnZpY2UsIG1vbWVudCkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLmZlZWREYXRhID0ge307XG4gICAgICAgIHZtLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3MuZmVlZDtcbiAgICAgICAgdm0udXNlSW5nZXN0VGltZSA9ICdmYWxzZSc7XG4gICAgICAgIHZtLmZpbHRlclZhbHVlID0gMTtcbiAgICAgICAgdm0uZmlsdGVyRHVyYXRpb24gPSAndyc7XG5cbiAgICAgICAgdm0uY2hhbmdlRmVlZFNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpe1xuICAgICAgICAgICAgc2V0RmVlZFVybCgpO1xuICAgICAgICAgICAgLy9nZXRGZWVkKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uY2hhbmdlSW5nZXN0VGltZVNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpe1xuICAgICAgICAgICAgc2V0RmVlZFVybCgpO1xuICAgICAgICAgICAgZ2V0RmVlZCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRGZWVkUGFyYW1zID0gZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge307XG4gICAgICAgICAgICB2YXIgc3RyaWtlSWQgPSB2bS5zZWxlY3RlZEZlZWQgPyB2bS5zZWxlY3RlZEZlZWQuc3RyaWtlLmlkIDogbnVsbDtcbiAgICAgICAgICAgIHZhciB1c2VJbmdlc3RUaW1lID0gdm0udXNlSW5nZXN0VGltZSA/IHZtLnVzZUluZ2VzdFRpbWUgOiBudWxsO1xuXG4gICAgICAgICAgICBwYXJhbXMuc3RhcnRlZCA9IG1vbWVudC51dGMoKS5zdWJ0cmFjdCh2bS5maWx0ZXJWYWx1ZSwgdm0uZmlsdGVyRHVyYXRpb24pLnN0YXJ0T2YoJ2QnKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgcGFyYW1zLmVuZGVkID0gbW9tZW50LnV0YyhwYXJhbXMuc3RhcnRlZCkuYWRkKDEsIHZtLmZpbHRlckR1cmF0aW9uKS5lbmRPZignZCcpLnRvSVNPU3RyaW5nKCk7XG5cbiAgICAgICAgICAgIGlmIChzdHJpa2VJZCAhPSAkbG9jYXRpb24uc2VhcmNoKCkuc3RyaWtlX2lkKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnN0cmlrZV9pZCA9IHN0cmlrZUlkO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgkbG9jYXRpb24uc2VhcmNoKCkuc3RyaWtlX2lkKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnN0cmlrZV9pZCA9ICRsb2NhdGlvbi5zZWFyY2goKS5zdHJpa2VfaWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh1c2VJbmdlc3RUaW1lICE9ICRsb2NhdGlvbi5zZWFyY2goKS51c2VfaW5nZXN0X3RpbWUpIHtcbiAgICAgICAgICAgICAgIHBhcmFtcy51c2VfaW5nZXN0X3RpbWUgPSB1c2VJbmdlc3RUaW1lO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgkbG9jYXRpb24uc2VhcmNoKCkudXNlX2luZ2VzdF90aW1lKSB7XG4gICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZ2V0RmVlZFBhcmFtcyB1c2VfaW5nZXN0X3RpbWU6ICcgKyAkbG9jYXRpb24uc2VhcmNoKCkudXNlX2luZ2VzdF90aW1lKTtcbiAgICAgICAgICAgICAgIHBhcmFtcy51c2VfaW5nZXN0X3RpbWUgPSAkbG9jYXRpb24uc2VhcmNoKCkudXNlX2luZ2VzdF90aW1lO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcGFyYW1zO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRGZWVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBpZiAoJGxvY2F0aW9uLnNlYXJjaCgpLnVzZV9pbmdlc3RfdGltZSkge1xuICAgICAgICAgICAgICAgIHZtLnVzZUluZ2VzdFRpbWUgPSAkbG9jYXRpb24uc2VhcmNoKCkudXNlX2luZ2VzdF90aW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGZlZWRQYXJhbXMgPSBnZXRGZWVkUGFyYW1zKCk7XG4gICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKGZlZWRQYXJhbXMpO1xuICAgICAgICAgICAgZmVlZFNlcnZpY2UuZ2V0RmVlZChmZWVkUGFyYW1zKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uYWxsRmVlZHMgPSBfLnNvcnRCeU9yZGVyKGRhdGEucmVzdWx0cywgWydzdHJpa2UubmFtZSddLCBbJ2FzYyddKTtcbiAgICAgICAgICAgICAgICB2YXIgc3RyaWtlSWQgPSAkbG9jYXRpb24uc2VhcmNoKCkuc3RyaWtlX2lkO1xuICAgICAgICAgICAgICAgIGlmKHN0cmlrZUlkKXtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHNlbGVjdGVkRmVlZCA9IG5ldyBmZWVkXG4gICAgICAgICAgICAgICAgICAgIHZhciBmZWVkID0gXy5maW5kKHZtLmFsbEZlZWRzLCBmdW5jdGlvbiAoZmVlZCl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmVlZC5zdHJpa2UuaWQgPT0gc3RyaWtlSWQ7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEZlZWQgPSBmZWVkID8gZmVlZCA6IG51bGw7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRGZWVkID0gdm0uYWxsRmVlZHNbMF07XG4gICAgICAgICAgICAgICAgICAgIHNldEZlZWRVcmwoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpe1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUZlZWRSYW5nZSA9IGZ1bmN0aW9uIChhY3Rpb24pIHtcbiAgICAgICAgICAgIGlmIChhY3Rpb24gPT09ICdvbGRlcicpIHtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJWYWx1ZSsrO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICduZXdlcicpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0uZmlsdGVyVmFsdWUgPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmZpbHRlclZhbHVlLS07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICd0b2RheScpIHtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJWYWx1ZSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBnZXRGZWVkKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHNldEZlZWRVcmwgPSBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgIC8vIHNldCBwYXJhbSBpbiBVUkxcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSBnZXRGZWVkUGFyYW1zKCk7XG4gICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKHBhcmFtcyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdmZWVkJyk7XG4gICAgICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdmZWVkJyk7XG4gICAgICAgICAgICBnZXRGZWVkKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmZpbHRlclZhbHVlJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICB2YXIgJGZlZWROZXdlciA9ICQoJy5mZWVkLW5ld2VyJyksXG4gICAgICAgICAgICAgICAgJGZlZWRUb2RheSA9ICQoJy5mZWVkLXRvZGF5Jyk7XG5cbiAgICAgICAgICAgIGlmICh2YWx1ZSA+IDEpIHtcbiAgICAgICAgICAgICAgICAkZmVlZE5ld2VyLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgJGZlZWRUb2RheS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkZmVlZE5ld2VyLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgJGZlZWRUb2RheS5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBcbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdpbmdlc3RSZWNvcmREZXRhaWxzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRyb3V0ZVBhcmFtcywgc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSwgbmF2U2VydmljZSwgc3VibmF2U2VydmljZSwgZmVlZFNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgdm0uc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5mZWVkO1xuICAgICAgICB2bS5zY2FsZVNlcnZpY2UgPSBzY2FsZVNlcnZpY2U7XG4gICAgICAgIHZtLm1vbWVudCA9IG1vbWVudDtcbiAgICAgICAgdm0uaW5nZXN0UmVjb3JkID0gbnVsbDtcblxuICAgICAgICB2YXIgZ2V0SW5nZXN0UmVjb3JkRGV0YWlscyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgZmVlZFNlcnZpY2UuZ2V0U291cmNlRGV0YWlscygkcm91dGVQYXJhbXMuaWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5pbmdlc3RSZWNvcmQgPSBkYXRhO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdmZWVkJyk7XG4gICAgICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdmZWVkL2luZ2VzdHMnKTtcbiAgICAgICAgICAgIGdldEluZ2VzdFJlY29yZERldGFpbHMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5jYWxjdWxhdGVGaWxlU2l6ZSA9IGZ1bmN0aW9uIChzaXplKSB7XG4gICAgICAgICAgICByZXR1cm4gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUZpbGVTaXplRnJvbUJ5dGVzKHNpemUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdpbmdlc3RSZWNvcmRzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSwgc3RhdGVTZXJ2aWNlLCBmZWVkU2VydmljZSwgbmF2U2VydmljZSwgc3VibmF2U2VydmljZSwgZ3JpZEZhY3RvcnkpIHtcbiAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnZmVlZC9pbmdlc3RzJyk7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5pbmdlc3RzUGFyYW1zID0gc3RhdGVTZXJ2aWNlLmdldEluZ2VzdHNQYXJhbXMoKTtcblxuICAgICAgICB2bS5zdGF0ZVNlcnZpY2UgPSBzdGF0ZVNlcnZpY2U7XG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmZlZWQ7XG4gICAgICAgIHZtLmluZ2VzdFN0YXR1c1ZhbHVlcyA9IHNjYWxlQ29uZmlnLmluZ2VzdFN0YXR1cztcbiAgICAgICAgdm0uc2VsZWN0ZWRJbmdlc3RTdGF0dXMgPSB2bS5pbmdlc3RzUGFyYW1zLnN0YXR1cyB8fCB2bS5pbmdlc3RTdGF0dXNWYWx1ZXNbMF07XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0YXJ0ID0gbW9tZW50LnV0Yyh2bS5pbmdlc3RzUGFyYW1zLnN0YXJ0ZWQpLnRvRGF0ZSgpO1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdGFydFBvcHVwID0ge1xuICAgICAgICAgICAgb3BlbmVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICB2bS5vcGVuTGFzdE1vZGlmaWVkU3RhcnRQb3B1cCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHZtLmxhc3RNb2RpZmllZFN0YXJ0UG9wdXAub3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RvcCA9IG1vbWVudC51dGModm0uaW5nZXN0c1BhcmFtcy5lbmRlZCkudG9EYXRlKCk7XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0b3BQb3B1cCA9IHtcbiAgICAgICAgICAgIG9wZW5lZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgdm0ub3Blbkxhc3RNb2RpZmllZFN0b3BQb3B1cCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHZtLmxhc3RNb2RpZmllZFN0b3BQb3B1cC5vcGVuZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICB2bS5kYXRlTW9kZWxPcHRpb25zID0ge1xuICAgICAgICAgICAgdGltZXpvbmU6ICcrMDAwJ1xuICAgICAgICB9O1xuICAgICAgICB2bS5pbmdlc3REYXRhID0gW107XG4gICAgICAgIHZtLnNlYXJjaFRleHQgPSAnJztcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMgPSBncmlkRmFjdG9yeS5kZWZhdWx0R3JpZE9wdGlvbnMoKTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvbkN1cnJlbnRQYWdlID0gdm0uaW5nZXN0c1BhcmFtcy5wYWdlIHx8IDE7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZSA9IHZtLmluZ2VzdHNQYXJhbXMucGFnZV9zaXplIHx8IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IFtdO1xuXG4gICAgICAgIHZtLnJlZnJlc2hEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGZpbHRlcmVkRGF0YSA9IF8uZmlsdGVyKHZtLmluZ2VzdERhdGEsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQuZmlsZV9uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModm0uc2VhcmNoVGV4dC50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IGZpbHRlcmVkRGF0YS5sZW5ndGggPiAwID8gZmlsdGVyZWREYXRhIDogdm0uZ3JpZE9wdGlvbnMuZGF0YTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZmlsdGVyZWRCeVN0YXR1cyA9IHZtLmluZ2VzdHNQYXJhbXMuc3RhdHVzID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgZmlsdGVyZWRCeU9yZGVyID0gdm0uaW5nZXN0c1BhcmFtcy5vcmRlciA/IHRydWUgOiBmYWxzZTtcblxuICAgICAgICB2bS5jb2xEZWZzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnZmlsZV9uYW1lJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0ZpbGUgTmFtZScsXG4gICAgICAgICAgICAgICAgLy9maWx0ZXJIZWFkZXJUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWZpbHRlci1jb250YWluZXJcIj48aW5wdXQgbmctbW9kZWw9XCJncmlkLmFwcFNjb3BlLnZtLnNlYXJjaFRleHRcIiBuZy1jaGFuZ2U9XCJncmlkLmFwcFNjb3BlLnZtLnJlZnJlc2hEYXRhKClcIiBjbGFzcz1cImZvcm0tY29udHJvbFwiIHBsYWNlaG9sZGVyPVwiU2VhcmNoXCI+PC9kaXY+J1xuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdmaWxlX3NpemUnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnRmlsZSBTaXplJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmZpbGVfc2l6ZV9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnc3RyaWtlLmlkJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ1N0cmlrZSBQcm9jZXNzJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LnN0cmlrZS5pZCB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdzdGF0dXMnLFxuICAgICAgICAgICAgICAgIGZpbHRlckhlYWRlclRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtZmlsdGVyLWNvbnRhaW5lclwiPjxzZWxlY3QgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBuZy1tb2RlbD1cImdyaWQuYXBwU2NvcGUudm0uc2VsZWN0ZWRJbmdlc3RTdGF0dXNcIiBuZy1vcHRpb25zPVwic3RhdHVzLnRvVXBwZXJDYXNlKCkgZm9yIHN0YXR1cyBpbiBncmlkLmFwcFNjb3BlLnZtLmluZ2VzdFN0YXR1c1ZhbHVlc1wiPjwvc2VsZWN0PjwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICd0cmFuc2Zlcl9zdGFydGVkJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LnRyYW5zZmVyX3N0YXJ0ZWRfZm9ybWF0dGVkIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ3RyYW5zZmVyX2VuZGVkJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LnRyYW5zZmVyX2VuZGVkX2Zvcm1hdHRlZCB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdpbmdlc3Rfc3RhcnRlZCcsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+e3sgcm93LmVudGl0eS5pbmdlc3Rfc3RhcnRlZF9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnaW5nZXN0X2VuZGVkJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmluZ2VzdF9lbmRlZF9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgdm0uZ2V0SW5nZXN0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgZmVlZFNlcnZpY2UuZ2V0SW5nZXN0c09uY2Uodm0uaW5nZXN0c1BhcmFtcykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmluZ2VzdERhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMubWluUm93c1RvU2hvdyA9IGRhdGEucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudmlydHVhbGl6YXRpb25UaHJlc2hvbGQgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnRvdGFsSXRlbXMgPSBkYXRhLmNvdW50O1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5maWx0ZXJSZXN1bHRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEluZ2VzdHNQYXJhbXModm0uaW5nZXN0c1BhcmFtcyk7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLmdldEluZ2VzdHMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVDb2xEZWZzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IGdyaWRGYWN0b3J5LmFwcGx5U29ydENvbmZpZyh2bS5jb2xEZWZzLCB2bS5pbmdlc3RzUGFyYW1zKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVJbmdlc3RPcmRlciA9IGZ1bmN0aW9uIChzb3J0QXJyKSB7XG4gICAgICAgICAgICB2bS5pbmdlc3RzUGFyYW1zLm9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwID8gc29ydEFyciA6IG51bGw7XG4gICAgICAgICAgICBmaWx0ZXJlZEJ5T3JkZXIgPSBzb3J0QXJyLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlSW5nZXN0U3RhdHVzID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUgIT0gdm0uaW5nZXN0c1BhcmFtcy5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICB2bS5pbmdlc3RzUGFyYW1zLnBhZ2UgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uaW5nZXN0c1BhcmFtcy5zdGF0dXMgPSB2YWx1ZSA9PT0gJ1ZJRVcgQUxMJyA/IG51bGwgOiB2YWx1ZTtcbiAgICAgICAgICAgIHZtLmluZ2VzdHNQYXJhbXMucGFnZV9zaXplID0gdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplO1xuICAgICAgICAgICAgaWYgKCF2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdyaWRPcHRpb25zLm9uUmVnaXN0ZXJBcGkgPSBmdW5jdGlvbiAoZ3JpZEFwaSkge1xuICAgICAgICAgICAgLy9zZXQgZ3JpZEFwaSBvbiBzY29wZVxuICAgICAgICAgICAgdm0uZ3JpZEFwaSA9IGdyaWRBcGk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLnBhZ2luYXRpb24ub24ucGFnaW5hdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoY3VycmVudFBhZ2UsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdm0uaW5nZXN0c1BhcmFtcy5wYWdlID0gY3VycmVudFBhZ2U7XG4gICAgICAgICAgICAgICAgdm0uaW5nZXN0c1BhcmFtcy5wYWdlX3NpemUgPSBwYWdlU2l6ZTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZtLmdyaWRBcGkuc2VsZWN0aW9uLm9uLnJvd1NlbGVjdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaCh7fSk7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9mZWVkL2luZ2VzdHMvJyArIHJvdy5lbnRpdHkuaWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLmNvcmUub24uc29ydENoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoZ3JpZCwgc29ydENvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godm0uZ3JpZEFwaS5ncmlkLmNvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sLmNvbERlZi5zb3J0ID0gY29sLnNvcnQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEluZ2VzdHNDb2xEZWZzKHZtLmdyaWRBcGkuZ3JpZC5vcHRpb25zLmNvbHVtbkRlZnMpO1xuICAgICAgICAgICAgICAgIHZhciBzb3J0QXJyID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHNvcnRDb2x1bW5zLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvcnRBcnIucHVzaChjb2wuc29ydC5kaXJlY3Rpb24gPT09ICdkZXNjJyA/ICctJyArIGNvbC5maWVsZCA6IGNvbC5maWVsZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlSW5nZXN0T3JkZXIoc29ydEFycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEluZ2VzdHNQYXJhbXModm0uaW5nZXN0c1BhcmFtcyk7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgICAgICB2bS5nZXRJbmdlc3RzKCk7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdmZWVkJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNlbGVjdGVkSW5nZXN0U3RhdHVzJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJlZEJ5U3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUluZ2VzdFN0YXR1cyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJlZEJ5U3RhdHVzID0gdmFsdWUgIT09ICdWSUVXIEFMTCc7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlSW5nZXN0U3RhdHVzKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0ubGFzdE1vZGlmaWVkU3RhcnQnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmluZ2VzdHNQYXJhbXMuc3RhcnRlZCA9IHZhbHVlLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5sYXN0TW9kaWZpZWRTdG9wJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5pbmdlc3RzUGFyYW1zLmVuZGVkID0gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0SW5nZXN0c0NvbERlZnMoKScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uY29sRGVmcyA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgdm0udXBkYXRlQ29sRGVmcygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigndm0uc3RhdGVTZXJ2aWNlLmdldEluZ2VzdHNQYXJhbXMoKScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uaW5nZXN0c1BhcmFtcyA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgdm0udXBkYXRlQ29sRGVmcygpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7IiwiLyoqXG4gKiA8c2NhbGUtZmlsZS1hbmNlc3RyeS10cmVlIC8+XG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignc2NhbGVGaWxlQW5jZXN0cnlUcmVlQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUpIHtcbiAgICAgICAgJHNjb3BlLnNvdXJjZSA9IG51bGw7XG5cblxuICAgICAgICB2YXIgdHJlZURhdGEgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiVG9wIExldmVsXCIsXG4gICAgICAgICAgICAgICAgXCJwYXJlbnRcIjogXCJudWxsXCIsXG4gICAgICAgICAgICAgICAgXCJjaGlsZHJlblwiOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkxldmVsIDI6IEFcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicGFyZW50XCI6IFwiVG9wIExldmVsXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vXCJjaGlsZHJlblwiOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgXCJuYW1lXCI6IFwiU29uIG9mIEFcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBcInBhcmVudFwiOiBcIkxldmVsIDI6IEFcIlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBcIm5hbWVcIjogXCJEYXVnaHRlciBvZiBBXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgXCJwYXJlbnRcIjogXCJMZXZlbCAyOiBBXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vXVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJMZXZlbCAyOiBCXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInBhcmVudFwiOiBcIlRvcCBMZXZlbFwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cblxuLy8gKioqKioqKioqKioqKiogR2VuZXJhdGUgdGhlIHRyZWUgZGlhZ3JhbVx0ICoqKioqKioqKioqKioqKioqXG4gICAgICAgIHZhciBtYXJnaW4gPSB7dG9wOiAyMCwgcmlnaHQ6IDEyMCwgYm90dG9tOiAyMCwgbGVmdDogMTIwfTtcbiAgICAgICAgdmFyIHdpZHRoID0gNTAwIC0gbWFyZ2luLnJpZ2h0IC0gbWFyZ2luLmxlZnQ7XG4gICAgICAgIHZhciBoZWlnaHQgPSA0MDAgLSBtYXJnaW4udG9wIC0gbWFyZ2luLmJvdHRvbTtcblxuICAgICAgICB2YXIgaSA9IDAsXG4gICAgICAgICAgICBkdXJhdGlvbiA9IDc1MCxcbiAgICAgICAgICAgIHJvb3Q7XG5cbiAgICAgICAgdmFyIHRyZWUgPSBkMy5sYXlvdXQudHJlZSgpXG4gICAgICAgICAgICAuc2l6ZShbaGVpZ2h0LCB3aWR0aF0pO1xuXG4gICAgICAgIHZhciBkaWFnb25hbCA9IGQzLnN2Zy5kaWFnb25hbCgpXG4gICAgICAgICAgICAucHJvamVjdGlvbihmdW5jdGlvbihkKSB7IHJldHVybiBbZC55LCBkLnhdOyB9KTtcblxuICAgICAgICB2YXIgc3ZnID0gZDMuc2VsZWN0KFwic3ZnXCIpO1xuICAgICAgICAgICAgLy8uYXR0cihcIndpZHRoXCIsIHdpZHRoICsgbWFyZ2luLnJpZ2h0ICsgbWFyZ2luLmxlZnQpXG4gICAgICAgICAgICAvLy5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodCArIG1hcmdpbi50b3AgKyBtYXJnaW4uYm90dG9tKVxuICAgICAgICB2YXIgaW5uZXIgPSBzdmcuYXBwZW5kKFwiZ1wiKTtcblxuICAgICAgICBpbm5lci5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgbWFyZ2luLmxlZnQvMS41ICsgXCIsXCIgKyBtYXJnaW4udG9wLzIgKyBcIiksXCIgK1xuICAgICAgICAgICAgICAgIFwic2NhbGUoXCIgKyAxICsgXCIpXCIpO1xuICAgICAgICBpbm5lci5hdHRyKFwiY2xhc3NcIiwgXCJ0cmVlLWdyb3VwXCIpO1xuXG5cbiAgICAgICAgcm9vdCA9IHRyZWVEYXRhWzBdO1xuICAgICAgICByb290LngwID0gaGVpZ2h0IC8gMjtcbiAgICAgICAgcm9vdC55MCA9IDA7XG5cbiAgICAgICAgdXBkYXRlKHJvb3QpO1xuXG4gICAgICAgIGQzLnNlbGVjdChzZWxmLmZyYW1lRWxlbWVudCkuc3R5bGUoXCJoZWlnaHRcIiwgXCI1MDBweFwiKTtcblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUoc291cmNlKSB7XG5cbiAgICAgICAgICAgIC8vIENvbXB1dGUgdGhlIG5ldyB0cmVlIGxheW91dC5cbiAgICAgICAgICAgIHZhciBub2RlcyA9IHRyZWUubm9kZXMocm9vdCkucmV2ZXJzZSgpLFxuICAgICAgICAgICAgICAgIGxpbmtzID0gdHJlZS5saW5rcyhub2Rlcyk7XG5cbiAgICAgICAgICAgIC8vIE5vcm1hbGl6ZSBmb3IgZml4ZWQtZGVwdGguXG4gICAgICAgICAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKGQpIHsgZC55ID0gZC5kZXB0aCAqIDE4MDsgfSk7XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgbm9kZXPigKZcbiAgICAgICAgICAgIHZhciBub2RlID0gaW5uZXIuc2VsZWN0QWxsKFwiZy5ub2RlXCIpXG4gICAgICAgICAgICAgICAgLmRhdGEobm9kZXMsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuaWQgfHwgKGQuaWQgPSArK2kpOyB9KTtcblxuICAgICAgICAgICAgLy8gRW50ZXIgYW55IG5ldyBub2RlcyBhdCB0aGUgcGFyZW50J3MgcHJldmlvdXMgcG9zaXRpb24uXG4gICAgICAgICAgICB2YXIgbm9kZUVudGVyID0gbm9kZS5lbnRlcigpLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwibm9kZVwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIFwidHJhbnNsYXRlKFwiICsgc291cmNlLnkwICsgXCIsXCIgKyBzb3VyY2UueDAgKyBcIilcIjsgfSk7XG4gICAgICAgICAgICAgICAgLy8ub24oXCJjbGlja1wiLCBjbGljayk7XG5cbiAgICAgICAgICAgIG5vZGVFbnRlci5hcHBlbmQoXCJjaXJjbGVcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcInJcIiwgMWUtNilcbiAgICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuX2NoaWxkcmVuID8gXCJsaWdodHN0ZWVsYmx1ZVwiIDogXCIjZmZmXCI7IH0pO1xuXG4gICAgICAgICAgICBub2RlRW50ZXIuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwieFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLmNoaWxkcmVuIHx8IGQuX2NoaWxkcmVuID8gLTEzIDogMTM7IH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCBcIi4zNWVtXCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLmNoaWxkcmVuIHx8IGQuX2NoaWxkcmVuID8gXCJlbmRcIiA6IFwic3RhcnRcIjsgfSlcbiAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbihkKSB7IHJldHVybiBkLm5hbWU7IH0pXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwiZmlsbC1vcGFjaXR5XCIsIDFlLTYpO1xuXG4gICAgICAgICAgICAvLyBUcmFuc2l0aW9uIG5vZGVzIHRvIHRoZWlyIG5ldyBwb3NpdGlvbi5cbiAgICAgICAgICAgIHZhciBub2RlVXBkYXRlID0gbm9kZS50cmFuc2l0aW9uKClcbiAgICAgICAgICAgICAgICAuZHVyYXRpb24oZHVyYXRpb24pXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gXCJ0cmFuc2xhdGUoXCIgKyBkLnkgKyBcIixcIiArIGQueCArIFwiKVwiOyB9KTtcblxuICAgICAgICAgICAgbm9kZVVwZGF0ZS5zZWxlY3QoXCJjaXJjbGVcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcInJcIiwgMTApXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLl9jaGlsZHJlbiA/IFwibGlnaHRzdGVlbGJsdWVcIiA6IFwiI2ZmZlwiOyB9KTtcblxuICAgICAgICAgICAgbm9kZVVwZGF0ZS5zZWxlY3QoXCJ0ZXh0XCIpXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwiZmlsbC1vcGFjaXR5XCIsIDEpO1xuXG4gICAgICAgICAgICAvLyBUcmFuc2l0aW9uIGV4aXRpbmcgbm9kZXMgdG8gdGhlIHBhcmVudCdzIG5ldyBwb3NpdGlvbi5cbiAgICAgICAgICAgIHZhciBub2RlRXhpdCA9IG5vZGUuZXhpdCgpLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcbiAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBcInRyYW5zbGF0ZShcIiArIHNvdXJjZS55ICsgXCIsXCIgKyBzb3VyY2UueCArIFwiKVwiOyB9KVxuICAgICAgICAgICAgICAgIC5yZW1vdmUoKTtcblxuICAgICAgICAgICAgbm9kZUV4aXQuc2VsZWN0KFwiY2lyY2xlXCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJyXCIsIDFlLTYpO1xuXG4gICAgICAgICAgICBub2RlRXhpdC5zZWxlY3QoXCJ0ZXh0XCIpXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwiZmlsbC1vcGFjaXR5XCIsIDFlLTYpO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGxpbmtz4oCmXG4gICAgICAgICAgICB2YXIgbGluayA9IGlubmVyLnNlbGVjdEFsbChcInBhdGgubGlua1wiKVxuICAgICAgICAgICAgICAgIC5kYXRhKGxpbmtzLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLnRhcmdldC5pZDsgfSk7XG5cbiAgICAgICAgICAgIC8vIEVudGVyIGFueSBuZXcgbGlua3MgYXQgdGhlIHBhcmVudCdzIHByZXZpb3VzIHBvc2l0aW9uLlxuICAgICAgICAgICAgbGluay5lbnRlcigpLmluc2VydChcInBhdGhcIiwgXCJnXCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImxpbmtcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcImRcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IHt4OiBzb3VyY2UueDAsIHk6IHNvdXJjZS55MH07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkaWFnb25hbCh7c291cmNlOiBvLCB0YXJnZXQ6IG99KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVHJhbnNpdGlvbiBsaW5rcyB0byB0aGVpciBuZXcgcG9zaXRpb24uXG4gICAgICAgICAgICBsaW5rLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcbiAgICAgICAgICAgICAgICAuYXR0cihcImRcIiwgZGlhZ29uYWwpO1xuXG4gICAgICAgICAgICAvLyBUcmFuc2l0aW9uIGV4aXRpbmcgbm9kZXMgdG8gdGhlIHBhcmVudCdzIG5ldyBwb3NpdGlvbi5cbiAgICAgICAgICAgIGxpbmsuZXhpdCgpLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgIC5kdXJhdGlvbihkdXJhdGlvbilcbiAgICAgICAgICAgICAgICAuYXR0cihcImRcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IHt4OiBzb3VyY2UueCwgeTogc291cmNlLnl9O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGlhZ29uYWwoe3NvdXJjZTogbywgdGFyZ2V0OiBvfSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIC8vIFN0YXNoIHRoZSBvbGQgcG9zaXRpb25zIGZvciB0cmFuc2l0aW9uLlxuICAgICAgICAgICAgbm9kZXMuZm9yRWFjaChmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgZC54MCA9IGQueDtcbiAgICAgICAgICAgICAgICBkLnkwID0gZC55O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4vLyBUb2dnbGUgY2hpbGRyZW4gb24gY2xpY2suXG4gICAgICAgIGZ1bmN0aW9uIGNsaWNrKGQpIHtcbiAgICAgICAgICAgIGlmIChkLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICAgICAgZC5fY2hpbGRyZW4gPSBkLmNoaWxkcmVuO1xuICAgICAgICAgICAgICAgIGQuY2hpbGRyZW4gPSBudWxsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkLmNoaWxkcmVuID0gZC5fY2hpbGRyZW47XG4gICAgICAgICAgICAgICAgZC5fY2hpbGRyZW4gPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdXBkYXRlKGQpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgIH0pLmRpcmVjdGl2ZSgnc2NhbGVGaWxlQW5jZXN0cnlUcmVlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAndXNlIHN0cmljdCc7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2FnZTogPHNjYWxlLWZpbGUtYW5jZXN0cnktdHJlZSBzb3VyY2U9XCJzb3VyY2VcIiAvPlxuICAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdzY2FsZUZpbGVBbmNlc3RyeVRyZWVDb250cm9sbGVyJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9mZWVkL2RpcmVjdGl2ZXMvZmlsZUFuY2VzdHJ5VHJlZVRlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgc291cmNlOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnRmVlZCcsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgRmVlZCA9IGZ1bmN0aW9uICh2YWx1ZSwgc3RhdHVzKSB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBGZWVkLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdGZWVkJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsVGV4dDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxUaXRsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgRmVlZC5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmVlZChcbiAgICAgICAgICAgICAgICAgICAgZGF0YS52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGF0dXNcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBGZWVkKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgRmVlZC50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChGZWVkLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEZlZWQuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEZlZWQ7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdGZWVkU3RhdHVzJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBGZWVkU3RhdHVzID0gZnVuY3Rpb24gKHN0YXR1cykge1xuICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgRmVlZFN0YXR1cy5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnRmVlZFN0YXR1cyc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbEZpbGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X2dyZWVuO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxBY3Rpdml0eTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsQWN0aXZpdHlUb3RhbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsRXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbFRvdGFsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBGZWVkU3RhdHVzLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGZWVkU3RhdHVzKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXR1c1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEZlZWRTdGF0dXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBGZWVkU3RhdHVzLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEZlZWRTdGF0dXMuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gRmVlZFN0YXR1cy5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gRmVlZFN0YXR1cztcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0luZ2VzdCcsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlKSB7XG4gICAgICAgIHZhciBJbmdlc3QgPSBmdW5jdGlvbiAoaWQsIGZpbGVfbmFtZSwgc3RyaWtlLCBzdGF0dXMsIGJ5dGVzX3RyYW5zZmVycmVkLCB0cmFuc2Zlcl9zdGFydGVkLCB0cmFuc2Zlcl9lbmRlZCwgbWVkaWFfdHlwZSwgZmlsZV9zaXplLCBkYXRhX3R5cGUsIGluZ2VzdF9zdGFydGVkLCBpbmdlc3RfZW5kZWQsIHNvdXJjZV9maWxlLCBjcmVhdGVkLCBsYXN0X21vZGlmaWVkKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLmZpbGVfbmFtZSA9IGZpbGVfbmFtZTtcbiAgICAgICAgICAgIHRoaXMuc3RyaWtlID0gc3RyaWtlO1xuICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgICAgICAgICB0aGlzLmJ5dGVzX3RyYW5zZmVycmVkID0gYnl0ZXNfdHJhbnNmZXJyZWQ7XG4gICAgICAgICAgICB0aGlzLnRyYW5zZmVyX3N0YXJ0ZWQgPSB0cmFuc2Zlcl9zdGFydGVkO1xuICAgICAgICAgICAgdGhpcy50cmFuc2Zlcl9zdGFydGVkX2Zvcm1hdHRlZCA9IG1vbWVudC51dGModHJhbnNmZXJfc3RhcnRlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjX25vbGFiZWwpO1xuICAgICAgICAgICAgdGhpcy50cmFuc2Zlcl9lbmRlZCA9IHRyYW5zZmVyX2VuZGVkO1xuICAgICAgICAgICAgdGhpcy50cmFuc2Zlcl9lbmRlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKHRyYW5zZmVyX2VuZGVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGNfbm9sYWJlbCk7XG4gICAgICAgICAgICB0aGlzLm1lZGlhX3R5cGUgPSBtZWRpYV90eXBlO1xuICAgICAgICAgICAgdGhpcy5maWxlX3NpemUgPSBmaWxlX3NpemU7XG4gICAgICAgICAgICB0aGlzLmZpbGVfc2l6ZV9mb3JtYXR0ZWQgPSBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tQnl0ZXMoZmlsZV9zaXplKTtcbiAgICAgICAgICAgIHRoaXMuZGF0YV90eXBlID0gZGF0YV90eXBlO1xuICAgICAgICAgICAgdGhpcy5pbmdlc3Rfc3RhcnRlZCA9IGluZ2VzdF9zdGFydGVkO1xuICAgICAgICAgICAgdGhpcy5pbmdlc3Rfc3RhcnRlZF9mb3JtYXR0ZWQgPSBpbmdlc3Rfc3RhcnRlZCA/IG1vbWVudC51dGMoaW5nZXN0X3N0YXJ0ZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Y19ub2xhYmVsKSA6ICcnO1xuICAgICAgICAgICAgdGhpcy5pbmdlc3RfZW5kZWQgPSBpbmdlc3RfZW5kZWQ7XG4gICAgICAgICAgICB0aGlzLmluZ2VzdF9lbmRlZF9mb3JtYXR0ZWQgPSBpbmdlc3RfZW5kZWQgPyBtb21lbnQudXRjKGluZ2VzdF9lbmRlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjX25vbGFiZWwpIDogJyc7XG4gICAgICAgICAgICB0aGlzLnNvdXJjZV9maWxlID0gc291cmNlX2ZpbGU7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkX2Zvcm1hdHRlZCA9IG1vbWVudC51dGMoY3JlYXRlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjX25vbGFiZWwpO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKGxhc3RfbW9kaWZpZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Y19ub2xhYmVsKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBJbmdlc3QucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEluZ2VzdC5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSW5nZXN0KFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZpbGVfbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdHJpa2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmJ5dGVzX3RyYW5zZmVycmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRyYW5zZmVyX3N0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudHJhbnNmZXJfZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVkaWFfdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5maWxlX3NpemUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGF0YV90eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmluZ2VzdF9zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmluZ2VzdF9lbmRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zb3VyY2VfZmlsZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBJbmdlc3QoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBJbmdlc3QudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSW5nZXN0LmJ1aWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBJbmdlc3QuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEluZ2VzdDtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdmZWVkU2VydmljZScsIGZ1bmN0aW9uICgkbG9jYXRpb24sICR0aW1lb3V0LCAkcSwgJGh0dHAsIHNjYWxlQ29uZmlnLCBJbmdlc3QpIHtcblxuICAgICAgICB2YXIgZ2V0RmVlZFBhcmFtcyA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgIGlmKCFwYXJhbXMpIHsgcGFyYW1zID0ge307IH1cbiAgICAgICAgICAgIHZhciBwID0ge307XG4gICAgICAgICAgICBwLnBhZ2Vfc2l6ZSA9IDEwMDA7XG4gICAgICAgICAgICBwLnN0YXJ0ZWQgPSBwYXJhbXMuc3RhcnRlZCA/IHBhcmFtcy5zdGFydGVkIDogbW9tZW50LnV0YygpLmFkZCgtNywnZGF5cycpLnN0YXJ0T2YoJ2QnKS50b0RhdGUoKTtcbiAgICAgICAgICAgIHAuZW5kZWQgPSBwYXJhbXMuZW5kZWQgPyBwYXJhbXMuZW5kZWQgOiBtb21lbnQudXRjKCkudG9EYXRlKCk7XG4gICAgICAgICAgICBwLnVzZV9pbmdlc3RfdGltZSA9IHBhcmFtcy51c2VfaW5nZXN0X3RpbWUgPyBwYXJhbXMudXNlX2luZ2VzdF90aW1lIDogbnVsbDtcbiAgICAgICAgICAgIHJldHVybiBwO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRJbmdlc3RzUGFyYW1zID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgcmV0dXJuIHBhcmFtcztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0U291cmNlUGFyYW1zID0gZnVuY3Rpb24gKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQsIG9yZGVyLCBpc19wYXJzZWQsIGZpbGVfbmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogcGFnZV9zaXplID8gcGFnZV9zaXplIDogMTAwMCxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBzdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICBvcmRlcjogb3JkZXIgPyBvcmRlciA6ICctbGFzdF9tb2RpZmllZCcsXG4gICAgICAgICAgICAgICAgaXNfcGFyc2VkOiBpc19wYXJzZWQsXG4gICAgICAgICAgICAgICAgZmlsZV9uYW1lOiBmaWxlX25hbWVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldEZlZWQ6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IGdldEZlZWRQYXJhbXMocGFyYW1zKTtcbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnaW5nZXN0cy9zdGF0dXMvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0SW5nZXN0c09uY2U6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IGdldEluZ2VzdHNQYXJhbXMocGFyYW1zKTtcbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnaW5nZXN0cy8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gSW5nZXN0LnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0U291cmNlczogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRTb3VyY2VQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3NvdXJjZXMvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0U291cmNlRGV0YWlsczogZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdzb3VyY2VzLycgKyBpZCArICcvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJ1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYkRldGFpbENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sICRyb3V0ZVBhcmFtcywgJHVpYk1vZGFsLCBzdGF0ZVNlcnZpY2UsIG5hdlNlcnZpY2UsIGpvYlNlcnZpY2UsIGpvYkV4ZWN1dGlvblNlcnZpY2UsIG5vZGVTZXJ2aWNlLCBsb2FkU2VydmljZSwgc2NhbGVDb25maWcsIHN1Ym5hdlNlcnZpY2UsIHVzZXJTZXJ2aWNlLCBzY2FsZVNlcnZpY2UsIHRvYXN0cikge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0uam9iID0ge307XG4gICAgICAgIHZtLmpvYklkID0gJHJvdXRlUGFyYW1zLmlkO1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmpvYnM7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2pvYnMnKTtcbiAgICAgICAgdm0ubG9hZGluZ0pvYkRldGFpbCA9IGZhbHNlO1xuICAgICAgICB2bS5sYXRlc3RFeGVjdXRpb24gPSBudWxsO1xuICAgICAgICB2bS5leGVjdXRpb25Mb2cgPSBudWxsO1xuICAgICAgICB2bS5leGVjdXRpb25EZXRhaWxzID0gbnVsbDtcbiAgICAgICAgdm0uc2VsZWN0ZWRFeGVjdXRpb25EZXRhaWxWYWx1ZXMgPSBudWxsO1xuICAgICAgICB2bS50aW1lbGluZSA9IFtdO1xuICAgICAgICB2bS5yZWFkb25seSA9IHRydWU7XG4gICAgICAgIHZtLmpvYkVycm9yQ3JlYXRlZCA9ICcnO1xuICAgICAgICB2bS5qb2JFcnJvckxhc3RNb2RpZmllZCA9ICcnO1xuICAgICAgICB2bS5sYXN0U3RhdHVzQ2hhbmdlID0gJyc7XG4gICAgICAgIHZtLnRyaWdnZXJPY2N1cnJlZCA9ICcnO1xuXG4gICAgICAgIHZtLnNob3dMb2cgPSBmdW5jdGlvbiAoZXhlY3V0aW9uKSB7XG4gICAgICAgICAgICB2bS5zZWxlY3RlZEV4ZWN1dGlvbkxvZyA9IGV4ZWN1dGlvbjtcbiAgICAgICAgICAgICR1aWJNb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdzaG93TG9nLmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXG4gICAgICAgICAgICAgICAgd2luZG93Q2xhc3M6ICdsb2ctbW9kYWwtd2luZG93J1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uc2hvd0V4ZWN1dGlvbkRldGFpbHMgPSBmdW5jdGlvbiAoZXhlY3V0aW9uSWQpIHtcbiAgICAgICAgICAgIGpvYkV4ZWN1dGlvblNlcnZpY2UuZ2V0Sm9iRXhlY3V0aW9uRGV0YWlscyhleGVjdXRpb25JZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRXhlY3V0aW9uRGV0YWlscyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRFeGVjdXRpb25EZXRhaWxWYWx1ZXMgPSBfLnBhaXJzKGRhdGEpO1xuICAgICAgICAgICAgICAgICR1aWJNb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3Nob3dFeGVjdXRpb25EZXRhaWxzLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiAnbGcnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5yZXF1ZXVlSm9iID0gZnVuY3Rpb24gKGpvYklkKSB7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGxvYWRTZXJ2aWNlLnJlcXVldWVKb2JzKHsgam9iX2lkczogW2pvYklkXSB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdG9hc3RyWydzdWNjZXNzJ10oJ1JlcXVldWVkIEpvYicpO1xuICAgICAgICAgICAgICAgIHZtLmpvYi5zdGF0dXMgPSBkYXRhLmpvYl9zdGF0dXM7XG4gICAgICAgICAgICAgICAgZ2V0Sm9iRGV0YWlsKGpvYklkKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXSgnUmVxdWV1ZSByZXF1ZXN0IGZhaWxlZCcpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmNhbmNlbEpvYiA9IGZ1bmN0aW9uIChqb2IpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgdm0uYWN0aW9uQ2xpY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBvcmlnaW5hbFN0YXR1cyA9IGpvYi5zdGF0dXM7XG4gICAgICAgICAgICBqb2Iuc3RhdHVzID0gJ0NBTkNFTCc7XG4gICAgICAgICAgICBqb2JTZXJ2aWNlLnVwZGF0ZUpvYihqb2IuaWQsIHsgc3RhdHVzOiAnQ0FOQ0VMRUQnIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnc3VjY2VzcyddKCdKb2IgQ2FuY2VsZWQnKTtcbiAgICAgICAgICAgICAgICBqb2Iuc3RhdHVzID0gJ0NBTkNFTEVEJztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgIGpvYi5zdGF0dXMgPSBvcmlnaW5hbFN0YXR1cztcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgdm0uY2FsY3VsYXRlRmlsZVNpemUgPSBmdW5jdGlvbiAoc2l6ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21CeXRlcyhzaXplKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Sm9iRGV0YWlsID0gZnVuY3Rpb24gKGpvYklkKSB7XG4gICAgICAgICAgICB2bS5sb2FkaW5nSm9iRGV0YWlsID0gdHJ1ZTtcbiAgICAgICAgICAgIGpvYlNlcnZpY2UuZ2V0Sm9iRGV0YWlsKGpvYklkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uam9iID0gZGF0YTtcbiAgICAgICAgICAgICAgICB2bS50aW1lbGluZSA9IGNhbGN1bGF0ZVRpbWVsaW5lKGRhdGEpO1xuICAgICAgICAgICAgICAgIHZtLmxhdGVzdEV4ZWN1dGlvbiA9IGRhdGEuZ2V0TGF0ZXN0RXhlY3V0aW9uKCk7XG4gICAgICAgICAgICAgICAgdm0uam9iRXJyb3JDcmVhdGVkID0gZGF0YS5lcnJvciA/IG1vbWVudC51dGMoZGF0YS5lcnJvci5jcmVhdGVkKS50b0lTT1N0cmluZygpIDogJyc7XG4gICAgICAgICAgICAgICAgdm0ubGFzdFN0YXR1c0NoYW5nZSA9IGRhdGEubGFzdF9zdGF0dXNfY2hhbmdlID8gbW9tZW50LmR1cmF0aW9uKG1vbWVudC51dGMoZGF0YS5sYXN0X3N0YXR1c19jaGFuZ2UpLmRpZmYobW9tZW50LnV0YygpKSkuaHVtYW5pemUodHJ1ZSkgOiAnJztcbiAgICAgICAgICAgICAgICB2bS50cmlnZ2VyT2NjdXJyZWQgPSBkYXRhLmV2ZW50Lm9jY3VycmVkID8gbW9tZW50LmR1cmF0aW9uKG1vbWVudC51dGMoZGF0YS5ldmVudC5vY2N1cnJlZCkuZGlmZihtb21lbnQudXRjKCkpKS5odW1hbml6ZSh0cnVlKSA6ICcnO1xuICAgICAgICAgICAgICAgIHZtLmlucHV0cyA9IGRhdGEuaW5wdXRzO1xuICAgICAgICAgICAgICAgIHZtLm91dHB1dHMgPSBkYXRhLm91dHB1dHM7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nSm9iRGV0YWlsID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY2FsY3VsYXRlVGltZWxpbmUgPSBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICB2YXIgdGwgPSBbXTtcbiAgICAgICAgICAgIHRsLnB1c2goeyB0YXNrTmFtZTogJ0NyZWF0ZWQnLCBzdGFydGVkOiBqb2IuY3JlYXRlZCA/IG1vbWVudC51dGMoam9iLmNyZWF0ZWQpLnRvRGF0ZSgpIDogam9iLmNyZWF0ZWQsIGVuZGVkOiBqb2IucXVldWVkID8gbW9tZW50LnV0Yyhqb2IucXVldWVkKS50b0RhdGUoKSA6IGpvYi5xdWV1ZWQgfSk7XG4gICAgICAgICAgICB0bC5wdXNoKHsgdGFza05hbWU6ICdRdWV1ZWQnLCBzdGFydGVkOiBqb2IucXVldWVkID8gbW9tZW50LnV0Yyhqb2IucXVldWVkKS50b0RhdGUoKSA6IGpvYi5xdWV1ZWQsIGVuZGVkOiBqb2Iuc3RhcnRlZCA/IG1vbWVudC51dGMoam9iLnN0YXJ0ZWQpLnRvRGF0ZSgpIDogam9iLnN0YXJ0ZWQgfSk7XG4gICAgICAgICAgICB0bC5wdXNoKHsgdGFza05hbWU6ICdFeGVjdXRlZCcsIHN0YXJ0ZWQ6IGpvYi5zdGFydGVkID8gbW9tZW50LnV0Yyhqb2Iuc3RhcnRlZCkudG9EYXRlKCkgOiBqb2Iuc3RhcnRlZCwgZW5kZWQ6IGpvYi5lbmRlZCA/IG1vbWVudC51dGMoam9iLmVuZGVkKS50b0RhdGUoKSA6IGpvYi5lbmRlZCB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHRsO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignam9icycpO1xuICAgICAgICAgICAgdmFyIHVzZXIgPSB1c2VyU2VydmljZS5nZXRVc2VyQ3JlZHMoKTtcbiAgICAgICAgICAgIHZtLnJlYWRvbmx5ID0gISh1c2VyICYmIHVzZXIuaXNfYWRtaW4pO1xuICAgICAgICAgICAgZ2V0Sm9iRGV0YWlsKHZtLmpvYklkKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdqb2JFeGVjdXRpb25EZXRhaWxDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCAkcm91dGVQYXJhbXMsIG5hdlNlcnZpY2UsIGpvYkV4ZWN1dGlvblNlcnZpY2UsIG5vZGVTZXJ2aWNlLCBzY2FsZUNvbmZpZywgc3VibmF2U2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0uam9iRXhlY3V0aW9uID0ge307XG4gICAgICAgIHZtLmpvYkV4ZWN1dGlvbklkID0gJHJvdXRlUGFyYW1zLmlkO1xuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0uc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5qb2JzO1xuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdqb2JzL3J1bnMnKTtcblxuICAgICAgICB2YXIgZ2V0Sm9iRXhlY3V0aW9uRGV0YWlsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgam9iRXhlY3V0aW9uU2VydmljZS5nZXRKb2JFeGVjdXRpb25EZXRhaWwoaWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JFeGVjdXRpb24gPSBkYXRhO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBnZXRKb2JFeGVjdXRpb25EZXRhaWwoJHJvdXRlUGFyYW1zLmlkKTtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2pvYnMnKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignam9iRXhlY3V0aW9uc0NvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sIG5hdlNlcnZpY2UsIHN0YXRlU2VydmljZSwgZ3JpZEZhY3RvcnksIHVzZXJTZXJ2aWNlLCBqb2JFeGVjdXRpb25TZXJ2aWNlLCBqb2JUeXBlU2VydmljZSwgdWlHcmlkQ29uc3RhbnRzLCBzY2FsZUNvbmZpZywgc3VibmF2U2VydmljZSkge1xuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdqb2JzJyk7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcyxcbiAgICAgICAgICAgIGpvYlR5cGVWaWV3QWxsID0geyBuYW1lOiAnVklFVyBBTEwnLCB0aXRsZTogJ1ZJRVcgQUxMJywgdmVyc2lvbjogJycsIGlkOiAwIH07XG5cbiAgICAgICAgdm0uam9iRXhlY3V0aW9uc1BhcmFtcyA9IHN0YXRlU2VydmljZS5nZXRKb2JFeGVjdXRpb25zUGFyYW1zKCk7XG5cbiAgICAgICAgdm0uc3RhdGVTZXJ2aWNlID0gc3RhdGVTZXJ2aWNlO1xuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0ucmVhZG9ubHkgPSB0cnVlO1xuICAgICAgICB2bS5qb2JUeXBlVmFsdWVzID0gW2pvYlR5cGVWaWV3QWxsXTtcbiAgICAgICAgdm0uam9iRXhlY3V0aW9uID0gbnVsbDtcbiAgICAgICAgdm0uc2VsZWN0ZWRKb2JUeXBlID0gdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5qb2JfdHlwZV9pZCA/IHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMuam9iX3R5cGVfaWQgOiBqb2JUeXBlVmlld0FsbDtcbiAgICAgICAgdm0uam9iU3RhdHVzVmFsdWVzID0gc2NhbGVDb25maWcuam9iU3RhdHVzO1xuICAgICAgICB2bS5zZWxlY3RlZEpvYlN0YXR1cyA9IHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMuc3RhdHVzIHx8IHZtLmpvYlN0YXR1c1ZhbHVlc1swXTtcbiAgICAgICAgdm0uc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5qb2JzO1xuICAgICAgICB2bS5hY3Rpb25DbGlja2VkID0gZmFsc2U7XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0YXJ0ID0gbW9tZW50LnV0Yyh2bS5qb2JFeGVjdXRpb25zUGFyYW1zLnN0YXJ0ZWQpLnRvRGF0ZSgpO1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdGFydFBvcHVwID0ge1xuICAgICAgICAgICAgb3BlbmVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICB2bS5vcGVuTGFzdE1vZGlmaWVkU3RhcnRQb3B1cCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHZtLmxhc3RNb2RpZmllZFN0YXJ0UG9wdXAub3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RvcCA9IG1vbWVudC51dGModm0uam9iRXhlY3V0aW9uc1BhcmFtcy5lbmRlZCkudG9EYXRlKCk7XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0b3BQb3B1cCA9IHtcbiAgICAgICAgICAgIG9wZW5lZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgdm0ub3Blbkxhc3RNb2RpZmllZFN0b3BQb3B1cCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHZtLmxhc3RNb2RpZmllZFN0b3BQb3B1cC5vcGVuZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICB2bS5kYXRlTW9kZWxPcHRpb25zID0ge1xuICAgICAgICAgICAgdGltZXpvbmU6ICcrMDAwJ1xuICAgICAgICB9O1xuICAgICAgICB2bS5ncmlkT3B0aW9ucyA9IGdyaWRGYWN0b3J5LmRlZmF1bHRHcmlkT3B0aW9ucygpO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uQ3VycmVudFBhZ2UgPSB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLnBhZ2UgfHwgMTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplID0gdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5wYWdlX3NpemUgfHwgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gW107XG5cbiAgICAgICAgdmFyIGZpbHRlcmVkQnlKb2JUeXBlID0gdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5qb2JfdHlwZV9pZCA/IHRydWUgOiBmYWxzZSxcbiAgICAgICAgICAgIGZpbHRlcmVkQnlKb2JTdGF0dXMgPSB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLnN0YXR1cyA/IHRydWUgOiBmYWxzZSxcbiAgICAgICAgICAgIGZpbHRlcmVkQnlPcmRlciA9IHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMub3JkZXIgPyB0cnVlIDogZmFsc2U7XG5cbiAgICAgICAgdm0uY29sRGVmcyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2pvYl90eXBlJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0pvYiBUeXBlJyxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+PHNwYW4gbmctYmluZC1odG1sPVwicm93LmVudGl0eS5qb2JfdHlwZS5nZXRJY29uKClcIj48L3NwYW4+IHt7IHJvdy5lbnRpdHkuam9iX3R5cGUudGl0bGUgfX0ge3sgcm93LmVudGl0eS5qb2JfdHlwZS52ZXJzaW9uIH19PC9kaXY+JyxcbiAgICAgICAgICAgICAgICBmaWx0ZXJIZWFkZXJUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWZpbHRlci1jb250YWluZXJcIj48c2VsZWN0IGNsYXNzPVwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIgbmctbW9kZWw9XCJncmlkLmFwcFNjb3BlLnZtLnNlbGVjdGVkSm9iVHlwZVwiIG5nLW9wdGlvbnM9XCJqb2JUeXBlIGFzIChqb2JUeXBlLnRpdGxlICsgXFwnIFxcJyArIGpvYlR5cGUudmVyc2lvbikgZm9yIGpvYlR5cGUgaW4gZ3JpZC5hcHBTY29wZS52bS5qb2JUeXBlVmFsdWVzXCI+PC9zZWxlY3Q+PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2NyZWF0ZWQnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnQ3JlYXRlZCAoWiknLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPnt7IHJvdy5lbnRpdHkuY3JlYXRlZF9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnbGFzdF9tb2RpZmllZCcsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdMYXN0IE1vZGlmaWVkIChaKScsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+e3sgcm93LmVudGl0eS5sYXN0X21vZGlmaWVkX2Zvcm1hdHRlZCB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdkdXJhdGlvbicsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlbmFibGVTb3J0aW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB3aWR0aDogMTIwLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHMgdGV4dC1yaWdodFwiPnt7IHJvdy5lbnRpdHkuZ2V0RHVyYXRpb24oKSB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdzdGF0dXMnLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAxNTAsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPjxkaXYgY2xhc3M9XCJwdWxsLXJpZ2h0XCI+PGJ1dHRvbiBuZy1zaG93PVwiKCghZ3JpZC5hcHBTY29wZS52bS5yZWFkb25seSkgJiYgKHJvdy5lbnRpdHkuc3RhdHVzID09PSBcXCdGQUlMRURcXCcgfHwgcm93LmVudGl0eS5zdGF0dXMgPT09IFxcJ0NBTkNFTEVEXFwnKSlcIiBuZy1jbGljaz1cImdyaWQuYXBwU2NvcGUudm0ucmVxdWV1ZUpvYnMoeyBqb2JfaWRzOiBbcm93LmVudGl0eS5pZF0gfSlcIiBjbGFzcz1cImJ0biBidG4teHMgYnRuLWRlZmF1bHRcIiB0aXRsZT1cIlJlcXVldWUgSm9iXCI+PGkgY2xhc3M9XCJmYSBmYS1yZXBlYXRcIj48L2k+PC9idXR0b24+IDxidXR0b24gbmctc2hvdz1cIiFncmlkLmFwcFNjb3BlLnZtLnJlYWRvbmx5ICYmIHJvdy5lbnRpdHkuc3RhdHVzICE9PSBcXCdDT01QTEVURURcXCcgJiYgcm93LmVudGl0eS5zdGF0dXMgIT09IFxcJ0NBTkNFTEVEXFwnXCIgbmctY2xpY2s9XCJncmlkLmFwcFNjb3BlLnZtLmNhbmNlbEpvYihyb3cuZW50aXR5KVwiIGNsYXNzPVwiYnRuIGJ0bi14cyBidG4tZGVmYXVsdFwiIHRpdGxlPVwiQ2FuY2VsIEpvYlwiPjxpIGNsYXNzPVwiZmEgZmEtYmFuXCI+PC9pPjwvYnV0dG9uPjwvZGl2PiB7eyByb3cuZW50aXR5LnN0YXR1cyB9fTwvZGl2PicsXG4gICAgICAgICAgICAgICAgZmlsdGVySGVhZGVyVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1maWx0ZXItY29udGFpbmVyXCI+PHNlbGVjdCBjbGFzcz1cImZvcm0tY29udHJvbCBpbnB1dC1zbVwiIG5nLW1vZGVsPVwiZ3JpZC5hcHBTY29wZS52bS5zZWxlY3RlZEpvYlN0YXR1c1wiPjxvcHRpb24gbmctc2VsZWN0ZWQ9XCJ7eyBncmlkLmFwcFNjb3BlLnZtLmpvYlN0YXR1c1ZhbHVlc1skaW5kZXhdID09IGdyaWQuYXBwU2NvcGUudm0uc2VsZWN0ZWRKb2JTdGF0dXMgfX1cIiB2YWx1ZT1cInt7IGdyaWQuYXBwU2NvcGUudm0uam9iU3RhdHVzVmFsdWVzWyRpbmRleF0gfX1cIiBuZy1yZXBlYXQ9XCJzdGF0dXMgaW4gZ3JpZC5hcHBTY29wZS52bS5qb2JTdGF0dXNWYWx1ZXMgdHJhY2sgYnkgJGluZGV4XCI+e3sgc3RhdHVzLnRvVXBwZXJDYXNlKCkgfX08L29wdGlvbj48L3NlbGVjdD48L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnaWQnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnTG9nJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHNvcnRhYmxlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB3aWR0aDogNjAsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50cyB0ZXh0LWNlbnRlclwiPjxidXR0b24gbmctY2xpY2s9XCJncmlkLmFwcFNjb3BlLnZtLnNob3dMb2cocm93LmVudGl0eSlcIiBjbGFzcz1cImJ0biBidG4teHMgYnRuLWRlZmF1bHRcIj48aSBjbGFzcz1cImZhIGZhLWZpbGUtdGV4dFwiPjwvaT48L2J1dHRvbj48L2Rpdj4nXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgdm0uZ2V0Sm9iRXhlY3V0aW9ucyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpvYkV4ZWN1dGlvblNlcnZpY2UuZ2V0Sm9iRXhlY3V0aW9ucyh2bS5qb2JFeGVjdXRpb25zUGFyYW1zKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudG90YWxJdGVtcyA9IGRhdGEuY291bnQ7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMubWluUm93c1RvU2hvdyA9IGRhdGEucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudmlydHVhbGl6YXRpb25UaHJlc2hvbGQgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5nZXRKb2JUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpvYlR5cGVTZXJ2aWNlLmdldEpvYlR5cGVzT25jZSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JUeXBlVmFsdWVzLnB1c2goZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICB2bS5qb2JUeXBlVmFsdWVzID0gXy5mbGF0dGVuKHZtLmpvYlR5cGVWYWx1ZXMpO1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkSm9iVHlwZSA9IF8uZmluZCh2bS5qb2JUeXBlVmFsdWVzLCB7IGlkOiB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLmpvYl90eXBlX2lkIH0pIHx8IGpvYlR5cGVWaWV3QWxsO1xuICAgICAgICAgICAgICAgIHZtLmdldEpvYkV4ZWN1dGlvbnMoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5zaG93TG9nID0gZnVuY3Rpb24gKGpvYkV4ZWN1dGlvbikge1xuICAgICAgICAgICAgLy8gc2hvdyBsb2cgbW9kYWxcbiAgICAgICAgICAgIHZtLmFjdGlvbkNsaWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uID0gam9iRXhlY3V0aW9uO1xuICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3Nob3dMb2cuaHRtbCcsXG4gICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZSxcbiAgICAgICAgICAgICAgICBzaXplOiAnbGcnLFxuICAgICAgICAgICAgICAgIHdpbmRvd0NsYXNzOiAnbG9nLW1vZGFsLXdpbmRvdydcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmZpbHRlclJlc3VsdHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0Sm9ic1BhcmFtcyh2bS5qb2JFeGVjdXRpb25zUGFyYW1zKTtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgdm0uZ2V0Sm9icygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUNvbERlZnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5jb2x1bW5EZWZzID0gZ3JpZEZhY3RvcnkuYXBwbHlTb3J0Q29uZmlnKHZtLmNvbERlZnMsIHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUpvYk9yZGVyID0gZnVuY3Rpb24gKHNvcnRBcnIpIHtcbiAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMub3JkZXIgPSBzb3J0QXJyLmxlbmd0aCA+IDAgPyBzb3J0QXJyIDogbnVsbDtcbiAgICAgICAgICAgIGZpbHRlcmVkQnlPcmRlciA9IHNvcnRBcnIubGVuZ3RoID4gMDtcbiAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVKb2JUeXBlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUuaWQgIT09IHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMuam9iX3R5cGVfaWQpIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLnBhZ2UgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5qb2JfdHlwZV9pZCA9IHZhbHVlLmlkID09PSAwID8gbnVsbCA6IHZhbHVlLmlkO1xuICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5wYWdlX3NpemUgPSB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlSm9iU3RhdHVzID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUgIT0gdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLnBhZ2UgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5zdGF0dXMgPSB2YWx1ZSA9PT0gJ1ZJRVcgQUxMJyA/IG51bGwgOiB2YWx1ZTtcbiAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMucGFnZV9zaXplID0gdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplO1xuICAgICAgICAgICAgaWYgKCF2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdyaWRPcHRpb25zLm9uUmVnaXN0ZXJBcGkgPSBmdW5jdGlvbiAoZ3JpZEFwaSkge1xuICAgICAgICAgICAgLy9zZXQgZ3JpZEFwaSBvbiBzY29wZVxuICAgICAgICAgICAgdm0uZ3JpZEFwaSA9IGdyaWRBcGk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLnNlbGVjdGlvbi5vbi5yb3dTZWxlY3Rpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgICAgICAgIGlmICh2bS5hY3Rpb25DbGlja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGlvbkNsaWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2pvYnMvam9iLycgKyByb3cuZW50aXR5LmlkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZtLmdyaWRBcGkucGFnaW5hdGlvbi5vbi5wYWdpbmF0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChjdXJyZW50UGFnZSwgcGFnZVNpemUpIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLnBhZ2UgPSBjdXJyZW50UGFnZTtcbiAgICAgICAgICAgICAgICB2bS5qb2JFeGVjdXRpb25zUGFyYW1zLnBhZ2Vfc2l6ZSA9IHBhZ2VTaXplO1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5jb3JlLm9uLnNvcnRDaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGdyaWQsIHNvcnRDb2x1bW5zKSB7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmdyaWRBcGkuZ3JpZC5jb2x1bW5zLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbC5jb2xEZWYuc29ydCA9IGNvbC5zb3J0O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRKb2JzQ29sRGVmcyh2bS5ncmlkQXBpLmdyaWQub3B0aW9ucy5jb2x1bW5EZWZzKTtcbiAgICAgICAgICAgICAgICB2YXIgc29ydEFyciA9IFtdO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChzb3J0Q29sdW1ucywgZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgICAgICAgICAgICBzb3J0QXJyLnB1c2goY29sLnNvcnQuZGlyZWN0aW9uID09PSAnZGVzYycgPyAnLScgKyBjb2wuZmllbGQgOiBjb2wuZmllbGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUpvYk9yZGVyKHNvcnRBcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRKb2JFeGVjdXRpb25zUGFyYW1zKHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMpO1xuICAgICAgICAgICAgdm0udXBkYXRlQ29sRGVmcygpO1xuICAgICAgICAgICAgdmFyIHVzZXIgPSB1c2VyU2VydmljZS5nZXRVc2VyQ3JlZHMoKTtcbiAgICAgICAgICAgIHZtLnJlYWRvbmx5ID0gISh1c2VyICYmIHVzZXIuaXNfYWRtaW4pO1xuICAgICAgICAgICAgdm0uZ2V0Sm9iVHlwZXMoKTtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2pvYnMvZXhlY3V0aW9ucycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluaXRpYWxpemUoKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5zZWxlY3RlZEpvYlR5cGUnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChwYXJzZUludCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IF8uZmluZCh2bS5qb2JUeXBlVmFsdWVzLCB7aWQ6IHBhcnNlSW50KHZhbHVlKX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkQnlKb2JUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS51cGRhdGVKb2JUeXBlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkQnlKb2JUeXBlID0gIWFuZ3VsYXIuZXF1YWxzKHZhbHVlLCBqb2JUeXBlVmlld0FsbCk7XG4gICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUpvYlR5cGUodmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uc2VsZWN0ZWRKb2JTdGF0dXMnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkQnlKb2JTdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRlSm9iU3RhdHVzKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZpbHRlcmVkQnlKb2JTdGF0dXMgPSB2YWx1ZSAhPT0gJ1ZJRVcgQUxMJztcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVKb2JTdGF0dXModmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5sYXN0TW9kaWZpZWRTdGFydCcsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCF2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgdm0uam9iRXhlY3V0aW9uc1BhcmFtcy5zdGFydGVkID0gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmxhc3RNb2RpZmllZFN0b3AnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbnNQYXJhbXMuZW5kZWQgPSB2YWx1ZS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ3ZtLnN0YXRlU2VydmljZS5nZXRKb2JzQ29sRGVmcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5jb2xEZWZzID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0Sm9ic1BhcmFtcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5qb2JFeGVjdXRpb25zUGFyYW1zID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYlR5cGVzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCBob3RrZXlzLCBzY2FsZVNlcnZpY2UsIG5hdlNlcnZpY2UsIGpvYlR5cGVTZXJ2aWNlLCBzY2FsZUNvbmZpZywgc3VibmF2U2VydmljZSwgbm9kZVNlcnZpY2UsIGxvY2FsU3RvcmFnZSwgdXNlclNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHZtLmNvbnRhaW5lclN0eWxlID0gJyc7XG4gICAgICAgIHZtLnJlcXVlc3RlZEpvYlR5cGVJZCA9IHBhcnNlSW50KCRyb3V0ZVBhcmFtcy5pZCk7XG4gICAgICAgIHZtLmpvYlR5cGVzID0gW107XG4gICAgICAgIHZtLmpvYlR5cGVJZHMgPSBbXTtcbiAgICAgICAgdm0uam9iVHlwZUNvdW50ID0gMDtcbiAgICAgICAgdm0uYWN0aXZlSm9iVHlwZURldGFpbHMgPSB7fTtcbiAgICAgICAgdm0uYWN0aXZlSm9iVHlwZUludGVyZmFjZVZhbHVlcyA9IFtdO1xuICAgICAgICB2bS5hY3RpdmVKb2JUeXBlRXJyb3JzID0gW107XG4gICAgICAgIHZtLmFjdGl2ZUpvYlR5cGVTdGF0cyA9IHt9O1xuICAgICAgICB2bS5zaG93Sm9iVHlwZUVycm9ycyA9IGZhbHNlO1xuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0uYWN0aXZlSm9iVHlwZSA9IG51bGw7XG4gICAgICAgIHZtLmhlYWx0aERhdGE2ID0ge307XG4gICAgICAgIHZtLmhlYWx0aERhdGExMiA9IHt9O1xuICAgICAgICB2bS5oZWFsdGhEYXRhMjQgPSB7fTtcbiAgICAgICAgdm0uYWN0aXZpdHlJY29uID0gJzxpIGNsYXNzPVwiZmEgZmEtcHVsc2VcIj4mI3gnICsgc2NhbGVDb25maWcuYWN0aXZpdHlJY29uQ29kZSArICc8L2k+JztcbiAgICAgICAgdm0uam9iRGV0YWlsc0NsYXNzID0gJ2hpZGRlbic7XG4gICAgICAgIHZtLnBhdXNlQnRuQ2xhc3MgPSAnZmEtcGF1c2UnO1xuICAgICAgICB2bS51c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgIHZtLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3Muam9icztcbiAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnam9icy90eXBlcycpO1xuXG4gICAgICAgIHZtLnZpZXdEZXRhaWxzID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICB2bS5hY3RpdmVKb2JUeXBlID0gXy5maW5kKHZtLmpvYlR5cGVzLCAnaWQnLCBpZCk7XG4gICAgICAgICAgICB2bS5hY3RpdmVKb2JUeXBlLmNyZWF0ZWQgPSBmb3JtYXREYXRlVGltZSh2bS5hY3RpdmVKb2JUeXBlLmNyZWF0ZWQpO1xuICAgICAgICAgICAgdm0uYWN0aXZlSm9iVHlwZS5sYXN0TW9kaWZpZWQgPSBmb3JtYXREYXRlVGltZSh2bS5hY3RpdmVKb2JUeXBlLmxhc3RNb2RpZmllZCk7XG5cbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdqb2JzL3R5cGVzLycgKyBpZCk7XG5cbiAgICAgICAgICAgIGdldEpvYlR5cGVEZXRhaWxzKHZtLmFjdGl2ZUpvYlR5cGUuaWQpO1xuXG4gICAgICAgICAgICB2bS5qb2JEZXRhaWxzQ2xhc3MgPSAndmlzaWJsZSc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udG9nZ2xlUGF1c2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5hY3RpdmVKb2JUeXBlLmlzX3BhdXNlZCA9ICF2bS5hY3RpdmVKb2JUeXBlLmlzX3BhdXNlZDtcbiAgICAgICAgICAgIHZtLmFjdGl2ZUpvYlR5cGVEZXRhaWxzLmlzX3BhdXNlZCA9IHZtLmFjdGl2ZUpvYlR5cGUuaXNfcGF1c2VkO1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBqb2JUeXBlU2VydmljZS51cGRhdGVKb2JUeXBlKHZtLmFjdGl2ZUpvYlR5cGVEZXRhaWxzKS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgIHZtLmFjdGl2ZUpvYlR5cGVEZXRhaWxzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB2bS5wYXVzZUJ0bkNsYXNzID0gdm0uZ2V0UGF1c2VCdXR0b25DbGFzcyh2bS5hY3RpdmVKb2JUeXBlRGV0YWlscy5pc19wYXVzZWQpO1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IpO1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdldFBhdXNlQnV0dG9uQ2xhc3MgPSBmdW5jdGlvbihpc19wYXVzZWQpe1xuICAgICAgICAgICAgcmV0dXJuIGlzX3BhdXNlZCA/ICdmYS1wbGF5JyA6ICdmYS1wYXVzZSc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ2V0Sm9iVHlwZUxpc3RJdGVtQ2xhc3MgPSBmdW5jdGlvbihqb2JUeXBlKXtcbiAgICAgICAgICAgIHJldHVybiBqb2JUeXBlLmlzX3BhdXNlZCA/ICdwYXVzZWQnIDogJyc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGZvcm1hdERhdGVUaW1lID0gZnVuY3Rpb24gKGR0KSB7XG4gICAgICAgICAgICByZXR1cm4gbW9tZW50LnV0YyhkdCkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Sm9iVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBqb2JUeXBlU2VydmljZS5nZXRKb2JUeXBlc09uY2UoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uam9iVHlwZXMgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgdm0uam9iVHlwZUlkcyA9IF8ucGx1Y2sodm0uam9iVHlwZXMsICdpZCcpO1xuICAgICAgICAgICAgICAgIHZtLmpvYlR5cGVDb3VudCA9IGRhdGEuY291bnQ7XG4gICAgICAgICAgICAgICAgaWYgKHZtLnJlcXVlc3RlZEpvYlR5cGVJZCkge1xuICAgICAgICAgICAgICAgICAgICB2bS52aWV3RGV0YWlscyh2bS5yZXF1ZXN0ZWRKb2JUeXBlSWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaG90a2V5cy5iaW5kVG8oJHNjb3BlKVxuICAgICAgICAgICAgICAgICAgICAuYWRkKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbWJvOiAnY3RybCt1cCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1ByZXZpb3VzIEpvYiBUeXBlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZUpvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IF8uaW5kZXhPZih2bS5qb2JUeXBlSWRzLCB2bS5hY3RpdmVKb2JUeXBlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnZpZXdEZXRhaWxzKHZtLmpvYlR5cGVJZHNbaWR4IC0gMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KS5hZGQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tYm86ICdjdHJsK2Rvd24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdOZXh0IEpvYiBUeXBlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZUpvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IF8uaW5kZXhPZih2bS5qb2JUeXBlSWRzLCB2bS5hY3RpdmVKb2JUeXBlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA8ICh2bS5qb2JUeXBlSWRzLmxlbmd0aCAtIDEpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS52aWV3RGV0YWlscyh2bS5qb2JUeXBlSWRzW2lkeCArIDFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldEpvYlR5cGVEZXRhaWxzID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGpvYlR5cGVTZXJ2aWNlLmdldEpvYlR5cGVEZXRhaWxzKGlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlSm9iVHlwZURldGFpbHMgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHZtLmFjdGl2ZUpvYlR5cGVJbnRlcmZhY2VWYWx1ZXMgPSBfLnBhaXJzKGRhdGEuam9iX3R5cGVfaW50ZXJmYWNlKTtcbiAgICAgICAgICAgICAgICB2bS5wYXVzZUJ0bkNsYXNzID0gdm0uZ2V0UGF1c2VCdXR0b25DbGFzcyh2bS5hY3RpdmVKb2JUeXBlRGV0YWlscy5pc19wYXVzZWQpO1xuICAgICAgICAgICAgICAgIC8vIGZvcm1hdCBlcnJvciBtYXBwaW5nXG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlSm9iVHlwZUVycm9ycyA9IFtdO1xuICAgICAgICAgICAgICAgIHZtLnNob3dKb2JUeXBlRXJyb3JzID0gXy5rZXlzKGRhdGEuZXJyb3JfbWFwcGluZy5leGl0X2NvZGVzKS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgICAgIGlmICh2bS5zaG93Sm9iVHlwZUVycm9ycykge1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goZGF0YS5lcnJvcl9tYXBwaW5nLmV4aXRfY29kZXMsIGZ1bmN0aW9uIChlcnJvcl9uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSBfLmZpbmQoZGF0YS5lcnJvcnMsICduYW1lJywgZXJyb3JfbmFtZSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhpdENvZGUgPSBfLmludmVydChkYXRhLmVycm9yX21hcHBpbmcuZXhpdF9jb2RlcylbZXJyb3JfbmFtZV07XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5hY3RpdmVKb2JUeXBlRXJyb3JzLnB1c2goe2NvZGU6IGV4aXRDb2RlLCBkYXRhOiBlcnJvcn0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBmb3JtYXQgam9iIHR5cGUgc3RhdHNcbiAgICAgICAgICAgICAgICB2YXIgcGVyZm9ybWFuY2UgPSBkYXRhLmdldFBlcmZvcm1hbmNlKCksXG4gICAgICAgICAgICAgICAgICAgIGZhaWx1cmVzID0gZGF0YS5nZXRGYWlsdXJlcygpO1xuXG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlSm9iVHlwZVN0YXRzID0gcGVyZm9ybWFuY2U7XG5cbiAgICAgICAgICAgICAgICB2bS5oZWFsdGhEYXRhNiA9IHtcbiAgICAgICAgICAgICAgICAgICAgZ2F1Z2VEYXRhOiBwZXJmb3JtYW5jZS5ob3VyNi5yYXRlLFxuICAgICAgICAgICAgICAgICAgICBkb251dERhdGE6IGZhaWx1cmVzLmhvdXI2XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB2bS5oZWFsdGhEYXRhMTIgPSB7XG4gICAgICAgICAgICAgICAgICAgIGdhdWdlRGF0YTogcGVyZm9ybWFuY2UuaG91cjEyLnJhdGUsXG4gICAgICAgICAgICAgICAgICAgIGRvbnV0RGF0YTogZmFpbHVyZXMuaG91cjEyXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB2bS5oZWFsdGhEYXRhMjQgPSB7XG4gICAgICAgICAgICAgICAgICAgIGdhdWdlRGF0YTogcGVyZm9ybWFuY2UuaG91cjI0LnJhdGUsXG4gICAgICAgICAgICAgICAgICAgIGRvbnV0RGF0YTogZmFpbHVyZXMuaG91cjI0XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZ2V0Sm9iVHlwZXMoKTtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2pvYnMnKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG5cbiAgICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBzZXQgY29udGFpbmVyIGhlaWdodHMgZXF1YWwgdG8gYXZhaWxhYmxlIHBhZ2UgaGVpZ2h0XG4gICAgICAgICAgICB2YXIgdmlld3BvcnQgPSBzY2FsZVNlcnZpY2UuZ2V0Vmlld3BvcnRTaXplKCksXG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gc2NhbGVDb25maWcuaGVhZGVyT2Zmc2V0LFxuICAgICAgICAgICAgICAgIGNvbnRhaW5lck1heEhlaWdodCA9IHZpZXdwb3J0LmhlaWdodCAtIG9mZnNldDtcblxuICAgICAgICAgICAgdm0uY29udGFpbmVyU3R5bGUgPSAnaGVpZ2h0OiAnICsgY29udGFpbmVyTWF4SGVpZ2h0ICsgJ3B4OyBtYXgtaGVpZ2h0OiAnICsgY29udGFpbmVyTWF4SGVpZ2h0ICsgJ3B4Oyc7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIFxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYlR5cGVzRmFpbHVyZVJhdGVzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgc2NhbGVDb25maWcsIHN0YXRlU2VydmljZSwgc2NhbGVTZXJ2aWNlLCBzdWJuYXZTZXJ2aWNlLCBqb2JUeXBlU2VydmljZSwgbWV0cmljc1NlcnZpY2UsIGdyaWRGYWN0b3J5LCBKb2JUeXBlLCB0b2FzdHIsIG1vbWVudCkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgam9iVHlwZVZpZXdBbGwgPSB7IG5hbWU6ICdWSUVXIEFMTCcsIHRpdGxlOiAnVklFVyBBTEwnLCB2ZXJzaW9uOiAnJywgaWQ6IDAgfTtcblxuICAgICAgICB2bS5qb2JUeXBlc1BhcmFtcyA9IHN0YXRlU2VydmljZS5nZXRKb2JUeXBlc0ZhaWx1cmVSYXRlc1BhcmFtcygpO1xuXG4gICAgICAgIHZhciBqb2JUeXBlcyA9IFtdLFxuICAgICAgICAgICAgc3RhcnRlZCA9IG1vbWVudC51dGMoKS5zdWJ0cmFjdCgzMCwgJ2RheXMnKS5zdGFydE9mKCdkJykudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIGVuZGVkID0gbW9tZW50LnV0YygpLmVuZE9mKCdkJykudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIGZpbHRlcmVkQnlKb2JUeXBlID0gdm0uam9iVHlwZXNQYXJhbXMubmFtZSA/IHRydWUgOiBmYWxzZTtcblxuICAgICAgICB2bS5zdGF0ZVNlcnZpY2UgPSBzdGF0ZVNlcnZpY2U7XG4gICAgICAgIHZtLnNjYWxlU2VydmljZSA9IHNjYWxlU2VydmljZTtcbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLmRhdGVzID0gW107XG4gICAgICAgIHZtLnBlcmZvcm1hbmNlRGF0YSA9IFtdO1xuICAgICAgICB2bS5qb2JUeXBlVmFsdWVzID0gW2pvYlR5cGVWaWV3QWxsXTtcbiAgICAgICAgdm0uc2VsZWN0ZWRKb2JUeXBlID0gdm0uam9iVHlwZXNQYXJhbXMubmFtZSA/IHZtLmpvYlR5cGVzUGFyYW1zLm5hbWUgOiBqb2JUeXBlVmlld0FsbDtcbiAgICAgICAgdm0uc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5qb2JzO1xuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdqb2JzL2ZhaWx1cmUtcmF0ZXMnKTtcblxuICAgICAgICB2YXIgZGVmYXVsdENvbHVtbkRlZnMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdqb2JfdHlwZScsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdKb2IgVHlwZScsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPjxzcGFuIG5nLWJpbmQtaHRtbD1cInJvdy5lbnRpdHkuam9iX3R5cGUuZ2V0SWNvbigpXCI+PC9zcGFuPiB7eyByb3cuZW50aXR5LmpvYl90eXBlLnRpdGxlIH19IHt7IHJvdy5lbnRpdHkuam9iX3R5cGUudmVyc2lvbiB9fTwvZGl2PicsXG4gICAgICAgICAgICAgICAgZmlsdGVySGVhZGVyVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1maWx0ZXItY29udGFpbmVyXCI+PHNlbGVjdCBjbGFzcz1cImZvcm0tY29udHJvbCBpbnB1dC1zbVwiIG5nLW1vZGVsPVwiZ3JpZC5hcHBTY29wZS52bS5zZWxlY3RlZEpvYlR5cGVcIiBuZy1vcHRpb25zPVwiam9iVHlwZSBhcyAoam9iVHlwZS50aXRsZSArIFxcJyBcXCcgKyBqb2JUeXBlLnZlcnNpb24pIGZvciBqb2JUeXBlIGluIGdyaWQuYXBwU2NvcGUudm0uam9iVHlwZVZhbHVlc1wiPjwvc2VsZWN0PjwvZGl2PicsXG4gICAgICAgICAgICAgICAgZW5hYmxlU29ydGluZzogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICd0d2VudHlmb3VyX2hvdXJzJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJzI0IEhvdXJzJyxcbiAgICAgICAgICAgICAgICBlbmFibGVTb3J0aW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGhlYWRlckNlbGxUZW1wbGF0ZTogJ2dyaWRIZWFkZXIuaHRtbCcsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnZ3JpZFJvdy5odG1sJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2ZvcnR5ZWlnaHRfaG91cnMnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnNDggSG91cnMnLFxuICAgICAgICAgICAgICAgIGVuYWJsZVNvcnRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgaGVhZGVyQ2VsbFRlbXBsYXRlOiAnZ3JpZEhlYWRlci5odG1sJyxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICdncmlkUm93Lmh0bWwnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAndGhpcnR5X2RheXMnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnMzAgRGF5cycsXG4gICAgICAgICAgICAgICAgZW5hYmxlU29ydGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBoZWFkZXJDZWxsVGVtcGxhdGU6ICdncmlkSGVhZGVyLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJ2dyaWRSb3cuaHRtbCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgXTtcblxuICAgICAgICB2bS5ncmlkT3B0aW9ucyA9IGdyaWRGYWN0b3J5LmRlZmF1bHRHcmlkT3B0aW9ucygpO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5jb2x1bW5EZWZzID0gZGVmYXVsdENvbHVtbkRlZnM7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMub25SZWdpc3RlckFwaSA9IGZ1bmN0aW9uIChncmlkQXBpKSB7XG4gICAgICAgICAgICAvL3NldCBncmlkQXBpIG9uIHNjb3BlXG4gICAgICAgICAgICAkc2NvcGUuZ3JpZEFwaSA9IGdyaWRBcGk7XG4gICAgICAgICAgICAkc2NvcGUuZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmFjdGlvbkNsaWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFjdGlvbkNsaWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvam9icy90eXBlcy8nICsgcm93LmVudGl0eS5qb2JfdHlwZS5pZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgdm0uc2V0U3R5bGUgPSBmdW5jdGlvbiAoY29sRmllbGQsIGVycm9yVHlwZSkge1xuICAgICAgICAgICAgdmFyIGVycm9yVmFsdWUgPSAoY29sRmllbGRbZXJyb3JUeXBlXSAvIGNvbEZpZWxkLnRvdGFsKS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgdmFyIHRleHRDb2xvciA9IGVycm9yVmFsdWUgPj0gMC41ID8gJyNmZmYnIDogJyMwMDAnO1xuICAgICAgICAgICAgdmFyIHJnYiA9IGVycm9yVHlwZSA9PT0gJ3N5c3RlbScgPyAnMTAzLCAwLCAxMycgOiBlcnJvclR5cGUgPT09ICdhbGdvcml0aG0nID8gJzIwMywgMjQsIDI5JyA6ICcyNDEsIDEwNSwgMTknO1xuICAgICAgICAgICAgcmV0dXJuICdiYWNrZ3JvdW5kOiByZ2JhKCcgKyByZ2IgKyAnLCAnICsgZXJyb3JWYWx1ZSArICcpOyBjb2xvcjogJyArIHRleHRDb2xvcjtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5mYWlsUmF0ZVN0eWxlID0gZnVuY3Rpb24gKGVycm9yLCB0b3RhbCkge1xuICAgICAgICAgICAgdmFyIHBlcmNlbnRhZ2UgPSAoKGVycm9yIC8gdG90YWwpICogMTAwKS50b0ZpeGVkKDApO1xuICAgICAgICAgICAgcmV0dXJuIHBlcmNlbnRhZ2UgPiAwID8gJ3dpZHRoOiAnICsgcGVyY2VudGFnZSArICclJyA6ICdkaXNwbGF5OiBub25lJztcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHZtLmdldFBlcmNlbnRhZ2VPZlRvdGFsID0gZnVuY3Rpb24gKGVycm9yVG90YWwsIHRvdGFsKSB7XG4gICAgICAgICAgICBpZiAodG90YWwgPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJzAlJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAoKGVycm9yVG90YWwgLyB0b3RhbCkgKiAxMDApLnRvRml4ZWQoMCkgKyAnJSc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZmlsdGVyUmVzdWx0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcbiAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRKb2JUeXBlc0ZhaWx1cmVSYXRlc1BhcmFtcyh2bS5qb2JUeXBlc1BhcmFtcyk7XG4gICAgICAgICAgICBfLmZvckVhY2goXy5wYWlycyh2bS5qb2JUeXBlc1BhcmFtcyksIGZ1bmN0aW9uIChwYXJhbSkge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2gocGFyYW1bMF0sIHBhcmFtWzFdKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlSm9iVHlwZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgdm0uam9iVHlwZXNQYXJhbXMubmFtZSA9IHZhbHVlLm5hbWUgPT09ICdWSUVXIEFMTCcgPyBudWxsIDogdmFsdWUubmFtZTtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZm9ybWF0RGF0YSA9IGZ1bmN0aW9uIChkYXRhLCBudW1EYXlzKSB7XG4gICAgICAgICAgICB2YXIgZGF0YUFyciA9IFtdO1xuICAgICAgICAgICAgXy5mb3JFYWNoKGRhdGEsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyZWRSZXN1bHQgPSBfLmZpbHRlcihyZXN1bHQsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRlID0gbW9tZW50LnV0YyhkLmRhdGUsICdZWVlZLU1NLUREJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtb21lbnQudXRjKCkuZGlmZihtb21lbnQudXRjKGRhdGUpLCAnZCcpIDw9IG51bURheXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZGF0YUFyci5wdXNoKGZpbHRlcmVkUmVzdWx0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGFBcnI7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGZvcm1hdENvbHVtbiA9IGZ1bmN0aW9uIChjRGF0YSwgaWQpIHtcbiAgICAgICAgICAgIHZhciBzeXN0ZW1FcnJvcnMgPSBjRGF0YVswXSxcbiAgICAgICAgICAgICAgICBhbGdvcml0aG1FcnJvcnMgPSBjRGF0YVsxXSxcbiAgICAgICAgICAgICAgICBkYXRhRXJyb3JzID0gY0RhdGFbMl0sXG4gICAgICAgICAgICAgICAgdG90YWxDb3VudCA9IGNEYXRhWzNdO1xuXG4gICAgICAgICAgICB2YXIgb2JqID0ge1xuICAgICAgICAgICAgICAgIHN5c3RlbTogXy5zdW0oXy5tYXAoXy5maWx0ZXIoc3lzdGVtRXJyb3JzLCB7IGlkOiBpZCB9KSwgJ3ZhbHVlJykpLFxuICAgICAgICAgICAgICAgIGFsZ29yaXRobTogXy5zdW0oXy5tYXAoXy5maWx0ZXIoYWxnb3JpdGhtRXJyb3JzLCB7IGlkOiBpZCB9KSwgJ3ZhbHVlJykpLFxuICAgICAgICAgICAgICAgIGRhdGE6IF8uc3VtKF8ubWFwKF8uZmlsdGVyKGRhdGFFcnJvcnMsIHsgaWQ6IGlkIH0pLCAndmFsdWUnKSksXG4gICAgICAgICAgICAgICAgdG90YWw6IF8uc3VtKF8ubWFwKF8uZmlsdGVyKHRvdGFsQ291bnQsIHsgaWQ6IGlkIH0pLCAndmFsdWUnKSlcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBvYmouZXJyb3JUb3RhbCA9IG9iai5zeXN0ZW0gKyBvYmouYWxnb3JpdGhtICsgb2JqLmRhdGE7XG5cbiAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0Sm9iVHlwZXNGYWlsdXJlUmF0ZXNQYXJhbXModm0uam9iVHlwZXNQYXJhbXMpO1xuICAgICAgICAgICAgam9iVHlwZVNlcnZpY2UuZ2V0Sm9iVHlwZXNPbmNlKCkudGhlbihmdW5jdGlvbiAoam9iVHlwZXNEYXRhKSB7XG4gICAgICAgICAgICAgICAgam9iVHlwZXMgPSBfLmNsb25lRGVlcChqb2JUeXBlc0RhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgdm0uam9iVHlwZVZhbHVlcy5wdXNoKGpvYlR5cGVzRGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICB2bS5qb2JUeXBlVmFsdWVzID0gXy5mbGF0dGVuKHZtLmpvYlR5cGVWYWx1ZXMpO1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkSm9iVHlwZSA9IF8uZmluZCh2bS5qb2JUeXBlVmFsdWVzLCB7IG5hbWU6IHZtLmpvYlR5cGVzUGFyYW1zLm5hbWUgfSkgfHwgam9iVHlwZVZpZXdBbGw7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudG90YWxJdGVtcyA9IGpvYlR5cGVzRGF0YS5jb3VudDtcblxuICAgICAgICAgICAgICAgIHZhciBtZXRyaWNzUGFyYW1zID0ge1xuICAgICAgICAgICAgICAgICAgICBwYWdlOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBwYWdlX3NpemU6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICAgICAgY2hvaWNlX2lkOiB2bS5zZWxlY3RlZEpvYlR5cGUuaWQgPiAwID8gW3ZtLnNlbGVjdGVkSm9iVHlwZS5pZF0gOiBfLm1hcChqb2JUeXBlcywgJ2lkJyksXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbjogWydlcnJvcl9zeXN0ZW1fY291bnQnLCAnZXJyb3JfYWxnb3JpdGhtX2NvdW50JywgJ2Vycm9yX2RhdGFfY291bnQnLCAndG90YWxfY291bnQnXSxcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnam9iLXR5cGVzJ1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBtZXRyaWNzU2VydmljZS5nZXRQbG90RGF0YShtZXRyaWNzUGFyYW1zKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnJlc3VsdHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEzMERheXMgPSBfLm1hcChkYXRhLnJlc3VsdHMsICd2YWx1ZXMnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhNDhIb3VycyA9IGZvcm1hdERhdGEoZGF0YTMwRGF5cywgMiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTI0SG91cnMgPSBmb3JtYXREYXRhKGRhdGE0OEhvdXJzLCAxKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGpvYlR5cGVzLCBmdW5jdGlvbiAoam9iVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnBlcmZvcm1hbmNlRGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iX3R5cGU6IEpvYlR5cGUudHJhbnNmb3JtZXIoam9iVHlwZSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR3ZW50eWZvdXJfaG91cnM6IGZvcm1hdENvbHVtbihkYXRhMjRIb3Vycywgam9iVHlwZS5pZCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcnR5ZWlnaHRfaG91cnM6IGZvcm1hdENvbHVtbihkYXRhNDhIb3Vycywgam9iVHlwZS5pZCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXJ0eV9kYXlzOiBmb3JtYXRDb2x1bW4oZGF0YTMwRGF5cywgam9iVHlwZS5pZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5wZXJmb3JtYW5jZURhdGEgPSBfLnNvcnRCeU9yZGVyKHZtLnBlcmZvcm1hbmNlRGF0YSwgW2Z1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQudHdlbnR5Zm91cl9ob3Vycy50b3RhbCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQudHdlbnR5Zm91cl9ob3Vycy5lcnJvclRvdGFsIC8gZC50d2VudHlmb3VyX2hvdXJzLnRvdGFsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sICd0d2VudHlmb3VyX2hvdXJzLnRvdGFsJ10sIFsnZGVzYycsICdkZXNjJ10pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5taW5Sb3dzVG9TaG93ID0gdm0ucGVyZm9ybWFuY2VEYXRhLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnZpcnR1YWxpemF0aW9uVGhyZXNob2xkID0gdm0ucGVyZm9ybWFuY2VEYXRhLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSB2bS5wZXJmb3JtYW5jZURhdGE7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBpbml0aWFsaXplKCk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uc2VsZWN0ZWRKb2JUeXBlJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJlZEJ5Sm9iVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICB2bS51cGRhdGVKb2JUeXBlKG5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZpbHRlcmVkQnlKb2JUeXBlID0gbmV3VmFsdWUgIT09ICdWSUVXIEFMTCc7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlSm9iVHlwZShuZXdWYWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYnNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCAkdWliTW9kYWwsIHNjYWxlQ29uZmlnLCBzY2FsZVNlcnZpY2UsIHN0YXRlU2VydmljZSwgbmF2U2VydmljZSwgc3VibmF2U2VydmljZSwgdXNlclNlcnZpY2UsIGpvYlNlcnZpY2UsIGpvYlR5cGVTZXJ2aWNlLCBsb2FkU2VydmljZSwgZ3JpZEZhY3RvcnksIHRvYXN0cikge1xuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdqb2JzJyk7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcyxcbiAgICAgICAgICAgIGpvYlR5cGVWaWV3QWxsID0geyBuYW1lOiAnVklFVyBBTEwnLCB0aXRsZTogJ1ZJRVcgQUxMJywgdmVyc2lvbjogJycsIGlkOiAwIH07XG5cbiAgICAgICAgdm0uam9ic1BhcmFtcyA9IHN0YXRlU2VydmljZS5nZXRKb2JzUGFyYW1zKCk7XG5cbiAgICAgICAgdm0uc3RhdGVTZXJ2aWNlID0gc3RhdGVTZXJ2aWNlO1xuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0ucmVhZG9ubHkgPSB0cnVlO1xuICAgICAgICB2bS5qb2JUeXBlVmFsdWVzID0gW2pvYlR5cGVWaWV3QWxsXTtcbiAgICAgICAgdm0uam9iRXhlY3V0aW9uID0gbnVsbDtcbiAgICAgICAgdm0uc2VsZWN0ZWRKb2JUeXBlID0gdm0uam9ic1BhcmFtcy5qb2JfdHlwZV9pZCA/IHZtLmpvYnNQYXJhbXMuam9iX3R5cGVfaWQgOiBqb2JUeXBlVmlld0FsbDtcbiAgICAgICAgdm0uam9iU3RhdHVzVmFsdWVzID0gc2NhbGVDb25maWcuam9iU3RhdHVzO1xuICAgICAgICB2bS5zZWxlY3RlZEpvYlN0YXR1cyA9IHZtLmpvYnNQYXJhbXMuc3RhdHVzIHx8IHZtLmpvYlN0YXR1c1ZhbHVlc1swXTtcbiAgICAgICAgdm0uZXJyb3JDYXRlZ29yeVZhbHVlcyA9IF8ubWFwKHNjYWxlQ29uZmlnLmVycm9yQ2F0ZWdvcmllcywgJ25hbWUnKTtcbiAgICAgICAgdm0uc2VsZWN0ZWRFcnJvckNhdGVnb3J5ID0gdm0uam9ic1BhcmFtcy5lcnJvcl9jYXRlZ29yeSB8fCB2bS5lcnJvckNhdGVnb3J5VmFsdWVzWzBdO1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmpvYnM7XG4gICAgICAgIHZtLmFjdGlvbkNsaWNrZWQgPSBmYWxzZTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnQgPSBtb21lbnQudXRjKHZtLmpvYnNQYXJhbXMuc3RhcnRlZCkudG9EYXRlKCk7XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0YXJ0UG9wdXAgPSB7XG4gICAgICAgICAgICBvcGVuZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHZtLm9wZW5MYXN0TW9kaWZpZWRTdGFydFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnRQb3B1cC5vcGVuZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdG9wID0gbW9tZW50LnV0Yyh2bS5qb2JzUGFyYW1zLmVuZGVkKS50b0RhdGUoKTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RvcFBvcHVwID0ge1xuICAgICAgICAgICAgb3BlbmVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICB2bS5vcGVuTGFzdE1vZGlmaWVkU3RvcFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RvcFBvcHVwLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZtLmRhdGVNb2RlbE9wdGlvbnMgPSB7XG4gICAgICAgICAgICB0aW1lem9uZTogJyswMDAnXG4gICAgICAgIH07XG4gICAgICAgIHZtLmdyaWRPcHRpb25zID0gZ3JpZEZhY3RvcnkuZGVmYXVsdEdyaWRPcHRpb25zKCk7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25DdXJyZW50UGFnZSA9IHZtLmpvYnNQYXJhbXMucGFnZSB8fCAxO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemUgPSB2bS5qb2JzUGFyYW1zLnBhZ2Vfc2l6ZSB8fCB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcblxuICAgICAgICB2YXIgZmlsdGVyZWRCeUpvYlR5cGUgPSB2bS5qb2JzUGFyYW1zLmpvYl90eXBlX2lkID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgZmlsdGVyZWRCeUpvYlN0YXR1cyA9IHZtLmpvYnNQYXJhbXMuc3RhdHVzID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgZmlsdGVyZWRCeUVycm9yQ2F0ZWdvcnkgPSB2bS5qb2JzUGFyYW1zLmVycm9yX2NhdGVnb3J5ID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgZmlsdGVyZWRCeU9yZGVyID0gdm0uam9ic1BhcmFtcy5vcmRlciA/IHRydWUgOiBmYWxzZTtcblxuICAgICAgICB2bS5jb2xEZWZzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnam9iX3R5cGUnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnSm9iIFR5cGUnLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj48c3BhbiBuZy1iaW5kLWh0bWw9XCJyb3cuZW50aXR5LmpvYl90eXBlLmdldEljb24oKVwiPjwvc3Bhbj4ge3sgcm93LmVudGl0eS5qb2JfdHlwZS50aXRsZSB9fSB7eyByb3cuZW50aXR5LmpvYl90eXBlLnZlcnNpb24gfX08L2Rpdj4nLFxuICAgICAgICAgICAgICAgIGZpbHRlckhlYWRlclRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtZmlsdGVyLWNvbnRhaW5lclwiPjxzZWxlY3QgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBuZy1tb2RlbD1cImdyaWQuYXBwU2NvcGUudm0uc2VsZWN0ZWRKb2JUeXBlXCIgbmctb3B0aW9ucz1cImpvYlR5cGUgYXMgKGpvYlR5cGUudGl0bGUgKyBcXCcgXFwnICsgam9iVHlwZS52ZXJzaW9uKSBmb3Igam9iVHlwZSBpbiBncmlkLmFwcFNjb3BlLnZtLmpvYlR5cGVWYWx1ZXNcIj48L3NlbGVjdD48L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnY3JlYXRlZCcsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdDcmVhdGVkIChaKScsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+e3sgcm93LmVudGl0eS5jcmVhdGVkX2Zvcm1hdHRlZCB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdsYXN0X21vZGlmaWVkJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0xhc3QgTW9kaWZpZWQgKFopJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5Lmxhc3RfbW9kaWZpZWRfZm9ybWF0dGVkIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2R1cmF0aW9uJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVuYWJsZVNvcnRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAxMjAsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50cyB0ZXh0LXJpZ2h0XCI+e3sgcm93LmVudGl0eS5nZXREdXJhdGlvbigpIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ3N0YXR1cycsXG4gICAgICAgICAgICAgICAgd2lkdGg6IDE1MCxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+PGRpdiBjbGFzcz1cInB1bGwtcmlnaHRcIj48YnV0dG9uIG5nLXNob3c9XCIoKCFncmlkLmFwcFNjb3BlLnZtLnJlYWRvbmx5KSAmJiAocm93LmVudGl0eS5zdGF0dXMgPT09IFxcJ0ZBSUxFRFxcJyB8fCByb3cuZW50aXR5LnN0YXR1cyA9PT0gXFwnQ0FOQ0VMRURcXCcpKVwiIG5nLWNsaWNrPVwiZ3JpZC5hcHBTY29wZS52bS5yZXF1ZXVlSm9icyh7IGpvYl9pZHM6IFtyb3cuZW50aXR5LmlkXSB9KVwiIGNsYXNzPVwiYnRuIGJ0bi14cyBidG4tZGVmYXVsdFwiIHRpdGxlPVwiUmVxdWV1ZSBKb2JcIj48aSBjbGFzcz1cImZhIGZhLXJlcGVhdFwiPjwvaT48L2J1dHRvbj4gPGJ1dHRvbiBuZy1zaG93PVwiIWdyaWQuYXBwU2NvcGUudm0ucmVhZG9ubHkgJiYgcm93LmVudGl0eS5zdGF0dXMgIT09IFxcJ0NPTVBMRVRFRFxcJyAmJiByb3cuZW50aXR5LnN0YXR1cyAhPT0gXFwnQ0FOQ0VMRURcXCdcIiBuZy1jbGljaz1cImdyaWQuYXBwU2NvcGUudm0uY2FuY2VsSm9iKHJvdy5lbnRpdHkpXCIgY2xhc3M9XCJidG4gYnRuLXhzIGJ0bi1kZWZhdWx0XCIgdGl0bGU9XCJDYW5jZWwgSm9iXCI+PGkgY2xhc3M9XCJmYSBmYS1iYW5cIj48L2k+PC9idXR0b24+PC9kaXY+IHt7IHJvdy5lbnRpdHkuc3RhdHVzIH19PC9kaXY+JyxcbiAgICAgICAgICAgICAgICBmaWx0ZXJIZWFkZXJUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWZpbHRlci1jb250YWluZXJcIj48c2VsZWN0IGNsYXNzPVwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIgbmctbW9kZWw9XCJncmlkLmFwcFNjb3BlLnZtLnNlbGVjdGVkSm9iU3RhdHVzXCI+PG9wdGlvbiBuZy1zZWxlY3RlZD1cInt7IGdyaWQuYXBwU2NvcGUudm0uam9iU3RhdHVzVmFsdWVzWyRpbmRleF0gPT0gZ3JpZC5hcHBTY29wZS52bS5zZWxlY3RlZEpvYlN0YXR1cyB9fVwiIHZhbHVlPVwie3sgZ3JpZC5hcHBTY29wZS52bS5qb2JTdGF0dXNWYWx1ZXNbJGluZGV4XSB9fVwiIG5nLXJlcGVhdD1cInN0YXR1cyBpbiBncmlkLmFwcFNjb3BlLnZtLmpvYlN0YXR1c1ZhbHVlcyB0cmFjayBieSAkaW5kZXhcIj57eyBzdGF0dXMudG9VcHBlckNhc2UoKSB9fTwvb3B0aW9uPjwvc2VsZWN0PjwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdlcnJvci5jYXRlZ29yeScsXG4gICAgICAgICAgICAgICAgd2lkdGg6IDE1MCxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0Vycm9yIENhdGVnb3J5JyxcbiAgICAgICAgICAgICAgICBmaWx0ZXJIZWFkZXJUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWZpbHRlci1jb250YWluZXJcIj48c2VsZWN0IGNsYXNzPVwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIgbmctbW9kZWw9XCJncmlkLmFwcFNjb3BlLnZtLnNlbGVjdGVkRXJyb3JDYXRlZ29yeVwiPjxvcHRpb24gbmctc2VsZWN0ZWQ9XCJ7eyBncmlkLmFwcFNjb3BlLnZtLmVycm9yQ2F0ZWdvcnlWYWx1ZXNbJGluZGV4XSA9PSBncmlkLmFwcFNjb3BlLnZtLnNlbGVjdGVkRXJyb3JDYXRlZ29yeSB9fVwiIHZhbHVlPVwie3sgZ3JpZC5hcHBTY29wZS52bS5lcnJvckNhdGVnb3J5VmFsdWVzWyRpbmRleF0gfX1cIiBuZy1yZXBlYXQ9XCJlcnJvciBpbiBncmlkLmFwcFNjb3BlLnZtLmVycm9yQ2F0ZWdvcnlWYWx1ZXMgdHJhY2sgYnkgJGluZGV4XCI+e3sgZXJyb3IudG9VcHBlckNhc2UoKSB9fTwvb3B0aW9uPjwvc2VsZWN0PjwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdlcnJvci50aXRsZScsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdFcnJvcicsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPjxkaXYgdWliLXRvb2x0aXA9XCJ7eyByb3cuZW50aXR5LmVycm9yLmRlc2NyaXB0aW9uIH19XCIgdG9vbHRpcC1hcHBlbmQtdG8tYm9keT1cInRydWVcIj57eyByb3cuZW50aXR5LmVycm9yLnRpdGxlIH19PC9kaXY+PC9kaXY+JyxcbiAgICAgICAgICAgICAgICB3aWR0aDogMjAwLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdpZCcsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdMb2cnLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgc29ydGFibGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHdpZHRoOiA2MCxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzIHRleHQtY2VudGVyXCI+PGJ1dHRvbiBuZy1jbGljaz1cImdyaWQuYXBwU2NvcGUudm0uc2hvd0xvZyhyb3cuZW50aXR5LmlkKVwiIGNsYXNzPVwiYnRuIGJ0bi14cyBidG4tZGVmYXVsdFwiPjxpIGNsYXNzPVwiZmEgZmEtZmlsZS10ZXh0XCI+PC9pPjwvYnV0dG9uPjwvZGl2PidcbiAgICAgICAgICAgIH1cbiAgICAgICAgXTtcblxuICAgICAgICB2bS5nZXRKb2JzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgam9iU2VydmljZS5nZXRKb2JzT25jZSh2bS5qb2JzUGFyYW1zKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudG90YWxJdGVtcyA9IGRhdGEuY291bnQ7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMubWluUm93c1RvU2hvdyA9IGRhdGEucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudmlydHVhbGl6YXRpb25UaHJlc2hvbGQgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5nZXRKb2JUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpvYlR5cGVTZXJ2aWNlLmdldEpvYlR5cGVzT25jZSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JUeXBlVmFsdWVzLnB1c2goZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICB2bS5qb2JUeXBlVmFsdWVzID0gXy5mbGF0dGVuKHZtLmpvYlR5cGVWYWx1ZXMpO1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkSm9iVHlwZSA9IF8uZmluZCh2bS5qb2JUeXBlVmFsdWVzLCB7IGlkOiB2bS5qb2JzUGFyYW1zLmpvYl90eXBlX2lkIH0pIHx8IGpvYlR5cGVWaWV3QWxsO1xuICAgICAgICAgICAgICAgIHZtLmdldEpvYnMoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5zaG93TG9nID0gZnVuY3Rpb24gKGpvYklkKSB7XG4gICAgICAgICAgICAvLyBzaG93IGxvZyBtb2RhbFxuICAgICAgICAgICAgdm0uYWN0aW9uQ2xpY2tlZCA9IHRydWU7XG4gICAgICAgICAgICBqb2JTZXJ2aWNlLmdldEpvYkRldGFpbChqb2JJZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmpvYkV4ZWN1dGlvbiA9IGRhdGEuZ2V0TGF0ZXN0RXhlY3V0aW9uKCk7XG4gICAgICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc2hvd0xvZy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogJ2xnJyxcbiAgICAgICAgICAgICAgICAgICAgd2luZG93Q2xhc3M6ICdsb2ctbW9kYWwtd2luZG93J1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ucmVxdWV1ZUpvYnMgPSBmdW5jdGlvbiAoam9ic1BhcmFtcykge1xuICAgICAgICAgICAgaWYgKCFqb2JzUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgam9ic1BhcmFtcyA9IHZtLmpvYnNQYXJhbXMgPyB2bS5qb2JzUGFyYW1zIDogeyBzdGFydGVkOiB2bS5sYXN0TW9kaWZpZWRTdGFydC50b0lTT1N0cmluZygpLCBlbmRlZDogdm0ubGFzdE1vZGlmaWVkU3RvcC50b0lTT1N0cmluZygpIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5hY3Rpb25DbGlja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgbG9hZFNlcnZpY2UucmVxdWV1ZUpvYnMoam9ic1BhcmFtcykudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdG9hc3RyWydzdWNjZXNzJ10oJ1JlcXVldWUgU3VjY2Vzc2Z1bCcpO1xuICAgICAgICAgICAgICAgIHZtLmdldEpvYnMoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXSgnUmVxdWV1ZSByZXF1ZXN0IGZhaWxlZCcpO1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmNhbmNlbEpvYiA9IGZ1bmN0aW9uIChqb2IpIHtcbiAgICAgICAgICAgIHZtLmFjdGlvbkNsaWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICB2YXIgb3JpZ2luYWxTdGF0dXMgPSBqb2Iuc3RhdHVzO1xuICAgICAgICAgICAgam9iLnN0YXR1cyA9ICdDQU5DRUwnO1xuICAgICAgICAgICAgam9iU2VydmljZS51cGRhdGVKb2Ioam9iLmlkLCB7IHN0YXR1czogJ0NBTkNFTEVEJyB9KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0b2FzdHJbJ3N1Y2Nlc3MnXSgnSm9iIENhbmNlbGVkJyk7XG4gICAgICAgICAgICAgICAgam9iLnN0YXR1cyA9ICdDQU5DRUxFRCc7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IpO1xuICAgICAgICAgICAgICAgIGpvYi5zdGF0dXMgPSBvcmlnaW5hbFN0YXR1cztcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgdm0uZmlsdGVyUmVzdWx0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRKb2JzUGFyYW1zKHZtLmpvYnNQYXJhbXMpO1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICB2bS5nZXRKb2JzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlQ29sRGVmcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmNvbHVtbkRlZnMgPSBncmlkRmFjdG9yeS5hcHBseVNvcnRDb25maWcodm0uY29sRGVmcywgdm0uam9ic1BhcmFtcyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlSm9iT3JkZXIgPSBmdW5jdGlvbiAoc29ydEFycikge1xuICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5vcmRlciA9IHNvcnRBcnIubGVuZ3RoID4gMCA/IHNvcnRBcnIgOiBudWxsO1xuICAgICAgICAgICAgZmlsdGVyZWRCeU9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwO1xuICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUpvYlR5cGUgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZS5pZCAhPT0gdm0uam9ic1BhcmFtcy5qb2JfdHlwZV9pZCkge1xuICAgICAgICAgICAgICAgIHZtLmpvYnNQYXJhbXMucGFnZSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5qb2JzUGFyYW1zLmpvYl90eXBlX2lkID0gdmFsdWUuaWQgPT09IDAgPyBudWxsIDogdmFsdWUuaWQ7XG4gICAgICAgICAgICB2bS5qb2JzUGFyYW1zLnBhZ2Vfc2l6ZSA9IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVKb2JTdGF0dXMgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPSB2bS5qb2JzUGFyYW1zLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIHZtLmpvYnNQYXJhbXMucGFnZSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5qb2JzUGFyYW1zLnN0YXR1cyA9IHZhbHVlID09PSAnVklFVyBBTEwnID8gbnVsbCA6IHZhbHVlO1xuICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5wYWdlX3NpemUgPSB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlRXJyb3JDYXRlZ29yeSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlICE9IHZtLmpvYnNQYXJhbXMuZXJyb3JfY2F0ZWdvcnkpIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JzUGFyYW1zLnBhZ2UgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5lcnJvcl9jYXRlZ29yeSA9IHZhbHVlID09PSAnVklFVyBBTEwnID8gbnVsbCA6IHZhbHVlO1xuICAgICAgICAgICAgdm0uam9ic1BhcmFtcy5wYWdlX3NpemUgPSB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMub25SZWdpc3RlckFwaSA9IGZ1bmN0aW9uIChncmlkQXBpKSB7XG4gICAgICAgICAgICAvL3NldCBncmlkQXBpIG9uIHNjb3BlXG4gICAgICAgICAgICB2bS5ncmlkQXBpID0gZ3JpZEFwaTtcbiAgICAgICAgICAgIHZtLmdyaWRBcGkuc2VsZWN0aW9uLm9uLnJvd1NlbGVjdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgICAgaWYgKHZtLmFjdGlvbkNsaWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uYWN0aW9uQ2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvam9icy9qb2IvJyArIHJvdy5lbnRpdHkuaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5wYWdpbmF0aW9uLm9uLnBhZ2luYXRpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIHZtLmpvYnNQYXJhbXMucGFnZSA9IGN1cnJlbnRQYWdlO1xuICAgICAgICAgICAgICAgIHZtLmpvYnNQYXJhbXMucGFnZV9zaXplID0gcGFnZVNpemU7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLmNvcmUub24uc29ydENoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoZ3JpZCwgc29ydENvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godm0uZ3JpZEFwaS5ncmlkLmNvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sLmNvbERlZi5zb3J0ID0gY29sLnNvcnQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEpvYnNDb2xEZWZzKHZtLmdyaWRBcGkuZ3JpZC5vcHRpb25zLmNvbHVtbkRlZnMpO1xuICAgICAgICAgICAgICAgIHZhciBzb3J0QXJyID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHNvcnRDb2x1bW5zLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvcnRBcnIucHVzaChjb2wuc29ydC5kaXJlY3Rpb24gPT09ICdkZXNjJyA/ICctJyArIGNvbC5maWVsZCA6IGNvbC5maWVsZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlSm9iT3JkZXIoc29ydEFycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEpvYnNQYXJhbXModm0uam9ic1BhcmFtcyk7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgICAgICB2YXIgdXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJDcmVkcygpO1xuICAgICAgICAgICAgdm0ucmVhZG9ubHkgPSAhKHVzZXIgJiYgdXNlci5pc19hZG1pbik7XG4gICAgICAgICAgICB2bS5nZXRKb2JUeXBlcygpO1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignam9icycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluaXRpYWxpemUoKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5zZWxlY3RlZEpvYlR5cGUnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChwYXJzZUludCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IF8uZmluZCh2bS5qb2JUeXBlVmFsdWVzLCB7aWQ6IHBhcnNlSW50KHZhbHVlKX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkQnlKb2JUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS51cGRhdGVKb2JUeXBlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkQnlKb2JUeXBlID0gIWFuZ3VsYXIuZXF1YWxzKHZhbHVlLCBqb2JUeXBlVmlld0FsbCk7XG4gICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUpvYlR5cGUodmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uc2VsZWN0ZWRKb2JTdGF0dXMnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkQnlKb2JTdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRlSm9iU3RhdHVzKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZpbHRlcmVkQnlKb2JTdGF0dXMgPSB2YWx1ZSAhPT0gJ1ZJRVcgQUxMJztcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVKb2JTdGF0dXModmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5zZWxlY3RlZEVycm9yQ2F0ZWdvcnknLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2bS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkQnlFcnJvckNhdGVnb3J5KSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZUVycm9yQ2F0ZWdvcnkodmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWRCeUVycm9yQ2F0ZWdvcnkgPSB2YWx1ZSAhPT0gJ1ZJRVcgQUxMJztcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVFcnJvckNhdGVnb3J5KHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0ubGFzdE1vZGlmaWVkU3RhcnQnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmpvYnNQYXJhbXMuc3RhcnRlZCA9IHZhbHVlLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5sYXN0TW9kaWZpZWRTdG9wJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5qb2JzUGFyYW1zLmVuZGVkID0gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0Sm9ic0NvbERlZnMoKScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uY29sRGVmcyA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgdm0udXBkYXRlQ29sRGVmcygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigndm0uc3RhdGVTZXJ2aWNlLmdldEpvYnNQYXJhbXMoKScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uam9ic1BhcmFtcyA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgdm0udXBkYXRlQ29sRGVmcygpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignam9iRXhlY3V0aW9uTG9nQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgJGVsZW1lbnQsICR0aW1lb3V0LCBqb2JFeGVjdXRpb25TZXJ2aWNlLCBzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5mb3JjZVNjcm9sbCA9IHRydWU7XG4gICAgICAgICAgICB2bS5qb2JMb2dFcnJvciA9IG51bGw7XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ2V4ZWN1dGlvbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmV4ZWN1dGlvbikge1xuICAgICAgICAgICAgICAgICAgICBqb2JFeGVjdXRpb25TZXJ2aWNlLmdldExvZygkc2NvcGUuZXhlY3V0aW9uLmlkKS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGdldCBkaWZmZXJlbmNlIG9mIG1heCBzY3JvbGwgbGVuZ3RoIGFuZCBjdXJyZW50IHNjcm9sbCBsZW5ndGguXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbG9nUmVzdWx0ID0gcmVzdWx0LmV4ZWN1dGlvbl9sb2c7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkaXYgPSAkKCRlbGVtZW50WzBdKS5maW5kKCcuYmFzaCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNjcm9sbERpZmYgPSAoZGl2LnNjcm9sbFRvcCgpICsgZGl2LnByb3AoJ29mZnNldEhlaWdodCcpKSAtIGRpdi5wcm9wKCdzY3JvbGxIZWlnaHQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0uc2Nyb2xsRGlmZiA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmZvcmNlU2Nyb2xsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uZXhlY0xvZyA9IGxvZ1Jlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXNUZXh0ICYmIHJlc3VsdC5zdGF0dXNUZXh0ICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5qb2JMb2dFcnJvclN0YXR1cyA9IHJlc3VsdC5zdGF0dXNUZXh0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuam9iTG9nRXJyb3IgPSAnVW5hYmxlIHRvIHJldHJpZXZlIGpvYiBsb2dzLic7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uZXhlY0xvZycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0uZXhlY0xvZykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodm0uZm9yY2VTY3JvbGwgfHwgdm0uc2Nyb2xsRGlmZiA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uZm9yY2VTY3JvbGwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2NybEhlaWdodCA9ICQoJGVsZW1lbnRbMF0pLmZpbmQoJy5iYXNoJykucHJvcCgnc2Nyb2xsSGVpZ2h0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgkZWxlbWVudFswXSkuZmluZCgnLmJhc2gnKS5zY3JvbGxUb3Aoc2NybEhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCA1MCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5zY3JvbGxpdGVtID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGl0ZW0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnN0ZG91dENoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3Rkb3V0IGNoYW5nZWQuJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgfSkuZGlyZWN0aXZlKCdqb2JFeGVjdXRpb25Mb2cnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnam9iRXhlY3V0aW9uTG9nQ29udHJvbGxlcicsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvam9icy9kaXJlY3RpdmVzL2pvYkV4ZWN1dGlvbkxvZ1RlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgZXhlY3V0aW9uOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc0pvYkhlYWx0aENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHNjb3BlLCBqb2JUeXBlU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0ubG9hZGluZ0pvYkhlYWx0aCA9IHRydWU7XG4gICAgICAgIHZtLmpvYkhlYWx0aEVycm9yID0gbnVsbDtcbiAgICAgICAgdm0uam9iSGVhbHRoRXJyb3JTdGF0dXMgPSBudWxsO1xuICAgICAgICB2bS5qb2JIZWFsdGggPSB7fTtcblxuICAgICAgICB2YXIgZ2V0Sm9iVHlwZVN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpvYlR5cGVTZXJ2aWNlLmdldEpvYlR5cGVTdGF0dXMoe1xuICAgICAgICAgICAgICAgIHBhZ2U6IG51bGwsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiAxMDAwLFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6ICRzY29wZS5kdXJhdGlvbixcbiAgICAgICAgICAgICAgICBlbmRlZDogbnVsbFxuICAgICAgICAgICAgfSkudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5qb2JIZWFsdGhFcnJvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHZtLmpvYlR5cGVTdGF0dXMgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgICAgIHZtLnRvdGFsID0gMDtcbiAgICAgICAgICAgICAgICAgICAgdm0uZmFpbGVkID0gMDtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcGVyZm9ybWFuY2UgPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmVzID0gW107XG5cbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGRhdGEucmVzdWx0cywgZnVuY3Rpb24gKHN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGVyZm9ybWFuY2UgPSBzdGF0dXMuZ2V0UGVyZm9ybWFuY2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnRvdGFsID0gdm0udG90YWwgKyBwZXJmb3JtYW5jZS50b3RhbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmZhaWxlZCA9IHZtLmZhaWxlZCArIHBlcmZvcm1hbmNlLmZhaWxlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmVzLnB1c2goc3RhdHVzLmdldEZhaWx1cmVzKCkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZURhdGEgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN5c3RlbUZhaWx1cmVzID0gMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFGYWlsdXJlcyA9IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGdvcml0aG1GYWlsdXJlcyA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGZhaWx1cmVzLCBmdW5jdGlvbiAoZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGYsIGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUuc3RhdHVzID09PSAnU1lTVEVNJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeXN0ZW1GYWlsdXJlcyA9IHN5c3RlbUZhaWx1cmVzICsgdHlwZS5jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUuc3RhdHVzID09PSAnREFUQScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YUZhaWx1cmVzID0gZGF0YUZhaWx1cmVzICsgdHlwZS5jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUuc3RhdHVzID09PSAnQUxHT1JJVEhNJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGdvcml0aG1GYWlsdXJlcyA9IGFsZ29yaXRobUZhaWx1cmVzICsgdHlwZS5jb3VudDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHN5c3RlbUZhaWx1cmVzID4gMCB8fCBkYXRhRmFpbHVyZXMgPiAwIHx8IGFsZ29yaXRobUZhaWx1cmVzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN5c3RlbUZhaWx1cmVzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmVEYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdTWVNURU0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogc3lzdGVtRmFpbHVyZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbGdvcml0aG1GYWlsdXJlcyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsdXJlRGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnQUxHT1JJVEhNJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IGFsZ29yaXRobUZhaWx1cmVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YUZhaWx1cmVzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmVEYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdEQVRBJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IGRhdGFGYWlsdXJlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdm0uam9iSGVhbHRoID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2F1Z2VEYXRhOiB2bS50b3RhbCA9PT0gMCA/IDAgOiAxMDAgLSAoKHZtLmZhaWxlZCAvIHZtLnRvdGFsKSAqIDEwMCkudG9GaXhlZCgyKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbnV0RGF0YTogZmFpbHVyZURhdGFcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmJyb2FkY2FzdERhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnam9iVHlwZVN0YXR1cycsIHZtLmpvYlR5cGVTdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzVGV4dCAmJiBkYXRhLnN0YXR1c1RleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5qb2JIZWFsdGhFcnJvclN0YXR1cyA9IGRhdGEuc3RhdHVzVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2bS5qb2JIZWFsdGhFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgam9iIHN0YXRpc3RpY3MuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ0pvYkhlYWx0aCA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgZ2V0Sm9iVHlwZVN0YXR1cygpO1xuICAgIH0pLmRpcmVjdGl2ZSgnYWlzSm9iSGVhbHRoJywgZnVuY3Rpb24oKXtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVzYWdlOiA8YWlzLWpvYi1oZWFsdGggLz5cbiAgICAgICAgICoqL1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fpc0pvYkhlYWx0aENvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2pvYnMvZGlyZWN0aXZlcy9qb2JIZWFsdGhUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAnPScsXG4gICAgICAgICAgICAgICAgYnJvYWRjYXN0RGF0YTogJz0nLCAvLyBzZXQgdG8gdHJ1ZSB3aGVuIHVzaW5nIGFub3RoZXIgd2lkZ2V0IGluIHRoZSBzYW1lIHZpZXcgdGhhdCBhbHNvIGNhbGxzIGdldEpvYlR5cGVTdGF0dXNcbiAgICAgICAgICAgICAgICBzaG93RGVzY3JpcHRpb246ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYlR5cGVJbnRlcmZhY2VEaXJlY3RpdmVDb250cm9sbGVyJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzY29wZSwgam9iVHlwZVNlcnZpY2UpIHtcblxuICAgIH0pLmRpcmVjdGl2ZSgnYWlzSm9iVHlwZUludGVyZmFjZScsIGZ1bmN0aW9uKCl7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2FnZTogPGFpcy1qb2ItaGVhbHRoIC8+XG4gICAgICAgICAqKi9cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdqb2JUeXBlSW50ZXJmYWNlRGlyZWN0aXZlQ29udHJvbGxlcicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvam9icy9kaXJlY3RpdmVzL2pvYlR5cGVJbnRlcmZhY2VUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGpvYlR5cGVJbnRlcmZhY2U6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2JUeXBlLCBzY2FsZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIEpvYiA9IGZ1bmN0aW9uIChpZCwgam9iX3R5cGUsIGpvYl90eXBlX3JldiwgZXZlbnQsIGVycm9yLCBzdGF0dXMsIHByaW9yaXR5LCBudW1fZXhlcywgdGltZW91dCwgbWF4X3RyaWVzLCBjcHVzX3JlcXVpcmVkLCBtZW1fcmVxdWlyZWQsIGRpc2tfaW5fcmVxdWlyZWQsIGRpc2tfb3V0X3JlcXVpcmVkLCBjcmVhdGVkLCBxdWV1ZWQsIHN0YXJ0ZWQsIGVuZGVkLCBsYXN0X3N0YXR1c19jaGFuZ2UsIGxhc3RfbW9kaWZpZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGUgPSBKb2JUeXBlLnRyYW5zZm9ybWVyKGpvYl90eXBlKTtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGVfcmV2ID0gam9iX3R5cGVfcmV2O1xuICAgICAgICAgICAgdGhpcy5ldmVudCA9IGV2ZW50O1xuICAgICAgICAgICAgdGhpcy5lcnJvciA9IGVycm9yO1xuICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgICAgICAgICB0aGlzLnByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgICAgICB0aGlzLm51bV9leGVzID0gbnVtX2V4ZXM7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXQgPSB0aW1lb3V0O1xuICAgICAgICAgICAgdGhpcy5tYXhfdHJpZXMgPSBtYXhfdHJpZXM7XG4gICAgICAgICAgICB0aGlzLmNwdXNfcmVxdWlyZWQgPSBjcHVzX3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5tZW1fcmVxdWlyZWQgPSBtZW1fcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmRpc2tfaW5fcmVxdWlyZWQgPSBkaXNrX2luX3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX291dF9yZXF1aXJlZCA9IGRpc2tfb3V0X3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKGNyZWF0ZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Y19ub2xhYmVsKTtcbiAgICAgICAgICAgIHRoaXMucXVldWVkID0gcXVldWVkO1xuICAgICAgICAgICAgdGhpcy5zdGFydGVkID0gc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMuZW5kZWQgPSBlbmRlZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9zdGF0dXNfY2hhbmdlID0gbGFzdF9zdGF0dXNfY2hhbmdlO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKGxhc3RfbW9kaWZpZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Y19ub2xhYmVsKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2IucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgZ2V0RHVyYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGVuZCA9IHRoaXMuZW5kZWQgPyB0aGlzLmVuZGVkIDogbW9tZW50LnV0YygpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbihzdGFydCwgZW5kKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2IoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGVfcmV2LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmV2ZW50LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmVycm9yLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wcmlvcml0eSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5udW1fZXhlcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1heF90cmllcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcHVzX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lbV9yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrX2luX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfb3V0X3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucXVldWVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9zdGF0dXNfY2hhbmdlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2IoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2IudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYi5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iRGV0YWlsRXZlbnQnLCBmdW5jdGlvbiAoSm9iRGV0YWlsRXZlbnRSdWxlKSB7XG4gICAgICAgIHZhciBKb2JEZXRhaWxFdmVudCA9IGZ1bmN0aW9uIChpZCwgdHlwZSwgcnVsZSwgb2NjdXJyZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgICAgICB0aGlzLnJ1bGUgPSBKb2JEZXRhaWxFdmVudFJ1bGUudHJhbnNmb3JtZXIocnVsZSk7XG4gICAgICAgICAgICB0aGlzLm9jY3VycmVkID0gb2NjdXJyZWQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iRGV0YWlsRXZlbnQucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYkRldGFpbEV2ZW50LmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JEZXRhaWxFdmVudChcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJ1bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEub2NjdXJyZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JEZXRhaWxFdmVudCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYkRldGFpbEV2ZW50LnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYkRldGFpbEV2ZW50LmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYkRldGFpbEV2ZW50LmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JEZXRhaWxFdmVudDtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYkRldGFpbEV2ZW50UnVsZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIEpvYkRldGFpbEV2ZW50UnVsZSA9IGZ1bmN0aW9uIChpZCwgdHlwZSwgaXNfYWN0aXZlLCBjcmVhdGVkLCBhcmNoaXZlZCwgbGFzdF9tb2RpZmllZCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgICAgIHRoaXMuaXNfYWN0aXZlID0gaXNfYWN0aXZlO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuYXJjaGl2ZWQgPSBhcmNoaXZlZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iRGV0YWlsRXZlbnRSdWxlLnByb3RvdHlwZSA9IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JEZXRhaWxFdmVudFJ1bGUuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYkRldGFpbEV2ZW50UnVsZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmFyY2hpdmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JEZXRhaWxFdmVudFJ1bGUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2JEZXRhaWxFdmVudFJ1bGUudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iRGV0YWlsRXZlbnRSdWxlLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYkRldGFpbEV2ZW50UnVsZS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iRGV0YWlsRXZlbnRSdWxlO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iRGV0YWlsSW5wdXREYXRhJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgSm9iRGV0YWlsSW5wdXREYXRhID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlLCBmaWxlX2lkLCBmaWxlX2lkcywgZmlsZXMpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLmZpbGVfaWQgPSBmaWxlX2lkO1xuICAgICAgICAgICAgdGhpcy5maWxlX2lkcyA9IGZpbGVfaWRzO1xuICAgICAgICAgICAgdGhpcy5maWxlcyA9IGZpbGVzO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYkRldGFpbElucHV0RGF0YS5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5maWxlX2lkKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxlX2lkO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZpbGVfaWRzKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxlX2lkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iRGV0YWlsSW5wdXREYXRhLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JEZXRhaWxJbnB1dERhdGEoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5maWxlX2lkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZpbGVfaWRzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZpbGVzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRGV0YWlsSW5wdXREYXRhKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iRGV0YWlsSW5wdXREYXRhLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYkRldGFpbElucHV0RGF0YS5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JEZXRhaWxJbnB1dERhdGEuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYkRldGFpbElucHV0RGF0YTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYkRldGFpbE91dHB1dERhdGEnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBKb2JEZXRhaWxPdXRwdXREYXRhID0gZnVuY3Rpb24gKG5hbWUsIHdvcmtzcGFjZV9pZCwgZmlsZXMpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICB0aGlzLndvcmtzcGFjZV9pZCA9IHdvcmtzcGFjZV9pZDtcbiAgICAgICAgICAgIHRoaXMuZmlsZXMgPSBmaWxlcztcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JEZXRhaWxPdXRwdXREYXRhLnByb3RvdHlwZSA9IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JEZXRhaWxPdXRwdXREYXRhLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JEZXRhaWxPdXRwdXREYXRhKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEud29ya3NwYWNlX2lkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZpbGVzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRGV0YWlsT3V0cHV0RGF0YSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYkRldGFpbE91dHB1dERhdGEudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iRGV0YWlsT3V0cHV0RGF0YS5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JEZXRhaWxPdXRwdXREYXRhLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JEZXRhaWxPdXRwdXREYXRhO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iRGV0YWlscycsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgSm9iVHlwZSwgSm9iRXhlY3V0aW9uLCBQcm9kdWN0LCBKb2JEZXRhaWxJbnB1dERhdGEsIEpvYkRldGFpbE91dHB1dERhdGEsIFJlY2lwZSwgSm9iRGV0YWlsRXZlbnQsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgSm9iRGV0YWlscyA9IGZ1bmN0aW9uIChpZCwgam9iX3R5cGUsIGpvYl90eXBlX3JldiwgZXZlbnQsIGVycm9yLCBzdGF0dXMsIHByaW9yaXR5LCBudW1fZXhlcywgdGltZW91dCwgbWF4X3RyaWVzLCBjcHVzX3JlcXVpcmVkLCBtZW1fcmVxdWlyZWQsIGRpc2tfaW5fcmVxdWlyZWQsIGRpc2tfb3V0X3JlcXVpcmVkLCBjcmVhdGVkLCBxdWV1ZWQsIHN0YXJ0ZWQsIGVuZGVkLCBsYXN0X3N0YXR1c19jaGFuZ2UsIGxhc3RfbW9kaWZpZWQsIGRhdGEsIHJlc3VsdHMsIHJlY2lwZXMsIGpvYl9leGVzLCBpbnB1dHMsIG91dHB1dHMpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGUgPSBKb2JUeXBlLnRyYW5zZm9ybWVyKGpvYl90eXBlKTtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGVfcmV2ID0gam9iX3R5cGVfcmV2O1xuICAgICAgICAgICAgdGhpcy5ldmVudCA9IEpvYkRldGFpbEV2ZW50LnRyYW5zZm9ybWVyKGV2ZW50KTtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IgPSBlcnJvcjtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5wcmlvcml0eSA9IHByaW9yaXR5O1xuICAgICAgICAgICAgdGhpcy5udW1fZXhlcyA9IG51bV9leGVzO1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDtcbiAgICAgICAgICAgIHRoaXMubWF4X3RyaWVzID0gbWF4X3RyaWVzO1xuICAgICAgICAgICAgdGhpcy5jcHVzX3JlcXVpcmVkID0gY3B1c19yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMubWVtX3JlcXVpcmVkID0gbWVtX3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX2luX3JlcXVpcmVkID0gZGlza19pbl9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMuZGlza19vdXRfcmVxdWlyZWQgPSBkaXNrX291dF9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhjcmVhdGVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGMpO1xuICAgICAgICAgICAgdGhpcy5xdWV1ZWQgPSBxdWV1ZWQ7XG4gICAgICAgICAgICB0aGlzLnF1ZXVlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKHF1ZXVlZCkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheV9zZWNvbmRfdXRjKTtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRlZCA9IHN0YXJ0ZWQ7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0ZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhzdGFydGVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGMpO1xuICAgICAgICAgICAgdGhpcy5lbmRlZCA9IGVuZGVkO1xuICAgICAgICAgICAgdGhpcy5lbmRlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKGVuZGVkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5X3NlY29uZF91dGMpO1xuICAgICAgICAgICAgdGhpcy5sYXN0X3N0YXR1c19jaGFuZ2UgPSBsYXN0X3N0YXR1c19jaGFuZ2U7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5kYXRhID0ge1xuICAgICAgICAgICAgICAgIGlucHV0X2RhdGE6IEpvYkRldGFpbElucHV0RGF0YS50cmFuc2Zvcm1lcihkYXRhLmlucHV0X2RhdGEpLFxuICAgICAgICAgICAgICAgIHZlcnNpb246IGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICBvdXRwdXRfZGF0YTogSm9iRGV0YWlsT3V0cHV0RGF0YS50cmFuc2Zvcm1lcihkYXRhLm91dHB1dF9kYXRhKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMucmVzdWx0cyA9IHtcbiAgICAgICAgICAgICAgICBvdXRwdXRfZGF0YTogSm9iRGV0YWlsT3V0cHV0RGF0YS50cmFuc2Zvcm1lcihyZXN1bHRzLm91dHB1dF9kYXRhKSxcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiByZXN1bHRzLnZlcnNpb25cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLnJlY2lwZXMgPSBSZWNpcGUudHJhbnNmb3JtZXIocmVjaXBlcyk7XG4gICAgICAgICAgICB0aGlzLmpvYl9leGVzID0gSm9iRXhlY3V0aW9uLnRyYW5zZm9ybWVyKGpvYl9leGVzKTtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRzID0gaW5wdXRzO1xuICAgICAgICAgICAgdGhpcy5vdXRwdXRzID0gb3V0cHV0cztcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JEZXRhaWxzLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbih0aGlzLmNyZWF0ZWQsIHRoaXMubGFzdF9tb2RpZmllZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0TGF0ZXN0RXhlY3V0aW9uOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm51bV9leGVzID4gMCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuam9iX2V4ZXNbMF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFN0YXR1c0NsYXNzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIC8vIGlmKHRoaXMuc3RhdHVzID09PSAnQ09NUExFVEVEJyl7XG4gICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiAnbGFiZWwtc3VjY2Vzcyc7XG4gICAgICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgICAgIC8vIGVsc2UgaWYoIHRoaXMuc3RhdHVzID09PSAnRkFJTEVEJyl7XG4gICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiAnbGFiZWwtZGVmYXVsdCc7Ly8gICAgcmV0dXJuICdsYWJlbC1kYW5nZXInO1xuICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgICAgICAvLyBlbHNle1xuICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gJ2xhYmVsLWRlZmF1bHQnO1xuICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0dXMudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iRGV0YWlscy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRGV0YWlscyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZV9yZXYsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXJyb3IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm51bV9leGVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWF4X3RyaWVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNwdXNfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVtX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfaW5fcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGlza19vdXRfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5xdWV1ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lbmRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X3N0YXR1c19jaGFuZ2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kYXRhLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVjaXBlcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfZXhlcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pbnB1dHMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEub3V0cHV0c1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYkRldGFpbHMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2JEZXRhaWxzLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYkRldGFpbHMuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iRGV0YWlscy5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iRGV0YWlscztcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYkV4ZWN1dGlvbicsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgSm9iLCBOb2RlLCBtb21lbnQpIHtcbiAgICAgICAgdmFyIEpvYkV4ZWN1dGlvbiA9IGZ1bmN0aW9uIChpZCwgc3RhdHVzLCBjb21tYW5kX2FyZ3VtZW50cywgdGltZW91dCwgcHJlX3N0YXJ0ZWQsIHByZV9jb21wbGV0ZWQsIHByZV9leGl0X2NvZGUsIGpvYl9zdGFydGVkLCBqb2JfY29tcGxldGVkLCBqb2JfZXhpdF9jb2RlLCBwb3N0X3N0YXJ0ZWQsIHBvc3RfY29tcGxldGVkLCBwb3N0X2V4aXRfY29kZSwgY3JlYXRlZCwgcXVldWVkLCBzdGFydGVkLCBlbmRlZCwgbGFzdF9tb2RpZmllZCwgam9iLCBub2RlLCBlcnJvciwgZW52aXJvbm1lbnQsIGNwdXNfc2NoZWR1bGVkLCBtZW1fc2NoZWR1bGVkLCBkaXNrX2luX3NjaGVkdWxlZCwgZGlza19vdXRfc2NoZWR1bGVkLCBkaXNrX3RvdGFsX3NjaGVkdWxlZCwgcmVzdWx0cywgY3VycmVudF9zdGRvdXRfdXJsLCBjdXJyZW50X3N0ZGVycl91cmwsIHJlc3VsdHNfbWFuaWZlc3QpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5jb21tYW5kX2FyZ3VtZW50cyA9IGNvbW1hbmRfYXJndW1lbnRzO1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDtcbiAgICAgICAgICAgIHRoaXMucHJlX3N0YXJ0ZWQgPSBwcmVfc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMucHJlX2NvbXBsZXRlZCA9IHByZV9jb21wbGV0ZWQ7XG4gICAgICAgICAgICB0aGlzLnByZV9leGl0X2NvZGUgPSBwcmVfZXhpdF9jb2RlO1xuICAgICAgICAgICAgdGhpcy5qb2Jfc3RhcnRlZCA9IGpvYl9zdGFydGVkO1xuICAgICAgICAgICAgdGhpcy5qb2JfY29tcGxldGVkID0gam9iX2NvbXBsZXRlZDtcbiAgICAgICAgICAgIHRoaXMuam9iX2V4aXRfY29kZSA9IGpvYl9leGl0X2NvZGU7XG4gICAgICAgICAgICB0aGlzLnBvc3Rfc3RhcnRlZCA9IHBvc3Rfc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMucG9zdF9jb21wbGV0ZWQgPSBwb3N0X2NvbXBsZXRlZDtcbiAgICAgICAgICAgIHRoaXMucG9zdF9leGl0X2NvZGUgPSBwb3N0X2V4aXRfY29kZTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWRfZm9ybWF0dGVkID0gY3JlYXRlZCA/IG1vbWVudC51dGMoY3JlYXRlZCkudG9JU09TdHJpbmcoKSA6IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLnF1ZXVlZCA9IHF1ZXVlZDtcbiAgICAgICAgICAgIHRoaXMucXVldWVkX2Zvcm1hdHRlZCA9IHF1ZXVlZCA/IG1vbWVudC51dGMocXVldWVkKS50b0lTT1N0cmluZygpIDogcXVldWVkO1xuICAgICAgICAgICAgdGhpcy5zdGFydGVkID0gc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRlZF9mb3JtYXR0ZWQgPSBzdGFydGVkID8gbW9tZW50LnV0YyhzdGFydGVkKS50b0lTT1N0cmluZygpIDogc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMuZW5kZWQgPSBlbmRlZDtcbiAgICAgICAgICAgIHRoaXMuZW5kZWRfZm9ybWF0dGVkID0gZW5kZWQgPyBtb21lbnQudXRjKGVuZGVkKS50b0lTT1N0cmluZygpIDogZW5kZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkX2Zvcm1hdHRlZCA9IGxhc3RfbW9kaWZpZWQgPyBtb21lbnQudXRjKGxhc3RfbW9kaWZpZWQpLnRvSVNPU3RyaW5nKCkgOiBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5qb2IgPSBKb2IudHJhbnNmb3JtZXIoam9iKTtcbiAgICAgICAgICAgIHRoaXMubm9kZSA9IE5vZGUudHJhbnNmb3JtZXIobm9kZSk7XG4gICAgICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG4gICAgICAgICAgICB0aGlzLmVudmlyb25tZW50ID0gZW52aXJvbm1lbnQ7XG4gICAgICAgICAgICB0aGlzLmNwdXNfc2NoZWR1bGVkID0gY3B1c19zY2hlZHVsZWQ7XG4gICAgICAgICAgICB0aGlzLm1lbV9zY2hlZHVsZWQgPSBtZW1fc2NoZWR1bGVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX2luX3NjaGVkdWxlZCA9IGRpc2tfaW5fc2NoZWR1bGVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX291dF9zY2hlZHVsZWQgPSBkaXNrX291dF9zY2hlZHVsZWQ7XG4gICAgICAgICAgICB0aGlzLmRpc2tfdG90YWxfc2NoZWR1bGVkID0gZGlza190b3RhbF9zY2hlZHVsZWQ7XG4gICAgICAgICAgICB0aGlzLnJlc3VsdHMgPSByZXN1bHRzO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50X3N0ZG91dF91cmwgPSBjdXJyZW50X3N0ZG91dF91cmw7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRfc3RkZXJyX3VybCA9IGN1cnJlbnRfc3RkZXJyX3VybDtcbiAgICAgICAgICAgIHRoaXMucmVzdWx0c19tYW5pZmVzdCA9IHJlc3VsdHNfbWFuaWZlc3Q7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iRXhlY3V0aW9uLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1vbWVudC51dGModGhpcy5qb2JfY29tcGxldGVkKS5kaWZmKG1vbWVudC51dGModGhpcy5qb2Jfc3RhcnRlZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEljb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5qb2Iuam9iVHlwZS5pY29uQ29kZSA/ICc8aSBjbGFzcz1cImZhXCI+JiN4JyArIHRoaXMuam9iLmpvYlR5cGUuaWNvbkNvZGUgKyAnPC9pPicgOiAnPGkgY2xhc3M9XCJmYVwiPiYjeCcgKyBzY2FsZUNvbmZpZy5kZWZhdWx0SWNvbkNvZGUgKyAnPC9pPic7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYkV4ZWN1dGlvbi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRXhlY3V0aW9uKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb21tYW5kX2FyZ3VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByZV9zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByZV9jb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHJlX2V4aXRfY29kZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2Jfc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfY29tcGxldGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl9leGl0X2NvZGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucG9zdF9zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnBvc3RfY29tcGxldGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnBvc3RfZXhpdF9jb2RlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucXVldWVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubm9kZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lcnJvcixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lbnZpcm9ubWVudCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcHVzX3NjaGVkdWxlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tZW1fc2NoZWR1bGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfaW5fc2NoZWR1bGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfb3V0X3NjaGVkdWxlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrX3RvdGFsX3NjaGVkdWxlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmN1cnJlbnRfc3Rkb3V0X3VybCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jdXJyZW50X3N0ZGVycl91cmwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0c19tYW5pZmVzdFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYkV4ZWN1dGlvbigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYkV4ZWN1dGlvbi50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JFeGVjdXRpb24uYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iRXhlY3V0aW9uLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JFeGVjdXRpb247XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JFeGVjdXRpb25Mb2cnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIEpvYiwgTm9kZSkge1xuICAgICAgICB2YXIgSm9iRXhlY3V0aW9uTG9nID0gZnVuY3Rpb24gKGlkLCBzdGF0dXMsIGNvbW1hbmRfYXJndW1lbnRzLCB0aW1lb3V0LCBleGl0X2NvZGUsIGNyZWF0ZWQsIHF1ZXVlZCwgc2NoZWR1bGVkLCBwcmVfc3RhcnRlZCwgcHJlX2NvbXBsZXRlZCwgam9iX3N0YXJ0ZWQsIGpvYl9jb21wbGV0ZWQsIHBvc3Rfc3RhcnRlZCwgcG9zdF9jb21wbGV0ZWQsIGVuZGVkLCBsYXN0X21vZGlmaWVkLCBqb2IsIG5vZGUsIGVycm9yLCBpc19maW5pc2hlZCwgc3Rkb3V0LCBzdGRlcnIpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5jb21tYW5kX2FyZ3VtZW50cyA9IGNvbW1hbmRfYXJndW1lbnRzO1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDtcbiAgICAgICAgICAgIHRoaXMuZXhpdF9jb2RlID0gZXhpdF9jb2RlO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMucXVldWVkID0gcXVldWVkO1xuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZWQgPSBzY2hlZHVsZWQ7XG4gICAgICAgICAgICB0aGlzLnByZV9zdGFydGVkID0gcHJlX3N0YXJ0ZWQ7XG4gICAgICAgICAgICB0aGlzLnByZV9jb21wbGV0ZWQgPSBwcmVfY29tcGxldGVkO1xuICAgICAgICAgICAgdGhpcy5qb2Jfc3RhcnRlZCA9IGpvYl9zdGFydGVkO1xuICAgICAgICAgICAgdGhpcy5qb2JfY29tcGxldGVkID0gam9iX2NvbXBsZXRlZDtcbiAgICAgICAgICAgIHRoaXMucG9zdF9zdGFydGVkID0gcG9zdF9zdGFydGVkO1xuICAgICAgICAgICAgdGhpcy5wb3N0X2NvbXBsZXRlZCA9IHBvc3RfY29tcGxldGVkO1xuICAgICAgICAgICAgdGhpcy5lbmRlZCA9IGVuZGVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMuam9iID0gSm9iLnRyYW5zZm9ybWVyKGpvYik7XG4gICAgICAgICAgICB0aGlzLm5vZGUgPSBOb2RlLnRyYW5zZm9ybWVyKG5vZGUpO1xuICAgICAgICAgICAgdGhpcy5lcnJvciA9IGVycm9yO1xuICAgICAgICAgICAgdGhpcy5pc19maW5pc2hlZCA9IGlzX2ZpbmlzaGVkO1xuICAgICAgICAgICAgdGhpcy5zdGRvdXQgPSBzdGRvdXQ7XG4gICAgICAgICAgICB0aGlzLnN0ZG91dEh0bWwgPSBzdGRvdXQgPyBzdGRvdXQucmVwbGFjZShuZXcgUmVnRXhwKCdcXHI/XFxuJywnZycpLCAnPGJyIC8+JykgOiAnJztcbiAgICAgICAgICAgIHRoaXMuc3RkZXJyID0gc3RkZXJyO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYkV4ZWN1dGlvbkxvZy5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICB0b0h0bWw6IGZ1bmN0aW9uKGluc3RyKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5zdHJcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JFeGVjdXRpb25Mb2cuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYkV4ZWN1dGlvbkxvZyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY29tbWFuZF9hcmd1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGltZW91dCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5leGl0X2NvZGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5xdWV1ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc2NoZWR1bGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByZV9zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByZV9jb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3N0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX2NvbXBsZXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wb3N0X3N0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucG9zdF9jb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubm9kZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lcnJvcixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19maW5pc2hlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGRvdXQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RkZXJyXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRXhlY3V0aW9uTG9nKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iRXhlY3V0aW9uTG9nLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYkV4ZWN1dGlvbkxvZy5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JFeGVjdXRpb25Mb2cuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYkV4ZWN1dGlvbkxvZztcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYlR5cGUnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIEpvYlR5cGVJbnRlcmZhY2UpIHtcbiAgICAgICAgdmFyIEpvYlR5cGUgPSBmdW5jdGlvbiAoaWQsIG5hbWUsIHRpdGxlLCB2ZXJzaW9uLCBkZXNjcmlwdGlvbiwgaXNfc3lzdGVtLCBpc19sb25nX3J1bm5pbmcsIGlzX2FjdGl2ZSwgaXNfb3BlcmF0aW9uYWwsIGlzX3BhdXNlZCwgdXNlc19kb2NrZXIsIGRvY2tlcl9wcml2aWxlZ2VkLCBkb2NrZXJfaW1hZ2UsIHByaW9yaXR5LCB0aW1lb3V0LCBtYXhfdHJpZXMsIGNwdXNfcmVxdWlyZWQsIG1lbV9yZXF1aXJlZCwgZGlza19vdXRfY29uc3RfcmVxdWlyZWQsIGRpc2tfb3V0X211bHRfcmVxdWlyZWQsIGljb25fY29kZSwgY3JlYXRlZCwgYXJjaGl2ZWQsIHBhdXNlZCwgbGFzdF9tb2RpZmllZCwgam9iX3R5cGVfaW50ZXJmYWNlKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlO1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuaXNfc3lzdGVtID0gaXNfc3lzdGVtO1xuICAgICAgICAgICAgdGhpcy5pc19sb25nX3J1bm5pbmcgPSBpc19sb25nX3J1bm5pbmc7XG4gICAgICAgICAgICB0aGlzLmlzX2FjdGl2ZSA9IGlzX2FjdGl2ZTtcbiAgICAgICAgICAgIHRoaXMuaXNfb3BlcmF0aW9uYWwgPSBpc19vcGVyYXRpb25hbDtcbiAgICAgICAgICAgIHRoaXMuaXNfcGF1c2VkID0gaXNfcGF1c2VkO1xuICAgICAgICAgICAgdGhpcy51c2VzX2RvY2tlciA9IHVzZXNfZG9ja2VyO1xuICAgICAgICAgICAgdGhpcy5kb2NrZXJfcHJpdmlsZWdlZCA9IGRvY2tlcl9wcml2aWxlZ2VkO1xuICAgICAgICAgICAgdGhpcy5kb2NrZXJfaW1hZ2UgPSBkb2NrZXJfaW1hZ2U7XG4gICAgICAgICAgICB0aGlzLnByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXQgPSB0aW1lb3V0O1xuICAgICAgICAgICAgdGhpcy5tYXhfdHJpZXMgPSBtYXhfdHJpZXM7XG4gICAgICAgICAgICB0aGlzLmNwdXNfcmVxdWlyZWQgPSBjcHVzX3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5tZW1fcmVxdWlyZWQgPSBtZW1fcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkID0gZGlza19vdXRfY29uc3RfcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmRpc2tfb3V0X211bHRfcmVxdWlyZWQgPSBkaXNrX291dF9tdWx0X3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5pY29uX2NvZGUgPSBpY29uX2NvZGU7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5hcmNoaXZlZCA9IGFyY2hpdmVkO1xuICAgICAgICAgICAgdGhpcy5wYXVzZWQgPSBwYXVzZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZV9pbnRlcmZhY2UgPSBKb2JUeXBlSW50ZXJmYWNlLnRyYW5zZm9ybWVyKGpvYl90eXBlX2ludGVyZmFjZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iVHlwZS5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnSm9iVHlwZSc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0SWNvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmljb25fY29kZSA/ICc8aSBjbGFzcz1cImZhIGZhLWZ3XCI+JiN4JyArIHRoaXMuaWNvbl9jb2RlICsgJzwvaT4nIDogJzxpIGNsYXNzPVwiZmEgZmEtZndcIj4mI3gnICsgc2NhbGVDb25maWcuZGVmYXVsdEljb25Db2RlICsgJzwvaT4nO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxUZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWNvbl9jb2RlID8gJyYjeCcgKyB0aGlzLmljb25fY29kZSArICc7JyA6ICcmI3gnICsgc2NhbGVDb25maWcuZGVmYXVsdEljb25Db2RlICsgJzsnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxUaXRsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRpdGxlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JUeXBlLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19zeXN0ZW0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfbG9uZ19ydW5uaW5nLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19vcGVyYXRpb25hbCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19wYXVzZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudXNlc19kb2NrZXIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZG9ja2VyX3ByaXZpbGVnZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZG9ja2VyX2ltYWdlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWF4X3RyaWVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNwdXNfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVtX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfb3V0X211bHRfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWNvbl9jb2RlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuYXJjaGl2ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucGF1c2VkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaW50ZXJmYWNlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYlR5cGUudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iVHlwZS5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JUeXBlLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JUeXBlO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYlR5cGVEZXRhaWxzJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2JUeXBlSW50ZXJmYWNlLCBKb2JUeXBlRXJyb3JNYXBwaW5nLCBKb2JUeXBlRXJyb3IsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgSm9iVHlwZURldGFpbHMgPSBmdW5jdGlvbiAoaWQsIG5hbWUsIHZlcnNpb24sIHRpdGxlLCBkZXNjcmlwdGlvbiwgY2F0ZWdvcnksIGF1dGhvcl9uYW1lLCBhdXRob3JfdXJsLCBpc19zeXN0ZW0sIGlzX2xvbmdfcnVubmluZywgaXNfYWN0aXZlLCBpc19vcGVyYXRpb25hbCwgaXNfcGF1c2VkLCBpY29uX2NvZGUsIHVzZXNfZG9ja2VyLCBkb2NrZXJfcHJpdmlsZWdlZCwgZG9ja2VyX2ltYWdlLCByZXZpc2lvbl9udW0sIHByaW9yaXR5LCB0aW1lb3V0LCBtYXhfc2NoZWR1bGVkLCBtYXhfdHJpZXMsIGNwdXNfcmVxdWlyZWQsIG1lbV9yZXF1aXJlZCwgZGlza19vdXRfY29uc3RfcmVxdWlyZWQsIGRpc2tfb3V0X211bHRfcmVxdWlyZWQsIGNyZWF0ZWQsIGFyY2hpdmVkLCBwYXVzZWQsIGxhc3RfbW9kaWZpZWQsIGpvYl90eXBlX2ludGVyZmFjZSwgZXJyb3JfbWFwcGluZywgdHJpZ2dlcl9ydWxlLCBlcnJvcnMsIGpvYl9jb3VudHNfNmgsIGpvYl9jb3VudHNfMTJoLCBqb2JfY291bnRzXzI0aCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICAgICAgICB0aGlzLmNhdGVnb3J5ID0gY2F0ZWdvcnk7XG4gICAgICAgICAgICB0aGlzLmF1dGhvcl9uYW1lID0gYXV0aG9yX25hbWU7XG4gICAgICAgICAgICB0aGlzLmF1dGhvcl91cmwgPSBhdXRob3JfdXJsO1xuICAgICAgICAgICAgdGhpcy5pc19zeXN0ZW0gPSBpc19zeXN0ZW07XG4gICAgICAgICAgICB0aGlzLmlzX2xvbmdfcnVubmluZyA9IGlzX2xvbmdfcnVubmluZztcbiAgICAgICAgICAgIHRoaXMuaXNfYWN0aXZlID0gaXNfYWN0aXZlO1xuICAgICAgICAgICAgdGhpcy5pc19vcGVyYXRpb25hbCA9IGlzX29wZXJhdGlvbmFsO1xuICAgICAgICAgICAgdGhpcy5pc19wYXVzZWQgPSBpc19wYXVzZWQ7XG4gICAgICAgICAgICB0aGlzLmljb25fY29kZSA9IGljb25fY29kZTtcbiAgICAgICAgICAgIHRoaXMudXNlc19kb2NrZXIgPSB1c2VzX2RvY2tlcjtcbiAgICAgICAgICAgIHRoaXMuZG9ja2VyX3ByaXZpbGVnZWQgPSBkb2NrZXJfcHJpdmlsZWdlZDtcbiAgICAgICAgICAgIHRoaXMuZG9ja2VyX2ltYWdlID0gZG9ja2VyX2ltYWdlO1xuICAgICAgICAgICAgdGhpcy5yZXZpc2lvbl9udW0gPSByZXZpc2lvbl9udW07XG4gICAgICAgICAgICB0aGlzLnByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXQgPSB0aW1lb3V0O1xuICAgICAgICAgICAgdGhpcy5tYXhfc2NoZWR1bGVkID0gbWF4X3NjaGVkdWxlZDtcbiAgICAgICAgICAgIHRoaXMubWF4X3RyaWVzID0gbWF4X3RyaWVzO1xuICAgICAgICAgICAgdGhpcy5jcHVzX3JlcXVpcmVkID0gY3B1c19yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMubWVtX3JlcXVpcmVkID0gbWVtX3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5tZW1fcmVxdWlyZWRfZm9ybWF0dGVkID0gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUZpbGVTaXplRnJvbU1pYihtZW1fcmVxdWlyZWQpO1xuICAgICAgICAgICAgdGhpcy5kaXNrX291dF9jb25zdF9yZXF1aXJlZCA9IGRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX291dF9jb25zdF9yZXF1aXJlZF9mb3JtYXR0ZWQgPSBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tTWliKGRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkKTtcbiAgICAgICAgICAgIHRoaXMuZGlza19vdXRfbXVsdF9yZXF1aXJlZCA9IGRpc2tfb3V0X211bHRfcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5hcmNoaXZlZCA9IGFyY2hpdmVkO1xuICAgICAgICAgICAgdGhpcy5wYXVzZWQgPSBwYXVzZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZV9pbnRlcmZhY2UgPSBqb2JfdHlwZV9pbnRlcmZhY2U7XG4gICAgICAgICAgICB0aGlzLmVycm9yX21hcHBpbmcgPSBKb2JUeXBlRXJyb3JNYXBwaW5nLnRyYW5zZm9ybWVyKGVycm9yX21hcHBpbmcpO1xuICAgICAgICAgICAgdGhpcy50cmlnZ2VyX3J1bGUgPSB0cmlnZ2VyX3J1bGU7XG4gICAgICAgICAgICB0aGlzLmVycm9ycyA9IEpvYlR5cGVFcnJvci50cmFuc2Zvcm1lcihlcnJvcnMpO1xuICAgICAgICAgICAgdGhpcy5qb2JfY291bnRzXzZoID0gam9iX2NvdW50c182aDtcbiAgICAgICAgICAgIHRoaXMuam9iX2NvdW50c18xMmggPSBqb2JfY291bnRzXzEyaDtcbiAgICAgICAgICAgIHRoaXMuam9iX2NvdW50c18yNGggPSBqb2JfY291bnRzXzI0aDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JUeXBlRGV0YWlscy5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXRJY29uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWNvbl9jb2RlID8gJzxpIGNsYXNzPVwiZmFcIj4mI3gnICsgdGhpcy5pY29uX2NvZGUgKyAnPC9pPicgOiAnPGkgY2xhc3M9XCJmYVwiPiYjeCcgKyBzY2FsZUNvbmZpZy5kZWZhdWx0SWNvbkNvZGUgKyAnPC9pPic7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UGVyZm9ybWFuY2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmFpbGVkNkFyciA9IF8ud2hlcmUodGhpcy5qb2JfY291bnRzXzZoLCB7ICdzdGF0dXMnOiAnRkFJTEVEJyB9KSxcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkMTJBcnIgPSBfLndoZXJlKHRoaXMuam9iX2NvdW50c18xMmgsIHsgJ3N0YXR1cyc6ICdGQUlMRUQnIH0pLFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQyNEFyciA9IF8ud2hlcmUodGhpcy5qb2JfY291bnRzXzI0aCwgeyAnc3RhdHVzJzogJ0ZBSUxFRCcgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgY29tcGxldGVkNiA9IF8uZmluZCh0aGlzLmpvYl9jb3VudHNfNmgsICdzdGF0dXMnLCAnQ09NUExFVEVEJykgfHwgeyBjb3VudDogMCB9LFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQ2ID0gXy5zdW0oZmFpbGVkNkFyciwgJ2NvdW50JyksXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsNiA9IGZhaWxlZDZBcnIubGVuZ3RoID4gMCA/IGZhaWxlZDYgKyBjb21wbGV0ZWQ2LmNvdW50IDogY29tcGxldGVkNi5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc1JhdGU2ID0gdG90YWw2ID09PSAwID8gMCA6IDEwMCAtICgoZmFpbGVkNiAvIHRvdGFsNikgKiAxMDApLnRvRml4ZWQoMiksXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDEyID0gXy5maW5kKHRoaXMuam9iX2NvdW50c18xMmgsICdzdGF0dXMnLCAnQ09NUExFVEVEJykgfHwgeyBjb3VudDogMCB9LFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQxMiA9IF8uc3VtKGZhaWxlZDEyQXJyLCAnY291bnQnKSxcbiAgICAgICAgICAgICAgICAgICAgdG90YWwxMiA9IGZhaWxlZDEyQXJyLmxlbmd0aCA+IDAgPyBmYWlsZWQxMiArIGNvbXBsZXRlZDEyLmNvdW50IDogY29tcGxldGVkMTIuY291bnQsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlMTIgPSB0b3RhbDEyID09PSAwID8gMCA6IDEwMCAtICgoZmFpbGVkMTIgLyB0b3RhbDEyKSAqIDEwMCkudG9GaXhlZCgyKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkMjQgPSBfLmZpbmQodGhpcy5qb2JfY291bnRzXzI0aCwgJ3N0YXR1cycsICdDT01QTEVURUQnKSB8fCB7IGNvdW50OiAwIH0sXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDI0ID0gXy5zdW0oZmFpbGVkMjRBcnIsICdjb3VudCcpLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbDI0ID0gZmFpbGVkMjRBcnIubGVuZ3RoID4gMCA/IGZhaWxlZDI0ICsgY29tcGxldGVkMjQuY291bnQgOiBjb21wbGV0ZWQyNC5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc1JhdGUyNCA9IHRvdGFsMjQgPT09IDAgPyAwIDogMTAwIC0gKChmYWlsZWQyNCAvIHRvdGFsMjQpICogMTAwKS50b0ZpeGVkKDIpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgaG91cjY6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhdGU6IHN1Y2Nlc3NSYXRlNixcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxlZDogZmFpbGVkNixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogY29tcGxldGVkNi5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0b3RhbDZcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgaG91cjEyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByYXRlOiBzdWNjZXNzUmF0ZTEyLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbGVkOiBmYWlsZWQxMixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogY29tcGxldGVkMTIuY291bnQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogdG90YWwxMlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBob3VyMjQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhdGU6IHN1Y2Nlc3NSYXRlMjQsXG4gICAgICAgICAgICAgICAgICAgICAgICBmYWlsZWQ6IGZhaWxlZDI0LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkOiBjb21wbGV0ZWQyNC5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0b3RhbDI0XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEZhaWx1cmVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZhaWxlZDYgPSBfLndoZXJlKHRoaXMuam9iX2NvdW50c182aCwgeyAnc3RhdHVzJzogJ0ZBSUxFRCcgfSksXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDZWYWx1ZXMgPSBfLnZhbHVlcyhfLmdyb3VwQnkoZmFpbGVkNiwgJ2NhdGVnb3J5JykpLFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQxMiA9IF8ud2hlcmUodGhpcy5qb2JfY291bnRzXzEyaCwgeyAnc3RhdHVzJzogJ0ZBSUxFRCcgfSksXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDEyVmFsdWVzID0gXy52YWx1ZXMoXy5ncm91cEJ5KGZhaWxlZDEyLCAnY2F0ZWdvcnknKSksXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDI0ID0gXy53aGVyZSh0aGlzLmpvYl9jb3VudHNfMjRoLCB7ICdzdGF0dXMnOiAnRkFJTEVEJyB9KSxcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkMjRWYWx1ZXMgPSBfLnZhbHVlcyhfLmdyb3VwQnkoZmFpbGVkMjQsICdjYXRlZ29yeScpKTtcblxuICAgICAgICAgICAgICAgIHZhciBnZXRGYWlsdXJlQ291bnRzID0gZnVuY3Rpb24gKGNhdGVnb3JpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldHVybkFyciA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goY2F0ZWdvcmllcywgZnVuY3Rpb24gKGNhdGVnb3J5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goY2F0ZWdvcnksIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5BcnIucHVzaCh7IHN0YXR1czogdmFsLmNhdGVnb3J5LCBjb3VudDogdmFsLmNvdW50IH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuQXJyO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBob3VyNjogZ2V0RmFpbHVyZUNvdW50cyhmYWlsZWQ2VmFsdWVzKSxcbiAgICAgICAgICAgICAgICAgICAgaG91cjEyOiBnZXRGYWlsdXJlQ291bnRzKGZhaWxlZDEyVmFsdWVzKSxcbiAgICAgICAgICAgICAgICAgICAgaG91cjI0OiBnZXRGYWlsdXJlQ291bnRzKGZhaWxlZDI0VmFsdWVzKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYlR5cGVEZXRhaWxzLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETzogY2hhbmdlIHByb3BlcnR5IHJldHVybmVkIGJ5IEFQSSBmcm9tIFwiaW50ZXJmYWNlXCIgdG8gXCJqb2JfdHlwZV9pbnRlcmZhY2VcIiBiZWNhdXNlIFwiaW50ZXJmYWNlXCIgaXMgYSByZXNlcnZlZCB3b3JkIGluIEpTXG4gICAgICAgICAgICAgICAgdmFyIGpvYlR5cGVJbnRlcmZhY2UgPSBkYXRhLmludGVyZmFjZSA/IGRhdGEuaW50ZXJmYWNlIDogZGF0YS5qb2JfdHlwZV9pbnRlcmZhY2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlRGV0YWlscyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY2F0ZWdvcnksXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuYXV0aG9yX25hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuYXV0aG9yX3VybCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19zeXN0ZW0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfbG9uZ19ydW5uaW5nLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19vcGVyYXRpb25hbCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19wYXVzZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWNvbl9jb2RlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnVzZXNfZG9ja2VyLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRvY2tlcl9wcml2aWxlZ2VkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRvY2tlcl9pbWFnZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXZpc2lvbl9udW0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHJpb3JpdHksXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGltZW91dCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tYXhfc2NoZWR1bGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1heF90cmllcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcHVzX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lbV9yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrX291dF9jb25zdF9yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrX291dF9tdWx0X3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuYXJjaGl2ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucGF1c2VkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGpvYlR5cGVJbnRlcmZhY2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXJyb3JfbWFwcGluZyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50cmlnZ2VyX3J1bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXJyb3JzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl9jb3VudHNfNmgsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX2NvdW50c18xMmgsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX2NvdW50c18yNGhcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlRGV0YWlscygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYlR5cGVEZXRhaWxzLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYlR5cGVEZXRhaWxzLmJ1aWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JUeXBlRGV0YWlscy5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iVHlwZURldGFpbHM7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iVHlwZUVycm9yJywgZnVuY3Rpb24gKG1vbWVudCwgc2NhbGVDb25maWcpIHtcbiAgICAgICAgdmFyIEpvYlR5cGVFcnJvciA9IGZ1bmN0aW9uIChpZCwgbmFtZSwgdGl0bGUsIGRlc2NyaXB0aW9uLCBjYXRlZ29yeSwgY3JlYXRlZCwgbGFzdF9tb2RpZmllZCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuY2F0ZWdvcnkgPSBjYXRlZ29yeTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWRfZm9ybWF0dGVkID0gY3JlYXRlZCA/IG1vbWVudC51dGMoY3JlYXRlZCkudG9JU09TdHJpbmcoKSA6IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkX2Zvcm1hdHRlZCA9IGxhc3RfbW9kaWZpZWQgPyBtb21lbnQudXRjKGxhc3RfbW9kaWZpZWQpLnRvSVNPU3RyaW5nKCkgOiBsYXN0X21vZGlmaWVkO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYlR5cGVFcnJvci5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iVHlwZUVycm9yLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jYXRlZ29yeSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlRXJyb3IoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2JUeXBlRXJyb3IudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iVHlwZUVycm9yLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYlR5cGVFcnJvci5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iVHlwZUVycm9yO1xuICAgIH0pXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iVHlwZUVycm9yTWFwcGluZycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIEpvYlR5cGVFcnJvck1hcHBpbmcgPSBmdW5jdGlvbiAodmVyc2lvbiwgZXhpdF9jb2Rlcykge1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMuZXhpdF9jb2RlcyA9IGV4aXRfY29kZXM7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iVHlwZUVycm9yTWFwcGluZy5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iVHlwZUVycm9yTWFwcGluZy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZUVycm9yTWFwcGluZyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS52ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmV4aXRfY29kZXNcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlRXJyb3JNYXBwaW5nKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iVHlwZUVycm9yTWFwcGluZy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JUeXBlRXJyb3JNYXBwaW5nLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYlR5cGVFcnJvck1hcHBpbmcuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYlR5cGVFcnJvck1hcHBpbmc7XG4gICAgfSlcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JUeXBlSW5wdXREYXRhJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBKb2JUeXBlSW5wdXREYXRhID0gZnVuY3Rpb24gKG1lZGlhX3R5cGVzLCByZXF1aXJlZCwgdHlwZSwgbmFtZSkge1xuICAgICAgICAgICAgdGhpcy5tZWRpYV90eXBlcyA9IG1lZGlhX3R5cGVzO1xuICAgICAgICAgICAgdGhpcy5yZXF1aXJlZCA9IHJlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iVHlwZUlucHV0RGF0YS5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iVHlwZUlucHV0RGF0YS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZUlucHV0RGF0YShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tZWRpYV90eXBlcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlSW5wdXREYXRhKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iVHlwZUlucHV0RGF0YS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JUeXBlSW5wdXREYXRhLmJ1aWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JUeXBlSW5wdXREYXRhLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JUeXBlSW5wdXREYXRhO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYlR5cGVJbnRlcmZhY2UnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIEpvYlR5cGVJbnB1dERhdGEsIEpvYlR5cGVPdXRwdXREYXRhKSB7XG4gICAgICAgIHZhciBKb2JUeXBlSW50ZXJmYWNlID0gZnVuY3Rpb24gKHZlcnNpb24sIGNvbW1hbmQsIGNvbW1hbmRfYXJndW1lbnRzLCBpbnB1dF9kYXRhLCBvdXRwdXRfZGF0YSkge1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMuY29tbWFuZCA9IGNvbW1hbmQ7XG4gICAgICAgICAgICB0aGlzLmNvbW1hbmRfYXJndW1lbnRzID0gY29tbWFuZF9hcmd1bWVudHM7XG4gICAgICAgICAgICB0aGlzLmlucHV0X2RhdGEgPSBKb2JUeXBlSW5wdXREYXRhLnRyYW5zZm9ybWVyKGlucHV0X2RhdGEpO1xuICAgICAgICAgICAgdGhpcy5vdXRwdXRfZGF0YSA9IEpvYlR5cGVPdXRwdXREYXRhLnRyYW5zZm9ybWVyKG91dHB1dF9kYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JUeXBlSW50ZXJmYWNlLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldEljb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pY29uQ29kZSA/ICc8aSBjbGFzcz1cImZhXCI+JiN4JyArIHRoaXMuaWNvbkNvZGUgKyAnPC9pPicgOiAnPGkgY2xhc3M9XCJmYVwiPiYjeCcgKyBzY2FsZUNvbmZpZy5kZWZhdWx0SWNvbkNvZGUgKyAnPC9pPic7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYlR5cGVJbnRlcmZhY2UuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYlR5cGVJbnRlcmZhY2UoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb21tYW5kLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNvbW1hbmRfYXJndW1lbnRzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlucHV0X2RhdGEsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEub3V0cHV0X2RhdGFcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlSW50ZXJmYWNlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iVHlwZUludGVyZmFjZS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JUeXBlSW50ZXJmYWNlLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYlR5cGVJbnRlcmZhY2UuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYlR5cGVJbnRlcmZhY2U7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JUeXBlT3V0cHV0RGF0YScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIEpvYlR5cGVPdXRwdXREYXRhID0gZnVuY3Rpb24gKG5hbWUsIHR5cGUsIHJlcXVpcmVkLCBtZWRpYV90eXBlKSB7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgICAgIHRoaXMucmVxdWlyZWQgPSByZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMubWVkaWFfdHlwZSA9IG1lZGlhX3R5cGU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iVHlwZU91dHB1dERhdGEucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYlR5cGVPdXRwdXREYXRhLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlT3V0cHV0RGF0YShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVkaWFfdHlwZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYlR5cGVPdXRwdXREYXRhKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iVHlwZU91dHB1dERhdGEudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iVHlwZU91dHB1dERhdGEuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iVHlwZU91dHB1dERhdGEuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYlR5cGVPdXRwdXREYXRhO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYlR5cGVTdGF0dXMnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIEpvYlR5cGUsIEpvYkV4ZWN1dGlvbikge1xuICAgICAgICB2YXIgSm9iVHlwZVN0YXR1cyA9IGZ1bmN0aW9uIChqb2JfdHlwZSwgam9iX2NvdW50cykge1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZSA9IEpvYlR5cGUudHJhbnNmb3JtZXIoam9iX3R5cGUpO1xuICAgICAgICAgICAgdGhpcy5qb2JfY291bnRzID0gam9iX2NvdW50cztcbiAgICAgICAgICAgIHRoaXMuaGFzX3J1bm5pbmcgPSBfLmZpbmQoam9iX2NvdW50cywgJ3N0YXR1cycsICdSVU5OSU5HJyk7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gdGhpcy5nZXRQZXJmb3JtYW5jZSgpLnJhdGVEZXNjcmlwdGlvbjtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JUeXBlU3RhdHVzLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdKb2JUeXBlU3RhdHVzJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRQZXJmb3JtYW5jZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBmYWlsZWRBcnIgPSBfLnNvcnRCeU9yZGVyKF8uZmlsdGVyKHRoaXMuam9iX2NvdW50cywgeyBzdGF0dXM6ICdGQUlMRUQnIH0pLCBbJ2NvdW50J10sIFsnZGVzYyddKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkID0gXy5maW5kKHRoaXMuam9iX2NvdW50cywgJ3N0YXR1cycsICdDT01QTEVURUQnKSB8fCB7IGNvdW50OiAwIH0sXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZCA9IF8uc3VtKGZhaWxlZEFyciwgJ2NvdW50JyksXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZENhdGVnb3J5ID0gZmFpbGVkQXJyLmxlbmd0aCA+IDAgPyBmYWlsZWRBcnJbMF0uY2F0ZWdvcnkgOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgdG90YWwgPSBmYWlsZWRBcnIubGVuZ3RoID4gMCA/IGZhaWxlZCArIGNvbXBsZXRlZC5jb3VudCA6IGNvbXBsZXRlZC5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc1JhdGUgPSB0b3RhbCA9PT0gMCA/IDAgOiAxMDAgLSAoKGZhaWxlZCAvIHRvdGFsKSAqIDEwMCkudG9GaXhlZCgyKSxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc1JhdGVEZXNjcmlwdGlvbiA9ICdzdWNjZXNzJztcblxuICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzUmF0ZSA8PSAzMCAmJiB0b3RhbCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc1JhdGVEZXNjcmlwdGlvbiA9ICdlcnJvcic7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdWNjZXNzUmF0ZSA+IDMwICYmIHN1Y2Nlc3NSYXRlIDw9IDYwICYmIHRvdGFsID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzUmF0ZURlc2NyaXB0aW9uID0gJ3dhcm5pbmcnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodG90YWwgPT09IDAgJiYgIXRoaXMuaGFzX3J1bm5pbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc1JhdGVEZXNjcmlwdGlvbiA9ICd6X2luYWN0aXZlJzsgLy8gcHJlcGVuZCB3aXRoICd6XycgZm9yIG9yZGVyaW5nIHB1cnBvc2VzXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcmF0ZTogc3VjY2Vzc1JhdGUsXG4gICAgICAgICAgICAgICAgICAgIHJhdGVEZXNjcmlwdGlvbjogc3VjY2Vzc1JhdGVEZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkOiBmYWlsZWQsXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZENhdGVnb3J5OiBmYWlsZWRDYXRlZ29yeSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkOiBjb21wbGV0ZWQuY291bnQsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0b3RhbFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UnVubmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfLmZpbmQodGhpcy5qb2JfY291bnRzLCAnc3RhdHVzJywgJ1JVTk5JTkcnKSB8fCB7IGNvdW50OiAwIH07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RmFpbHVyZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmFpbGVkID0gXy53aGVyZSh0aGlzLmpvYl9jb3VudHMsIHsgJ3N0YXR1cyc6ICdGQUlMRUQnIH0pO1xuXG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKGZhaWxlZCwgZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNhdGVnb3J5ID0gXy5maW5kKHNjYWxlQ29uZmlnLmVycm9yQ2F0ZWdvcmllcywgeyBuYW1lOiBmLmNhdGVnb3J5IH0pO1xuICAgICAgICAgICAgICAgICAgICBmLm9yZGVyID0gY2F0ZWdvcnkgPyBjYXRlZ29yeS5vcmRlciA6ICcnO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIGZhaWxlZFZhbHVlcyA9IF8udmFsdWVzKF8uZ3JvdXBCeShmYWlsZWQsICdvcmRlcicpKTtcblxuICAgICAgICAgICAgICAgIHZhciBnZXRGYWlsdXJlQ291bnRzID0gZnVuY3Rpb24gKGNhdGVnb3JpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldHVybkFyciA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goY2F0ZWdvcmllcywgZnVuY3Rpb24gKGNhdGVnb3J5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goY2F0ZWdvcnksIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5BcnIucHVzaCh7IHN0YXR1czogdmFsLmNhdGVnb3J5LCBjb3VudDogdmFsLmNvdW50LCBvcmRlcjogdmFsLm9yZGVyIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5zb3J0QnlPcmRlcihyZXR1cm5BcnIsIFsnb3JkZXInXSwgWydkZXNjJ10pO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0RmFpbHVyZUNvdW50cyhmYWlsZWRWYWx1ZXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxGaWxsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1cyA9IHRoaXMuZ2V0UGVyZm9ybWFuY2UoKTtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzLnJhdGVEZXNjcmlwdGlvbiA9PT0gJ3pfaW5hY3RpdmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfZ3JheV9kYXJrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X2dyZWVuO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxBY3Rpdml0eTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBydW5uaW5nID0gdGhpcy5nZXRSdW5uaW5nKCk7XG4gICAgICAgICAgICAgICAgaWYgKHJ1bm5pbmcuY291bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnJiN4JyArIHNjYWxlQ29uZmlnLmFjdGl2aXR5SWNvbkNvZGUgKyAnOyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsQWN0aXZpdHlUb3RhbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFJ1bm5pbmcoKS5jb3VudCA+IDAgPyB0aGlzLmdldFJ1bm5pbmcoKS5jb3VudCA6ICcnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxFcnJvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBwZXJmb3JtYW5jZSA9IHRoaXMuZ2V0UGVyZm9ybWFuY2UoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0ZhaWxlZDogJyArIChwZXJmb3JtYW5jZS5mYWlsZWQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxUb3RhbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBwZXJmb3JtYW5jZSA9IHRoaXMuZ2V0UGVyZm9ybWFuY2UoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcGVyZm9ybWFuY2UuY29tcGxldGVkO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxQYXVzZVJlc3VtZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsRmFpbHVyZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXy5tYXAodGhpcy5nZXRGYWlsdXJlcygpLCAnc3RhdHVzJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYlR5cGVTdGF0dXMuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYlR5cGVTdGF0dXMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX2NvdW50c1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYlR5cGVTdGF0dXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2JUeXBlU3RhdHVzLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYlR5cGVTdGF0dXMuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iVHlwZVN0YXR1cy5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iVHlwZVN0YXR1cztcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCl7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUHJvZHVjdCcsIGZ1bmN0aW9uIChKb2JUeXBlLCBzY2FsZVNlcnZpY2UsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBQcm9kdWN0ID0gZnVuY3Rpb24gKGlkLCB3b3Jrc3BhY2UsIGZpbGVfbmFtZSwgbWVkaWFfdHlwZSwgZmlsZV9zaXplLCBkYXRhX3R5cGUsIGlzX2RlbGV0ZWQsIHV1aWQsIHVybCwgY3JlYXRlZCwgZGVsZXRlZCwgZGF0YV9zdGFydGVkLCBkYXRhX2VuZGVkLCBnZW9tZXRyeSwgY2VudGVyX3BvaW50LCBtZXRhX2RhdGEsIGNvdW50cmllcywgbGFzdF9tb2RpZmllZCwgaXNfb3BlcmF0aW9uYWwsIGlzX3B1Ymxpc2hlZCwgcHVibGlzaGVkLCB1bnB1Ymxpc2hlZCwgam9iX3R5cGUsIGpvYiwgam9iX2V4ZSwgdXBkYXRlLCBzb3VyY2VfZmlsZXMpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMud29ya3NwYWNlID0gd29ya3NwYWNlO1xuICAgICAgICAgICAgdGhpcy5maWxlX25hbWUgPSBmaWxlX25hbWU7XG4gICAgICAgICAgICB0aGlzLm1lZGlhX3R5cGUgPSBtZWRpYV90eXBlO1xuICAgICAgICAgICAgdGhpcy5maWxlX3NpemUgPSBmaWxlX3NpemU7XG4gICAgICAgICAgICB0aGlzLmZpbGVfc2l6ZV9yZWFkYWJsZSA9IHRoaXMuZ2V0UmVhZGFibGVGaWxlU2l6ZSgpO1xuICAgICAgICAgICAgdGhpcy5kYXRhX3R5cGUgPSBkYXRhX3R5cGU7XG4gICAgICAgICAgICB0aGlzLmlzX2RlbGV0ZWQgPSBpc19kZWxldGVkO1xuICAgICAgICAgICAgdGhpcy51dWlkID0gdXVpZDtcbiAgICAgICAgICAgIHRoaXMudXJsID0gdXJsO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZF9mb3JtYXR0ZWQgPSBjcmVhdGVkID8gbW9tZW50LnV0YyhjcmVhdGVkKS50b0lTT1N0cmluZygpIDogY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuZGVsZXRlZCA9IGRlbGV0ZWQ7XG4gICAgICAgICAgICB0aGlzLmRhdGFfc3RhcnRlZCA9IGRhdGFfc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMuZGF0YV9lbmRlZCA9IGRhdGFfZW5kZWQ7XG4gICAgICAgICAgICB0aGlzLmdlb21ldHJ5ID0gZ2VvbWV0cnk7XG4gICAgICAgICAgICB0aGlzLmNlbnRlcl9wb2ludCA9IGNlbnRlcl9wb2ludDtcbiAgICAgICAgICAgIHRoaXMubWV0YV9kYXRhID0gbWV0YV9kYXRhO1xuICAgICAgICAgICAgdGhpcy5jb3VudHJpZXMgPSBjb3VudHJpZXM7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkX2Zvcm1hdHRlZCA9IGxhc3RfbW9kaWZpZWQgPyBtb21lbnQudXRjKGxhc3RfbW9kaWZpZWQpLnRvSVNPU3RyaW5nKCkgOiBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5pc19vcGVyYXRpb25hbCA9IGlzX29wZXJhdGlvbmFsO1xuICAgICAgICAgICAgdGhpcy5pc19vcGVyYXRpb25hbF9sYWJlbCA9IGlzX29wZXJhdGlvbmFsID8gJ09wZXJhdGlvbmFsJyA6ICdSJmFtcDtEJztcbiAgICAgICAgICAgIHRoaXMuaXNfcHVibGlzaGVkID0gaXNfcHVibGlzaGVkO1xuICAgICAgICAgICAgdGhpcy5wdWJsaXNoZWQgPSBwdWJsaXNoZWQ7XG4gICAgICAgICAgICB0aGlzLnVucHVibGlzaGVkID0gdW5wdWJsaXNoZWQ7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlID0gSm9iVHlwZS50cmFuc2Zvcm1lcihqb2JfdHlwZSk7XG4gICAgICAgICAgICB0aGlzLmpvYiA9IGpvYjtcbiAgICAgICAgICAgIHRoaXMuam9iX2V4ZSA9IGpvYl9leGU7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSA9IHVwZGF0ZTtcbiAgICAgICAgICAgIHRoaXMuc291cmNlX2ZpbGVzID0gc291cmNlX2ZpbGVzO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIFByb2R1Y3QucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgZ2V0RHVyYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50LnV0Yyh0aGlzLmxhc3RfbW9kaWZpZWQpLmRpZmYobW9tZW50LnV0Yyh0aGlzLmNyZWF0ZWQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRSZWFkYWJsZUZpbGVTaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21CeXRlcyh0aGlzLmZpbGVfc2l6ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFByb2R1Y3QuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb2R1Y3QoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEud29ya3NwYWNlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZpbGVfbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tZWRpYV90eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZpbGVfc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kYXRhX3R5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfZGVsZXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS51dWlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnVybCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGF0YV9zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRhdGFfZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZ2VvbWV0cnksXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY2VudGVyX3BvaW50LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1ldGFfZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb3VudHJpZXMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19vcGVyYXRpb25hbCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19wdWJsaXNoZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHVibGlzaGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnVucHVibGlzaGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl90eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfZXhlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnVwZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zb3VyY2VfZmlsZXNcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9kdWN0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUHJvZHVjdC50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChQcm9kdWN0LmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFByb2R1Y3QuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFByb2R1Y3Q7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdSdW5uaW5nSm9iJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBzY2FsZVNlcnZpY2UsIEpvYlR5cGUpIHtcbiAgICAgICAgdmFyIFJ1bm5pbmdKb2IgPSBmdW5jdGlvbiAoY291bnQsIGxvbmdlc3RfcnVubmluZywgam9iX3R5cGUpIHtcbiAgICAgICAgICAgIHRoaXMuY291bnQgPSBjb3VudDtcbiAgICAgICAgICAgIHRoaXMubG9uZ2VzdF9ydW5uaW5nID0gbG9uZ2VzdF9ydW5uaW5nO1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZSA9IEpvYlR5cGUudHJhbnNmb3JtZXIoam9iX3R5cGUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIFJ1bm5pbmdKb2IucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgZ2V0RHVyYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUR1cmF0aW9uKHRoaXMubG9uZ2VzdF9ydW5uaW5nLCBtb21lbnQudXRjKCkudG9JU09TdHJpbmcoKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0SWNvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBpY29uID0gdGhpcy5qb2JfdHlwZS5pY29uX2NvZGUgPyAnPGkgY2xhc3M9XCJmYSBmYS1md1wiPiYjeCcgKyB0aGlzLmpvYl90eXBlLmljb25fY29kZSArICc8L2k+JyA6ICc8aSBjbGFzcz1cImZhIGZhLWZ3XCI+JiN4JyArIHNjYWxlQ29uZmlnLmRlZmF1bHRJY29uQ29kZSArICc8L2k+JztcbiAgICAgICAgICAgICAgICByZXR1cm4gaWNvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgUnVubmluZ0pvYi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUnVubmluZ0pvYihcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sb25nZXN0X3J1bm5pbmcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSdW5uaW5nSm9iKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUnVubmluZ0pvYi50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSdW5uaW5nSm9iLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFJ1bm5pbmdKb2IuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFJ1bm5pbmdKb2I7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnU3lzdGVtRmFpbHVyZScsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlKSB7XG4gICAgICAgIHZhciBTeXN0ZW1GYWlsdXJlID0gZnVuY3Rpb24gKGNvdW50LCBqb2JfdHlwZV9uYW1lLCBqb2JfdHlwZV92ZXJzaW9uLCBlcnJvcl9uYW1lLCBmaXJzdF9lcnJvciwgbGFzdF9lcnJvcikge1xuICAgICAgICAgICAgdGhpcy5jb3VudCA9IGNvdW50O1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZV9uYW1lID0gam9iX3R5cGVfbmFtZTtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGVfdmVyc2lvbiA9IGpvYl90eXBlX3ZlcnNpb247XG4gICAgICAgICAgICB0aGlzLmVycm9yX25hbWUgPSBlcnJvcl9uYW1lO1xuICAgICAgICAgICAgdGhpcy5maXJzdF9lcnJvciA9IGZpcnN0X2Vycm9yO1xuICAgICAgICAgICAgdGhpcy5sYXN0X2Vycm9yID0gbGFzdF9lcnJvcjtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBTeXN0ZW1GYWlsdXJlLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbih0aGlzLmZpcnN0X2Vycm9yLCB0aGlzLmxhc3RfZXJyb3IpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEljb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29uZmlnSm9iVHlwZSA9IF8uZmluZChzY2FsZUNvbmZpZy5qb2JUeXBlcywgJ3RpdGxlJywgdGhpcy5qb2JfdHlwZV9uYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnSm9iVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnSm9iVHlwZS5pY29uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVDb25maWcuZGVmYXVsdEljb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFN5c3RlbUZhaWx1cmUuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN5c3RlbUZhaWx1cmUoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY291bnQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGVfbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZV92ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmVycm9yX25hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZmlyc3RfZXJyb3IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9lcnJvclxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFN5c3RlbUZhaWx1cmUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBTeXN0ZW1GYWlsdXJlLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFN5c3RlbUZhaWx1cmUuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gU3lzdGVtRmFpbHVyZS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gU3lzdGVtRmFpbHVyZTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ2pvYkV4ZWN1dGlvblNlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsICRxLCAkcmVzb3VyY2UsIHBvbGxlciwgc2NhbGVDb25maWcsIEpvYkV4ZWN1dGlvbiwgSm9iRXhlY3V0aW9uTG9nKSB7XG5cbiAgICAgICAgdmFyIGdldEpvYkV4ZWN1dGlvbnNQYXJhbXMgPSBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCwgb3JkZXIsIHN0YXR1cywgam9iX3R5cGVfaWQsIGpvYl90eXBlX25hbWUsIGpvYl90eXBlX2NhdGVnb3J5LCBub2RlX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBwYWdlX3NpemUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogc3RhcnRlZCxcbiAgICAgICAgICAgICAgICBlbmRlZDogZW5kZWQsXG4gICAgICAgICAgICAgICAgb3JkZXI6IG9yZGVyLFxuICAgICAgICAgICAgICAgIHN0YXR1czogc3RhdHVzLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2lkOiBqb2JfdHlwZV9pZCxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9uYW1lOiBqb2JfdHlwZV9uYW1lLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2NhdGVnb3J5OiBqb2JfdHlwZV9jYXRlZ29yeSxcbiAgICAgICAgICAgICAgICBub2RlX2lkOiBub2RlX2lkXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRKb2JFeGVjdXRpb25zOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYkV4ZWN1dGlvbnNQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9iLWV4ZWN1dGlvbnMvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IEpvYkV4ZWN1dGlvbi50cmFuc2Zvcm1lcihkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYkV4ZWN1dGlvbkRldGFpbHM6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwLmdldChzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdqb2ItZXhlY3V0aW9ucy8nICsgaWQgKyAnLycpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKEpvYkV4ZWN1dGlvbi50cmFuc2Zvcm1lcihkYXRhKSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldExvZ09uY2U6IGZ1bmN0aW9uKGV4ZWNJZCl7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2pvYi1leGVjdXRpb25zLycgKyBleGVjSWQgKyAnL2xvZ3MvJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldExvZzogZnVuY3Rpb24oZXhlY0lkKXtcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gdXJsIHx8IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2pvYi1leGVjdXRpb25zLycgKyBleGVjSWQgKyAnL2xvZ3MvJztcblxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB2aWV3LiBTaW5jZSBhIHByb21pc2UgY2FuIG9ubHkgYmUgcmVzb2x2ZWQgb3IgcmVqZWN0ZWQgb25jZSBidXQgd2Ugd2FudFxuICAgICAgICAgICAgICAgIC8vIHRvIGtlZXAgdHJhY2sgb2YgYWxsIHJlcXVlc3RzLCBwb2xsZXIgc2VydmljZSB1c2VzIHRoZSBub3RpZnlDYWxsYmFjay4gQnkgZGVmYXVsdFxuICAgICAgICAgICAgICAgIC8vIHBvbGxlciBvbmx5IGdldHMgbm90aWZpZWQgb2Ygc3VjY2VzcyByZXNwb25zZXMuXG4gICAgICAgICAgICAgICAgdmFyIGpvYkV4ZWN1dGlvbkxvZ1Jlc291cmNlID0gJHJlc291cmNlKHVybCk7XG4gICAgICAgICAgICAgICAgdmFyIGpvYkV4ZWN1dGlvbkxvZ1BvbGxlciA9IHBvbGxlci5nZXQoam9iRXhlY3V0aW9uTG9nUmVzb3VyY2UsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5OiBzY2FsZUNvbmZpZy5wb2xsSW50ZXJ2YWxzLmpvYkV4ZWN1dGlvbkxvZ1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBqb2JFeGVjdXRpb25Mb2dQb2xsZXIucHJvbWlzZS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0LiRyZXNvbHZlZCl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZXhlY3V0aW9uX2xvZyA9IEpvYkV4ZWN1dGlvbkxvZy50cmFuc2Zvcm1lcihyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0LmV4ZWN1dGlvbl9sb2cuc3RhdHVzID09PSAnQ09NUExFVEVEJyB8fCByZXN1bHQuZXhlY3V0aW9uX2xvZy5zdGF0dXMgPT09ICdGQUlMRUQnKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2JFeGVjdXRpb25Mb2dQb2xsZXIuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvYkV4ZWN1dGlvbkxvZ1BvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ2pvYlNlcnZpY2UnLCBmdW5jdGlvbigkaHR0cCwgJHEsICRyZXNvdXJjZSwgc2NhbGVDb25maWcsIEpvYiwgSm9iRGV0YWlscywgUnVubmluZ0pvYiwgcG9sbGVyLCBwb2xsZXJGYWN0b3J5KSB7XG5cbiAgICAgICAgdmFyIGdldEpvYnNQYXJhbXMgPSBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCwgb3JkZXIsIHN0YXR1cywgam9iX3R5cGVfaWQsIGpvYl90eXBlX25hbWUsIGpvYl90eXBlX2NhdGVnb3J5LCB1cmwpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogcGFnZSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IHBhZ2Vfc2l6ZSxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBzdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICBvcmRlcjogb3JkZXIsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiBzdGF0dXMsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfaWQ6IGpvYl90eXBlX2lkLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX25hbWU6IGpvYl90eXBlX25hbWUsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfY2F0ZWdvcnk6IGpvYl90eXBlX2NhdGVnb3J5LFxuICAgICAgICAgICAgICAgIHVybDogdXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRKb2JVcGRhdGVEYXRhID0gZnVuY3Rpb24gKHN0YXR1cykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IHN0YXR1c1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0Sm9iczogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRKb2JzUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnVybCA9IHBhcmFtcy51cmwgPyBwYXJhbXMudXJsIDogc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9icy8nO1xuXG4gICAgICAgICAgICAgICAgdmFyIGpvYnNSZXNvdXJjZSA9ICRyZXNvdXJjZShwYXJhbXMudXJsLCBwYXJhbXMpLFxuICAgICAgICAgICAgICAgICAgICBqb2JzUG9sbGVyID0gcG9sbGVyRmFjdG9yeS5uZXdQb2xsZXIoam9ic1Jlc291cmNlLCBzY2FsZUNvbmZpZy5wb2xsSW50ZXJ2YWxzLmpvYnMpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGpvYnNQb2xsZXIucHJvbWlzZS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gSm9iLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2JzUG9sbGVyLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JzT25jZTogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRKb2JzUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHBhcmFtcy51cmwgPyBwYXJhbXMudXJsIDogc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9icy8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gSm9iLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JDb3VudHNCeVN0YXR1czogZnVuY3Rpb24gKGhvdXIpIHtcbiAgICAgICAgICAgICAgICBob3VyID0gaG91ciB8fCAzO1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwLmdldChzY2FsZUNvbmZpZy51cmxzLmdldEpvYkNvdW50c0J5U3RhdHVzKGhvdXIpKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iRGV0YWlsOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2pvYnMvJyArIGlkICsgJy8nKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShKb2JEZXRhaWxzLnRyYW5zZm9ybWVyKGRhdGEpKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UnVubmluZ0pvYnM6IGZ1bmN0aW9uIChwYWdlTnVtYmVyLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VOdW1iZXI6IHBhZ2VOdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBwYWdlU2l6ZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdmFyIHJ1bm5pbmdKb2JzUmVzb3VyY2UgPSAkcmVzb3VyY2Uoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9iLXR5cGVzL3J1bm5pbmcvJywgcGFyYW1zKSxcbiAgICAgICAgICAgICAgICAgICAgcnVubmluZ0pvYnNQb2xsZXIgPSBwb2xsZXJGYWN0b3J5Lm5ld1BvbGxlcihydW5uaW5nSm9ic1Jlc291cmNlLCBzY2FsZUNvbmZpZy5wb2xsSW50ZXJ2YWxzLnJ1bm5pbmdKb2JzKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBydW5uaW5nSm9ic1BvbGxlci5wcm9taXNlLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBSdW5uaW5nSm9iLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBydW5uaW5nSm9ic1BvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UnVubmluZ0pvYnNPbmNlOiBmdW5jdGlvbiAocGFnZU51bWJlciwgcGFnZVNpemUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgICAgICBwYWdlTnVtYmVyOiBwYWdlTnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICBwYWdlU2l6ZTogcGFnZVNpemVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwLmdldChzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdqb2ItdHlwZXMvcnVubmluZy8nLCBwYXJhbXMpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gUnVubmluZ0pvYi50cmFuc2Zvcm1lcihkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZUpvYjogZnVuY3Rpb24gKGlkLCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEgfHwgZ2V0Sm9iVXBkYXRlRGF0YSgpO1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdqb2JzLycgKyBpZCArICcvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnam9iVHlwZVNlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsICRxLCAkcmVzb3VyY2UsIHBvbGxlciwgcG9sbGVyRmFjdG9yeSwgc2NhbGVDb25maWcsIGpvYlNlcnZpY2UsIEpvYlR5cGUsIEpvYlR5cGVEZXRhaWxzLCBKb2JUeXBlU3RhdHVzKSB7XG4gICAgICAgIC8qdmFyIHRvdGFsSm9iVHlwZXMgPSA1O1xuXG4gICAgICAgIHZhciBnZXRUb3RhbEpvYlR5cGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRvdGFsSm9iVHlwZXM7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHNldFRvdGFsSm9iVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0b3RhbEpvYlR5cGVzID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDIwIC0gMSArIDEpKSArIDE7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2V0VG90YWxKb2JUeXBlcygpO1xuICAgICAgICB9LCAzMTAwKTsqL1xuXG4gICAgICAgIHZhciBnZXRKb2JUeXBlUGFyYW1zID0gZnVuY3Rpb24gKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQsIG5hbWUsIGNhdGVnb3J5LCBvcmRlcikge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogcGFnZV9zaXplID8gcGFnZV9zaXplIDogMTAwMCxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBzdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgICAgIGNhdGVnb3J5OiBjYXRlZ29yeSxcbiAgICAgICAgICAgICAgICBvcmRlcjogb3JkZXIgPyBvcmRlciA6IFsndGl0bGUnLCAndmVyc2lvbiddXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRKb2JUeXBlU3RhdHVzUGFyYW1zID0gZnVuY3Rpb24gKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogcGFnZSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IHBhZ2Vfc2l6ZSA/IHBhZ2Vfc2l6ZSA6IDEwMDAsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogc3RhcnRlZCxcbiAgICAgICAgICAgICAgICBlbmRlZDogZW5kZWRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldEpvYlR5cGVzOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYlR5cGVQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICAvLyB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIC8vICAgICBvcmRlcjogb3JkZXIgfHwgWyduYW1lJywndmVyc2lvbiddXG4gICAgICAgICAgICAgICAgLy8gfTtcblxuICAgICAgICAgICAgICAgIHZhciBqb2JUeXBlc1Jlc291cmNlID0gJHJlc291cmNlKHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2pvYi10eXBlcy8nLCBwYXJhbXMpLFxuICAgICAgICAgICAgICAgICAgICBqb2JUeXBlc1BvbGxlciA9IHBvbGxlckZhY3RvcnkubmV3UG9sbGVyKGpvYlR5cGVzUmVzb3VyY2UsIHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMuam9iVHlwZXMpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGpvYlR5cGVzUG9sbGVyLnByb21pc2UudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qdmFyIHJldHVyblJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVzb2x2ZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iX3R5cGVzOiBbXVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgZ2V0VG90YWxKb2JUeXBlcygpOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5SZXN1bHQuam9iX3R5cGVzLnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaXNfc3lzdGVtXCI6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInBhdXNlZFwiOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJkaXNrXCI6IDY0LjAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlkXCI6IGksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImRvY2tlcl9pbWFnZVwiOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhcmNoaXZlZFwiOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ1c2VzX2RvY2tlclwiOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicHJpb3JpdHlcIjogMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInZlcnNpb25cIjogXCIxLjBcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWNvbl9jb2RlXCI6IHNjYWxlQ29uZmlnLmpvYlR5cGVzW2kgLSAxXS5jb2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiOiBcIkluZ2VzdHMgYSBzb3VyY2UgZmlsZSBpbnRvIGEgd29ya3NwYWNlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm1lbVwiOiA2NC4wLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpc19hY3RpdmVcIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY3B1c1wiOiAxLjAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxhc3RfbW9kaWZpZWRcIjogXCIyMDE1LTAzLTExVDAwOjAwOjAwWlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtYXhfdHJpZXNcIjogMyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaXNfcGF1c2VkXCI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IHNjYWxlQ29uZmlnLmpvYlR5cGVzW2kgLSAxXS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY3JlYXRlZFwiOiBcIjIwMTUtMDMtMTFUMDA6MDA6MDBaXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRpbWVvdXRcIjogMTgwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaXNfbG9uZ19ydW5uaW5nXCI6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSByZXR1cm5SZXN1bHQ7Ki9cblxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gSm9iVHlwZS50cmFuc2Zvcm1lcihkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2JUeXBlc1BvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYlR5cGVzT25jZTogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRKb2JUeXBlUGFyYW1zKCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9iLXR5cGVzLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBKb2JUeXBlLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iVHlwZVN0YXR1czogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXRKb2JUeXBlU3RhdHVzUGFyYW1zKCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgam9iVHlwZVN0YXR1c1Jlc291cmNlID0gJHJlc291cmNlKHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2pvYi10eXBlcy9zdGF0dXMvJywgcGFyYW1zKSxcbiAgICAgICAgICAgICAgICAgICAgam9iVHlwZVN0YXR1c1BvbGxlciA9IHBvbGxlckZhY3RvcnkubmV3UG9sbGVyKGpvYlR5cGVTdGF0dXNSZXNvdXJjZSwgc2NhbGVDb25maWcucG9sbEludGVydmFscy5qb2JUeXBlU3RhdHVzKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBqb2JUeXBlU3RhdHVzUG9sbGVyLnByb21pc2UudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qdmFyIHJldHVybmRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlc29sdmVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYl90eXBlX3N0YXRzOiBbXVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ2V0VG90YWxKb2JUeXBlcygpOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5kYXRhLmpvYl90eXBlX3N0YXRzLnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIjogaSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWNvbl9jb2RlXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidmVyc2lvblwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJudW1fY29tcGxldGVkXCI6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgyMDAwMCAtIDEwMDAwICsgMSkpICsgMTAwMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm51bV9jYW5jZWxlZFwiOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwIC0gMjAgKyAxKSkgKyAyMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibnVtX2Vycm9yX0RBVEFcIjogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDkwMDAgLSAyMCArIDEpKSArIDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJudW1fZXJyb3JfU1lTVEVNXCI6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg5MDAwIC0gMjAgKyAxKSkgKyAyMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibnVtX2Vycm9yX0FMR09SSVRITVwiOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoOTAwMCAtIDIwICsgMSkpICsgMjBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSByZXR1cm5kYXRhOyovXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IEpvYlR5cGVTdGF0dXMudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvYlR5cGVTdGF0dXNQb2xsZXIuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYlR5cGVTdGF0dXNPbmNlOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYlR5cGVTdGF0dXNQYXJhbXMoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdqb2ItdHlwZXMvc3RhdHVzLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBKb2JUeXBlU3RhdHVzLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iVHlwZURldGFpbHM6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9iLXR5cGVzLycgKyBpZCArICcvJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoSm9iVHlwZURldGFpbHMudHJhbnNmb3JtZXIoZGF0YSkpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGVKb2JUeXBlOiBmdW5jdGlvbiAoZGF0YSl7XG4gICAgICAgICAgICAgICAgdmFyIHVwZGF0ZWRKb2JUeXBlID0gZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tYXBwaW5nczogZGF0YS5lcnJvcl9tYXBwaW5ncyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzX3BhdXNlZDogZGF0YS5pc19wYXVzZWRcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHZhciB1cGRhdGVkRGF0YSA9IHVwZGF0ZWRKb2JUeXBlKGRhdGEpO1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdqb2ItdHlwZXMvJyArIGRhdGEuaWQgKyAnLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BBVENIJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogdXBkYXRlZERhdGFcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKEpvYlR5cGVEZXRhaWxzLnRyYW5zZm9ybWVyKHJlc3VsdCkpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7ICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdsb2FkQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGxvY2F0aW9uLCBzY2FsZVNlcnZpY2UsIHN0YXRlU2VydmljZSwgbmF2U2VydmljZSwgbG9hZFNlcnZpY2UsIHVpR3JpZENvbnN0YW50cywgc2NhbGVDb25maWcsIHN1Ym5hdlNlcnZpY2UsIFF1ZXVlU3RhdHVzLCBncmlkRmFjdG9yeSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLnF1ZXVlU3RhdHVzRXJyb3IgPSBudWxsO1xuICAgICAgICB2bS5xdWV1ZVN0YXR1c0Vycm9yU3RhdHVzID0gbnVsbDtcbiAgICAgICAgdm0udG90YWxRdWV1ZWQgPSAwO1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmxvYWQ7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2xvYWQvcXVldWVkJyk7XG4gICAgICAgIFxuICAgICAgICB2YXIgam9ic1BhcmFtcyA9IHN0YXRlU2VydmljZS5nZXRKb2JzUGFyYW1zKCk7XG5cbiAgICAgICAgdm0uZ2V0UGFnZSA9IGZ1bmN0aW9uIChwYWdlTnVtYmVyLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBsb2FkU2VydmljZS5nZXRRdWV1ZVN0YXR1cyhwYWdlTnVtYmVyIC0gMSwgcGFnZVNpemUpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV3RGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3RGF0YS5wdXNoKGRhdGEuam9ic1tpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm1pblJvd3NUb1Nob3cgPSBuZXdEYXRhLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy52aXJ0dWFsaXphdGlvblRocmVzaG9sZCA9IG5ld0RhdGEubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBuZXdEYXRhO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdm0uc3RhdHVzID0gJ1VuYWJsZSB0byBsb2FkIHF1ZXVlIHN0YXR1czogJyArIGVycm9yLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcih2bS5zdGF0dXMpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucyA9IGdyaWRGYWN0b3J5LmRlZmF1bHRHcmlkT3B0aW9ucygpO1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZW5hYmxlU29ydGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiAnam9iX3R5cGUudGl0bGUnLFxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0pvYiBUeXBlJyxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPjxzcGFuIG5nLWJpbmQtaHRtbD1cInJvdy5lbnRpdHkuam9iX3R5cGUuZ2V0SWNvbigpXCI+PC9zcGFuPiB7eyByb3cuZW50aXR5LmpvYl90eXBlLnRpdGxlIH19PC9kaXY+J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgeyBmaWVsZDogJ2pvYl90eXBlLnZlcnNpb24nLCBkaXNwbGF5TmFtZTogJ1ZlcnNpb24nLCBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlIH0sXG4gICAgICAgICAgICAgICAgeyBmaWVsZDogJ2hpZ2hlc3RfcHJpb3JpdHknLCBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogJ2xvbmdlc3RRdWV1ZWQnLFxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0R1cmF0aW9uIG9mIExvbmdlc3QgUXVldWVkIEpvYicsXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHMgdGV4dC1yaWdodFwiPnt7IHJvdy5lbnRpdHkuZ2V0RHVyYXRpb24oKSB9fTwvZGl2PidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHsgZmllbGQ6ICdjb3VudCcsIGVuYWJsZUZpbHRlcmluZzogZmFsc2UgfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm9uUmVnaXN0ZXJBcGkgPSBmdW5jdGlvbiAoZ3JpZEFwaSkge1xuICAgICAgICAgICAgICAgIC8vc2V0IGdyaWRBcGkgb24gc2NvcGVcbiAgICAgICAgICAgICAgICB2bS5ncmlkQXBpID0gZ3JpZEFwaTtcbiAgICAgICAgICAgICAgICBncmlkQXBpLnNlbGVjdGlvbi5vbi5yb3dTZWxlY3Rpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0Sm9ic1BhcmFtcyh7am9iX3R5cGVfaWQ6IHJvdy5lbnRpdHkuam9iX3R5cGUuaWQsIHN0YXR1czogJ1FVRVVFRCcsIHBhZ2U6IGpvYnNQYXJhbXMucGFnZSwgcGFnZV9zaXplOiBqb2JzUGFyYW1zLnBhZ2Vfc2l6ZSwgb3JkZXI6IGpvYnNQYXJhbXMub3JkZXJ9KTtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9qb2JzJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZEFwaS5wYWdpbmF0aW9uLm9uLnBhZ2luYXRpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICB2bS5nZXRQYWdlKGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgIGxvYWRTZXJ2aWNlLmdldFF1ZXVlU3RhdHVzKDAsIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZSkudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMubWluUm93c1RvU2hvdyA9IHJlc3VsdC5yZXN1bHRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudmlydHVhbGl6YXRpb25UaHJlc2hvbGQgPSByZXN1bHQucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSByZXN1bHQucmVzdWx0cztcbiAgICAgICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudG90YWxJdGVtcyA9IHJlc3VsdC5yZXN1bHRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgdm0udG90YWxRdWV1ZWQgPSBfLnN1bShyZXN1bHQucmVzdWx0cywgJ2NvdW50Jyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdxdWV1ZSBzdGF0dXMgdXBkYXRlZCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzVGV4dCAmJiByZXN1bHQuc3RhdHVzVGV4dCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnF1ZXVlU3RhdHVzRXJyb3JTdGF0dXMgPSByZXN1bHQuc3RhdHVzVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2bS5xdWV1ZVN0YXR1c0Vycm9yID0gJ1VuYWJsZSB0byByZXRyaWV2ZSBxdWV1ZSBzdGF0dXMuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignbG9hZCcpO1xuICAgICAgICB9O1xuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdsb2FkRGVwdGhDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBuYXZTZXJ2aWNlLCBzY2FsZUNvbmZpZywgc3VibmF2U2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0uc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5sb2FkO1xuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdsb2FkL2RlcHRoJyk7XG5cbiAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignbG9hZCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ3F1ZXVlUnVubmluZ0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgc2NhbGVTZXJ2aWNlLCBzdGF0ZVNlcnZpY2UsIG5hdlNlcnZpY2UsIGpvYlNlcnZpY2UsIGdyaWRGYWN0b3J5LCB1aUdyaWRDb25zdGFudHMsIHNjYWxlQ29uZmlnLCBzdWJuYXZTZXJ2aWNlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIFxuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0ucnVubmluZ0pvYnNFcnJvciA9IG51bGw7XG4gICAgICAgIHZtLnJ1bm5pbmdKb2JzRXJyb3JTdGF0dXMgPSBudWxsO1xuICAgICAgICB2bS50b3RhbFJ1bm5pbmcgPSAwO1xuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmxvYWQ7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2xvYWQvcnVubmluZycpO1xuXG4gICAgICAgIHZhciBqb2JzUGFyYW1zID0gc3RhdGVTZXJ2aWNlLmdldEpvYnNQYXJhbXMoKTtcblxuICAgICAgICB2bS5nZXRQYWdlID0gZnVuY3Rpb24gKHBhZ2VOdW1iZXIsIHBhZ2VTaXplKXtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgam9iU2VydmljZS5nZXRSdW5uaW5nSm9ic09uY2UocGFnZU51bWJlciAtIDEsIHBhZ2VTaXplKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5ld0RhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplOyBpKyspe1xuICAgICAgICAgICAgICAgICAgICBuZXdEYXRhLnB1c2goZGF0YS5yZXN1bHRzW2ldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMubWluUm93c1RvU2hvdyA9IG5ld0RhdGEubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnZpcnR1YWxpemF0aW9uVGhyZXNob2xkID0gbmV3RGF0YS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuZGF0YSA9IG5ld0RhdGE7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB2bS5zdGF0dXMgPSAnVW5hYmxlIHRvIGxvYWQgcXVldWUgcnVubmluZyBzdGF0dXM6ICcgKyBlcnJvci5tZXNzYWdlO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3Iodm0uc3RhdHVzKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMgPSBncmlkRmFjdG9yeS5kZWZhdWx0R3JpZE9wdGlvbnMoKTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmVuYWJsZVNvcnRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmNvbHVtbkRlZnMgPSBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogJ3RpdGxlJyxcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdKb2IgVHlwZScsXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj48c3BhbiBuZy1iaW5kLWh0bWw9XCJyb3cuZW50aXR5LmdldEljb24oKVwiPjwvc3Bhbj4ge3sgcm93LmVudGl0eS5qb2JfdHlwZS50aXRsZSB9fTwvZGl2PidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtmaWVsZDogJ2pvYl90eXBlLnZlcnNpb24nLCBkaXNwbGF5TmFtZTogJ1ZlcnNpb24nLCBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlfSxcbiAgICAgICAgICAgICAgICB7ZmllbGQ6ICdjb3VudCcsIGRpc3BsYXlOYW1lOiAnTnVtYmVyIG9mIEpvYnMnLCBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiAnbG9uZ2VzdFJ1bm5pbmcnLFxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0R1cmF0aW9uIG9mIExvbmdlc3QgUnVubmluZyBKb2InLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzIHRleHQtcmlnaHRcIj57eyByb3cuZW50aXR5LmdldER1cmF0aW9uKCkgfX08L2Rpdj4nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcbiAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm9uUmVnaXN0ZXJBcGkgPSBmdW5jdGlvbiAoZ3JpZEFwaSkge1xuICAgICAgICAgICAgICAgIC8vIHNldCBncmlkQXBpIG9uIHNjb3BlXG4gICAgICAgICAgICAgICAgdm0uZ3JpZEFwaSA9IGdyaWRBcGk7XG4gICAgICAgICAgICAgICAgZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldEpvYnNQYXJhbXMoe2pvYl90eXBlX2lkOiByb3cuZW50aXR5LmpvYl90eXBlLmlkLCBzdGF0dXM6ICdSVU5OSU5HJywgcGFnZTogam9ic1BhcmFtcy5wYWdlLCBwYWdlX3NpemU6IGpvYnNQYXJhbXMucGFnZV9zaXplLCBvcmRlcjogam9ic1BhcmFtcy5vcmRlcn0pO1xuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2pvYnMnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2bS5ncmlkQXBpLnBhZ2luYXRpb24ub24ucGFnaW5hdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoY3VycmVudFBhZ2UsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdldFBhZ2UoY3VycmVudFBhZ2UsIHBhZ2VTaXplKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGpvYlNlcnZpY2UuZ2V0UnVubmluZ0pvYnMoMCwgdm0uZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplKS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm1pblJvd3NUb1Nob3cgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy52aXJ0dWFsaXphdGlvblRocmVzaG9sZCA9IGRhdGEucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnRvdGFsSXRlbXMgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB2bS50b3RhbFJ1bm5pbmcgPSBfLnN1bShkYXRhLnJlc3VsdHMsICdjb3VudCcpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncnVubmluZyBqb2JzIHVwZGF0ZWQnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXNUZXh0ICYmIGRhdGEuc3RhdHVzVGV4dCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJ1bm5pbmdKb2JzRXJyb3JTdGF0dXMgPSBkYXRhLnN0YXR1c1RleHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdm0ucnVubmluZ0pvYnNFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgcnVubmluZyBqb2JzLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignbG9hZCcpO1xuICAgICAgICB9O1xuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdRdWV1ZVN0YXR1cycsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBKb2JUeXBlKSB7XG4gICAgICAgIHZhciBRdWV1ZVN0YXR1cyA9IGZ1bmN0aW9uIChqb2JfdHlwZSwgY291bnQsIGxvbmdlc3RfcXVldWVkLCBoaWdoZXN0X3ByaW9yaXR5KSB7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlID0gSm9iVHlwZS50cmFuc2Zvcm1lcihqb2JfdHlwZSk7XG4gICAgICAgICAgICB0aGlzLmNvdW50ID0gY291bnQ7XG4gICAgICAgICAgICB0aGlzLmxvbmdlc3RfcXVldWVkID0gbG9uZ2VzdF9xdWV1ZWQ7XG4gICAgICAgICAgICB0aGlzLmhpZ2hlc3RfcHJpb3JpdHkgPSBoaWdoZXN0X3ByaW9yaXR5O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIFF1ZXVlU3RhdHVzLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldEljb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5qb2JfdHlwZS5pY29uX2NvZGUgPyAnPGkgY2xhc3M9XCJmYVwiPiYjeCcgKyB0aGlzLmpvYl90eXBlLmljb25fY29kZSArICc8L2k+JyA6ICc8aSBjbGFzcz1cImZhXCI+JiN4JyArIHNjYWxlQ29uZmlnLmRlZmF1bHRJY29uQ29kZSArICc8L2k+JztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXREdXJhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRHVyYXRpb24odGhpcy5sb25nZXN0X3F1ZXVlZCwgbW9tZW50LnV0YygpLnRvSVNPU3RyaW5nKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBRdWV1ZVN0YXR1cy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUXVldWVTdGF0dXMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY291bnQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubG9uZ2VzdF9xdWV1ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaGlnaGVzdF9wcmlvcml0eVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFF1ZXVlU3RhdHVzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUXVldWVTdGF0dXMudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUXVldWVTdGF0dXMuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFF1ZXVlU3RhdHVzLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBRdWV1ZVN0YXR1cztcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ2xvYWRTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHAsICRxLCAkcmVzb3VyY2UsIHNjYWxlQ29uZmlnLCBwb2xsZXIsIHBvbGxlckZhY3RvcnksIFF1ZXVlU3RhdHVzKSB7XG4gICAgICAgIHZhciBnZXRKb2JMb2FkUGFyYW1zID0gZnVuY3Rpb24gKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQsIG9yZGVyLCBzdGF0dXMsIGpvYl90eXBlX2lkLCBqb2JfdHlwZV9uYW1lLCBqb2JfdHlwZV9jYXRlZ29yeSwgdXJsKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgZW5kZWQ6IGVuZGVkLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2lkOiBqb2JfdHlwZV9pZCxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9uYW1lOiBqb2JfdHlwZV9uYW1lLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2NhdGVnb3J5OiBqb2JfdHlwZV9jYXRlZ29yeSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IDEwMDAsXG4gICAgICAgICAgICAgICAgdXJsOiB1cmxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFJlcXVldWVKb2JzUGFyYW1zID0gZnVuY3Rpb24gKHN0YXJ0ZWQsIGVuZGVkLCBqb2Jfc3RhdHVzLCBqb2JfdHlwZV9pZHMsIGpvYl90eXBlX25hbWVzLCBqb2JfdHlwZV9jYXRlZ29yaWVzLCBwcmlvcml0eSwgdXJsKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgZW5kZWQ6IGVuZGVkLFxuICAgICAgICAgICAgICAgIGpvYl9zdGF0dXM6IGpvYl9zdGF0dXMsXG4gICAgICAgICAgICAgICAgam9iX2lkczogam9iX2lkcyxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9pZHM6IGpvYl90eXBlX2lkcyxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9uYW1lczogam9iX3R5cGVfbmFtZXMsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfY2F0ZWdvcmllczogam9iX3R5cGVfY2F0ZWdvcmllcyxcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogcHJpb3JpdHksXG4gICAgICAgICAgICAgICAgdXJsOiB1cmxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldFF1ZXVlU3RhdHVzOiBmdW5jdGlvbiAocGFnZU51bWJlciwgcGFnZVNpemUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgICAgICBwYWdlX251bWJlcjogcGFnZU51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgcGFnZV9zaXplOiBwYWdlU2l6ZVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgcXVldWVTdGF0dXNSZXNvdXJjZSA9ICRyZXNvdXJjZShzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdxdWV1ZS9zdGF0dXMvJywgcGFyYW1zKSxcbiAgICAgICAgICAgICAgICAgICAgcXVldWVTdGF0dXNQb2xsZXIgPSBwb2xsZXJGYWN0b3J5Lm5ld1BvbGxlcihxdWV1ZVN0YXR1c1Jlc291cmNlLCBzY2FsZUNvbmZpZy5wb2xsSW50ZXJ2YWxzLnF1ZXVlU3RhdHVzKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBxdWV1ZVN0YXR1c1BvbGxlci5wcm9taXNlLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnJlc3VsdHMgPSBRdWV1ZVN0YXR1cy50cmFuc2Zvcm1lcihyZXN1bHQucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZVN0YXR1c1BvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRRdWV1ZVN0YXR1c09uY2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAncXVldWUvc3RhdHVzLycpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gUXVldWVTdGF0dXMudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlcXVldWVKb2JzOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldFJlcXVldWVKb2JzUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnVybCA9IHBhcmFtcy51cmwgPyBwYXJhbXMudXJsIDogc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAncXVldWUvcmVxdWV1ZS1qb2JzLyc7XG5cbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHBhcmFtcy51cmwsIHBhcmFtcykuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JMb2FkOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYkxvYWRQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMudXJsID0gcGFyYW1zLnVybCA/IHBhcmFtcy51cmwgOiBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdsb2FkLyc7XG5cbiAgICAgICAgICAgICAgICB2YXIgam9iTG9hZFJlc291cmNlID0gJHJlc291cmNlKHBhcmFtcy51cmwsIHBhcmFtcyksXG4gICAgICAgICAgICAgICAgICAgIGpvYkxvYWRQb2xsZXIgPSBwb2xsZXJGYWN0b3J5Lm5ld1BvbGxlcihqb2JMb2FkUmVzb3VyY2UsIHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMuam9iTG9hZCk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gam9iTG9hZFBvbGxlci5wcm9taXNlLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgam9iTG9hZFBvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iTG9hZE9uY2U6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMgPSBwYXJhbXMgfHwgZ2V0Sm9iTG9hZFBhcmFtcygpO1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBwYXJhbXMudXJsID8gcGFyYW1zLnVybCA6IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2xvYWQvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ21ldHJpY3NDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBuYXZTZXJ2aWNlLCBtZXRyaWNzU2VydmljZSwgbW9tZW50KSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXMsXG4gICAgICAgICAgICBjaGFydCA9IG51bGwsXG4gICAgICAgICAgICBjb2xBcnIgPSBbXSxcbiAgICAgICAgICAgIGNvbE5hbWVzID0ge30sXG4gICAgICAgICAgICB4QXJyID0gW10sXG4gICAgICAgICAgICByZW1vdmVJZHMgPSBbXSxcbiAgICAgICAgICAgIHlVbml0cyA9IFtdO1xuXG4gICAgICAgIHZtLl8gPSBfO1xuICAgICAgICB2bS5tb21lbnQgPSBtb21lbnQ7XG4gICAgICAgIHZtLmxvYWRpbmdNZXRyaWNzID0gZmFsc2U7XG4gICAgICAgIHZtLmNoYXJ0QXJyID0gW107XG4gICAgICAgIHZtLmNoYXJ0RGF0YSA9IFtdO1xuICAgICAgICB2bS5jaGFydFN0eWxlID0gJyc7XG4gICAgICAgIHZtLnNlbGVjdGVkRGF0YVR5cGUgPSB7fTtcbiAgICAgICAgdm0uaW5wdXRTdGFydERhdGUgPSBtb21lbnQudXRjKCkuc3VidHJhY3QoMSwgJ00nKS50b0RhdGUoKTtcbiAgICAgICAgdm0uaW5wdXRFbmREYXRlID0gbW9tZW50LnV0YygpLnRvRGF0ZSgpO1xuICAgICAgICB2bS5vcGVuSW5wdXRTdGFydCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHZtLmlucHV0U3RhcnRPcGVuZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICB2bS5pbnB1dFN0YXJ0T3BlbmVkID0gZmFsc2U7XG4gICAgICAgIHZtLm9wZW5JbnB1dEVuZCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHZtLmlucHV0RW5kT3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgdm0uaW5wdXRFbmRPcGVuZWQgPSBmYWxzZTtcbiAgICAgICAgdm0uZGF0ZU1vZGVsT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRpbWV6b25lOiAnKzAwMCdcbiAgICAgICAgfTtcbiAgICAgICAgdm0uZGF0YVR5cGVGaWx0ZXJUZXh0ID0gJyc7XG4gICAgICAgIHZtLmZpbHRlcnNBcHBsaWVkID0gW107XG4gICAgICAgIHZtLmZpbHRlcmVkQ2hvaWNlcyA9IFtdO1xuICAgICAgICB2bS5maWx0ZXJlZENob2ljZXNPcHRpb25zID0gW107XG4gICAgICAgIHZtLnNlbGVjdGVkTWV0cmljcyA9IFtdO1xuICAgICAgICB2bS5jb2x1bW5Hcm91cHNPcHRpb25zID0gW107XG4gICAgICAgIHZtLmNvbHVtbnMgPSBbXTtcbiAgICAgICAgdm0uZ3JvdXBzID0gW107XG4gICAgICAgIHZtLmNoYXJ0VGl0bGUgPSAnJztcbiAgICAgICAgdm0uY2hhcnREaXNwbGF5ID0gJ3N0YWNrZWQnO1xuICAgICAgICB2bS5zdGFja2VkQ2xhc3MgPSAnYnRuLXByaW1hcnknO1xuICAgICAgICB2bS5ncm91cGVkQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICB2bS5zdWJjaGFydENsYXNzID0gJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgdm0uc3ViY2hhcnRFbmFibGVkID0gZmFsc2U7XG4gICAgICAgIHZtLmNoYXJ0VHlwZSA9ICdiYXInO1xuICAgICAgICB2bS5jaGFydFR5cGVEaXNwbGF5ID0gJ0Jhcic7XG4gICAgICAgIHZtLmJhckNsYXNzID0gJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgdm0uYXJlYUNsYXNzID0gJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgdm0ubGluZUNsYXNzID0gJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgdm0uc3BsaW5lQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICB2bS5zY2F0dGVyQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuXG4gICAgICAgIHZtLmdldFBsb3REYXRhUGFyYW1zID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBudWxsLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogbnVsbCxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBvYmouc3RhcnRlZCxcbiAgICAgICAgICAgICAgICBlbmRlZDogb2JqLmVuZGVkLFxuICAgICAgICAgICAgICAgIGNob2ljZV9pZDogb2JqLmNob2ljZV9pZCxcbiAgICAgICAgICAgICAgICBjb2x1bW46IG9iai5jb2x1bW4sXG4gICAgICAgICAgICAgICAgZ3JvdXA6IG9iai5ncm91cCxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogb2JqLmRhdGFUeXBlLm5hbWVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ucmVzZXRTZWxlY3Rpb25zID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uaW5wdXRTdGFydERhdGUgPSBtb21lbnQudXRjKCkuc3VidHJhY3QoMSwgJ00nKS50b0RhdGUoKTtcbiAgICAgICAgICAgIHZtLmlucHV0RW5kRGF0ZSA9IG1vbWVudC51dGMoKS50b0RhdGUoKTtcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkRGF0YVR5cGUgPSB7fTtcbiAgICAgICAgICAgIHZtLmNoYW5nZURhdGFUeXBlU2VsZWN0aW9uKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlQ2hhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5jaGFydERhdGEgPSBbXTtcbiAgICAgICAgICAgIGlmICh2bS5jaGFydEFyci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAvLyBub3RoaW5nIHRvIHNob3cgb24gY2hhcnRcbiAgICAgICAgICAgICAgICBjaGFydC5kZXN0cm95KCk7XG4gICAgICAgICAgICAgICAgY2hhcnQgPSBudWxsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgY2FsbEluaXQgPSBfLmFmdGVyKHZtLmNoYXJ0QXJyLmxlbmd0aCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IGluaXRDaGFydCBhZnRlciB0aGlzIGZ1bmN0aW9uIGhhcyBiZWVuIGNhbGxlZCBmb3IgYWxsIGRhdGFzZXRzIGluIGNoYXJ0QXJyXG4gICAgICAgICAgICAgICAgICAgIHZtLmxvYWRpbmdNZXRyaWNzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHZtLmluaXRDaGFydCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmNoYXJ0QXJyLCBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSB2bS5nZXRQbG90RGF0YVBhcmFtcyhvYmopO1xuICAgICAgICAgICAgICAgICAgICBtZXRyaWNzU2VydmljZS5nZXRQbG90RGF0YShwYXJhbXMpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9tZXRyaWNzU2VydmljZS5nZXRHZW5lcmF0ZWRQbG90RGF0YSh7cXVlcnk6IG9iaiwgcGFyYW1zOiBwYXJhbXN9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5jaGFydERhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnk6IG9iaixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiBkYXRhLnJlc3VsdHNcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbEluaXQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5sb2FkaW5nTWV0cmljcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyWydlcnJvciddKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uYWRkVG9DaGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmNoYXJ0QXJyID0gW107IC8vIGNvbW1lbnQgdGhpcyBvdXQgaWYgYWxsb3dpbmcgbXVsdGlwbGUgYWRkc1xuICAgICAgICAgICAgdm0ubG9hZGluZ01ldHJpY3MgPSB0cnVlO1xuICAgICAgICAgICAgdmFyIGZpbHRlcmVkQ2hvaWNlcyA9IFtdLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkQ29sdW1ucyA9IFtdO1xuICAgICAgICAgICAgLy8gZmluZCB0aGUgZmlsdGVyIG9iamVjdCBhc3NvY2lhdGVkIHdpdGggdGhlIGNob3NlbiBmaWx0ZXIgSURzXG4gICAgICAgICAgICBfLmZvckVhY2godm0uZmlsdGVyc0FwcGxpZWQsIGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgIGZpbHRlcmVkQ2hvaWNlcy5wdXNoKF8uZmluZCh2bS5maWx0ZXJlZENob2ljZXMsIHsgaWQ6IHBhcnNlSW50KGlkKSB9KSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkodm0uc2VsZWN0ZWRNZXRyaWNzKSkge1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5zZWxlY3RlZE1ldHJpY3MsIGZ1bmN0aW9uIChtZXRyaWMpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRDb2x1bW5zLnB1c2goXy5maW5kKHZtLmNvbHVtbnMsIHsgbmFtZTogbWV0cmljIH0pKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRDb2x1bW5zLnB1c2goXy5maW5kKHZtLmNvbHVtbnMsIHsgbmFtZTogdm0uc2VsZWN0ZWRNZXRyaWNzIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLmNoYXJ0QXJyLnB1c2goe1xuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHZtLmlucHV0U3RhcnREYXRlLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgZW5kZWQ6IHZtLmlucHV0RW5kRGF0ZS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNob2ljZV9pZDogdm0uZmlsdGVyc0FwcGxpZWQsXG4gICAgICAgICAgICAgICAgY29sdW1uOiBfLnBsdWNrKHNlbGVjdGVkQ29sdW1ucywgJ25hbWUnKSxcbiAgICAgICAgICAgICAgICBncm91cDogbnVsbCxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogdm0uc2VsZWN0ZWREYXRhVHlwZSxcbiAgICAgICAgICAgICAgICBmaWx0ZXJzQXBwbGllZDogZmlsdGVyZWRDaG9pY2VzLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkTWV0cmljczogc2VsZWN0ZWRDb2x1bW5zXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZtLnVwZGF0ZUNoYXJ0KCk7XG4gICAgICAgICAgICAvL3ZtLnJlc2V0U2VsZWN0aW9ucygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmRlbGV0ZUZyb21DaGFydCA9IGZ1bmN0aW9uIChvYmpUb0RlbGV0ZSkge1xuICAgICAgICAgICAgXy5yZW1vdmUodm0uY2hhcnRBcnIsIGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkob2JqKSA9PT0gSlNPTi5zdHJpbmdpZnkob2JqVG9EZWxldGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS51cGRhdGVDaGFydCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdldEZpbHRlck9wdGlvbnMgPSBmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgICAgIHJldHVybiBfLnVuaXEoXy5wbHVjayh2bS5maWx0ZXJlZENob2ljZXMsIHBhcmFtKSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uY2hhbmdlRGF0YVR5cGVTZWxlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyByZXNldCBvcHRpb25zXG4gICAgICAgICAgICB2bS5maWx0ZXJzQXBwbGllZCA9IFtdO1xuICAgICAgICAgICAgdm0uc2VsZWN0ZWREYXRhVHlwZU9wdGlvbnMgPSBbXTtcbiAgICAgICAgICAgIHZtLmRhdGFUeXBlRmlsdGVyVGV4dCA9ICcnO1xuICAgICAgICAgICAgdm0uc2VsZWN0ZWRNZXRyaWNzID0gW107XG4gICAgICAgICAgICB2bS5jb2x1bW5zID0gW107XG5cbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWREYXRhVHlwZS5uYW1lIHx8IHZtLnNlbGVjdGVkRGF0YVR5cGUubmFtZSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZERhdGFUeXBlID0ge307XG4gICAgICAgICAgICAgICAgdm0uZ2V0RGF0YVR5cGVzKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLmdldERhdGFUeXBlT3B0aW9ucyh2bS5zZWxlY3RlZERhdGFUeXBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5hcmVGaWx0ZXJzQXBwbGllZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB2bS5maWx0ZXJzQXBwbGllZC5sZW5ndGggPiAwO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUNoYXJ0RGlzcGxheSA9IGZ1bmN0aW9uIChkaXNwbGF5KSB7XG4gICAgICAgICAgICB2bS5jaGFydERpc3BsYXkgPSBkaXNwbGF5O1xuICAgICAgICAgICAgdm0uc3RhY2tlZENsYXNzID0gZGlzcGxheSA9PT0gJ3N0YWNrZWQnID8gJ2J0bi1wcmltYXJ5JyA6ICdidG4tZGVmYXVsdCc7XG4gICAgICAgICAgICB2bS5ncm91cGVkQ2xhc3MgPSBkaXNwbGF5ID09PSAnZ3JvdXBlZCcgPyAnYnRuLXByaW1hcnknIDogJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgICAgIHZtLmluaXRDaGFydCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUNoYXJ0VHlwZSA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgICAgICB2bS5jaGFydFR5cGUgPSB0eXBlO1xuICAgICAgICAgICAgdm0uY2hhcnRUeXBlRGlzcGxheSA9IF8uY2FwaXRhbGl6ZSh0eXBlKTtcbiAgICAgICAgICAgIHZtLmJhckNsYXNzID0gdHlwZSA9PT0gJ2JhcicgPyAnYnRuLXByaW1hcnknIDogJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgICAgIHZtLmFyZWFDbGFzcyA9IHR5cGUgPT09ICdhcmVhJyA/ICdidG4tcHJpbWFyeScgOiAnYnRuLWRlZmF1bHQnO1xuICAgICAgICAgICAgdm0ubGluZUNsYXNzID0gdHlwZSA9PT0gJ2xpbmUnID8gJ2J0bi1wcmltYXJ5JyA6ICdidG4tZGVmYXVsdCc7XG4gICAgICAgICAgICB2bS5zcGxpbmVDbGFzcyA9IHR5cGUgPT09ICdzcGxpbmUnID8gJ2J0bi1wcmltYXJ5JyA6ICdidG4tZGVmYXVsdCc7XG4gICAgICAgICAgICB2bS5zY2F0dGVyQ2xhc3MgPSB0eXBlID09PSAnc2NhdHRlcicgPyAnYnRuLXByaW1hcnknIDogJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgICAgIHZtLmluaXRDaGFydCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnRvZ2dsZVN1YmNoYXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uc3ViY2hhcnRFbmFibGVkID0gIXZtLnN1YmNoYXJ0RW5hYmxlZDtcbiAgICAgICAgICAgIGlmICh2bS5zdWJjaGFydEVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICB2bS5zdWJjaGFydENsYXNzID0gJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdm0uc3ViY2hhcnRDbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ21ldHJpY3MnKTtcbiAgICAgICAgICAgIHZtLmdldERhdGFUeXBlcygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdldERhdGFUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG1ldHJpY3NTZXJ2aWNlLmdldERhdGFUeXBlcygpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHZtLmF2YWlsYWJsZURhdGFUeXBlcyA9IHJlc3VsdC5yZXN1bHRzO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5nZXREYXRhVHlwZSA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgbWV0cmljc1NlcnZpY2UuZ2V0RGF0YVR5cGVNZXRyaWNzKGlkKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZERhdGFUeXBlQXZhaWxhYmxlTWV0cmljcyA9IHJlc3VsdC5tZXRyaWNzO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ2V0RGF0YVR5cGVPcHRpb25zID0gZnVuY3Rpb24gKGRhdGFUeXBlKSB7XG4gICAgICAgICAgICBtZXRyaWNzU2VydmljZS5nZXREYXRhVHlwZU9wdGlvbnMoZGF0YVR5cGUubmFtZSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWREYXRhVHlwZU9wdGlvbnMgPSByZXN1bHQ7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHJlc3VsdC5maWx0ZXJzLCBmdW5jdGlvbiAoZmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmRhdGFUeXBlRmlsdGVyVGV4dCA9IHZtLmRhdGFUeXBlRmlsdGVyVGV4dC5sZW5ndGggPT09IDAgPyBfLmNhcGl0YWxpemUoZmlsdGVyLnBhcmFtKSA6IHZtLmRhdGFUeXBlRmlsdGVyVGV4dCArICcsICcgKyBfLmNhcGl0YWxpemUoZmlsdGVyLnBhcmFtKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJlZENob2ljZXMgPSBfLnNvcnRCeU9yZGVyKHJlc3VsdC5jaG9pY2VzLCBbJ3RpdGxlJywndmVyc2lvbiddLCBbJ2FzYycsJ2FzYyddKTtcbiAgICAgICAgICAgICAgICAvLyBmb3JtYXQgZmlsdGVyZWRDaG9pY2VzIGZvciB1c2Ugd2l0aCBtdWx0aXNlbGVjdCBkaXJlY3RpdmVcbiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyZWRDaG9pY2VzT3B0aW9ucyA9IFtdO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5maWx0ZXJlZENob2ljZXMsIGZ1bmN0aW9uIChjaG9pY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRDaG9pY2VzT3B0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBjaG9pY2UudmVyc2lvbiA/IGNob2ljZS50aXRsZSArICcgJyArIGNob2ljZS52ZXJzaW9uIDogY2hvaWNlLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGNob2ljZS52ZXJzaW9uID8gY2hvaWNlLnRpdGxlICsgJyAnICsgY2hvaWNlLnZlcnNpb24gOiBjaG9pY2UudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY2hvaWNlLmlkXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlcmVkQ2hvaWNlc09wdGlvbnMgPSBmaWx0ZXJlZENob2ljZXNPcHRpb25zO1xuICAgICAgICAgICAgICAgIHZtLmNvbHVtbnMgPSBfLnNvcnRCeU9yZGVyKHJlc3VsdC5jb2x1bW5zLCBbJ3RpdGxlJ10sIFsnYXNjJ10pO1xuICAgICAgICAgICAgICAgIHZtLmdyb3VwcyA9IHJlc3VsdC5ncm91cHM7XG5cbiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYW4gYXJyYXkgb2Ygb2JqZWN0cyBjb250YWluaW5nIGdyb3VwZWQgY29sdW1uc1xuICAgICAgICAgICAgICAgIHZhciBjb2x1bW5Hcm91cHNPcHRpb25zID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbkdyb3VwcyA9IF8ucGFpcnMoXy5ncm91cEJ5KHJlc3VsdC5jb2x1bW5zLCAnZ3JvdXAnKSk7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKGNvbHVtbkdyb3VwcywgZnVuY3Rpb24gKGdyb3VwKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogXy5maW5kKHZtLmdyb3VwcywgeyBuYW1lOiBncm91cFswXSB9KS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goZ3JvdXBbMV0sIGZ1bmN0aW9uIChjb2x1bW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogY29sdW1uLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBjb2x1bW4udGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGNvbHVtbi5uYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uLmNoaWxkcmVuLnB1c2goY2hpbGQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uR3JvdXBzT3B0aW9ucy5wdXNoKG9wdGlvbik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29sdW1uR3JvdXBzT3B0aW9ucy51bnNoaWZ0KHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdOb25lIFNlbGVjdGVkJyxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdOb25lIFNlbGVjdGVkJyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICcnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0uY29sdW1uR3JvdXBzT3B0aW9ucyA9IGNvbHVtbkdyb3Vwc09wdGlvbnM7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3Ipe1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmlucHV0RW5kRGF0ZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2codmFsdWUpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHNldCB1cCBjaGFydFxuICAgICAgICB2bS5pbml0Q2hhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBtYXJrIGFueSBleGlzdGluZyBkYXRhIGZvciByZW1vdmFsXG4gICAgICAgICAgICAvLyBjb21wYXJlIGN1cnJDb2xzIChjb2x1bW5zIGN1cnJlbnRseSBpbiB0aGUgY2hhcnQpIHdpdGggZGlzcGxheUNvbHMgKGNvbHVtbnMgdG8gZGlzcGxheSlcbiAgICAgICAgICAgIHJlbW92ZUlkcyA9IFtdO1xuICAgICAgICAgICAgdmFyIGN1cnJDb2xzID0gW10sXG4gICAgICAgICAgICAgICAgZGlzcGxheUNvbHMgPSBbXTtcbiAgICAgICAgICAgIF8uZm9yRWFjaChjb2xBcnIsIGZ1bmN0aW9uIChjb2wsIGlkeCkge1xuICAgICAgICAgICAgICAgIGlmIChpZHggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJDb2xzLnB1c2goY29sWzBdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5jaGFydERhdGEsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheUNvbHMgPSBkaXNwbGF5Q29scy5jb25jYXQoXy5wbHVjayhkLnF1ZXJ5LmZpbHRlcnNBcHBsaWVkLCAnbmFtZScpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIHRoZSBleGFjdCBkaWZmZXJlbmNlcyBiZXR3ZWVuIGN1cnJDb2xzIGFuZCBkaXNwbGF5Q29sc1xuICAgICAgICAgICAgLy8gaWYgbm9uZSBhcmUgZm91bmQsIHRoZW4gcmVtb3ZlSWRzIHN0YXlzIGVtcHR5XG4gICAgICAgICAgICBfLmZvckVhY2goY3VyckNvbHMsIGZ1bmN0aW9uIChjdXJyQ29sKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRpc3BsYXlDb2wgPSBfLmZpbmQoZGlzcGxheUNvbHMsIGZ1bmN0aW9uIChkQ29sKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkQ29sID09PSBjdXJyQ29sO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICghZGlzcGxheUNvbCkge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVJZHMucHVzaChjdXJyQ29sKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gaW5pdCB3aXRoIG5ldyBkYXRhXG4gICAgICAgICAgICBjb2xBcnIgPSBbXTtcbiAgICAgICAgICAgIHhBcnIgPSBbXTtcbiAgICAgICAgICAgIGNvbE5hbWVzID0ge307XG5cbiAgICAgICAgICAgIC8vIGNyZWF0ZSB4QXJyXG4gICAgICAgICAgICB2YXIgbnVtRGF5cyA9IG1vbWVudC51dGModm0uaW5wdXRFbmREYXRlKS5lbmRPZignZCcpLmRpZmYobW9tZW50LnV0Yyh2bS5pbnB1dFN0YXJ0RGF0ZS50b0lTT1N0cmluZygpKS5zdGFydE9mKCdkJyksICdkJykgKyAxOyAvLyBhZGQgMSB0byBpbmNsdWRlIHN0YXJ0aW5nIGRheSBpbiBjb3VudFxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1EYXlzOyBpKyspIHtcbiAgICAgICAgICAgICAgICB4QXJyLnB1c2gobW9tZW50LnV0Yyh2bS5pbnB1dFN0YXJ0RGF0ZS50b0lTT1N0cmluZygpKS5zdGFydE9mKCdkJykuYWRkKGksICdkJykudG9EYXRlKCkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBpdGVyYXRlIG92ZXIgZGF0YXR5cGVzIGFuZCBhZGQgdmFsdWVzIHRvIGNvbEFyclxuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmNoYXJ0RGF0YSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWVBcnIgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgcXVlcnkgPSBkYXRhLnF1ZXJ5LFxuICAgICAgICAgICAgICAgICAgICBxdWVyeUZpbHRlciA9IHt9LFxuICAgICAgICAgICAgICAgICAgICBxdWVyeURhdGVzID0gW107XG5cbiAgICAgICAgICAgICAgICB5VW5pdHMgPSBfLnBsdWNrKHF1ZXJ5LnNlbGVjdGVkTWV0cmljcywgJ3VuaXRzJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAocXVlcnkuZmlsdGVyc0FwcGxpZWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBmaWx0ZXJzIHdlcmUgYXBwbGllZCwgc28gYnVpbGQgZGF0YSBzb3VyY2UgYWNjb3JkaW5nbHlcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGRhdGEucmVzdWx0cywgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC52YWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlcyBmb3IgYWxsIGZpbHRlcnMgYXJlIHJldHVybmVkIGluIG9uZSBhcnJheSBvZiBhcnJheXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc28gZ3JvdXAgcmVzdWx0cyBieSBpZCB0byBpc29sYXRlIGZpbHRlciB2YWx1ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ3JvdXBlZFJlc3VsdCA9IF8uZ3JvdXBCeShyZXN1bHQudmFsdWVzLCAnaWQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0T2JqID0ge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcklkcyA9IF8ucGx1Y2socXVlcnkuZmlsdGVyc0FwcGxpZWQsICdpZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRyeSB0byBnZXQgZWFjaCBmaWx0ZXIgaWQgZnJvbSBncm91cGVkUmVzdWx0LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIGl0J3MgdW5kZWZpbmVkLCBhbiBlbXB0eSBhcnJheSB3aWxsIGJlIHJldHVybmVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBhbGxvd3MgYSB6ZXJvZWQgYXJyYXkgdG8gYXBwZWFyIGluIHRoZSBjaGFydCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzaW5jZSB3ZSB3YW50IHRvIGluY2x1ZGUgYWxsIGZpbHRlcnMgc2VsZWN0ZWQgYnkgdGhlIHVzZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZWdhcmRsZXNzIG9mIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlcklkcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gbW9yZSB0aGFuIG9uZSBmaWx0ZXIgaXMgcmVxdWVzdGVkLCB0aGVuIGFuIGlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHZhbHVlIGlzIHByZXNlbnQgd2l0aGluIGRhdGEucmVzdWx0c1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goZmlsdGVySWRzLCBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdE9ialtpZF0gPSBfLmdldChncm91cGVkUmVzdWx0LCBpZCwgW10pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aGVuIG9uZSBmaWx0ZXIgaXMgcmVxdWVzdGVkLCBubyBpZCB2YWx1ZSBpcyBpbmNsdWRlZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpbiBkYXRhLnJlc3VsdHMsIHNvIGJ1aWxkIHJlc3VsdE9iaiB3aXRoIHRoZSBvdGhlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpbmZvIHdlIGhhdmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0T2JqW3F1ZXJ5LmNob2ljZV9pZFswXV0gPSBfLnBhaXJzKGdyb3VwZWRSZXN1bHQpWzBdWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goXy5wYWlycyhyZXN1bHRPYmopLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZUFyciA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkWzBdIHdpbGwgYmUgY2hvaWNlIGlkLCBkWzFdIHdpbGwgYmUgdmFsdWVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIG9ubHkgb25lIGZpbHRlciB3YXMgc2VsZWN0ZWQsIGRbMF0gd2lsbCByZXR1cm4gYXMgc3RyaW5nICd1bmRlZmluZWQnIHNpbmNlIG5vIGlkIGlzIGluY2x1ZGVkIGluIHRoaXMgY2FzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeUZpbHRlciA9IGRbMF0gPT09ICd1bmRlZmluZWQnID8gcXVlcnkuZmlsdGVyc0FwcGxpZWRbMF0gOiBfLmZpbmQocXVlcnkuZmlsdGVyc0FwcGxpZWQsIHtpZDogcGFyc2VJbnQoZFswXSl9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlEYXRlcyA9IGRbMV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHJlc3VsdCB2YWx1ZXMgdG8gdmFsdWVBcnJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKHhBcnIsIGZ1bmN0aW9uICh4RGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlT2JqID0gXy5maW5kKHF1ZXJ5RGF0ZXMsIGZ1bmN0aW9uIChxRGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQudXRjKHFEYXRlLmRhdGUpLmlzU2FtZSh4RGF0ZSwgJ2RheScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBwdXNoIDAgaWYgZGF0YSBmb3IgeERhdGUgaXMgbm90IHByZXNlbnQgaW4gcXVlcnlEYXRlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVBcnIucHVzaCh2YWx1ZU9iaiA/IHZhbHVlT2JqLnZhbHVlIDogMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByZXBlbmQgdmFsdWVBcnIgd2l0aCBmaWx0ZXIgdGl0bGUsIGFuZCBwdXNoIG9udG8gY29sQXJyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlQXJyLnVuc2hpZnQocXVlcnlGaWx0ZXIubmFtZSArIHF1ZXJ5RmlsdGVyLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sTmFtZXNbcXVlcnlGaWx0ZXIubmFtZSArIHF1ZXJ5RmlsdGVyLmlkXSA9IHF1ZXJ5RmlsdGVyLnZlcnNpb24gPyBxdWVyeUZpbHRlci50aXRsZSArICcgJyArIHF1ZXJ5RmlsdGVyLnZlcnNpb24gOiBxdWVyeUZpbHRlci50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sQXJyLnB1c2godmFsdWVBcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBubyBmaWx0ZXJzIHdlcmUgYXBwbGllZCwgc28gc2hvdyBhZ2dyZWdhdGUgc3RhdGlzdGljc1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goZGF0YS5yZXN1bHRzLCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgcmVzdWx0IHZhbHVlcyB0byB2YWx1ZUFyclxuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKHhBcnIsIGZ1bmN0aW9uICh4RGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZU9iaiA9IF8uZmluZChyZXN1bHQudmFsdWVzLCBmdW5jdGlvbiAocURhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vbWVudC51dGMocURhdGUuZGF0ZSkuaXNTYW1lKHhEYXRlLCAnZGF5Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHVzaCAwIGlmIGRhdGEgZm9yIHhEYXRlIGlzIG5vdCBwcmVzZW50IGluIHJlc3VsdC52YWx1ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZUFyci5wdXNoKHZhbHVlT2JqID8gdmFsdWVPYmoudmFsdWUgOiAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBwcmVwZW5kIHZhbHVlQXJyIHdpdGggZmlsdGVyIHRpdGxlLCBhbmQgcHVzaCBvbnRvIGNvbEFyclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbHVtbkxhYmVsID0gcmVzdWx0LmNvbHVtbi50aXRsZSArICcgZm9yIGFsbCAnICsgcXVlcnkuZGF0YVR5cGUudGl0bGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZUFyci51bnNoaWZ0KGNvbHVtbkxhYmVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbE5hbWVzWydhZ2dyZWdhdGUnXSA9IGNvbHVtbkxhYmVsO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sQXJyLnB1c2godmFsdWVBcnIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gaW5mb3JtIHRoZSB1c2VyIGlmIHRoZSBtZXRyaWNzIHRoZXkgc2VsZWN0ZWQgYXJlIGVtcHR5XG4gICAgICAgICAgICBpZiAoXy5zdW0oXy5mbGF0dGVuKGNvbEFycikpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdG9hc3RyWydpbmZvJ10oJ1RoZXJlIGlzIG5vIGRhdGEgdG8gZGlzcGxheS4nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gcHJlcGVuZCB4QXJyIHdpdGggYW4gJ3gnIGxhYmVsIGFuZCBhZGQgdG8gY29sQXJyXG4gICAgICAgICAgICB4QXJyLnVuc2hpZnQoJ3gnKTtcbiAgICAgICAgICAgIGNvbEFyci51bnNoaWZ0KHhBcnIpO1xuXG4gICAgICAgICAgICB2YXIgdHlwZXMgPSB7fSxcbiAgICAgICAgICAgICAgICB0eXBlID0ge30sXG4gICAgICAgICAgICAgICAgZ3JvdXBzID0gW107XG5cbiAgICAgICAgICAgIF8uZm9yRWFjaChjb2xBcnIsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICB0eXBlID0ge307XG4gICAgICAgICAgICAgICAgaWYgKGNvbFswXSAhPT0gJ3gnKSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGVbY29sWzBdXSA9IHZtLmNoYXJ0VHlwZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmNoYXJ0RGlzcGxheSA9PT0gJ3N0YWNrZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBncm91cHMucHVzaChjb2xbMF0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHR5cGVzLCB0eXBlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoY2hhcnQpIHtcbiAgICAgICAgICAgICAgICAvLyBjaGFydCBhbHJlYWR5IGV4aXN0cywgc28gdXBkYXRlIHZhbHVlc1xuICAgICAgICAgICAgICAgIGNoYXJ0Lmdyb3VwcyhbZ3JvdXBzXSk7XG4gICAgICAgICAgICAgICAgY2hhcnQuZGF0YS5uYW1lcyhjb2xOYW1lcyk7XG4gICAgICAgICAgICAgICAgY2hhcnQuYXhpcy5sYWJlbHMoe1xuICAgICAgICAgICAgICAgICAgICB5OiBfLmNhcGl0YWxpemUoeVVuaXRzWzBdKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNoYXJ0LmxvYWQoe1xuICAgICAgICAgICAgICAgICAgICBjb2x1bW5zOiBjb2xBcnIsXG4gICAgICAgICAgICAgICAgICAgIHR5cGVzOiB0eXBlcyxcbiAgICAgICAgICAgICAgICAgICAgdW5sb2FkOiByZW1vdmVJZHNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gbm8gY2hhcnQgeWV0LCBzbyBzZXQgaXQgdXBcbiAgICAgICAgICAgICAgICBjaGFydCA9IGMzLmdlbmVyYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgYmluZHRvOiAnI21ldHJpY3MnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB4OiAneCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zOiBjb2xBcnIsXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlczogdHlwZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBncm91cHM6IFtncm91cHNdLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXM6IGNvbE5hbWVzXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHN1YmNoYXJ0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaG93OiB2bS5zdWJjaGFydEVuYWJsZWRcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDcwMFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGF0dGVybjogc2NhbGVDb25maWcuY29sb3JzLnBhdHRlcm5EMzIwXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGF4aXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICd0aW1lc2VyaWVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWNrOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQudXRjKGQpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICdEYXRlcycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnb3V0ZXItY2VudGVyJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGljazoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeVVuaXRzWzBdID09PSAnc2Vjb25kcycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUR1cmF0aW9uKG1vbWVudC51dGMoKS5zdGFydE9mKCdkJyksIG1vbWVudC51dGMoKS5zdGFydE9mKCdkJykuYWRkKGQsICdzJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh5VW5pdHNbMF0gPT09ICdieXRlcycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUZpbGVTaXplRnJvbUJ5dGVzKGQsIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IF8uY2FwaXRhbGl6ZSh5VW5pdHNbMF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ291dGVyLW1pZGRsZSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzZXQgY2hhcnQgaGVpZ2h0XG4gICAgICAgIGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gc2V0IGNvbnRhaW5lciBoZWlnaHRzIGVxdWFsIHRvIGF2YWlsYWJsZSBwYWdlIGhlaWdodFxuICAgICAgICAgICAgdmFyIHZpZXdwb3J0ID0gc2NhbGVTZXJ2aWNlLmdldFZpZXdwb3J0U2l6ZSgpLFxuICAgICAgICAgICAgICAgIG9mZnNldCA9IHNjYWxlQ29uZmlnLmhlYWRlck9mZnNldCxcbiAgICAgICAgICAgICAgICBjaGFydE1heEhlaWdodCA9IHZpZXdwb3J0LmhlaWdodCAtIG9mZnNldDtcblxuICAgICAgICAgICAgdm0uY2hhcnRTdHlsZSA9ICdoZWlnaHQ6ICcgKyBjaGFydE1heEhlaWdodCArICdweDsgbWF4LWhlaWdodDogJyArIGNoYXJ0TWF4SGVpZ2h0ICsgJ3B4Oyc7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnbWV0cmljc1NlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsICRxLCAkcmVzb3VyY2UsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBnZXRQbG90RGF0YVBhcmFtcyA9IGZ1bmN0aW9uIChwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkLCBjaG9pY2VfaWQsIGNvbHVtbiwgZ3JvdXAsIGRhdGFUeXBlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhjaG9pY2VfaWQpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogcGFnZV9zaXplLFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgZW5kZWQ6IGVuZGVkLFxuICAgICAgICAgICAgICAgIGNob2ljZV9pZDogY2hvaWNlX2lkLFxuICAgICAgICAgICAgICAgIGNvbHVtbjogY29sdW1uLFxuICAgICAgICAgICAgICAgIGdyb3VwOiBncm91cCxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogZGF0YVR5cGVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldERhdGFUeXBlczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnbWV0cmljcy8nKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RGF0YVR5cGVNZXRyaWNzOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ21ldHJpY3MvJyArIGlkICsgJy8nKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0RGF0YVR5cGVPcHRpb25zOiBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnbWV0cmljcy8nICsgbmFtZSArICcvJztcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQodXJsKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UGxvdERhdGE6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gcGFyYW1zIHx8IGdldFBsb3REYXRhUGFyYW1zKCksXG4gICAgICAgICAgICAgICAgICAgIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ21ldHJpY3MvJyArIHBhcmFtcy5kYXRhVHlwZSArICcvcGxvdC1kYXRhLycsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0R2VuZXJhdGVkUGxvdERhdGE6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgcmV0dXJuT2JqID0ge1xuICAgICAgICAgICAgICAgICAgICBjb3VudDogMjgsXG4gICAgICAgICAgICAgICAgICAgIG5leHQ6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHByZXZpb3VzOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiBbXVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgbnVtRGF5cyA9IG1vbWVudC51dGMob2JqLnBhcmFtcy5lbmRlZCkuZGlmZihtb21lbnQudXRjKG9iai5wYXJhbXMuc3RhcnRlZCksICdkJykgKyAxO1xuXG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKG9iai5xdWVyeS5zZWxlY3RlZE1ldHJpY3MsIGZ1bmN0aW9uIChtZXRyaWMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldHVyblJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogbWV0cmljLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWluX3g6IG1vbWVudC51dGMob2JqLnBhcmFtcy5zdGFydGVkKS5mb3JtYXQoJ1lZWVktTU0tREQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heF94OiBtb21lbnQudXRjKG9iai5wYXJhbXMuZW5kZWQpLmZvcm1hdCgnWVlZWS1NTS1ERCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWluX3k6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhfeTogMTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiBbXVxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtRGF5czsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnF1ZXJ5LmZpbHRlcnNBcHBsaWVkLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2gob2JqLnF1ZXJ5LmZpbHRlcnNBcHBsaWVkLCBmdW5jdGlvbiAoZmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblJlc3VsdC52YWx1ZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBtb21lbnQudXRjKG9iai5wYXJhbXMuc3RhcnRlZCkuYWRkKGksICdkJykuZm9ybWF0KCdZWVlZLU1NLUREJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDEwMDAgLSAxICsgMSkpICsgMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBmaWx0ZXIuaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblJlc3VsdC52YWx1ZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IG1vbWVudC51dGMob2JqLnBhcmFtcy5zdGFydGVkKS5hZGQoaSwgJ2QnKS5mb3JtYXQoJ1lZWVktTU0tREQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMDAwIC0gMSArIDEpKSArIDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm5PYmoucmVzdWx0cy5wdXNoKHJldHVyblJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBkLnJlc29sdmUocmV0dXJuT2JqKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCduYXZDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sICR3aW5kb3csIHNjYWxlQ29uZmlnLCBzY2FsZVNlcnZpY2UsIHN0YXRlU2VydmljZSwgbmF2U2VydmljZSkge1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IHNjYWxlQ29uZmlnLmNvbG9ycy5uYXZfYmc7XG5cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS52ZXJzaW9uID0gJyc7XG4gICAgICAgIHZtLmFjdGl2ZVBhZ2UgPSAnb3ZlcnZpZXcnO1xuICAgICAgICB2bS5kb2NzVXJsID0gc2NhbGVDb25maWcudXJscy5kb2N1bWVudGF0aW9uO1xuXG4gICAgICAgIHZtLmdvdG8gPSBmdW5jdGlvbihsb2MpIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2goJycpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgobG9jKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgbG9jYXRpb25VcGRhdGVkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2bS5hY3RpdmVQYWdlID0gbmF2U2VydmljZS5sb2NhdGlvbjtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmF2U2VydmljZS5yZWdpc3Rlck9ic2VydmVyKGxvY2F0aW9uVXBkYXRlZCk7XG5cbiAgICAgICAgICAgIHNjYWxlU2VydmljZS5nZXRWZXJzaW9uKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLnZlcnNpb24gPSBkYXRhLnZlcnNpb247XG4gICAgICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldFZlcnNpb24oZGF0YS52ZXJzaW9uKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgLyoqXG4gICAgICogU2VlOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEyNTc2Nzk4L2FuZ3VsYXJqcy1ob3ctdG8td2F0Y2gtc2VydmljZS12YXJpYWJsZXMvMTc1NTg4ODUjMTc1NTg4ODVcbiAgICAgKiBEb2luZyB0aGluZ3MgdGhpcyB3YXkgc28gdGhhdCBzc05hdmJhckNvbnRyb2xsZXIgY2FuIGdldCBub3RpZmllZFxuICAgICAqIHdoZW4gdGhlIGxvY2F0aW9uIGNoYW5nZXMuIFRoZW4sIG91ciBjb250cm9sbGVycyBqdXN0IG5lZWQgdG8gY2FsbCBpbnRvXG4gICAgICogdGhpcyBzZXJ2aWNlIHRvIHVwZGF0ZUxvY2F0aW9uLlxuICAgICAqXG4gICAgICogVGhlIG9ubHkgdGhpbmcgSSBkb24ndCBsaWtlIGFib3V0IHRoaXMgaXMgdGhhdCB0aGUgaW5kaXZpZHVhbFxuICAgICAqIGNvbnRyb2xsZXJzIGhhdmUgdG8gY2FsbCBpbiBhbmQgdGVsbCB0aGUgc3NOYXZpZ2F0aW9uU2VydmljZSB3aGF0XG4gICAgICogcGFnZSB0aGV5IGFyZSBzaG93aW5nLlxuICAgICAqL1xuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ25hdlNlcnZpY2UnLCBmdW5jdGlvbiAoJGxvY2F0aW9uKSB7XG5cbiAgICAgICAgdGhpcy5sb2NhdGlvbiA9ICdvdmVydmlldyc7IC8vIHdoZXJlIHRoZSBhcHAgc3RhcnRzXG5cbiAgICAgICAgdmFyIG9ic2VydmVycyA9IFtdO1xuXG4gICAgICAgIHRoaXMucmVnaXN0ZXJPYnNlcnZlciA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBvYnNlcnZlcnMucHVzaChjYWxsYmFjayk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5ub3RpZnlPYnNlcnZlcnMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChvYnNlcnZlcnMsIGZ1bmN0aW9uKG9ic2VydmVyKSB7XG4gICAgICAgICAgICAgICAgb2JzZXJ2ZXIoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMudXBkYXRlTG9jYXRpb24gPSBmdW5jdGlvbihsb2NhdGlvbkluKSB7XG4gICAgICAgICAgICB0aGlzLmxvY2F0aW9uID0gbG9jYXRpb25JbjtcbiAgICAgICAgICAgIHRoaXMubm90aWZ5T2JzZXJ2ZXJzKCk7XG4gICAgICAgIH07XG5cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ3N1Ym5hdlNlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBjdXJyZW50UGF0aCA9ICcnO1xuXG4gICAgICAgIHRoaXMuc2V0Q3VycmVudFBhdGggPSBmdW5jdGlvbiAocGF0aCkge1xuICAgICAgICAgICAgY3VycmVudFBhdGggPSBwYXRoO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuZ2V0Q3VycmVudFBhdGggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gY3VycmVudFBhdGg7XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignbm9kZURldGFpbHNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sICRyb3V0ZVBhcmFtcywgJHRpbWVvdXQsIG5hdlNlcnZpY2UsIG5vZGVTZXJ2aWNlLCBzY2FsZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5ub2RlSWQgPSAkcm91dGVQYXJhbXMuaWQ7XG4gICAgICAgIHZtLnNjYWxlU2VydmljZSA9IHNjYWxlU2VydmljZTtcblxuICAgICAgICB2YXIgZ2V0Tm9kZURldGFpbHMgPSBmdW5jdGlvbiAobm9kZUlkKSB7XG4gICAgICAgICAgICBub2RlU2VydmljZS5nZXROb2RlKG5vZGVJZCkudGhlbiggZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5ub2RlID0gZGF0YTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdub2RlcycpO1xuICAgICAgICAgICAgZ2V0Tm9kZURldGFpbHModm0ubm9kZUlkKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdub2Rlc0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgJHRpbWVvdXQsICR1aWJNb2RhbCwgbmF2U2VydmljZSwgbm9kZVNlcnZpY2UsIHN0YXRlU2VydmljZSwgdXNlclNlcnZpY2UsIGdyaWRGYWN0b3J5LCB0b2FzdHIpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5ub2Rlc1BhcmFtcyA9IHN0YXRlU2VydmljZS5nZXROb2Rlc1BhcmFtcygpO1xuXG4gICAgICAgIHZtLnN0YXRlU2VydmljZSA9IHN0YXRlU2VydmljZTtcbiAgICAgICAgdm0ubm9kZVN0YXR1cyA9IFtdO1xuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0ubG9hZGluZ1N0YXR1cyA9IHRydWU7XG4gICAgICAgIHZtLnJlYWRvbmx5ID0gdHJ1ZTtcbiAgICAgICAgdm0ubm9kZXNFcnJvciA9IG51bGw7XG4gICAgICAgIHZtLm5vZGVzRXJyb3JTdGF0dXMgPSBudWxsO1xuICAgICAgICB2bS5zdGF0dXNFcnJvciA9IG51bGw7XG4gICAgICAgIHZtLnN0YXR1c0Vycm9yU3RhdHVzID0gbnVsbDtcbiAgICAgICAgdm0uYWN0aW9uQ2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucyA9IGdyaWRGYWN0b3J5LmRlZmF1bHRHcmlkT3B0aW9ucygpO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uQ3VycmVudFBhZ2UgPSB2bS5ub2Rlc1BhcmFtcy5wYWdlIHx8IDE7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZSA9IHZtLm5vZGVzUGFyYW1zLnBhZ2Vfc2l6ZSB8fCB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcblxuICAgICAgICAkc2NvcGUucGF1c2VSZWFzb24gPSAnJztcblxuICAgICAgICB2YXIgZmlsdGVyZWRCeU9yZGVyID0gdm0ubm9kZXNQYXJhbXMub3JkZXIgPyB0cnVlIDogZmFsc2U7XG5cbiAgICAgICAgdm0uY29sRGVmcyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2hvc3RuYW1lJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0hvc3RuYW1lJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj48ZGl2IGNsYXNzPVwicHVsbC1yaWdodFwiIG5nLXNob3c9XCIhZ3JpZC5hcHBTY29wZS52bS5yZWFkb25seSAmJiBncmlkLmFwcFNjb3BlLnZtLm5vZGVTdGF0dXMubGVuZ3RoID4gMFwiPjxidXR0b24gY2xhc3M9XCJidG4gYnRuLXhzIGJ0bi1kZWZhdWx0XCIgbmctY2xpY2s9XCJncmlkLmFwcFNjb3BlLnZtLnBhdXNlTm9kZShyb3cuZW50aXR5LmlkKVwiPjxpIGNsYXNzPVwiZmFcIiBuZy1jbGFzcz1cInsgXFwnZmEtcGF1c2VcXCc6ICFyb3cuZW50aXR5LmlzX3BhdXNlZCAmJiAhcm93LmVudGl0eS5pc19wYXVzZWRfZXJyb3JzLCBcXCdmYS1wbGF5XFwnOiByb3cuZW50aXR5LmlzX3BhdXNlZCB8fCByb3cuZW50aXR5LmlzX3BhdXNlZF9lcnJvcnMgfVwiPjwvaT48L2J1dHRvbj48L2Rpdj4ge3sgcm93LmVudGl0eS5ob3N0bmFtZSB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdpc19vbmxpbmUnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnU3RhdHVzJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVuYWJsZVNvcnRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIiBuZy1zaG93PVwicm93LmVudGl0eS5zdGF0dXNcIj48c3BhbiBuZy1iaW5kLWh0bWw9XCJyb3cuZW50aXR5LnN0YXR1c0xhYmVsXCI+PC9zcGFuPjwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdpZCcsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdTdGF0aXN0aWNzJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVuYWJsZVNvcnRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIiBuZy1zaG93PVwicm93LmVudGl0eS5zdGF0dXNcIj57eyByb3cuZW50aXR5LnN0YXR1cy5nZXRDZWxsRXJyb3IoKSB9fSAvIHt7IHJvdy5lbnRpdHkuc3RhdHVzLmdldENlbGxUb3RhbCgpIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2lkJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0N1cnJlbnQgSm9icycsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlbmFibGVTb3J0aW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCIgbmctc2hvdz1cInJvdy5lbnRpdHkuc3RhdHVzXCI+PHNwYW4gbmctYmluZC1odG1sPVwicm93LmVudGl0eS5zdGF0dXMuZ2V0Q2VsbEpvYnMoKVwiPjwvc3Bhbj48L2Rpdj4nXG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG5cbiAgICAgICAgdm0uZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IHZtLmNvbERlZnM7XG5cbiAgICAgICAgdm0ucGF1c2VOb2RlID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAkc2NvcGUucGF1c2VSZWFzb24gPSAnJztcbiAgICAgICAgICAgIHZtLmFjdGlvbkNsaWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgdmFyIG5vZGVTdGF0dXMgPSBfLmZpbmQodm0ubm9kZVN0YXR1cywgeyBub2RlOiB7IGlkOiBpZCB9IH0pO1xuXG4gICAgICAgICAgICAkc2NvcGUudXBkYXRlUmVhc29uID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhdXNlUmVhc29uID0gdmFsdWU7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgcGF1c2VSZXN1bWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgbm9kZVN0YXR1cy5wYXVzZVJlc3VtZUNlbGwoJHNjb3BlLnBhdXNlUmVhc29uKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBfLmZpbmQodm0uZ3JpZE9wdGlvbnMuZGF0YSwgeyBpZDogcmVzdWx0LmlkIH0pO1xuICAgICAgICAgICAgICAgICAgICBub2RlLmlzX3BhdXNlZCA9IHJlc3VsdC5pc19wYXVzZWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmlzUGF1c2VkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ci5pbmZvKG5vZGUuaG9zdG5hbWUgKyAnIFBhdXNlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmluZm8obm9kZS5ob3N0bmFtZSArICcgUmVzdW1lZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBvbmx5IHByb21wdCBmb3IgcmVhc29uIHdoZW4gcGF1c2luZyAobm90IHJlc3VtaW5nKVxuICAgICAgICAgICAgaWYgKCFub2RlU3RhdHVzLm5vZGUuaXNfcGF1c2VkICYmICFub2RlU3RhdHVzLm5vZGUuaXNfcGF1c2VkX2Vycm9ycykge1xuICAgICAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAncGF1c2VEaWFsb2cuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGVcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBwYXVzZVJlc3VtZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwYXVzZVJlc3VtZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdldFN0YXR1c0xhYmVsID0gZnVuY3Rpb24gKHN0YXR1cykge1xuICAgICAgICAgICAgdmFyIG9ubGluZSA9IHN0YXR1cy5pc19vbmxpbmUgPyAnPHNwYW4gY2xhc3M9XCJsYWJlbCBsYWJlbC1vbmxpbmVcIj5PbmxpbmU8L3NwYW4+JyA6ICc8c3BhbiBjbGFzcz1cImxhYmVsIGxhYmVsLW9mZmxpbmVcIj5PZmZsaW5lPC9zcGFuPic7XG4gICAgICAgICAgICB2YXIgcGF1c2VkID0gc3RhdHVzLm5vZGUuaXNfcGF1c2VkID8gJzxzcGFuIGNsYXNzPVwibGFiZWwgbGFiZWwtcGF1c2VkXCI+UGF1c2VkPC9zcGFuPicgOiAnJztcbiAgICAgICAgICAgIHZhciBwYXVzZWRFcnJvcnMgPSBzdGF0dXMubm9kZS5pc19wYXVzZWRfZXJyb3JzID8gJzxzcGFuIGNsYXNzPVwibGFiZWwgbGFiZWwtcGF1c2VkLWVycm9yc1wiPlBhdXNlZCB3aXRoIEVycm9yczwvc3Bhbj4nIDogJyc7XG4gICAgICAgICAgICByZXR1cm4gb25saW5lICsgJyAnICsgcGF1c2VkICsgJyAnICsgcGF1c2VkRXJyb3JzO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmZpbHRlclJlc3VsdHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0Tm9kZXNQYXJhbXModm0ubm9kZXNQYXJhbXMpO1xuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBnZXROb2RlcygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnVwZGF0ZUNvbERlZnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5jb2x1bW5EZWZzID0gZ3JpZEZhY3RvcnkuYXBwbHlTb3J0Q29uZmlnKHZtLmNvbERlZnMsIHZtLm5vZGVzUGFyYW1zKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVOb2RlT3JkZXIgPSBmdW5jdGlvbiAoc29ydEFycikge1xuICAgICAgICAgICAgdm0ubm9kZXNQYXJhbXMub3JkZXIgPSBzb3J0QXJyLmxlbmd0aCA+IDAgPyBzb3J0QXJyIDogbnVsbDtcbiAgICAgICAgICAgIGZpbHRlcmVkQnlPcmRlciA9IHNvcnRBcnIubGVuZ3RoID4gMDtcbiAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5ncmlkT3B0aW9ucy5vblJlZ2lzdGVyQXBpID0gZnVuY3Rpb24gKGdyaWRBcGkpIHtcbiAgICAgICAgICAgIC8vc2V0IGdyaWRBcGkgb24gc2NvcGVcbiAgICAgICAgICAgIHZtLmdyaWRBcGkgPSBncmlkQXBpO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0uYWN0aW9uQ2xpY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5hY3Rpb25DbGlja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaCh7fSk7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbm9kZXMvJyArIHJvdy5lbnRpdHkuaWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5wYWdpbmF0aW9uLm9uLnBhZ2luYXRpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIHZtLm5vZGVzUGFyYW1zLnBhZ2UgPSBjdXJyZW50UGFnZTtcbiAgICAgICAgICAgICAgICB2bS5ub2Rlc1BhcmFtcy5wYWdlX3NpemUgPSBwYWdlU2l6ZTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZtLmdyaWRBcGkuY29yZS5vbi5zb3J0Q2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChncmlkLCBzb3J0Q29sdW1ucykge1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5ncmlkQXBpLmdyaWQuY29sdW1ucywgZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgICAgICAgICAgICBjb2wuY29sRGVmLnNvcnQgPSBjb2wuc29ydDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzdGF0ZVNlcnZpY2Uuc2V0Tm9kZXNDb2xEZWZzKHZtLmdyaWRBcGkuZ3JpZC5vcHRpb25zLmNvbHVtbkRlZnMpO1xuICAgICAgICAgICAgICAgIHZhciBzb3J0QXJyID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHNvcnRDb2x1bW5zLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvcnRBcnIucHVzaChjb2wuc29ydC5kaXJlY3Rpb24gPT09ICdkZXNjJyA/ICctJyArIGNvbC5maWVsZCA6IGNvbC5maWVsZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlTm9kZU9yZGVyKHNvcnRBcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldE5vZGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbm9kZVNlcnZpY2UuZ2V0Tm9kZXModm0ubm9kZXNQYXJhbXMpLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ubm9kZXNFcnJvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnRvdGFsSXRlbXMgPSBkYXRhLmNvdW50O1xuICAgICAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5taW5Sb3dzVG9TaG93ID0gZGF0YS5yZXN1bHRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMudmlydHVhbGl6YXRpb25UaHJlc2hvbGQgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1c1RleHQgJiYgZGF0YS5zdGF0dXNUZXh0ICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubm9kZXNFcnJvclN0YXR1cyA9IGRhdGEuc3RhdHVzVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2bS5ub2Rlc0Vycm9yID0gJ1VuYWJsZSB0byByZXRyaWV2ZSBub2Rlcy4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXROb2RlU3RhdHVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbm9kZVNlcnZpY2UuZ2V0Tm9kZVN0YXR1cyhudWxsLCBudWxsLCAnUFQzSCcsIG51bGwpLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uc3RhdHVzRXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB2bS5ub2RlU3RhdHVzID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1c1RleHQgJiYgZGF0YS5zdGF0dXNUZXh0ICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc3RhdHVzRXJyb3JTdGF0dXMgPSBkYXRhLnN0YXR1c1RleHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdm0uc3RhdHVzRXJyb3IgPSAnVW5hYmxlIHRvIHJldHJpZXZlIG5vZGUgc3RhdHVzLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmdTdGF0dXMgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldE5vZGVzUGFyYW1zKHZtLm5vZGVzUGFyYW1zKTtcbiAgICAgICAgICAgIHZtLnVwZGF0ZUNvbERlZnMoKTtcbiAgICAgICAgICAgIHZhciB1c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgICAgICB2bS5yZWFkb25seSA9ICEodXNlciAmJiB1c2VyLmlzX2FkbWluKTtcbiAgICAgICAgICAgIGdldE5vZGVzKCk7XG4gICAgICAgICAgICBnZXROb2RlU3RhdHVzKCk7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdub2RlcycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigndm0uc3RhdGVTZXJ2aWNlLmdldE5vZGVzQ29sRGVmcygpJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5jb2xEZWZzID0gbmV3VmFsdWU7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0Tm9kZXNQYXJhbXMoKScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0ubm9kZXNQYXJhbXMgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIHZtLnVwZGF0ZUNvbERlZnMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ3ZtLm5vZGVTdGF0dXMnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5ncmlkT3B0aW9ucy5kYXRhLCBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSBfLmZpbmQobmV3VmFsdWUsIHsgbm9kZTogeyBpZDogbm9kZS5pZCB9IH0pO1xuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5zdGF0dXMgPSBzdGF0dXM7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUuc3RhdHVzTGFiZWwgPSB2bS5nZXRTdGF0dXNMYWJlbChzdGF0dXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpe1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc05vZGVIZWFsdGhDb250cm9sbGVyJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzY29wZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0ubm9kZXMgPSBbXTtcbiAgICAgICAgdm0ubm9kZXNPZmZsaW5lID0gMDtcbiAgICAgICAgdm0ubm9kZXNQYXVzZWRFcnJvcnMgPSAwO1xuICAgICAgICB2bS5ub2Rlc1BhdXNlZCA9IDA7XG4gICAgICAgIHZtLm5vZGVzT2ZmbGluZUFuZFBhdXNlZCA9IDA7XG4gICAgICAgIHZtLm5vZGVzT2ZmbGluZUFuZFBhdXNlZEVycm9ycyA9IDA7XG4gICAgICAgIHZtLmhlYWx0aHlOb2RlcyA9IDA7XG4gICAgICAgIHZtLnRvdGFsTm9kZXMgPSAwO1xuXG4gICAgICAgIHZhciBnZXROb2RlU3RhdHVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0udG90YWxOb2RlcyA9IHZtLm5vZGVzLmxlbmd0aDtcblxuICAgICAgICAgICAgdmFyIG5vZGVzT2ZmbGluZSA9IFtdLFxuICAgICAgICAgICAgICAgIG5vZGVzUGF1c2VkRXJyb3JzID0gW10sXG4gICAgICAgICAgICAgICAgbm9kZXNQYXVzZWQgPSBbXSxcbiAgICAgICAgICAgICAgICBub2Rlc09mZmxpbmVBbmRQYXVzZWRFcnJvcnMgPSBbXSxcbiAgICAgICAgICAgICAgICBub2Rlc09mZmxpbmVBbmRQYXVzZWQgPSBbXTtcblxuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLm5vZGVzLCBmdW5jdGlvbiAobikge1xuICAgICAgICAgICAgICAgIGlmICghbi5pc19vbmxpbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbm9kZSBpcyBvZmZsaW5lXG4gICAgICAgICAgICAgICAgICAgIGlmIChuLm5vZGUuaXNfcGF1c2VkX2Vycm9ycykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXNPZmZsaW5lQW5kUGF1c2VkRXJyb3JzLnB1c2gobik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobi5ub2RlLmlzX3BhdXNlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXNPZmZsaW5lQW5kUGF1c2VkLnB1c2gobik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2Rlc09mZmxpbmUucHVzaChuKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIG5vZGUgaXMgb25saW5lXG4gICAgICAgICAgICAgICAgICAgIGlmIChuLm5vZGUuaXNfcGF1c2VkX2Vycm9ycykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXNQYXVzZWRFcnJvcnMucHVzaChuKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuLm5vZGUuaXNfcGF1c2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2Rlc1BhdXNlZC5wdXNoKG4pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZtLm5vZGVzT2ZmbGluZSA9IG5vZGVzT2ZmbGluZS5sZW5ndGg7XG4gICAgICAgICAgICB2bS5ub2Rlc1BhdXNlZEVycm9ycyA9IG5vZGVzUGF1c2VkRXJyb3JzLmxlbmd0aDtcbiAgICAgICAgICAgIHZtLm5vZGVzUGF1c2VkID0gbm9kZXNQYXVzZWQubGVuZ3RoO1xuICAgICAgICAgICAgdm0ubm9kZXNPZmZsaW5lQW5kUGF1c2VkRXJyb3JzID0gbm9kZXNPZmZsaW5lQW5kUGF1c2VkRXJyb3JzLmxlbmd0aDtcbiAgICAgICAgICAgIHZtLm5vZGVzT2ZmbGluZUFuZFBhdXNlZCA9IG5vZGVzT2ZmbGluZUFuZFBhdXNlZC5sZW5ndGg7XG5cbiAgICAgICAgICAgIC8vIGFkZCB0aGUgbGVuZ3RoIG9mIG5vZGVzIGJvdGggb2ZmbGluZSBhbmQgcGF1c2VkIHRvIHByb2R1Y2UgYW4gYWNjdXJhdGUgaGVhbHRoeSBjb3VudFxuICAgICAgICAgICAgdm0uaGVhbHRoeU5vZGVzID0gdm0udG90YWxOb2RlcyAtIHZtLm5vZGVzT2ZmbGluZSAtIHZtLm5vZGVzUGF1c2VkRXJyb3JzIC0gdm0ubm9kZXNQYXVzZWQgLSB2bS5ub2Rlc09mZmxpbmVBbmRQYXVzZWQgLSB2bS5ub2Rlc09mZmxpbmVBbmRQYXVzZWRFcnJvcnM7XG5cbiAgICAgICAgICAgIHZhciBkb251dERhdGEgPSBbXTtcblxuICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIHBlcmNlbnRhZ2Ugb2YgaGVhbHRoeSBub2RlcywgYW5kIGJyZWFrZG93biBvZiB3aHkgbm9kZXMgYXJlIHVuaGVhbHRoeVxuICAgICAgICAgICAgdmFyIGdhdWdlRGF0YSA9IHZtLnRvdGFsTm9kZXMgPiAwID8gKCh2bS5oZWFsdGh5Tm9kZXMgLyB2bS50b3RhbE5vZGVzKSAqIDEwMCkudG9GaXhlZCgyKSA6IDAuMDA7XG5cbiAgICAgICAgICAgIGlmICh2bS5ub2Rlc09mZmxpbmUgPiAwKSB7XG4gICAgICAgICAgICAgICAgZG9udXREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdPZmZsaW5lJyxcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IHZtLm5vZGVzT2ZmbGluZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodm0ubm9kZXNQYXVzZWRFcnJvcnMgPiAwKSB7XG4gICAgICAgICAgICAgICAgZG9udXREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdIaWdoIEZhaWx1cmUgUmF0ZScsXG4gICAgICAgICAgICAgICAgICAgIGNvdW50OiB2bS5ub2Rlc1BhdXNlZEVycm9yc1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodm0ubm9kZXNQYXVzZWQgPiAwKSB7XG4gICAgICAgICAgICAgICAgZG9udXREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdQYXVzZWQnLFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogdm0ubm9kZXNQYXVzZWRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHZtLm5vZGVzT2ZmbGluZUFuZFBhdXNlZCkge1xuICAgICAgICAgICAgICAgIGRvbnV0RGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnT2ZmbGluZSBhbmQgUGF1c2VkJyxcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IHZtLm5vZGVzT2ZmbGluZUFuZFBhdXNlZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodm0ubm9kZXNPZmZsaW5lQW5kUGF1c2VkRXJyb3JzKSB7XG4gICAgICAgICAgICAgICAgZG9udXREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdPZmZsaW5lIGFuZCBQYXVzZWQgZHVlIHRvIEVycm9ycycsXG4gICAgICAgICAgICAgICAgICAgIGNvdW50OiB2bS5ub2Rlc09mZmxpbmVBbmRQYXVzZWRFcnJvcnNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdm0ubm9kZUhlYWx0aCA9IHtcbiAgICAgICAgICAgICAgICBnYXVnZURhdGE6IGdhdWdlRGF0YSxcbiAgICAgICAgICAgICAgICBkb251dERhdGE6IGRvbnV0RGF0YVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdkYXRhJywgZnVuY3Rpb24gKG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICB2bS5ub2RlcyA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgZ2V0Tm9kZVN0YXR1cygpO1xuICAgICAgICB9KTtcbiAgICB9KS5kaXJlY3RpdmUoJ2Fpc05vZGVIZWFsdGgnLCBmdW5jdGlvbigpe1xuICAgICAgICAvKipcbiAgICAgICAgICogVXNhZ2U6IDxhaXMtbm9kZS1oZWFsdGggLz5cbiAgICAgICAgICoqL1xuICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzTm9kZUhlYWx0aENvbnRyb2xsZXInLFxuICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvbm9kZXMvZGlyZWN0aXZlcy9ub2RlSGVhbHRoVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgICBkYXRhOiAnPScsXG4gICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAnPScsXG4gICAgICAgICAgICAgICAgIHNob3dEZXNjcmlwdGlvbjogJz0nLFxuICAgICAgICAgICAgICAgICBsb2FkaW5nOiAnPSdcbiAgICAgICAgICAgICB9XG4gICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignbm9kZVN0YXR1c0dyaWRDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXMsXG4gICAgICAgICAgICBjZWxsU2l6ZSA9ICRzY29wZS5jZWxsU2l6ZSB8fCAnMTBweCc7XG5cbiAgICAgICAgdm0ubm9kZXMgPSBbXTtcbiAgICAgICAgdm0uaG91cnMgPSAkc2NvcGUuaG91cnMgfHwgMztcbiAgICAgICAgdm0uY2VsbFN0eWxlID0ge1xuICAgICAgICAgICAgd2lkdGg6IGNlbGxTaXplLFxuICAgICAgICAgICAgaGVpZ2h0OiBjZWxsU2l6ZVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmdldE5vZGVDbGFzcyA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZ2V0Tm9kZUNsYXNzJyk7XG4gICAgICAgICAgICBpZiAoIW5vZGUuaXNfb25saW5lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdvZmZsaW5lJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZS5pc19wYXVzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdpcy1wYXVzZWQnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobm9kZS5ub2RlLmlzX3BhdXNlZF9lcnJvcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdpcy1wYXVzZWQtZXJyb3JzJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJ29ubGluZSc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udmlld05vZGUgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdub2Rlcy8nICsgaWQpO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ2RhdGEnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF8uZm9yRWFjaChuZXdWYWx1ZSwgZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIW5vZGUuaXNfb25saW5lKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUuY2xhc3MgPSAnb2ZmbGluZSc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZS5pc19wYXVzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuY2xhc3MgPSAnaXMtcGF1c2VkJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChub2RlLm5vZGUuaXNfcGF1c2VkX2Vycm9ycykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5jbGFzcyA9ICdpcy1wYXVzZWQtZXJyb3JzJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuY2xhc3MgPSAnb25saW5lJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0ubm9kZXMgPSBuZXdWYWx1ZTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZGlyZWN0aXZlKCdhaXNOb2RlU3RhdHVzR3JpZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdub2RlU3RhdHVzR3JpZENvbnRyb2xsZXInLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL25vZGVzL2RpcmVjdGl2ZXMvbm9kZVN0YXR1c0dyaWRUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGRhdGE6ICc9JyxcbiAgICAgICAgICAgICAgICBob3VyczogJz0nLFxuICAgICAgICAgICAgICAgIGNlbGxTaXplOiAnQCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnTm9kZScsIGZ1bmN0aW9uIChOb2RlUmVzb3VyY2VzLCBzY2FsZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIE5vZGUgPSBmdW5jdGlvbiAoaWQsIGhvc3RuYW1lLCBwb3J0LCBzbGF2ZV9pZCwgaXNfcGF1c2VkLCBpc19wYXVzZWRfZXJyb3JzLCBpc19hY3RpdmUsIGFyY2hpdmVkLCBjcmVhdGVkLCBsYXN0X29mZmVyLCBsYXN0X21vZGlmaWVkLCBqb2JfZXhlc19ydW5uaW5nLCByZXNvdXJjZXMpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuaG9zdG5hbWUgPSBob3N0bmFtZTtcbiAgICAgICAgICAgIHRoaXMucG9ydCA9IHBvcnQ7XG4gICAgICAgICAgICB0aGlzLnNsYXZlX2lkID0gc2xhdmVfaWQ7XG4gICAgICAgICAgICB0aGlzLmlzX3BhdXNlZCA9IGlzX3BhdXNlZDtcbiAgICAgICAgICAgIHRoaXMuaXNfcGF1c2VkX2Vycm9ycyA9IGlzX3BhdXNlZF9lcnJvcnM7XG4gICAgICAgICAgICB0aGlzLmlzX2FjdGl2ZSA9IGlzX2FjdGl2ZTtcbiAgICAgICAgICAgIHRoaXMuYXJjaGl2ZWQgPSBhcmNoaXZlZDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3Rfb2ZmZXIgPSBsYXN0X29mZmVyO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMuam9iX2V4ZXNfcnVubmluZyA9IGpvYl9leGVzX3J1bm5pbmc7XG4gICAgICAgICAgICB0aGlzLnJlc291cmNlcyA9IE5vZGVSZXNvdXJjZXMudHJhbnNmb3JtZXIocmVzb3VyY2VzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBtZXRob2RzXG4gICAgICAgIE5vZGUucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ05vZGUnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbih0aGlzLmNyZWF0ZWQsIHRoaXMubGFzdF9tb2RpZmllZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbFRleHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIG9ubHkgdXNlZCByZXZlYWwgPSB0cnVlIG9uIGdyaWRDaGFydCBkaXJlY3RpdmVcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ob3N0bmFtZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsVGl0bGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ob3N0bmFtZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1BhdXNlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAhKCF0aGlzLmlzX3BhdXNlZCAmJiAhdGhpcy5pc19wYXVzZWRfZXJyb3JzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgTm9kZS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTm9kZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5ob3N0bmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wb3J0LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnNsYXZlX2lkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX3BhdXNlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19wYXVzZWRfZXJyb3JzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5hcmNoaXZlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3Rfb2ZmZXIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfZXhlc19ydW5uaW5nLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc291cmNlc1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IE5vZGUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBOb2RlLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKE5vZGUuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE5vZGUuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIE5vZGU7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnTm9kZVJlc291cmNlcycsIGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBOb2RlUmVzb3VyY2VzID0gZnVuY3Rpb24gKHRvdGFsLCBzY2hlZHVsZWQsIHVzZWQpIHtcbiAgICAgICAgICAgIHRoaXMudG90YWwgPSB0b3RhbDtcbiAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVkID0gc2NoZWR1bGVkO1xuICAgICAgICAgICAgdGhpcy51c2VkID0gdXNlZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBtZXRob2RzXG4gICAgICAgIE5vZGVSZXNvdXJjZXMucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgLy8gZ2V0RHVyYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIC8vcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbih0aGlzLmNyZWF0ZWQsIHRoaXMubGFzdF9tb2RpZmllZCk7XG4gICAgICAgICAgICAvLyB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIE5vZGVSZXNvdXJjZXMuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE5vZGVSZXNvdXJjZXMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudG90YWwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc2NoZWR1bGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnVzZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBOb2RlUmVzb3VyY2VzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgTm9kZVJlc291cmNlcy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChOb2RlUmVzb3VyY2VzLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE5vZGVSZXNvdXJjZXMuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIE5vZGVSZXNvdXJjZXM7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ05vZGVTdGF0dXMnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIG5vZGVVcGRhdGVTZXJ2aWNlLCBOb2RlLCBKb2JFeGVjdXRpb24pIHtcbiAgICAgICAgdmFyIE5vZGVTdGF0dXMgPSBmdW5jdGlvbiAobm9kZSwgaXNfb25saW5lLCBqb2JfZXhlX2NvdW50cywgam9iX2V4ZXNfcnVubmluZykge1xuICAgICAgICAgICAgdGhpcy5ub2RlID0gTm9kZS50cmFuc2Zvcm1lcihub2RlKTtcbiAgICAgICAgICAgIHRoaXMuaXNfb25saW5lID0gaXNfb25saW5lO1xuICAgICAgICAgICAgdGhpcy5qb2JfZXhlX2NvdW50cyA9IGpvYl9leGVfY291bnRzO1xuICAgICAgICAgICAgdGhpcy5qb2JfZXhlc19ydW5uaW5nID0gSm9iRXhlY3V0aW9uLnRyYW5zZm9ybWVyKGpvYl9leGVzX3J1bm5pbmcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vcHVibGljIG1ldGhvZHNcbiAgICAgICAgTm9kZVN0YXR1cy5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnTm9kZVN0YXR1cyc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q29tcGxldGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbXBsZXRlZCA9IF8uZmluZCh0aGlzLmpvYl9leGVfY291bnRzLCAnc3RhdHVzJywgJ0NPTVBMRVRFRCcpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb21wbGV0ZWQgPyBjb21wbGV0ZWQuY291bnQgOiAwO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEZhaWxlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBmYWlsZWQgPSBfLmZpbmQodGhpcy5qb2JfZXhlX2NvdW50cywgJ3N0YXR1cycsICdGQUlMRUQnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFpbGVkID8gZmFpbGVkLmNvdW50IDogMDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsRmlsbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBjb2xvciA9ICcnO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzX29ubGluZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ub2RlLmlzX3BhdXNlZF9lcnJvcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X29yYW5nZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm5vZGUuaXNfcGF1c2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF95ZWxsb3c7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9ncmVlbjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yID0gc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X3JlZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9yO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFJ1bm5pbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBjb3VudDogMCB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxFcnJvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnRmFpbGVkOiAnICsgdGhpcy5nZXRGYWlsZWQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsVG90YWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0NvbXBsZXRlZDogJyArIHRoaXMuZ2V0Q29tcGxldGVkKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbFN0YXR1czogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzX29ubGluZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ub2RlLmlzX3BhdXNlZF9lcnJvcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnSGlnaCBGYWlsdXJlIFJhdGUnO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubm9kZS5pc19wYXVzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnUGF1c2VkJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnT25saW5lJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnT2ZmbGluZSc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxKb2JzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRleHQgPSAnJztcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godGhpcy5qb2JfZXhlc19ydW5uaW5nLCBmdW5jdGlvbiAoam9iRXhlY3V0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQgPSBqb2JFeGVjdXRpb24uam9iLmpvYl90eXBlLmljb25fY29kZSA/XG4gICAgICAgICAgICAgICAgICAgIHRleHQgKyAnICcgKyAnPGkgY2xhc3M9XCJmYSBmYS1md1wiPiYjeCcgKyBqb2JFeGVjdXRpb24uam9iLmpvYl90eXBlLmljb25fY29kZSArICc8L2k+JyA6XG4gICAgICAgICAgICAgICAgICAgIHRleHQgKyAnICcgKyAnPGkgY2xhc3M9XCJmYSBmYS1md1wiPiYjeCcgKyBzY2FsZUNvbmZpZy5kZWZhdWx0SWNvbkNvZGUgKyAnPC9pPic7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbFBhdXNlUmVzdW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubm9kZS5pc19wYXVzZWQgPyAnJiN4ZjA0YjsnIDogJyYjeGYwNGM7JztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXVzZVJlc3VtZUNlbGw6IGZ1bmN0aW9uIChwYXVzZV9yZWFzb24pIHtcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlRGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgcGF1c2VfcmVhc29uOiBwYXVzZV9yZWFzb24gfHwgJycsXG4gICAgICAgICAgICAgICAgICAgIGlzX3BhdXNlZDogIXRoaXMubm9kZS5pc19wYXVzZWRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBub2RlVXBkYXRlU2VydmljZS51cGRhdGVOb2RlKHRoaXMubm9kZS5pZCwgdXBkYXRlRGF0YSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBOb2RlLnRyYW5zZm9ybWVyKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgTm9kZVN0YXR1cy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTm9kZVN0YXR1cyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5ub2RlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX29ubGluZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfZXhlX2NvdW50cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfZXhlc19ydW5uaW5nXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgTm9kZVN0YXR1cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIE5vZGVTdGF0dXMudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoTm9kZVN0YXR1cy5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gTm9kZVN0YXR1cy5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gTm9kZVN0YXR1cztcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ25vZGVTZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCAkcSwgJHJlc291cmNlLCBzY2FsZUNvbmZpZywgTm9kZSwgTm9kZVN0YXR1cywgcG9sbGVyLCBwb2xsZXJGYWN0b3J5KSB7XG4gICAgICAgIHZhciBnZXROb2Rlc1BhcmFtcyA9IGZ1bmN0aW9uIChwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkLCBvcmRlciwgaW5jbHVkZV9pbmFjdGl2ZSwgdXJsKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBwYWdlX3NpemUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogc3RhcnRlZCxcbiAgICAgICAgICAgICAgICBlbmRlZDogZW5kZWQsXG4gICAgICAgICAgICAgICAgb3JkZXI6IG9yZGVyLFxuICAgICAgICAgICAgICAgIGluY2x1ZGVfaW5hY3RpdmU6IGluY2x1ZGVfaW5hY3RpdmUsXG4gICAgICAgICAgICAgICAgdXJsOiB1cmxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldE5vZGVTdGF0dXNQYXJhbXMgPSBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCkge1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHt9O1xuXG4gICAgICAgICAgICBpZihwYWdlKSB7IHBhcmFtcy5wYWdlID0gcGFnZTsgfVxuICAgICAgICAgICAgaWYocGFnZV9zaXplKSB7IHBhcmFtcy5wYWdlX3NpemUgPSBwYWdlX3NpemU7IH1cbiAgICAgICAgICAgIGlmKHN0YXJ0ZWQpIHsgcGFyYW1zLnN0YXJ0ZWQgPSBzdGFydGVkOyB9XG4gICAgICAgICAgICBpZihlbmRlZCkgeyBwYXJhbXMuZW5kZWQgPSBlbmRlZDsgfVxuXG4gICAgICAgICAgICByZXR1cm4gcGFyYW1zO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXROb2RlczogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcyB8fCBnZXROb2Rlc1BhcmFtcygpO1xuICAgICAgICAgICAgICAgIHBhcmFtcy51cmwgPSBwYXJhbXMudXJsID8gcGFyYW1zLnVybCA6IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ25vZGVzLyc7XG5cbiAgICAgICAgICAgICAgICB2YXIgbm9kZXNSZXNvdXJjZSA9ICRyZXNvdXJjZShwYXJhbXMudXJsLCBwYXJhbXMpLFxuICAgICAgICAgICAgICAgICAgICBub2Rlc1BvbGxlciA9IHBvbGxlckZhY3RvcnkubmV3UG9sbGVyKG5vZGVzUmVzb3VyY2UsIHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMubm9kZXMpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vZGVzUG9sbGVyLnByb21pc2UudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IE5vZGUudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVzUG9sbGVyLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXROb2Rlc09uY2U6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMgPSBwYXJhbXMgfHwgZ2V0Tm9kZXNQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogcGFyYW1zLnVybCA/IHBhcmFtcy51cmwgOiBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdub2Rlcy8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldHVybkRhdGEgPSBOb2RlLnRyYW5zZm9ybWVyKGRhdGEubm9kZXMpO1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmV0dXJuRGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Tm9kZTogZnVuY3Rpb24gKHNsYXZlSWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ25vZGVzLycgKyBzbGF2ZUlkICsgJy8nKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXR1cm5EYXRhID0gTm9kZS50cmFuc2Zvcm1lcihkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJldHVybkRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXROb2RlU3RhdHVzOiBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCkge1xuICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBnZXROb2RlU3RhdHVzUGFyYW1zKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQpO1xuXG4gICAgICAgICAgICAgICAgdmFyIG5vZGVTdGF0dXNSZXNvdXJjZSA9ICRyZXNvdXJjZShzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdub2Rlcy9zdGF0dXMvJywgcGFyYW1zKSxcbiAgICAgICAgICAgICAgICAgICAgbm9kZVN0YXR1c1BvbGxlciA9IHBvbGxlckZhY3RvcnkubmV3UG9sbGVyKG5vZGVTdGF0dXNSZXNvdXJjZSwgc2NhbGVDb25maWcucG9sbEludGVydmFscy5ub2RlU3RhdHVzKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBub2RlU3RhdHVzUG9sbGVyLnByb21pc2UudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IE5vZGVTdGF0dXMudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVTdGF0dXNQb2xsZXIuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldE5vZGVTdGF0dXNPbmNlOiBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gZ2V0Tm9kZVN0YXR1c1BhcmFtcyhwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkKTtcbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnbm9kZXMvc3RhdHVzLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBOb2RlU3RhdHVzLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Tm9kZURhdGE6IGZ1bmN0aW9uIChzbGF2ZUlkLCBzaW5jZSkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge30sXG4gICAgICAgICAgICAgICAgICAgIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICAgICAgc2luY2UgPSBzaW5jZSB8fCAnUFQzSCc7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXROb2RlcygpLnRoZW4oZnVuY3Rpb24gKG5vZGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEubm9kZXMgPSBub2RlcztcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0Tm9kZVN0YXR1cyhzaW5jZSkudGhlbihmdW5jdGlvbiAoc3RhdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhdHMgPSBzdGF0cztcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnbm9kZVVwZGF0ZVNlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsICRxLCBzY2FsZUNvbmZpZywgTm9kZSkge1xuICAgICAgICB2YXIgZ2V0Tm9kZVVwZGF0ZURhdGEgPSBmdW5jdGlvbiAocGF1c2VfcmVhc29uLCBpc19wYXVzZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGF1c2VfcmVhc29uOiBwYXVzZV9yZWFzb24sXG4gICAgICAgICAgICAgICAgaXNfcGF1c2VkOiBpc19wYXVzZWRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHVwZGF0ZU5vZGU6IGZ1bmN0aW9uIChpZCwgZGF0YSkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhIHx8IGdldE5vZGVVcGRhdGVEYXRhKCk7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ25vZGVzLycgKyBpZCArICcvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShOb2RlLnRyYW5zZm9ybWVyKHJlc3VsdCkpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdvdkNvbnRyb2xsZXInLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkc2NvcGUsIG5hdlNlcnZpY2UsIG5vZGVTZXJ2aWNlLCBqb2JTZXJ2aWNlLCBqb2JUeXBlU2VydmljZSwgc3RhdHVzU2VydmljZSwgZ2F1Z2VGYWN0b3J5LCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBzY2hlZHVsZXJTZXJ2aWNlLCB1c2VyU2VydmljZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0uZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHZtLmpvYkVycm9yID0gbnVsbDtcbiAgICAgICAgdm0uam9iRXJyb3JTdGF0dXMgPSBudWxsO1xuICAgICAgICB2bS5sb2FkaW5nSm9icyA9IHRydWU7XG4gICAgICAgIHZtLmxvYWRpbmdOb2RlSGVhbHRoID0gdHJ1ZTtcbiAgICAgICAgdm0uam9iVHlwZXMgPSBbXTtcbiAgICAgICAgdm0ubm9kZXMgPSBbXTtcbiAgICAgICAgdm0ubm9kZUhlYWx0aEVycm9yID0gbnVsbDtcbiAgICAgICAgdm0ubm9kZUhlYWx0aEVycm9yU3RhdHVzID0gJyc7XG4gICAgICAgIHZtLmhvdXJWYWx1ZSA9IDM7XG4gICAgICAgIHZtLmpvYkRhdGEgPSB7XG4gICAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICAgICAgc3RhdHVzOiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIHZtLmpvYkVycm9yQnJlYWtkb3duID0gW107XG4gICAgICAgIHZtLnN0YXR1cyA9IG51bGw7XG4gICAgICAgIHZtLnN0YXR1c0Vycm9yID0gbnVsbDtcbiAgICAgICAgdm0ubG9hZGluZ1N0YXR1cyA9IHRydWU7XG4gICAgICAgIHZtLm1hc3RlclN0YXR1cyA9ICcnO1xuICAgICAgICB2bS5tYXN0ZXJTdGF0dXNDbGFzcyA9ICdhbGVydC1zdWNjZXNzJztcbiAgICAgICAgdm0uc2NoZWR1bGVyU3RhdHVzID0gJyc7XG4gICAgICAgIHZtLnNjaGVkdWxlclN0YXR1c0NsYXNzID0gJ2FsZXJ0LXN1Y2Nlc3MnO1xuICAgICAgICB2bS5tZW1DYWxjID0gJyc7XG4gICAgICAgIHZtLmRpc2tDYWxjID0gJyc7XG4gICAgICAgIHZtLnNjaGVkdWxlcklzUGF1c2VkID0gZmFsc2U7XG4gICAgICAgIHZtLnVzZXIgPSB1c2VyU2VydmljZS5nZXRVc2VyQ3JlZHMoKTtcbiAgICAgICAgdm0uc2NoZWR1bGVyQ29udGFpbmVyQ2xhc3MgPSB2bS51c2VyID8gdm0udXNlci5pc19hZG1pbiA/ICdjb2wteHMtOCBjb2wtbGctMTAnIDogJ2NvbC14cy0xMicgOiAnY29sLXhzLTEyJztcbiAgICAgICAgdm0uc2NoZWR1bGVyQnRuQ2xhc3MgPSAnZmEtcGF1c2UnO1xuXG4gICAgICAgIHZtLnRvZ2dsZVNjaGVkdWxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLnNjaGVkdWxlcklzUGF1c2VkID0gIXZtLnNjaGVkdWxlcklzUGF1c2VkO1xuICAgICAgICAgICAgdmFyIHNjaGVkdWxlckRhdGEgPSB7XG4gICAgICAgICAgICAgICAgaXNfcGF1c2VkOiB2bS5zY2hlZHVsZXJJc1BhdXNlZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHNjaGVkdWxlclNlcnZpY2UudXBkYXRlU2NoZWR1bGVyKHNjaGVkdWxlckRhdGEpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5zY2hlZHVsZXJTdGF0dXMgPSBkYXRhLmlzX3BhdXNlZCA/ICdQYXVzZWQnIDogJ1J1bm5pbmcnO1xuICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlclN0YXR1c0NsYXNzID0gZGF0YS5pc19wYXVzZWQgPyAnYWxlcnQtd2FybmluZycgOiAnYWxlcnQtc3VjY2Vzcyc7XG4gICAgICAgICAgICAgICAgdm0uc2NoZWR1bGVyQnRuQ2xhc3MgPSBkYXRhLmlzX3BhdXNlZCA/ICdmYS1wbGF5JyA6ICdmYS1wYXVzZSc7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgcmVkcmF3R3JpZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdyZWRyYXdHcmlkJywgdm0uam9iRGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldEpvYlR5cGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgam9iVHlwZVNlcnZpY2UuZ2V0Sm9iVHlwZXMoKS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmpvYkVycm9yID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdm0uam9iRGF0YS5kYXRhID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgICAgICByZWRyYXdHcmlkKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzVGV4dCAmJiBkYXRhLnN0YXR1c1RleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5qb2JFcnJvclN0YXR1cyA9IGRhdGEuc3RhdHVzVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2bS5qb2JFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgam9iIHR5cGVzLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmdKb2JzID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0U3RhdHVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGNwdUdhdWdlID0gZ2F1Z2VGYWN0b3J5LmNyZWF0ZUdhdWdlKCdjcHUnLCAnQ1BVJywgMCwgMTAwLCAxODApLFxuICAgICAgICAgICAgICAgIG1lbUdhdWdlID0gZ2F1Z2VGYWN0b3J5LmNyZWF0ZUdhdWdlKCdtZW1vcnknLCAnTWVtb3J5JywgMCwgMTAwLCAxODApLFxuICAgICAgICAgICAgICAgIGRpc2tHYXVnZSA9IGdhdWdlRmFjdG9yeS5jcmVhdGVHYXVnZSgnZGlzaycsICdEaXNrJywgMCwgMTAwLCAxODApO1xuXG4gICAgICAgICAgICBzdGF0dXNTZXJ2aWNlLmdldFN0YXR1cygpLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnN0YXR1c0Vycm9yID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgdm0uc3RhdHVzID0gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICBjcHVHYXVnZS5yZWRyYXcocmVzdWx0LmdldENwdVVzYWdlKCkpO1xuICAgICAgICAgICAgICAgICAgICBtZW1HYXVnZS5yZWRyYXcocmVzdWx0LmdldE1lbVVzYWdlKCkpO1xuICAgICAgICAgICAgICAgICAgICBkaXNrR2F1Z2UucmVkcmF3KHJlc3VsdC5nZXREaXNrVXNhZ2UoKSk7XG4gICAgICAgICAgICAgICAgICAgIHZtLm1hc3RlclN0YXR1cyA9IHJlc3VsdC5tYXN0ZXIuaXNfb25saW5lID8gJ01hc3RlciBpcyBPbmxpbmUnIDogJ01hc3RlciBpcyBPZmZsaW5lJztcbiAgICAgICAgICAgICAgICAgICAgdm0ubWFzdGVyU3RhdHVzQ2xhc3MgPSByZXN1bHQubWFzdGVyLmlzX29ubGluZSA/ICdhbGVydC1zdWNjZXNzJyA6ICdhbGVydC1kYW5nZXInO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnNjaGVkdWxlci5pc19vbmxpbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlclN0YXR1cyA9IHJlc3VsdC5zY2hlZHVsZXIuaXNfcGF1c2VkID8gJ1NjaGVkdWxlciBpcyBQYXVzZWQnIDogJ1NjaGVkdWxlciBpcyBSdW5uaW5nJztcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlclN0YXR1c0NsYXNzID0gcmVzdWx0LnNjaGVkdWxlci5pc19wYXVzZWQgPyAnYWxlcnQtd2FybmluZycgOiAnYWxlcnQtc3VjY2Vzcyc7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zY2hlZHVsZXJJc1BhdXNlZCA9IHJlc3VsdC5zY2hlZHVsZXIuaXNfcGF1c2VkO1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2NoZWR1bGVyQnRuQ2xhc3MgPSByZXN1bHQuc2NoZWR1bGVyLmlzX3BhdXNlZCA/ICdmYS1wbGF5JyA6ICdmYS1wYXVzZSc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zY2hlZHVsZXJTdGF0dXMgPSByZXN1bHQuc2NoZWR1bGVyLmlzX3BhdXNlZCA/ICdTY2hlZHVsZXIgaXMgT2ZmbGluZTsgUGF1c2VkJyA6ICdTY2hlZHVsZXIgaXMgT2ZmbGluZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zY2hlZHVsZXJTdGF0dXNDbGFzcyA9ICdhbGVydC1kYW5nZXInO1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2NoZWR1bGVySXNQYXVzZWQgPSByZXN1bHQuc2NoZWR1bGVyLmlzX3BhdXNlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlckJ0bkNsYXNzID0gcmVzdWx0LnNjaGVkdWxlci5pc19wYXVzZWQgPyAnZmEtcGxheScgOiAnZmEtcGF1c2UnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQucmVzb3VyY2VzLnNjaGVkdWxlZC5tZW0gJiYgcmVzdWx0LnJlc291cmNlcy50b3RhbC5tZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLm1lbUNhbGMgPSBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tTWliKHJlc3VsdC5yZXNvdXJjZXMuc2NoZWR1bGVkLm1lbSkgKyAnIC8gJyArIHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21NaWIocmVzdWx0LnJlc291cmNlcy50b3RhbC5tZW0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQucmVzb3VyY2VzLnNjaGVkdWxlZC5kaXNrICYmIHJlc3VsdC5yZXNvdXJjZXMudG90YWwuZGlzaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uZGlza0NhbGMgPSBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tTWliKHJlc3VsdC5yZXNvdXJjZXMuc2NoZWR1bGVkLmRpc2spICsgJyAvICcgKyBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tTWliKHJlc3VsdC5yZXNvdXJjZXMudG90YWwuZGlzayk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2bS5zdGF0dXNFcnJvciA9IHJlc3VsdC5zdGF0dXNUZXh0ICYmIHJlc3VsdC5zdGF0dXNUZXh0ICE9PSAnJyA/IHJlc3VsdC5zdGF0dXNUZXh0IDogJ1VuYWJsZSB0byByZXRyaWV2ZSBjbHVzdGVyIHN0YXR1cy4nO1xuICAgICAgICAgICAgICAgICAgICBjcHVHYXVnZS5yZWRyYXcoLTEpO1xuICAgICAgICAgICAgICAgICAgICBtZW1HYXVnZS5yZWRyYXcoLTEpO1xuICAgICAgICAgICAgICAgICAgICBkaXNrR2F1Z2UucmVkcmF3KC0xKTtcbiAgICAgICAgICAgICAgICAgICAgdm0ubWFzdGVyU3RhdHVzID0gJ01hc3RlciBTdGF0dXMgaXMgVW5rbm93bic7XG4gICAgICAgICAgICAgICAgICAgIHZtLm1hc3RlclN0YXR1c0NsYXNzID0gJ2FsZXJ0LWRhbmdlcic7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlckNvbnRhaW5lckNsYXNzID0gJ2NvbC14cy0xMic7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlclN0YXR1cyA9ICdTY2hlZHVsZXIgU3RhdHVzIGlzIFVua25vd24nO1xuICAgICAgICAgICAgICAgICAgICB2bS5zY2hlZHVsZXJTdGF0dXNDbGFzcyA9ICdhbGVydC1kYW5nZXInO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nU3RhdHVzID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Tm9kZVN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG5vZGVTZXJ2aWNlLmdldE5vZGVTdGF0dXMobnVsbCwgbnVsbCwgJ1BUM0gnLCBudWxsKS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLm5vZGVIZWFsdGhFcnJvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHZtLm5vZGVzID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1c1RleHQgJiYgZGF0YS5zdGF0dXNUZXh0ICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubm9kZUhlYWx0aEVycm9yU3RhdHVzID0gZGF0YS5zdGF0dXNUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZtLm5vZGVIZWFsdGhFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgbm9kZXMuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ05vZGVIZWFsdGggPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCdqb2JUeXBlU3RhdHVzJywgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XG4gICAgICAgICAgICB2bS5qb2JEYXRhLnN0YXR1cyA9IGRhdGE7XG4gICAgICAgICAgICByZWRyYXdHcmlkKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZ2V0Sm9iVHlwZXMoKTtcbiAgICAgICAgICAgIGdldFN0YXR1cygpO1xuICAgICAgICAgICAgZ2V0Tm9kZVN0YXR1cygpO1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignb3ZlcnZpZXcnKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdyZWNpcGVEZXRhaWxzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlUGFyYW1zLCBuYXZTZXJ2aWNlLCByZWNpcGVTZXJ2aWNlLCBzY2FsZUNvbmZpZywgc3VibmF2U2VydmljZSwgdXNlclNlcnZpY2UpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLnJlY2lwZSA9IHt9O1xuICAgICAgICB2bS5yZWNpcGVJZCA9ICRyb3V0ZVBhcmFtcy5pZDtcbiAgICAgICAgdm0uc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5yZWNpcGVzO1xuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdyZWNpcGVzJyk7XG4gICAgICAgIHZtLmxvYWRpbmdSZWNpcGVEZXRhaWwgPSB0cnVlO1xuICAgICAgICB2bS5hY3RpdmVUYWIgPSAnc3RhdHVzJztcbiAgICAgICAgdm0ubGFzdFN0YXR1c0NoYW5nZSA9ICcnO1xuXG4gICAgICAgIHZtLmdldFJlY2lwZURldGFpbCA9IGZ1bmN0aW9uIChyZWNpcGVJZCkge1xuICAgICAgICAgICAgdm0ubG9hZGluZ1JlY2lwZURldGFpbCA9IHRydWU7XG4gICAgICAgICAgICByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZURldGFpbHMocmVjaXBlSWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5yZWNpcGUgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHJlY2lwZVNlcnZpY2UuZ2V0UmVjaXBlVHlwZURldGFpbChkYXRhLnJlY2lwZV90eXBlLmlkKS50aGVuKGZ1bmN0aW9uKHJlY2lwZVR5cGUpe1xuICAgICAgICAgICAgICAgICAgICB2bS5yZWNpcGVUeXBlID0gcmVjaXBlVHlwZTtcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ1JlY2lwZURldGFpbCA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ3JlY2lwZXMnKTtcbiAgICAgICAgICAgIHZtLmdldFJlY2lwZURldGFpbCh2bS5yZWNpcGVJZCk7XG4gICAgICAgIH07XG5cblxuXG4gICAgICAgIHZtLnN3aXRjaFRhYiA9IGZ1bmN0aW9uICh0YWIpIHtcbiAgICAgICAgICAgICQoJyMnICsgdm0uYWN0aXZlVGFiKS5oaWRlKCk7XG4gICAgICAgICAgICB2bS5hY3RpdmVUYWIgPSB0YWI7XG4gICAgICAgICAgICAkKCcjJyArIHZtLmFjdGl2ZVRhYikuc2hvdygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluaXRpYWxpemUoKTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ3JlY2lwZVR5cGVzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCAkdWliTW9kYWwsIGhvdGtleXMsIHNjYWxlU2VydmljZSwgbmF2U2VydmljZSwgcmVjaXBlU2VydmljZSwgc3VibmF2U2VydmljZSwgam9iVHlwZVNlcnZpY2UsIHNjYWxlQ29uZmlnLCBSZWNpcGVUeXBlLCB1c2VyU2VydmljZSwgbG9jYWxTdG9yYWdlKSB7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIFxuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgdm0uY29udGFpbmVyU3R5bGUgPSAnJztcbiAgICAgICAgdm0ucmVjaXBlVHlwZXMgPSBbXTtcbiAgICAgICAgdm0ucmVjaXBlVHlwZUlkcyA9IFtdO1xuICAgICAgICB2bS5yZXF1ZXN0ZWRSZWNpcGVUeXBlSWQgPSBwYXJzZUludCgkcm91dGVQYXJhbXMuaWQpO1xuICAgICAgICB2bS5hY3RpdmVSZWNpcGVUeXBlID0gbnVsbDtcbiAgICAgICAgdm0ucGVyY2VudGFnZSA9IDczO1xuICAgICAgICB2bS5kYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgdm0ucmVjaXBlcyA9IG51bGw7XG4gICAgICAgIHZtLm1vZGUgPSAndmlldyc7IC8vIHZhbGlkIHZhbHVlcyBhcmUgYWRkLCB2aWV3LCBhbmQgZWRpdFxuICAgICAgICB2bS5hZGRCdG5UZXh0ID0gJ05ldyBSZWNpcGUnO1xuICAgICAgICB2bS5hZGRCdG5DbGFzcyA9ICdidG4tcHJpbWFyeSc7XG4gICAgICAgIHZtLmFkZEJ0bkljb24gPSAnZmEtcGx1cy1jaXJjbGUnO1xuICAgICAgICB2bS5lZGl0QnRuVGV4dCA9ICdFZGl0JztcbiAgICAgICAgdm0uZWRpdEJ0bkNsYXNzID0gJ2J0bi1zdWNjZXNzJztcbiAgICAgICAgdm0uZWRpdEJ0bkljb24gPSAnZmEtZWRpdCc7XG4gICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMgPSBbXTtcbiAgICAgICAgdm0uaXNSZWNpcGVNb2RpZmllZCA9IGZhbHNlO1xuICAgICAgICB2bS5zYXZlQnRuQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICB2bS5tYXN0ZXJDbGFzcyA9ICdjb2wteHMtMyc7XG4gICAgICAgIHZtLmRldGFpbENsYXNzID0gJ2NvbC14cy05JztcbiAgICAgICAgdm0ubWluaW1pemVNYXN0ZXIgPSBmYWxzZTtcbiAgICAgICAgdm0ubWluaW1pemVCdG5DbGFzcyA9ICdmYSBmYS1jaGV2cm9uLWxlZnQnO1xuICAgICAgICB2bS51c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgIHZtLnNjYWxlQ29uZmlnID0gc2NhbGVDb25maWc7XG4gICAgICAgIHZtLmxvY2FsUmVjaXBlVHlwZXMgPSBbXTtcblxuICAgICAgICB2bS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLnJlY2lwZXM7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ3JlY2lwZXMvdHlwZXMnKTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ3JlY2lwZXMnKTtcbiAgICAgICAgICAgIGdldFJlY2lwZVR5cGVzKCk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2YXIgZ2V0UmVjaXBlVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZVR5cGVzKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZVR5cGVzID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgIGlmIChzY2FsZUNvbmZpZy5zdGF0aWMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgb0pzb24gPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNLZXk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoOyBzS2V5ID0gbG9jYWxTdG9yYWdlLmtleShpKTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvSnNvbltzS2V5XSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHNLZXkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF8uZmlsdGVyKF8ucGFpcnMob0pzb24pLCBmdW5jdGlvbiAobykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF8uY29udGFpbnMob1swXSwgJ3JlY2lwZVR5cGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0eXBlID0gSlNPTi5wYXJzZShvWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5sb2NhbFJlY2lwZVR5cGVzLnB1c2godHlwZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucmVjaXBlVHlwZXMucHVzaCh0eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLnJlY2lwZVR5cGVJZHMgPSBfLnBsdWNrKGRhdGEsICdpZCcpO1xuICAgICAgICAgICAgICAgIHZtLnZpZXdSZWNpcGVUeXBlRGV0YWlsKHZtLnJlcXVlc3RlZFJlY2lwZVR5cGVJZCk7XG4gICAgICAgICAgICAgICAgaG90a2V5cy5iaW5kVG8oJHNjb3BlKVxuICAgICAgICAgICAgICAgICAgICAuYWRkKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbWJvOiAnY3RybCt1cCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1ByZXZpb3VzIFJlY2lwZSBUeXBlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVJlY2lwZVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IF8uaW5kZXhPZih2bS5yZWNpcGVUeXBlSWRzLCB2bS5hY3RpdmVSZWNpcGVUeXBlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmxvYWRSZWNpcGVUeXBlKHZtLnJlY2lwZVR5cGVJZHNbaWR4IC0gMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KS5hZGQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tYm86ICdjdHJsK2Rvd24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdOZXh0IFJlY2lwZSBUeXBlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVJlY2lwZVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IF8uaW5kZXhPZih2bS5yZWNpcGVUeXBlSWRzLCB2bS5hY3RpdmVSZWNpcGVUeXBlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA8ICh2bS5yZWNpcGVUeXBlSWRzLmxlbmd0aCAtIDEpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5sb2FkUmVjaXBlVHlwZSh2bS5yZWNpcGVUeXBlSWRzW2lkeCArIDFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5jbGVhckxvY2FsUmVjaXBlVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfLmZvckVhY2godm0ubG9jYWxSZWNpcGVUeXBlcywgZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgncmVjaXBlVHlwZScgKyB0eXBlLmlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9yZWNpcGVzL3R5cGVzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ubmV3UmVjaXBlVHlwZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3JlY2lwZXMvdHlwZXMvMCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnZpZXdSZWNpcGVUeXBlRGV0YWlsID0gZnVuY3Rpb24gKHJlY2lwZVR5cGVJZCkge1xuICAgICAgICAgICAgaWYgKHJlY2lwZVR5cGVJZCA+IDApIHtcbiAgICAgICAgICAgICAgICByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZVR5cGVEZXRhaWwocmVjaXBlVHlwZUlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVJlY2lwZVR5cGUgPSBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmKCByZWNpcGVUeXBlSWQgPT09IDApIHtcbiAgICAgICAgICAgICAgICB2bS5hY3RpdmVSZWNpcGVUeXBlID0gbmV3IFJlY2lwZVR5cGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5sb2FkUmVjaXBlVHlwZSA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVJlY2lwZVR5cGUgJiYgdm0uYWN0aXZlUmVjaXBlVHlwZS5tb2RpZmllZCkge1xuICAgICAgICAgICAgICAgIGNvbmZpcm1DaGFuZ2VSZWNpcGUoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT0tcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9yZWNpcGVzL3R5cGVzLycgKyBpZCk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBDYW5jZWxcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3JlY2lwZXMvdHlwZXMvJyArIGlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY29uZmlybUNoYW5nZVJlY2lwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdm0uYW5pbWF0aW9uc0VuYWJsZWQsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb25maXJtRGlhbG9nLmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXG4gICAgICAgICAgICAgICAgc2l6ZTogJ3NtJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBtb2RhbEluc3RhbmNlLnJlc3VsdDtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVNYXN0ZXIgPSBmdW5jdGlvbiAobWluaW1pemVNYXN0ZXIpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgbWluaW1pemVNYXN0ZXIgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgdm0ubWluaW1pemVNYXN0ZXIgPSBtaW5pbWl6ZU1hc3RlcjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdm0ubWluaW1pemVNYXN0ZXIgPSAhdm0ubWluaW1pemVNYXN0ZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5tYXN0ZXJDbGFzcyA9IHZtLm1pbmltaXplTWFzdGVyID8gJ2NvbC14cy0xIG1pbmltaXplZCcgOiAnY29sLXhzLTMnO1xuICAgICAgICAgICAgdm0uZGV0YWlsQ2xhc3MgPSB2bS5taW5pbWl6ZU1hc3RlciA/ICdjb2wteHMtMTEnIDogJ2NvbC14cy05JztcbiAgICAgICAgICAgIHZtLm1pbmltaXplQnRuQ2xhc3MgPSB2bS5taW5pbWl6ZU1hc3RlciA/ICdmYSBmYS1jaGV2cm9uLXJpZ2h0JyA6ICdmYSBmYS1jaGV2cm9uLWxlZnQnO1xuICAgICAgICB9O1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCd0b2dnbGVFZGl0JywgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XG4gICAgICAgICAgICB2bS50b2dnbGVNYXN0ZXIoZGF0YSA9PT0gJ2VkaXQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCdyZWNpcGVNb2RpZmllZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmlzUmVjaXBlTW9kaWZpZWQgPSB0cnVlO1xuICAgICAgICAgICAgdm0uc2F2ZUJ0bkNsYXNzID0gJ2J0bi1zdWNjZXNzJztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBzZXQgY29udGFpbmVyIGhlaWdodHMgZXF1YWwgdG8gYXZhaWxhYmxlIHBhZ2UgaGVpZ2h0XG4gICAgICAgICAgICB2YXIgdmlld3BvcnQgPSBzY2FsZVNlcnZpY2UuZ2V0Vmlld3BvcnRTaXplKCksXG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gc2NhbGVDb25maWcuaGVhZGVyT2Zmc2V0LFxuICAgICAgICAgICAgICAgIGNvbnRhaW5lck1heEhlaWdodCA9IHZpZXdwb3J0LmhlaWdodCAtIG9mZnNldDtcblxuICAgICAgICAgICAgdm0uY29udGFpbmVyU3R5bGUgPSAnaGVpZ2h0OiAnICsgY29udGFpbmVyTWF4SGVpZ2h0ICsgJ3B4OyBtYXgtaGVpZ2h0OiAnICsgY29udGFpbmVyTWF4SGVpZ2h0ICsgJ3B4Oyc7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ3JlY2lwZXNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBzdGF0ZVNlcnZpY2UsIHJlY2lwZVNlcnZpY2UsIG5hdlNlcnZpY2UsIHN1Ym5hdlNlcnZpY2UsIGdyaWRGYWN0b3J5KSB7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ3JlY2lwZXMnKTtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgcmVjaXBlVHlwZVZpZXdBbGwgPSB7IG5hbWU6ICdWSUVXIEFMTCcsIHRpdGxlOiAnVklFVyBBTEwnLCB2ZXJzaW9uOiAnJywgaWQ6IDAgfTtcblxuICAgICAgICB2bS5yZWNpcGVzUGFyYW1zID0gc3RhdGVTZXJ2aWNlLmdldFJlY2lwZXNQYXJhbXMoKTtcblxuICAgICAgICB2bS5zdGF0ZVNlcnZpY2UgPSBzdGF0ZVNlcnZpY2U7XG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICB2bS5yZWNpcGVUeXBlVmFsdWVzID0gW3JlY2lwZVR5cGVWaWV3QWxsXTtcbiAgICAgICAgdm0uc2VsZWN0ZWRSZWNpcGVUeXBlID0gdm0ucmVjaXBlc1BhcmFtcy50eXBlX2lkID8gdm0ucmVjaXBlc1BhcmFtcy50eXBlX2lkIDogcmVjaXBlVHlwZVZpZXdBbGw7XG4gICAgICAgIHZtLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3MucmVjaXBlcztcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnQgPSBtb21lbnQudXRjKHZtLnJlY2lwZXNQYXJhbXMuc3RhcnRlZCkudG9EYXRlKCk7XG4gICAgICAgIHZtLmxhc3RNb2RpZmllZFN0YXJ0UG9wdXAgPSB7XG4gICAgICAgICAgICBvcGVuZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHZtLm9wZW5MYXN0TW9kaWZpZWRTdGFydFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RhcnRQb3B1cC5vcGVuZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICB2bS5sYXN0TW9kaWZpZWRTdG9wID0gbW9tZW50LnV0Yyh2bS5yZWNpcGVzUGFyYW1zLmVuZGVkKS50b0RhdGUoKTtcbiAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RvcFBvcHVwID0ge1xuICAgICAgICAgICAgb3BlbmVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICB2bS5vcGVuTGFzdE1vZGlmaWVkU3RvcFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgdm0ubGFzdE1vZGlmaWVkU3RvcFBvcHVwLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgIHZtLmRhdGVNb2RlbE9wdGlvbnMgPSB7XG4gICAgICAgICAgICB0aW1lem9uZTogJyswMDAnXG4gICAgICAgIH07XG4gICAgICAgIHZtLmdyaWRPcHRpb25zID0gZ3JpZEZhY3RvcnkuZGVmYXVsdEdyaWRPcHRpb25zKCk7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25DdXJyZW50UGFnZSA9IHZtLnJlY2lwZXNQYXJhbXMucGFnZSB8fCAxO1xuICAgICAgICB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemUgPSB2bS5yZWNpcGVzUGFyYW1zLnBhZ2Vfc2l6ZSB8fCB2bS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgIHZtLmdyaWRPcHRpb25zLmRhdGEgPSBbXTtcblxuICAgICAgICB2YXIgZmlsdGVyZWRCeVJlY2lwZVR5cGUgPSB2bS5yZWNpcGVzUGFyYW1zLnR5cGVfaWQgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICBmaWx0ZXJlZEJ5T3JkZXIgPSB2bS5yZWNpcGVzUGFyYW1zLm9yZGVyID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgIHZtLmNvbERlZnMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdyZWNpcGVfdHlwZScsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdSZWNpcGUgVHlwZScsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPnt7IHJvdy5lbnRpdHkucmVjaXBlX3R5cGUudGl0bGUgfX0ge3sgcm93LmVudGl0eS5yZWNpcGVfdHlwZS52ZXJzaW9uIH19PC9kaXY+JyxcbiAgICAgICAgICAgICAgICBmaWx0ZXJIZWFkZXJUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWZpbHRlci1jb250YWluZXJcIj48c2VsZWN0IGNsYXNzPVwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIgbmctbW9kZWw9XCJncmlkLmFwcFNjb3BlLnZtLnNlbGVjdGVkUmVjaXBlVHlwZVwiIG5nLW9wdGlvbnM9XCJyZWNpcGVUeXBlIGFzIChyZWNpcGVUeXBlLnRpdGxlICsgXFwnIFxcJyArIHJlY2lwZVR5cGUudmVyc2lvbikgZm9yIHJlY2lwZVR5cGUgaW4gZ3JpZC5hcHBTY29wZS52bS5yZWNpcGVUeXBlVmFsdWVzXCI+PC9zZWxlY3Q+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2NyZWF0ZWQnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnQ3JlYXRlZCAoWiknLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPnt7IHJvdy5lbnRpdHkuY3JlYXRlZF9mb3JtYXR0ZWQgfX08L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnbGFzdF9tb2RpZmllZCcsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdMYXN0IE1vZGlmaWVkIChaKScsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+e3sgcm93LmVudGl0eS5sYXN0X21vZGlmaWVkX2Zvcm1hdHRlZCB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdkdXJhdGlvbicsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlbmFibGVTb3J0aW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB3aWR0aDogMTIwLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHMgdGV4dC1yaWdodFwiPnt7IHJvdy5lbnRpdHkuZ2V0RHVyYXRpb24oKSB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdjb21wbGV0ZWQnLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgZW5hYmxlU29ydGluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+e3sgcm93LmVudGl0eS5jb21wbGV0ZWRfZm9ybWF0dGVkIH19PC9kaXY+J1xuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuXG4gICAgICAgIHZtLmdldFJlY2lwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZXModm0ucmVjaXBlc1BhcmFtcykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLm1pblJvd3NUb1Nob3cgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZtLmdyaWRPcHRpb25zLnZpcnR1YWxpemF0aW9uVGhyZXNob2xkID0gZGF0YS5yZXN1bHRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy50b3RhbEl0ZW1zID0gZGF0YS5jb3VudDtcbiAgICAgICAgICAgICAgICB2bS5ncmlkT3B0aW9ucy5kYXRhID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uZ2V0UmVjaXBlVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZVR5cGVzKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZVR5cGVWYWx1ZXMucHVzaChkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZVR5cGVWYWx1ZXMgPSBfLmZsYXR0ZW4odm0ucmVjaXBlVHlwZVZhbHVlcyk7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZWNpcGVUeXBlID0gXy5maW5kKHZtLnJlY2lwZVR5cGVWYWx1ZXMsIHsgaWQ6IHZtLnJlY2lwZXNQYXJhbXMudHlwZV9pZCB9KSB8fCByZWNpcGVUeXBlVmlld0FsbDtcbiAgICAgICAgICAgICAgICB2bS5nZXRSZWNpcGVzKCk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5maWx0ZXJSZXN1bHRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldFJlY2lwZXNQYXJhbXModm0ucmVjaXBlc1BhcmFtcyk7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLmdldFJlY2lwZXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVDb2xEZWZzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IGdyaWRGYWN0b3J5LmFwcGx5U29ydENvbmZpZyh2bS5jb2xEZWZzLCB2bS5yZWNpcGVzUGFyYW1zKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS51cGRhdGVSZWNpcGVPcmRlciA9IGZ1bmN0aW9uIChzb3J0QXJyKSB7XG4gICAgICAgICAgICB2bS5yZWNpcGVzUGFyYW1zLm9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwID8gc29ydEFyciA6IG51bGw7XG4gICAgICAgICAgICBmaWx0ZXJlZEJ5T3JkZXIgPSBzb3J0QXJyLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0udXBkYXRlUmVjaXBlVHlwZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlLmlkICE9PSB2bS5yZWNpcGVzUGFyYW1zLnR5cGVfaWQpIHtcbiAgICAgICAgICAgICAgICB2bS5yZWNpcGVzUGFyYW1zLnBhZ2UgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0ucmVjaXBlc1BhcmFtcy50eXBlX2lkID0gdmFsdWUuaWQgPT09IDAgPyBudWxsIDogdmFsdWUuaWQ7XG4gICAgICAgICAgICB2bS5yZWNpcGVzUGFyYW1zLnBhZ2Vfc2l6ZSA9IHZtLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS5ncmlkT3B0aW9ucy5vblJlZ2lzdGVyQXBpID0gZnVuY3Rpb24gKGdyaWRBcGkpIHtcbiAgICAgICAgICAgIC8vc2V0IGdyaWRBcGkgb24gc2NvcGVcbiAgICAgICAgICAgIHZtLmdyaWRBcGkgPSBncmlkQXBpO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3JlY2lwZXMvcmVjaXBlLycgKyByb3cuZW50aXR5LmlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdm0uZ3JpZEFwaS5wYWdpbmF0aW9uLm9uLnBhZ2luYXRpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZXNQYXJhbXMucGFnZSA9IGN1cnJlbnRQYWdlO1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZXNQYXJhbXMucGFnZV9zaXplID0gcGFnZVNpemU7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2bS5ncmlkQXBpLmNvcmUub24uc29ydENoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoZ3JpZCwgc29ydENvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godm0uZ3JpZEFwaS5ncmlkLmNvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sLmNvbERlZi5zb3J0ID0gY29sLnNvcnQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldFJlY2lwZXNDb2xEZWZzKHZtLmdyaWRBcGkuZ3JpZC5vcHRpb25zLmNvbHVtbkRlZnMpO1xuICAgICAgICAgICAgICAgIHZhciBzb3J0QXJyID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHNvcnRDb2x1bW5zLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvcnRBcnIucHVzaChjb2wuc29ydC5kaXJlY3Rpb24gPT09ICdkZXNjJyA/ICctJyArIGNvbC5maWVsZCA6IGNvbC5maWVsZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0udXBkYXRlUmVjaXBlT3JkZXIoc29ydEFycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc3RhdGVTZXJ2aWNlLnNldFJlY2lwZXNQYXJhbXModm0ucmVjaXBlc1BhcmFtcyk7XG4gICAgICAgICAgICB2bS51cGRhdGVDb2xEZWZzKCk7XG4gICAgICAgICAgICB2bS5nZXRSZWNpcGVUeXBlcygpO1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbigncmVjaXBlcycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmluaXRpYWxpemUoKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5zZWxlY3RlZFJlY2lwZVR5cGUnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChwYXJzZUludCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IF8uZmluZCh2bS5yZWNpcGVUeXBlVmFsdWVzLCB7aWQ6IHBhcnNlSW50KHZhbHVlKX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkQnlSZWNpcGVUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS51cGRhdGVSZWNpcGVUeXBlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkQnlSZWNpcGVUeXBlID0gIWFuZ3VsYXIuZXF1YWxzKHZhbHVlLCByZWNpcGVUeXBlVmlld0FsbCk7XG4gICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0ZVJlY2lwZVR5cGUodmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0ubGFzdE1vZGlmaWVkU3RhcnQnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghdm0ubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHZtLnJlY2lwZXNQYXJhbXMuc3RhcnRlZCA9IHZhbHVlLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5sYXN0TW9kaWZpZWRTdG9wJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIXZtLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICB2bS5yZWNpcGVzUGFyYW1zLmVuZGVkID0gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5zdGF0ZVNlcnZpY2UuZ2V0UmVjaXBlc0NvbERlZnMoKScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uY29sRGVmcyA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgdm0udXBkYXRlQ29sRGVmcygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigndm0uc3RhdGVTZXJ2aWNlLmdldFJlY2lwZXNQYXJhbXMoKScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0ucmVjaXBlc1BhcmFtcyA9IG5ld1ZhbHVlO1xuICAgICAgICAgICAgdm0udXBkYXRlQ29sRGVmcygpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7IiwiLyoqXG4gKiA8YWlzLXNjYWxlLXJlY2lwZS12aWV3ZXIgLz5cbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhaXNTY2FsZVJlY2lwZUdyYXBoVmlld2VyQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRsb2NhdGlvbiwgJHVpYk1vZGFsLCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBqb2JUeXBlU2VydmljZSwgcmVjaXBlU2VydmljZSwgd29ya3NwYWNlc1NlcnZpY2UsIFJlY2lwZVR5cGUsIFJlY2lwZVR5cGVEZXRhaWwsIEpvYlR5cGUsIGxvY2FsU3RvcmFnZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0udmVydGljZXMgPSBbXTtcbiAgICAgICAgdm0uZWRnZXMgPSBbXTtcbiAgICAgICAgdm0uc2VsZWN0ZWRKb2IgPSBudWxsO1xuICAgICAgICB2bS5zZWxlY3RlZElucHV0UHJvdmlkZXIgPSBudWxsO1xuICAgICAgICB2bS5tb2RlID0gbnVsbDtcbiAgICAgICAgdm0uZWRpdE1vZGUgPSBudWxsO1xuICAgICAgICB2bS5kZXBlbmRlbmN5QnRuQ2xhc3MgPSAnZmEtcGx1cyc7XG4gICAgICAgIHZtLmFkZEJ0blRleHQgPSAnTmV3IFJlY2lwZSc7XG4gICAgICAgIHZtLmFkZEJ0bkNsYXNzID0gJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgdm0uYWRkQnRuSWNvbiA9ICdmYS1wbHVzLWNpcmNsZSc7XG4gICAgICAgIHZtLmVkaXRCdG5UZXh0ID0gJ0VkaXQnO1xuICAgICAgICB2bS5lZGl0QnRuQ2xhc3MgPSAnYnRuLXN1Y2Nlc3MnO1xuICAgICAgICB2bS5lZGl0QnRuSWNvbiA9ICdmYS1lZGl0JztcbiAgICAgICAgdm0uam9iVHlwZVZhbHVlcyA9IFtdO1xuICAgICAgICB2bS5zYXZlQnRuQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICB2bS5zYXZpbmdSZWNpcGUgPSBmYWxzZTtcbiAgICAgICAgdm0ud2FybmluZ3MgPSBbXTtcbiAgICAgICAgdm0ucmVhZG9ubHkgPSB0cnVlO1xuICAgICAgICB2bS5kZXRhaWxNYXhIZWlnaHQgPSAwO1xuICAgICAgICB2bS5yZWNpcGVUeXBlVHJpZ2dlciA9IHsgZGF0YVR5cGVzOiAnJyB9O1xuICAgICAgICB2bS5kZXRhaWxDb250YWluZXJTdHlsZSA9ICcnO1xuICAgICAgICB2bS5jb250YWluZXJDbGFzcyA9ICRzY29wZS5oYXNDb250YWluZXIgPyAnJyA6ICdkZXRhaWwtY29udGFpbmVyIG5vLXRhYnMnO1xuICAgICAgICB2bS5sYXN0U3RhdHVzQ2hhbmdlID0gJyc7XG4gICAgICAgIHZtLmF2YWlsYWJsZVdvcmtzcGFjZXMgPSBbXTtcbiAgICAgICAgdm0ucmVjaXBlSW5wdXRUeXBlcyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAncHJvcGVydHknLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnUHJvcGVydHknLFxuICAgICAgICAgICAgICAgIGZpZWxkczogW11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ2ZpbGUnLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnRmlsZScsXG4gICAgICAgICAgICAgICAgZmllbGRzOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdtZWRpYV90eXBlcycsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ01lZGlhIFR5cGVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBbXVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZmlsZXMnLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnRmlsZXMnLFxuICAgICAgICAgICAgICAgIGZpZWxkczogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnbWVkaWFfdHlwZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdNZWRpYSBUeXBlcycsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogW11cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH1cbiAgICAgICAgXTtcbiAgICAgICAgdm0uYXZhaWxhYmxlVHJpZ2dlclR5cGVzID0gc2NhbGVDb25maWcudHJpZ2dlclR5cGVzO1xuICAgICAgICB2bS5zZWxlY3RlZFJlY2lwZUlucHV0VHlwZSA9IHt9O1xuICAgICAgICB2bS5yZWNpcGVJbnB1dCA9IHtcbiAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICB0eXBlOiAnJ1xuICAgICAgICB9O1xuICAgICAgICB2bS5pc0lFID0gc2NhbGVTZXJ2aWNlLmlzSUUoKTtcblxuICAgICAgICB2YXIgc3RhcnRKb2IgPSBudWxsO1xuICAgICAgICB2YXIgem9vbVNjYWxlID0gMDtcblxuICAgICAgICAvLyBEYWdyZSB2YXJpYWJsZXNcbiAgICAgICAgdmFyIHN2ZyA9IG51bGw7XG4gICAgICAgIHZhciBpbm5lciA9IG51bGw7XG4gICAgICAgIHZhciBncmFwaCA9IG51bGw7XG4gICAgICAgIHZhciB6b29tID0gbnVsbDtcbiAgICAgICAgdmFyIHJlbmRlciA9IG51bGw7XG5cbiAgICAgICAgdmFyIGdldENsb3Nlc3ROb2RlID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBkMy5zZWxlY3RBbGwoJy5ub2RlUmVjdCcpLmZpbHRlcihmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkID09PSBuYW1lO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldE90aGVyTm9kZXMgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIGQzLnNlbGVjdEFsbCgnLm5vZGVSZWN0JykuZmlsdGVyKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQgIT09IG5hbWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgcmVzZXRFZGl0QnRuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uZWRpdEJ0blRleHQgPSB2bS5tb2RlID09PSAnZWRpdCcgPyAnQ2FuY2VsIEVkaXQnIDogJ0VkaXQnO1xuICAgICAgICAgICAgdm0uZWRpdEJ0bkNsYXNzID0gdm0ubW9kZSA9PT0gJ2VkaXQnID8gJ2J0bi13YXJuaW5nJyA6ICdidG4tc3VjY2Vzcyc7XG4gICAgICAgICAgICB2bS5lZGl0QnRuSWNvbiA9IHZtLm1vZGUgPT09ICdlZGl0JyA/ICdmYS1jbG9zZScgOiAnZmEtZWRpdCc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHJlc2V0QWRkQnRuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uYWRkQnRuVGV4dCA9IHZtLm1vZGUgPT09ICdhZGQnID8gJ0NhbmNlbCcgOiAnTmV3IFJlY2lwZSc7XG4gICAgICAgICAgICB2bS5hZGRCdG5DbGFzcyA9IHZtLm1vZGUgPT09ICdhZGQnID8gJ2J0bi13YXJuaW5nJyA6ICdidG4tcHJpbWFyeSc7XG4gICAgICAgICAgICB2bS5hZGRCdG5JY29uID0gdm0ubW9kZSA9PT0gJ2FkZCcgPyAnZmEtY2xvc2UnIDogJ2ZhLXBsdXMtY2lyY2xlJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgdG9nZ2xlQWRkUmVjaXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0ubW9kZSA9IHZtLm1vZGUgPT09ICdhZGQnID8gJ3ZpZXcnIDogJ2FkZCc7XG4gICAgICAgICAgICByZXNldEFkZEJ0bigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciB0b2dnbGVFZGl0UmVjaXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHZtLm1vZGUgPT09ICdlZGl0Jykge1xuICAgICAgICAgICAgICAgIHZtLm1vZGUgPSAndmlldyc7XG4gICAgICAgICAgICAgICAgdm0ucmVsb2FkUmVjaXBlVHlwZURldGFpbCgkc2NvcGUucmVjaXBlVHlwZS5pZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLm1vZGUgPSAnZWRpdCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5lZGl0TW9kZSA9ICcnO1xuICAgICAgICAgICAgcmVzZXRFZGl0QnRuKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGVuYWJsZVNhdmVSZWNpcGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc2NvcGUucmVjaXBlVHlwZS5tb2RpZmllZCA9IHRydWU7XG4gICAgICAgICAgICB2bS5zYXZlQnRuQ2xhc3MgPSAnYnRuLXN1Y2Nlc3MnO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBkaXNhYmxlU2F2ZVJlY2lwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5yZWNpcGVUeXBlLm1vZGlmaWVkID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5zYXZlQnRuQ2xhc3MgPSAnYnRuLWRlZmF1bHQ7J1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBjb25maXJtQ2hhbmdlUmVjaXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB2bS5hbmltYXRpb25zRW5hYmxlZCxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbmZpcm1EaWFsb2cuaHRtbCcsXG4gICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZSxcbiAgICAgICAgICAgICAgICBzaXplOiAnc20nXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIG1vZGFsSW5zdGFuY2UucmVzdWx0O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRSZWNpcGVUeXBlSm9iQ2xhc3NOYW1lID0gZnVuY3Rpb24gKGpvYikge1xuICAgICAgICAgICAgLy8gZGVmYXVsdCB0byAnbm9zdGF0dXMnXG4gICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gJ25vc3RhdHVzJztcbiAgICAgICAgICAgIC8vIGZpbmQgdGhlIGFzc29jaWF0ZWQgam9iIGluIHRoZSByZWNpcGUuam9ic1xuICAgICAgICAgICAgaWYgKCRzY29wZS5yZWNpcGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVjaXBlam9iID0gXy5maW5kKCRzY29wZS5yZWNpcGUuam9icyx7am9iX25hbWU6IGpvYi5uYW1lfSk7XG4gICAgICAgICAgICAgICAgaWYgKHJlY2lwZWpvYikge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSByZWNpcGVqb2Iuam9iLnN0YXR1cy50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjbGFzc05hbWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ucmVsb2FkUmVjaXBlVHlwZURldGFpbCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgdmFyIGdldFJlY2lwZURldGFpbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZWNpcGVTZXJ2aWNlLmdldFJlY2lwZVR5cGVEZXRhaWwoaWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUgPSBkYXRhO1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnJlY2lwZVR5cGUubW9kaWZpZWQpIHtcbiAgICAgICAgICAgICAgICBjb25maXJtQ2hhbmdlUmVjaXBlKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE9LXG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc2V0QWRkQnRuKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5tb2RlID09PSAnZWRpdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUVkaXRSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBnZXRSZWNpcGVEZXRhaWwoKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIENhbmNlbFxuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh2bS5tb2RlID09PSAnZWRpdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlRWRpdFJlY2lwZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNldEFkZEJ0bigpO1xuICAgICAgICAgICAgICAgIGdldFJlY2lwZURldGFpbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnJlZHJhdyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGluaXRpYWxpemUoKTtcbiAgICAgICAgICAgIC8vJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWNpcGVNb2RpZmllZCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLm5vZGVDbGljayA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICAvLyBSZW1vdmUgc2VsZWN0aW9uIGNsYXNzXG4gICAgICAgICAgICAvLyQoJ2RpdicpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZC1ub2RlJyk7XG4gICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5ub2RlUmVjdCcpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUnLCBmYWxzZSk7XG5cbiAgICAgICAgICAgIC8vIGZpbmQgdGhlIGpvYiBpbiB0aGUgcmVjaXBlIGRlZmluaXRpb25cbiAgICAgICAgICAgIHZhciBqb2IgPSBfLmZpbmQoJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCB7IG5hbWU6IG5hbWUgfSk7XG5cbiAgICAgICAgICAgIGlmIChuYW1lID09PSAnc3RhcnQnKSB7XG4gICAgICAgICAgICAgICAgam9iID0gc3RhcnRKb2I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgJG5hbWUgPSAkKCcjJyArIG5hbWUpO1xuICAgICAgICAgICAgdmFyIHBvcyA9ICRuYW1lLnBvc2l0aW9uKCk7XG5cbiAgICAgICAgICAgIC8vIGNsaWNrIG5vZGUgZGlmZmVyZW50IGZyb20gc2VsZWN0ZWRKb2JcbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWRKb2IgfHwgam9iLm5hbWUgIT09IHZtLnNlbGVjdGVkSm9iLm5hbWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0uZWRpdE1vZGUgPT09ICdhZGREZXBlbmRlbmN5Jykge1xuICAgICAgICAgICAgICAgICAgICBhZGREZXBlbmRlbmN5KG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgICAgIHZtLnJlZHJhdygpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2bS5lZGl0TW9kZSA9PT0gJ2FkZElucHV0Jykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudFN0ciA9ICcnO1xuICAgICAgICAgICAgICAgICAgICBpZiAoam9iLm5hbWUgPT09ICdzdGFydCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSAnPHVsIGNsYXNzPVwibGlzdC1ncm91cFwiPic7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5pbnB1dF9kYXRhLCBmdW5jdGlvbiAocmVjaXBlSW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gY29udGVudFN0ciArICc8bGkgY2xhc3M9XCJsaXN0LWdyb3VwLWl0ZW1cIj4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzxhIG9uY2xpY2s9XCJtYXBJbnB1dFJlY2lwZUlucHV0KFxcJycgKyByZWNpcGVJbnB1dC5uYW1lICsgJ1xcJylcIj4nICsgcmVjaXBlSW5wdXQubmFtZSArICc8L2E+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVjaXBlSW5wdXQubWVkaWFfdHlwZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9IGNvbnRlbnRTdHIgKyAnPGRpdiBjbGFzcz1cImlucHV0LW1lZGlhLXR5cGVzXCI+JyArIHJlY2lwZUlucHV0Lm1lZGlhX3R5cGVzLmpvaW4oJywnKSArICc8L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gY29udGVudFN0ciArICc8L2xpPic7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzwvdWw+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lLnBvcG92ZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogJ2JvZHknLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnRTdHIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1NlbGVjdCBwcm92aWRlci9vdXRwdXQnXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lLnBvcG92ZXIoJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqb2Iuam9iX3R5cGUuam9iX3R5cGVfaW50ZXJmYWNlLm91dHB1dF9kYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gJzx1bCBjbGFzcz1cImxpc3QtZ3JvdXBcIj4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChqb2Iuam9iX3R5cGUuam9iX3R5cGVfaW50ZXJmYWNlLm91dHB1dF9kYXRhLCBmdW5jdGlvbiAoam9iT3V0cHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzxsaSBjbGFzcz1cImxpc3QtZ3JvdXAtaXRlbVwiPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzxhIG9uY2xpY2s9XCJtYXBJbnB1dChcXCcnICsgam9iLm5hbWUgKyAnXFwnLCBcXCcnICsgam9iT3V0cHV0Lm5hbWUgKyAnXFwnKVwiPicgKyBqb2JPdXRwdXQubmFtZSArICc8L2E+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpvYk91dHB1dC5tZWRpYV90eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gY29udGVudFN0ciArICc8ZGl2IGNsYXNzPVwiaW5wdXQtbWVkaWEtdHlwZXNcIj4nICsgam9iT3V0cHV0Lm1lZGlhX3R5cGUgKyAnPC9kaXY+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gY29udGVudFN0ciArICc8L2xpPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9IGNvbnRlbnRTdHIgKyAnPC91bD4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lLnBvcG92ZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6ICdib2R5JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogY29udGVudFN0cixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdTZWxlY3QgcHJvdmlkZXIvb3V0cHV0J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lLnBvcG92ZXIoJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodm0uZWRpdE1vZGUgPT09ICdhZGRPdXRwdXQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkT3V0cHV0UmVjZWl2ZXIgPSBqb2I7XG4gICAgICAgICAgICAgICAgICAgIGlmIChqb2Iuam9iX3R5cGUuam9iX3R5cGVfaW50ZXJmYWNlLmlucHV0X2RhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9ICc8dWwgY2xhc3M9XCJsaXN0LWdyb3VwXCI+JztcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChqb2Iuam9iX3R5cGUuam9iX3R5cGVfaW50ZXJmYWNlLmlucHV0X2RhdGEsIGZ1bmN0aW9uIChqb2JJbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzxsaSBjbGFzcz1cImxpc3QtZ3JvdXAtaXRlbVwiPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9IGNvbnRlbnRTdHIgKyAnPGEgb25jbGljaz1cIm1hcE91dHB1dChcXCcnICsgam9iLm5hbWUgKyAnXFwnLCBcXCcnICsgam9iSW5wdXQubmFtZSArICdcXCcpXCI+JyArIGpvYklucHV0Lm5hbWUgKyAnPC9hPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpvYklucHV0Lm1lZGlhX3R5cGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRTdHIgPSBjb250ZW50U3RyICsgJzxkaXYgY2xhc3M9XCJpbnB1dC1tZWRpYS10eXBlc1wiPicgKyBqb2JJbnB1dC5tZWRpYV90eXBlcy5qb2luKCcsJykgKyAnPC9kaXY+JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFN0ciA9IGNvbnRlbnRTdHIgKyAnPC9saT4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50U3RyID0gY29udGVudFN0ciArICc8L3VsPic7XG4gICAgICAgICAgICAgICAgICAgICAgICAkbmFtZS5wb3BvdmVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6ICdib2R5JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBjb250ZW50U3RyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh0bWw6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdTZWxlY3QgcmVjZWl2ZXIvaW5wdXQnXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lLnBvcG92ZXIoJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSB0aGUgc2VsZWN0ZWQgam9iXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkSm9iID0gam9iO1xuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnJlY2lwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZWNpcGVKb2IgPSBfLmZpbmQoJHNjb3BlLnJlY2lwZS5qb2JzLCB7IGpvYl9uYW1lOiBqb2IubmFtZSB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBhcHBseSB0aGUgc2VsZWN0ZWQtbm9kZSBjbGFzc1xuICAgICAgICAgICAgICAgICAgICAvLyRuYW1lLmFkZENsYXNzKCdzZWxlY3RlZC1ub2RlJyk7XG4gICAgICAgICAgICAgICAgICAgIGdldENsb3Nlc3ROb2RlKG5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHsgLy8gY2xpY2sgc2VsZWN0ZWQgbm9kZVxuICAgICAgICAgICAgICAgIC8vJCgnZGl2JykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUnKTtcbiAgICAgICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5ub2RlUmVjdCcpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRKb2IgPSBudWxsO1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkUmVjaXBlSm9iID0gbnVsbDtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZE91dHB1dFJlY2VpdmVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZElucHV0UHJvdmlkZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgIHZtLmVkaXRNb2RlID0gJyc7XG4gICAgICAgICAgICAgICAgdm0uZGVwZW5kZW5jeUJ0bkNsYXNzID0gJ2ZhLXBsdXMnO1xuXG4gICAgICAgICAgICAgICAgLy8kKCcucmVjaXBlTm9kZTpub3QoXCIuc2VsZWN0ZWQtbm9kZVwiKScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZC1ub2RlLXNlbGVjdGFibGUnKTtcbiAgICAgICAgICAgICAgICBnZXRPdGhlck5vZGVzKG5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScsIGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZEpvYikge1xuICAgICAgICAgICAgICAgIC8vJCgnIycgKyB2bS5zZWxlY3RlZEpvYi5uYW1lKS5hZGRDbGFzcygnc2VsZWN0ZWQtbm9kZScpO1xuICAgICAgICAgICAgICAgIGdldENsb3Nlc3ROb2RlKHZtLnNlbGVjdGVkSm9iLm5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUnLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdm0udG9nZ2xlRWRpdE1vZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodm0ubW9kZSA9PT0gJ2VkaXQnKSB7XG4gICAgICAgICAgICAgICAgdm0ucmVsb2FkUmVjaXBlVHlwZURldGFpbCgkc2NvcGUucmVjaXBlVHlwZS5pZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRvZ2dsZUVkaXRSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICByZXNldEFkZEJ0bigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd0b2dnbGVFZGl0Jywgdm0ubW9kZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ub3BlbkFkZEpvYiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdm0uYW5pbWF0aW9uc0VuYWJsZWQsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhZGRKb2JDb250ZW50Lmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXG4gICAgICAgICAgICAgICAgc2l6ZTogJ3NtJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZEpvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgam9iVHlwZVNlcnZpY2UuZ2V0Sm9iVHlwZURldGFpbHModm0uc2VsZWN0ZWRKb2JUeXBlLmlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5hZGRKb2JUeXBlKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlU2F2ZVJlY2lwZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLm9wZW5FZGl0VHJpZ2dlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdm0uYW5pbWF0aW9uc0VuYWJsZWQsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdlZGl0VHJpZ2dlci5odG1sJyxcbiAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgIHNpemU6ICdtZCdcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodm0ubW9kZSA9PT0gJ2VkaXQnIHx8IHZtLm1vZGUgPT09ICdhZGQnKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZWNpcGVUeXBlLnRyaWdnZXJfcnVsZS5jb25maWd1cmF0aW9uLmNvbmRpdGlvbi5kYXRhX3R5cGVzID0gdm0ucmVjaXBlVHlwZVRyaWdnZXIuZGF0YVR5cGVzID8gdm0ucmVjaXBlVHlwZVRyaWdnZXIuZGF0YVR5cGVzLnNwbGl0KCcsJykgOiBbXTtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlU2F2ZVJlY2lwZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmRlbGV0ZVJlY2lwZUlucHV0ID0gZnVuY3Rpb24gKGlucHV0TmFtZSkge1xuICAgICAgICAgICAgdmFyIHJlbW92ZWRSZWNpcGVJbnB1dCA9IF8ucmVtb3ZlKCRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24uaW5wdXRfZGF0YSwgZnVuY3Rpb24gKHJlY2lwZUlucHV0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY2lwZUlucHV0Lm5hbWUgPT09IGlucHV0TmFtZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlbW92ZWQgJyArIHJlbW92ZWRSZWNpcGVJbnB1dC5sZW5ndGggKyAnIHJlY2lwZSBpbnB1dHMuJyk7XG4gICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICB2bS5yZWRyYXcoKTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLm9wZW5BZGRJbnB1dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdm0uYW5pbWF0aW9uc0VuYWJsZWQsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhZGRJbnB1dC5odG1sJyxcbiAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgZm9yIGZpZWxkcyBhbmQgYWRkIGFzIG5lY2Vzc2FyeVxuICAgICAgICAgICAgICAgIGlmICggdm0uc2VsZWN0ZWRSZWNpcGVJbnB1dFR5cGUuZmllbGRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkQXJyID0gW107XG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5zZWxlY3RlZFJlY2lwZUlucHV0VHlwZS5maWVsZHMsIGZ1bmN0aW9uIChmaWVsZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGZpZWxkLnZhbHVlLnNwbGl0KCcsJyksIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkQXJyLnB1c2godmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5yZWNpcGVJbnB1dFtmaWVsZC5uYW1lXSA9IGZpZWxkQXJyO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBhZGQgaW5wdXQgdG8gcmVjaXBlIHR5cGUgZGVmaW5pdGlvblxuICAgICAgICAgICAgICAgICRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24uaW5wdXRfZGF0YS5wdXNoKHZtLnJlY2lwZUlucHV0KTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChqb2IucmVjaXBlX2lucHV0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvYi5yZWNpcGVfaW5wdXRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYl9pbnB1dDogdm0ucmVjaXBlSW5wdXQubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNpcGVfaW5wdXQ6IHZtLnJlY2lwZUlucHV0Lm5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZ2V0SW9NYXBwaW5ncygpO1xuXG4gICAgICAgICAgICAgICAgLy8gcmVzZXQgZm9ybSBmaWVsZHNcbiAgICAgICAgICAgICAgICB2bS5yZWNpcGVJbnB1dCA9IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnJ1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZWNpcGVJbnB1dFR5cGUgPSB7fTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmNoYW5nZUlucHV0VHlwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkUmVjaXBlSW5wdXRUeXBlID0gXy5maW5kKHZtLnJlY2lwZUlucHV0VHlwZXMsIHsnbmFtZSc6IHZtLnJlY2lwZUlucHV0LnR5cGV9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0V2FybmluZ3NIdG1sID0gZnVuY3Rpb24gKHdhcm5pbmdzKSB7XG4gICAgICAgICAgICB2YXIgd2FybmluZ3NIdG1sID0gJyc7XG4gICAgICAgICAgICBfLmZvckVhY2god2FybmluZ3MsIGZ1bmN0aW9uICh3YXJuaW5nKSB7XG4gICAgICAgICAgICAgICAgd2FybmluZ3NIdG1sICs9ICc8Yj4nICsgd2FybmluZy5pZCArICc6PC9iPiAnICsgd2FybmluZy5kZXRhaWxzICsgJzxiciAvPjxiciAvPic7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHdhcm5pbmdzSHRtbCArPSAnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidG4gYnRuLWRlZmF1bHQgYnRuLXhzIGNsZWFyXCI+SGlkZTwvYnV0dG9uPic7XG4gICAgICAgICAgICByZXR1cm4gd2FybmluZ3NIdG1sO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnZhbGlkYXRlUmVjaXBlVHlwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJlY2lwZVNlcnZpY2UudmFsaWRhdGVSZWNpcGVUeXBlKCRzY29wZS5yZWNpcGVUeXBlKS50aGVuKGZ1bmN0aW9uICh2YWxpZGF0aW9uUmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc3BsYXkgdGhlIHdhcm5pbmdzXG4gICAgICAgICAgICAgICAgICAgIHZhciB3YXJuaW5nc0h0bWwgPSBnZXRXYXJuaW5nc0h0bWwodmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyk7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0cltcImVycm9yXCJdKHdhcm5pbmdzSHRtbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyW1wic3VjY2Vzc1wiXSgnUmVjaXBlIGlzIHZhbGlkLicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGlmIChlcnJvci5kZXRhaWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyW1wiZXJyb3JcIl0oZXJyb3IuZGV0YWlsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbXCJlcnJvclwiXShlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfTtcblxuXG4gICAgICAgIHZtLnNhdmVSZWNpcGVUeXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdm0uc2F2aW5nUmVjaXBlID0gdHJ1ZTtcbiAgICAgICAgICAgIHJlY2lwZVNlcnZpY2UudmFsaWRhdGVSZWNpcGVUeXBlKCRzY29wZS5yZWNpcGVUeXBlKS50aGVuKGZ1bmN0aW9uICh2YWxpZGF0aW9uUmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc3BsYXkgdGhlIHdhcm5pbmdzXG4gICAgICAgICAgICAgICAgICAgIHZhciB3YXJuaW5nc0h0bWwgPSBnZXRXYXJuaW5nc0h0bWwodmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyk7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0cltcImVycm9yXCJdKHdhcm5pbmdzSHRtbCk7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNhdmluZ1JlY2lwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlY2lwZVNlcnZpY2Uuc2F2ZVJlY2lwZVR5cGUoJHNjb3BlLnJlY2lwZVR5cGUpLnRoZW4oZnVuY3Rpb24gKHNhdmVSZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNhdmluZ1JlY2lwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUgPSBSZWNpcGVUeXBlRGV0YWlsLnRyYW5zZm9ybWVyKHNhdmVSZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjYWxlQ29uZmlnLnN0YXRpYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KCRzY29wZS5yZWNpcGVUeXBlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3JlY2lwZVR5cGUnICsgJHNjb3BlLnJlY2lwZVR5cGUuaWQsIEpTT04uc3RyaW5naWZ5KCRzY29wZS5yZWNpcGVUeXBlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvcmVjaXBlcy90eXBlcy8nICsgJHNjb3BlLnJlY2lwZVR5cGUuaWQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IgJiYgZXJyb3IuZGV0YWlsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvci5kZXRhaWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZtLnNhdmluZ1JlY2lwZSA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGRpc2FibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uYWRkSm9iVHlwZSA9IGZ1bmN0aW9uIChzZWxlY3RlZEpvYlR5cGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHNlbGVjdGVkSm9iVHlwZS5uYW1lKTtcbiAgICAgICAgICAgICRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24uYWRkSm9iKHNlbGVjdGVkSm9iVHlwZSk7XG4gICAgICAgICAgICAvLyRzY29wZS4kYnJvYWRjYXN0KCdyZWRyYXdSZWNpcGVzJyk7XG4gICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5tYXBJbnB1dCA9IGZ1bmN0aW9uIChwcm92aWRlck5hbWUsIHByb3ZpZGVyT3V0cHV0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbWFwIHNlbGVjdGVkIGpvYiBpbnB1dCB0byAnICsgcHJvdmlkZXJOYW1lICsgJy4nICsgcHJvdmlkZXJPdXRwdXQpO1xuICAgICAgICAgICAgdmFyIGRlcGVuZGVuY3kgPSBfLmZpbmQodm0uc2VsZWN0ZWRKb2IuZGVwZW5kZW5jaWVzLCB7bmFtZTogcHJvdmlkZXJOYW1lfSk7XG5cbiAgICAgICAgICAgIGlmIChkZXBlbmRlbmN5ICYmIGRlcGVuZGVuY3kuY29ubmVjdGlvbnMgJiYgZGVwZW5kZW5jeS5jb25uZWN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbm4gPSBfLmZpbmQoZGVwZW5kZW5jeS5jb25uZWN0aW9ucywgeyBvdXRwdXQ6IHByb3ZpZGVyT3V0cHV0LCBpbnB1dDogdm0uc2VsZWN0ZWRKb2JJbnB1dC5uYW1lIH0pO1xuICAgICAgICAgICAgICAgIGlmICghY29ubikge1xuICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLnB1c2goeyBvdXRwdXQ6IHByb3ZpZGVyT3V0cHV0LCBpbnB1dDogdm0uc2VsZWN0ZWRKb2JJbnB1dC5uYW1lIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFkZXBlbmRlbmN5KSB7XG4gICAgICAgICAgICAgICAgZGVwZW5kZW5jeSA9IHtuYW1lOiBwcm92aWRlck5hbWUsIGNvbm5lY3Rpb25zOiBbeyBvdXRwdXQ6IHByb3ZpZGVyT3V0cHV0LCBpbnB1dDogdm0uc2VsZWN0ZWRKb2JJbnB1dC5uYW1lIH1dfTtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMucHVzaChkZXBlbmRlbmN5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGRlcGVuZGVuY3kuY29ubmVjdGlvbnMgPSBbeyBvdXRwdXQ6IHByb3ZpZGVyT3V0cHV0LCBpbnB1dDogdm0uc2VsZWN0ZWRKb2JJbnB1dC5uYW1lIH1dO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uc2VsZWN0ZWRKb2IuZGVwU3RhcnQgPSBmYWxzZTtcbiAgICAgICAgICAgIHZtLmVkaXRNb2RlID0gJyc7XG4gICAgICAgICAgICB2bS5zZWxlY3RlZEpvYklucHV0ID0gbnVsbDtcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkSW5wdXRQcm92aWRlciA9IG51bGw7XG4gICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5tYXBJbnB1dFJlY2lwZUlucHV0ID0gZnVuY3Rpb24gKHJlY2lwZUlucHV0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbWFwIHNlbGVjdGVkIGpvYiB0byByZWNpcGUgaW5wdXQgJyArIHJlY2lwZUlucHV0KTtcbiAgICAgICAgICAgIHZhciBleGlzdGluZ0lucHV0ID0gXy5maW5kKHZtLnNlbGVjdGVkSm9iLnJlY2lwZV9pbnB1dHMsIHsgam9iX2lucHV0OiB2bS5zZWxlY3RlZEpvYklucHV0Lm5hbWUgfSk7XG4gICAgICAgICAgICBpZiAoIGV4aXN0aW5nSW5wdXQgJiYgZXhpc3RpbmdJbnB1dC5yZWNpcGVfbmFtZSAhPT0gcmVjaXBlSW5wdXQpIHtcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgaXRcbiAgICAgICAgICAgICAgICBleGlzdGluZ0lucHV0LnJlY2lwZV9pbnB1dCA9IHJlY2lwZUlucHV0O1xuICAgICAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoICFleGlzdGluZ0lucHV0ICkge1xuICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBpdFxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkSm9iLnJlY2lwZV9pbnB1dHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGpvYl9pbnB1dDogdm0uc2VsZWN0ZWRKb2JJbnB1dC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICByZWNpcGVfaW5wdXQ6IHJlY2lwZUlucHV0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZW5hYmxlU2F2ZVJlY2lwZSgpO1xuICAgICAgICAgICAgICAgIHZtLnJlZHJhdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkSm9iSW5wdXQgPSBudWxsO1xuICAgICAgICAgICAgdm0uc2VsZWN0ZWRJbnB1dFByb3ZpZGVyID0gbnVsbDtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5tYXBPdXRwdXQgPSBmdW5jdGlvbiAocmVjZWl2ZXJOYW1lLCByZWNlaXZlcklucHV0KSB7XG4gICAgICAgICAgICB2YXIgZGVwZW5kZW5jeSA9IF8uZmluZCh2bS5zZWxlY3RlZE91dHB1dFJlY2VpdmVyLmRlcGVuZGVuY2llcywge25hbWU6IHZtLnNlbGVjdGVkSm9iLm5hbWV9KTtcblxuICAgICAgICAgICAgaWYgKGRlcGVuZGVuY3kgJiYgZGVwZW5kZW5jeS5jb25uZWN0aW9ucyAmJiBkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgY29ubiA9IF8uZmluZChkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLCB7IG91dHB1dDogdm0uc2VsZWN0ZWRKb2JPdXRwdXQubmFtZSwgaW5wdXQ6IHJlY2VpdmVySW5wdXQgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFjb25uKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY3kuY29ubmVjdGlvbnMucHVzaCh7b3V0cHV0OiB2bS5zZWxlY3RlZEpvYk91dHB1dC5uYW1lLCBpbnB1dDogcmVjZWl2ZXJJbnB1dH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFkZXBlbmRlbmN5KSB7XG4gICAgICAgICAgICAgICAgZGVwZW5kZW5jeSA9IHtuYW1lOiB2bS5zZWxlY3RlZEpvYi5uYW1lLCBjb25uZWN0aW9uczogW3tvdXRwdXQ6IHZtLnNlbGVjdGVkSm9iT3V0cHV0Lm5hbWUsIGlucHV0OiByZWNlaXZlcklucHV0fV19O1xuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkT3V0cHV0UmVjZWl2ZXIuZGVwZW5kZW5jaWVzLnB1c2goZGVwZW5kZW5jeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBkZXBlbmRlbmN5LmNvbm5lY3Rpb25zID0gW3tvdXRwdXQ6IHZtLnNlbGVjdGVkSm9iT3V0cHV0Lm5hbWUsIGlucHV0OiByZWNlaXZlcklucHV0fV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS5zZWxlY3RlZE91dHB1dFJlY2VpdmVyLmRlcFN0YXJ0ID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5lZGl0TW9kZSA9ICcnO1xuICAgICAgICAgICAgdm0uc2VsZWN0ZWRKb2JPdXRwdXQgPSBudWxsO1xuICAgICAgICAgICAgdm0uc2VsZWN0ZWRPdXRwdXRSZWNlaXZlciA9IG51bGw7XG4gICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVBZGREZXBlbmRlbmN5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHZtLmVkaXRNb2RlID09PSAnYWRkRGVwZW5kZW5jeScpIHtcbiAgICAgICAgICAgICAgICB2bS5lZGl0TW9kZSA9ICcnO1xuICAgICAgICAgICAgICAgIHZtLmRlcGVuZGVuY3lCdG5DbGFzcyA9ICdmYS1wbHVzJztcbiAgICAgICAgICAgICAgICBnZXRPdGhlck5vZGVzKHZtLnNlbGVjdGVkSm9iLm5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAvLyQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndG9nZ2xlIGFkZERlcGVuZGVuY3kgbW9kZScpO1xuICAgICAgICAgICAgICAgIHZtLmVkaXRNb2RlID0gJ2FkZERlcGVuZGVuY3knO1xuICAgICAgICAgICAgICAgIHZtLmRlcGVuZGVuY3lCdG5DbGFzcyA9ICdmYS1yZW1vdmUnO1xuICAgICAgICAgICAgICAgIGdldE90aGVyTm9kZXModm0uc2VsZWN0ZWRKb2IubmFtZSkuY2xhc3NlZCgnc2VsZWN0ZWQtbm9kZS1zZWxlY3RhYmxlJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgLy8kKCcucmVjaXBlTm9kZTpub3QoXCIuc2VsZWN0ZWQtbm9kZVwiKScpLmFkZENsYXNzKCdzZWxlY3RlZC1ub2RlLXNlbGVjdGFibGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVBZGRJbnB1dCA9IGZ1bmN0aW9uIChqb2JpbnB1dCkge1xuICAgICAgICAgICAgaWYgKHZtLmVkaXRNb2RlID09PSAnYWRkSW5wdXQnKSB7XG4gICAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgICAgICBnZXRPdGhlck5vZGVzKHZtLnNlbGVjdGVkSm9iLm5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAvLyQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEpvYklucHV0ID0gam9iaW5wdXQ7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RvZ2dsZSBhZGRJbnB1dCBtb2RlJyk7XG4gICAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnYWRkSW5wdXQnO1xuICAgICAgICAgICAgICAgIGdldE90aGVyTm9kZXModm0uc2VsZWN0ZWRKb2IubmFtZSkuY2xhc3NlZCgnc2VsZWN0ZWQtbm9kZS1zZWxlY3RhYmxlJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgLy8kKCcucmVjaXBlTm9kZTpub3QoXCIuc2VsZWN0ZWQtbm9kZVwiKScpLmFkZENsYXNzKCdzZWxlY3RlZC1ub2RlLXNlbGVjdGFibGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2bS50b2dnbGVBZGRPdXRwdXQgPSBmdW5jdGlvbiAoam9ib3V0cHV0KSB7XG4gICAgICAgICAgICBpZiAodm0uZWRpdE1vZGUgPT09ICdhZGRPdXRwdXQnKSB7XG4gICAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgICAgICBnZXRPdGhlck5vZGVzKHZtLnNlbGVjdGVkSm9iLm5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAvLyQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEpvYk91dHB1dCA9IGpvYm91dHB1dDtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndG9nZ2xlIGFkZE91dHB1dCBtb2RlJyk7XG4gICAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnYWRkT3V0cHV0JztcbiAgICAgICAgICAgICAgICBnZXRPdGhlck5vZGVzKHZtLnNlbGVjdGVkSm9iLm5hbWUpLmNsYXNzZWQoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScsIHRydWUpO1xuICAgICAgICAgICAgICAgIC8vJCgnLnJlY2lwZU5vZGU6bm90KFwiLnNlbGVjdGVkLW5vZGVcIiknKS5hZGRDbGFzcygnc2VsZWN0ZWQtbm9kZS1zZWxlY3RhYmxlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0ucmVtb3ZlRGVwZW5kZW5jeSA9IGZ1bmN0aW9uIChkZXBOYW1lKSB7XG4gICAgICAgICAgICB2YXIgcmVtb3ZlZERlcHMgPSBfLnJlbW92ZSh2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMsIGZ1bmN0aW9uIChkZXApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVwLm5hbWUgPT09IGRlcE5hbWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZW1vdmVkICcgKyByZW1vdmVkRGVwcy5sZW5ndGggKyAnIGRlcGVuZGVuY2llcy4nKTtcbiAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgIHZtLnJlZHJhdygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLnJlbW92ZUlucHV0TWFwcGluZyA9IGZ1bmN0aW9uIChkZXBOYW1lLCBkZXBPdXRwdXQpIHtcbiAgICAgICAgICAgIGlmICggZGVwTmFtZSA9PT0gJ3JlY2lwZScgKSB7XG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGl0IGZyb20gc2VsZWN0ZWRKb2IucmVjaXBlX2lucHV0c1xuICAgICAgICAgICAgICAgIHZhciBkZXAgPSBfLnJlbW92ZSh2bS5zZWxlY3RlZEpvYi5yZWNpcGVfaW5wdXRzLCB7IHJlY2lwZV9pbnB1dDogZGVwT3V0cHV0IH0pO1xuICAgICAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGRlcCA9IF8uZmluZCh2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMsIHtuYW1lOiBkZXBOYW1lfSk7XG4gICAgICAgICAgICAgICAgaWYgKGRlcCAmJiBkZXAuY29ubmVjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaXQncyBhbiBpbnB1dCBmcm9tIGFub3RoZXIgam9iXG4gICAgICAgICAgICAgICAgICAgIHZhciByZW1vdmVkQ29uID0gXy5yZW1vdmUoZGVwLmNvbm5lY3Rpb25zLCBmdW5jdGlvbiAoY29ubikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbm4ub3V0cHV0ID09PSBkZXBPdXRwdXQ7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVtb3ZlZCAnICsgcmVtb3ZlZENvbi5sZW5ndGggKyAnIGlucHV0IGNvbm5lY3Rpb25zLicpO1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgICAgIHZtLnJlZHJhdygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmRlbGV0ZVJlY2lwZUpvYiA9IGZ1bmN0aW9uIChqb2JOYW1lKSB7XG4gICAgICAgICAgICAvLyByZW1vdmUgZGVwZW5kZW50IGNvbm5lY3Rpb25zXG4gICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICAgICAgXy5yZW1vdmUoam9iLmRlcGVuZGVuY2llcywge25hbWU6IGpvYk5hbWV9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gcmVtb3ZlIGpvYiBmcm9tIGRlZmluaXRpb24uam9ic1xuICAgICAgICAgICAgXy5yZW1vdmUoJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCB7IG5hbWU6IGpvYk5hbWUgfSk7XG4gICAgICAgICAgICAvLyBlbmFibGUgc2F2ZSBhbmQgcmVkcmF3XG4gICAgICAgICAgICB2bS5zZWxlY3RlZEpvYiA9IG51bGw7XG4gICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICB2bS5yZWRyYXcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5yZW1vdmVPdXRwdXRNYXBwaW5nID0gZnVuY3Rpb24gKGpvYk5hbWUsIGRlcE91dHB1dCkge1xuICAgICAgICAgICAgLy8gd2UgaGF2ZSB0byByZW1vdmUgb3V0cHV0IG1hcHBpbmcgZnJvbSB0aGUgam9iIHdoZXJlIHRoZSBkZXBlbmRlbmN5IGlzIGRlZmluZWRcbiAgICAgICAgICAgIHZhciByZWNlaXZlciA9IF8uZmluZCgkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uLmpvYnMse25hbWU6IGpvYk5hbWV9KTtcbiAgICAgICAgICAgIC8vIHJlbW92ZSBpdCBmcm9tIHJlY2VpdmVyLmRlcGVuZGVuY2llc1xuICAgICAgICAgICAgdmFyIGRlcCA9IF8uZmluZChyZWNlaXZlci5kZXBlbmRlbmNpZXMsIHtuYW1lOiB2bS5zZWxlY3RlZEpvYi5uYW1lfSk7XG4gICAgICAgICAgICBpZiAoZGVwICYmIGRlcC5jb25uZWN0aW9ucykge1xuICAgICAgICAgICAgICAgIHZhciByZW1vdmVkQ29uID0gXy5yZW1vdmUoZGVwLmNvbm5lY3Rpb25zLCBmdW5jdGlvbiAoY29ubikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29ubi5vdXRwdXQgPT09IGRlcE91dHB1dDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVtb3ZlZCAnICsgcmVtb3ZlZENvbi5sZW5ndGggKyAnIG91dHB1dCBjb25uZWN0aW9ucy4nKTtcbiAgICAgICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgdm0ucmVkcmF3KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdm0uc2VsZWN0Sm9iVHlwZVRvQWRkID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkSm9iVHlwZSA9IGl0ZW07XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiRvbigncmVkcmF3UmVjaXBlcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLnJlZHJhdygpO1xuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgYWRkRGVwZW5kZW5jeSA9IGZ1bmN0aW9uIChqb2JOYW1lKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh2bS5zZWxlY3RlZEpvYi5uYW1lICsgJy0+JyArIGpvYk5hbWUpO1xuICAgICAgICAgICAgaWYgKCF2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBleGlzdGluZ0RlcGVuZGVuY3kgPSBfLmZpbmQodm0uc2VsZWN0ZWRKb2IuZGVwZW5kZW5jaWVzLCB7bmFtZTogam9iTmFtZX0pO1xuXG4gICAgICAgICAgICBpZiAoIWV4aXN0aW5nRGVwZW5kZW5jeSkgeyB2bS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMucHVzaCh7bmFtZTogam9iTmFtZX0pOyB9XG4gICAgICAgICAgICB2bS5zZWxlY3RlZEpvYi5kZXBTdGFydCA9IGZhbHNlO1xuICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgIHZtLmRlcGVuZGVuY3lCdG5DbGFzcyA9ICdmYS1wbHVzJztcblxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRJb01hcHBpbmdzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24pIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHBvcHVsYXRlIHRoZSBjdXJyZW50IGpvYlR5cGVcbiAgICAgICAgICAgICAgICAgICAgLyp2YXIgdGhpc0pvYlR5cGUgPSBfLmZpbmQoJHNjb3BlLnJlY2lwZVR5cGUuam9iX3R5cGVzLHtpZDogam9iLmpvYl90eXBlX2lkfSk7XG4gICAgICAgICAgICAgICAgICAgIGpvYi5qb2JfdHlwZSA9IHRoaXNKb2JUeXBlOyovXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZmluZCBkZXBlbmRlbnRzXG4gICAgICAgICAgICAgICAgICAgIGlmIChqb2Iuam9iX3R5cGUgJiYgam9iLmpvYl90eXBlLmpvYl90eXBlX2ludGVyZmFjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGpvYi5qb2JfdHlwZS5qb2JfdHlwZV9pbnRlcmZhY2Uub3V0cHV0X2RhdGEsIGZ1bmN0aW9uIChqb2JPdXRwdXQsIGtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqb2JPdXRwdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlcHMgPSBnZXREZXBlbmRlbnRzKGpvYi5uYW1lLGpvYk91dHB1dC5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iT3V0cHV0LmRlcGVuZGVudHMgPSBkZXBzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGRlcGVuZGVuY3kgbWFwcGluZ3NcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChqb2Iuam9iX3R5cGUuam9iX3R5cGVfaW50ZXJmYWNlLmlucHV0X2RhdGEsIGZ1bmN0aW9uIChqb2JJbnB1dCwga2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpvYklucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnB1dE1hcHBpbmdzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChqb2IuZGVwZW5kZW5jaWVzLCBmdW5jdGlvbiAoZGVwZW5kZW5jeSxrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLCBmdW5jdGlvbiAoY29ubixrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29ubi5pbnB1dCA9PT0gam9iSW5wdXQubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dE1hcHBpbmdzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZGVwZW5kZW5jeS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0OiBjb25uLm91dHB1dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiBjb25uLmlucHV0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGpvYi5yZWNpcGVfaW5wdXRzLCBmdW5jdGlvbiAocmVjaXBlSW5wdXQsIGtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlY2lwZUlucHV0LmpvYl9pbnB1dCA9PT0gam9iSW5wdXQubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0TWFwcGluZ3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdyZWNpcGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQ6IHJlY2lwZUlucHV0LnJlY2lwZV9pbnB1dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQ6IHJlY2lwZUlucHV0LmpvYl9pbnB1dFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iSW5wdXQuZGVwZW5kZW5jaWVzID0gaW5wdXRNYXBwaW5ncztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgam9iVHlwZVNlcnZpY2UuZ2V0Sm9iVHlwZXNPbmNlKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZtLmpvYlR5cGVWYWx1ZXMgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgd29ya3NwYWNlc1NlcnZpY2UuZ2V0V29ya3NwYWNlcygpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2bS5hdmFpbGFibGVXb3Jrc3BhY2VzID0gZGF0YVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ3JlY2lwZVR5cGUnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUucmVjaXBlVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVjaXBlVHlwZSA9IG5ldyBSZWNpcGVUeXBlKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAkc2NvcGUucmVjaXBlVHlwZS5pZCA9PT0gJ3VuZGVmaW5lZCcgfHwgJHNjb3BlLnJlY2lwZVR5cGUuaWQgPT09IG51bGwgfHwgJHNjb3BlLnJlY2lwZVR5cGUuaWQgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ubW9kZSA9ICdhZGQnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5tb2RlICE9PSAnZWRpdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLm1vZGUgPSAndmlldydcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCBmdW5jdGlvbiAoam9iLCBpZHgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFqb2Iuam9iX3R5cGUuam9iX3R5cGVfaW50ZXJmYWNlICYmICRzY29wZS5yZWNpcGVUeXBlLmpvYl90eXBlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGpvYlR5cGVEYXRhID0gXy5maW5kKCRzY29wZS5yZWNpcGVUeXBlLmpvYl90eXBlcywge25hbWU6IGpvYi5qb2JfdHlwZS5uYW1lLCB2ZXJzaW9uOiBqb2Iuam9iX3R5cGUudmVyc2lvbn0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzW2lkeF0uam9iX3R5cGUgPSBqb2JUeXBlRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBzZXR1cCBzdHJpbmcgdG8gYmluZCBjb21tYSBkZWxpbWl0ZWQgbGlzdCBvZiB0cmlnZ2VyIHJ1bGUgY29uZmlndXJhdGlvbiBjb25kaXRpb24gZGF0YSB0eXBlc1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucmVjaXBlVHlwZS50cmlnZ2VyX3J1bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5yZWNpcGVUeXBlLnRyaWdnZXJfcnVsZS5jb25maWd1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnJlY2lwZVR5cGUudHJpZ2dlcl9ydWxlLmNvbmZpZ3VyYXRpb24uY29uZGl0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5yZWNpcGVUeXBlLnRyaWdnZXJfcnVsZS5jb25maWd1cmF0aW9uLmNvbmRpdGlvbi5kYXRhX3R5cGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJlY2lwZVR5cGVUcmlnZ2VyLmRhdGFUeXBlcyA9ICRzY29wZS5yZWNpcGVUeXBlLnRyaWdnZXJfcnVsZS5jb25maWd1cmF0aW9uLmNvbmRpdGlvbi5kYXRhX3R5cGVzLmpvaW4oJywnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpbml0R3JhcGgoKTtcbiAgICAgICAgICAgICAgICBnZXRJb01hcHBpbmdzKCk7XG4gICAgICAgICAgICAgICAgZHJhd0dyYXBoKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICgkc2NvcGUuJHBhcmVudC52bS51c2VyKSB7XG4gICAgICAgICAgICAgICAgdm0ucmVhZG9ubHkgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdEdyYXBoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gKioqKioqXG4gICAgICAgICAgICAvLyBzZXR1cCBEMyBjb250YWluZXIgYW5kIEdyYXBoXG4gICAgICAgICAgICAvLyAqKioqKipcbiAgICAgICAgICAgIC8vdm0uc2VsZWN0ZWRKb2IgPSBudWxsO1xuICAgICAgICAgICAgZnVuY3Rpb24gY2xpY2tlZCgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9IGQzLmV2ZW50O1xuICAgICAgICAgICAgICAgIHZhciB4ID0gZDMuZXZlbnQueDtcbiAgICAgICAgICAgICAgICB2YXIgeSA9IGQzLmV2ZW50Lnk7XG4gICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gcGFyc2VJbnQoc3ZnLnN0eWxlKFwid2lkdGhcIikucmVwbGFjZSgvcHgvLCBcIlwiKSk7XG4gICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IHBhcnNlSW50KHN2Zy5zdHlsZShcImhlaWdodFwiKS5yZXBsYWNlKC9weC8sIFwiXCIpKTtcblxuICAgICAgICAgICAgICAgIGlubmVyLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyB3aWR0aCAvIDIgKyBcIixcIiArIGhlaWdodCAvIDIgKyBcIilzY2FsZSgyKXRyYW5zbGF0ZShcIiArIC14ICsgXCIsXCIgKyAteSArIFwiKVwiKTtcblxuICAgICAgICAgICAgICAgIC8vaW5uZXIuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSg1MHB4LCA1MHB4KXNjYWxlKDIsMylcIik7XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3ZnID0gZDMuc2VsZWN0KFwic3ZnXCIpO1xuICAgICAgICAgICAgaW5uZXIgPSBzdmcuc2VsZWN0KFwiZ1wiKTsgLy8ub24oXCJjbGlja1wiLCBjbGlja2VkKTtcbiAgICAgICAgICAgIC8vIFNldCB1cCB6b29tIHN1cHBvcnRcbiAgICAgICAgICAgIHpvb20gPSBkMy5iZWhhdmlvci56b29tKCkub24oXCJ6b29tXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB6b29tU2NhbGUgPSBkMy5ldmVudC5zY2FsZTtcbiAgICAgICAgICAgICAgICBpbm5lci5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgZDMuZXZlbnQudHJhbnNsYXRlICsgXCIpXCIgK1xuICAgICAgICAgICAgICAgICAgICBcInNjYWxlKFwiICsgem9vbVNjYWxlICsgXCIpXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzdmcuY2FsbCh6b29tKTtcblxuICAgICAgICAgICAgcmVuZGVyID0gbmV3IGRhZ3JlRDMucmVuZGVyKCk7XG5cbiAgICAgICAgICAgIC8vIExlZnQtdG8tcmlnaHQgbGF5b3V0XG4gICAgICAgICAgICBncmFwaCA9IG5ldyBkYWdyZUQzLmdyYXBobGliLkdyYXBoKCk7XG4gICAgICAgICAgICBncmFwaC5zZXRHcmFwaCh7XG4gICAgICAgICAgICAgICAgbm9kZXNlcDogNzAsXG4gICAgICAgICAgICAgICAgcmFua3NlcDogNTAsXG4gICAgICAgICAgICAgICAgcmFua2RpcjogXCJUQlwiLFxuICAgICAgICAgICAgICAgIG1hcmdpbng6IDIwLFxuICAgICAgICAgICAgICAgIG1hcmdpbnk6IDIwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBkcmF3R3JhcGggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBnbG9iYWxzIGJlY2F1c2UgZGFncmUgbmVlZHMgYSByZWZlcmVuY2UgdG8gYW5ndWxhciBzY29wZVxuICAgICAgICAgICAgd2luZG93Lm5vZGVDbGljayA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWNpcGV2aWV3ZXInKSkuc2NvcGUoKTtcbiAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS52bS5ub2RlQ2xpY2sobmFtZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB3aW5kb3cubWFwSW5wdXQgPSBmdW5jdGlvbiAoam9iTmFtZSwgam9iT3V0cHV0KSB7XG4gICAgICAgICAgICAgICAgJCgnIycgKyBqb2JOYW1lKS5wb3BvdmVyKCdkZXN0cm95Jyk7XG4gICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWNpcGV2aWV3ZXInKSkuc2NvcGUoKTtcbiAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS52bS5tYXBJbnB1dChqb2JOYW1lLCBqb2JPdXRwdXQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgd2luZG93Lm1hcElucHV0UmVjaXBlSW5wdXQgPSBmdW5jdGlvbiAocmVjaXBlSW5wdXROYW1lKSB7XG4gICAgICAgICAgICAgICAgJCgnI3N0YXJ0JykucG9wb3ZlcignZGVzdHJveScpO1xuICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVjaXBldmlld2VyJykpLnNjb3BlKCk7XG4gICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUudm0ubWFwSW5wdXRSZWNpcGVJbnB1dChyZWNpcGVJbnB1dE5hbWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgd2luZG93Lm1hcE91dHB1dCA9IGZ1bmN0aW9uIChqb2JOYW1lLCBqb2JJbnB1dCkge1xuICAgICAgICAgICAgICAgICQoJyMnICsgam9iTmFtZSkucG9wb3ZlcignZGVzdHJveScpO1xuICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVjaXBldmlld2VyJykpLnNjb3BlKCk7XG4gICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUudm0ubWFwT3V0cHV0KGpvYk5hbWUsIGpvYklucHV0KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICgkc2NvcGUucmVjaXBlKSB7XG4gICAgICAgICAgICAgICAgdm0ubGFzdFN0YXR1c0NoYW5nZSA9ICRzY29wZS5yZWNpcGUubGFzdF9tb2RpZmllZCA/IG1vbWVudC5kdXJhdGlvbihtb21lbnQudXRjKCRzY29wZS5yZWNpcGUubGFzdF9tb2RpZmllZCkuZGlmZihtb21lbnQudXRjKCkpKS5odW1hbml6ZSh0cnVlKSA6ICcnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgam9icyA9IFtdO1xuICAgICAgICAgICAgaWYgKCRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24pIHtcbiAgICAgICAgICAgICAgICBqb2JzID0gJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNoaWxkQ291bnRzID0gW107XG4gICAgICAgICAgICAvLyBjcmVhdGUgZ3JhcGggb2JqZWN0c1xuICAgICAgICAgICAgZm9yICh2YXIgaWR4IGluIGpvYnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgam9iID0gam9ic1tpZHhdO1xuXG4gICAgICAgICAgICAgICAgaWYgKGpvYi5kZXBlbmRlbmNpZXMgPT09IHVuZGVmaW5lZCB8fCBqb2IuZGVwZW5kZW5jaWVzLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgam9iLmRlcFN0YXJ0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IGdldFJlY2lwZVR5cGVKb2JDbGFzc05hbWUoam9iKTtcblxuICAgICAgICAgICAgICAgIHZhciBodG1sID0gJzxkaXYgY2xhc3M9XCJyZWNpcGVOb2RlXCI+JztcbiAgICAgICAgICAgICAgICAvL3ZhciBodG1sID0gXCI8ZGl2IG9uY2xpY2s9XFxcImNvbnNvbGUubG9nKCdcIiArIGpvYi5qb2JfdHlwZS5uYW1lICsgXCInKVxcXCI+XCI7XG4gICAgICAgICAgICAgICAgaWYgKGNsYXNzTmFtZSAhPT0gJ25vc3RhdHVzJykge1xuICAgICAgICAgICAgICAgICAgICBodG1sICs9ICc8c3BhbiBjbGFzcz1cInN0YXR1c1wiPjwvc3Bhbj4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyAgIGh0bWwgKz0gXCI8c3BhbiBjbGFzcz1jb25zdW1lcnM+XCIrd29ya2VyLmNvbnN1bWVycytcIjwvc3Bhbj5cIjtcbiAgICAgICAgICAgICAgICBodG1sICs9ICc8c3BhbiBjbGFzcz1cIm5hbWVcIj4nO1xuICAgICAgICAgICAgICAgIGlmIChqb2Iuam9iX3R5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhqb2Iuam9iVHlwZSk7XG4gICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxkaXYgaWQ9XCInICsgam9iLm5hbWUgKyAnXCIgY2xhc3M9XCJcIiBvbmNsaWNrPVwibm9kZUNsaWNrKFxcJycgKyBqb2IubmFtZSArICdcXCcpXCI+PHNwYW4gY2xhc3M9XCJuYW1lXCI+JyArIGpvYi5qb2JfdHlwZS5nZXRJY29uKCkgKyAnICcgKyBqb2IubmFtZSArICc8L3NwYW4+PC9kaXY+JztcbiAgICAgICAgICAgICAgICAgICAgLy9pZiAoam9iVHlwZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgIGh0bWwgKz0gJzxkaXYgaWQ9XCInICsgam9iLm5hbWUgKyAnXCIgY2xhc3M9XCJyZWNpcGVOb2RlXCIgb25jbGljaz1cIm5vZGVDbGljayhcXCcnICsgam9iLm5hbWUgKyAnXFwnKVwiPjxzcGFuIGNsYXNzPVwibmFtZVwiPicgKyBqb2JUeXBlLmdldEljb24oKSArICcgJyArIGpvYlR5cGUudGl0bGUgKyAnPC9zcGFuPjwvZGl2Pic7XG4gICAgICAgICAgICAgICAgICAgIC8vfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgaHRtbCArPSAnPGRpdiBpZD1cIicgKyBqb2IubmFtZSArICdcIiBjbGFzcz1cInJlY2lwZU5vZGVcIiBvbmNsaWNrPVwibm9kZUNsaWNrKFxcJycgKyBqb2IubmFtZSArICdcXCcpXCI+PHNwYW4gY2xhc3M9XCJuYW1lXCI+JyArIGpvYlR5cGUuZ2V0SWNvbigpICsgJyAnICsgam9iLm5hbWUgKyAnPC9zcGFuPjwvZGl2Pic7XG4gICAgICAgICAgICAgICAgICAgIC8vfVxuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGh0bWwgKz0gJzwvc3Bhbj4nO1xuICAgICAgICAgICAgICAgIC8vICAgaHRtbCArPSBcIjxzcGFuIGNsYXNzPXF1ZXVlPjxzcGFuIGNsYXNzPWNvdW50ZXI+XCIrd29ya2VyLmNvdW50K1wiPC9zcGFuPjwvc3Bhbj5cIjtcbiAgICAgICAgICAgICAgICBodG1sICs9ICc8L2Rpdj4nO1xuICAgICAgICAgICAgICAgIGdyYXBoLnNldE5vZGUoam9iLm5hbWUsIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWxUeXBlOiAnaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBodG1sLFxuICAgICAgICAgICAgICAgICAgICByeDogNSxcbiAgICAgICAgICAgICAgICAgICAgcnk6IDUsXG4gICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDAsXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzOiBjbGFzc05hbWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyBzZXR1cCBlZGdlc1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGQgaW4gam9iLmRlcGVuZGVuY2llcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGVwID0gam9iLmRlcGVuZGVuY2llc1tkXTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZGVwLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyYXBoLnNldEVkZ2UoZGVwLm5hbWUsIGpvYi5uYW1lLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9sYWJlbFR5cGU6ICdodG1sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2xhYmVsOiBkZXAubmFtZSArICctLT4nICsgam9iLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDIwXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkQ291bnRzW2RlcC5uYW1lXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkQ291bnRzW2RlcC5uYW1lXSArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZENvdW50c1tkZXAubmFtZV0gPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBzZXQgc3RhcnQgbm9kZSBhbmQgZWRnZXNcbiAgICAgICAgICAgIGdyYXBoLnNldE5vZGUoJ3N0YXJ0Jywge1xuICAgICAgICAgICAgICAgIGxhYmVsVHlwZTogJ2h0bWwnLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnPGRpdiBpZD1cInN0YXJ0XCIgY2xhc3M9XCJyZWNpcGVOb2RlXCIgb25jbGljaz1cIm5vZGVDbGljayhcXCdzdGFydFxcJylcIj48c3BhbiBjbGFzcz1uYW1lPlN0YXJ0PC9zcGFuPjwvZGl2PicsXG4gICAgICAgICAgICAgICAgcng6IDUsXG4gICAgICAgICAgICAgICAgcnk6IDUsXG4gICAgICAgICAgICAgICAgcGFkZGluZzogMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzdGFydEpvYiA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnc3RhcnQnLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlOiB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnU3RhcnQnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpbnB1dF9kYXRhOiAkc2NvcGUucmVjaXBlVHlwZS5pbnB1dF9kYXRhXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIG5vRGVwcyA9IF8uZmlsdGVyKGpvYnMsICdkZXBTdGFydCcsIHRydWUpO1xuICAgICAgICAgICAgZm9yICh2YXIgbiBpbiBub0RlcHMpIHtcbiAgICAgICAgICAgICAgICBncmFwaC5zZXRFZGdlKCdzdGFydCcsIG5vRGVwc1tuXS5uYW1lLCB7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBzZXQgZW5kIG5vZGUgYW5kIGVkZ2VzXG4gICAgICAgICAgICBncmFwaC5zZXROb2RlKCdlbmQnLCB7XG4gICAgICAgICAgICAgICAgbGFiZWxUeXBlOiAnaHRtbCcsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICc8ZGl2IGNsYXNzPVwicmVjaXBlTm9kZVwiPjxzcGFuIGNsYXNzPVwibmFtZVwiPkVuZDwvc3Bhbj48L2Rpdj4nLFxuICAgICAgICAgICAgICAgIHJ4OiA1LFxuICAgICAgICAgICAgICAgIHJ5OiA1LFxuICAgICAgICAgICAgICAgIHBhZGRpbmc6IDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIG5vQ2hpbGRyZW4gPV8uZmlsdGVyKGpvYnMsIGZ1bmN0aW9uIChqb2IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gIWNoaWxkQ291bnRzW2pvYi5uYW1lXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZm9yICh2YXIgbyBpbiBub0NoaWxkcmVuKSB7XG4gICAgICAgICAgICAgICAgZ3JhcGguc2V0RWRnZShub0NoaWxkcmVuW29dLm5hbWUsICdlbmQnLCB7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyB3YWl0IGZvciBjdXJyZW50IGNhbGwgc3RhY2sgdG8gY2xlYXJcbiAgICAgICAgICAgIF8uZGVmZXIoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlubmVyLmNhbGwocmVuZGVyLCBncmFwaCk7XG4gICAgICAgICAgICAgICAgem9vbS5ldmVudChkMy5zZWxlY3QoXCJzdmdcIikpO1xuXG4gICAgICAgICAgICAgICAgJCgnLm5vZGUgcmVjdCcpLmF0dHIoJ2NsYXNzJywgJ25vZGVSZWN0Jyk7XG5cbiAgICAgICAgICAgICAgICAvLyBhZGQgc2VsZWN0ZWQgY2xhc3MgdG8gYXBwcm9wcmlhdGUgbm9kZVxuICAgICAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZEpvYikge1xuICAgICAgICAgICAgICAgICAgICAvLyQoJyMnICsgdm0uc2VsZWN0ZWRKb2IubmFtZSkuYWRkQ2xhc3MoJ3NlbGVjdGVkLW5vZGUnKTtcbiAgICAgICAgICAgICAgICAgICAgZ2V0Q2xvc2VzdE5vZGUodm0uc2VsZWN0ZWRKb2IubmFtZSkuY2xhc3NlZCgnc2VsZWN0ZWQtbm9kZScsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXREZXBlbmRlbnRzID0gZnVuY3Rpb24gKG5hbWUsb3V0cHV0TmFtZSkge1xuICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSBbXTtcblxuICAgICAgICAgICAgXy5mb3JFYWNoKCRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24uam9icywgZnVuY3Rpb24gKGpvYiwga2V5KSB7XG4gICAgICAgICAgICAgICAgaWYgKGpvYi5uYW1lICE9PSBuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChqb2IuZGVwZW5kZW5jaWVzLCBmdW5jdGlvbiAoZGVwZW5kZW5jeSwga2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVwZW5kZW5jeS5uYW1lID09PSBuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGRlcGVuZGVuY3kuY29ubmVjdGlvbnMsIGZ1bmN0aW9uIChjb25uLCBrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbm4ub3V0cHV0ID09PSBvdXRwdXROYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGpvYi5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dDogY29ubi5vdXRwdXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQ6IGNvbm4uaW5wdXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgfSkuZGlyZWN0aXZlKCdhaXNTY2FsZVJlY2lwZUdyYXBoVmlld2VyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAndXNlIHN0cmljdCc7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2FnZTogPGFpcy1zY2FsZS1yZWNpcGUtdmlld2VyIHJlY2lwZT1cInJlY2lwZVwiIC8+XG4gICAgICAgICAqL1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fpc1NjYWxlUmVjaXBlR3JhcGhWaWV3ZXJDb250cm9sbGVyJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9yZWNpcGVzL3BhcnRpYWxzL3JlY2lwZUdyYXBoVmlld2VyVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICByZWNpcGVUeXBlOiAnPScsXG4gICAgICAgICAgICAgICAgcmVjaXBlOiAnPScsXG4gICAgICAgICAgICAgICAgaXNNb2RpZmllZDogJz1tb2RpZmllZCcsXG4gICAgICAgICAgICAgICAgYWxsb3dFZGl0OiAnPScsXG4gICAgICAgICAgICAgICAgaGFzQ29udGFpbmVyOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBSZWNpcGVUeXBlLCBzY2FsZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIFJlY2lwZSA9IGZ1bmN0aW9uIChpZCwgY3JlYXRlZCwgY29tcGxldGVkLCBsYXN0X21vZGlmaWVkLCByZWNpcGVfdHlwZSkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKGNyZWF0ZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Y19ub2xhYmVsKTtcbiAgICAgICAgICAgIHRoaXMuY29tcGxldGVkID0gY29tcGxldGVkO1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZWRfZm9ybWF0dGVkID0gY29tcGxldGVkID8gbW9tZW50LnV0Yyhjb21wbGV0ZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Y19ub2xhYmVsKSA6ICcnO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKGxhc3RfbW9kaWZpZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0Y19ub2xhYmVsKTtcbiAgICAgICAgICAgIHRoaXMubGFzdF9zdGF0dXNfY2hhbmdlID0gbGFzdF9tb2RpZmllZCA/IG1vbWVudC5kdXJhdGlvbihtb21lbnQudXRjKGxhc3RfbW9kaWZpZWQpLmRpZmYobW9tZW50LnV0YygpKSkuaHVtYW5pemUodHJ1ZSkgOiAnJztcbiAgICAgICAgICAgIHRoaXMucmVjaXBlX3R5cGUgPSBSZWNpcGVUeXBlLnRyYW5zZm9ybWVyKHJlY2lwZV90eXBlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBSZWNpcGUucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgZ2V0RHVyYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUR1cmF0aW9uKHRoaXMuY3JlYXRlZCwgdGhpcy5sYXN0X21vZGlmaWVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgUmVjaXBlLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGUoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZWNpcGVfdHlwZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGUuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGU7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlRGF0YScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIFJlY2lwZURhdGEgPSBmdW5jdGlvbiAoaW5wdXRfZGF0YSwgdmVyc2lvbiwgd29ya3NwYWNlX2lkKSB7XG4gICAgICAgICAgICB0aGlzLmlucHV0X2RhdGEgPSBpbnB1dF9kYXRhO1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMud29ya3NwYWNlX2lkID0gd29ya3NwYWNlX2lkO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBSZWNpcGVEYXRhLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVEYXRhKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlucHV0X2RhdGEsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS53b3Jrc3BhY2VfaWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVEYXRhKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUmVjaXBlRGF0YS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGVEYXRhLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFJlY2lwZURhdGEuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFJlY2lwZURhdGE7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlRGV0YWlscycsIGZ1bmN0aW9uIChSZWNpcGVEYXRhLCBSZWNpcGVUeXBlRGVmaW5pdGlvbiwgUmVjaXBlVHlwZSwgUmVjaXBlVHlwZURldGFpbCwgUmVjaXBlSm9iQ29udGFpbmVyLCBzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgUmVjaXBlRGV0YWlscyA9IGZ1bmN0aW9uIChpZCwgY3JlYXRlZCwgY29tcGxldGVkLCBsYXN0X21vZGlmaWVkLCBkYXRhLCByZWNpcGVfdHlwZSwgcmVjaXBlX3R5cGVfcmV2LCBqb2JzKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZWQgPSBjb21wbGV0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNvbXBsZXRlZF9mb3JtYXR0ZWQgPSB0aGlzLmNvbXBsZXRlZCA/IG1vbWVudC51dGModGhpcy5jb21wbGV0ZWQpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kX3V0YykgOiB0aGlzLmNvbXBsZXRlZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBSZWNpcGVEYXRhLnRyYW5zZm9ybWVyKGRhdGEpO1xuICAgICAgICAgICAgdGhpcy5yZWNpcGVfdHlwZSA9IFJlY2lwZVR5cGUudHJhbnNmb3JtZXIocmVjaXBlX3R5cGUpO1xuICAgICAgICAgICAgdGhpcy5yZWNpcGVfdHlwZV9yZXYgPSBSZWNpcGVUeXBlRGV0YWlsLnRyYW5zZm9ybWVyKHJlY2lwZV90eXBlX3Jldik7XG4gICAgICAgICAgICB0aGlzLmpvYnMgPSBSZWNpcGVKb2JDb250YWluZXIudHJhbnNmb3JtZXIoam9icyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZURldGFpbHMuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZURldGFpbHMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kYXRhLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlY2lwZV90eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlY2lwZV90eXBlX3JldixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlRGV0YWlscygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZURldGFpbHMudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUmVjaXBlRGV0YWlscy5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBSZWNpcGVEZXRhaWxzLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVEZXRhaWxzO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlSm9iJywgZnVuY3Rpb24gKEpvYlR5cGUpIHtcbiAgICAgICAgdmFyIFJlY2lwZUpvYiA9IGZ1bmN0aW9uIChpZCwgc3RhdHVzLCBqb2JfdHlwZSkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlID0gSm9iVHlwZS50cmFuc2Zvcm1lcihqb2JfdHlwZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZUpvYi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlSm9iKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZUpvYigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZUpvYi50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGVKb2IuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlSm9iLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVKb2I7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlSm9iQ29udGFpbmVyJywgZnVuY3Rpb24gKFJlY2lwZUpvYikge1xuICAgICAgICB2YXIgUmVjaXBlSm9iQ29udGFpbmVyID0gZnVuY3Rpb24gKGpvYl9uYW1lLCBqb2IpIHtcbiAgICAgICAgICAgIHRoaXMuam9iX25hbWUgPSBqb2JfbmFtZTtcbiAgICAgICAgICAgIHRoaXMuam9iID0gUmVjaXBlSm9iLnRyYW5zZm9ybWVyKGpvYik7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZUpvYkNvbnRhaW5lci5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlSm9iQ29udGFpbmVyKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl9uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYlxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZUpvYkNvbnRhaW5lcigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZUpvYkNvbnRhaW5lci50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGVKb2JDb250YWluZXIuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlSm9iQ29udGFpbmVyLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVKb2JDb250YWluZXI7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlVHlwZScsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgUmVjaXBlVHlwZURlZmluaXRpb24pIHtcbiAgICAgICAgdmFyIFJlY2lwZVR5cGUgPSBmdW5jdGlvbiAoaWQsIG5hbWUsIHZlcnNpb24sIHRpdGxlLCBkZXNjcmlwdGlvbiwgaXNfYWN0aXZlLCBkZWZpbml0aW9uLCByZXZpc2lvbl9udW0sIGNyZWF0ZWQsICBsYXN0X21vZGlmaWVkLCBhcmNoaXZlZCwgdHJpZ2dlcl9ydWxlKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuaXNfYWN0aXZlID0gaXNfYWN0aXZlO1xuICAgICAgICAgICAgdGhpcy5kZWZpbml0aW9uID0gZGVmaW5pdGlvbiA/IFJlY2lwZVR5cGVEZWZpbml0aW9uLnRyYW5zZm9ybWVyKGRlZmluaXRpb24pIDogbmV3IFJlY2lwZVR5cGVEZWZpbml0aW9uKCk7XG4gICAgICAgICAgICB0aGlzLnJldmlzaW9uX251bSA9IHJldmlzaW9uX251bTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5hcmNoaXZlZCA9IGFyY2hpdmVkO1xuICAgICAgICAgICAgaWYgKHRyaWdnZXJfcnVsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcl9ydWxlID0gdHJpZ2dlcl9ydWxlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXJfcnVsZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJycsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICcnLFxuICAgICAgICAgICAgICAgICAgICBpc19hY3RpdmU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25kaXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWRpYV90eXBlOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhX3R5cGVzOiBbXVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2VfbmFtZTogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRfZGF0YV9uYW1lOiAnJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubW9kaWZpZWQgPSBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgUmVjaXBlVHlwZS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfYWN0aXZlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlZmluaXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmV2aXNpb25fbnVtLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5hcmNoaXZlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50cmlnZ2VyX3J1bGVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVUeXBlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUmVjaXBlVHlwZS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEubWFwKFJlY2lwZVR5cGUuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGUuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGU7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdSZWNpcGVUeXBlRGVmaW5pdGlvbicsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgUmVjaXBlVHlwZURlZmluaXRpb25Kb2IsIEpvYlR5cGVJbnB1dERhdGEpIHtcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIC8vIHByaXZhdGUgbWV0aG9kc1xuICAgICAgICB2YXIgUmVjaXBlVHlwZURlZmluaXRpb24gPSBmdW5jdGlvbiAoaW5wdXRfZGF0YSwgdmVyc2lvbiwgam9icykge1xuICAgICAgICAgICAgdGhpcy5pbnB1dF9kYXRhID0gaW5wdXRfZGF0YSA/IEpvYlR5cGVJbnB1dERhdGEudHJhbnNmb3JtZXIoaW5wdXRfZGF0YSkgOiBbXTtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb24gfHwgJzEuMCc7XG4gICAgICAgICAgICB0aGlzLmpvYnMgPSBqb2JzID8gUmVjaXBlVHlwZURlZmluaXRpb25Kb2IudHJhbnNmb3JtZXIoam9icykgOiBbXTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Sm9iTmFtZSA9IGZ1bmN0aW9uKGpvYnMsIGpvYk5hbWUpe1xuICAgICAgICAgICAgdmFyIHRoZU5hbWUgPSBqb2JOYW1lO1xuICAgICAgICAgICAgdmFyIGV4aXN0aW5nID0gXy5maW5kKGpvYnMsIHsgJ25hbWUnOiBqb2JOYW1lIH0pO1xuICAgICAgICAgICAgdmFyIGlkeCA9IDI7XG4gICAgICAgICAgICB3aGlsZShleGlzdGluZyl7XG4gICAgICAgICAgICAgICAgdGhlTmFtZSA9IGpvYk5hbWUgKyAnLScgKyBpZHg7XG4gICAgICAgICAgICAgICAgZXhpc3RpbmcgPSBfLmZpbmQoam9icywgeyAnbmFtZSc6IHRoZU5hbWUgfSk7XG4gICAgICAgICAgICAgICAgaWR4Kys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhlTmFtZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBSZWNpcGVUeXBlRGVmaW5pdGlvbi5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBhZGRKb2I6IGZ1bmN0aW9uIChqb2JUeXBlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGpuYW1lID0gZ2V0Sm9iTmFtZSh0aGlzLmpvYnMsIGpvYlR5cGUubmFtZSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coam5hbWUpO1xuICAgICAgICAgICAgICAgIHZhciBqb2IgPSB7XG4gICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llczogW10sXG4gICAgICAgICAgICAgICAgICAgIHJlY2lwZV9pbnB1dHM6IFtdLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBqbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgam9iX3R5cGVfaWQ6IGpvYlR5cGUuaWQsXG4gICAgICAgICAgICAgICAgICAgIGpvYl90eXBlOiBqb2JUeXBlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLmpvYnMucHVzaChqb2IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBSZWNpcGVUeXBlRGVmaW5pdGlvbi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZihkYXRhKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZVR5cGVEZWZpbml0aW9uKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlucHV0X2RhdGEsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZURlZmluaXRpb24oKTtcbiAgICAgICAgfTtcblxuICAgICAgICBSZWNpcGVUeXBlRGVmaW5pdGlvbi50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGVUeXBlRGVmaW5pdGlvbi5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlVHlwZURlZmluaXRpb24uYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGVEZWZpbml0aW9uO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpe1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1JlY2lwZVR5cGVEZWZpbml0aW9uSm9iJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2JUeXBlRGV0YWlscykge1xuICAgICAgICAvLyBwcml2YXRlIG1ldGhvZHNcbiAgICAgICAgdmFyIFJlY2lwZVR5cGVEZWZpbml0aW9uSm9iID0gZnVuY3Rpb24gKHJlY2lwZV9pbnB1dHMsIG5hbWUsIGpvYl90eXBlLCBkZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgICAgIHRoaXMucmVjaXBlX2lucHV0cyA9IHJlY2lwZV9pbnB1dHM7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZSA9IGpvYl90eXBlO1xuICAgICAgICAgICAgLy90aGlzLmpvYl90eXBlID0ge1xuICAgICAgICAgICAgLy8gICAgbmFtZTogam9iX3R5cGUubmFtZSxcbiAgICAgICAgICAgIC8vICAgIHZlcnNpb246IGpvYl90eXBlLnZlcnNpb25cbiAgICAgICAgICAgIC8vfTtcbiAgICAgICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gZGVwZW5kZW5jaWVzIHx8IFtdO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBSZWNpcGVUeXBlRGVmaW5pdGlvbkpvYi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZURlZmluaXRpb25Kb2IoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVjaXBlX2lucHV0cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl90eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlcGVuZGVuY2llc1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZVR5cGVEZWZpbml0aW9uSm9iKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUmVjaXBlVHlwZURlZmluaXRpb25Kb2IudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUmVjaXBlVHlwZURlZmluaXRpb25Kb2IuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGVEZWZpbml0aW9uSm9iLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG5cbiAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGVEZWZpbml0aW9uSm9iO1xuXG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdSZWNpcGVUeXBlRGV0YWlsJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBSZWNpcGVUeXBlRGVmaW5pdGlvbiwgSm9iVHlwZURldGFpbHMpIHtcbiAgICAgICAgdmFyIFJlY2lwZVR5cGVEZXRhaWwgPSBmdW5jdGlvbiAoaWQsIG5hbWUsIHZlcnNpb24sIHRpdGxlLCBkZXNjcmlwdGlvbiwgaXNfYWN0aXZlLCBkZWZpbml0aW9uLCBjcmVhdGVkLCBsYXN0X21vZGlmaWVkLCBhcmNoaXZlZCwgdHJpZ2dlcl9ydWxlLCBqb2JfdHlwZXMpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICB0aGlzLnZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlO1xuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgdGhpcy5pc19hY3RpdmUgPSBpc19hY3RpdmU7XG4gICAgICAgICAgICB0aGlzLmRlZmluaXRpb24gPSBSZWNpcGVUeXBlRGVmaW5pdGlvbi50cmFuc2Zvcm1lcihkZWZpbml0aW9uKTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5hcmNoaXZlZCA9IGFyY2hpdmVkO1xuICAgICAgICAgICAgdGhpcy50cmlnZ2VyX3J1bGUgPSB0cmlnZ2VyX3J1bGU7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlcyA9IEpvYlR5cGVEZXRhaWxzLnRyYW5zZm9ybWVyKGpvYl90eXBlcyk7XG4gICAgICAgICAgICB0aGlzLm1vZGlmaWVkID0gZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZVR5cGVEZXRhaWwuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZVR5cGVEZXRhaWwoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS52ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZWZpbml0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5hcmNoaXZlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50cmlnZ2VyX3J1bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGVzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZURldGFpbCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZVR5cGVEZXRhaWwudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUmVjaXBlVHlwZURldGFpbC5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlVHlwZURldGFpbC5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gUmVjaXBlVHlwZURldGFpbDtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1JlY2lwZVR5cGVWYWxpZGF0aW9uJywgZnVuY3Rpb24gKFJlY2lwZVR5cGVEZWZpbml0aW9uKSB7XG5cbiAgICAgICAgdmFyIGdldFJlY2lwZVR5cGVWYWxpZGF0aW9uSm9icyA9IGZ1bmN0aW9uIChqb2JzKSB7XG4gICAgICAgICAgICB2YXIgam9ic091dCA9IFtdO1xuICAgICAgICAgICAgXy5mb3JFYWNoKGpvYnMsIGZ1bmN0aW9uKGpvYil7XG4gICAgICAgICAgICAgICBqb2JzT3V0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgIHJlY2lwZV9pbnB1dHM6IGpvYi5yZWNpcGVfaW5wdXRzLFxuICAgICAgICAgICAgICAgICAgIG5hbWU6IGpvYi5uYW1lLFxuICAgICAgICAgICAgICAgICAgIGpvYl90eXBlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGpvYi5qb2JfdHlwZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiBqb2Iuam9iX3R5cGUudmVyc2lvblxuICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzOiBqb2IuZGVwZW5kZW5jaWVzXG4gICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gam9ic091dDtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHZhciBSZWNpcGVUeXBlVmFsaWRhdGlvbiA9IGZ1bmN0aW9uIChpZCwgbmFtZSwgdmVyc2lvbiwgdGl0bGUsIGRlc2NyaXB0aW9uLCBkZWZpbml0aW9uLCB0cmlnZ2VyX3J1bGUpIHtcbiAgICAgICAgICAgIGlmIChpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICB0aGlzLnZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlO1xuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgdGhpcy5kZWZpbml0aW9uID0ge1xuICAgICAgICAgICAgICAgIGlucHV0X2RhdGE6IGRlZmluaXRpb24uaW5wdXRfZGF0YSxcbiAgICAgICAgICAgICAgICBqb2JzOiBnZXRSZWNpcGVUeXBlVmFsaWRhdGlvbkpvYnMoZGVmaW5pdGlvbi5qb2JzKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlcl9ydWxlID0gdHJpZ2dlcl9ydWxlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBSZWNpcGVUeXBlVmFsaWRhdGlvbi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZVZhbGlkYXRpb24oXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS52ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlZmluaXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudHJpZ2dlcl9ydWxlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZVZhbGlkYXRpb24oKTtcbiAgICAgICAgfTtcblxuICAgICAgICBSZWNpcGVUeXBlVmFsaWRhdGlvbi50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGVUeXBlVmFsaWRhdGlvbi5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlVHlwZVZhbGlkYXRpb24uYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGVWYWxpZGF0aW9uO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ3dvcmtzcGFjZXNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCAkdWliTW9kYWwsICRyb3V0ZVBhcmFtcywgc2NhbGVDb25maWcsIG5hdlNlcnZpY2UsIHdvcmtzcGFjZXNTZXJ2aWNlLCBzY2FsZVNlcnZpY2UsIHN0YXRlU2VydmljZSwgdXNlclNlcnZpY2UsIGdyaWRGYWN0b3J5LCBXb3Jrc3BhY2UsIHRvYXN0cikge1xuICAgICAgICB2YXIgdm0gPSB0aGlzLFxuICAgICAgICAgICAgY3VycldvcmtzcGFjZSA9IHt9LFxuICAgICAgICAgICAgYWN0aXZlV29ya3NwYWNlcyA9IFtdLFxuICAgICAgICAgICAgaW5hY3RpdmVXb3Jrc3BhY2VzID0gW107XG5cbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XG4gICAgICAgIHZtLnNjYWxlQ29uZmlnID0gc2NhbGVDb25maWc7XG4gICAgICAgIHZtLnNob3dBY3RpdmUgPSBzdGF0ZVNlcnZpY2UuZ2V0U2hvd0FjdGl2ZVdvcmtzcGFjZXMoKTtcbiAgICAgICAgdm0ud29ya3NwYWNlcyA9IFtdO1xuICAgICAgICB2bS5sb2NhbFdvcmtzcGFjZXMgPSBbXTtcbiAgICAgICAgdm0uYWN0aXZlV29ya3NwYWNlID0ge307XG4gICAgICAgIHZtLmFkZEJ0bkNsYXNzID0gJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgdm0uYWRkQnRuSWNvbiA9ICdmYS1wbHVzLWNpcmNsZSc7XG4gICAgICAgIHZtLnNhdmVCdG5DbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgIHZtLm1vZGUgPSAndmlldyc7XG4gICAgICAgIHZtLnVzZXIgPSB1c2VyU2VydmljZS5nZXRVc2VyQ3JlZHMoKTtcbiAgICAgICAgdm0ucmVhZG9ubHkgPSAhKHZtLnVzZXIgJiYgdm0udXNlci5pc19hZG1pbik7XG4gICAgICAgIHZtLmJyb2tlckRlc2NyaXB0aW9uID0gJyc7XG4gICAgICAgIHZtLmF2YWlsYWJsZVdvcmtzcGFjZVR5cGVzID0gXy5jbG9uZURlZXAoc2NhbGVDb25maWcud29ya3NwYWNlVHlwZXMpO1xuXG4gICAgICAgIHZtLmNhbmNlbENyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLm1vZGUgPSAndmlldyc7XG4gICAgICAgICAgICAvLyByZXZlcnQgYW55IGNoYW5nZXMgdG8gdGhlIHdvcmtzcGFjZVxuICAgICAgICAgICAgdm0uYWN0aXZlV29ya3NwYWNlID0gV29ya3NwYWNlLnRyYW5zZm9ybWVyKF8uY2xvbmVEZWVwKGN1cnJXb3Jrc3BhY2UpKTtcbiAgICAgICAgICAgIGlmICgkcm91dGVQYXJhbXMuaWQgPT09ICcwJykge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvd29ya3NwYWNlcycpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmVkaXRXb3Jrc3BhY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBzdG9yZSBhIHJlZmVyZW5jZSBvZiB0aGUgd29ya3NwYWNlIGFzIGl0IGN1cnJlbnRseSBleGlzdHMgaW4gY2FzZSB0aGUgdXNlciBjYW5jZWxzIHRoZSBlZGl0XG4gICAgICAgICAgICBjdXJyV29ya3NwYWNlID0gV29ya3NwYWNlLnRyYW5zZm9ybWVyKF8uY2xvbmVEZWVwKHZtLmFjdGl2ZVdvcmtzcGFjZSkpO1xuICAgICAgICAgICAgdm0ubW9kZSA9ICdlZGl0JztcbiAgICAgICAgfTtcblxuICAgICAgICB2bS5zYXZlV29ya3NwYWNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgd29ya3NwYWNlc1NlcnZpY2Uuc2F2ZVdvcmtzcGFjZSh2bS5hY3RpdmVXb3Jrc3BhY2UpLnRoZW4oZnVuY3Rpb24gKHdvcmtzcGFjZSkge1xuICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVdvcmtzcGFjZSA9IFdvcmtzcGFjZS50cmFuc2Zvcm1lcih3b3Jrc3BhY2UpO1xuICAgICAgICAgICAgICAgIGlmIChzY2FsZUNvbmZpZy5zdGF0aWMpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3dvcmtzcGFjZScgKyB2bS5hY3RpdmVXb3Jrc3BhY2UuaWQsIEpTT04uc3RyaW5naWZ5KHZtLmFjdGl2ZVdvcmtzcGFjZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2bS5tb2RlID0gJ3ZpZXcnO1xuICAgICAgICAgICAgICAgIGdldFdvcmtzcGFjZXMoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmNsZWFyTG9jYWxXb3Jrc3BhY2VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmxvY2FsV29ya3NwYWNlcywgZnVuY3Rpb24gKHdvcmtzcGFjZSkge1xuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd3b3Jrc3BhY2UnICsgd29ya3NwYWNlLmlkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy93b3Jrc3BhY2VzJyk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICB2bS5uZXdXb3Jrc3BhY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5tb2RlID0gJ2FkZCc7XG4gICAgICAgICAgICB2bS5sb2FkV29ya3NwYWNlKDApO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZtLmxvYWRXb3Jrc3BhY2UgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCd3b3Jrc3BhY2VzLycgKyBpZCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFdhcm5pbmdzSHRtbCA9IGZ1bmN0aW9uICh3YXJuaW5ncykge1xuICAgICAgICAgICAgdmFyIHdhcm5pbmdzSHRtbCA9ICcnO1xuICAgICAgICAgICAgXy5mb3JFYWNoKHdhcm5pbmdzLCBmdW5jdGlvbiAod2FybmluZykge1xuICAgICAgICAgICAgICAgIHdhcm5pbmdzSHRtbCArPSAnPGI+JyArIHdhcm5pbmcuaWQgKyAnOjwvYj4gJyArIHdhcm5pbmcuZGV0YWlscyArICc8YnIgLz48YnIgLz4nO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB3YXJuaW5nc0h0bWwgKz0gJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuIGJ0bi1kZWZhdWx0IGJ0bi14cyBjbGVhclwiPkhpZGU8L2J1dHRvbj4nO1xuICAgICAgICAgICAgcmV0dXJuIHdhcm5pbmdzSHRtbDtcbiAgICAgICAgfTtcblxuICAgICAgICB2bS52YWxpZGF0ZVdvcmtzcGFjZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgd29ya3NwYWNlc1NlcnZpY2UudmFsaWRhdGVXb3Jrc3BhY2Uodm0uYWN0aXZlV29ya3NwYWNlKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEud2FybmluZ3MgJiYgZGF0YS53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc3BsYXkgdGhlIHdhcm5pbmdzXG4gICAgICAgICAgICAgICAgICAgIHZhciB3YXJuaW5nc0h0bWwgPSBnZXRXYXJuaW5nc0h0bWwoZGF0YS53YXJuaW5ncyk7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXSh3YXJuaW5nc0h0bWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnc3VjY2VzcyddKCdXb3Jrc3BhY2UgaXMgdmFsaWQuJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yLmRldGFpbCkge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IuZGV0YWlsKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmFjdGl2ZVdvcmtzcGFjZS5qc29uX2NvbmZpZy5icm9rZXIudHlwZScsIGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKG5ld1ZhbHVlID09PSAnbmZzJykge1xuICAgICAgICAgICAgICAgIHZtLmJyb2tlckRlc2NyaXB0aW9uID0gc2NhbGVDb25maWcubmZzQnJva2VyRGVzY3JpcHRpb247XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbHVlID09PSAnaG9zdCcpIHtcbiAgICAgICAgICAgICAgICB2bS5icm9rZXJEZXNjcmlwdGlvbiA9IHNjYWxlQ29uZmlnLmhvc3RCcm9rZXJEZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3VmFsdWUgPT09ICdzMycpIHtcbiAgICAgICAgICAgICAgICB2bS5icm9rZXJEZXNjcmlwdGlvbiA9IHNjYWxlQ29uZmlnLnMzQnJva2VyRGVzY3JpcHRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNob3dBY3RpdmUnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZtLnNob3dBY3RpdmUgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIHN0YXRlU2VydmljZS5zZXRTaG93QWN0aXZlV29ya3NwYWNlcyhuZXdWYWx1ZSk7XG4gICAgICAgICAgICB2bS53b3Jrc3BhY2VzID0gdm0uc2hvd0FjdGl2ZSA/IF8uY2xvbmVEZWVwKGFjdGl2ZVdvcmtzcGFjZXMpIDogXy5jbG9uZURlZXAoaW5hY3RpdmVXb3Jrc3BhY2VzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGdldFdvcmtzcGFjZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHdvcmtzcGFjZXNTZXJ2aWNlLmdldFdvcmtzcGFjZXMoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNjYWxlQ29uZmlnLnN0YXRpYykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBvSnNvbiA9IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgc0tleTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICg7IHNLZXkgPSBsb2NhbFN0b3JhZ2Uua2V5KGkpOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9Kc29uW3NLZXldID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oc0tleSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXy5maWx0ZXIoXy5wYWlycyhvSnNvbiksIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoXy5jb250YWlucyhvWzBdLCAnd29ya3NwYWNlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IEpTT04ucGFyc2Uob1sxXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ubG9jYWxXb3Jrc3BhY2VzLnB1c2godHlwZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKHR5cGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYWN0aXZlV29ya3NwYWNlcyA9IF8uZmlsdGVyKGRhdGEsIHsgJ2lzX2FjdGl2ZSc6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgaW5hY3RpdmVXb3Jrc3BhY2VzID0gXy5maWx0ZXIoZGF0YSwgeyAnaXNfYWN0aXZlJzogZmFsc2UgfSk7XG4gICAgICAgICAgICAgICAgdm0ud29ya3NwYWNlcyA9IHZtLnNob3dBY3RpdmUgPyBfLmNsb25lRGVlcChhY3RpdmVXb3Jrc3BhY2VzKSA6IF8uY2xvbmVEZWVwKGluYWN0aXZlV29ya3NwYWNlcyk7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZ2V0V29ya3NwYWNlcygpO1xuICAgICAgICAgICAgdm0uYWN0aXZlV29ya3NwYWNlID0gbnVsbDtcbiAgICAgICAgICAgIHZtLm1vZGUgPSAndmlldyc7XG5cbiAgICAgICAgICAgIGlmICgkcm91dGVQYXJhbXMuaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSBwYXJzZUludCgkcm91dGVQYXJhbXMuaWQpO1xuICAgICAgICAgICAgICAgIGlmIChpZCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB2bS5tb2RlID0gJ2FkZCc7XG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVdvcmtzcGFjZSA9IG5ldyBXb3Jrc3BhY2UoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgYWN0aXZlV29ya3NwYWNlID0gd29ya3NwYWNlIGRldGFpbHMgZm9yIGlkXG4gICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZXNTZXJ2aWNlLmdldFdvcmtzcGFjZURldGFpbHMoaWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVdvcmtzcGFjZSA9IFdvcmtzcGFjZS50cmFuc2Zvcm1lcihkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignd29ya3NwYWNlcycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIHNldCBjb250YWluZXIgaGVpZ2h0cyBlcXVhbCB0byBhdmFpbGFibGUgcGFnZSBoZWlnaHRcbiAgICAgICAgICAgIHZhciB2aWV3cG9ydCA9IHNjYWxlU2VydmljZS5nZXRWaWV3cG9ydFNpemUoKSxcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBzY2FsZUNvbmZpZy5oZWFkZXJPZmZzZXQsXG4gICAgICAgICAgICAgICAgY29udGFpbmVyTWF4SGVpZ2h0ID0gdmlld3BvcnQuaGVpZ2h0IC0gb2Zmc2V0ICsgNjA7XG5cbiAgICAgICAgICAgIHZtLmNvbnRhaW5lclN0eWxlID0gJ2hlaWdodDogJyArIGNvbnRhaW5lck1heEhlaWdodCArICdweDsgbWF4LWhlaWdodDogJyArIGNvbnRhaW5lck1heEhlaWdodCArICdweDsnO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdXb3Jrc3BhY2UnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcpIHtcbiAgICAgICAgdmFyIFdvcmtzcGFjZSA9IGZ1bmN0aW9uIChpZCwgbmFtZSwgdGl0bGUsIGRlc2NyaXB0aW9uLCBiYXNlX3VybCwgaXNfYWN0aXZlLCB1c2VkX3NpemUsIHRvdGFsX3NpemUsIGNyZWF0ZWQsIGFyY2hpdmVkLCBsYXN0X21vZGlmaWVkLCBqc29uX2NvbmZpZykge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuYmFzZV91cmwgPSBiYXNlX3VybDtcbiAgICAgICAgICAgIHRoaXMuaXNfYWN0aXZlID0gaXNfYWN0aXZlO1xuICAgICAgICAgICAgdGhpcy51c2VkX3NpemUgPSB1c2VkX3NpemU7XG4gICAgICAgICAgICB0aGlzLnRvdGFsX3NpemUgPSB0b3RhbF9zaXplO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuYXJjaGl2ZWQgPSBhcmNoaXZlZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmpzb25fY29uZmlnID0ganNvbl9jb25maWcgfHwgXy5jbG9uZURlZXAoc2NhbGVDb25maWcud29ya3NwYWNlVHlwZXNbMF0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIFdvcmtzcGFjZS5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBjbGVhbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBiYXNlX3VybDogdGhpcy5iYXNlX3VybCxcbiAgICAgICAgICAgICAgICAgICAgaXNfYWN0aXZlOiB0aGlzLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAganNvbl9jb25maWc6IHRoaXMuanNvbl9jb25maWdcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBXb3Jrc3BhY2UuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFdvcmtzcGFjZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmJhc2VfdXJsLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS51c2VkX3NpemUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudG90YWxfc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmFyY2hpdmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuanNvbl9jb25maWdcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBXb3Jrc3BhY2UoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBXb3Jrc3BhY2UudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLm1hcChXb3Jrc3BhY2UuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFdvcmtzcGFjZS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gV29ya3NwYWNlO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgncmVjaXBlU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCwgJHEsICR0aW1lb3V0LCBzY2FsZUNvbmZpZywgUmVjaXBlVHlwZSwgUmVjaXBlVHlwZURldGFpbCwgUmVjaXBlLCBSZWNpcGVEZXRhaWxzLCBSZWNpcGVUeXBlVmFsaWRhdGlvbikge1xuICAgICAgICB2YXIgZ2V0UmVjaXBlc1BhcmFtcyA9IGZ1bmN0aW9uIChwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkLCBvcmRlciwgY29tcGxldGVkLCByZWNpcGVfdHlwZV9pZCwgcmVjaXBlX3R5cGVfbmFtZSwgdXJsKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBwYWdlX3NpemUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogc3RhcnRlZCxcbiAgICAgICAgICAgICAgICBlbmRlZDogZW5kZWQsXG4gICAgICAgICAgICAgICAgb3JkZXI6IG9yZGVyLFxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogY29tcGxldGVkLFxuICAgICAgICAgICAgICAgIHJlY2lwZV90eXBlX2lkOiByZWNpcGVfdHlwZV9pZCxcbiAgICAgICAgICAgICAgICByZWNpcGVfdHlwZV9uYW1lOiByZWNpcGVfdHlwZV9uYW1lLFxuICAgICAgICAgICAgICAgIHVybDogdXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRSZWNpcGVUeXBlc1BhcmFtcyA9IGZ1bmN0aW9uIChwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkLCBvcmRlcikge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogcGFnZV9zaXplLFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgZW5kZWQ6IGVuZGVkLFxuICAgICAgICAgICAgICAgIG9yZGVyOiBvcmRlciA/IG9yZGVyIDogWyd0aXRsZScsICd2ZXJzaW9uJ11cbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldFJlY2lwZVR5cGVzOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldFJlY2lwZVR5cGVzUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3JlY2lwZS10eXBlcy8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gUmVjaXBlVHlwZS50cmFuc2Zvcm1lcihkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZ2V0UmVjaXBlVHlwZURldGFpbDogZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAncmVjaXBlLXR5cGVzLycgKyBpZCArICcvJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgdmFyIHJldHVybkRhdGEgPSBSZWNpcGVUeXBlRGV0YWlsLnRyYW5zZm9ybWVyKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJldHVybkRhdGEpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGdldFJlY2lwZXM6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMgPSBwYXJhbXMgfHwgZ2V0UmVjaXBlc1BhcmFtcygpO1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBwYXJhbXMudXJsID8gcGFyYW1zLnVybCA6IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3JlY2lwZXMvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IFJlY2lwZS50cmFuc2Zvcm1lcihkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBnZXRSZWNpcGVEZXRhaWxzOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3JlY2lwZXMvJyArIGlkICsgJy8nKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBSZWNpcGVEZXRhaWxzLnRyYW5zZm9ybWVyKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBzYXZlUmVjaXBlVHlwZTogZnVuY3Rpb24gKHJlY2lwZVR5cGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIGNsZWFuUmVjaXBlVHlwZSA9IFJlY2lwZVR5cGVWYWxpZGF0aW9uLnRyYW5zZm9ybWVyKHJlY2lwZVR5cGUpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFjbGVhblJlY2lwZVR5cGUuaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJGh0dHAucG9zdChzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdyZWNpcGUtdHlwZXMvJywgY2xlYW5SZWNpcGVUeXBlKS5zdWNjZXNzKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRodHRwLnBhdGNoKHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3JlY2lwZS10eXBlcy8nICsgY2xlYW5SZWNpcGVUeXBlLmlkICsgJy8nLCBjbGVhblJlY2lwZVR5cGUpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVjaXBlVHlwZSA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZWNpcGVUeXBlKTtcbiAgICAgICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oZXJyb3Ipe1xuICAgICAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgdmFsaWRhdGVSZWNpcGVUeXBlOiBmdW5jdGlvbiAocmVjaXBlVHlwZSkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgY2xlYW5SZWNpcGVUeXBlID0gUmVjaXBlVHlwZVZhbGlkYXRpb24udHJhbnNmb3JtZXIocmVjaXBlVHlwZSk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3JlY2lwZS10eXBlcy92YWxpZGF0aW9uLycsIGNsZWFuUmVjaXBlVHlwZSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ3dvcmtzcGFjZXNTZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCAkcSwgJHJlc291cmNlLCBzY2FsZUNvbmZpZykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0V29ya3NwYWNlczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnd29ya3NwYWNlcy8nO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7IG9yZGVyOiAnLXRpdGxlJyB9XG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0V29ya3NwYWNlRGV0YWlsczogZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICd3b3Jrc3BhY2VzLycgKyBpZCArICcvJztcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCdcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB2YWxpZGF0ZVdvcmtzcGFjZTogZnVuY3Rpb24gKHdvcmtzcGFjZSkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgY2xlYW5Xb3Jrc3BhY2UgPSB3b3Jrc3BhY2UuY2xlYW4oKTtcblxuICAgICAgICAgICAgICAgICRodHRwLnBvc3Qoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnd29ya3NwYWNlcy92YWxpZGF0aW9uLycsIGNsZWFuV29ya3NwYWNlKS5zdWNjZXNzKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oZXJyb3Ipe1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNhdmVXb3Jrc3BhY2U6IGZ1bmN0aW9uICh3b3Jrc3BhY2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXdvcmtzcGFjZS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3dvcmtzcGFjZXMvJywgd29ya3NwYWNlLmNsZWFuKCkpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkaHR0cC5wYXRjaChzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICd3b3Jrc3BhY2VzLycgKyB3b3Jrc3BhY2UuaWQgKyAnLycsIHdvcmtzcGFjZS5jbGVhbigpKS5zdWNjZXNzKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZSA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZSh3b3Jrc3BhY2UpO1xuICAgICAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIvKipcbiAqIEBhdXRob3IgRGltaXRyeSBLdWRyYXl2dHNldlxuICogQHZlcnNpb24gMi4xXG4gKi9cblxuIHZhciB1cGRhdGVXaW5kb3cgPSBmdW5jdGlvbigpe1xuICAgIC8vICB4ID0gdy5pbm5lcldpZHRoIHx8IGUuY2xpZW50V2lkdGggfHwgZy5jbGllbnRXaWR0aDtcbiAgICAvLyAgeSA9IHcuaW5uZXJIZWlnaHR8fCBlLmNsaWVudEhlaWdodHx8IGcuY2xpZW50SGVpZ2h0O1xuICAgICAvL1xuICAgIC8vICBzdmcuYXR0cihcIndpZHRoXCIsIHgpLmF0dHIoXCJoZWlnaHRcIiwgeSk7XG4gICAgY29uc29sZS5sb2coJ3Jlc2l6ZScpO1xuIH07XG5cbiB3aW5kb3cub25yZXNpemUgPSB1cGRhdGVXaW5kb3c7XG5cbmQzLmdhbnR0ID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIEZJVF9USU1FX0RPTUFJTl9NT0RFID0gXCJmaXRcIjtcbiAgICB2YXIgRklYRURfVElNRV9ET01BSU5fTU9ERSA9IFwiZml4ZWRcIjtcblxuICAgIHZhciBtYXJnaW4gPSB7XG5cdFx0dG9wIDogMjAsXG5cdFx0cmlnaHQgOiAyMCxcblx0XHRib3R0b20gOiAyMCxcblx0XHRsZWZ0IDogNjBcbiAgICB9O1xuICAgIHZhciB0aW1lRG9tYWluU3RhcnQgPSBkMy50aW1lLmRheS5vZmZzZXQobmV3IERhdGUoKSwtMyk7XG4gICAgdmFyIHRpbWVEb21haW5FbmQgPSBkMy50aW1lLmhvdXIub2Zmc2V0KG5ldyBEYXRlKCksKzMpO1xuICAgIHZhciB0aW1lRG9tYWluTW9kZSA9IEZJVF9USU1FX0RPTUFJTl9NT0RFOy8vIGZpeGVkIG9yIGZpdFxuICAgIHZhciB0YXNrVHlwZXMgPSBbXTtcbiAgICB2YXIgdGFza1N0YXR1cyA9IFtdO1xuICAgIHZhciBoZWlnaHQgPSBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodCAtIG1hcmdpbi50b3AgLSBtYXJnaW4uYm90dG9tLTU7XG4gICAgdmFyIHdpZHRoID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aCAtIG1hcmdpbi5yaWdodCAtIG1hcmdpbi5sZWZ0LTU7XG5cdHZhciByZW5kZXJUbyA9IFwiYm9keVwiO1xuXHR2YXIgYmVnaW4gPSAnJztcblx0dmFyIGVuZGVkID0gJyc7XG5cbiAgICB2YXIgdGlja0Zvcm1hdCA9IFwiJUg6JU06JVNcIjtcblxuICAgIHZhciBrZXlGdW5jdGlvbiA9IGZ1bmN0aW9uKGQpIHtcblx0XHRyZXR1cm4gZFtiZWdpbl0gKyBkLnRhc2tOYW1lICsgZFtlbmRlZF07XG4gICAgfTtcblxuICAgIHZhciByZWN0VHJhbnNmb3JtID0gZnVuY3Rpb24oZCkge1xuXHRcdHJldHVybiBcInRyYW5zbGF0ZShcIiArIHgoZFtiZWdpbl0pICsgXCIsXCIgKyB5KGQudGFza05hbWUpICsgXCIpXCI7XG4gICAgfTtcblxuICAgIHZhciB4ID0gZDMudGltZS5zY2FsZSgpLmRvbWFpbihbIHRpbWVEb21haW5TdGFydCwgdGltZURvbWFpbkVuZCBdKS5yYW5nZShbIDAsIHdpZHRoIF0pLmNsYW1wKHRydWUpO1xuXG4gICAgdmFyIHkgPSBkMy5zY2FsZS5vcmRpbmFsKCkuZG9tYWluKHRhc2tUeXBlcykucmFuZ2VSb3VuZEJhbmRzKFsgMCwgaGVpZ2h0IC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b20gXSwgLjEpO1xuXG4gICAgdmFyIHhBeGlzID0gZDMuc3ZnLmF4aXMoKS5zY2FsZSh4KS5vcmllbnQoXCJib3R0b21cIikudGlja0Zvcm1hdChkMy50aW1lLmZvcm1hdCh0aWNrRm9ybWF0KSkudGlja1N1YmRpdmlkZSh0cnVlKVxuXHQgICAgLnRpY2tTaXplKDgpLnRpY2tQYWRkaW5nKDgpO1xuXG4gICAgdmFyIHlBeGlzID0gZDMuc3ZnLmF4aXMoKS5zY2FsZSh5KS5vcmllbnQoXCJsZWZ0XCIpLnRpY2tTaXplKDApO1xuXG4gICAgdmFyIGluaXRUaW1lRG9tYWluID0gZnVuY3Rpb24odGFza3MpIHtcblx0aWYgKHRpbWVEb21haW5Nb2RlID09PSBGSVRfVElNRV9ET01BSU5fTU9ERSkge1xuXHQgICAgaWYgKHRhc2tzID09PSB1bmRlZmluZWQgfHwgdGFza3MubGVuZ3RoIDwgMSkge1xuXHRcdHRpbWVEb21haW5TdGFydCA9IGQzLnRpbWUuZGF5Lm9mZnNldChuZXcgRGF0ZSgpLCAtMyk7XG5cdFx0dGltZURvbWFpbkVuZCA9IGQzLnRpbWUuaG91ci5vZmZzZXQobmV3IERhdGUoKSwgKzMpO1xuXHRcdHJldHVybjtcblx0ICAgIH1cblx0ICAgIHRhc2tzLnNvcnQoZnVuY3Rpb24oYSwgYikge1xuXHRcdHJldHVybiBhW2VuZGVkXSAtIGJbZW5kZWRdO1xuXHQgICAgfSk7XG5cdCAgICB0aW1lRG9tYWluRW5kID0gdGFza3NbdGFza3MubGVuZ3RoIC0gMV1bZW5kZWRdO1xuXHQgICAgdGFza3Muc29ydChmdW5jdGlvbihhLCBiKSB7XG5cdFx0cmV0dXJuIGFbYmVnaW5dIC0gYltiZWdpbl07XG5cdCAgICB9KTtcblx0ICAgIHRpbWVEb21haW5TdGFydCA9IHRhc2tzWzBdW2JlZ2luXTtcblx0fVxuICAgIH07XG5cbiAgICB2YXIgaW5pdEF4aXMgPSBmdW5jdGlvbigpIHtcblx0eCA9IGQzLnRpbWUuc2NhbGUoKS5kb21haW4oWyB0aW1lRG9tYWluU3RhcnQsIHRpbWVEb21haW5FbmQgXSkucmFuZ2UoWyAwLCB3aWR0aCBdKS5jbGFtcCh0cnVlKTtcblx0eSA9IGQzLnNjYWxlLm9yZGluYWwoKS5kb21haW4odGFza1R5cGVzKS5yYW5nZVJvdW5kQmFuZHMoWyAwLCBoZWlnaHQgLSBtYXJnaW4udG9wIC0gbWFyZ2luLmJvdHRvbSBdLCAuMSk7XG5cdHhBeGlzID0gZDMuc3ZnLmF4aXMoKS5zY2FsZSh4KS5vcmllbnQoXCJib3R0b21cIikudGlja3MoTWF0aC5jZWlsKHdpZHRoLzE1MCkpLnRpY2tGb3JtYXQoZDMudGltZS5mb3JtYXQodGlja0Zvcm1hdCkpLnRpY2tTdWJkaXZpZGUodHJ1ZSlcblx0XHQudGlja1NpemUoOCkudGlja1BhZGRpbmcoOCk7XG5cblx0eUF4aXMgPSBkMy5zdmcuYXhpcygpLnNjYWxlKHkpLm9yaWVudChcImxlZnRcIikudGlja1NpemUoMCk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGdhbnR0KHRhc2tzKSB7XG5cblx0aW5pdFRpbWVEb21haW4odGFza3MpO1xuXHRpbml0QXhpcygpO1xuXG5cdHZhciBzdmcgPSBkMy5zZWxlY3QocmVuZGVyVG8pXG5cdC5hcHBlbmQoXCJzdmdcIilcblx0LmF0dHIoXCJjbGFzc1wiLCBcImNoYXJ0XCIpXG5cdC5hdHRyKFwid2lkdGhcIiwgd2lkdGggKyBtYXJnaW4ubGVmdCArIG1hcmdpbi5yaWdodClcblx0LmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pXG5cdC5hcHBlbmQoXCJnXCIpXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJnYW50dC1jaGFydFwiKVxuXHQuYXR0cihcIndpZHRoXCIsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG5cdC5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodCArIG1hcmdpbi50b3AgKyBtYXJnaW4uYm90dG9tKVxuXHQuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIG1hcmdpbi5sZWZ0ICsgXCIsIFwiICsgbWFyZ2luLnRvcCArIFwiKVwiKTtcblxuICAgICAgc3ZnLnNlbGVjdEFsbChcIi5jaGFydFwiKVxuXHQgLmRhdGEodGFza3MsIGtleUZ1bmN0aW9uKS5lbnRlcigpXG5cdCAuYXBwZW5kKFwicmVjdFwiKVxuXHQgLmF0dHIoXCJyeFwiLCA1KVxuICAgICAgICAgLmF0dHIoXCJyeVwiLCA1KVxuXHQgLmF0dHIoXCJjbGFzc1wiLCBmdW5jdGlvbihkKXtcblx0ICAgICBpZih0YXNrU3RhdHVzW2Quc3RhdHVzXSA9PSBudWxsKXsgcmV0dXJuIFwiYmFyXCI7fVxuXHQgICAgIHJldHVybiB0YXNrU3RhdHVzW2Quc3RhdHVzXTtcblx0ICAgICB9KVxuXHQgLmF0dHIoXCJ5XCIsIDApXG5cdCAuYXR0cihcInRyYW5zZm9ybVwiLCByZWN0VHJhbnNmb3JtKVxuXHQgLmF0dHIoXCJoZWlnaHRcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geS5yYW5nZUJhbmQoKTsgfSlcblx0IC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24oZCkge1xuXHQgICAgIHJldHVybiAoeChkW2VuZGVkXSkgLSB4KGRbYmVnaW5dKSk7XG5cdCAgICAgfSk7XG5cblxuXHQgc3ZnLmFwcGVuZChcImdcIilcblx0IC5hdHRyKFwiY2xhc3NcIiwgXCJ4IGF4aXNcIilcblx0IC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsIFwiICsgKGhlaWdodCAtIG1hcmdpbi50b3AgLSBtYXJnaW4uYm90dG9tKSArIFwiKVwiKVxuXHQgLnRyYW5zaXRpb24oKVxuXHQgLmNhbGwoeEF4aXMpO1xuXG5cdCBzdmcuYXBwZW5kKFwiZ1wiKS5hdHRyKFwiY2xhc3NcIiwgXCJ5IGF4aXNcIikudHJhbnNpdGlvbigpLmNhbGwoeUF4aXMpO1xuXG5cdCByZXR1cm4gZ2FudHQ7XG5cbiAgICB9O1xuXG4gICAgZ2FudHQucmVkcmF3ID0gZnVuY3Rpb24odGFza3MpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3JlZHJhdycpO1xuXHRpbml0VGltZURvbWFpbih0YXNrcyk7XG5cdGluaXRBeGlzKCk7XG5cbiAgICAgICAgdmFyIHN2ZyA9IGQzLnNlbGVjdChcInN2Z1wiKTtcblxuICAgICAgICB2YXIgZ2FudHRDaGFydEdyb3VwID0gc3ZnLnNlbGVjdChcIi5nYW50dC1jaGFydFwiKTtcbiAgICAgICAgdmFyIHJlY3QgPSBnYW50dENoYXJ0R3JvdXAuc2VsZWN0QWxsKFwicmVjdFwiKS5kYXRhKHRhc2tzLCBrZXlGdW5jdGlvbik7XG5cbiAgICAgICAgcmVjdC5lbnRlcigpXG4gICAgICAgICAuaW5zZXJ0KFwicmVjdFwiLFwiOmZpcnN0LWNoaWxkXCIpXG4gICAgICAgICAuYXR0cihcInJ4XCIsIDUpXG4gICAgICAgICAuYXR0cihcInJ5XCIsIDUpXG5cdCAuYXR0cihcImNsYXNzXCIsIGZ1bmN0aW9uKGQpe1xuXHQgICAgIGlmKHRhc2tTdGF0dXNbZC5zdGF0dXNdID09IG51bGwpeyByZXR1cm4gXCJiYXJcIjt9XG5cdCAgICAgcmV0dXJuIHRhc2tTdGF0dXNbZC5zdGF0dXNdO1xuXHQgICAgIH0pXG5cdCAudHJhbnNpdGlvbigpXG5cdCAuYXR0cihcInlcIiwgMClcblx0IC5hdHRyKFwidHJhbnNmb3JtXCIsIHJlY3RUcmFuc2Zvcm0pXG5cdCAuYXR0cihcImhlaWdodFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiB5LnJhbmdlQmFuZCgpOyB9KVxuXHQgIC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24oZCkge1xuXHQgICAgIHJldHVybiAoeChkW2VuZGVkXSkgLSB4KGRbYmVnaW5dKSk7XG5cdCAgICAgfSk7XG5cbiAgICAgICAgcmVjdC50cmFuc2l0aW9uKClcbiAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCByZWN0VHJhbnNmb3JtKVxuXHQgLmF0dHIoXCJoZWlnaHRcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geS5yYW5nZUJhbmQoKTsgfSlcblx0IC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24oZCkge1xuXHQgICAgIHJldHVybiAoeChkW2VuZGVkXSkgLSB4KGRbYmVnaW5dKSk7XG5cdCAgICAgfSk7XG5cblx0cmVjdC5leGl0KCkucmVtb3ZlKCk7XG5cblx0c3ZnLnNlbGVjdChcIi54XCIpLnRyYW5zaXRpb24oKS5jYWxsKHhBeGlzKTtcblx0c3ZnLnNlbGVjdChcIi55XCIpLnRyYW5zaXRpb24oKS5jYWxsKHlBeGlzKTtcblxuXHRyZXR1cm4gZ2FudHQ7XG4gICAgfTtcblxuICAgIGdhbnR0Lm1hcmdpbiA9IGZ1bmN0aW9uKHZhbHVlKSB7XG5cdGlmICghYXJndW1lbnRzLmxlbmd0aClcblx0ICAgIHJldHVybiBtYXJnaW47XG5cdG1hcmdpbiA9IHZhbHVlO1xuXHRyZXR1cm4gZ2FudHQ7XG4gICAgfTtcblxuICAgIGdhbnR0LnRpbWVEb21haW4gPSBmdW5jdGlvbih2YWx1ZSkge1xuXHRpZiAoIWFyZ3VtZW50cy5sZW5ndGgpXG5cdCAgICByZXR1cm4gWyB0aW1lRG9tYWluU3RhcnQsIHRpbWVEb21haW5FbmQgXTtcblx0dGltZURvbWFpblN0YXJ0ID0gK3ZhbHVlWzBdLCB0aW1lRG9tYWluRW5kID0gK3ZhbHVlWzFdO1xuXHRyZXR1cm4gZ2FudHQ7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfVxuICAgICAqICAgICAgICAgICAgICAgIHZhbGUgVGhlIHZhbHVlIGNhbiBiZSBcImZpdFwiIC0gdGhlIGRvbWFpbiBmaXRzIHRoZSBkYXRhIG9yXG4gICAgICogICAgICAgICAgICAgICAgXCJmaXhlZFwiIC0gZml4ZWQgZG9tYWluLlxuICAgICAqL1xuICAgIGdhbnR0LnRpbWVEb21haW5Nb2RlID0gZnVuY3Rpb24odmFsdWUpIHtcblx0aWYgKCFhcmd1bWVudHMubGVuZ3RoKVxuXHQgICAgcmV0dXJuIHRpbWVEb21haW5Nb2RlO1xuICAgICAgICB0aW1lRG9tYWluTW9kZSA9IHZhbHVlO1xuICAgICAgICByZXR1cm4gZ2FudHQ7XG5cbiAgICB9O1xuXG4gICAgZ2FudHQudGFza1R5cGVzID0gZnVuY3Rpb24odmFsdWUpIHtcblx0aWYgKCFhcmd1bWVudHMubGVuZ3RoKVxuXHQgICAgcmV0dXJuIHRhc2tUeXBlcztcblx0dGFza1R5cGVzID0gdmFsdWU7XG5cdHJldHVybiBnYW50dDtcbiAgICB9O1xuXG4gICAgZ2FudHQudGFza1N0YXR1cyA9IGZ1bmN0aW9uKHZhbHVlKSB7XG5cdGlmICghYXJndW1lbnRzLmxlbmd0aClcblx0ICAgIHJldHVybiB0YXNrU3RhdHVzO1xuXHR0YXNrU3RhdHVzID0gdmFsdWU7XG5cdHJldHVybiBnYW50dDtcbiAgICB9O1xuXG5cdGdhbnR0LmJlZ2luID0gZnVuY3Rpb24odmFsdWUpe1xuXHRcdGlmKCFhcmd1bWVudHMubGVuZ3RoKXtcblx0XHRcdHJldHVybiBiZWdpbjtcblx0XHR9XG5cdFx0YmVnaW4gPSB2YWx1ZTtcblx0XHRyZXR1cm4gZ2FudHQ7XG5cdH07XG5cblx0Z2FudHQuZW5kZWQgPSBmdW5jdGlvbih2YWx1ZSl7XG5cdFx0aWYoIWFyZ3VtZW50cy5sZW5ndGgpe1xuXHRcdFx0cmV0dXJuIGVuZGVkO1xuXHRcdH1cblx0XHRlbmRlZCA9IHZhbHVlO1xuXHRcdHJldHVybiBnYW50dDtcblx0fTtcblxuICAgIGdhbnR0LndpZHRoID0gZnVuY3Rpb24odmFsdWUpIHtcblx0aWYgKCFhcmd1bWVudHMubGVuZ3RoKVxuXHQgICAgcmV0dXJuIHdpZHRoO1xuXHR3aWR0aCA9ICt2YWx1ZTtcblx0cmV0dXJuIGdhbnR0O1xuICAgIH07XG5cbiAgICBnYW50dC5oZWlnaHQgPSBmdW5jdGlvbih2YWx1ZSkge1xuXHRpZiAoIWFyZ3VtZW50cy5sZW5ndGgpXG5cdCAgICByZXR1cm4gaGVpZ2h0O1xuXHRoZWlnaHQgPSArdmFsdWU7XG5cdHJldHVybiBnYW50dDtcbiAgICB9O1xuXG4gICAgZ2FudHQudGlja0Zvcm1hdCA9IGZ1bmN0aW9uKHZhbHVlKSB7XG5cdGlmICghYXJndW1lbnRzLmxlbmd0aClcblx0ICAgIHJldHVybiB0aWNrRm9ybWF0O1xuXHR0aWNrRm9ybWF0ID0gdmFsdWU7XG5cdHJldHVybiBnYW50dDtcbiAgICB9O1xuXG5cdGdhbnR0LnJlbmRlclRvID0gZnVuY3Rpb24odmFsdWUpIHtcblx0XHRpZighYXJndW1lbnRzLmxlbmd0aCl7XG5cdFx0XHRyZXR1cm4gcmVuZGVyVG87XG5cdFx0fVxuXHRcdHJlbmRlclRvID0gdmFsdWU7XG5cdFx0cmV0dXJuIGdhbnR0O1xuXHR9O1xuXG5cblxuICAgIHJldHVybiBnYW50dDtcbn07XG4iLCJmdW5jdGlvbiBHYXVnZShwbGFjZWhvbGRlck5hbWUsIGNvbmZpZ3VyYXRpb24pXG57XG4gICAgdGhpcy5wbGFjZWhvbGRlck5hbWUgPSBwbGFjZWhvbGRlck5hbWU7XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7IC8vIGZvciBpbnRlcm5hbCBkMyBmdW5jdGlvbnNcblxuICAgIHRoaXMuY29uZmlndXJlID0gZnVuY3Rpb24oY29uZmlndXJhdGlvbilcbiAgICB7XG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlndXJhdGlvbjtcblxuICAgICAgICB0aGlzLmNvbmZpZy5zaXplID0gdGhpcy5jb25maWcuc2l6ZSAqIDAuOTtcblxuICAgICAgICB0aGlzLmNvbmZpZy5yYWR1aXMgPSB0aGlzLmNvbmZpZy5zaXplICogMC45NyAvIDI7XG4gICAgICAgIHRoaXMuY29uZmlnLmN4ID0gdGhpcy5jb25maWcuc2l6ZSAvIDI7XG4gICAgICAgIHRoaXMuY29uZmlnLmN5ID0gdGhpcy5jb25maWcuc2l6ZSAvIDI7XG5cbiAgICAgICAgdGhpcy5jb25maWcubWluID0gdW5kZWZpbmVkICE9IGNvbmZpZ3VyYXRpb24ubWluID8gY29uZmlndXJhdGlvbi5taW4gOiAwO1xuICAgICAgICB0aGlzLmNvbmZpZy5tYXggPSB1bmRlZmluZWQgIT0gY29uZmlndXJhdGlvbi5tYXggPyBjb25maWd1cmF0aW9uLm1heCA6IDEwMDtcbiAgICAgICAgdGhpcy5jb25maWcucmFuZ2UgPSB0aGlzLmNvbmZpZy5tYXggLSB0aGlzLmNvbmZpZy5taW47XG5cbiAgICAgICAgdGhpcy5jb25maWcubWFqb3JUaWNrcyA9IGNvbmZpZ3VyYXRpb24ubWFqb3JUaWNrcyB8fCA1O1xuICAgICAgICB0aGlzLmNvbmZpZy5taW5vclRpY2tzID0gY29uZmlndXJhdGlvbi5taW5vclRpY2tzIHx8IDI7XG5cbiAgICAgICAgdGhpcy5jb25maWcuZ3JlZW5Db2xvciBcdD0gY29uZmlndXJhdGlvbi5ncmVlbkNvbG9yIHx8IFwiIzhmY2EwZVwiO1xuICAgICAgICB0aGlzLmNvbmZpZy55ZWxsb3dDb2xvciA9IGNvbmZpZ3VyYXRpb24ueWVsbG93Q29sb3IgfHwgXCIjZmZjMzE3XCI7XG4gICAgICAgIHRoaXMuY29uZmlnLnJlZENvbG9yIFx0PSBjb25maWd1cmF0aW9uLnJlZENvbG9yIHx8IFwiI2Y1NGQzNlwiO1xuXG4gICAgICAgIHRoaXMuY29uZmlnLnRyYW5zaXRpb25EdXJhdGlvbiA9IGNvbmZpZ3VyYXRpb24udHJhbnNpdGlvbkR1cmF0aW9uIHx8IDUwMDtcbiAgICB9O1xuXG4gICAgdGhpcy5yZW5kZXIgPSBmdW5jdGlvbigpXG4gICAge1xuICAgICAgICB0aGlzLmJvZHkgPSBkMy5zZWxlY3QoXCIjXCIgKyB0aGlzLnBsYWNlaG9sZGVyTmFtZSlcbiAgICAgICAgICAgIC5hcHBlbmQoXCJzdmc6c3ZnXCIpXG4gICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiZ2F1Z2VcIilcbiAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgdGhpcy5jb25maWcuc2l6ZSlcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIHRoaXMuY29uZmlnLnNpemUpO1xuXG4gICAgICAgIHRoaXMuYm9keS5hcHBlbmQoXCJzdmc6Y2lyY2xlXCIpXG4gICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwib3V0ZXItY2lyY2xlXCIpXG4gICAgICAgICAgICAuYXR0cihcImN4XCIsIHRoaXMuY29uZmlnLmN4KVxuICAgICAgICAgICAgLmF0dHIoXCJjeVwiLCB0aGlzLmNvbmZpZy5jeSlcbiAgICAgICAgICAgIC5hdHRyKFwiclwiLCB0aGlzLmNvbmZpZy5yYWR1aXMgKiAwLjk1KVxuICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBcIiNjY2NcIik7XG4gICAgICAgICAgICAvKi5zdHlsZShcInN0cm9rZVwiLCBcIiMwMDBcIilcbiAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCBcIjAuNXB4XCIpOyovXG5cbiAgICAgICAgdGhpcy5ib2R5LmFwcGVuZChcInN2ZzpjaXJjbGVcIilcbiAgICAgICAgICAgIC5hdHRyKFwiY3hcIiwgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAuYXR0cihcImN5XCIsIHRoaXMuY29uZmlnLmN5KVxuICAgICAgICAgICAgLmF0dHIoXCJyXCIsIDAuOSAqIHRoaXMuY29uZmlnLnJhZHVpcylcbiAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgXCIjZmZmXCIpXG4gICAgICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCIjZTBlMGUwXCIpXG4gICAgICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgXCIycHhcIik7XG5cbiAgICAgICAgZm9yICh2YXIgZ3JlZW5JZHggaW4gdGhpcy5jb25maWcuZ3JlZW5ab25lcylcbiAgICAgICAge1xuICAgICAgICAgICAgdGhpcy5kcmF3QmFuZCh0aGlzLmNvbmZpZy5ncmVlblpvbmVzW2dyZWVuSWR4XS5mcm9tLCB0aGlzLmNvbmZpZy5ncmVlblpvbmVzW2dyZWVuSWR4XS50bywgc2VsZi5jb25maWcuZ3JlZW5Db2xvcik7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciB5ZWxsb3dJZHggaW4gdGhpcy5jb25maWcueWVsbG93Wm9uZXMpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMuZHJhd0JhbmQodGhpcy5jb25maWcueWVsbG93Wm9uZXNbeWVsbG93SWR4XS5mcm9tLCB0aGlzLmNvbmZpZy55ZWxsb3dab25lc1t5ZWxsb3dJZHhdLnRvLCBzZWxmLmNvbmZpZy55ZWxsb3dDb2xvcik7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciByZWRJZHggaW4gdGhpcy5jb25maWcucmVkWm9uZXMpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMuZHJhd0JhbmQodGhpcy5jb25maWcucmVkWm9uZXNbcmVkSWR4XS5mcm9tLCB0aGlzLmNvbmZpZy5yZWRab25lc1tyZWRJZHhdLnRvLCBzZWxmLmNvbmZpZy5yZWRDb2xvcik7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZm9udFNpemUgPSAwO1xuXG4gICAgICAgIGlmICh1bmRlZmluZWQgIT0gdGhpcy5jb25maWcubGFiZWwpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGZvbnRTaXplID0gTWF0aC5yb3VuZCh0aGlzLmNvbmZpZy5zaXplIC8gOSk7XG4gICAgICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKFwic3ZnOnRleHRcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIHRoaXMuY29uZmlnLmN5IC8gMiArIGZvbnRTaXplIC8gMilcbiAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIGZvbnRTaXplIC8gMilcbiAgICAgICAgICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAgICAgICAgICAgLnRleHQodGhpcy5jb25maWcubGFiZWwpXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIGZvbnRTaXplICsgXCJweFwiKVxuICAgICAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgXCIjMzMzXCIpXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMHB4XCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9udFNpemUgPSBNYXRoLnJvdW5kKHRoaXMuY29uZmlnLnNpemUgLyAxNik7XG4gICAgICAgIHZhciBtYWpvckRlbHRhID0gdGhpcy5jb25maWcucmFuZ2UgLyAodGhpcy5jb25maWcubWFqb3JUaWNrcyAtIDEpO1xuICAgICAgICBmb3IgKHZhciBtYWpvciA9IHRoaXMuY29uZmlnLm1pbjsgbWFqb3IgPD0gdGhpcy5jb25maWcubWF4OyBtYWpvciArPSBtYWpvckRlbHRhKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgbWlub3JEZWx0YSA9IG1ham9yRGVsdGEgLyB0aGlzLmNvbmZpZy5taW5vclRpY2tzLFxuICAgICAgICAgICAgICAgIHBvaW50MSA9IDAsXG4gICAgICAgICAgICAgICAgcG9pbnQyID0gMDtcbiAgICAgICAgICAgIGZvciAodmFyIG1pbm9yID0gbWFqb3IgKyBtaW5vckRlbHRhOyBtaW5vciA8IE1hdGgubWluKG1ham9yICsgbWFqb3JEZWx0YSwgdGhpcy5jb25maWcubWF4KTsgbWlub3IgKz0gbWlub3JEZWx0YSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwb2ludDEgPSB0aGlzLnZhbHVlVG9Qb2ludChtaW5vciwgMC43NSk7XG4gICAgICAgICAgICAgICAgcG9pbnQyID0gdGhpcy52YWx1ZVRvUG9pbnQobWlub3IsIDAuODUpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5ib2R5LmFwcGVuZChcInN2ZzpsaW5lXCIpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieDFcIiwgcG9pbnQxLngpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieTFcIiwgcG9pbnQxLnkpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieDJcIiwgcG9pbnQyLngpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieTJcIiwgcG9pbnQyLnkpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBcIiM2NjZcIilcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMXB4XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwb2ludDEgPSB0aGlzLnZhbHVlVG9Qb2ludChtYWpvciwgMC43KTtcbiAgICAgICAgICAgIHBvaW50MiA9IHRoaXMudmFsdWVUb1BvaW50KG1ham9yLCAwLjg1KTtcblxuICAgICAgICAgICAgdGhpcy5ib2R5LmFwcGVuZChcInN2ZzpsaW5lXCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ4MVwiLCBwb2ludDEueClcbiAgICAgICAgICAgICAgICAuYXR0cihcInkxXCIsIHBvaW50MS55KVxuICAgICAgICAgICAgICAgIC5hdHRyKFwieDJcIiwgcG9pbnQyLngpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ5MlwiLCBwb2ludDIueSlcbiAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCIjMzMzXCIpXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMnB4XCIpO1xuXG4gICAgICAgICAgICBpZiAobWFqb3IgPT0gdGhpcy5jb25maWcubWluIHx8IG1ham9yID09IHRoaXMuY29uZmlnLm1heClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgcG9pbnQgPSB0aGlzLnZhbHVlVG9Qb2ludChtYWpvciwgMC42Myk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKFwic3ZnOnRleHRcIilcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIHBvaW50LngpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCBwb2ludC55KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIGZvbnRTaXplIC8gMylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBtYWpvciA9PSB0aGlzLmNvbmZpZy5taW4gPyBcInN0YXJ0XCIgOiBcImVuZFwiKVxuICAgICAgICAgICAgICAgICAgICAudGV4dChtYWpvcilcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIGZvbnRTaXplICsgXCJweFwiKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIFwiIzMzM1wiKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgXCIwcHhcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcG9pbnRlckNvbnRhaW5lciA9IHRoaXMuYm9keS5hcHBlbmQoXCJzdmc6Z1wiKS5hdHRyKFwiY2xhc3NcIiwgXCJwb2ludGVyQ29udGFpbmVyXCIpO1xuXG4gICAgICAgIHZhciBtaWRWYWx1ZSA9ICh0aGlzLmNvbmZpZy5taW4gKyB0aGlzLmNvbmZpZy5tYXgpIC8gMjtcblxuICAgICAgICB2YXIgcG9pbnRlclBhdGggPSB0aGlzLmJ1aWxkUG9pbnRlclBhdGgobWlkVmFsdWUpO1xuXG4gICAgICAgIHZhciBwb2ludGVyTGluZSA9IGQzLnN2Zy5saW5lKClcbiAgICAgICAgICAgIC54KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQueCB9KVxuICAgICAgICAgICAgLnkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC55IH0pXG4gICAgICAgICAgICAuaW50ZXJwb2xhdGUoXCJiYXNpc1wiKTtcblxuICAgICAgICBwb2ludGVyQ29udGFpbmVyLnNlbGVjdEFsbChcInBhdGhcIilcbiAgICAgICAgICAgIC5kYXRhKFtwb2ludGVyUGF0aF0pXG4gICAgICAgICAgICAuZW50ZXIoKVxuICAgICAgICAgICAgLmFwcGVuZChcInN2ZzpwYXRoXCIpXG4gICAgICAgICAgICAuYXR0cihcImRcIiwgcG9pbnRlckxpbmUpXG4gICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIFwiIzg4OFwiKTtcblxuICAgICAgICBwb2ludGVyQ29udGFpbmVyLmFwcGVuZChcInN2ZzpjaXJjbGVcIilcbiAgICAgICAgICAgIC5hdHRyKFwiY3hcIiwgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAuYXR0cihcImN5XCIsIHRoaXMuY29uZmlnLmN5KVxuICAgICAgICAgICAgLmF0dHIoXCJyXCIsIDAuMTIgKiB0aGlzLmNvbmZpZy5yYWR1aXMpXG4gICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIFwiIzg4OFwiKTtcblxuICAgICAgICBmb250U2l6ZSA9IE1hdGgucm91bmQodGhpcy5jb25maWcuc2l6ZSAvIDEwKTtcbiAgICAgICAgcG9pbnRlckNvbnRhaW5lci5zZWxlY3RBbGwoXCJ0ZXh0XCIpXG4gICAgICAgICAgICAuZGF0YShbbWlkVmFsdWVdKVxuICAgICAgICAgICAgLmVudGVyKClcbiAgICAgICAgICAgIC5hcHBlbmQoXCJzdmc6dGV4dFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIHRoaXMuY29uZmlnLmN4KVxuICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIHRoaXMuY29uZmlnLnNpemUgLSB0aGlzLmNvbmZpZy5jeSAvIDQgLSBmb250U2l6ZSlcbiAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgZm9udFNpemUgLyAyKVxuICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgICAgICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIGZvbnRTaXplICsgXCJweFwiKVxuICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBcIiMwMDBcIilcbiAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCBcIjBweFwiKTtcblxuICAgICAgICB0aGlzLnJlZHJhdyh0aGlzLmNvbmZpZy5taW4sIDApO1xuICAgIH07XG5cbiAgICB0aGlzLmJ1aWxkUG9pbnRlclBhdGggPSBmdW5jdGlvbih2YWx1ZSlcbiAgICB7XG4gICAgICAgIHZhciBkZWx0YSA9IHRoaXMuY29uZmlnLnJhbmdlIC8gMTM7XG5cbiAgICAgICAgdmFyIGhlYWQgPSB2YWx1ZVRvUG9pbnQodmFsdWUsIDAuODUpO1xuICAgICAgICB2YXIgaGVhZDEgPSB2YWx1ZVRvUG9pbnQodmFsdWUgLSBkZWx0YSwgMC4xMik7XG4gICAgICAgIHZhciBoZWFkMiA9IHZhbHVlVG9Qb2ludCh2YWx1ZSArIGRlbHRhLCAwLjEyKTtcblxuICAgICAgICB2YXIgdGFpbFZhbHVlID0gdmFsdWUgLSAodGhpcy5jb25maWcucmFuZ2UgKiAoMS8oMjcwLzM2MCkpIC8gMik7XG4gICAgICAgIHZhciB0YWlsID0gdmFsdWVUb1BvaW50KHRhaWxWYWx1ZSwgMC4yOCk7XG4gICAgICAgIHZhciB0YWlsMSA9IHZhbHVlVG9Qb2ludCh0YWlsVmFsdWUgLSBkZWx0YSwgMC4xMik7XG4gICAgICAgIHZhciB0YWlsMiA9IHZhbHVlVG9Qb2ludCh0YWlsVmFsdWUgKyBkZWx0YSwgMC4xMik7XG5cbiAgICAgICAgcmV0dXJuIFtoZWFkLCBoZWFkMSwgdGFpbDIsIHRhaWwsIHRhaWwxLCBoZWFkMiwgaGVhZF07XG5cbiAgICAgICAgZnVuY3Rpb24gdmFsdWVUb1BvaW50KHZhbHVlLCBmYWN0b3IpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZhciBwb2ludCA9IHNlbGYudmFsdWVUb1BvaW50KHZhbHVlLCBmYWN0b3IpO1xuICAgICAgICAgICAgcG9pbnQueCAtPSBzZWxmLmNvbmZpZy5jeDtcbiAgICAgICAgICAgIHBvaW50LnkgLT0gc2VsZi5jb25maWcuY3k7XG4gICAgICAgICAgICByZXR1cm4gcG9pbnQ7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5kcmF3QmFuZCA9IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGNvbG9yKVxuICAgIHtcbiAgICAgICAgaWYgKDAgPj0gZW5kIC0gc3RhcnQpIHJldHVybjtcblxuICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKFwic3ZnOnBhdGhcIilcbiAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgY29sb3IpXG4gICAgICAgICAgICAuYXR0cihcImRcIiwgZDMuc3ZnLmFyYygpXG4gICAgICAgICAgICAgICAgLnN0YXJ0QW5nbGUodGhpcy52YWx1ZVRvUmFkaWFucyhzdGFydCkpXG4gICAgICAgICAgICAgICAgLmVuZEFuZ2xlKHRoaXMudmFsdWVUb1JhZGlhbnMoZW5kKSlcbiAgICAgICAgICAgICAgICAuaW5uZXJSYWRpdXMoMC42NSAqIHRoaXMuY29uZmlnLnJhZHVpcylcbiAgICAgICAgICAgICAgICAub3V0ZXJSYWRpdXMoMC44NSAqIHRoaXMuY29uZmlnLnJhZHVpcykpXG4gICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbigpIHsgcmV0dXJuIFwidHJhbnNsYXRlKFwiICsgc2VsZi5jb25maWcuY3ggKyBcIiwgXCIgKyBzZWxmLmNvbmZpZy5jeSArIFwiKSByb3RhdGUoMjcwKVwiIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLnJlZHJhdyA9IGZ1bmN0aW9uKHZhbHVlLCB0cmFuc2l0aW9uRHVyYXRpb24pXG4gICAge1xuICAgICAgICB2YXIgcG9pbnRlckNvbnRhaW5lciA9IHRoaXMuYm9keS5zZWxlY3QoXCIucG9pbnRlckNvbnRhaW5lclwiKTtcblxuICAgICAgICBwb2ludGVyQ29udGFpbmVyLnNlbGVjdEFsbChcInRleHRcIikudGV4dChNYXRoLnJvdW5kKHZhbHVlKSk7XG5cbiAgICAgICAgdmFyIHBvaW50ZXIgPSBwb2ludGVyQ29udGFpbmVyLnNlbGVjdEFsbChcInBhdGhcIik7XG4gICAgICAgIHBvaW50ZXIudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAuZHVyYXRpb24odW5kZWZpbmVkICE9IHRyYW5zaXRpb25EdXJhdGlvbiA/IHRyYW5zaXRpb25EdXJhdGlvbiA6IHRoaXMuY29uZmlnLnRyYW5zaXRpb25EdXJhdGlvbilcbiAgICAgICAgICAgIC8vLmRlbGF5KDApXG4gICAgICAgICAgICAvLy5lYXNlKFwibGluZWFyXCIpXG4gICAgICAgICAgICAvLy5hdHRyKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uKGQpXG4gICAgICAgICAgICAuYXR0clR3ZWVuKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uKClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgcG9pbnRlclZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gc2VsZi5jb25maWcubWF4KSBwb2ludGVyVmFsdWUgPSBzZWxmLmNvbmZpZy5tYXggKyAwLjAyKnNlbGYuY29uZmlnLnJhbmdlO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlIDwgc2VsZi5jb25maWcubWluKSBwb2ludGVyVmFsdWUgPSBzZWxmLmNvbmZpZy5taW4gLSAwLjAyKnNlbGYuY29uZmlnLnJhbmdlO1xuICAgICAgICAgICAgICAgIHZhciB0YXJnZXRSb3RhdGlvbiA9IChzZWxmLnZhbHVlVG9EZWdyZWVzKHBvaW50ZXJWYWx1ZSkgLSA5MCk7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRSb3RhdGlvbiA9IHNlbGYuX2N1cnJlbnRSb3RhdGlvbiB8fCB0YXJnZXRSb3RhdGlvbjtcbiAgICAgICAgICAgICAgICBzZWxmLl9jdXJyZW50Um90YXRpb24gPSB0YXJnZXRSb3RhdGlvbjtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihzdGVwKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvdGF0aW9uID0gY3VycmVudFJvdGF0aW9uICsgKHRhcmdldFJvdGF0aW9uLWN1cnJlbnRSb3RhdGlvbikqc3RlcDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwidHJhbnNsYXRlKFwiICsgc2VsZi5jb25maWcuY3ggKyBcIiwgXCIgKyBzZWxmLmNvbmZpZy5jeSArIFwiKSByb3RhdGUoXCIgKyByb3RhdGlvbiArIFwiKVwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBvdXRlckNpcmNsZSA9IHRoaXMuYm9keS5zZWxlY3QoXCIub3V0ZXItY2lyY2xlXCIpXG4gICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAuZHVyYXRpb24oNzUwKVxuICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGkgPSBwYXJzZUludCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKGkgPiAwICYmIGkgPCA3NSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcuZ3JlZW5Db2xvcjtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPj0gNzUgJiYgaSA8IDkwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy55ZWxsb3dDb2xvcjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcucmVkQ29sb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMudmFsdWVUb0RlZ3JlZXMgPSBmdW5jdGlvbih2YWx1ZSlcbiAgICB7XG4gICAgICAgIC8vIHRoYW5rcyBAY2xvc2VhbGVydFxuICAgICAgICAvL3JldHVybiB2YWx1ZSAvIHRoaXMuY29uZmlnLnJhbmdlICogMjcwIC0gNDU7XG4gICAgICAgIHJldHVybiB2YWx1ZSAvIHRoaXMuY29uZmlnLnJhbmdlICogMjcwIC0gKHRoaXMuY29uZmlnLm1pbiAvIHRoaXMuY29uZmlnLnJhbmdlICogMjcwICsgNDUpO1xuICAgIH07XG5cbiAgICB0aGlzLnZhbHVlVG9SYWRpYW5zID0gZnVuY3Rpb24odmFsdWUpXG4gICAge1xuICAgICAgICByZXR1cm4gdGhpcy52YWx1ZVRvRGVncmVlcyh2YWx1ZSkgKiBNYXRoLlBJIC8gMTgwO1xuICAgIH07XG5cbiAgICB0aGlzLnZhbHVlVG9Qb2ludCA9IGZ1bmN0aW9uKHZhbHVlLCBmYWN0b3IpXG4gICAge1xuICAgICAgICByZXR1cm4geyBcdHg6IHRoaXMuY29uZmlnLmN4IC0gdGhpcy5jb25maWcucmFkdWlzICogZmFjdG9yICogTWF0aC5jb3ModGhpcy52YWx1ZVRvUmFkaWFucyh2YWx1ZSkpLFxuICAgICAgICAgICAgeTogdGhpcy5jb25maWcuY3kgLSB0aGlzLmNvbmZpZy5yYWR1aXMgKiBmYWN0b3IgKiBNYXRoLnNpbih0aGlzLnZhbHVlVG9SYWRpYW5zKHZhbHVlKSkgXHRcdH07XG4gICAgfTtcblxuICAgIC8vIGluaXRpYWxpemF0aW9uXG4gICAgdGhpcy5jb25maWd1cmUoY29uZmlndXJhdGlvbik7XG59IiwiLyohIFxuICogYW5ndWxhci1ob3RrZXlzIHYxLjUuMFxuICogaHR0cHM6Ly9jaGllZmZhbmN5cGFudHMuZ2l0aHViLmlvL2FuZ3VsYXItaG90a2V5c1xuICogQ29weXJpZ2h0IChjKSAyMDE1IFdlcyBDcnV2ZXJcbiAqIExpY2Vuc2U6IE1JVFxuICovXG4hZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjthbmd1bGFyLm1vZHVsZShcImNmcC5ob3RrZXlzXCIsW10pLnByb3ZpZGVyKFwiaG90a2V5c1wiLFtcIiRpbmplY3RvclwiLGZ1bmN0aW9uKGEpe3RoaXMuaW5jbHVkZUNoZWF0U2hlZXQ9ITAsdGhpcy51c2VOZ1JvdXRlPWEuaGFzKFwibmdWaWV3RGlyZWN0aXZlXCIpLHRoaXMudGVtcGxhdGVUaXRsZT1cIktleWJvYXJkIFNob3J0Y3V0czpcIix0aGlzLnRlbXBsYXRlSGVhZGVyPW51bGwsdGhpcy50ZW1wbGF0ZUZvb3Rlcj1udWxsLHRoaXMudGVtcGxhdGU9JzxkaXYgY2xhc3M9XCJjZnAtaG90a2V5cy1jb250YWluZXIgZmFkZVwiIG5nLWNsYXNzPVwie2luOiBoZWxwVmlzaWJsZX1cIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCI+PGRpdiBjbGFzcz1cImNmcC1ob3RrZXlzXCI+PGg0IGNsYXNzPVwiY2ZwLWhvdGtleXMtdGl0bGVcIiBuZy1pZj1cIiFoZWFkZXJcIj57eyB0aXRsZSB9fTwvaDQ+PGRpdiBuZy1iaW5kLWh0bWw9XCJoZWFkZXJcIiBuZy1pZj1cImhlYWRlclwiPjwvZGl2Pjx0YWJsZT48dGJvZHk+PHRyIG5nLXJlcGVhdD1cImhvdGtleSBpbiBob3RrZXlzIHwgZmlsdGVyOnsgZGVzY3JpcHRpb246IFxcJyEkJHVuZGVmaW5lZCQkXFwnIH1cIj48dGQgY2xhc3M9XCJjZnAtaG90a2V5cy1rZXlzXCI+PHNwYW4gbmctcmVwZWF0PVwia2V5IGluIGhvdGtleS5mb3JtYXQoKSB0cmFjayBieSAkaW5kZXhcIiBjbGFzcz1cImNmcC1ob3RrZXlzLWtleVwiPnt7IGtleSB9fTwvc3Bhbj48L3RkPjx0ZCBjbGFzcz1cImNmcC1ob3RrZXlzLXRleHRcIj57eyBob3RrZXkuZGVzY3JpcHRpb24gfX08L3RkPjwvdHI+PC90Ym9keT48L3RhYmxlPjxkaXYgbmctYmluZC1odG1sPVwiZm9vdGVyXCIgbmctaWY9XCJmb290ZXJcIj48L2Rpdj48ZGl2IGNsYXNzPVwiY2ZwLWhvdGtleXMtY2xvc2VcIiBuZy1jbGljaz1cInRvZ2dsZUNoZWF0U2hlZXQoKVwiPsOXPC9kaXY+PC9kaXY+PC9kaXY+Jyx0aGlzLmNoZWF0U2hlZXRIb3RrZXk9XCI/XCIsdGhpcy5jaGVhdFNoZWV0RGVzY3JpcHRpb249XCJTaG93IC8gaGlkZSB0aGlzIGhlbHAgbWVudVwiLHRoaXMuJGdldD1bXCIkcm9vdEVsZW1lbnRcIixcIiRyb290U2NvcGVcIixcIiRjb21waWxlXCIsXCIkd2luZG93XCIsXCIkZG9jdW1lbnRcIixmdW5jdGlvbihhLGIsYyxkLGUpe2Z1bmN0aW9uIGYoYSl7dmFyIGI9e2NvbW1hbmQ6XCLijJhcIixzaGlmdDpcIuKHp1wiLGxlZnQ6XCLihpBcIixyaWdodDpcIuKGklwiLHVwOlwi4oaRXCIsZG93bjpcIuKGk1wiLFwicmV0dXJuXCI6XCLihqlcIixiYWNrc3BhY2U6XCLijKtcIn07YT1hLnNwbGl0KFwiK1wiKTtmb3IodmFyIGM9MDtjPGEubGVuZ3RoO2MrKylcIm1vZFwiPT09YVtjXSYmKGQubmF2aWdhdG9yJiZkLm5hdmlnYXRvci5wbGF0Zm9ybS5pbmRleE9mKFwiTWFjXCIpPj0wP2FbY109XCJjb21tYW5kXCI6YVtjXT1cImN0cmxcIiksYVtjXT1iW2FbY11dfHxhW2NdO3JldHVybiBhLmpvaW4oXCIgKyBcIil9ZnVuY3Rpb24gZyhhLGIsYyxkLGUsZil7dGhpcy5jb21ibz1hIGluc3RhbmNlb2YgQXJyYXk/YTpbYV0sdGhpcy5kZXNjcmlwdGlvbj1iLHRoaXMuY2FsbGJhY2s9Yyx0aGlzLmFjdGlvbj1kLHRoaXMuYWxsb3dJbj1lLHRoaXMucGVyc2lzdGVudD1mLHRoaXMuX2Zvcm1hdGVkPW51bGx9ZnVuY3Rpb24gaCgpe2Zvcih2YXIgYT1vLmhvdGtleXMubGVuZ3RoO2EtLTspe3ZhciBiPW8uaG90a2V5c1thXTtiJiYhYi5wZXJzaXN0ZW50JiZrKGIpfX1mdW5jdGlvbiBpKCl7by5oZWxwVmlzaWJsZT0hby5oZWxwVmlzaWJsZSxvLmhlbHBWaXNpYmxlPyh0PWwoXCJlc2NcIiksayhcImVzY1wiKSxqKFwiZXNjXCIsdC5kZXNjcmlwdGlvbixpLG51bGwsW1wiSU5QVVRcIixcIlNFTEVDVFwiLFwiVEVYVEFSRUFcIl0pKTooayhcImVzY1wiKSx0IT09ITEmJmoodCkpfWZ1bmN0aW9uIGooYSxiLGMsZCxlLGYpe3ZhciBoLGk9W1wiSU5QVVRcIixcIlNFTEVDVFwiLFwiVEVYVEFSRUFcIl0saj1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYSk7aWYoXCJbb2JqZWN0IE9iamVjdF1cIj09PWomJihiPWEuZGVzY3JpcHRpb24sYz1hLmNhbGxiYWNrLGQ9YS5hY3Rpb24sZj1hLnBlcnNpc3RlbnQsZT1hLmFsbG93SW4sYT1hLmNvbWJvKSxiIGluc3RhbmNlb2YgRnVuY3Rpb24/KGQ9YyxjPWIsYj1cIiQkdW5kZWZpbmVkJCRcIik6YW5ndWxhci5pc1VuZGVmaW5lZChiKSYmKGI9XCIkJHVuZGVmaW5lZCQkXCIpLHZvaWQgMD09PWYmJihmPSEwKSxcImZ1bmN0aW9uXCI9PXR5cGVvZiBjKXtoPWMsZSBpbnN0YW5jZW9mIEFycmF5fHwoZT1bXSk7Zm9yKHZhciBrLGw9MDtsPGUubGVuZ3RoO2wrKyllW2xdPWVbbF0udG9VcHBlckNhc2UoKSxrPWkuaW5kZXhPZihlW2xdKSwtMSE9PWsmJmkuc3BsaWNlKGssMSk7Yz1mdW5jdGlvbihhKXt2YXIgYj0hMCxjPWEudGFyZ2V0fHxhLnNyY0VsZW1lbnQsZD1jLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk7aWYoKFwiIFwiK2MuY2xhc3NOYW1lK1wiIFwiKS5pbmRleE9mKFwiIG1vdXNldHJhcCBcIik+LTEpYj0hMDtlbHNlIGZvcih2YXIgZT0wO2U8aS5sZW5ndGg7ZSsrKWlmKGlbZV09PT1kKXtiPSExO2JyZWFrfWImJm4oaC5hcHBseSh0aGlzLGFyZ3VtZW50cykpfX1cInN0cmluZ1wiPT10eXBlb2YgZD9Nb3VzZXRyYXAuYmluZChhLG4oYyksZCk6TW91c2V0cmFwLmJpbmQoYSxuKGMpKTt2YXIgbT1uZXcgZyhhLGIsYyxkLGUsZik7cmV0dXJuIG8uaG90a2V5cy5wdXNoKG0pLG19ZnVuY3Rpb24gayhhKXt2YXIgYj1hIGluc3RhbmNlb2YgZz9hLmNvbWJvOmE7aWYoTW91c2V0cmFwLnVuYmluZChiKSxhbmd1bGFyLmlzQXJyYXkoYikpe2Zvcih2YXIgYz0hMCxkPWIubGVuZ3RoO2QtLTspYz1rKGJbZF0pJiZjO3JldHVybiBjfXZhciBlPW8uaG90a2V5cy5pbmRleE9mKGwoYikpO3JldHVybiBlPi0xPyhvLmhvdGtleXNbZV0uY29tYm8ubGVuZ3RoPjE/by5ob3RrZXlzW2VdLmNvbWJvLnNwbGljZShvLmhvdGtleXNbZV0uY29tYm8uaW5kZXhPZihiKSwxKTpvLmhvdGtleXMuc3BsaWNlKGUsMSksITApOiExfWZ1bmN0aW9uIGwoYSl7aWYoIWEpcmV0dXJuIG8uaG90a2V5cztmb3IodmFyIGIsYz0wO2M8by5ob3RrZXlzLmxlbmd0aDtjKyspaWYoYj1vLmhvdGtleXNbY10sYi5jb21iby5pbmRleE9mKGEpPi0xKXJldHVybiBiO3JldHVybiExfWZ1bmN0aW9uIG0oYSl7cmV0dXJuIGEuJGlkIGluIHB8fChwW2EuJGlkXT1bXSxhLiRvbihcIiRkZXN0cm95XCIsZnVuY3Rpb24oKXtmb3IodmFyIGI9cFthLiRpZF0ubGVuZ3RoO2ItLTspayhwW2EuJGlkXS5wb3AoKSl9KSkse2FkZDpmdW5jdGlvbihiKXt2YXIgYztyZXR1cm4gYz1hcmd1bWVudHMubGVuZ3RoPjE/ai5hcHBseSh0aGlzLGFyZ3VtZW50cyk6aihiKSxwW2EuJGlkXS5wdXNoKGMpLHRoaXN9fX1mdW5jdGlvbiBuKGEpe3JldHVybiBmdW5jdGlvbihjLGQpe2lmKGEgaW5zdGFuY2VvZiBBcnJheSl7dmFyIGU9YVswXSxmPWFbMV07YT1mdW5jdGlvbihhKXtmLnNjb3BlLiRldmFsKGUpfX1iLiRhcHBseShmdW5jdGlvbigpe2EoYyxsKGQpKX0pfX1Nb3VzZXRyYXAucHJvdG90eXBlLnN0b3BDYWxsYmFjaz1mdW5jdGlvbihhLGIpe3JldHVybihcIiBcIitiLmNsYXNzTmFtZStcIiBcIikuaW5kZXhPZihcIiBtb3VzZXRyYXAgXCIpPi0xPyExOmIuY29udGVudEVkaXRhYmxlJiZcInRydWVcIj09Yi5jb250ZW50RWRpdGFibGV9LGcucHJvdG90eXBlLmZvcm1hdD1mdW5jdGlvbigpe2lmKG51bGw9PT10aGlzLl9mb3JtYXRlZCl7Zm9yKHZhciBhPXRoaXMuY29tYm9bMF0sYj1hLnNwbGl0KC9bXFxzXS8pLGM9MDtjPGIubGVuZ3RoO2MrKyliW2NdPWYoYltjXSk7dGhpcy5fZm9ybWF0ZWQ9Yn1yZXR1cm4gdGhpcy5fZm9ybWF0ZWR9O3ZhciBvPWIuJG5ldygpO28uaG90a2V5cz1bXSxvLmhlbHBWaXNpYmxlPSExLG8udGl0bGU9dGhpcy50ZW1wbGF0ZVRpdGxlLG8uaGVhZGVyPXRoaXMudGVtcGxhdGVIZWFkZXIsby5mb290ZXI9dGhpcy50ZW1wbGF0ZUZvb3RlcixvLnRvZ2dsZUNoZWF0U2hlZXQ9aTt2YXIgcD1bXTtpZih0aGlzLnVzZU5nUm91dGUmJmIuJG9uKFwiJHJvdXRlQ2hhbmdlU3VjY2Vzc1wiLGZ1bmN0aW9uKGEsYil7aCgpLGImJmIuaG90a2V5cyYmYW5ndWxhci5mb3JFYWNoKGIuaG90a2V5cyxmdW5jdGlvbihhKXt2YXIgYz1hWzJdOyhcInN0cmluZ1wiPT10eXBlb2YgY3x8YyBpbnN0YW5jZW9mIFN0cmluZykmJihhWzJdPVtjLGJdKSxhWzVdPSExLGouYXBwbHkodGhpcyxhKX0pfSksdGhpcy5pbmNsdWRlQ2hlYXRTaGVldCl7dmFyIHE9ZVswXSxyPWFbMF0scz1hbmd1bGFyLmVsZW1lbnQodGhpcy50ZW1wbGF0ZSk7aih0aGlzLmNoZWF0U2hlZXRIb3RrZXksdGhpcy5jaGVhdFNoZWV0RGVzY3JpcHRpb24saSksKHI9PT1xfHxyPT09cS5kb2N1bWVudEVsZW1lbnQpJiYocj1xLmJvZHkpLGFuZ3VsYXIuZWxlbWVudChyKS5hcHBlbmQoYyhzKShvKSl9dmFyIHQ9ITEsdT17YWRkOmosZGVsOmssZ2V0OmwsYmluZFRvOm0sdGVtcGxhdGU6dGhpcy50ZW1wbGF0ZSx0b2dnbGVDaGVhdFNoZWV0OmksaW5jbHVkZUNoZWF0U2hlZXQ6dGhpcy5pbmNsdWRlQ2hlYXRTaGVldCxjaGVhdFNoZWV0SG90a2V5OnRoaXMuY2hlYXRTaGVldEhvdGtleSxjaGVhdFNoZWV0RGVzY3JpcHRpb246dGhpcy5jaGVhdFNoZWV0RGVzY3JpcHRpb24sdXNlTmdSb3V0ZTp0aGlzLnVzZU5nUm91dGUscHVyZ2VIb3RrZXlzOmgsdGVtcGxhdGVUaXRsZTp0aGlzLnRlbXBsYXRlVGl0bGV9O3JldHVybiB1fV19XSkuZGlyZWN0aXZlKFwiaG90a2V5XCIsW1wiaG90a2V5c1wiLGZ1bmN0aW9uKGEpe3JldHVybntyZXN0cmljdDpcIkFcIixsaW5rOmZ1bmN0aW9uKGIsYyxkKXt2YXIgZSxmO2FuZ3VsYXIuZm9yRWFjaChiLiRldmFsKGQuaG90a2V5KSxmdW5jdGlvbihiLGMpe2Y9XCJzdHJpbmdcIj09dHlwZW9mIGQuaG90a2V5QWxsb3dJbj9kLmhvdGtleUFsbG93SW4uc3BsaXQoL1tcXHMsXSsvKTpbXSxlPWMsYS5hZGQoe2NvbWJvOmMsZGVzY3JpcHRpb246ZC5ob3RrZXlEZXNjcmlwdGlvbixjYWxsYmFjazpiLGFjdGlvbjpkLmhvdGtleUFjdGlvbixhbGxvd0luOmZ9KX0pLGMuYmluZChcIiRkZXN0cm95XCIsZnVuY3Rpb24oKXthLmRlbChlKX0pfX19XSkucnVuKFtcImhvdGtleXNcIixmdW5jdGlvbihhKXt9XSl9KCksZnVuY3Rpb24oYSxiLGMpe2Z1bmN0aW9uIGQoYSxiLGMpe3JldHVybiBhLmFkZEV2ZW50TGlzdGVuZXI/dm9pZCBhLmFkZEV2ZW50TGlzdGVuZXIoYixjLCExKTp2b2lkIGEuYXR0YWNoRXZlbnQoXCJvblwiK2IsYyl9ZnVuY3Rpb24gZShhKXtpZihcImtleXByZXNzXCI9PWEudHlwZSl7dmFyIGI9U3RyaW5nLmZyb21DaGFyQ29kZShhLndoaWNoKTtyZXR1cm4gYS5zaGlmdEtleXx8KGI9Yi50b0xvd2VyQ2FzZSgpKSxifXJldHVybiByW2Eud2hpY2hdP3JbYS53aGljaF06c1thLndoaWNoXT9zW2Eud2hpY2hdOlN0cmluZy5mcm9tQ2hhckNvZGUoYS53aGljaCkudG9Mb3dlckNhc2UoKX1mdW5jdGlvbiBmKGEsYil7cmV0dXJuIGEuc29ydCgpLmpvaW4oXCIsXCIpPT09Yi5zb3J0KCkuam9pbihcIixcIil9ZnVuY3Rpb24gZyhhKXt2YXIgYj1bXTtyZXR1cm4gYS5zaGlmdEtleSYmYi5wdXNoKFwic2hpZnRcIiksYS5hbHRLZXkmJmIucHVzaChcImFsdFwiKSxhLmN0cmxLZXkmJmIucHVzaChcImN0cmxcIiksYS5tZXRhS2V5JiZiLnB1c2goXCJtZXRhXCIpLGJ9ZnVuY3Rpb24gaChhKXtyZXR1cm4gYS5wcmV2ZW50RGVmYXVsdD92b2lkIGEucHJldmVudERlZmF1bHQoKTp2b2lkKGEucmV0dXJuVmFsdWU9ITEpfWZ1bmN0aW9uIGkoYSl7cmV0dXJuIGEuc3RvcFByb3BhZ2F0aW9uP3ZvaWQgYS5zdG9wUHJvcGFnYXRpb24oKTp2b2lkKGEuY2FuY2VsQnViYmxlPSEwKX1mdW5jdGlvbiBqKGEpe3JldHVyblwic2hpZnRcIj09YXx8XCJjdHJsXCI9PWF8fFwiYWx0XCI9PWF8fFwibWV0YVwiPT1hfWZ1bmN0aW9uIGsoKXtpZighcSl7cT17fTtmb3IodmFyIGEgaW4gcilhPjk1JiYxMTI+YXx8ci5oYXNPd25Qcm9wZXJ0eShhKSYmKHFbclthXV09YSl9cmV0dXJuIHF9ZnVuY3Rpb24gbChhLGIsYyl7cmV0dXJuIGN8fChjPWsoKVthXT9cImtleWRvd25cIjpcImtleXByZXNzXCIpLFwia2V5cHJlc3NcIj09YyYmYi5sZW5ndGgmJihjPVwia2V5ZG93blwiKSxjfWZ1bmN0aW9uIG0oYSl7cmV0dXJuXCIrXCI9PT1hP1tcIitcIl06KGE9YS5yZXBsYWNlKC9cXCt7Mn0vZyxcIitwbHVzXCIpLGEuc3BsaXQoXCIrXCIpKX1mdW5jdGlvbiBuKGEsYil7dmFyIGMsZCxlLGY9W107Zm9yKGM9bShhKSxlPTA7ZTxjLmxlbmd0aDsrK2UpZD1jW2VdLHVbZF0mJihkPXVbZF0pLGImJlwia2V5cHJlc3NcIiE9YiYmdFtkXSYmKGQ9dFtkXSxmLnB1c2goXCJzaGlmdFwiKSksaihkKSYmZi5wdXNoKGQpO3JldHVybiBiPWwoZCxmLGIpLHtrZXk6ZCxtb2RpZmllcnM6ZixhY3Rpb246Yn19ZnVuY3Rpb24gbyhhLGMpe3JldHVybiBhPT09Yj8hMTphPT09Yz8hMDpvKGEucGFyZW50Tm9kZSxjKX1mdW5jdGlvbiBwKGEpe2Z1bmN0aW9uIGMoYSl7YT1hfHx7fTt2YXIgYixjPSExO2ZvcihiIGluIHUpYVtiXT9jPSEwOnVbYl09MDtjfHwoeD0hMSl9ZnVuY3Rpb24gayhhLGIsYyxkLGUsZyl7dmFyIGgsaSxrPVtdLGw9Yy50eXBlO2lmKCFzLl9jYWxsYmFja3NbYV0pcmV0dXJuW107Zm9yKFwia2V5dXBcIj09bCYmaihhKSYmKGI9W2FdKSxoPTA7aDxzLl9jYWxsYmFja3NbYV0ubGVuZ3RoOysraClpZihpPXMuX2NhbGxiYWNrc1thXVtoXSwoZHx8IWkuc2VxfHx1W2kuc2VxXT09aS5sZXZlbCkmJmw9PWkuYWN0aW9uJiYoXCJrZXlwcmVzc1wiPT1sJiYhYy5tZXRhS2V5JiYhYy5jdHJsS2V5fHxmKGIsaS5tb2RpZmllcnMpKSl7dmFyIG09IWQmJmkuY29tYm89PWUsbj1kJiZpLnNlcT09ZCYmaS5sZXZlbD09ZzsobXx8bikmJnMuX2NhbGxiYWNrc1thXS5zcGxpY2UoaCwxKSxrLnB1c2goaSl9cmV0dXJuIGt9ZnVuY3Rpb24gbChhLGIsYyxkKXtzLnN0b3BDYWxsYmFjayhiLGIudGFyZ2V0fHxiLnNyY0VsZW1lbnQsYyxkKXx8YShiLGMpPT09ITEmJihoKGIpLGkoYikpfWZ1bmN0aW9uIG0oYSl7XCJudW1iZXJcIiE9dHlwZW9mIGEud2hpY2gmJihhLndoaWNoPWEua2V5Q29kZSk7dmFyIGI9ZShhKTtpZihiKXJldHVyblwia2V5dXBcIj09YS50eXBlJiZ2PT09Yj92b2lkKHY9ITEpOnZvaWQgcy5oYW5kbGVLZXkoYixnKGEpLGEpfWZ1bmN0aW9uIG8oKXtjbGVhclRpbWVvdXQodCksdD1zZXRUaW1lb3V0KGMsMWUzKX1mdW5jdGlvbiBxKGEsYixkLGYpe2Z1bmN0aW9uIGcoYil7cmV0dXJuIGZ1bmN0aW9uKCl7eD1iLCsrdVthXSxvKCl9fWZ1bmN0aW9uIGgoYil7bChkLGIsYSksXCJrZXl1cFwiIT09ZiYmKHY9ZShiKSksc2V0VGltZW91dChjLDEwKX11W2FdPTA7Zm9yKHZhciBpPTA7aTxiLmxlbmd0aDsrK2kpe3ZhciBqPWkrMT09PWIubGVuZ3RoLGs9aj9oOmcoZnx8bihiW2krMV0pLmFjdGlvbik7cihiW2ldLGssZixhLGkpfX1mdW5jdGlvbiByKGEsYixjLGQsZSl7cy5fZGlyZWN0TWFwW2ErXCI6XCIrY109YixhPWEucmVwbGFjZSgvXFxzKy9nLFwiIFwiKTt2YXIgZixnPWEuc3BsaXQoXCIgXCIpO3JldHVybiBnLmxlbmd0aD4xP3ZvaWQgcShhLGcsYixjKTooZj1uKGEsYykscy5fY2FsbGJhY2tzW2Yua2V5XT1zLl9jYWxsYmFja3NbZi5rZXldfHxbXSxrKGYua2V5LGYubW9kaWZpZXJzLHt0eXBlOmYuYWN0aW9ufSxkLGEsZSksdm9pZCBzLl9jYWxsYmFja3NbZi5rZXldW2Q/XCJ1bnNoaWZ0XCI6XCJwdXNoXCJdKHtjYWxsYmFjazpiLG1vZGlmaWVyczpmLm1vZGlmaWVycyxhY3Rpb246Zi5hY3Rpb24sc2VxOmQsbGV2ZWw6ZSxjb21ibzphfSkpfXZhciBzPXRoaXM7aWYoYT1hfHxiLCEocyBpbnN0YW5jZW9mIHApKXJldHVybiBuZXcgcChhKTtzLnRhcmdldD1hLHMuX2NhbGxiYWNrcz17fSxzLl9kaXJlY3RNYXA9e307dmFyIHQsdT17fSx2PSExLHc9ITEseD0hMTtzLl9oYW5kbGVLZXk9ZnVuY3Rpb24oYSxiLGQpe3ZhciBlLGY9ayhhLGIsZCksZz17fSxoPTAsaT0hMTtmb3IoZT0wO2U8Zi5sZW5ndGg7KytlKWZbZV0uc2VxJiYoaD1NYXRoLm1heChoLGZbZV0ubGV2ZWwpKTtmb3IoZT0wO2U8Zi5sZW5ndGg7KytlKWlmKGZbZV0uc2VxKXtpZihmW2VdLmxldmVsIT1oKWNvbnRpbnVlO2k9ITAsZ1tmW2VdLnNlcV09MSxsKGZbZV0uY2FsbGJhY2ssZCxmW2VdLmNvbWJvLGZbZV0uc2VxKX1lbHNlIGl8fGwoZltlXS5jYWxsYmFjayxkLGZbZV0uY29tYm8pO3ZhciBtPVwia2V5cHJlc3NcIj09ZC50eXBlJiZ3O2QudHlwZSE9eHx8aihhKXx8bXx8YyhnKSx3PWkmJlwia2V5ZG93blwiPT1kLnR5cGV9LHMuX2JpbmRNdWx0aXBsZT1mdW5jdGlvbihhLGIsYyl7Zm9yKHZhciBkPTA7ZDxhLmxlbmd0aDsrK2QpcihhW2RdLGIsYyl9LGQoYSxcImtleXByZXNzXCIsbSksZChhLFwia2V5ZG93blwiLG0pLGQoYSxcImtleXVwXCIsbSl9Zm9yKHZhciBxLHI9ezg6XCJiYWNrc3BhY2VcIiw5OlwidGFiXCIsMTM6XCJlbnRlclwiLDE2Olwic2hpZnRcIiwxNzpcImN0cmxcIiwxODpcImFsdFwiLDIwOlwiY2Fwc2xvY2tcIiwyNzpcImVzY1wiLDMyOlwic3BhY2VcIiwzMzpcInBhZ2V1cFwiLDM0OlwicGFnZWRvd25cIiwzNTpcImVuZFwiLDM2OlwiaG9tZVwiLDM3OlwibGVmdFwiLDM4OlwidXBcIiwzOTpcInJpZ2h0XCIsNDA6XCJkb3duXCIsNDU6XCJpbnNcIiw0NjpcImRlbFwiLDkxOlwibWV0YVwiLDkzOlwibWV0YVwiLDIyNDpcIm1ldGFcIn0scz17MTA2OlwiKlwiLDEwNzpcIitcIiwxMDk6XCItXCIsMTEwOlwiLlwiLDExMTpcIi9cIiwxODY6XCI7XCIsMTg3OlwiPVwiLDE4ODpcIixcIiwxODk6XCItXCIsMTkwOlwiLlwiLDE5MTpcIi9cIiwxOTI6XCJgXCIsMjE5OlwiW1wiLDIyMDpcIlxcXFxcIiwyMjE6XCJdXCIsMjIyOlwiJ1wifSx0PXtcIn5cIjpcImBcIixcIiFcIjpcIjFcIixcIkBcIjpcIjJcIixcIiNcIjpcIjNcIiwkOlwiNFwiLFwiJVwiOlwiNVwiLFwiXlwiOlwiNlwiLFwiJlwiOlwiN1wiLFwiKlwiOlwiOFwiLFwiKFwiOlwiOVwiLFwiKVwiOlwiMFwiLF86XCItXCIsXCIrXCI6XCI9XCIsXCI6XCI6XCI7XCIsJ1wiJzpcIidcIixcIjxcIjpcIixcIixcIj5cIjpcIi5cIixcIj9cIjpcIi9cIixcInxcIjpcIlxcXFxcIn0sdT17b3B0aW9uOlwiYWx0XCIsY29tbWFuZDpcIm1ldGFcIixcInJldHVyblwiOlwiZW50ZXJcIixlc2NhcGU6XCJlc2NcIixwbHVzOlwiK1wiLG1vZDovTWFjfGlQb2R8aVBob25lfGlQYWQvLnRlc3QobmF2aWdhdG9yLnBsYXRmb3JtKT9cIm1ldGFcIjpcImN0cmxcIn0sdj0xOzIwPnY7Kyt2KXJbMTExK3ZdPVwiZlwiK3Y7Zm9yKHY9MDs5Pj12OysrdilyW3YrOTZdPXY7cC5wcm90b3R5cGUuYmluZD1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcztyZXR1cm4gYT1hIGluc3RhbmNlb2YgQXJyYXk/YTpbYV0sZC5fYmluZE11bHRpcGxlLmNhbGwoZCxhLGIsYyksZH0scC5wcm90b3R5cGUudW5iaW5kPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcztyZXR1cm4gYy5iaW5kLmNhbGwoYyxhLGZ1bmN0aW9uKCl7fSxiKX0scC5wcm90b3R5cGUudHJpZ2dlcj1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXM7cmV0dXJuIGMuX2RpcmVjdE1hcFthK1wiOlwiK2JdJiZjLl9kaXJlY3RNYXBbYStcIjpcIitiXSh7fSxhKSxjfSxwLnByb3RvdHlwZS5yZXNldD1mdW5jdGlvbigpe3ZhciBhPXRoaXM7cmV0dXJuIGEuX2NhbGxiYWNrcz17fSxhLl9kaXJlY3RNYXA9e30sYX0scC5wcm90b3R5cGUuc3RvcENhbGxiYWNrPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcztyZXR1cm4oXCIgXCIrYi5jbGFzc05hbWUrXCIgXCIpLmluZGV4T2YoXCIgbW91c2V0cmFwIFwiKT4tMT8hMTpvKGIsYy50YXJnZXQpPyExOlwiSU5QVVRcIj09Yi50YWdOYW1lfHxcIlNFTEVDVFwiPT1iLnRhZ05hbWV8fFwiVEVYVEFSRUFcIj09Yi50YWdOYW1lfHxiLmlzQ29udGVudEVkaXRhYmxlfSxwLnByb3RvdHlwZS5oYW5kbGVLZXk9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO3JldHVybiBhLl9oYW5kbGVLZXkuYXBwbHkoYSxhcmd1bWVudHMpfSxwLmluaXQ9ZnVuY3Rpb24oKXt2YXIgYT1wKGIpO2Zvcih2YXIgYyBpbiBhKVwiX1wiIT09Yy5jaGFyQXQoMCkmJihwW2NdPWZ1bmN0aW9uKGIpe3JldHVybiBmdW5jdGlvbigpe3JldHVybiBhW2JdLmFwcGx5KGEsYXJndW1lbnRzKX19KGMpKX0scC5pbml0KCksYS5Nb3VzZXRyYXA9cCxcInVuZGVmaW5lZFwiIT10eXBlb2YgbW9kdWxlJiZtb2R1bGUuZXhwb3J0cyYmKG1vZHVsZS5leHBvcnRzPXApLFwiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZCYmZGVmaW5lKGZ1bmN0aW9uKCl7cmV0dXJuIHB9KX0od2luZG93LGRvY3VtZW50KTsiLCJpZiAoIVN0cmluZy5wcm90b3R5cGUuaW5jbHVkZXMpIHtcbiAgICBTdHJpbmcucHJvdG90eXBlLmluY2x1ZGVzID0gZnVuY3Rpb24oc2VhcmNoLCBzdGFydCkge1xuICAgICAgICAndXNlIHN0cmljdCc7XG4gICAgICAgIGlmICh0eXBlb2Ygc3RhcnQgIT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBzdGFydCA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc3RhcnQgKyBzZWFyY2gubGVuZ3RoID4gdGhpcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluZGV4T2Yoc2VhcmNoLCBzdGFydCkgIT09IC0xO1xuICAgICAgICB9XG4gICAgfTtcbn0iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbmZpZyhmdW5jdGlvbiAoJHByb3ZpZGUpIHtcbiAgICAgICAgJHByb3ZpZGUuZGVjb3JhdG9yKCckaHR0cEJhY2tlbmQnLCBhbmd1bGFyLm1vY2suZTJlLiRodHRwQmFja2VuZERlY29yYXRvcik7XG4gICAgfSkucnVuKGZ1bmN0aW9uICgkaHR0cEJhY2tlbmQsIHNjYWxlQ29uZmlnLCBYTUxIdHRwUmVxdWVzdCkge1xuXG4gICAgICAgIHZhciBnZXRTeW5jID0gZnVuY3Rpb24gKHVybCkge1xuICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIHJlcXVlc3Qub3BlbignR0VUJywgdXJsLCBmYWxzZSk7XG4gICAgICAgICAgICByZXF1ZXN0LnNlbmQobnVsbCk7XG4gICAgICAgICAgICByZXR1cm4gW3JlcXVlc3Quc3RhdHVzLCByZXF1ZXN0LnJlc3BvbnNlLCB7fV07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFVybFBhcmFtcyA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgICAgIHZhciBvYmogPSB7fTtcblxuICAgICAgICAgICAgaWYgKHVybCAmJiB1cmwuc3BsaXQoJz8nKS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgdXJsLnNwbGl0KCc/JylbMV0uc3BsaXQoJyYnKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzID0gaXRlbS5zcGxpdCgnPScpLFxuICAgICAgICAgICAgICAgICAgICAgICAgayA9IHNbMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICB2ID0gc1sxXSAmJiBkZWNvZGVVUklDb21wb25lbnQoc1sxXSk7XG4gICAgICAgICAgICAgICAgICAgIChrIGluIG9iaikgPyBvYmpba10ucHVzaCh2KSA6IG9ialtrXSA9IFt2XVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIEluZ2VzdHMgU3RhdHVzXG4gICAgICAgIHZhciBpbmdlc3RzU3RhdHVzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2luZ2VzdHMvc3RhdHVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKGluZ2VzdHNTdGF0dXNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgc3RyaWtlcyA9IEpTT04ucGFyc2UoZ2V0U3luYygndGVzdC9kYXRhL2luZ2VzdFN0cmlrZXMuanNvbicpWzFdKSxcbiAgICAgICAgICAgICAgICBzdGFydERhdGUgPSBtb21lbnQudXRjKCkuc3VidHJhY3QoMSwgJ3cnKS5zdGFydE9mKCdkJykudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBlbmREYXRlID0gbW9tZW50LnV0YygpLmFkZCgxLCAnZCcpLnN0YXJ0T2YoJ2QnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG51bUhvdXJzID0gbW9tZW50LnV0YyhlbmREYXRlKS5kaWZmKG1vbWVudC51dGMoc3RhcnREYXRlKSwgJ2gnKSxcbiAgICAgICAgICAgICAgICB0aGlzVGltZSA9ICcnLFxuICAgICAgICAgICAgICAgIHZhbHVlcyA9IFtdLFxuICAgICAgICAgICAgICAgIHJlc3VsdHMgPSBbXTtcblxuICAgICAgICAgICAgXy5mb3JFYWNoKHN0cmlrZXMucmVzdWx0cywgZnVuY3Rpb24gKHN0cmlrZSkge1xuICAgICAgICAgICAgICAgIHZhbHVlcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1Ib3VyczsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXNUaW1lID0gbW9tZW50LnV0YyhzdGFydERhdGUpLmFkZChpLCAnaCcpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IHRoaXNUaW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXM6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg1MDAgLSA1ICsgMSkpICsgNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg1MDAwMDAwMDAgLSA1MDAwMDAwICsgMSkpICsgNTAwMDAwMFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzdHJpa2U6IHN0cmlrZSxcbiAgICAgICAgICAgICAgICAgICAgbW9zdF9yZWNlbnQ6IG1vbWVudC51dGMoKS5zdGFydE9mKCdoJykudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgZmlsZXM6IDIsXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IDEyMzQ1Njc4OSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiB2YWx1ZXNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBjb3VudDogMixcbiAgICAgICAgICAgICAgICBuZXh0OiBudWxsLFxuICAgICAgICAgICAgICAgIHByZXZpb3VzOiBudWxsLFxuICAgICAgICAgICAgICAgIHJlc3VsdHM6IHJlc3VsdHNcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJldHVybiBbMjAwLCBkYXRhLCB7fV07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEluZ2VzdHNcbiAgICAgICAgdmFyIGluZ2VzdHNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvaW5nZXN0cy5qc29uJztcbiAgICAgICAgdmFyIGluZ2VzdHNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnaW5nZXN0cy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChpbmdlc3RzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICB2YXIgdXJsUGFyYW1zID0gZ2V0VXJsUGFyYW1zKHVybCksXG4gICAgICAgICAgICAgICAgcmV0dXJuT2JqID0gZ2V0U3luYyhpbmdlc3RzT3ZlcnJpZGVVcmwpLFxuICAgICAgICAgICAgICAgIGluZ2VzdHMgPSBKU09OLnBhcnNlKHJldHVybk9ialsxXSk7XG5cbiAgICAgICAgICAgIGlmICh1cmxQYXJhbXMub3JkZXIgJiYgdXJsUGFyYW1zLm9yZGVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgb3JkZXJzID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkcyA9IFtdO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh1cmxQYXJhbXMub3JkZXIsIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcmRlciA9IG8uY2hhckF0KDApID09PSAnLScgPyAnZGVzYycgOiAnYXNjJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkID0gb3JkZXIgPT09ICdkZXNjJyA/IHVybFBhcmFtcy5vcmRlclswXS5zdWJzdHJpbmcoMSkgOiB1cmxQYXJhbXMub3JkZXJbMF07XG5cbiAgICAgICAgICAgICAgICAgICAgb3JkZXJzLnB1c2gob3JkZXIpO1xuICAgICAgICAgICAgICAgICAgICBmaWVsZHMucHVzaChmaWVsZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpbmdlc3RzLnJlc3VsdHMgPSBfLnNvcnRCeU9yZGVyKGluZ2VzdHMucmVzdWx0cywgZmllbGRzLCBvcmRlcnMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodXJsUGFyYW1zLnBhZ2UgJiYgdXJsUGFyYW1zLnBhZ2UubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHZhciBwYWdlID0gcGFyc2VJbnQodXJsUGFyYW1zLnBhZ2VbMF0pLFxuICAgICAgICAgICAgICAgICAgICBwYWdlU2l6ZSA9IHBhcnNlSW50KHVybFBhcmFtcy5wYWdlX3NpemVbMF0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKHBhZ2UgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5nZXN0cy5yZXN1bHRzID0gXy50YWtlKGluZ2VzdHMucmVzdWx0cywgcGFnZVNpemUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdGFydElkeCA9IChwYWdlIC0gMSkgKiBwYWdlU2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkeEFycmF5ID0gW107XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0SWR4OyBpIDwgaW5nZXN0cy5yZXN1bHRzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWR4QXJyYXkucHVzaChpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGluZ2VzdHMucmVzdWx0cyA9IF8uYXQoaW5nZXN0cy5yZXN1bHRzLCBpZHhBcnJheSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodXJsUGFyYW1zLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIGluZ2VzdHMucmVzdWx0cyA9IF8uZmlsdGVyKGluZ2VzdHMucmVzdWx0cywgZnVuY3Rpb24gKGluZ2VzdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5nZXN0LnN0YXR1cyA9PT0gdXJsUGFyYW1zLnN0YXR1c1swXTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuT2JqWzFdID0gSlNPTi5zdHJpbmdpZnkoaW5nZXN0cyk7XG5cbiAgICAgICAgICAgIHJldHVybiByZXR1cm5PYmo7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNvdXJjZSBkZXRhaWxzXG4gICAgICAgIHZhciBzb3VyY2VEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3NvdXJjZURldGFpbHMuanNvbic7XG4gICAgICAgIHZhciBzb3VyY2VEZXRhaWxzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3NvdXJjZXMvLiovJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQoc291cmNlRGV0YWlsc1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCkge1xuICAgICAgICAgICAgLy8gLy8gZ2V0IHRoZSBqb2JUeXBlLmlkIGZyb20gdGhlIHVybFxuICAgICAgICAgICAgLy8gdXJsID0gdXJsLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAvLyB2YXIgZmlsZW5hbWUgPSB1cmwuc3Vic3RyaW5nKHVybC5zdWJzdHJpbmcoMCx1cmwubGFzdEluZGV4T2YoJy8nKSkubGFzdEluZGV4T2YoJy8nKSsxLHVybC5sZW5ndGgtMSk7XG4gICAgICAgICAgICAvLyBzb3VyY2VEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3NvdXJjZS1kZXRhaWxzLycgKyBmaWxlbmFtZSArICcuanNvbic7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhzb3VyY2VEZXRhaWxzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNvdXJjZXNcbiAgICAgICAgdmFyIHNvdXJjZXNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvc291cmNlcy5qc29uJztcbiAgICAgICAgdmFyIHNvdXJjZXNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnc291cmNlcy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChzb3VyY2VzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICAvL3JldHVybiBnZXRTeW5jKHNvdXJjZXNPdmVycmlkZVVybCk7XG4gICAgICAgICAgICB2YXIgdXJsUGFyYW1zID0gZ2V0VXJsUGFyYW1zKHVybCksXG4gICAgICAgICAgICAgICAgcmV0dXJuT2JqID0gZ2V0U3luYyhzb3VyY2VzT3ZlcnJpZGVVcmwpLFxuICAgICAgICAgICAgICAgIHNvdXJjZXMgPSBKU09OLnBhcnNlKHJldHVybk9ialsxXSk7XG5cbiAgICAgICAgICAgIGlmICh1cmxQYXJhbXMuZmlsZV9uYW1lICYmIHVybFBhcmFtcy5maWxlX25hbWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHZhciBvcmRlcnMgPSBbJ2ZpbGVfbmFtZSddLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZHMgPSBbJ2FzYyddO1xuXG4gICAgICAgICAgICAgICAgc291cmNlcy5yZXN1bHRzID0gXy5maWx0ZXIoc291cmNlcy5yZXN1bHRzLCBmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gci5maWxlX25hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh1cmxQYXJhbXMuZmlsZV9uYW1lWzBdLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc291cmNlcy5yZXN1bHRzID0gXy5zb3J0QnlPcmRlcihzb3VyY2VzLnJlc3VsdHMsIGZpZWxkcywgb3JkZXJzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuT2JqWzFdID0gSlNPTi5zdHJpbmdpZnkoc291cmNlcyk7XG5cbiAgICAgICAgICAgIHJldHVybiByZXR1cm5PYmo7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEpvYiBsb2FkXG4gICAgICAgIHZhciBqb2JMb2FkUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2xvYWQvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQoam9iTG9hZFJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBudW1Ib3VycyA9IG1vbWVudC51dGMoKS5lbmRPZignZCcpLmRpZmYobW9tZW50LnV0YygpLnN1YnRyYWN0KDcsICdkJykuc3RhcnRPZignZCcpLCAnaCcpO1xuICAgICAgICAgICAgdmFyIHN0YXJ0VGltZSA9IG1vbWVudC51dGMoKS5zdWJ0cmFjdCg3LCAnZCcpLnN0YXJ0T2YoJ2QnKTtcbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIGNvdW50OiBudW1Ib3VycyxcbiAgICAgICAgICAgICAgICBuZXh0OiBudWxsLFxuICAgICAgICAgICAgICAgIHByZXZpb3VzOiBudWxsLFxuICAgICAgICAgICAgICAgIHJlc3VsdHM6IFtdXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEuY291bnQ7IGkrKykge1xuICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdGltZTogbW9tZW50LnV0YyhzdGFydFRpbWUpLmFkZChpLCAnaCcpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIHBlbmRpbmdfY291bnQ6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMDAgLSAyMCArIDEpKSArIDIwLFxuICAgICAgICAgICAgICAgICAgICBxdWV1ZWRfY291bnQ6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMDAgLSAyMCArIDEpKSArIDIwLFxuICAgICAgICAgICAgICAgICAgICBydW5uaW5nX2NvdW50OiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwIC0gMjAgKyAxKSkgKyAyMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gWzIwMCwgZGF0YSwge31dO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBKb2IgZGV0YWlsc1xuICAgICAgICB2YXIgam9iRGV0YWlsc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9qb2JEZXRhaWxzLmpzb24nO1xuICAgICAgICB2YXIgam9iRGV0YWlsc1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdqb2JzLy4qLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKGpvYkRldGFpbHNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwpIHtcbiAgICAgICAgICAgIC8vIGdldCB0aGUgam9iVHlwZS5pZCBmcm9tIHRoZSB1cmxcbiAgICAgICAgICAgIHVybCA9IHVybC50b1N0cmluZygpO1xuICAgICAgICAgICAgdmFyIGlkID0gdXJsLnN1YnN0cmluZyh1cmwuc3Vic3RyaW5nKDAsdXJsLmxhc3RJbmRleE9mKCcvJykpLmxhc3RJbmRleE9mKCcvJykrMSx1cmwubGVuZ3RoLTEpO1xuICAgICAgICAgICAgam9iRGV0YWlsc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9qb2ItZGV0YWlscy9qb2JEZXRhaWxzJyArIGlkICsgJy5qc29uJztcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKGpvYkRldGFpbHNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEpvYnNcbiAgICAgICAgdmFyIGpvYnNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvam9icy5qc29uJztcbiAgICAgICAgdmFyIGpvYnNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9icy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChqb2JzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICB2YXIgdXJsUGFyYW1zID0gZ2V0VXJsUGFyYW1zKHVybCksXG4gICAgICAgICAgICAgICAgcmV0dXJuT2JqID0gZ2V0U3luYyhqb2JzT3ZlcnJpZGVVcmwpLFxuICAgICAgICAgICAgICAgIGpvYnMgPSBKU09OLnBhcnNlKHJldHVybk9ialsxXSk7XG5cbiAgICAgICAgICAgIGlmICh1cmxQYXJhbXMub3JkZXIgJiYgdXJsUGFyYW1zLm9yZGVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgb3JkZXJzID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkcyA9IFtdO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh1cmxQYXJhbXMub3JkZXIsIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcmRlciA9IG8uY2hhckF0KDApID09PSAnLScgPyAnZGVzYycgOiAnYXNjJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkID0gb3JkZXIgPT09ICdkZXNjJyA/IHVybFBhcmFtcy5vcmRlclswXS5zdWJzdHJpbmcoMSkgOiB1cmxQYXJhbXMub3JkZXJbMF07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkID09PSAnam9iX3R5cGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZCA9ICdqb2JfdHlwZS5uYW1lJztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIG9yZGVycy5wdXNoKG9yZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzLnB1c2goZmllbGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgam9icy5yZXN1bHRzID0gXy5zb3J0QnlPcmRlcihqb2JzLnJlc3VsdHMsIGZpZWxkcywgb3JkZXJzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHVybFBhcmFtcy5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBqb2JzLnJlc3VsdHMgPSBfLmZpbHRlcihqb2JzLnJlc3VsdHMsIGZ1bmN0aW9uIChqb2IpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpvYi5zdGF0dXMgPT09IHVybFBhcmFtcy5zdGF0dXNbMF07XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybk9ialsxXSA9IEpTT04uc3RyaW5naWZ5KGpvYnMpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuT2JqO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBKb2IgdHlwZSBzdGF0dXNcbiAgICAgICAgdmFyIGpvYlR5cGVTdGF0dXNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvam9iVHlwZVN0YXR1cy5qc29uJztcbiAgICAgICAgdmFyIGpvYlR5cGVTdGF0dXNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9iLXR5cGVzL3N0YXR1cy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChqb2JUeXBlU3RhdHVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMoam9iVHlwZVN0YXR1c092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUnVubmluZyBqb2IgdHlwZXNcbiAgICAgICAgdmFyIHJ1bm5pbmdKb2JzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3J1bm5pbmdKb2JzLmpzb24nO1xuICAgICAgICB2YXIgcnVubmluZ0pvYnNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9iLXR5cGVzL3J1bm5pbmcvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQocnVubmluZ0pvYnNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhydW5uaW5nSm9ic092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSm9iIFR5cGUgRGV0YWlsc1xuICAgICAgICB2YXIgam9iVHlwZURldGFpbHNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvam9iLXR5cGVzL2pvYlR5cGUxLmpzb24nO1xuICAgICAgICB2YXIgam9iVHlwZURldGFpbHNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9iLXR5cGVzLy4qLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKGpvYlR5cGVEZXRhaWxzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICAvLyBnZXQgdGhlIGpvYlR5cGUuaWQgZnJvbSB0aGUgdXJsXG4gICAgICAgICAgICB1cmwgPSB1cmwudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIHZhciBpZCA9IHVybC5zdWJzdHJpbmcodXJsLnN1YnN0cmluZygwLHVybC5sYXN0SW5kZXhPZignLycpKS5sYXN0SW5kZXhPZignLycpKzEsdXJsLmxlbmd0aC0xKTtcbiAgICAgICAgICAgIGpvYlR5cGVEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL2pvYi10eXBlcy9qb2JUeXBlJyArIGlkICsgJy5qc29uJztcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKGpvYlR5cGVEZXRhaWxzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBKb2IgdHlwZXNcbiAgICAgICAgdmFyIGpvYlR5cGVzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL2pvYlR5cGVzLmpzb24nO1xuICAgICAgICB2YXIgam9iVHlwZXNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9iLXR5cGVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKGpvYlR5cGVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICB2YXIgdXJsUGFyYW1zID0gZ2V0VXJsUGFyYW1zKHVybCksXG4gICAgICAgICAgICAgICAgcmV0dXJuT2JqID0gZ2V0U3luYyhqb2JUeXBlc092ZXJyaWRlVXJsKSxcbiAgICAgICAgICAgICAgICBqb2JUeXBlcyA9IEpTT04ucGFyc2UocmV0dXJuT2JqWzFdKTtcblxuICAgICAgICAgICAgaWYgKHVybFBhcmFtcy5vcmRlciAmJiB1cmxQYXJhbXMub3JkZXIubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHZhciBvcmRlcnMgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHVybFBhcmFtcy5vcmRlciwgZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9yZGVyID0gby5jaGFyQXQoMCkgPT09ICctJyA/ICdkZXNjJyA6ICdhc2MnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQgPSBvcmRlciA9PT0gJ2Rlc2MnID8gdXJsUGFyYW1zLm9yZGVyWzBdLnN1YnN0cmluZygxKSA6IHVybFBhcmFtcy5vcmRlclswXTtcblxuICAgICAgICAgICAgICAgICAgICBvcmRlcnMucHVzaChvcmRlcik7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkcy5wdXNoKGZpZWxkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGpvYlR5cGVzLnJlc3VsdHMgPSBfLnNvcnRCeU9yZGVyKGpvYlR5cGVzLnJlc3VsdHMsIGZpZWxkcywgb3JkZXJzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuT2JqWzFdID0gSlNPTi5zdHJpbmdpZnkoam9iVHlwZXMpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuT2JqO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIEpvYiBleGVjdXRpb24gbG9nc1xuICAgICAgICB2YXIgam9iRXhlY3V0aW9uTG9nc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9qb2JFeGVjdXRpb25Mb2cuanNvbic7XG4gICAgICAgIHZhciBqb2JFeGVjdXRpb25Mb2dSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9iLWV4ZWN1dGlvbnMvLiovbG9ncy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChqb2JFeGVjdXRpb25Mb2dSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhqb2JFeGVjdXRpb25Mb2dzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuXG4gICAgICAgIC8vIE1ldHJpY3MgUGxvdCBEYXRhIERldGFpbFxuICAgICAgICAvL3ZhciBtZXRyaWNzUGxvdERhdGFPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvbWV0cmljc0pvYlR5cGVzUGxvdERhdGEuanNvbic7XG4gICAgICAgIHZhciBtZXRyaWNzUGxvdERhdGFSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnbWV0cmljcy8uKi8uKi8nLCdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKG1ldHJpY3NQbG90RGF0YVJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCkge1xuICAgICAgICAgICAgdmFyIHVybFBhcmFtcyA9IGdldFVybFBhcmFtcyh1cmwpLFxuICAgICAgICAgICAgICAgIHJhbmRvbSA9IDA7XG5cbiAgICAgICAgICAgIHZhciByZXR1cm5PYmogPSB7XG4gICAgICAgICAgICAgICAgY291bnQ6IDI4LFxuICAgICAgICAgICAgICAgIG5leHQ6IG51bGwsXG4gICAgICAgICAgICAgICAgcHJldmlvdXM6IG51bGwsXG4gICAgICAgICAgICAgICAgcmVzdWx0czogW11cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBudW1EYXlzID0gbW9tZW50LnV0Yyh1cmxQYXJhbXMuZW5kZWRbMF0pLmRpZmYobW9tZW50LnV0Yyh1cmxQYXJhbXMuc3RhcnRlZFswXSksICdkJykgKyAxO1xuXG4gICAgICAgICAgICBfLmZvckVhY2godXJsUGFyYW1zLmNvbHVtbiwgZnVuY3Rpb24gKG1ldHJpYykge1xuICAgICAgICAgICAgICAgIHZhciBtYXhSYW5kb20gPSBtZXRyaWMgPT09ICd0b3RhbF9jb3VudCcgPyAxMDAwIDogMjAwO1xuICAgICAgICAgICAgICAgIHZhciBtaW5SYW5kb20gPSBtZXRyaWMgPT09ICd0b3RhbF9jb3VudCcgPyA4MDAgOiAxMDtcbiAgICAgICAgICAgICAgICB2YXIgcmV0dXJuUmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICBjb2x1bW46IHsgdGl0bGU6IF8uc3RhcnRDYXNlKG1ldHJpYykgfSxcbiAgICAgICAgICAgICAgICAgICAgbWluX3g6IG1vbWVudC51dGModXJsUGFyYW1zLnN0YXJ0ZWRbMF0pLmZvcm1hdCgnWVlZWS1NTS1ERCcpLFxuICAgICAgICAgICAgICAgICAgICBtYXhfeDogbW9tZW50LnV0Yyh1cmxQYXJhbXMuZW5kZWRbMF0pLmZvcm1hdCgnWVlZWS1NTS1ERCcpLFxuICAgICAgICAgICAgICAgICAgICBtaW5feTogMSxcbiAgICAgICAgICAgICAgICAgICAgbWF4X3k6IDEwMDAsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlczogW11cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1EYXlzOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVybFBhcmFtcy5jaG9pY2VfaWQgJiYgdXJsUGFyYW1zLmNob2ljZV9pZC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2godXJsUGFyYW1zLmNob2ljZV9pZCwgZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDUgLSAxICsgMSkpICsgMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmFuZG9tIDw9IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heFJhbmRvbSAtIG1pblJhbmRvbSArIDEpKSArIG1pblJhbmRvbTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuUmVzdWx0LnZhbHVlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IG1vbWVudC51dGModXJsUGFyYW1zLnN0YXJ0ZWRbMF0pLmFkZChpLCAnZCcpLmZvcm1hdCgnWVlZWS1NTS1ERCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHBhcnNlSW50KGlkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhbmRvbSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg1IC0gMSArIDEpKSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmFuZG9tIDw9IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5SZXN1bHQudmFsdWVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBtb21lbnQudXRjKHVybFBhcmFtcy5zdGFydGVkWzBdKS5hZGQoaSwgJ2QnKS5mb3JtYXQoJ1lZWVktTU0tREQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXhSYW5kb20gLSBtaW5SYW5kb20gKyAxKSkgKyBtaW5SYW5kb21cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm5PYmoucmVzdWx0cy5wdXNoKHJldHVyblJlc3VsdCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIFsyMDAsIHJldHVybk9iaiwge31dO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBNZXRyaWNzIERldGFpbFxuICAgICAgICB2YXIgbWV0cmljc0RldGFpbFJlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdtZXRyaWNzLy4qLycsJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQobWV0cmljc0RldGFpbFJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCkge1xuICAgICAgICAgICAgdmFyIHVybEFyciA9IHVybC5zcGxpdCgnLycpLFxuICAgICAgICAgICAgICAgIGRldGFpbFR5cGUgPSB1cmxBcnJbdXJsQXJyLmxlbmd0aCAtIDJdO1xuXG4gICAgICAgICAgICBpZiAoZGV0YWlsVHlwZSA9PT0gJ2pvYi10eXBlcycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0U3luYygndGVzdC9kYXRhL21ldHJpY3NKb2JUeXBlcy5qc29uJyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRldGFpbFR5cGUgPT09ICdlcnJvci10eXBlcycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0U3luYygndGVzdC9kYXRhL21ldHJpY3NFcnJvclR5cGVzLmpzb24nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKCd0ZXN0L2RhdGEvbWV0cmljc0luZ2VzdC5qc29uJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIE1ldHJpY3NcbiAgICAgICAgdmFyIG1ldHJpY3NPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvbWV0cmljcy5qc29uJztcbiAgICAgICAgdmFyIG1ldHJpY3NSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnbWV0cmljcy8nLCdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKG1ldHJpY3NSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhtZXRyaWNzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBOb2RlIHN0YXR1c1xuICAgICAgICB2YXIgbm9kZVN0YXR1c092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9ub2RlU3RhdHVzLmpzb24nO1xuICAgICAgICB2YXIgbm9kZVN0YXR1c1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdub2Rlcy9zdGF0dXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQobm9kZVN0YXR1c1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKG5vZGVTdGF0dXNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIE5vZGUgZGV0YWlsc1xuICAgICAgICB2YXIgbm9kZU92ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9ub2RlLmpzb24nO1xuICAgICAgICB2YXIgbm9kZVJlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdub2Rlcy8uKi8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChub2RlUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMobm9kZU92ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuUEFUQ0gobm9kZVJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKG5vZGVPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIE5vZGVzXG4gICAgICAgIHZhciBub2Rlc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9ub2Rlcy5qc29uJztcbiAgICAgICAgdmFyIG5vZGVzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ25vZGVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKG5vZGVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMobm9kZXNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFF1ZXVlIFN0YXR1cyBzZXJ2aWNlXG4gICAgICAgIHZhciBxdWV1ZVN0YXR1c092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9xdWV1ZVN0YXR1cy5qc29uJztcbiAgICAgICAgdmFyIHF1ZXVlU3RhdHVzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3F1ZXVlL3N0YXR1cy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChxdWV1ZVN0YXR1c1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKHF1ZXVlU3RhdHVzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIFJlY2lwZSBEZXRhaWxzXG4gICAgICAgIHZhciByZWNpcGVEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3JlY2lwZURldGFpbHMuanNvbic7XG4gICAgICAgIHZhciByZWNpcGVEZXRhaWxzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3JlY2lwZXMvLiovJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQocmVjaXBlRGV0YWlsc1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCkge1xuICAgICAgICAgICAgLy8gZ2V0IHRoZSByZWNpcGVEZXRhaWwuaWQgZnJvbSB0aGUgdXJsXG4gICAgICAgICAgICB1cmwgPSB1cmwudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIHZhciBpZCA9IHVybC5zdWJzdHJpbmcodXJsLnN1YnN0cmluZygwLHVybC5sYXN0SW5kZXhPZignLycpKS5sYXN0SW5kZXhPZignLycpKzEsdXJsLmxlbmd0aC0xKTtcbiAgICAgICAgICAgIHJlY2lwZURldGFpbHNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvcmVjaXBlLWRldGFpbHMvcmVjaXBlRGV0YWlsJyArIGlkICsgJy5qc29uJztcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKHJlY2lwZURldGFpbHNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFJlY2lwZXMgc2VydmljZVxuICAgICAgICB2YXIgcmVjaXBlc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9yZWNpcGVzLmpzb24nO1xuICAgICAgICB2YXIgcmVjaXBlc1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdyZWNpcGVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKHJlY2lwZXNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwpIHtcbiAgICAgICAgICAgIHZhciB1cmxQYXJhbXMgPSBnZXRVcmxQYXJhbXModXJsKSxcbiAgICAgICAgICAgICAgICByZXR1cm5PYmogPSBnZXRTeW5jKHJlY2lwZXNPdmVycmlkZVVybCksXG4gICAgICAgICAgICAgICAgcmVjaXBlcyA9IEpTT04ucGFyc2UocmV0dXJuT2JqWzFdKTtcblxuICAgICAgICAgICAgaWYgKHVybFBhcmFtcy5vcmRlciAmJiB1cmxQYXJhbXMub3JkZXIubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHZhciBvcmRlcnMgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHVybFBhcmFtcy5vcmRlciwgZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9yZGVyID0gby5jaGFyQXQoMCkgPT09ICctJyA/ICdkZXNjJyA6ICdhc2MnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQgPSBvcmRlciA9PT0gJ2Rlc2MnID8gdXJsUGFyYW1zLm9yZGVyWzBdLnN1YnN0cmluZygxKSA6IHVybFBhcmFtcy5vcmRlclswXTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGQgPT09ICdyZWNpcGVfdHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkID0gJ3JlY2lwZV90eXBlLm5hbWUnO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgb3JkZXJzLnB1c2gob3JkZXIpO1xuICAgICAgICAgICAgICAgICAgICBmaWVsZHMucHVzaChmaWVsZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZWNpcGVzLnJlc3VsdHMgPSBfLnNvcnRCeU9yZGVyKHJlY2lwZXMucmVzdWx0cywgZmllbGRzLCBvcmRlcnMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm5PYmpbMV0gPSBKU09OLnN0cmluZ2lmeShyZWNpcGVzKTtcblxuICAgICAgICAgICAgcmV0dXJuIHJldHVybk9iajtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmVjaXBlIHR5cGUgdmFsaWRhdGlvbiBzZXJ2aWNlXG4gICAgICAgIHZhciByZWNpcGVUeXBlVmFsaWRhdGlvbk92ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9yZWNpcGVUeXBlVmFsaWRhdGlvblN1Y2Nlc3MuanNvbic7XG4gICAgICAgIHZhciByZWNpcGVUeXBlVmFsaWRhdGlvblJlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdyZWNpcGUtdHlwZXMvdmFsaWRhdGlvbi8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlblBPU1QocmVjaXBlVHlwZVZhbGlkYXRpb25SZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhyZWNpcGVUeXBlVmFsaWRhdGlvbk92ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmVjaXBlIFR5cGUgRGV0YWlsc1xuICAgICAgICB2YXIgcmVjaXBlVHlwZURldGFpbHNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvcmVjaXBlLXR5cGVzL3JlY2lwZVR5cGUxLmpzb24nO1xuICAgICAgICB2YXIgcmVjaXBlVHlwZURldGFpbHNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAncmVjaXBlLXR5cGVzLy4qLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKHJlY2lwZVR5cGVEZXRhaWxzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICAvLyBnZXQgdGhlIHJlY2lwZVR5cGUuaWQgZnJvbSB0aGUgdXJsXG4gICAgICAgICAgICB1cmwgPSB1cmwudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIHZhciBpZCA9IHVybC5zdWJzdHJpbmcodXJsLnN1YnN0cmluZygwLHVybC5sYXN0SW5kZXhPZignLycpKS5sYXN0SW5kZXhPZignLycpKzEsdXJsLmxlbmd0aC0xKTtcbiAgICAgICAgICAgIHJlY2lwZVR5cGVEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3JlY2lwZS10eXBlcy9yZWNpcGVUeXBlJyArIGlkICsgJy5qc29uJztcbiAgICAgICAgICAgIHZhciByZXR1cm5WYWx1ZSA9IGdldFN5bmMocmVjaXBlVHlwZURldGFpbHNPdmVycmlkZVVybCk7XG4gICAgICAgICAgICBpZiAocmV0dXJuVmFsdWVbMF0gIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3JlY2lwZVR5cGUnICsgaWQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBbMjAwLCBKU09OLnBhcnNlKHJldHVyblZhbHVlKSwge31dO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFJlY2lwZSBUeXBlcyBzZXJ2aWNlXG4gICAgICAgIHZhciByZWNpcGVUeXBlc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9yZWNpcGVUeXBlcy5qc29uJztcbiAgICAgICAgdmFyIHJlY2lwZVR5cGVzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3JlY2lwZS10eXBlcy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChyZWNpcGVUeXBlc1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCkge1xuICAgICAgICAgICAgdmFyIHVybFBhcmFtcyA9IGdldFVybFBhcmFtcyh1cmwpLFxuICAgICAgICAgICAgICAgIHJldHVybk9iaiA9IGdldFN5bmMocmVjaXBlVHlwZXNPdmVycmlkZVVybCksXG4gICAgICAgICAgICAgICAgcmVjaXBlVHlwZXMgPSBKU09OLnBhcnNlKHJldHVybk9ialsxXSk7XG5cbiAgICAgICAgICAgIGlmICh1cmxQYXJhbXMub3JkZXIgJiYgdXJsUGFyYW1zLm9yZGVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgb3JkZXJzID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkcyA9IFtdO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh1cmxQYXJhbXMub3JkZXIsIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcmRlciA9IG8uY2hhckF0KDApID09PSAnLScgPyAnZGVzYycgOiAnYXNjJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkID0gb3JkZXIgPT09ICdkZXNjJyA/IHVybFBhcmFtcy5vcmRlclswXS5zdWJzdHJpbmcoMSkgOiB1cmxQYXJhbXMub3JkZXJbMF07XG5cbiAgICAgICAgICAgICAgICAgICAgb3JkZXJzLnB1c2gob3JkZXIpO1xuICAgICAgICAgICAgICAgICAgICBmaWVsZHMucHVzaChmaWVsZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZWNpcGVUeXBlcy5yZXN1bHRzID0gXy5zb3J0QnlPcmRlcihyZWNpcGVUeXBlcy5yZXN1bHRzLCBmaWVsZHMsIG9yZGVycyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybk9ialsxXSA9IEpTT04uc3RyaW5naWZ5KHJlY2lwZVR5cGVzKTtcblxuICAgICAgICAgICAgcmV0dXJuIHJldHVybk9iajtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gU2F2ZSBSZWNpcGUgVHlwZVxuICAgICAgICB2YXIgcmVjaXBlVHlwZVNhdmVSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAncmVjaXBlLXR5cGVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuUE9TVChyZWNpcGVUeXBlU2F2ZVJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIHJlY2lwZUpvYlR5cGVzID0gW10sXG4gICAgICAgICAgICAgICAgcmVjaXBlSm9iVHlwZXNEZXRhaWxzID0gW10sXG4gICAgICAgICAgICAgICAgam9iVHlwZURhdGEgPSBnZXRTeW5jKCd0ZXN0L2RhdGEvam9iVHlwZXMuanNvbicpLFxuICAgICAgICAgICAgICAgIGpvYlR5cGVzID0gSlNPTi5wYXJzZShqb2JUeXBlRGF0YVsxXSkucmVzdWx0cyxcbiAgICAgICAgICAgICAgICByZWNpcGVUeXBlID0gSlNPTi5wYXJzZShkYXRhKSxcbiAgICAgICAgICAgICAgICB1bmlxdWVSZWNpcGVUeXBlSm9icyA9IF8udW5pcShyZWNpcGVUeXBlLmRlZmluaXRpb24uam9icywgJ2pvYl90eXBlJyk7XG4gICAgICAgICAgICBfLmZvckVhY2godW5pcXVlUmVjaXBlVHlwZUpvYnMsIGZ1bmN0aW9uIChqb2IpIHtcbiAgICAgICAgICAgICAgICByZWNpcGVKb2JUeXBlcy5wdXNoKF8uZmluZChqb2JUeXBlcywgZnVuY3Rpb24gKGpvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpvYlR5cGUubmFtZSA9PT0gam9iLmpvYl90eXBlLm5hbWUgJiYgam9iVHlwZS52ZXJzaW9uID09PSBqb2Iuam9iX3R5cGUudmVyc2lvbjtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIF8uZm9yRWFjaChyZWNpcGVKb2JUeXBlcywgZnVuY3Rpb24gKGpvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICB2YXIganQgPSBnZXRTeW5jKCd0ZXN0L2RhdGEvam9iLXR5cGVzL2pvYlR5cGUnICsgam9iVHlwZS5pZCArICcuanNvbicpO1xuICAgICAgICAgICAgICAgIHJlY2lwZUpvYlR5cGVzRGV0YWlscy5wdXNoKEpTT04ucGFyc2UoanRbMV0pKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIHJldHVyblJlY2lwZSA9IHtcbiAgICAgICAgICAgICAgICBpZDogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDEwMDAwIC0gNSArIDEpKSArIDUsXG4gICAgICAgICAgICAgICAgbmFtZTogcmVjaXBlVHlwZS5uYW1lLFxuICAgICAgICAgICAgICAgIHZlcnNpb246IHJlY2lwZVR5cGUudmVyc2lvbixcbiAgICAgICAgICAgICAgICB0aXRsZTogcmVjaXBlVHlwZS50aXRsZSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogcmVjaXBlVHlwZS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBpc19hY3RpdmU6IHRydWUsXG4gICAgICAgICAgICAgICAgZGVmaW5pdGlvbjogcmVjaXBlVHlwZS5kZWZpbml0aW9uLFxuICAgICAgICAgICAgICAgIHJldmlzaW9uX251bTogMSxcbiAgICAgICAgICAgICAgICBjcmVhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgbGFzdF9tb2RpZmllZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGFyY2hpdmVkOiBudWxsLFxuICAgICAgICAgICAgICAgIHRyaWdnZXJfcnVsZTogcmVjaXBlVHlwZS50cmlnZ2VyX3J1bGUsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVzOiByZWNpcGVKb2JUeXBlc0RldGFpbHNcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gWzIwMCwgSlNPTi5zdHJpbmdpZnkocmV0dXJuUmVjaXBlKSwge31dO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTdGF0dXMgc2VydmljZVxuICAgICAgICB2YXIgc3RhdHVzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3N0YXR1cy5qc29uJztcbiAgICAgICAgdmFyIHN0YXR1c1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdzdGF0dXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQoc3RhdHVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMoc3RhdHVzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBWZXJzaW9uXG4gICAgICAgIHZhciB2ZXJzaW9uT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3ZlcnNpb24uanNvbic7XG4gICAgICAgIHZhciB2ZXJzaW9uUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3YzL3ZlcnNpb24vJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQodmVyc2lvblJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKHZlcnNpb25PdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFdvcmtzcGFjZSBEZXRhaWxzXG4gICAgICAgIHZhciB3b3Jrc3BhY2VEZXRhaWxzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3dvcmtzcGFjZXMvd29ya3NwYWNlMS5qc29uJztcbiAgICAgICAgdmFyIHdvcmtzcGFjZURldGFpbHNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnd29ya3NwYWNlcy8uKi8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVCh3b3Jrc3BhY2VEZXRhaWxzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKG1ldGhvZCwgdXJsKSB7XG4gICAgICAgICAgICAvLyBnZXQgdGhlIHdvcmtzcGFjZS5pZCBmcm9tIHRoZSB1cmxcbiAgICAgICAgICAgIHVybCA9IHVybC50b1N0cmluZygpO1xuICAgICAgICAgICAgdmFyIGlkID0gdXJsLnN1YnN0cmluZyh1cmwuc3Vic3RyaW5nKDAsdXJsLmxhc3RJbmRleE9mKCcvJykpLmxhc3RJbmRleE9mKCcvJykrMSx1cmwubGVuZ3RoLTEpO1xuICAgICAgICAgICAgd29ya3NwYWNlRGV0YWlsc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS93b3Jrc3BhY2VzL3dvcmtzcGFjZScgKyBpZCArICcuanNvbic7XG4gICAgICAgICAgICB2YXIgcmV0dXJuVmFsdWUgPSBnZXRTeW5jKHdvcmtzcGFjZURldGFpbHNPdmVycmlkZVVybCk7XG4gICAgICAgICAgICBpZiAocmV0dXJuVmFsdWVbMF0gIT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3dvcmtzcGFjZScgKyBpZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyMDAsIEpTT04ucGFyc2UocmV0dXJuVmFsdWUpLCB7fV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5WYWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cblxuICAgICAgICAvLyBXb3Jrc3BhY2VzXG4gICAgICAgIHZhciB3b3Jrc3BhY2VzT3ZlcnJpZGVVcmwgPSAndGVzdC9kYXRhL3dvcmtzcGFjZXMuanNvbic7XG4gICAgICAgIHZhciB3b3Jrc3BhY2VzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3dvcmtzcGFjZXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQod29ya3NwYWNlc1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKHdvcmtzcGFjZXNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNhdmUgV29ya3NwYWNlXG4gICAgICAgIHZhciBnZXRSZXR1cm4gPSBmdW5jdGlvbiAoZGF0YSwgaWQpIHtcbiAgICAgICAgICAgIHZhciB3b3Jrc3BhY2UgPSBKU09OLnBhcnNlKGRhdGEpO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlkOiBpZCB8fCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwMDAgLSA1ICsgMSkpICsgNSxcbiAgICAgICAgICAgICAgICBuYW1lOiB3b3Jrc3BhY2UubmFtZSxcbiAgICAgICAgICAgICAgICB0aXRsZTogd29ya3NwYWNlLnRpdGxlLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB3b3Jrc3BhY2UuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgYmFzZV91cmw6IHdvcmtzcGFjZS5iYXNlX3VybCxcbiAgICAgICAgICAgICAgICBpc19hY3RpdmU6IHdvcmtzcGFjZS5pc19hY3RpdmUgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgdXNlZF9zaXplOiAwLFxuICAgICAgICAgICAgICAgIHRvdGFsX3NpemU6IDAsXG4gICAgICAgICAgICAgICAgY3JlYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGFyY2hpdmVkOiBudWxsLFxuICAgICAgICAgICAgICAgIGxhc3RfbW9kaWZpZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBqc29uX2NvbmZpZzogd29ya3NwYWNlLmpzb25fY29uZmlnXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICB2YXIgd29ya3NwYWNlQ3JlYXRlUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3dvcmtzcGFjZXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5QT1NUKHdvcmtzcGFjZUNyZWF0ZVJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uIChtZXRob2QsIHVybCwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIHJldHVybldvcmtzcGFjZSA9IGdldFJldHVybihkYXRhKTtcbiAgICAgICAgICAgIHJldHVybiBbMjAwLCBKU09OLnN0cmluZ2lmeShyZXR1cm5Xb3Jrc3BhY2UpLCB7fV07XG4gICAgICAgIH0pO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlblBBVENIKHdvcmtzcGFjZURldGFpbHNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAobWV0aG9kLCB1cmwsIGRhdGEpIHtcbiAgICAgICAgICAgIC8vIGdldCB0aGUgd29ya3NwYWNlLmlkIGZyb20gdGhlIHVybFxuICAgICAgICAgICAgdXJsID0gdXJsLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICB2YXIgaWQgPSB1cmwuc3Vic3RyaW5nKHVybC5zdWJzdHJpbmcoMCx1cmwubGFzdEluZGV4T2YoJy8nKSkubGFzdEluZGV4T2YoJy8nKSsxLHVybC5sZW5ndGgtMSk7XG4gICAgICAgICAgICB2YXIgcmV0dXJuV29ya3NwYWNlID0gZ2V0UmV0dXJuKGRhdGEsIGlkKTtcbiAgICAgICAgICAgIHJldHVybiBbMjAwLCBKU09OLnN0cmluZ2lmeShyZXR1cm5Xb3Jrc3BhY2UpLCB7fV07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEZvciBldmVyeXRoaW5nIGVsc2UsIGRvbid0IG1vY2tcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQoL15cXHcrLiovKS5wYXNzVGhyb3VnaCgpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlblBPU1QoL15cXHcrLiovKS5wYXNzVGhyb3VnaCgpO1xuICAgIH0pO1xufSkoKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
