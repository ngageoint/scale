(function () {
    'use strict';

    var app = angular.module('scaleApp', [
        'scaleConfigModule',
        'ngResource',
        'ngSanitize',
        'ngRoute',
        'emguo.poller',
        'ui.bootstrap',
        'ui.grid',
        'ui.grid.selection',
        'ui.grid.pagination',
        'ui.grid.resizeColumns',
        'cfp.hotkeys'
    ]);

    app.config(['$routeProvider', '$resourceProvider', 'pollerConfig', function($routeProvider, $resourceProvider, pollerConfig) {
        // stop pollers when route changes
        pollerConfig.stopOnRouteChange = true;
        pollerConfig.smart = true;

        // preserve trailing slashes
        $resourceProvider.defaults.stripTrailingSlashes = false;

        //routing
        $routeProvider
            .when('/', {
                controller: 'ovController',
                templateUrl: 'modules/overview/partials/ovTemplate.html'
            })
            .when('/admin/login',{
                controller: 'adminLoginController',
                templateUrl: 'modules/admin/partials/adminLoginTemplate.html'
            })
            .when('/admin/logout',{
                controller: 'logoutController',
                templateUrl: 'modules/admin/partials/adminLoginTemplate.html'
            })
            .when('/about', {
                controller: 'aboutController',
                templateUrl: 'modules/about/partials/aboutTemplate.html'
            })
            .when('/feed', {
                controller: 'feedDetailsController',
                templateUrl: 'modules/feed/partials/feedDetailsTemplate.html',
                reloadOnSearch: false
            })
            .when('/feed/ingests', {
                controller: 'ingestRecordsController',
                templateUrl: 'modules/feed/partials/ingestRecordsTemplate.html',
                reloadOnSearch: false
            })
            .when('/metrics', {
                controller: 'metricsController',
                templateUrl: 'modules/metrics/partials/metricsTemplate.html',
                reloadOnSearch: false
            })
            .when('/nodes', {
                controller: 'nodesController',
                templateUrl: 'modules/nodes/partials/nodesTemplate.html'
            })
            .when('/nodes/:id', {
                controller: 'nodeDetailsController',
                templateUrl: 'modules/nodes/partials/nodeDetailsTemplate.html'
            })
            .when('/load', {
                controller: 'loadController',
                templateUrl: 'modules/load/partials/loadTemplate.html'
            })
            .when('/load/running', {
                controller: 'queueRunningController',
                templateUrl: 'modules/load/partials/queueRunningTemplate.html'
            })
            .when('/load/depth', {
                controller: 'loadDepthController',
                templateUrl: 'modules/load/partials/loadDepthTemplate.html'
            })
            .when('/recipes', {
                controller: 'recipesController',
                templateUrl: 'modules/recipes/partials/recipesTemplate.html',
                reloadOnSearch: false
            })
            .when('/recipes/recipe/:id', {
                controller: 'recipeDetailsController',
                templateUrl: 'modules/recipes/partials/recipeDetailsTemplate.html'
            })
            .when('/recipes/types/:id?', {
                controller: 'recipeTypesController',
                templateUrl: 'modules/recipes/partials/recipeTypesTemplate.html'
            })
            .when('/recipes/builder', {
                controller: 'recipeEditorController',
                templateUrl: 'modules/recipes/partials/recipeEditorTemplate.html'
            })
            .when('/recipes/builder/:id', {
                controller: 'recipeEditorController',
                templateUrl: 'modules/recipes/partials/recipeEditorTemplate.html'
            })
            .when('/jobs', {
                controller: 'jobsController',
                templateUrl: 'modules/jobs/partials/jobsTemplate.html',
                reloadOnSearch: false
            })
            .when('/jobs/job/:id', {
                controller: 'jobDetailController',
                templateUrl: 'modules/jobs/partials/jobDetailTemplate.html'
            })
            .when('/jobs/types/:id?', {
                controller: 'jobTypesController',
                templateUrl: 'modules/jobs/partials/jobTypesTemplate.html'
            })
            .when('/jobs/executions', {
                controller: 'jobExecutionsController',
                templateUrl: 'modules/jobs/partials/jobExecutionsTemplate.html'
            })
            .when('/jobs/executions/:id', {
                controller: 'jobExecutionDetailController',
                templateUrl: 'modules/jobs/partials/jobExecutionDetailTemplate.html'
            })
            .otherwise({
                redirectTo: '/'
            });
    }])
    .value('moment', window.moment)
    .value('localStorage', window.localStorage)
    .value('XMLHttpRequest', window.XMLHttpRequest)
    .value('toastr', window.toastr);
})();

(function () {
    'use strict';

    angular.module('scaleConfigModule', []).provider('scaleConfig', function () {
        var scaleConfig = {},
            scaleConfigLocal = {};

        this.$get = function () {
            var config = $.ajax({
                type: 'GET',
                url: 'config/scaleConfig.json',
                cache: false,
                async: false,
                contentType: 'application/json',
                dataType: 'json'
            });
            
            if (config.status === 200) {
                scaleConfig = config.responseJSON.scaleConfig;

                var configLocal = $.ajax({
                    type: 'GET',
                    url: 'config/scaleConfig.local.json',
                    cache: false,
                    async: false,
                    contentType: 'application/json',
                    dataType: 'json'
                });

                if (configLocal.status === 200) {
                    scaleConfigLocal = configLocal.responseJSON.scaleConfigLocal;
                }

                _.merge(scaleConfig, scaleConfigLocal);
            }

            return scaleConfig;
        }
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisHeaderController', ['$scope', '$element', 'subnavService', function($scope, $element, subnavService) {
        $scope.date = new Date();
        $scope.currentPath = subnavService.getCurrentPath();
    }])
    .directive('aisHeader', function () {
        /**
         * Usage: <ais-header name={name}></ais-header>
         */
        return {
            controller: 'aisHeaderController',
            restrict: 'E',
            templateUrl: 'modules/header/headerTemplate.html',
            scope: {
                name: '=',
                hideTitle: '=',
                loading: '=', // optional - will overlay a loading spinner on the page based on the passed-in value
                showSubnav: '=',
                subnavLinks: '='
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('scaleNavigation', function () {
        return {
            restrict: 'E',
            templateUrl: 'modules/navigation/partials/navTemplate.html',
            controller: 'navController'
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aboutController', ['$scope', '$location', '$window', 'navService', function($scope, $location, $window, navService) {
        var initialize = function() {
            navService.updateLocation('about');
        };
        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('adminLoginController', ['$timeout', '$rootScope', '$location', 'userService', function ($timeout, $rootScope, $location, userService) {

        var initialize = function () {
            $rootScope.user = userService.getUserCreds();
            if(!$rootScope.user){
                $rootScope.user = userService.login('admin');
            }

            console.log($rootScope.user);

            $timeout(function(){
                // Any code in here will automatically have an $scope.apply() run afterwards
                $location.path("/");
            });
        };

        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('logoutController', ['$timeout', '$rootScope', '$location', 'userService', function ($timeout, $rootScope, $location, userService) {

        var initialize = function () {
            userService.logout();
            $timeout(function(){
                // Any code in here will automatically have an $scope.apply() run afterwards
                $location.path("/");
            });
        };

        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('aisDataFeedController', ['$scope', 'scaleConfig', 'loadService', 'scaleService', function ($scope, scaleConfig, loadService, scaleService) {
        $scope.days = [];
        $scope.hours = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23];
        $scope.values = {};
        var processNewFeed = function(){
            var currentDay = moment.utc();
            $scope.days = [];
            var day = '';
            if($scope.feed){
                _.forEach($scope.feed.values, function(val){
                    var valday = moment.utc(val.time).format(scaleConfig.dateFormats.day);
                    var valhour = moment.utc(val.time).hour();
                    var id = valday + '_' + valhour;
                    $scope.values[id] = val;
                    if(valday !== day){
                        day = valday;
                        $scope.days.push(valday);
                    }
                });
                buildTable();
            }
        };

        var buildTable = function () {
            var currDay = moment().utc().format(scaleConfig.dateFormats.day);
            var currHour = moment().utc().hour();

            var table_html = '<div class="table-responsive"><table>';
            table_html += '<tr><th>Hour (UTC)</th>';
            for(day in $scope.days){
                table_html += '<td class="day-label" title="' + $scope.days[day] + '"><div class="day-of-week">' + scaleService.getDayString(moment($scope.days[day]).day()) + '</div>' + moment($scope.days[day]).format('MM/DD') + '</td>';
            }
            table_html += '</tr>';
            for(var hour in $scope.hours){
                hour = 23-hour;
                table_html += '<tr>';
                table_html += '<th title="' + $scope.hours[hour] + ':00">' + $scope.hours[hour] + '</th>';

                for(var day in $scope.days){
                    var key =  $scope.days[day] + '_' + $scope.hours[hour];
                    var files = $scope.values[key].files;
                    var size = $scope.values[key].size;
                    var cls = 'good';
                    if($scope.days[day] === currDay){
                        if($scope.hours[hour] === currHour){
                            cls = 'current';
                        }
                        else if($scope.hours[hour] > currHour) {
                            cls = 'future';
                        }
                    }
                    if(files === 0 && size === 0 && cls !== 'current' && cls !== 'future'){
                        cls = 'unknown';
                    }
                    //console.log(key);
                    table_html += '<td id="' + key + '" title="' + $scope.days[day] + ' ' + $scope.hours[hour] + ':00">';
                    if(cls === 'future'){
                        //table_html += '<span class="' + cls + '" id="span_' + $scope.days[day] + '_' + $scope.hours[hour] + '" style="display: block;"><div class="file-count">&nbsp;</div><div class="file-size">&nbsp;</div></span></td>';
                        table_html += '<span class="' + cls + '" id="span_' + $scope.days[day] + '_' + $scope.hours[hour] + '" style="display: block;">&nbsp;</span></td>';
                    }
                    else{
                        //table_html += '<span class="' + cls + '" id="span_' + $scope.days[day] + '_' + $scope.hours[hour] + '" style="display: block;"><div class="file-count">' + files + '</div><div class="file-size">' + scaleService.calculateFileSizeFromBytes(size,1) + '</div></span></td>';
                        //table_html += '<span class="' + cls + '" id="span_' + $scope.days[day] + '_' + $scope.hours[hour] + '" style="display: block;"><span class="file-count">' + files + '</span> / <span class="file-size">' + scaleService.calculateFileSizeFromBytes(size,1) + '</span></span></td>';
                        table_html += '<span class="' + cls + '" id="span_' + $scope.days[day] + '_' + $scope.hours[hour] + '" style="display: block;">' + scaleService.calculateFileSizeFromBytes(size,1) + ' / ' + files + '</span></td>';
                    }

                }
                table_html += '</tr>';
            }
            table_html += '</table></div>';
            $('#history').html(table_html);
        };

        var initialize = function(){

            $scope.$watch('feed', function (value) {
                if($scope.feed){
                    processNewFeed();
                }
            });
        };

        initialize();
    }]).directive('aisDataFeed', function () {
        return {
            controller: 'aisDataFeedController',
            templateUrl: 'modules/charts/dataFeed/dataFeedTemplate.html',
            restrict: 'E',
            scope: {
                feed: '=' // Feed data
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisDonutController', ['$scope', '$element', 'scaleConfig', function($scope, $element, scaleConfig) {
        var chart = null;

        var genChart = function () {
            if (chart) {
                //chart.data()
                //$scope.colData
                var oldData = [],
                    removeIds = [];

                // reassemble currently displayed data to match $scope.colData
                _.forEach(chart.data(), function (d) {
                    oldData.push([d.values[0].id, d.values[0].value]);
                });

                // determine which elements to remove
                _.forEach(oldData, function (od) {
                    var keep = _.find($scope.colData, function (cd) {
                        return cd[0] === od[0];
                    });
                    if (!keep) {
                        removeIds.push(od[0]);
                    }
                });

                // update chart
                //console.log(JSON.stringify($scope.colData));
                //console.log(JSON.stringify(removeIds));
                chart.load({
                    columns: $scope.colData,
                    unload: removeIds
                });
            } else {
                chart = c3.generate({
                    bindto: $element[0],
                    data: {
                        columns: $scope.colData,
                        type: $scope.type,
                        colors: {
                            down: scaleConfig.colors.chart_red,
                            warning: scaleConfig.colors.chart_yellow,
                            up: scaleConfig.colors.chart_green,
                            Completed: scaleConfig.colors.chart_green,
                            Done: '#3681bf',
                            Queue: scaleConfig.colors.chart_yellow,
                            Failed: scaleConfig.colors.chart_red,
                            Algorithm: '#444',
                            Data: '#888',
                            System: '#ccc',
                            Offline: scaleConfig.colors.chart_red,
                            'High Failure Rate': scaleConfig.colors.chart_orange,
                            Paused: scaleConfig.colors.chart_yellow
                        }
                    },
                    transition: {
                        duration: 700
                    },
                    pie: {
                        label: {
                            format: d3.format(',')
                        }
                    },
                    donut: {
                        label: {
                            format: $scope.showLabel ? d3.format(',') : function () {
                                return '';
                            }
                        },
                        width: $scope.width,
                        title: $scope.name
                    },
                    tooltip: {
                        format: {
                            value: d3.format(',')
                        }
                    },
                    size: {
                        height: $scope.size || 320
                    }
                });
            }
            $element[0].style.position = 'static';
        };

        var initColumnData = function(){
            $scope.colData = [];
            $scope.data.forEach(function(obj){
                $scope.colData.push([obj.status,obj.count]);
            });
        };

        var initialize = function() {
            initColumnData();
            genChart();
        };

        $scope.$watch('data', function (data) {
            if (data) {
                if (data.length > 0) {
                    initialize();
                } else {
                    $($element[0]).empty();
                }
            }
        });

        window.onresize = function() {
          var width = $($element[0]).width();
          console.log(width);
          genChart();
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisDonut', function () {
        return {
            controller: 'aisDonutController',
            restrict: 'E',
            scope: {
                data: '=',
                type: '=',
                size: '=',
                showLabel: '=',
                width: '=',
                name: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisHealthController', ['$scope', 'gaugeFactory', function ($scope, gaugeFactory) {
        var gauge = null,
            initialized = false;

        var initialize = function () {
            initialized = true;
            var scale = $scope.scale || 1;
            //$scope.gaugeSize = 150 * scale;
            //$scope.gaugeWidth = 25 * scale;
            $scope.donutSize = 275 * scale;
            $scope.donutWidth = 25 * scale;
            //gauge = gaugeFactory.createGauge($scope.type, 'Failure Rate')
        };

        /*var redrawGauge = function () {
            if (gauge) {
                gauge.redraw($scope.data.gaugeData);
            }
        };*/

        $scope.$watch('data', function (data) {
            if (data) {
                if (_.keys(data).length > 0) {
                    if (!initialized) {
                        initialize();
                    }
                    //redrawGauge();
                }
            }
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').directive('aisHealth', function () {
        return {
            controller: 'aisHealthController',
            templateUrl: 'modules/charts/health/healthTemplate.html',
            restrict: 'E',
            scope: {
                name: '=',
                data: '=',
                scale: '=',
                errorLabel: '=',
                type: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisGridChartController', ['$rootScope', '$scope', '$location', '$uibModal', 'userService', 'scaleConfig', function ($rootScope, $scope, $location, $uibModal, userService, scaleConfig) {
        var svg = null,
            rect = null,
            scale = parseFloat($scope.scale),
            tip = d3.tip()
                .attr('class', 'd3-tip')
                .offset([-10, 0])
                .html(function(d) {
                    var failures = d.status.getFailures(),
                        failStr = '';

                    _.forEach(failures, function (f) {
                        failStr = failStr + _.capitalize(f.status.toLowerCase()) + ' Errors: ' + f.count + '<br />';
                    });
                    return d.title + ' ' + d.version + '<br />' + failStr + getCellTotal(d);
                });

        $scope.loading = true;
        $scope.dataValues = [];
        $scope.cellWidth = 50 * scale;
        $scope.cellHeight = 50 * scale;
        $scope.enableZoom = typeof $scope.mode !== 'undefined' ? $scope.mode === 'zoom' : true;
        $scope.enableTooltip = typeof $scope.mode !== 'undefined' ? $scope.mode === 'tooltip' : false;
        $scope.enableReveal = typeof $scope.reveal !== 'undefined' ? $scope.reveal : true;
        $scope.user = userService.getUserCreds();
        $scope.pauseReason = '';
        $scope.gridData = [];
        $scope.gridClass = function () {
            return $scope.icons === true ? 'icons' : '';
        };

        var width = $('.grid-chart').width(),
            height = $scope.rows ? ($scope.cellHeight * $scope.rows) + 10 : ($scope.cellHeight * 6) + 10, // multiply cell height by 8 (highest zoom scale extent value) plus some breathing room
            cols = 0,
            rows = 0,
            cellFontLg = .4,
            cellFontSm = .3;

        var getDataValues = function (data) {
            $scope.gridData = [];
            $scope.dataValues = [];
            if (data.data) {
                var dataType = data.data.toString().split(',')[0];
                if (dataType === 'JobType') {
                    $scope.dataValues = _.sortByOrder(_.values(data.data), ['name'], ['asc']);
                    // associate JobType with JobTypeStatus
                    _.forEach($scope.dataValues, function (val) {
                        val.status = _.find(data.status, 'job_type.id', val.id);
                    });
                    $scope.dataValues = _.sortByOrder(_.values(data.data), ['status.has_running', 'status.description', 'name'], ['asc', 'asc', 'asc']);
                } else if (dataType === 'Node') {
                    $scope.dataValues = _.sortByOrder(_.values(data.data), ['hostname'], ['asc']);
                    // associate Node with NodeStatus
                    _.forEach($scope.dataValues, function (val) {
                        val.status = _.find(data.status, 'node.id', val.id);
                    });
                    $scope.dataValues = _.sortByOrder($scope.dataValues, ['hostname'], ['asc']); // sort by hostName asc
                } else {
                    $scope.dataValues = data.data;
                }

                cols = $scope.columns ? $scope.columns : Math.floor(width / $scope.cellWidth);
                rows = $scope.rows ? $scope.rows : Math.ceil($scope.dataValues.length / cols);

                d3.range(rows).map(function (row) {
                    d3.range(cols).map(function (col) {
                        if (col <= $scope.dataValues.length - 1) {
                            var dataObj = $scope.dataValues[(cols * row) + col];
                            if (dataObj) {
                                dataObj.coords = [col * $scope.cellHeight, row * $scope.cellWidth];
                                $scope.gridData.push(dataObj);
                            }
                        }
                    });
                });

                update();
            }
        };

        var revealData = function () {
            d3.selectAll('.cell-text')
                .style('display', 'none');
            d3.selectAll('.cell-text-detail')
                .style('display', 'block');
            d3.selectAll('.cell-pause-resume-icon')
                .style('display', 'block');
        };

        var hideData = function () {
            d3.selectAll('.cell-text')
                .style('display', 'block');
            d3.selectAll('.cell-text-detail')
                .style('display', 'none');
            d3.selectAll('.cell-pause-resume-icon')
                .style('display', 'none');
        };

        var initialize = function (data) {
            cols = $scope.columns ? $scope.columns : Math.floor(width / $scope.cellWidth);
            rows = $scope.rows ? $scope.rows : Math.ceil($scope.dataValues.length / cols);

            var tickValues = Array.apply(null, {length: rows}).map(Number.call, Number);

            var zoom = d3.behavior.zoom()
                .scaleExtent([1, 6])
                //.center([0, 0])
                .on('zoom', zoomed);

            if ($scope.enableZoom) {
                svg = d3.select('.grid-chart').append('svg')
                    .attr('width', width)
                    .attr('height', height)
                    .append('g')
                    .call(zoom)
                    .append('g');
            } else if ($scope.enableTooltip) {
                svg = d3.select('.grid-chart').append('svg')
                    .attr('width', width)
                    .attr('height', height)
                    .append('g')
                    .call(tip);
            } else {
                svg = d3.select('.grid-chart').append('svg')
                    .attr('width', width)
                    .attr('height', height)
                    .append('g');
            }

            svg.append('rect')
                .attr('class', 'overlay')
                .attr('width', width)
                .attr('height', height);

            if ($scope.showAxes) {
                var y = d3.scale.linear()
                    .domain([0, rows])
                    .range([0, height-10]);

                var yAxis = d3.svg.axis()
                    .scale(y)
                    .orient('left')
                    .tickValues(tickValues);

                svg.attr('transform', 'translate(' + 25 + ',' + 0 + ')')
                    .append('g')
                    .attr('class', 'y axis')
                    .attr('transform', 'translate(' + 0 + ',' + $scope.cellHeight / 2 + ')')
                    .call(yAxis);
            }

            getDataValues(data);

            function zoomed() {
                var s = d3.event.scale;

                if ($scope.enableReveal) {
                    if (s > 3) {
                        revealData();
                    } else {
                        hideData();
                    }
                }
                if (s === 1) {
                    if ($scope.showAxes) {
                        zoom.translate([25, 0]);
                    } else {
                        zoom.translate([0, 0]);
                    }
                }
                svg.attr('transform', 'translate(' + zoom.translate() + ')scale(' + d3.event.scale + ')');
            }

            $scope.loading = false;
        };

        var dragOffsetX = 0,
            dragOffsetY = 0,
            clickOffsetX = 0,
            clickOffsetY = 0;

        var drag = d3.behavior.drag()
            .on('dragstart', function () {
                // track offsetX and offsetY to distinguish between drag and click
                dragOffsetX = d3.event.sourceEvent.offsetX;
                dragOffsetY = d3.event.sourceEvent.offsetY;
            });

        var getCellFill = function (d) {
            if (d && d.status) {
                return d.status.getCellFill();
            }
            return 'none';
        };

        var getCellText = function (d) {
            if (d) {
                return d.getCellText();
            }
        };

        var getCellActivity = function (d) {
            if (d && d.status) {
                return d.status.getCellActivity();
            }
        };

        var getCellPauseResume = function (d) {
            if (d && d.status) {
                return d.status.getCellPauseResume();
            }
        };

        var getCellActivityTotal = function (d) {
            if (d && d.status) {
                return d.status.getCellActivityTotal();
            }
        };

        var getCellTitle = function (d) {
            if (d) {
                return d.getCellTitle();
            }
        };

        var getCellError = function (d) {
            if (d && d.status) {
                return d.status.getCellError();
            }
            return 'Failed: Unavailable';
        };

        var getCellTotal = function (d) {
            if (d && d.status) {
                return d.status.getCellTotal();
            }
            return 'Completed: Unavailable';
        };

        var getCellStatus = function (d) {
            if (d && d.status) {
                if (d.toString() === 'Node') {
                    return d.status.getCellStatus();
                }
            }
            return 'Status Unavailable';
        };

        var getCellJobs = function (d) {
            if (d && d.status) {
                if (d.toString() === 'Node') {
                    return d.status.getCellJobs();
                }
            }
        };

        var getCellFailures = function (d) {
            if (d && d.status) {
                if (d.toString() === 'JobType') {
                    return d.status.getCellFailures();
                }
            }
        };

        var cellClickHandler = function (target) {
            // track offsetX and offsetY to distinguish between drag and click
            clickOffsetX = d3.event.offsetX;
            clickOffsetY = d3.event.offsetY;
            if (dragOffsetX === clickOffsetX && dragOffsetY === clickOffsetY) {
                // offsets are the same; no dragging occurred; process as click event
                $scope.$apply(function () {
                    if (target.toString() === 'JobType') {
                        $location.path('/jobs').search('job_type_id', target.id).search('status', target.status.has_running.status);
                    } else if (target.toString() === 'Node') {
                        $location.path('/nodes/' + target.id);
                    }
                });
            }
        };

        var update = function () {
            // DATA JOIN
            // Join new data with old elements, if any.
            if ($scope.enableTooltip) {
                var containerGroup = svg.selectAll('.cell-group')
                    .data($scope.gridData, function (d) { return d.coords; })
                    .on('mouseover', tip.show)
                    .on('mouseout', tip.hide)
                    .on('click', tip.hide);
            } else {
                var containerGroup = svg.selectAll('.cell-group')
                    .data($scope.gridData, function (d) { return d.coords; });
            }

            // UPDATE
            // Update old elements as needed.
            containerGroup.selectAll('.cell')
                .data($scope.gridData, function (d) { return d.coords; })
                .transition()
                .duration(750)
                .style('stroke', function (d) {
                    return d ? '#fff' : 'none';
                })
                .style('fill', function (d) {
                    return getCellFill(d);
                });

            containerGroup.selectAll('.cell-failure-system')
                .data($scope.gridData, function (d) { return d.coords; })
                .transition()
                .duration(750)
                .attr('x', 0)
                .attr('y', 0)
                .attr('width', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        return $scope.cellWidth / failures.length;
                    }
                    return $scope.cellWidth;
                })
                .style('fill', function (d) {
                    var failures = getCellFailures(d);
                    if (_.findWhere(failures, 'SYSTEM')) {
                        return '#1F77B4';
                    }
                    return 'none';
                })
                .style('display', function (d) {
                    var display = _.findWhere(getCellFailures(d), 'SYSTEM');
                    return display ? 'block' : 'none';
                })
                .style('stroke', function (d) {
                    return d.toString() === 'JobType' ? '#fff' : 'none';
                });

            containerGroup.selectAll('.cell-failure-data')
                .data($scope.gridData, function (d) { return d.coords; })
                .transition()
                .duration(750)
                .attr('x', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        if (_.findWhere(failures, 'SYSTEM')) {
                            return $scope.cellWidth / failures.length;
                        }
                    }
                    return 0;
                })
                .attr('y', 0)
                .attr('width', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        return $scope.cellWidth / failures.length;
                    }
                    return $scope.cellWidth;
                })
                .style('fill', function (d) {
                    var failures = getCellFailures(d);
                    if (_.findWhere(failures, 'DATA')) {
                        return '#FF7F0E';
                    }
                    return 'none';
                })
                .style('display', function (d) {
                    var display = _.findWhere(getCellFailures(d), 'DATA');
                    return display ? 'block' : 'none';
                })
                .style('stroke', function (d) {
                    return d.toString() === 'JobType' ? '#fff' : 'none';
                });

            containerGroup.selectAll('.cell-failure-algorithm')
                .data($scope.gridData, function (d) { return d.coords; })
                .transition()
                .duration(750)
                .attr('x', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        if (_.findWhere(failures, 'DATA') && _.findWhere(failures, 'SYSTEM')) {
                            return ($scope.cellWidth / failures.length) + ($scope.cellWidth / failures.length);
                        } else if (_.findWhere(failures, 'DATA') && !_.findWhere(failures, 'SYSTEM')) {
                            return $scope.cellWidth / failures.length;
                        } else if (_.findWhere(failures, 'SYSTEM') && !_.findWhere(failures, 'DATA')) {
                            return $scope.cellWidth / failures.length;
                        }
                    }
                    return 0;
                })
                .attr('y', 0)
                .attr('width', function (d) {
                    var failures = getCellFailures(d);
                    if (failures && failures.length > 0) {
                        return Math.floor($scope.cellWidth / failures.length);
                    }
                    return $scope.cellWidth;
                })
                .style('fill', function (d) {
                    var failures = getCellFailures(d);
                    if (_.findWhere(failures, 'ALGORITHM')) {
                        return '#2CA02C';
                    }
                    return 'none';
                })
                .style('display', function (d) {
                    var display = _.findWhere(getCellFailures(d), 'ALGORITHM');
                    return display ? 'block' : 'none';
                })
                .style('stroke', function (d) {
                    return d.toString() === 'JobType' ? '#fff' : 'none';
                });

            containerGroup.selectAll('.cell-text')
                .data($scope.gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellText(d);
                });

            containerGroup.selectAll('.cell-total-active')
                .data($scope.gridData, function (d) { return d.coords; })
                .text(function (d) {
                    if (d.toString() === 'JobType') {
                        return getCellActivityTotal(d);
                    }
                });

            containerGroup.selectAll('.cell-pause-resume-icon')
                .data($scope.gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellPauseResume(d);
                });

            containerGroup.selectAll('.cell-activity-icon')
                .data($scope.gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellActivity(d);
                });

            containerGroup.selectAll('.cell-title')
                .data($scope.gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellTitle(d);
                });

            containerGroup.selectAll('.cell-error')
                .data($scope.gridData, function (d) { return d.coords; })
                .text(function (d) {
                    return getCellError(d, true);
                });

            containerGroup.selectAll('.cell-total')
                .data($scope.gridData, function (d) { return d.coords; })
                .text(function (d) {
                    return getCellTotal(d);
                });

            containerGroup.selectAll('.cell-status')
                .data($scope.gridData, function (d) { return d.coords; })
                .text(function (d) {
                    return getCellStatus(d);
                });

            containerGroup.selectAll('.cell-jobs')
                .data($scope.gridData, function (d) { return d.coords; })
                .html(function (d) {
                    return getCellJobs(d);
                });

            containerGroup.selectAll('.cell-overlay')
                .data($scope.gridData, function (d) { return d.coords; })
                .on('click', function (target) {
                    cellClickHandler(target);
                });

            // ENTER
            // Create new elements as needed.
            var cellGroup = containerGroup.enter()
                .append('g')
                .attr('class', 'cell-group');

            cellGroup.append('rect')
                .attr('class', 'cell')
                .attr('width', $scope.cellWidth)
                .attr('height', $scope.cellHeight)
                .style('fill', function (d) {
                    return getCellFill(d);
                })
                .style('stroke', function (d) {
                    return d ? '#fff' : 'none';
                })
                .transition()
                .duration(750);

            cellGroup.append('rect')
                .attr('class', 'cell-failure-system')
                .attr('width', $scope.cellWidth - 2)
                .attr('height', $scope.cellHeight / 7)
                .attr('x', 0)
                .attr('y', 0)
                .style('fill', 'none');

            cellGroup.append('rect')
                .attr('class', 'cell-failure-data')
                .attr('width', $scope.cellWidth - 2)
                .attr('height', $scope.cellHeight / 7)
                .attr('x', 0)
                .attr('y', 0)
                .style('fill', 'none');

            cellGroup.append('rect')
                .attr('class', 'cell-failure-algorithm')
                .attr('width', $scope.cellWidth - 2)
                .attr('height', $scope.cellHeight / 7)
                .attr('x', 0)
                .attr('y', 0)
                .style('fill', 'none');

            cellGroup.append('text')
                .attr('class', 'cell-text')
                .html(function (d) {
                    return getCellText(d);
                })
                .attr('text-anchor', 'middle')
                .attr('x', $scope.cellWidth / 2)
                .attr('y', ($scope.cellHeight / 2) + 8)
                .style('display', $scope.enableReveal ? 'block' : 'none');

            cellGroup.append('text')
                .attr('class', 'cell-total-active')
                .text(function (d) {
                    if (d.toString() === 'JobType') {
                        return getCellActivityTotal(d);
                    }
                })
                .attr('text-anchor', 'end')
                .attr('x', $scope.cellWidth - 2)
                .attr('y', $scope.cellHeight - 5)
                .style('display', $scope.enableReveal ? 'block' : 'none');

            cellGroup.append('g')
                .attr('class', 'cell-activity')
                .append('text')
                .attr('class', 'cell-activity-icon')
                .html(function (d) {
                    return getCellActivity(d);
                })
                .attr('text-anchor', 'start')
                .attr('x', 2)
                .attr('y', $scope.cellHeight - 4);

            var detail = cellGroup.append('text')
                .attr('class', 'cell-text-detail')
                .attr('text-anchor', 'middle')
                .attr('x', $scope.cellWidth / 2)
                .attr('y', Math.floor($scope.cellHeight *.15)) // 15% from top of cell
                .attr('dy', 0)
                .style('display', $scope.enableReveal ? 'none' : 'block');

            detail.append('tspan')
                .attr('class', 'cell-title')
                .attr('text-anchor', 'middle')
                .attr('x', $scope.cellWidth / 2)
                .attr('y', Math.floor($scope.cellHeight * .15)) // 15% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .html(function (d) {
                    return getCellTitle(d);
                })
                .call(wrap);

            detail.append('tspan')
                .attr('class', 'cell-error')
                .attr('text-anchor', 'middle')
                .attr('x', $scope.cellWidth / 2)
                .attr('y', Math.floor($scope.cellHeight *.3)) // 30% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .text(function (d) {
                    return getCellError(d);
                })
                .call(wrap);

            detail.append('tspan')
                .attr('class', 'cell-total')
                .attr('text-anchor', 'middle')
                .attr('x', $scope.cellWidth / 2)
                .attr('y', Math.floor($scope.cellHeight *.4)) // 40% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .text(function (d) {
                    return getCellTotal(d);
                })
                .call(wrap);

            detail.append('tspan')
                .attr('class', 'cell-status')
                .attr('text-anchor', 'middle')
                .attr('x', $scope.cellWidth / 2)
                .attr('y', Math.floor($scope.cellHeight * .55)) // 55% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontLg * scale + 'em')
                .text(function (d) {
                    return getCellStatus(d);
                });

            detail.append('tspan')
                .attr('class', 'cell-jobs')
                .attr('text-anchor', 'middle')
                .attr('x', $scope.cellWidth / 2)
                .attr('y', Math.floor($scope.cellHeight * .75)) // 75% from top of cell
                .attr('dy', 0)
                .style('font-size', cellFontSm * scale + 'em')
                .html(function (d) {
                    return getCellJobs(d);
                })
                .call(wrap);

            cellGroup.append('rect')
                .attr('class', 'cell-overlay')
                .attr('width', $scope.cellWidth)
                .attr('height', $scope.cellHeight)
                .on('mouseover', function () {
                    d3.select(d3.select(this)[0][0].parentElement.children[0])
                        .style('fill-opacity', '0.75');
                })
                .on('mouseout', function () {
                    d3.select(d3.select(this)[0][0].parentElement.children[0])
                        .style('fill-opacity', '1.0');
                })
                .on('click', function (d) {
                    cellClickHandler(d);
                })
                .call(drag);

            if ($scope.user && $scope.user.is_admin) {
                cellGroup.append('text')
                    .attr('class', 'cell-pause-resume-icon')
                    .html(function (d) {
                        return getCellPauseResume(d);
                    })
                    .attr('text-anchor', 'start')
                    .attr('x', 5)
                    .attr('y', 20)
                    .style('display', $scope.enableReveal ? 'none' : 'block')
                    .style('font-size', '1.3em')
                    .on('mouseover', function () {
                        d3.select(this)
                            .style('cursor', 'pointer')
                            .style('fill', scaleConfig.colors.chart_blue);
                    })
                    .on('mouseout', function () {
                        d3.select(this)
                            .style('fill', 'white');
                    })
                    .on('click', function (target) {
                        var pauseResume = function () {
                            var targetData = {};
                            if (target && target.status) {
                                targetData = target;
                                targetData.status.pauseResumeCell($scope.pauseReason).then(function (updatedData) {
                                    if (targetData.toString() === 'Node') {
                                        // update target data values
                                        targetData.is_paused = updatedData.is_paused;
                                        targetData.pause_reason = updatedData.pause_reason;
                                        targetData.status.node = updatedData;
                                        $rootScope.$broadcast('updateNodeHealth');
                                    }
                                    // update grid cell
                                    updateCellFill();
                                    updatePauseResume();
                                    updateCellStatus();
                                });
                            }
                        };

                        // only prompt for reason when pausing (not resuming)
                        if (!target.is_paused) {
                            var modalInstance = $uibModal.open({
                                animation: true,
                                templateUrl: 'pauseDialog.html',
                                scope: $scope
                            });

                            modalInstance.result.then(function () {
                                pauseResume();
                            });
                        } else {
                            pauseResume();
                        }
                    });
            }

            // ENTER + UPDATE
            // Appending to the enter selection expands the update selection to include
            // entering elements; so, operations on the update selection after appending to
            // the enter selection will apply to both entering and updating nodes.
            containerGroup.transition()
                .duration(750)
                .attr('transform', function (d) {
                    return 'translate(' + d.coords + ')';
                });

            var updateCellFill = function () {
                containerGroup.selectAll('.cell')
                    .transition()
                    .duration(250)
                    .style('stroke', function (d) {
                        return d ? '#fff' : 'none';
                    })
                    .style('fill', function (d) {
                        return getCellFill(d);
                    });
            };

            var updatePauseResume = function () {
                containerGroup.selectAll('.cell-pause-resume-icon')
                    .html(function (d) {
                        return getCellPauseResume(d);
                    });
            };

            var updateCellStatus = function () {
                containerGroup.selectAll('.cell-status')
                    .text(function (d) {
                        return getCellStatus(d);
                    });
            };

            // EXIT
            // Remove old elements as needed.
            containerGroup.exit()
                .attr('class', 'cell-exit')
                .transition()
                .duration(750)
                .attr('transform', 'translate(0,0)')
                .remove();

            function wrap (text, width) {
                text.each(function () {
                    var text = d3.select(this),
                        words = text.text().split(/\s+/).reverse(),
                        word,
                        line = [],
                        lineNumber = 0,
                        lineHeight = 1.1,
                        y = text.attr('y'),
                        dy = parseFloat(text.attr('dy')),
                        tspan = text.text(null).append('tspan').attr('x', $scope.cellWidth / 2).attr('y', y).attr('dy', dy + 'em');
                    while (word = words.pop()) {
                        if (word !== 'undefined') {
                            line.push(word);
                            tspan.text(line.join(' '));
                            if (tspan.node().getComputedTextLength() > ($scope.cellWidth - 10)) {
                                line.pop();
                                tspan.text(line.join(' '));
                                line = [word];
                                tspan = text.append('tspan').attr('x', $scope.cellWidth / 2).attr('y', y).attr('dy', ++lineNumber * lineHeight + dy + 'em').text(word);
                            }
                        }
                    }
                });
            }
        };

        $scope.$watch('data', function (data) {
            if (_.keys(data).length > 0) {
                $('.grid-chart').empty();
                initialize(data);
            }
        });

        $scope.$on('redrawGrid', function (event, data) {
            getDataValues(data);
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisGridChart', function () {
        return {
            controller: 'aisGridChartController',
            templateUrl: 'modules/charts/grid/gridChartTemplate.html',
            restrict: 'E',
            scope: {
                data: '=',
                icons: '=', // indicates whether cell-text is entirely made up of icons
                scale: '=', // multiplier to increase cell size
                reveal: '=', // if true, less data will show when zoomed out
                mode: '@', // valid values are zoom or tooltip
                columns: '=',
                rows: '=',
                showAxes: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisJobLoadController', ['$scope', 'scaleConfig', 'scaleService', 'loadService', function ($scope, scaleConfig, scaleService, loadService) {
        var chart = null,
            colArr = [],
            xArr = [],
            pendingArr = [],
            queuedArr = [],
            runningArr = [],
            removeIds = [],
            legendHide = [];

        $scope.filterValue = 1;
        $scope.filterDuration = 'w';
        $scope.filterDurations = ['M', 'w', 'd'];
        $scope.zoomEnabled = false;
        $scope.zoomClass = 'btn-default';
        $scope.zoomText = 'Enable Zoom';
        $scope.jobLoadData = {};
        $scope.loadingJobLoad = true;
        $scope.jobLoadError = null;
        $scope.jobLoadErrorStatus = null;
        $scope.total = 0;
        $scope.chartStyle = '';

        var jobLoadParams = {
            started: moment.utc().subtract($scope.filterValue, $scope.filterDuration).startOf('d').toDate(), ended: moment.utc().endOf('d').toDate(), job_type_id: null, job_type_name: null, job_type_category: null, url: null
        };

        $scope.toggleZoom = function () {
            $scope.zoomEnabled = !$scope.zoomEnabled;
            chart.zoom.enable($scope.zoomEnabled);
            if ($scope.zoomEnabled) {
                $scope.zoomClass = 'btn-primary';
                $scope.zoomText = 'Disable Zoom';
            } else {
                $scope.zoomClass = 'btn-default';
                $scope.zoomText = 'Enable Zoom';
            }
        };

        var initChart = function () {
            colArr = [];
            xArr = [];
            pendingArr = [];
            queuedArr = [];
            runningArr = [];

            /*
            // x axis values
            var numHours = moment.utc(jobLoadParams.ended).diff(moment.utc(jobLoadParams.started), 'h');
            for (var i = 0; i < numHours; i++) {
                xArr.push(moment.utc(jobLoadParams.started).add(i, 'h').startOf('h').toDate());
            }

            // data values
            _.forEach(xArr, function (xDate) {
                var dataObj = _.find($scope.jobLoadData.results, function (d) {
                    return moment.utc(d.time).startOf('h').isSame(xDate, 'hour');
                });
                // push 0 if data for xDate is not present in queryDates
                pendingArr.push(dataObj ? dataObj.pending_count : 0);
                queuedArr.push(dataObj ? dataObj.queued_count : 0);
                runningArr.push(dataObj ? dataObj.running_count : 0);
            });

            xArr.unshift('x');
            pendingArr.unshift('Pending');
            queuedArr.unshift('Queued');
            runningArr.unshift('Running');
            */

            xArr = _.pluck($scope.jobLoadData.results, 'time');
            _.forEach(xArr, function (d, i) {
                xArr[i] = moment.utc(d).toDate();
            });
            xArr.unshift('x');

            var pendingArr = _.pluck($scope.jobLoadData.results, 'pending_count'),
                queuedArr = _.pluck($scope.jobLoadData.results, 'queued_count'),
                runningArr = _.pluck($scope.jobLoadData.results, 'running_count');

            pendingArr.unshift('Pending');
            queuedArr.unshift('Queued');
            runningArr.unshift('Running');

            // add to colArr
            colArr = [xArr, pendingArr, queuedArr, runningArr];

            var types = {},
                type = {},
                groups = [];

            _.forEach(colArr, function(col){
                    type = {};
                    if (col[0] !== 'x') {
                        type[col[0]] = 'area';
                        groups.push(col[0]);
                    }
                angular.extend(types, type);
            });

            //if (chart) {
                /*
                chart.groups([groups]);
                chart.load({
                    columns: colArr,
                    types: types,
                });
                */
                /*
                chart.flow({
                    columns: colArr
                });
                */
            //} else {
            if (chart) {
                chart.flush();
            }
                // chart config
                chart = c3.generate({
                    bindto: '#job-load',
                    data: {
                        x: 'x',
                        columns: colArr,
                        types: types,
                        groups: [groups],
                        colors: {
                            Pending: scaleConfig.colors.chart_pink,
                            Queued: scaleConfig.colors.chart_purple,
                            Running: scaleConfig.colors.chart_blue
                        }
                    },
                    transition: {
                        duration: 700
                    },
                    tooltip: {
                        format: {
                            title: function (x) {
                                return moment.utc(x).startOf('h').format(scaleConfig.dateFormats.day_second);
                            }
                        }
                    },
                    axis: {
                        x: {
                            type: 'timeseries',
                            tick: {
                                format: function (d) {
                                    return moment.utc(d).format(scaleConfig.dateFormats.day);
                                }
                            }
                        }
                    }
                });
            //}
            $scope.loadingJobLoad = false;
        };

        var getJobLoad = function (showPageLoad) {
            if (showPageLoad) {
                $scope.$parent.loading = true;
            } else {
                $scope.loadingJobLoad = true;
            }
            jobLoadParams.started = moment.utc().subtract($scope.filterValue, $scope.filterDuration).startOf('d').toDate();
            jobLoadParams.ended = moment.utc(jobLoadParams.started).add(1, $scope.filterDuration).endOf('d').toDate();
            jobLoadParams.page_size = 1000;

            loadService.getJobLoad(jobLoadParams).then(null, null, function (result) {
                if (result.$resolved) {
                    $scope.jobLoadData = result;
                    initChart();
                } else {
                    if (result.statusText && result.statusText !== '') {
                        $scope.jobLoadErrorStatus = result.statusText;
                    }
                    $scope.jobLoadError = 'Unable to retrieve job load.';
                }
                if (showPageLoad) {
                    $scope.$parent.loading = false;
                } else {
                    $scope.loadingJobLoad = false;
                }
            });
        };

        $scope.updateJobLoadRange = function (action) {
            if (action === 'older') {
                $scope.filterValue++;
            } else if (action === 'newer') {
                if ($scope.filterValue > 1) {
                    $scope.filterValue--;
                }
            } else if (action === 'today') {
                $scope.filterValue = 1;
            }
            getJobLoad(true);
        };

        $scope.$watch('filterValue', function (value) {
            var $jobLoadNewer = $('.job-load-newer'),
                $jobLoadToday = $('.job-load-today');

            if (value > 1) {
                $jobLoadNewer.removeAttr('disabled');
                $jobLoadToday.removeAttr('disabled');
            } else {
                $jobLoadNewer.attr('disabled', 'disabled');
                $jobLoadToday.attr('disabled', 'disabled');
            }
        });


        if ($scope.autoHeight) {
            // set chart height
            angular.element(document).ready(function () {
                // set container heights equal to available page height
                var viewport = scaleService.getViewportSize(),
                    offset = scaleConfig.headerOffset,
                    headerOffset = $('.job-load-header').height(),
                    legendOffset = $('.job-load-legend-label').height(),
                    filterOffset = $('.job-load-filter').outerHeight(true),
                    chartMaxHeight = viewport.height - offset - headerOffset - legendOffset - filterOffset - 5;

                $scope.chartStyle = 'height: ' + chartMaxHeight + 'px; max-height: ' + chartMaxHeight + 'px;';
                getJobLoad();
            });
        } else {
            getJobLoad();
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisJobLoad', function () {
        return {
            controller: 'aisJobLoadController',
            templateUrl: 'modules/charts/jobLoad/jobLoadTemplate.html',
            restrict: 'E',
            scope: {
                showFilter: '=', // show time range filter UI
                cullLegend: '=', // only show job types in legend whose value is > 0
                hideTitle: '=',
                autoHeight: '='
            }
        };
    });
})();

'use strict';

angular.module('scaleApp').controller('aisRadialPercentageController', ['$scope', '$element', 'scaleConfig', function($scope, $element, scaleConfig) {
    var isInitialized = false,
        foreground = '',
        text = '',
        arcTween = '',
        textTween = '';

    var getForeground = function () {
        var value = parseFloat($scope.percentage);
        if (value >= 75) {
            return scaleConfig.colors.chart_green;
        } else if (value < 75 && value >= 50) {
            return scaleConfig.colors.chart_yellow;
        } else {
            return scaleConfig.colors.chart_red;
        }
    };

    var initialize = function() {
        // handle input either .83 or 83
        var percentage = $scope.percentage || 0;
        if (percentage > 1) {
            percentage /= 100;
        }

        // size the chart to the parent container. It's square, so take the
        // smaller of width/height
        var size = $element[0].parentNode.clientWidth;
        if ($element[0].parentNode.clientHeight < size) {
            size = $element[0].parentNode.clientHeight;
        }


        var duration = 1000;
        var formatPercent = d3.format('.0%');

        var arc = d3.svg.arc()
            .startAngle(0)
            .outerRadius(size * 0.95 / 2)
            .innerRadius(size * 0.80 / 2);

        var svg = d3.select($element[0]).append('svg').attr({
            width: size,
            height: size
        }).append('g').attr({
            'transform': 'translate(' + size / 2 + ',' + size / 2 + ')',
            'class': 'aisRadial'
        });

        var meter = svg.append('g').attr({
            'transform': 'rotate(180)'
        });
        meter.append('path')
            .datum({
                endAngle: (2 * Math.PI),
            })
            .attr('class', 'background')
            .attr('d', arc);

        foreground = meter.append('path')
            .datum({
                endAngle: 0
            })
            .attr({
                'd': arc
            })
            .style('fill', function () {
                return getForeground();
            });

        text = svg.append('text')
            .datum({
                percentage: 0
            })
            .attr('text-anchor', 'middle')
            .attr('dy', '.35em');


        textTween = function(transition, newPercentage) {
            transition.attrTween('text', function(d) {
                if (typeof d === 'undefined') {
                    d = 0;
                }
                var i = d3.interpolate(d.percentage, newPercentage);
                return function(t) {
                    d.percentage = i(t);
                    text.text(formatPercent(i(t)));
                    return t;
                }
            });
        };
        arcTween = function(transition, newAngle) {
            transition.attrTween('d', function(d) {
                var i = d3.interpolate(d.endAngle, newAngle);
                return function(t) {
                    d.endAngle = i(t);
                    return arc(d);
                };
            });
        };

        isInitialized = true;

        redraw(percentage);

        // get progress...

        //foreground.attr('d', arc.endAngle((Math.PI * 2) * 0.83));
        //text.text(formatPercent(percentage));
    };

    var redraw = function (value) {
        if (isInitialized) {
            var percentage = value;
            if (percentage > 1) {
                percentage /= 100;
            }
            //console.log('Setting percentage to: ' + percentage);

            //foreground.transition().duration(5000).attr('d', arc);
            foreground.transition().duration(1000)
                .style('fill', function () {
                    return getForeground();
                })
                .call(arcTween, (Math.PI * 2) * percentage);
            //text.text(formatPercent(percentage));
            text.transition().duration(1000).call(textTween, percentage);
        }
    };

    $scope.$watch('percentage', function(value) {
        if (value && !isInitialized) {
            initialize();
        } else {
            redraw(value);
        }
    })
}]);

'use strict';

angular.module('scaleApp').directive('aisRadialPercentage', function () {
    return {
        controller: 'aisRadialPercentageController',
        restrict: 'E',
        scope: {
            percentage: '@'
        }
    };
});

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisTimelineDirectiveController', ['$scope', '$element', 'scaleConfig', function ($scope, $element, scaleConfig) {

        var gantt = null;

        $element[0].onresize = function(){
            console.log('element resize');
        };

        var initialize = function() {
            $scope.$watch('tasks', function (value) {
                drawTimeline();
            });
        };

        var drawTimeline = function(){
            if($scope.tasks && $scope.tasks.length > 0){
                $scope.tasks.sort(function(a, b) {
                    return a[$scope.ended] - b[$scope.ended];
                });

                $scope.taskNames = _($scope.tasks).pluck('taskName').uniq().value();
                var height = $scope.taskNames.length * 30 + 20;

                var width = $element[0].clientWidth;
                if (!width || width === 0) { width = 600; }


                $scope.tasks.sort(function(a, b) {
                    return a[$scope.started] - b[$scope.started];
                });
                var minDate = $scope.tasks[0][$scope.started];
                var maxDate = $scope.tasks[$scope.tasks.length - 1][$scope.ended];
                var daysDiff = moment.utc(maxDate).diff(moment.utc(minDate),'days');
                var format = '%H:%M:%S.%m';
                if(daysDiff > 0){
                    format = "%m/%d/%y %H:%M";
                }

                gantt = d3.gantt().renderTo("#ais-timeline").taskTypes($scope.taskNames).taskStatus(scaleConfig.taskStatusStyles).tickFormat(format).begin($scope.started).ended($scope.ended).height(height).width(width);

                gantt.timeDomainMode("fit");

                gantt($scope.tasks);

            }
        };

        function getend() {
            var lastend = Date.now();
            if ($scope.tasks.length > 0) {
                lastend = $scope.tasks[$scope.tasks.length - 1][$scope.ended];
            }

            return lastend;
        };

        $scope.formatDate = function(date){
            if(date){
                return moment.utc(date).toISOString();
            }
            else {
                return date;
            }
        };
        initialize();

    }]).directive('aisTimeline', function () {
        return {
            controller: 'aisTimelineDirectiveController',
            templateUrl: 'modules/charts/timeline/timelineDirectiveTemplate.html',
            restrict: 'E',
            scope: {
                tasks: '=',
                started: '=',
                ended: '='
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').directive('aisMultiselect', function () {
        return {
            restrict: 'A',
            require: '^ngModel',
            scope: {
                multiselectDataProvider: '=',
                enableFiltering: '=',
                maxHeight: '=',
                numberDisplayed: '=',
                includeSelectAllOption: '=',
                nonSelectedText: '=',
                ngModel: '='
            },
            link: function(scope, element, attributes) {
                element = $(element[0]);

                element.multiselect({
                    enableFiltering: scope.enableFiltering,
                    enableCaseInsensitiveFiltering: true,
                    maxHeight: scope.maxHeight || 300,
                    numberDisplayed: scope.numberDisplayed || 3,
                    includeSelectAllOption: scope.includeSelectAllOption,
                    nonSelectedText: scope.nonSelectedText || 'None Selected',
                    onChange: function (optionElement, checked) {
                        scope.$apply(function () {
                            scope.ngModel = element.val();
                        });
                    }
                });

                scope.$watchCollection('multiselectDataProvider', function (newValue, oldValue) {
                    if (angular.equals(newValue, oldValue)) {
                        return;
                    }
                    element.multiselect('dataprovider', newValue);
                });

                /*
                // Watch for any changes to the length of our select element
                scope.$watch(function () {
                    return element[0];
                }, function (newValue) {
                    debugger;
                    //element.multiselect('setOptions', element[0]);
                    //element.multiselect('rebuild');
                }, true);

                // Watch for any changes from outside the directive and refresh
                scope.$watch(attributes.ngModel, function () {
                    element.multiselect('refresh');
                });
                */
            }
        };
    })
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('gaugeFactory', ['scaleConfig', function (scaleConfig) {
        var Gauge = function (placeholderName, configuration)
        {
            this.placeholderName = placeholderName;

            var self = this; // for internal d3 functions

            this.configure = function(configuration)
            {
                this.config = configuration;

                this.config.size = this.config.size * 0.9;

                this.config.radius = this.config.size * 0.97 / 2;
                this.config.cx = this.config.size / 2;
                this.config.cy = this.config.size / 2;

                this.config.min = undefined != configuration.min ? configuration.min : 0;
                this.config.max = undefined != configuration.max ? configuration.max : 100;
                this.config.range = this.config.max - this.config.min;

                this.config.majorTicks = configuration.majorTicks || 5;
                this.config.minorTicks = configuration.minorTicks || 2;

                this.config.greenColor 	= configuration.greenColor || '#8fca0e';
                this.config.yellowColor = configuration.yellowColor || '#ffc317';
                this.config.redColor 	= configuration.redColor || '#f54d36';

                this.config.transitionDuration = configuration.transitionDuration || 500;
            };

            this.render = function()
            {
                this.body = d3.select('#' + this.placeholderName)
                    .append('svg:svg')
                    .attr('class', 'gauge')
                    .attr('width', this.config.size)
                    .attr('height', this.config.size);

                this.body.append('svg:circle')
                    .attr('class', 'outer-circle')
                    .attr('cx', this.config.cx)
                    .attr('cy', this.config.cy)
                    .attr('r', this.config.radius)
                    .style('fill', '#ccc');
                /*.style('stroke', '#000')
                 .style('stroke-width', '0.5px');*/

                this.body.append('svg:circle')
                    .attr('cx', this.config.cx)
                    .attr('cy', this.config.cy)
                    .attr('r', 0.9 * this.config.radius)
                    .style('fill', '#fff')
                    .style('stroke', '#e0e0e0')
                    .style('stroke-width', '2px');

                for (var greenIdx in this.config.greenZones)
                {
                    this.drawBand(this.config.greenZones[greenIdx].from, this.config.greenZones[greenIdx].to, self.config.greenColor);
                }

                for (var yellowIdx in this.config.yellowZones)
                {
                    this.drawBand(this.config.yellowZones[yellowIdx].from, this.config.yellowZones[yellowIdx].to, self.config.yellowColor);
                }

                for (var redIdx in this.config.redZones)
                {
                    this.drawBand(this.config.redZones[redIdx].from, this.config.redZones[redIdx].to, self.config.redColor);
                }

                var fontSize = 0;

                if (undefined != this.config.label)
                {
                    fontSize = Math.round(this.config.size / 9);
                    this.body.append('svg:text')
                        .attr('x', this.config.cx)
                        .attr('y', this.config.cy / 2 + fontSize / 2)
                        .attr('dy', fontSize / 2)
                        .attr('text-anchor', 'middle')
                        .text(this.config.label)
                        .style('font-size', fontSize + 'px')
                        .style('fill', '#333')
                        .style('stroke-width', '0px');
                }

                fontSize = Math.round(this.config.size / 16);
                var majorDelta = this.config.range / (this.config.majorTicks - 1);
                for (var major = this.config.min; major <= this.config.max; major += majorDelta)
                {
                    var minorDelta = majorDelta / this.config.minorTicks,
                        point1 = 0,
                        point2 = 0;
                    for (var minor = major + minorDelta; minor < Math.min(major + majorDelta, this.config.max); minor += minorDelta)
                    {
                        point1 = this.valueToPoint(minor, 0.75);
                        point2 = this.valueToPoint(minor, 0.85);

                        this.body.append('svg:line')
                            .attr('x1', point1.x)
                            .attr('y1', point1.y)
                            .attr('x2', point2.x)
                            .attr('y2', point2.y)
                            .style('stroke', '#666')
                            .style('stroke-width', '1px');
                    }

                    point1 = this.valueToPoint(major, 0.7);
                    point2 = this.valueToPoint(major, 0.85);

                    this.body.append('svg:line')
                        .attr('x1', point1.x)
                        .attr('y1', point1.y)
                        .attr('x2', point2.x)
                        .attr('y2', point2.y)
                        .style('stroke', '#333')
                        .style('stroke-width', '2px');

                    if (major == this.config.min || major == this.config.max)
                    {
                        var point = this.valueToPoint(major, 0.63);

                        this.body.append('svg:text')
                            .attr('x', point.x)
                            .attr('y', point.y)
                            .attr('dy', fontSize / 3)
                            .attr('text-anchor', major == this.config.min ? 'start' : 'end')
                            .text(major)
                            .style('font-size', fontSize + 'px')
                            .style('fill', '#333')
                            .style('stroke-width', '0px');
                    }
                }

                var pointerContainer = this.body.append('svg:g').attr('class', 'pointerContainer');

                var midValue = (this.config.min + this.config.max) / 2;

                var pointerPath = this.buildPointerPath(midValue);

                var pointerLine = d3.svg.line()
                    .x(function(d) { return d.x })
                    .y(function(d) { return d.y })
                    .interpolate('basis');

                pointerContainer.selectAll('path')
                    .data([pointerPath])
                    .enter()
                    .append('svg:path')
                    .attr('d', pointerLine)
                    .style('fill', '#888');

                pointerContainer.append('svg:circle')
                    .attr('cx', this.config.cx)
                    .attr('cy', this.config.cy)
                    .attr('r', 0.07 * this.config.radius)
                    .style('fill', '#888');

                fontSize = Math.round(this.config.size / 10);
                pointerContainer.selectAll('text')
                    .data([midValue])
                    .enter()
                    .append('svg:text')
                    .attr('x', this.config.cx)
                    .attr('y', this.config.size - this.config.cy / 4 - fontSize)
                    .attr('dy', fontSize / 2)
                    .attr('text-anchor', 'middle')
                    .style('font-size', fontSize + 'px')
                    .style('fill', '#000')
                    .style('stroke-width', '0px');

                this.redraw(this.config.min, 0);
            };

            this.buildPointerPath = function(value)
            {
                var delta = this.config.range / 13;

                var head = valueToPoint(value, 0.85);
                var head1 = valueToPoint(value - delta, 0.12);
                var head2 = valueToPoint(value + delta, 0.12);

                var tailValue = value - (this.config.range * (1/(270/360)) / 2);
                var tail = valueToPoint(tailValue, 0.28);
                var tail1 = valueToPoint(tailValue - delta, 0.12);
                var tail2 = valueToPoint(tailValue + delta, 0.12);

                return [head, head1, tail2, tail, tail1, head2, head];

                function valueToPoint(value, factor)
                {
                    var point = self.valueToPoint(value, factor);
                    point.x -= self.config.cx;
                    point.y -= self.config.cy;
                    return point;
                }
            };

            this.drawBand = function(start, end, color)
            {
                if (0 >= end - start) return;

                this.body.append('svg:path')
                    .style('fill', color)
                    .attr('d', d3.svg.arc()
                        .startAngle(this.valueToRadians(start))
                        .endAngle(this.valueToRadians(end))
                        .innerRadius(0.65 * this.config.radius)
                        .outerRadius(0.85 * this.config.radius))
                    .attr('transform', function() { return 'translate(' + self.config.cx + ', ' + self.config.cy + ') rotate(270)' });
            };

            this.redraw = function(value, transitionDuration)
            {
                var pointerContainer = this.body.select('.pointerContainer');

                pointerContainer.selectAll('text').text(parseFloat(value).toFixed(2) + '%');

                var pointer = pointerContainer.selectAll('path');
                pointer.transition()
                    .duration(undefined != transitionDuration ? transitionDuration : this.config.transitionDuration)
                    //.delay(0)
                    //.ease('linear')
                    //.attr('transform', function(d)
                    .attrTween('transform', function()
                    {
                        var pointerValue = value;
                        if (value > self.config.max) pointerValue = self.config.max + 0.02*self.config.range;
                        else if (value < self.config.min) pointerValue = self.config.min - 0.02*self.config.range;
                        var targetRotation = (self.valueToDegrees(pointerValue) - 90);
                        var currentRotation = self._currentRotation || targetRotation;
                        self._currentRotation = targetRotation;

                        return function(step)
                        {
                            var rotation = currentRotation + (targetRotation-currentRotation)*step;
                            return 'translate(' + self.config.cx + ', ' + self.config.cy + ') rotate(' + rotation + ')';
                        }
                    });

                var outerCircle = this.body.select('.outer-circle')
                    .transition()
                    .duration(750)
                    .style('fill', function () {
                        var i = parseInt(value);
                        if (i >= 0 && i < 75) {
                            return self.config.greenColor;
                        } else if (i >= 75 && i < 90) {
                            return self.config.yellowColor;
                        } else {
                            return self.config.redColor;
                        }
                    });
            };

            this.valueToDegrees = function(value)
            {
                // thanks @closealert
                //return value / this.config.range * 270 - 45;
                return value / this.config.range * 270 - (this.config.min / this.config.range * 270 + 45);
            };

            this.valueToRadians = function(value)
            {
                return this.valueToDegrees(value) * Math.PI / 180;
            };

            this.valueToPoint = function(value, factor)
            {
                return { 	x: this.config.cx - this.config.radius * factor * Math.cos(this.valueToRadians(value)),
                    y: this.config.cy - this.config.radius * factor * Math.sin(this.valueToRadians(value)) 		};
            };

            // initialization
            this.configure(configuration);
        };

        return {
            createGauge: function (name, label, min, max, size) {
                var config = {
                    size: size || scaleConfig.defaultGaugeWidth,
                    label: label,
                    min: min || 0,
                    max: max || 100,
                    minorTicks: 5
                };

                var range = config.max - config.min;
                config.yellowZones = [{ from: config.min + range*0.75, to: config.min + range*0.9 }];
                config.redZones = [{ from: config.min + range*0.9, to: config.max }];

                var gauge = new Gauge(name + 'GaugeContainer', config);
                gauge.render();
                return gauge;
            }
        }
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('gridFactory', ['uiGridConstants', function (uiGridConstants) {

        var getSortConfig = function(orderParam){
            if(orderParam){
                var sortField = orderParam
                var sortDirection = 'asc';
                if(_.startsWith(orderParam, '-')){
                    sortDirection = 'desc';
                    sortField = sortField[0].length === 1 ? sortField.substring(1) : sortField[0].substring(1);
                }
                return {
                    direction: sortDirection,
                    field: sortField
                };
            }
            return {};
        };

        return {
            defaultGridOptions: function () {
                return {
                    enableRowSelection: true,
                    enableRowHeaderSelection: false,
                    enableHorizontalScrollbar: uiGridConstants.scrollbars.NEVER,
                    multiSelect: false,
                    enableFiltering: true,
                    useExternalSorting: true,
                    useExternalFiltering: true,
                    enableSorting: true,
                    minRowsToShow: 17,
                    paginationPageSizes: [25, 50, 75, 100],
                    paginationPageSize: 25,
                    useExternalPagination: true
                }
            },
            applySortConfig: function(columnDefs, gridParams){
                var sortConfig = getSortConfig(gridParams.order);
                if(sortConfig.field){
                    var colDef = _.find(columnDefs, {field: sortConfig.field});
                    if(colDef){
                        colDef.sort = {
                            direction: sortConfig.direction,
                            priority: 1
                        }
                    }
                }
                return columnDefs;
            }
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('pollerFactory', ['poller', function (poller) {
        return {
            newPoller: function (resource, interval) {
                return poller.get(resource, {
                    delay: interval,
                    catchError: true
                });
            }
        }
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('Status', ['StatusMaster', 'StatusScheduler', 'StatusResources', function (StatusMaster, StatusScheduler, StatusResources) {
        var Status = function ($resolved, master, scheduler, queue_depth, resources) {
            this.$resolved = $resolved;
            this.master = StatusMaster.transformer(master);
            this.scheduler = StatusScheduler.transformer(scheduler);
            this.queue_depth = queue_depth;
            this.resources = StatusResources.transformer(resources);
        };

        // public methods
        Status.prototype = {
            getCpuUsage: function () {
                if (this.resources.scheduled.cpus && this.resources.total.cpus) {
                    if (this.resources.total.cpus > 0) {
                        return ((this.resources.scheduled.cpus / this.resources.total.cpus) * 100).toFixed(2);
                    }
                }
                return 0.00;
            },
            getMemUsage: function () {
                if (this.resources.scheduled.mem && this.resources.total.mem) {
                    if (this.resources.total.mem > 0) {
                        return ((this.resources.scheduled.mem / this.resources.total.mem) * 100).toFixed(2);
                    }
                }
                return 0.00;
            },
            getDiskUsage: function () {
                if (this.resources.scheduled.disk && this.resources.total.disk) {
                    if (this.resources.total.disk > 0) {
                        return ((this.resources.scheduled.disk / this.resources.total.disk) * 100).toFixed(2);
                    }
                }
                return 0.00;
            }
        };

        // static methods, assigned to class
        Status.build = function (data) {
            if (data) {
                return new Status(
                    data.$resolved,
                    data.master,
                    data.scheduler,
                    data.queue_depth,
                    data.resources
                );
            }
            return new Status();
        };

        Status.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Status.build)
                    .filter(Boolean);
            }
            return Status.build(data);
        };

        return Status;
    }]);
})();
(function () {
    'use strict';
    
    angular.module('scaleApp').factory('StatusMaster', function () {
        var StatusMaster = function (is_online, hostname, port) {
            this.is_online = is_online;
            this.hostname = hostname;
            this.port = port;
        };

        // public methods
        StatusMaster.prototype = {

        };

        // static methods, assigned to class
        StatusMaster.build = function (data) {
            if (data) {
                return new StatusMaster(
                    data.is_online,
                    data.hostname,
                    data.port
                );
            }
            return new StatusMaster();
        };

        StatusMaster.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusMaster.build)
                    .filter(Boolean);
            }
            return StatusMaster.build(data);
        };

        return StatusMaster;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('StatusResource', function () {
        var StatusResource = function (cpus, mem, disk) {
            this.cpus = cpus;
            this.mem = mem;
            this.disk = disk;
        };

        // public methods
        StatusResource.prototype = {

        };

        // static methods, assigned to class
        StatusResource.build = function (data) {
            if (data) {
                return new StatusResource(
                    data.cpus,
                    data.mem,
                    data.disk
                );
            }
            return new StatusResource();
        };

        StatusResource.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusResource.build)
                    .filter(Boolean);
            }
            return StatusResource.build(data);
        };

        return StatusResource;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('StatusResources', ['StatusResource', function (StatusResource) {
        var StatusResources = function (total, scheduled, used) {
            this.total = StatusResource.transformer(total);
            this.scheduled = StatusResource.transformer(scheduled);
            this.used = StatusResource.transformer(used);
        };

        // public methods
        StatusResources.prototype = {

        };

        // static methods, assigned to class
        StatusResources.build = function (data) {
            if (data) {
                return new StatusResources(
                    data.total,
                    data.scheduled,
                    data.used
                );
            }
            return new StatusResources();
        };

        StatusResources.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusResources.build)
                    .filter(Boolean);
            }
            return StatusResources.build(data);
        };

        return StatusResources;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('StatusScheduler', function () {
        var StatusScheduler = function (is_online, is_paused, hostname) {
            this.is_online = is_online;
            this.is_paused = is_paused;
            this.hostname = hostname;
        };

        // public methods
        StatusScheduler.prototype = {

        };

        // static methods, assigned to class
        StatusScheduler.build = function (data) {
            if (data) {
                return new StatusScheduler(
                    data.is_online,
                    data.is_paused,
                    data.hostname
                );
            }
            return new StatusScheduler();
        };

        StatusScheduler.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(StatusScheduler.build)
                    .filter(Boolean);
            }
            return StatusScheduler.build(data);
        };

        return StatusScheduler;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').service('scaleService', ['scaleConfig', function (scaleConfig) {
        function padWithZero (input, length) {
            // Cast input to string
            input = '' + input;

            var paddingSize = Math.max(0, length - input.length);
            return new Array(paddingSize > 0 ? paddingSize + 1 : 0).join('0') + input;
        }

        return {
            calculateFileSizeFromMib: function(num){
                if (num > 0) {
                    if (num < 1024) {
                        return num.toFixed(2) + ' MB';
                    }
                    if (num >= 1024 && num < 1024*1024) {
                        return (num/1024).toFixed(2) + ' GB';
                    }
                    return (num/1024/1024).toFixed(2) + ' TB';
                }
                return num;
            },
            calculateFileSizeFromBytes: function(num,decimals){
                // if(precision){
                //     // round num to specified precision
                //     num = Math.round(num/precision);
                // }
                if (num > 0) {
                    if (num < 1024) {
                        return num.toFixed(decimals) + ' Bytes';
                    }
                    if (num >= 1024 && num < 1024*1024) {
                        return (num/1024).toFixed(decimals) + ' KB';
                    }
                    if (num >= 1024*1024 && num < 1024*1024*1024) {
                        return (num/1024/1024).toFixed(decimals) + ' MB';
                    }
                    if (num >= 1024*1024*1024 && num < 1024*1024*1024*1024) {
                        return (num/1024/1024/1024).toFixed(decimals) + ' GB';
                    }
                    return (num/1024/1024/1024/1024).toFixed(decimals) + ' TB';
                }
                return num;
            },
            getViewportSize: function () {
                var w = window,
                    d = document,
                    e = d.documentElement,
                    g = document.body,
                    x = w.innerWidth || e.clientWidth || g.clientWidth,
                    y = w.innerHeight || e.clientHeight || g.clientHeight;

                return {
                    width: x,
                    height: y
                };
            },
            calculateDuration: function (start, stop) {
                var to = moment.utc(stop),
                    from = moment.utc(start),
                    diff = moment.utc(to).diff(moment.utc(from));

                var duration = moment.duration(diff);

                return padWithZero(duration.days(), 2) + 'd, ' + padWithZero(duration.hours(), 2) + 'h, ' + padWithZero(duration.minutes(), 2) + 'm, ' + padWithZero(duration.seconds(), 2) + 's';
            },
            getDayString: function(dayNumber){
                var dayArr = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
                return dayArr[dayNumber];
            },
            isIE: function () {
                var ua = window.navigator.userAgent,
                    oldIE = ua.indexOf('MSIE'),
                    newIE = ua.indexOf('Trident/');

                if ((oldIE > -1) || (newIE > -1)) {
                    return true;
                }
                return false;
            }
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('schedulerService', ['$http', '$q', 'scaleConfig', function ($http, $q, scaleConfig) {
        var getUpdateSchedulerData = function (is_paused) {
            return {
                is_paused: is_paused
            };
        };

        return {
            updateScheduler: function (data) {
                data = data || getUpdateSchedulerData();
                var d = $q.defer();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'scheduler/',
                    method: 'PATCH',
                    data: data
                }).success(function (result) {
                    d.resolve(result);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('statusService', ['$resource', 'scaleConfig', 'poller', 'pollerFactory', 'Status', function ($resource, scaleConfig, poller, pollerFactory, Status) {
        return {
            getStatus: function () {
                var statusResource = $resource(scaleConfig.urls.apiPrefix + 'status/'),
                    statusPoller = pollerFactory.newPoller(statusResource, scaleConfig.pollIntervals.status);

                return statusPoller.promise.then(null, null, function (result) {
                    if (result.$resolved) {
                        result = Status.transformer(result);
                        //result = angular.extend(result, returnResult);
                    } else {
                        statusPoller.stop();
                    }
                    return result;
                });
            }
        }
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').service('userService', ['$rootScope', function ($rootScope) {
        return {
            getUserCreds: function(){
                var creds = localStorage.getItem('userCreds');
                try {
                    return JSON.parse(creds);
                } catch (e) {
                    console.log('Error parsing user credentials');
                    return creds;
                }
            },
            setUserCreds: function(user){
                if (user !== null) {
                    localStorage.setItem('userCreds', JSON.stringify(user));
                } else {
                    $rootScope.user = null;
                    localStorage.removeItem('userCreds');
                }

            },
            login: function (username) {
                var user = {
                    username: username,
                    is_admin: true
                };
                this.setUserCreds(user);
                return user;
            },
            logout: function() {
                this.setUserCreds(null);
            }
        }
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('feedDetailsController', ['$scope', '$location', 'scaleConfig', 'navService', 'subnavService', 'feedService', 'moment', function($scope, $location, scaleConfig, navService, subnavService, feedService, moment) {
        $scope.loading = true;
        $scope.feedData = {};
        $scope.subnavLinks = scaleConfig.subnavLinks.feed;
        $scope.useIngestTime = 'false';
        $scope.filterValue = 1;
        $scope.filterDuration = 'w';

        $scope.changeFeedSelection = function(){
            setFeedUrl();
            //getFeed();
        };

        $scope.changeIngestTimeSelection = function(){
            setFeedUrl();
            getFeed();
        };

        var getFeedParams = function(){
            var params = {};
            var strikeId = $scope.selectedFeed ? $scope.selectedFeed.strike.id : null;
            var useIngestTime = $scope.useIngestTime ? $scope.useIngestTime : null;

            params.started = moment.utc().subtract($scope.filterValue, $scope.filterDuration).startOf('d').toISOString();
            params.ended = moment.utc(params.started).add(1, $scope.filterDuration).endOf('d').toISOString();

            if (strikeId != $location.search().strike_id) {
                params.strike_id = strikeId;
            } else if ($location.search().strike_id) {
                params.strike_id = $location.search().strike_id;
            }

            if (useIngestTime != $location.search().use_ingest_time) {
               params.use_ingest_time = useIngestTime;
            } else if ($location.search().use_ingest_time) {
               console.log('getFeedParams use_ingest_time: ' + $location.search().use_ingest_time);
               params.use_ingest_time = $location.search().use_ingest_time;
            }

            return params;
        };

        var getFeed = function () {
            $scope.loading = true;
            if ($location.search().use_ingest_time) {
                $scope.useIngestTime = $location.search().use_ingest_time;
            }
            var feedParams = getFeedParams();
            $location.search(feedParams);
            feedService.getFeed(feedParams).then(function (data) {
                $scope.allFeeds = _.sortByOrder(data.results, ['strike.name'], ['asc']);
                var strikeId = $location.search().strike_id;
                if(strikeId){
                    // set selectedFeed = new feed
                    var feed = _.find($scope.allFeeds, function(feed){
                        return feed.strike.id == strikeId;
                    });
                    $scope.selectedFeed = feed ? feed : null;
                } else {
                    $scope.selectedFeed = $scope.allFeeds[0];
                    setFeedUrl();
                }
            }).finally(function(){
                $scope.loading = false;
            });
        };

        $scope.updateFeedRange = function (action) {
            if (action === 'older') {
                $scope.filterValue++;
            } else if (action === 'newer') {
                if ($scope.filterValue > 1) {
                    $scope.filterValue--;
                }
            } else if (action === 'today') {
                $scope.filterValue = 1;
            }
            getFeed();
        };

        var setFeedUrl = function(){
            // set param in URL
            var params = getFeedParams();
            $location.search(params);
        };

        var initialize = function () {
            navService.updateLocation('feed');
            subnavService.setCurrentPath('feed');
            getFeed();
        };

        initialize();

        $scope.$watch('filterValue', function (value) {
            var $feedNewer = $('.feed-newer'),
                $feedToday = $('.feed-today');

            if (value > 1) {
                $feedNewer.removeAttr('disabled');
                $feedToday.removeAttr('disabled');
            } else {
                $feedNewer.attr('disabled', 'disabled');
                $feedToday.attr('disabled', 'disabled');
            }
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('ingestRecordsController', ['$scope', '$rootScope', '$location', 'scaleConfig', 'scaleService', 'gridFactory', 'navService', 'subnavService', 'feedService', function($scope, $rootScope, $location, scaleConfig, scaleService, gridFactory, navService, subnavService, feedService) {
        $scope.subnavLinks = scaleConfig.subnavLinks.feed;

        var gridParams = {
            page: 1, page_size: 25, started: null, ended: null, order: '-transfer_started', status: null
        };

        // check for gridParams in query string, and update as necessary
        _.forEach(_.pairs(gridParams), function (param) {
            var value = _.at($location.search(), param[0]);
            if (value.length > 0) {
                gridParams[param[0]] = value.length > 1 ? value : value[0];
            }
        });

        var filteredByStatus = gridParams.status ? true : false;
        var filteredByOrder = gridParams.order ? true : false;
        $scope.lastModifiedStart = gridParams.started ? moment.utc(gridParams.started).toDate() : moment.utc().subtract(1, 'weeks').startOf('d').toDate();

        $scope.lastModifiedStartPopup = {
            opened: false
        };
        $scope.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            $scope.lastModifiedStartPopup.opened = true;
        };
        $scope.lastModifiedStop = gridParams.ended ? moment.utc(gridParams.ended).toDate() : moment.utc().endOf('d').toDate();
        $scope.lastModifiedStopPopup = {
            opened: false
        };
        $scope.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            $scope.lastModifiedStopPopup.opened = true;
        };
        $scope.dateModelOptions = {
            timezone: '+000'
        };

        $scope.statusValues = scaleConfig.ingestStatus;
        $scope.selectedStatus = gridParams.status || $scope.statusValues[0];
        $scope.$watch('selectedStatus', function (value) {
            if ($scope.loading) {
                if (filteredByStatus) {
                    updateStatus(value);
                }
            } else {
                filteredByStatus = value !== 'VIEW ALL';
                updateStatus(value);
            }
        });

        $scope.$watch('lastModifiedStart', function (value) {
            if (!$scope.loading) {
                gridParams.started = value.toISOString();
                $scope.filterResults();
            }
        });

        $scope.$watch('lastModifiedStop', function (value) {
            if (!$scope.loading) {
                console.log(value);
                gridParams.ended = value.toISOString();
                $scope.filterResults();
            }
        });


        var updateStatus = function (value) {
            if (value != gridParams.status) {
                gridParams.page = 1;
            }
            gridParams.status = value === 'VIEW ALL' ? null : value;
            gridParams.page_size = $scope.gridOptions.paginationPageSize;
            if (!$scope.loading) {
                $scope.filterResults();
            }
        };

        var defaultColumnDefs = [
            { field: 'file_name', displayName: 'File Name', enableFiltering: false },
            {
                field: 'file_size',
                displayName: 'File Size',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.file_size_formatted }}</div>',
            },
            { field: 'strike.title', displayName: 'Strike Process', enableFiltering: false },
            {
                field: 'status',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.selectedStatus"><option ng-selected="{{ grid.appScope.statusValues[$index] == grid.appScope.selectedStatus }}" value="{{ grid.appScope.statusValues[$index] }}" ng-repeat="status in grid.appScope.statusValues track by $index">{{ status.toUpperCase() }}</option></select></div>'
            },
            {
                field: 'transfer_started',
                enableFiltering: false
            },
            { field: 'transfer_ended', enableFiltering: false },
            {
                field: 'ingest_started',
                enableFiltering: false
            },
            { field: 'ingest_ended', enableFiltering: false }
        ];

        $scope.gridOptions = gridFactory.defaultGridOptions();
        $scope.gridOptions.paginationCurrentPage = parseInt(gridParams.page || 1);
        $scope.gridOptions.paginationPageSize = parseInt(gridParams.page_size) || $scope.gridOptions.paginationPageSize;
        $scope.gridOptions.columnDefs = gridFactory.applySortConfig(defaultColumnDefs, gridParams);
        $scope.gridOptions.data = [];
        $scope.gridOptions.onRegisterApi = function (gridApi) {
                //set gridApi on scope
                $scope.gridApi = gridApi;
                // $scope.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                //     if ($scope.actionClicked) {
                //         $scope.actionClicked = false;
                //     } else {
                //         $scope.$apply(function(){
                //             $location.path('/feed/ingests/' + row.entity.id);
                //         });
                //     }
                //
                // });
                $scope.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                    gridParams.page = currentPage;
                    gridParams.page_size = pageSize;
                    console.log('gridApi.paginationChanged');
                    $scope.filterResults();
                });
                $scope.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                    $rootScope.colDefs = null;
                    _.forEach($scope.gridApi.grid.columns, function (col) {
                        col.colDef.sort = col.sort;
                    });
                    $rootScope.colDefs = $scope.gridApi.grid.options.columnDefs;
                    var sortArr = [];
                    _.forEach(sortColumns, function (col) {
                        sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                    });
                    updateOrder(sortArr);
                });
            };

        $scope.filterResults = function () {
            _.forEach(_.pairs(gridParams), function (param) {
                $location.search(param[0], param[1]);
            });
            getIngests();
        };

        var updateOrder = function (sortArr) {
            gridParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            $scope.filterResults();
        };

        var getIngests = function () {
            $scope.loading = true;
            feedService.getIngestsOnce(gridParams).then(function (data) {
                $scope.ingests = data.results;
                $scope.gridOptions.totalItems = data.count;
                $scope.gridOptions.data = $scope.ingests;
                $scope.loading = false;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                $scope.loading = false;
            });
        };


        var initialize = function () {
            navService.updateLocation('feed');
            subnavService.setCurrentPath('feed/ingests');
            if (!gridParams.started) {
                console.log('lastModifiedStart: ' + $scope.lastModifiedStart);
                gridParams.started = moment.utc($scope.lastModifiedStart).toISOString();
                $location.search('started', gridParams.started).replace();
            }
            if (!gridParams.ended) {
                gridParams.ended = moment.utc($scope.lastModifiedStop).toISOString();
                $location.search('ended', gridParams.ended).replace();
            }
            getIngests();
        };

        initialize();

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset + scaleConfig.dateFilterOffset,
                gridMaxHeight = viewport.height - offset;

            $scope.gridStyle = 'height: ' + gridMaxHeight + 'px; max-height: ' + gridMaxHeight + 'px; overflow-y: auto;';
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Feed', ['scaleConfig', function (scaleConfig) {
        var Feed = function (value, status) {
            this.value = value;
            this.status = status;
        };

        // public methods
        Feed.prototype = {
            toString: function () {
                return 'Feed';
            },
            getCellText: function () {
                return this.value;
            },
            getCellTitle: function () {
                return '';
            }
        };

        // static methods, assigned to class
        Feed.build = function (data) {
            if (data) {
                return new Feed(
                    data.value,
                    data.status
                );
            }
            return new Feed();
        };

        Feed.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Feed.build)
                    .filter(Boolean);
            }
            return Feed.build(data);
        };

        return Feed;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('FeedStatus', ['scaleConfig', function (scaleConfig) {
        var FeedStatus = function (status) {
            this.status = status;
        };

        // public methods
        FeedStatus.prototype = {
            toString: function () {
                return 'FeedStatus';
            },
            getCellFill: function () {
                return scaleConfig.colors.chart_green;
            },
            getCellActivity: function () {
                return '';
            },
            getCellActivityTotal: function () {
                return '';
            },
            getCellError: function () {
                return '';
            },
            getCellTotal: function () {
                return '';
            }
        };

        // static methods, assigned to class
        FeedStatus.build = function (data) {
            if (data) {
                return new FeedStatus(
                    data.status
                );
            }
            return new FeedStatus();
        };

        FeedStatus.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(FeedStatus.build)
                    .filter(Boolean);
            }
            return FeedStatus.build(data);
        };

        return FeedStatus;
    }]);
})();

(function () {
    'use strict';
    angular.module('scaleApp').service('feedService', ['$location', '$timeout', '$q', '$http', 'scaleConfig', 'scaleService', 'Feed', 'FeedStatus', function ($location, $timeout, $q, $http, scaleConfig, scaleService, Feed, FeedStatus) {

        var getFeedParams = function(params){
            if(!params){ params = {}; }
            var p = {};
            p.page_size = 1000;
            p.started = params.started ? params.started : moment.utc().add(-7,'days').startOf('d').toDate();
            p.ended = params.ended ? params.ended : moment.utc().toDate();
            p.use_ingest_time = params.use_ingest_time ? params.use_ingest_time : null;
            return p;
        };

        var getIngestsParams = function(params){
            return params;
        };

        return {
            getFeed: function(params){
                var d = $q.defer();
                var params = getFeedParams(params);
                $http({
                    url: scaleConfig.urls.apiPrefix + 'ingests/status/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getIngestsOnce: function(params) {
                var d = $q.defer();
                var params = getIngestsParams(params);
                $http({
                    url: scaleConfig.urls.apiPrefix + 'ingests/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    _.forEach(data.results, function(d){
                        d.file_size_formatted = scaleService.calculateFileSizeFromBytes(d.file_size);
                    });
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('loadController', ['$scope', '$location', 'scaleService', 'navService', 'loadService', 'uiGridConstants', 'scaleConfig', 'subnavService', 'QueueStatus', 'gridFactory', function($scope, $location, scaleService, navService, loadService, uiGridConstants, scaleConfig, subnavService, QueueStatus, gridFactory) {
        $scope.loading = true;
        $scope.queueStatusError = null;
        $scope.queueStatusErrorStatus = null;
        $scope.totalQueued = 0;
        $scope.gridStyle = '';
        $scope.subnavLinks = scaleConfig.subnavLinks.load;
        subnavService.setCurrentPath('load');

        $scope.getPage = function (pageNumber, pageSize) {
            $scope.loading = true;
            loadService.getQueueStatus(pageNumber - 1, pageSize).then(function (data) {
                var newData = [];
                for (var i = 0; i < $scope.gridOptions.paginationPageSize; i++) {
                    newData.push(data.jobs[i]);
                }
                $scope.gridOptions.data = newData;
            }).catch(function (error) {
                $scope.status = 'Unable to load queue status: ' + error.message;
                console.error($scope.status);
            }).finally(function () {
                $scope.loading = false;
            });
        };

        var initialize = function() {
            $scope.gridOptions = gridFactory.defaultGridOptions();
            $scope.gridOptions.enableSorting = false;
            $scope.gridOptions.columnDefs = [
                    {
                        field: 'job_type_name',
                        displayName: 'Job Type',
                        enableFiltering: false,
                        cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.getIcon()"></span> {{ row.entity.job_type_name }}</div>'
                    },
                    { field: 'job_type_version', enableFiltering: false },
                    { field: 'highest_priority', enableFiltering: false },
                    {
                        field: 'longestQueued',
                        displayName: 'Duration of Longest Queued Job',
                        enableFiltering: false,
                        cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.getDuration() }}</div>'
                    },
                    { field: 'count', enableFiltering: false },
                    { field: 'is_job_type_paused', enableFiltering: false }
                ];
            $scope.gridOptions.data = [];
            $scope.gridOptions.onRegisterApi = function (gridApi) {
                    //set gridApi on scope
                    $scope.gridApi = gridApi;
                    gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                        console.log(row);
                        //$location.path('/jobs').search({job_type_id: row.entity.job_type_id, status: 'RUNNING'});
                    });
                    $scope.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                        $scope.getPage(currentPage, pageSize);
                    });
                };


            loadService.getQueueStatus(0, $scope.gridOptions.paginationPageSize).then(null, null, function (result) {
                if (result.$resolved) {
                    $scope.gridOptions.data = result.queue_status;
                    $scope.gridOptions.totalItems = result.queue_status.length;
                    $scope.totalQueued = _.sum(result.queue_status, 'count');
                    console.log('queue status updated');
                } else {
                    if (result.statusText && result.statusText !== '') {
                        $scope.queueStatusErrorStatus = result.statusText;
                    }
                    $scope.queueStatusError = 'Unable to retrieve queue status.';
                }
                $scope.loading = false
            });

            navService.updateLocation('queue');
        };
        initialize();

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                gridMaxHeight = viewport.height - offset;

            $scope.gridStyle = 'height: ' + gridMaxHeight + 'px; max-height: ' + gridMaxHeight + 'px; overflow-y: auto;';
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('loadDepthController', ['$scope', '$location', 'navService', 'scaleConfig', 'subnavService', function ($scope, $location, navService, scaleConfig, subnavService) {
        $scope.subnavLinks = scaleConfig.subnavLinks.load;
        subnavService.setCurrentPath('load/depth');

        $scope.loading = false;

        var initialize = function () {
            navService.updateLocation('load');
        };

        initialize();
    }]);
})();

(function(){
    'use strict';

    angular.module('scaleApp').controller('queueRunningController', ['$scope', '$location', 'scaleService', 'navService', 'jobService', 'gridFactory', 'uiGridConstants', 'scaleConfig', 'subnavService', function($scope, $location, scaleService, navService, jobService, gridFactory, uiGridConstants, scaleConfig, subnavService) {
        $scope.loading = true;
        $scope.runningJobsError = null;
        $scope.runningJobsErrorStatus = null;
        $scope.totalRunning = 0;
        $scope.gridStyle = '';
        $scope.subnavLinks = scaleConfig.subnavLinks.load;
        subnavService.setCurrentPath('load/running');

        $scope.getPage = function (pageNumber, pageSize){
            $scope.loading = true;
            jobService.getRunningJobsOnce(pageNumber - 1, pageSize).then(function (data) {
                var newData = [];
                for(var i = 0; i < $scope.gridOptions.paginationPageSize; i++){
                    newData.push(data.results[i]);
                }
                $scope.gridOptions.data = newData;
            }).catch(function(error){
                $scope.status = 'Unable to load queue running status: ' + error.message;
                console.error($scope.status);
            }).finally(function(){
                $scope.loading = false;
            });
        };

        var initialize = function() {
            $scope.gridOptions = gridFactory.defaultGridOptions();
            $scope.gridOptions.enableSorting = false;
            $scope.gridOptions.columnDefs = [
                {
                    field: 'title',
                    displayName: 'Job Type',
                    enableFiltering: false,
                    cellTemplate: '<div class="ui-grid-cell-contents"><i class="fa fa-{{ row.entity.getIcon() }}"></i> {{ row.entity.job_type.title }}</div>'
                },
                {field: 'job_type.version', enableFiltering: false},
                {field: 'count', displayName: 'Number of Jobs', enableFiltering: false},
                {
                    field: 'longestRunning',
                    displayName: 'Duration of Longest Running Job',
                    enableFiltering: false,
                    cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.getDuration() }}</div>'
                }
            ];
            $scope.gridOptions.data = [];
            $scope.gridOptions.onRegisterApi = function (gridApi) {
                // set gridApi on scope
                $scope.gridApi = gridApi;
                gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                    $scope.$apply(function(){
                        $location.path('/jobs').search({job_type_id: row.entity.job_type.id, status: 'RUNNING'});
                    });
                });
                $scope.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                    $scope.getPage(currentPage, pageSize);
                });
            };

            jobService.getRunningJobs(0, $scope.gridOptions.paginationPageSize).then(null, null, function (data) {
                if (data.$resolved) {
                    $scope.gridOptions.data = data.results;
                    $scope.gridOptions.totalItems = data.results.length;
                    $scope.totalRunning = _.sum(data.results, 'count');
                    console.log('running jobs updated');
                } else {
                    if (data.statusText && data.statusText !== '') {
                        $scope.runningJobsErrorStatus = data.statusText;
                    }
                    $scope.runningJobsError = 'Unable to retrieve running jobs.';
                }
                $scope.loading = false;
            });
            navService.updateLocation('load');
        };
        initialize();

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                gridMaxHeight = viewport.height - offset;

            $scope.gridStyle = 'height: ' + gridMaxHeight + 'px; max-height: ' + gridMaxHeight + 'px; overflow-y: auto;';
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('QueueStatus', ['scaleConfig', 'scaleService', function (scaleConfig, scaleService) {
        var QueueStatus = function (count, longest_queued, job_type_name, job_type_version, highest_priority, is_job_type_paused) {
            this.count = count;
            this.longest_queued = longest_queued;
            this.job_type_name = job_type_name;
            this.job_type_version = job_type_version;
            this.highest_priority = highest_priority;
            this.is_job_type_paused = is_job_type_paused;
        };

        // public methods
        QueueStatus.prototype = {
            getIcon: function () {
                var configJobType = _.find(scaleConfig.jobTypes, 'title', this.job_type_name);
                return configJobType ? '<i class="fa">&#x' + configJobType.code + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            },
            getDuration: function () {
                return scaleService.calculateDuration(this.longest_queued, moment.utc().toISOString());
            }
        };

        // static methods, assigned to class
        QueueStatus.build = function (data) {
            if (data) {
                return new QueueStatus(
                    data.count,
                    data.longest_queued,
                    data.job_type_name,
                    data.job_type_version,
                    data.highest_priority,
                    data.is_job_type_paused
                );
            }
            return new QueueStatus();
        };

        QueueStatus.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(QueueStatus.build)
                    .filter(Boolean);
            }
            return QueueStatus.build(data);
        };

        return QueueStatus;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('loadService', ['$http', '$q', '$resource', 'scaleConfig', 'poller', 'pollerFactory', 'QueueStatus', function($http, $q, $resource, scaleConfig, poller, pollerFactory, QueueStatus) {
        var getJobLoadParams = function (page, page_size, started, ended, order, status, job_type_id, job_type_name, job_type_category, url) {
            return {
                started: started,
                ended: ended,
                job_type_id: job_type_id,
                job_type_name: job_type_name,
                job_type_category: job_type_category,
                page_size: 1000,
                url: url
            };
        };

        var getRequeueJobsParams = function (started, ended, job_status, job_type_ids, job_type_names, job_type_categories, priority, url) {
            return {
                started: started,
                ended: ended,
                job_status: job_status,
                job_ids: job_ids,
                job_type_ids: job_type_ids,
                job_type_names: job_type_names,
                job_type_categories: job_type_categories,
                priority: priority,
                url: url
            };
        };

        return {
            getQueueStatus: function (pageNumber, pageSize) {
                var params = {
                    page_number: pageNumber,
                    page_size: pageSize
                };

                var queueStatusResource = $resource(scaleConfig.urls.apiPrefix + 'queue/status/', params),
                    queueStatusPoller = pollerFactory.newPoller(queueStatusResource, scaleConfig.pollIntervals.queueStatus);

                return queueStatusPoller.promise.then(null, null, function (result) {
                    if (result.$resolved) {
                        result.queue_status = QueueStatus.transformer(result.queue_status);
                    } else {
                        queueStatusPoller.stop();
                    }
                    return result;
                });
            },
            getQueueStatusOnce: function () {
                var d = $q.defer();

                $http.get(scaleConfig.urls.apiPrefix + 'queue/status/').success(function (data) {
                    var returnData = QueueStatus.transformer(data.queue_status);
                    d.resolve(returnData);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            requeueJobs: function (params) {
                params = params || getRequeueJobsParams();
                params.url = params.url ? params.url : scaleConfig.urls.apiPrefix + 'queue/requeue-jobs/';

                var d = $q.defer();

                $http.post(params.url, params).success(function (result) {
                    d.resolve(result);
                }).error(function(error){
                    d.reject(error);
                });

                return d.promise;
            },
            getJobLoad: function (params) {
                params = params || getJobLoadParams();
                params.url = params.url ? params.url : scaleConfig.urls.apiPrefix + 'load/';

                var jobLoadResource = $resource(params.url, params),
                    jobLoadPoller = pollerFactory.newPoller(jobLoadResource, scaleConfig.pollIntervals.jobLoad);

                return jobLoadPoller.promise.then(null, null, function (data) {
                    if (!data.$resolved) {
                        jobLoadPoller.stop();
                    }
                    return data;
                });
            },
            getJobLoadOnce: function (params) {
                params = params || getJobLoadParams();
                var d = $q.defer();

                $http({
                    url: params.url ? params.url : scaleConfig.urls.apiPrefix + 'load/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('jobDetailController', ['$scope', '$rootScope', '$location', '$routeParams', '$uibModal', 'navService', 'jobService', 'jobExecutionService', 'nodeService', 'loadService', 'scaleConfig', 'subnavService', 'userService', 'scaleService', 'toastr', function ($scope, $rootScope, $location, $routeParams, $uibModal, navService, jobService, jobExecutionService, nodeService, loadService, scaleConfig, subnavService, userService, scaleService, toastr) {
        $scope.job = {};
        $scope.jobId = $routeParams.id;
        $scope.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs');
        $scope.loadingJobDetail = false;
        $scope.latestExecution = null;
        $scope.executionLog = null;
        $scope.executionDetails = null;
        $scope.selectedExectuionDetailValues = null;
        $scope.timeline = [];
        $scope.readonly = true;
        $scope.jobErrorCreated = '';
        $scope.jobErrorLastModified = '';
        $scope.lastStatusChange = '';
        $scope.triggerOccurred = '';

        $scope.showLog = function (execution) {
            $scope.selectedExecutionLog = execution;
            var modalInstance = $uibModal.open({
                animation: true,
                templateUrl: 'showLog.html',
                scope: $scope,
                //size: 'lg',
                windowClass: 'log-modal-window'
            });
        };

        $scope.showExecutionDetails = function (executionId) {
            jobExecutionService.getJobExecutionDetails(executionId).then(function (data) {
                $scope.selectedExecutionDetails = data;
                $scope.selectedExecutionDetailValues = _.pairs(data);
                var modalInstance = $uibModal.open({
                    animation: true,
                    templateUrl: 'showExecutionDetails.html',
                    scope: $scope,
                    size: 'lg'
                });
            });
        };

        $scope.mediaTypeClass = function (mediaType) {
            var mediaTypeCfg = _.find(scaleConfig.mediaTypes, 'mimeType', mediaType);
            if (mediaTypeCfg) {
                return mediaTypeCfg.icon;
            } else {
                return null;
            }
        };

        $scope.requeueJob = function (jobId) {
            $scope.loading = true;
            loadService.requeueJobs({ job_ids: [jobId] }).then(function (data) {
                toastr['success']('Requeued Job');
                $scope.job.status = data.job_status;
                getJobDetail(jobId);
            }).catch(function (error) {
                toastr['error']('Requeue request failed');
                console.log(error);
            }).finally(function () {
                $scope.loading = false;
            });
        };

        $scope.cancelJob = function (job) {
            $scope.loading = true;
            $scope.actionClicked = true;
            $scope.loading = true;
            var originalStatus = job.status;
            job.status = 'CANCEL';
            jobService.updateJob(job.id, { status: 'CANCELED' }).then(function (data) {
                toastr['success']('Job Canceled');
                job.status = 'CANCELED';
            }).catch(function (error) {
                toastr['error'](error);
                console.log(error);
                job.status = originalStatus;
            }).finally(function () {
                $scope.loading = false;
            });
        };
        
        $scope.calculateFileSize = function (size) {
            return scaleService.calculateFileSizeFromBytes(size);
        };

        var getJobDetail = function (jobId) {
            $scope.loadingJobDetail = true;
            jobService.getJobDetail(jobId).then(function (data) {
                $scope.job = data;
                $scope.timeline = calculateTimeline(data);
                // $scope.publishedProducts = _.where(data.products, { 'is_published': true });
                // $scope.unpublishedProducts = _.where(data.products, { 'is_published': false });
                // $scope.publishedProductsGrouped = _.pairs(_.groupBy($scope.publishedProducts, 'job_exe.id'));
                $scope.latestExecution = data.getLatestExecution();
                $scope.jobErrorCreated = data.error ? moment.utc(data.error.created).toISOString() : '';
                $scope.lastStatusChange = data.last_status_change ? moment.duration(moment.utc(data.last_status_change).diff(moment.utc())).humanize(true) : '';
                $scope.triggerOccurred = data.event.occurred ? moment.duration(moment.utc(data.event.occurred).diff(moment.utc())).humanize(true) : '';
                $scope.inputs = data.inputs;
                $scope.outputs = data.outputs;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                $scope.loadingJobDetail = false;
            });
        };

        var calculateTimeline = function (job) {
            var tl = [];
            tl.push({ taskName: 'Created', started: job.created ? moment.utc(job.created).toDate() : job.created, ended: job.queued ? moment.utc(job.queued).toDate() : job.queued });
            tl.push({ taskName: 'Queued', started: job.queued ? moment.utc(job.queued).toDate() : job.queued, ended: job.started ? moment.utc(job.started).toDate() : job.started });
            tl.push({ taskName: 'Executed', started: job.started ? moment.utc(job.started).toDate() : job.started, ended: job.ended ? moment.utc(job.ended).toDate() : job.ended });

            return tl;
        };

        var initialize = function () {
            navService.updateLocation('jobs');

            $rootScope.user = userService.getUserCreds();
            if($rootScope.user){
                $scope.readonly = false;
            }

            getJobDetail($scope.jobId);
        };

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('jobExecutionDetailController', ['$scope', '$location', '$routeParams', 'navService', 'jobExecutionService', 'nodeService', 'scaleConfig', 'subnavService', function ($scope, $location, $routeParams, navService, jobExecutionService, nodeService, scaleConfig, subnavService) {
        $scope.jobExecution = {};
        $scope.jobExecutionId = $routeParams.id;
        $scope.loading = true;
        $scope.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs/runs');

        var getJobExecutionDetail = function (jobExecutionId) {
            jobExecutionService.getJobExecutionDetail(id).then(function (data) {
                $scope.jobExecution = data;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                $scope.loading = false;
            });
        };

        var initialize = function () {
            getJobExecutionDetail($routeParams.id);
            navService.updateLocation('jobs');
        };

        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('jobExecutionsController', ['$scope', '$location', 'navService', 'statsService', 'jobExecutionService', 'jobTypeService', 'uiGridConstants', 'scaleConfig', 'subnavService', function($scope, $location, navService, statsService, jobExecutionService, jobTypeService, uiGridConstants, scaleConfig, subnavService) {

        $scope.jobExecutions = [];
        $scope.loading = true;
        $scope.jobTypeValues = [];
        $scope.selectedJobType = '';
        $scope.jobStatus = scaleConfig.jobStatus;
        $scope.selectedJobStatus = '';
        $scope.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs/executions');

        var gridFilter = {},
            gridPageNumber = 1;

        $scope.gridOptions = {
            enableRowSelection: true,
            enableRowHeaderSelection: false,
            enableHorizontalScrollbar: uiGridConstants.scrollbars.NEVER,
            multiSelect: false,
            enableFiltering: true,
            useExternalFiltering: true,
            enableSorting: true,
            minRowsToShow: 17,
            paginationPageSizes: [25,50,75],
            paginationPageSize: 25,
            useExternalPagination: true,
            columnDefs: [
                {
                    field: 'jobTypeId',
                    displayName: 'Job Type',
                    cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.getIcon()"></span> {{ row.entity.job.jobType.title }}</div>',
                    filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.selectedJobType"><option value="{{ grid.appScope.jobTypeValues[$index].id }}" ng-repeat="jobType in grid.appScope.jobTypeValues track by $index">{{ grid.appScope.jobTypeValues[$index].name }} {{ grid.appScope.jobTypeValues[$index].version }}</option></select>'
                },
                { field: 'created', enableFiltering: false, cellFilter: 'date:\'yyyy-MM-dd HH:mm:ss\'' },
                { field: 'lastModified', enableFiltering: false, cellFilter: 'date:\'yyyy-MM-dd HH:mm:ss\'' },
                {
                    field: 'status',
                    filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.selectedJobStatus"><option ng-repeat="status in grid.appScope.jobStatus track by $index">{{ status.toUpperCase() }}</option></select>'
                },
                { field: 'id', displayName: 'ID', enableFiltering: false }
            ],
            data: [],
            onRegisterApi: function (gridApi) {
                //set gridApi on scope
                $scope.gridApi = gridApi;
                $scope.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                    $scope.$apply(function () {
                        //$location.path('/jobexecutions/' + row.entity.id);
                        console.log(row);
                    });
                });
                $scope.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                    $scope.getPage(currentPage, pageSize);
                });
            }
        };

        $scope.$watch('selectedJobType', function (value) {
            if (!$scope.loading) {
                gridFilter.jobTypeId = value;
                $scope.getPage(gridPageNumber, $scope.gridOptions.paginationPageSize, gridFilter);
            }
        });

        $scope.$watch('selectedJobStatus', function (value) {
            if (!$scope.loading) {
                gridFilter.jobStatus = value;
                $scope.getPage(gridPageNumber, $scope.gridOptions.paginationPageSize, gridFilter);
            }
        });

        $scope.getPage = function (pageNumber, pageSize) {
            $scope.loading = true;
            gridPageNumber = pageNumber;
            jobExecutionService.getJobExecutions(pageNumber, pageSize, gridFilter).then(function (data) {
                var newData = [];
                for (var i = 0; i < $scope.gridOptions.paginationPageSize; i++) {
                    if (data.executions[i]) {
                        newData.push(data.executions[i]);
                    }
                }
                $scope.gridOptions.data = newData;
                $scope.gridOptions.totalItems = data.count;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                $scope.loading = false;
            });
        };

        var getJobExecutions = function () {
            jobExecutionService.getJobExecutions(gridPageNumber, $scope.gridOptions.paginationPageSize, gridFilter).then(function (data) {
                window.localStorage['scale-jobexecutions-time'] = moment.utc().toISOString();
                window.localStorage['scale-jobexecutions'] = JSON.stringify(data);
                $scope.gridOptions.totalItems = data.count;
                $scope.gridOptions.data = data.executions;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                getJobTypes();
            });
        };

        var getJobTypes = function () {
            jobTypeService.getJobTypesOnce().then(function (data) {
                $scope.jobTypeValues = data.results;
                $scope.jobTypeValues.unshift({ name: '', version: '', id: null });
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                $scope.loading = false;
            });
        };

        var initialize = function() {
            getJobExecutions();
            navService.updateLocation('jobs');
        };
        initialize();
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('jobTypesController', ['$rootScope', '$scope', '$routeParams', '$location', 'hotkeys', 'scaleService', 'navService', 'jobTypeService', 'scaleConfig', 'subnavService', 'nodeService', 'localStorage', 'userService', function ($rootScope, $scope, $routeParams, $location, hotkeys, scaleService, navService, jobTypeService, scaleConfig, subnavService, nodeService, localStorage, userService) {
        $scope.requestedJobTypeId = parseInt($routeParams.id);
        $scope.masterContainerStyle = '';
        $scope.detailContainerStyle = '';
        $scope.jobTypes = [];
        $scope.jobTypeIds = [];
        $scope.jobTypeCount = 0;
        $scope.activeJobTypeDetails = {};
        $scope.activeJobTypeInterfaceValues = [];
        $scope.activeJobTypeErrors = [];
        $scope.activeJobTypeStats = {};
        $scope.showJobTypeErrors = false;
        $scope.loading = true;
        $scope.activeJobType = null;
        $scope.healthData6 = {};
        $scope.healthData12 = {};
        $scope.healthData24 = {};
        $scope.activityIcon = '<i class="fa fa-pulse">&#x' + scaleConfig.activityIconCode + '</i>';
        $scope.selectJobClass = 'visible';
        $scope.jobDetailsClass = 'invisible';
        $scope.pauseBtnClass = 'fa-pause';
        $scope.user = userService.getUserCreds();
        $scope.subnavLinks = scaleConfig.subnavLinks.jobs;
        subnavService.setCurrentPath('jobs/types');

        var jobTypeStats = {};

        $scope.viewDetails = function (id) {
            $scope.activeJobType = _.find($scope.jobTypes, 'id', id);
            $scope.activeJobType.created = formatDateTime($scope.activeJobType.created);
            $scope.activeJobType.lastModified = formatDateTime($scope.activeJobType.lastModified);

            $location.path('jobs/types/' + id);

            getJobTypeDetails($scope.activeJobType.id);

            //formatJobTypeStats();

            $scope.jobDetailsClass = 'visible';
            $scope.selectJobClass = 'invisible';
        };

        $scope.togglePause = function () {
            $scope.activeJobType.is_paused = !$scope.activeJobType.is_paused;
            $scope.activeJobTypeDetails.is_paused = $scope.activeJobType.is_paused;
            $scope.loading = true;
            jobTypeService.updateJobType($scope.activeJobTypeDetails).then(function(data){
                $scope.activeJobTypeDetails = data;
                $scope.pauseBtnClass = $scope.getPauseButtonClass($scope.activeJobTypeDetails.is_paused);
                $scope.loading = false;
            }).catch(function (error) {
                console.log(error);
                toastr['error'](error);
                $scope.loading = false;
            });
        };

        $scope.getPauseButtonClass = function(is_paused){
            return is_paused ? 'fa-play' : 'fa-pause';
        }

        $scope.getJobTypeListItemClass = function(jobType){
            return jobType.is_paused ? 'paused' : '';
        }

        var formatDateTime = function (dt) {
            return moment.utc(dt).toISOString();
        };

        var getJobTypes = function () {
            jobTypeService.getJobTypesOnce().then(function (data) {
                $scope.jobTypes = data.results;
                $scope.jobTypeIds = _.pluck(data.results, 'id');
                $scope.jobTypeCount = data.count;
                if ($scope.requestedJobTypeId) {
                    $scope.viewDetails($scope.requestedJobTypeId);
                } else {
                    $scope.loading = false;
                }
                hotkeys.bindTo($scope)
                    .add({
                        combo: 'ctrl+up',
                        description: 'Previous Job Type',
                        callback: function () {
                            if ($scope.activeJobType) {
                                var idx = _.indexOf($scope.jobTypeIds, $scope.activeJobType.id);
                                if (idx > 0) {
                                    $scope.viewDetails($scope.jobTypeIds[idx - 1]);
                                }
                            }
                        }
                    }).add({
                        combo: 'ctrl+down',
                        description: 'Next Job Type',
                        callback: function () {
                            if ($scope.activeJobType) {
                                var idx = _.indexOf($scope.jobTypeIds, $scope.activeJobType.id);
                                if (idx < ($scope.jobTypeIds.length - 1)) {
                                    $scope.viewDetails($scope.jobTypeIds[idx + 1]);
                                }
                            }
                        }
                    });
            }).catch(function (error) {
                console.log(error);
                $scope.loading = false;
            });
        };

        var getJobTypeDetails = function (id) {
            $scope.loading = true;
            jobTypeService.getJobTypeDetails(id).then(function (data) {
                $scope.activeJobTypeDetails = data;
                $scope.activeJobTypeInterfaceValues = _.pairs(data.job_type_interface);
                $scope.pauseBtnClass = $scope.getPauseButtonClass($scope.activeJobTypeDetails.is_paused);
                // format error mapping
                $scope.activeJobTypeErrors = [];
                $scope.showJobTypeErrors = _.keys(data.error_mapping.exit_codes).length > 0;
                if ($scope.showJobTypeErrors) {
                    _.forEach(data.error_mapping.exit_codes, function (error_name) {
                        var error = _.find(data.errors, 'name', error_name),
                            exitCode = _.invert(data.error_mapping.exit_codes)[error_name];
                        $scope.activeJobTypeErrors.push({code: exitCode, data: error});
                    });
                }

                // format job type stats
                var performance = data.getPerformance(),
                    failures = data.getFailures();

                $scope.activeJobTypeStats = performance;

                $scope.healthData6 = {
                    gaugeData: performance.hour6.rate,
                    donutData: failures.hour6
                };
                $scope.healthData12 = {
                    gaugeData: performance.hour12.rate,
                    donutData: failures.hour12
                };
                $scope.healthData24 = {
                    gaugeData: performance.hour24.rate,
                    donutData: failures.hour24
                };
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                $scope.loading = false;
            });
        };

        var initialize = function () {
            getJobTypes();
            navService.updateLocation('jobs');
        };

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                masterOffset = scaleConfig.headerOffset,
                detailOffset = scaleConfig.headerOffset + document.getElementsByClassName('nav-tabs')[0].scrollHeight,
                masterMaxHeight = viewport.height - masterOffset,
                detailMaxHeight = viewport.height - detailOffset;

            $scope.masterContainerStyle = 'height: ' + masterMaxHeight + 'px; max-height: ' + masterMaxHeight + 'px; overflow-y: auto;';
            $scope.detailContainerStyle = 'height: ' + detailMaxHeight + 'px; max-height: ' + detailMaxHeight + 'px; overflow-y: auto;';
        });

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('jobsController', ['$rootScope', '$scope', '$location', '$uibModal', 'navService', 'jobService', 'jobTypeService', 'jobExecutionService', 'uiGridConstants', 'scaleConfig', 'subnavService', 'gridFactory', 'loadService', 'scaleService', 'userService', 'moment', 'toastr', function($rootScope, $scope, $location, $uibModal, navService, jobService, jobTypeService, jobExecutionService, uiGridConstants, scaleConfig, subnavService, gridFactory, loadService, scaleService, userService, moment, toastr) {
        var self = this;

        self.jobsParams = {
            page: null, page_size: null, started: null, ended: null, order: $rootScope.jobsControllerOrder || '-last_modified', status: null, job_type_id: null, job_type_name: null, job_type_category: null, url: null
        };

        // check for jobsParams in query string, and update as necessary
        _.forEach(_.pairs(self.jobsParams), function (param) {
            var value = _.at($location.search(), param[0]);
            if (value.length > 0) {
                self.jobsParams[param[0]] = value.length > 1 ? value : value[0];
            }
        });

        var gridPageNumber = self.jobsParams.page || 1,
            filteredByJobType = self.jobsParams.job_type_id ? true : false,
            filteredByJobStatus = self.jobsParams.status ? true : false,
            filteredByOrder = self.jobsParams.order ? true : false;

        $scope.jobsData = {};
        $scope.loading = true;
        $scope.jobTypeValues = [];
        $scope.jobExecution = null;
        $scope.selectedJobType = self.jobsParams.job_type_id || 0;
        $scope.jobStatusValues = scaleConfig.jobStatus;
        $scope.selectedJobStatus = self.jobsParams.status || $scope.jobStatusValues[0];
        $scope.subnavLinks = scaleConfig.subnavLinks.jobs;
        $scope.actionClicked = false;
        $scope.gridStyle = '';
        $scope.readonly = true;
        $scope.lastModifiedStart = self.jobsParams.started ? moment.utc(self.jobsParams.started).toDate() : moment.utc().subtract(1, 'weeks').startOf('d').toDate();
        $scope.lastModifiedStartPopup = {
            opened: false
        };
        $scope.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            $scope.lastModifiedStartPopup.opened = true;
        };
        $scope.lastModifiedStop = self.jobsParams.ended ? moment.utc(self.jobsParams.ended).toDate() : moment.utc().endOf('d').toDate();
        $scope.lastModifiedStopPopup = {
            opened: false
        };
        $scope.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            $scope.lastModifiedStopPopup.opened = true;
        };
        $scope.dateModelOptions = {
            timezone: '+000'
        };

        subnavService.setCurrentPath('jobs');

        var defaultColumnDefs = [
            {
                field: 'job_type',
                displayName: 'Job Type',
                cellTemplate: '<div class="ui-grid-cell-contents"><span ng-bind-html="row.entity.job_type.getIcon()"></span> {{ row.entity.job_type.title }} {{ row.entity.job_type.version }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.selectedJobType"><option ng-if="grid.appScope.jobTypeValues[$index]" ng-selected="{{ grid.appScope.jobTypeValues[$index].id == grid.appScope.selectedJobType }}" value="{{ grid.appScope.jobTypeValues[$index].id }}" ng-repeat="jobType in grid.appScope.jobTypeValues track by $index">{{ grid.appScope.jobTypeValues[$index].title }} {{ grid.appScope.jobTypeValues[$index].version }}</option></select></div>'
            },
            {
                field: 'created',
                displayName: 'Created',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.created_formatted }}</div>'
            },
            {
                field: 'last_modified',
                displayName: 'Last Modified',
                enableFiltering: false,
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.last_modified_formatted }}</div>'
            },
            { field: 'duration', enableFiltering: false, enableSorting: false, cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.getDuration() }}</div>' },
            {
                field: 'status',
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.status }} <button ng-show="((!grid.appScope.readonly) && (row.entity.status === \'FAILED\' || row.entity.status === \'CANCELED\'))" ng-click="grid.appScope.requeueJobs({ job_ids: [row.entity.id] })" class="btn btn-xs btn-default" title="Requeue Job"><i class="fa fa-repeat"></i></button> <button ng-show="!grid.appScope.readonly && row.entity.status !== \'COMPLETED\' && row.entity.status !== \'CANCELED\'" ng-click="grid.appScope.cancelJob(row.entity)" class="btn btn-xs btn-default" title="Cancel Job"><i class="fa fa-ban"></i></button></div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.selectedJobStatus"><option ng-selected="{{ grid.appScope.jobStatusValues[$index] == grid.appScope.selectedJobStatus }}" value="{{ grid.appScope.jobStatusValues[$index] }}" ng-repeat="status in grid.appScope.jobStatusValues track by $index">{{ status.toUpperCase() }}</option></select></div>'
            },
            {
                field: 'id',
                displayName: 'Log',
                enableFiltering: false,
                sortable: false,
                width: 60,
                cellTemplate: '<div class="ui-grid-cell-contents text-center"><button ng-click="grid.appScope.showLog(row.entity.id)" class="btn btn-xs btn-default"><i class="fa fa-file-text"></i></button></div>'
            }
        ];

        $scope.gridOptions = gridFactory.defaultGridOptions();
        $scope.gridOptions.paginationCurrentPage = parseInt(self.jobsParams.page || 1);
        $scope.gridOptions.paginationPageSize = parseInt(self.jobsParams.page_size) || $scope.gridOptions.paginationPageSize;
        var colDefs = $rootScope.colDefs ? $rootScope.colDefs : defaultColumnDefs;
        $scope.gridOptions.columnDefs = gridFactory.applySortConfig(colDefs, self.jobsParams);
        $scope.gridOptions.data = [];
        $scope.gridOptions.onRegisterApi = function (gridApi) {
                //set gridApi on scope
                $scope.gridApi = gridApi;
                $scope.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                    if ($scope.actionClicked) {
                        $scope.actionClicked = false;
                    } else {
                        $scope.$apply(function(){
                            $location.path('/jobs/job/' + row.entity.id);
                        });
                    }

                });
                $scope.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                    self.jobsParams.page = currentPage;
                    self.jobsParams.page_size = pageSize;
                    console.log('gridApi');
                    $scope.filterResults();
                });
                $scope.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                    $rootScope.colDefs = null;
                    _.forEach($scope.gridApi.grid.columns, function (col) {
                        col.colDef.sort = col.sort;
                    });
                    $rootScope.colDefs = $scope.gridApi.grid.options.columnDefs;
                    var sortArr = [];
                    _.forEach(sortColumns, function (col) {
                        sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                    });
                    self.updateJobOrder(sortArr);
                });
            };


        $scope.showStatus = function (status) {
            return _.includes($scope.jobStatusValues, status);
        };

        self.updateJobType = function (value) {
            if (value != self.jobsParams.job_type_id) {
                self.jobsParams.page = 1;
            }
            self.jobsParams.job_type_id = value == 0 ? null : value;
            self.jobsParams.page_size = $scope.gridOptions.paginationPageSize;
            console.log('selectedJobType');
            if (!$scope.loading) {
                $scope.filterResults();
            }
        };

        $scope.$watch('selectedJobType', function (value) {
            if ($scope.loading) {
                if (filteredByJobType) {
                    self.updateJobType(value);
                }
            } else {
                filteredByJobType = value != 0;
                self.updateJobType(value);
            }
        });

        self.updateJobStatus = function (value) {
            if (value != self.jobsParams.status) {
                self.jobsParams.page = 1;
            }
            self.jobsParams.status = value === 'VIEW ALL' ? null : value;
            self.jobsParams.page_size = $scope.gridOptions.paginationPageSize;
            console.log('selectedJobStatus');
            if (!$scope.loading) {
                $scope.filterResults();
            }
        };

        $scope.$watch('selectedJobStatus', function (value) {
            if ($scope.loading) {
                if (filteredByJobStatus) {
                    self.updateJobStatus(value);
                }
            } else {
                filteredByJobStatus = value !== 'VIEW ALL';
                self.updateJobStatus(value);
            }
        });

        self.updateJobOrder = function (sortArr) {
            self.jobsParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            $scope.filterResults();
        };

        $scope.$watch('lastModifiedStart', function (value) {
            if (!$scope.loading) {
                self.jobsParams.started = value.toISOString();
                $scope.filterResults();
            }
        });

        $scope.$watch('lastModifiedStop', function (value) {
            if (!$scope.loading) {
                self.jobsParams.ended = value.toISOString();
                $scope.filterResults();
            }
        });

        /*$scope.$watch('gridApi', function (gridApi) {
            if (filteredByOrder) {
                gridApi.core.raise.sortChanged();
            }
        });*/

        $scope.showLog = function (jobId) {
            // show log modal
            $scope.actionClicked = true;
            console.log('show log modal');
            jobService.getJobDetail(jobId).then(function (data) {
                $scope.selectedJob = data.job_type.title + ' ' + data.job_type.version;
                $scope.jobExecution = data.getLatestExecution();
                var modalInstance = $uibModal.open({
                    animation: true,
                    templateUrl: 'showLog.html',
                    scope: $scope,
                    size: 'lg',
                    windowClass: 'log-modal-window'
                });
            });
        };

        $scope.filterResults = function () {
            _.forEach(_.pairs(self.jobsParams), function (param) {
                $location.search(param[0], param[1]);
            });
            $scope.loading = true;
            self.getJobs();
        };

        $scope.requeueJobs = function (jobsParams) {
            jobsParams = jobsParams || { started: $scope.lastModifiedStart.toISOString(), ended: $scope.lastModifiedStop.toISOString()};
            $scope.actionClicked = true;
            $scope.loading = true;
            loadService.requeueJobs(jobsParams).then(function () {
                toastr['success']('Requeue Successful');
                self.getJobs();
            }).catch(function (error) {
                toastr['error']('Requeue request failed');
                console.log(error);
                $scope.loading = false;
            });
        };

        $scope.cancelJob = function (job) {
            $scope.actionClicked = true;
            $scope.loading = true;
            var originalStatus = job.status;
            job.status = 'CANCEL';
            jobService.updateJob(job.id, { status: 'CANCELED' }).then(function (data) {
                toastr['success']('Job Canceled');
                job.status = 'CANCELED';
            }).catch(function (error) {
                toastr['error'](error);
                console.log(error);
                job.status = originalStatus;
            }).finally(function () {
                $scope.loading = false;
            });
        };

        self.getJobs = function () {
            jobService.getJobsOnce(self.jobsParams).then(function (data) {
                $scope.jobsData = data.results;
                $scope.gridOptions.totalItems = data.count;
                $scope.gridOptions.data = data.results;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                $scope.loading = false;
            });
        };

        self.getJobTypes = function () {
            jobTypeService.getJobTypesOnce().then(function (data) {
                $scope.jobTypeValues = data.results;
                $scope.jobTypeValues.unshift({ name: 'VIEW ALL', title: 'VIEW ALL', version: '', id: 0 });
                /*if (!filteredByJobType && !filteredByJobStatus && !filteredByOrder) {
                    self.getJobs();
                } else {
                    if (filteredByOrder) {
                        self.updateJobOrder(self.jobsParams.order);
                    }
                }*/
                self.getJobs(self.jobsParams);
            }).catch(function (error) {
                $scope.loading = false;
                console.log(error);
            });
        };

        self.initialize = function () {
            if (typeof $rootScope.colDefs === 'undefined') {
                // root column defs have not been altered by user, so set up defaults
                if (!self.jobsParams.order) {
                    self.jobsParams.order = '-last_modified';
                    $location.search('order', self.jobsParams.order).replace();
                }
                if (!self.jobsParams.page_size) {
                    self.jobsParams.page_size = $scope.gridOptions.paginationPageSize;
                    $location.search('page_size', self.jobsParams.page_size).replace();
                }
                if (!self.jobsParams.started) {
                    self.jobsParams.started = moment.utc($scope.lastModifiedStart).toISOString();
                    $location.search('started', self.jobsParams.started).replace();
                }
                if (!self.jobsParams.ended) {
                    self.jobsParams.ended = moment.utc($scope.lastModifiedStop).toISOString();
                    $location.search('ended', self.jobsParams.ended).replace();
                }
            }
            self.getJobTypes();
            $rootScope.user = userService.getUserCreds();

            if ($rootScope.user) {
                $scope.readonly = false;
            }
            navService.updateLocation('jobs');
        };

        self.initialize();

        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset + scaleConfig.dateFilterOffset,
                gridMaxHeight = viewport.height - offset;

            $scope.gridStyle = 'height: ' + gridMaxHeight + 'px; max-height: ' + gridMaxHeight + 'px; overflow-y: auto;';
        });
    }]);
})();

(function(){
    angular.module('scaleApp').controller('jobExecutionLogController', ['$scope', '$location', '$element', '$timeout', 'jobExecutionService', 'scaleConfig', function($scope, $location, $element, $timeout, jobExecutionService, scaleConfig) {
        'use strict';
        var initialize = function(){

            $scope.forceScroll = true;

            $scope.jobLogError = null;

            $scope.$watch('execution', function (newValue, oldValue) {
                if ($scope.execution) {
                    jobExecutionService.getLog($scope.execution.id).then(null, null, function(result){
                        // get difference of max scroll length and current scroll length.
                        var logResult = result.execution_log;
                        if(result.$resolved){
                            var div = $($element[0]).find('.bash');
                            $scope.scrollDiff = (div.scrollTop() + div.prop('offsetHeight')) - div.prop('scrollHeight');
                            if($scope.scrollDiff >= 0){ $scope.forceScroll = true; }
                            $scope.execLog = logResult;
                        } else {
                            if (result.statusText && result.statusText !== '') {
                                $scope.jobLogErrorStatus = result.statusText;
                            }
                            $scope.jobLogError = 'Unable to retrieve job logs.';
                        }
                    });
                }
            });
            $scope.$watch('execLog', function (newValue, oldValue) {
                if ($scope.execLog) {
                    if($scope.forceScroll || $scope.scrollDiff >= 0){
                        $timeout(function(){
                            $scope.forceScroll = false;
                            var scrlHeight = $($element[0]).find('.bash').prop("scrollHeight");
                            $($element[0]).find('.bash').scrollTop(scrlHeight);
                        }, 50);
                    }
                }
            });
        };

        $scope.scrollitem = function(item){
                console.log(item);
        };

        $scope.stdoutChanged = function(){
            console.log('stdout changed.');
        };

        initialize();

    }]).directive('jobExecutionLog', function () {
        return {
            controller: 'jobExecutionLogController',
            templateUrl: 'modules/jobs/directives/jobExecutionLogTemplate.html',
            restrict: 'E',
            scope: {
                execution: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('aisJobHealthController', ['$rootScope', '$scope', 'jobTypeService', function ($rootScope, $scope, jobTypeService) {
        $scope.loadingJobHealth = true;
        $scope.jobHealthError = null;
        $scope.jobHealthErrorStatus = null;
        $scope.jobHealth = {};

        var getJobTypeStatus = function () {
            jobTypeService.getJobTypeStatus(null, null, $scope.duration, null).then(null, null, function (data) {
                if (data.$resolved) {
                    $scope.jobHealthError = null;
                    $scope.jobTypeStatus = data.results;
                    $scope.total = 0;
                    $scope.failed = 0;

                    var performance = {},
                        failures = [];

                    _.forEach(data.results, function (status) {
                        performance = status.getPerformance();
                        $scope.total = $scope.total + performance.total;
                        $scope.failed = $scope.failed + performance.failed;
                        failures.push(status.getFailures());
                    });

                    var failureData = [],
                        systemFailures = 0,
                        dataFailures = 0,
                        algorithmFailures = 0;

                    _.forEach(failures, function (f) {
                        _.forEach(f, function (type) {
                            if (type.status === 'SYSTEM') {
                                systemFailures = systemFailures + type.count;
                            } else if (type.status === 'DATA') {
                                dataFailures = dataFailures + type.count;
                            } else if (type.status === 'ALGORITHM') {
                                algorithmFailures = algorithmFailures + type.count;
                            }
                        });
                    });

                    if (systemFailures > 0 || dataFailures > 0 || algorithmFailures > 0) {
                        if (systemFailures > 0) {
                            failureData.push({
                                status: 'SYSTEM',
                                count: systemFailures
                            });
                        }
                        if (dataFailures > 0) {
                            failureData.push({
                                status: 'DATA',
                                count: dataFailures
                            });
                        }
                        if (algorithmFailures > 0) {
                            failureData.push({
                                status: 'ALGORITHM',
                                count: algorithmFailures
                            });
                        }
                    }

                    $scope.jobHealth = {
                        gaugeData: $scope.total === 0 ? 0 : 100 - (($scope.failed / $scope.total) * 100).toFixed(2),
                        donutData: failureData
                    };

                    if ($scope.broadcastData) {
                        $rootScope.$broadcast('jobTypeStatus', $scope.jobTypeStatus);
                    }
                } else {
                    if (data.statusText && data.statusText !== '') {
                        $scope.jobHealthErrorStatus = data.statusText;
                    }
                    $scope.jobHealthError = 'Unable to retrieve job statistics.';
                }
                $scope.loadingJobHealth = false;
            });
        };

        getJobTypeStatus();
    }]).directive('aisJobHealth', function(){
        /**
         * Usage: <ais-job-health />
         **/
        return {
            controller: 'aisJobHealthController',
            templateUrl: 'modules/jobs/directives/jobHealthTemplate.html',
            restrict: 'E',
            scope: {
                duration: '=',
                broadcastData: '=', // set to true when using another widget in the same view that also calls getJobTypeStatus
                showDescription: '='
            }
        };
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('jobTypeInterfaceDirectiveController', ['$rootScope', '$scope', 'jobTypeService', function ($rootScope, $scope, jobTypeService) {

    }]).directive('aisJobTypeInterface', function(){
        /**
         * Usage: <ais-job-health />
         **/
        return {
            controller: 'jobTypeInterfaceDirectiveController',
            templateUrl: 'modules/jobs/directives/jobTypeInterfaceTemplate.html',
            restrict: 'E',
            scope: {
                jobTypeInterface: '='
            }
        };
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Job', ['scaleConfig', 'JobType', 'scaleService', function (scaleConfig, JobType, scaleService) {
        var Job = function (id, job_type, event, error, status, priority, num_exes, timeout, max_tries, cpus_required, mem_required, disk_in_required, disk_out_required, created, queued, started, ended, last_status_change, last_modified) {
            this.id = id;
            this.job_type = JobType.transformer(job_type);
            this.event = event;
            this.error = error;
            this.status = status;
            this.priority = priority;
            this.num_exes = num_exes;
            this.timeout = timeout;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.disk_in_required = disk_in_required;
            this.disk_out_required = disk_out_required;
            this.created = created;
            this.created_formatted = moment.utc(created).toISOString();
            this.queued = queued;
            this.started = started;
            this.ended = ended;
            this.last_status_change = last_status_change;
            this.last_modified = last_modified;
            this.last_modified_formatted = moment.utc(last_modified).toISOString();
        };

        // public methods
        Job.prototype = {
            getDuration: function () {
                var start = this.started,
                    end = this.ended ? this.ended : moment.utc().toISOString();
                return scaleService.calculateDuration(start, end);
            }
        };

        // static methods, assigned to class
        Job.build = function (data) {
            if (data) {
                return new Job(
                    data.id,
                    data.job_type,
                    data.event,
                    data.error,
                    data.status,
                    data.priority,
                    data.num_exes,
                    data.timeout,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.disk_in_required,
                    data.disk_out_required,
                    data.created,
                    data.queued,
                    data.started,
                    data.ended,
                    data.last_status_change,
                    data.last_modified
                );
            }
            return new Job();
        };

        Job.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Job.build)
                    .filter(Boolean);
            }
            return Job.build(data);
        };

        return Job;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailEvent', ['JobDetailEventRule', function (JobDetailEventRule) {
        var JobDetailEvent = function (id, type, rule, occurred) {
            this.id = id;
            this.type = type;
            this.rule = JobDetailEventRule.transformer(rule);
            this.occurred = occurred;
        };

        // public methods
        JobDetailEvent.prototype = {

        };

        // static methods, assigned to class
        JobDetailEvent.build = function (data) {
            if (data) {
                return new JobDetailEvent(
                    data.id,
                    data.type,
                    data.rule,
                    data.occurred
                );
            }
            return new JobDetailEvent();
        };

        JobDetailEvent.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailEvent.build)
                    .filter(Boolean);
            }
            return JobDetailEvent.build(data);
        };

        return JobDetailEvent;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailEventRule', function () {
        var JobDetailEventRule = function (id, type, is_active, created, archived, last_modified) {
            this.id = id;
            this.type = type;
            this.is_active = is_active;
            this.created = created;
            this.archived = archived;
            this.last_modified = last_modified;
        };

        // public methods
        JobDetailEventRule.prototype = {

        };

        // static methods, assigned to class
        JobDetailEventRule.build = function (data) {
            if (data) {
                return new JobDetailEventRule(
                    data.id,
                    data.type,
                    data.is_active,
                    data.created,
                    data.archived,
                    data.last_modified
                );
            }
            return new JobDetailEventRule();
        };

        JobDetailEventRule.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailEventRule.build)
                    .filter(Boolean);
            }
            return JobDetailEventRule.build(data);
        };

        return JobDetailEventRule;
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailInputData', function () {
        var JobDetailInputData = function (name, value, file_id, file_ids, files) {
            this.name = name;
            this.value = value;
            this.file_id = file_id;
            this.file_ids = file_ids;
            this.files = files;
        };

        // public methods
        JobDetailInputData.prototype = {
            getValue: function () {
                if (this.value)
                    return this.value;
                if (this.file_id)
                    return this.file_id;
                if (this.file_ids)
                    return this.file_ids;
            }
        };

        // static methods, assigned to class
        JobDetailInputData.build = function (data) {
            if (data) {
                return new JobDetailInputData(
                    data.name,
                    data.value,
                    data.file_id,
                    data.file_ids,
                    data.files
                );
            }
            return new JobDetailInputData();
        };

        JobDetailInputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailInputData.build)
                    .filter(Boolean);
            }
            return JobDetailInputData.build(data);
        };

        return JobDetailInputData;
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetailOutputData', function () {
        var JobDetailOutputData = function (name, workspace_id, files) {
            this.name = name;
            this.workspace_id = workspace_id;
            this.files = files;
        };

        // public methods
        JobDetailOutputData.prototype = {

        };

        // static methods, assigned to class
        JobDetailOutputData.build = function (data) {
            if (data) {
                return new JobDetailOutputData(
                    data.name,
                    data.workspace_id,
                    data.files
                );
            }
            return new JobDetailOutputData();
        };

        JobDetailOutputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetailOutputData.build)
                    .filter(Boolean);
            }
            return JobDetailOutputData.build(data);
        };

        return JobDetailOutputData;
    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobDetails', ['scaleConfig', 'JobType', 'JobExecution', 'Product', 'JobDetailInputData', 'JobDetailOutputData', 'Recipe', 'JobDetailEvent', 'scaleService', function (scaleConfig, JobType, JobExecution, Product, JobDetailInputData, JobDetailOutputData, Recipe, JobDetailEvent, scaleService) {
        var JobDetails = function (id, job_type, job_type_rev, event, error, status, priority, num_exes, timeout, max_tries, cpus_required, mem_required, disk_in_required, disk_out_required, created, queued, started, ended, last_status_change, last_modified, data, results, recipes, job_exes, inputs, outputs) {
            this.id = id;
            this.job_type = JobType.transformer(job_type);
            this.job_type_rev = job_type_rev;
            this.event = JobDetailEvent.transformer(event);
            this.error = error;
            this.status = status;
            this.priority = priority;
            this.num_exes = num_exes;
            this.timeout = timeout;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.disk_in_required = disk_in_required;
            this.disk_out_required = disk_out_required;
            this.created = created;
            this.created_formatted = moment.utc(created).toISOString();
            this.queued = queued;
            this.queued_formatted = moment.utc(queued).toISOString();
            this.started = started;
            this.started_formatted = moment.utc(started).toISOString();
            this.ended = ended;
            this.ended_formatted = moment.utc(ended).toISOString();
            this.last_status_change = last_status_change;
            this.last_modified = last_modified;
            this.data = {
                input_data: JobDetailInputData.transformer(data.input_data),
                version: data.version,
                output_data: JobDetailOutputData.transformer(data.output_data)
            };
            this.results = {
                output_data: JobDetailOutputData.transformer(results.output_data),
                version: results.version
            };
            this.recipes = Recipe.transformer(recipes);
            this.job_exes = JobExecution.transformer(job_exes);
            this.inputs = inputs;
            this.outputs = outputs;
        };

        // public methods
        JobDetails.prototype = {
            getDuration: function () {
                return scaleService.calculateDuration(this.created, this.last_modified);
            },
            getLatestExecution: function(){
                if (this.num_exes > 0 ) {
                    return this.job_exes[0];
                }
                return null;
            },
            getStatusClass: function(){
                // if(this.status === 'COMPLETED'){
                //     return 'label-success';
                // }
                // else if( this.status === 'FAILED'){
                //     return 'label-default';//    return 'label-danger';
                // }
                // else{
                //     return 'label-default';
                // }
                return this.status.toLowerCase();
            }
        };

        // static methods, assigned to class
        JobDetails.build = function (data) {
            if (data) {
                return new JobDetails(
                    data.id,
                    data.job_type,
                    data.job_type_rev,
                    data.event,
                    data.error,
                    data.status,
                    data.priority,
                    data.num_exes,
                    data.timeout,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.disk_in_required,
                    data.disk_out_required,
                    data.created,
                    data.queued,
                    data.started,
                    data.ended,
                    data.last_status_change,
                    data.last_modified,
                    data.data,
                    data.results,
                    data.recipes,
                    data.job_exes,
                    data.inputs,
                    data.outputs
                );
            }
            return new JobDetails();
        };

        JobDetails.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobDetails.build)
                    .filter(Boolean);
            }
            return JobDetails.build(data);
        };

        return JobDetails;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobExecution', ['scaleConfig', 'Job', 'Node', 'moment', function (scaleConfig, Job, Node, moment) {
        var JobExecution = function (id, status, command_arguments, timeout, pre_started, pre_completed, pre_exit_code, job_started, job_completed, job_exit_code, post_started, post_completed, post_exit_code, created, queued, started, ended, last_modified, job, node, error, environment, cpus_scheduled, mem_scheduled, disk_in_scheduled, disk_out_scheduled, disk_total_scheduled, results, current_stdout_url, current_stderr_url, results_manifest) {
            this.id = id;
            this.status = status;
            this.command_arguments = command_arguments;
            this.timeout = timeout;
            this.pre_started = pre_started;
            this.pre_completed = pre_completed;
            this.pre_exit_code = pre_exit_code;
            this.job_started = job_started;
            this.job_completed = job_completed;
            this.job_exit_code = job_exit_code;
            this.post_started = post_started;
            this.post_completed = post_completed;
            this.post_exit_code = post_exit_code;
            this.created = created;
            this.created_formatted = created ? moment.utc(created).toISOString() : created;
            this.queued = queued;
            this.queued_formatted = queued ? moment.utc(queued).toISOString() : queued;
            this.started = started;
            this.started_formatted = started ? moment.utc(started).toISOString() : started;
            this.ended = ended;
            this.ended_formatted = ended ? moment.utc(ended).toISOString() : ended;
            this.last_modified = last_modified;
            this.last_modified_formatted = last_modified ? moment.utc(last_modified).toISOString() : last_modified;
            this.job = Job.transformer(job);
            this.node = Node.transformer(node);
            this.error = error;
            this.environment = environment;
            this.cpus_scheduled = cpus_scheduled;
            this.mem_scheduled = mem_scheduled;
            this.disk_in_scheduled = disk_in_scheduled;
            this.disk_out_scheduled = disk_out_scheduled;
            this.disk_total_scheduled = disk_total_scheduled;
            this.results = results;
            this.current_stdout_url = current_stdout_url;
            this.current_stderr_url = current_stderr_url;
            this.results_manifest = results_manifest;
        };

        // public methods
        JobExecution.prototype = {
            getDuration: function () {
                return moment.utc(this.job_completed).diff(moment.utc(this.job_started));
            },
            getIcon: function () {
                return this.job.jobType.iconCode ? '<i class="fa">&#x' + this.job.jobType.iconCode + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            }
        };

        // static methods, assigned to class
        JobExecution.build = function (data) {
            if (data) {
                return new JobExecution(
                    data.id,
                    data.status,
                    data.command_arguments,
                    data.timeout,
                    data.pre_started,
                    data.pre_completed,
                    data.pre_exit_code,
                    data.job_started,
                    data.job_completed,
                    data.job_exit_code,
                    data.post_started,
                    data.post_completed,
                    data.post_exit_code,
                    data.created,
                    data.queued,
                    data.started,
                    data.ended,
                    data.last_modified,
                    data.job,
                    data.node,
                    data.error,
                    data.environment,
                    data.cpus_scheduled,
                    data.mem_scheduled,
                    data.disk_in_scheduled,
                    data.disk_out_scheduled,
                    data.disk_total_scheduled,
                    data.results,
                    data.current_stdout_url,
                    data.current_stderr_url,
                    data.results_manifest
                );
            }
            return new JobExecution();
        };

        JobExecution.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobExecution.build)
                    .filter(Boolean);
            }
            return JobExecution.build(data);
        };

        return JobExecution;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobExecutionLog', ['scaleConfig', 'Job', 'Node', function (scaleConfig, Job, Node) {
        var JobExecutionLog = function (id, status, command_arguments, timeout, exit_code, created, queued, scheduled, pre_started, pre_completed, job_started, job_completed, post_started, post_completed, ended, last_modified, job, node, error, is_finished, stdout, stderr) {
            this.id = id;
            this.status = status;
            this.command_arguments = command_arguments;
            this.timeout = timeout;
            this.exit_code = exit_code;
            this.created = created;
            this.queued = queued;
            this.scheduled = scheduled;
            this.pre_started = pre_started;
            this.pre_completed = pre_completed;
            this.job_started = job_started;
            this.job_completed = job_completed;
            this.post_started = post_started;
            this.post_completed = post_completed;
            this.ended = ended;
            this.last_modified = last_modified;
            this.job = Job.transformer(job);
            this.node = Node.transformer(node);
            this.error = error;
            this.is_finished = is_finished;
            this.stdout = stdout;
            this.stdoutHtml = stdout ? stdout.replace(new RegExp('\r?\n','g'), '<br />') : '';
            this.stderr = stderr;
        };

        // public methods
        JobExecutionLog.prototype = {
            toHtml: function(instr){
                return instr
            }

        };

        // static methods, assigned to class
        JobExecutionLog.build = function (data) {
            if (data) {
                return new JobExecutionLog(
                    data.id,
                    data.status,
                    data.command_arguments,
                    data.timeout,
                    data.exit_code,
                    data.created,
                    data.queued,
                    data.scheduled,
                    data.pre_started,
                    data.pre_completed,
                    data.job_started,
                    data.job_completed,
                    data.post_started,
                    data.post_completed,
                    data.ended,
                    data.last_modified,
                    data.job,
                    data.node,
                    data.error,
                    data.is_finished,
                    data.stdout,
                    data.stderr
                );
            }
            return new JobExecutionLog();
        };

        JobExecutionLog.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobExecutionLog.build)
                    .filter(Boolean);
            }
            return JobExecutionLog.build(data);
        };

        return JobExecutionLog;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobType', ['scaleConfig', 'JobTypeInterface', function (scaleConfig, JobTypeInterface) {
        var JobType = function (id, name, title, version, description, is_system, is_long_running, is_active, is_operational, is_paused, uses_docker, docker_privileged, docker_image, priority, timeout, max_tries, cpus_required, mem_required, disk_out_const_required, disk_out_mult_required, icon_code, created, archived, paused, last_modified, job_type_interface) {
            this.id = id;
            this.name = name;
            this.title = title;
            this.version = version;
            this.description = description;
            this.is_system = is_system;
            this.is_long_running = is_long_running;
            this.is_active = is_active;
            this.is_operational = is_operational;
            this.is_paused = is_paused;
            this.uses_docker = uses_docker;
            this.docker_privileged = docker_privileged;
            this.docker_image = docker_image;
            this.priority = priority;
            this.timeout = timeout;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.disk_out_const_required = disk_out_const_required;
            this.disk_out_mult_required = disk_out_mult_required;
            this.icon_code = icon_code;
            this.created = created;
            this.archived = archived;
            this.paused = paused;
            this.last_modified = last_modified;
            this.job_type_interface = JobTypeInterface.transformer(job_type_interface);
        };

        // public methods
        JobType.prototype = {
            toString: function () {
                return 'JobType';
            },
            getIcon: function () {
                return this.icon_code ? '<i class="fa">&#x' + this.icon_code + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            },
            getCellText: function () {
                return this.icon_code ? '&#x' + this.icon_code + ';' : '&#x' + scaleConfig.defaultIconCode + ';';
            },
            getCellTitle: function () {
                return this.title;
            }
        };

        // static methods, assigned to class
        JobType.build = function (data) {
            if (data) {
                return new JobType(
                    data.id,
                    data.name,
                    data.title,
                    data.version,
                    data.description,
                    data.is_system,
                    data.is_long_running,
                    data.is_active,
                    data.is_operational,
                    data.is_paused,
                    data.uses_docker,
                    data.docker_privileged,
                    data.docker_image,
                    data.priority,
                    data.timeout,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.disk_out_const_required,
                    data.disk_out_mult_required,
                    data.icon_code,
                    data.created,
                    data.archived,
                    data.paused,
                    data.last_modified,
                    data.interface
                );
            }
            return new JobType();
        };

        JobType.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobType.build)
                    .filter(Boolean);
            }
            return JobType.build(data);
        };

        return JobType;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeDetails', ['scaleConfig', 'JobTypeInterface', 'JobTypeErrorMapping', 'JobTypeError', 'scaleService', function (scaleConfig, JobTypeInterface, JobTypeErrorMapping, JobTypeError, scaleService) {
        var JobTypeDetails = function (id, name, version, title, description, category, author_name, author_url, is_system, is_long_running, is_active, is_operational, is_paused, icon_code, uses_docker, docker_privileged, docker_image, priority, timeout, max_tries, cpus_required, mem_required, disk_out_const_required, disk_out_mult_required, created, archived, paused, last_modified, job_type_interface, error_mapping, errors, job_counts_6h, job_counts_12h, job_counts_24h) {
            this.id = id;
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            this.category = category;
            this.author_name = author_name;
            this.author_url = author_url;
            this.is_system = is_system;
            this.is_long_running = is_long_running;
            this.is_active = is_active;
            this.is_operational = is_operational;
            this.is_paused = is_paused;
            this.icon_code = icon_code;
            this.uses_docker = uses_docker;
            this.docker_privileged = docker_privileged;
            this.docker_image = docker_image;
            this.priority = priority;
            this.timeout = timeout;
            this.max_tries = max_tries;
            this.cpus_required = cpus_required;
            this.mem_required = mem_required;
            this.mem_required_formatted = scaleService.calculateFileSizeFromMib(mem_required);
            this.disk_out_const_required = disk_out_const_required;
            this.disk_out_const_required_formatted = scaleService.calculateFileSizeFromMib(disk_out_const_required);
            this.disk_out_mult_required = disk_out_mult_required;
            this.created = created;
            this.archived = archived;
            this.paused = paused;
            this.last_modified = last_modified;
            this.job_type_interface = job_type_interface;
            this.error_mapping = JobTypeErrorMapping.transformer(error_mapping);
            this.errors = JobTypeError.transformer(errors);
            this.job_counts_6h = job_counts_6h;
            this.job_counts_12h = job_counts_12h;
            this.job_counts_24h = job_counts_24h;
        };

        // public methods
        JobTypeDetails.prototype = {
            getIcon: function () {
                return this.icon_code ? '<i class="fa">&#x' + this.icon_code + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            },
            getPerformance: function () {
                var failed6Arr = _.where(this.job_counts_6h, { 'status': 'FAILED' }),
                    failed12Arr = _.where(this.job_counts_12h, { 'status': 'FAILED' }),
                    failed24Arr = _.where(this.job_counts_24h, { 'status': 'FAILED' });

                var completed6 = _.find(this.job_counts_6h, 'status', 'COMPLETED') || { count: 0 },
                    failed6 = _.sum(failed6Arr, 'count'),
                    total6 = failed6Arr.length > 0 ? failed6 + completed6.count : completed6.count,
                    successRate6 = total6 === 0 ? 0 : 100 - ((failed6 / total6) * 100).toFixed(2),
                    completed12 = _.find(this.job_counts_12h, 'status', 'COMPLETED') || { count: 0 },
                    failed12 = _.sum(failed12Arr, 'count'),
                    total12 = failed12Arr.length > 0 ? failed12 + completed12.count : completed12.count,
                    successRate12 = total12 === 0 ? 0 : 100 - ((failed12 / total12) * 100).toFixed(2),
                    completed24 = _.find(this.job_counts_24h, 'status', 'COMPLETED') || { count: 0 },
                    failed24 = _.sum(failed24Arr, 'count'),
                    total24 = failed24Arr.length > 0 ? failed24 + completed24.count : completed24.count,
                    successRate24 = total24 === 0 ? 0 : 100 - ((failed24 / total24) * 100).toFixed(2);

                return {
                    hour6: {
                        rate: successRate6,
                        failed: failed6,
                        completed: completed6.count,
                        total: total6
                    },
                    hour12: {
                        rate: successRate12,
                        failed: failed12,
                        completed: completed12.count,
                        total: total12
                    },
                    hour24: {
                        rate: successRate24,
                        failed: failed24,
                        completed: completed24.count,
                        total: total24
                    }
                };
            },
            getFailures: function () {
                var failed6 = _.where(this.job_counts_6h, { 'status': 'FAILED' }),
                    failed6Values = _.values(_.groupBy(failed6, 'category')),
                    failed12 = _.where(this.job_counts_12h, { 'status': 'FAILED' }),
                    failed12Values = _.values(_.groupBy(failed12, 'category')),
                    failed24 = _.where(this.job_counts_24h, { 'status': 'FAILED' }),
                    failed24Values = _.values(_.groupBy(failed24, 'category'));

                var getFailureCounts = function (categories) {
                    var returnArr = [];
                    _.forEach(categories, function (category) {
                        _.forEach(category, function (val) {
                            returnArr.push({ status: val.category, count: val.count });
                        });
                    });
                    return returnArr;
                };

                return {
                    hour6: getFailureCounts(failed6Values),
                    hour12: getFailureCounts(failed12Values),
                    hour24: getFailureCounts(failed24Values)
                };
            }
        };

        // static methods, assigned to class
        JobTypeDetails.build = function (data) {
            if (data) {
                return new JobTypeDetails(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.category,
                    data.author_name,
                    data.author_url,
                    data.is_system,
                    data.is_long_running,
                    data.is_active,
                    data.is_operational,
                    data.is_paused,
                    data.icon_code,
                    data.uses_docker,
                    data.docker_privileged,
                    data.docker_image,
                    data.priority,
                    data.timeout,
                    data.max_tries,
                    data.cpus_required,
                    data.mem_required,
                    data.disk_out_const_required,
                    data.disk_out_mult_required,
                    data.created,
                    data.archived,
                    data.paused,
                    data.last_modified,
                    data.interface,
                    data.error_mapping,
                    data.errors,
                    data.job_counts_6h,
                    data.job_counts_12h,
                    data.job_counts_24h
                );
            }
            return new JobTypeDetails();
        };

        JobTypeDetails.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeDetails.build);
            }
            return JobTypeDetails.build(data);
        };

        return JobTypeDetails;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeError', ['moment', 'scaleConfig', function (moment, scaleConfig) {
        var JobTypeError = function (id, name, title, description, category, created, last_modified) {
            this.id = id;
            this.name = name;
            this.title = title;
            this.description = description;
            this.category = category;
            this.created = created;
            this.created_formatted = created ? moment.utc(created).toISOString() : created;
            this.last_modified = last_modified;
            this.last_modified_formatted = last_modified ? moment.utc(last_modified).toISOString() : last_modified;
        };

        // public methods
        JobTypeError.prototype = {

        };

        // static methods, assigned to class
        JobTypeError.build = function (data) {
            if (data) {
                return new JobTypeError(
                    data.id,
                    data.name,
                    data.title,
                    data.description,
                    data.category,
                    data.created,
                    data.last_modified
                );
            }
            return new JobTypeError();
        };

        JobTypeError.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeError.build)
                    .filter(Boolean);
            }
            return JobTypeError.build(data);
        };

        return JobTypeError;
    }])
})();

(function () {
    'use strict';
    
    angular.module('scaleApp').factory('JobTypeErrorMapping', function () {
        var JobTypeErrorMapping = function (version, exit_codes) {
            this.version = version;
            this.exit_codes = exit_codes;
        };

        // public methods
        JobTypeErrorMapping.prototype = {

        };

        // static methods, assigned to class
        JobTypeErrorMapping.build = function (data) {
            if (data) {
                return new JobTypeErrorMapping(
                    data.version,
                    data.exit_codes
                );
            }
            return new JobTypeErrorMapping();
        };

        JobTypeErrorMapping.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeErrorMapping.build)
                    .filter(Boolean);
            }
            return JobTypeErrorMapping.build(data);
        };

        return JobTypeErrorMapping;
    })
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeInputData', ['scaleConfig', function (scaleConfig) {
        var JobTypeInputData = function (media_types, required, type, name) {
            this.media_types = media_types;
            this.required = required;
            this.type = type;
            this.name = name;
        };

        // public methods
        JobTypeInputData.prototype = {

        };

        // static methods, assigned to class
        JobTypeInputData.build = function (data) {
            if (data) {
                return new JobTypeInputData(
                    data.media_types,
                    data.required,
                    data.type,
                    data.name
                );
            }
            return new JobTypeInputData();
        };

        JobTypeInputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeInputData.build);
            }
            return JobTypeInputData.build(data);
        };

        return JobTypeInputData;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeInterface', ['scaleConfig', 'JobTypeInputData', 'JobTypeOutputData', function (scaleConfig, JobTypeInputData, JobTypeOutputData) {
        var JobTypeInterface = function (version, command, command_arguments, input_data, output_data) {
            this.version = version;
            this.command = command;
            this.command_arguments = command_arguments;
            this.input_data = JobTypeInputData.transformer(input_data);
            this.output_data = JobTypeOutputData.transformer(output_data);
        };

        // public methods
        JobTypeInterface.prototype = {
            getIcon: function () {
                return this.iconCode ? '<i class="fa">&#x' + this.iconCode + '</i>' : '<i class="fa">&#x' + scaleConfig.defaultIconCode + '</i>';
            }
        };

        // static methods, assigned to class
        JobTypeInterface.build = function (data) {
            if (data) {
                return new JobTypeInterface(
                    data.version,
                    data.command,
                    data.command_arguments,
                    data.input_data,
                    data.output_data
                );
            }
            return new JobTypeInterface();
        };

        JobTypeInterface.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeInterface.build)
                    .filter(Boolean);
            }
            return JobTypeInterface.build(data);
        };

        return JobTypeInterface;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeOutputData', function () {
        var JobTypeOutputData = function (name, type, required, media_type) {
            this.name = name;
            this.type = type;
            this.required = required;
            this.media_type = media_type;
        };

        // public methods
        JobTypeOutputData.prototype = {

        };

        // static methods, assigned to class
        JobTypeOutputData.build = function (data) {
            if (data) {
                return new JobTypeOutputData(
                    data.name,
                    data.type,
                    data.required,
                    data.media_type
                );
            }
            return new JobTypeOutputData();
        };

        JobTypeOutputData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeOutputData.build)
                    .filter(Boolean);
            }
            return JobTypeOutputData.build(data);
        };

        return JobTypeOutputData;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('JobTypeStatus', ['scaleConfig', 'JobType', 'JobExecution', function (scaleConfig, JobType, JobExecution) {
        var JobTypeStatus = function (job_type, job_counts) {
            this.job_type = JobType.transformer(job_type);
            this.job_counts = job_counts;
            this.has_running = _.find(job_counts, 'status', 'RUNNING');
            this.description = this.getPerformance().rateDescription;
        };

        // public methods
        JobTypeStatus.prototype = {
            toString: function () {
                return 'JobTypeStatus';
            },
            getPerformance: function () {
                var failedArr = _.where(this.job_counts, { 'status': 'FAILED' });

                var completed = _.find(this.job_counts, 'status', 'COMPLETED') || { count: 0 },
                    failed = _.sum(failedArr, 'count'),
                    total = failedArr.length > 0 ? failed + completed.count : completed.count,
                    successRate = total === 0 ? 0 : 100 - ((failed / total) * 100).toFixed(2),
                    successRateDescription = 'success';

                if (successRate <= 30 && total > 0) {
                    successRateDescription = 'error';
                } else if (successRate > 30 && successRate <= 60 && total > 0) {
                    successRateDescription = 'warning';
                } else if (total === 0 && !this.has_running) {
                    successRateDescription = 'z_inactive'; // prepend with 'z_' for ordering purposes
                }

                return {
                    rate: successRate,
                    rateDescription: successRateDescription,
                    failed: failed,
                    completed: completed.count,
                    total: total
                };
            },
            getRunning: function () {
                return _.find(this.job_counts, 'status', 'RUNNING') || { count: 0 };
            },
            getFailures: function () {
                var failed = _.where(this.job_counts, { 'status': 'FAILED' }),
                    failedValues = _.values(_.groupBy(failed, 'category'));

                var getFailureCounts = function (categories) {
                    var returnArr = [];
                    _.forEach(categories, function (category) {
                        _.forEach(category, function (val) {
                            returnArr.push({ status: val.category, count: val.count });
                        });
                    });
                    return returnArr;
                };

                return getFailureCounts(failedValues);
            },
            getCellFill: function () {
                var status = this.getPerformance().rateDescription;
                if (status === 'success') {
                    return scaleConfig.colors.chart_green;
                } else if (status === 'warning') {
                    return scaleConfig.colors.chart_yellow;
                } else if (status === 'error') {
                    return scaleConfig.colors.chart_red;
                } else if (status === 'z_inactive') {
                    return scaleConfig.colors.chart_gray_dark;
                }
            },
            getCellActivity: function () {
                var running = this.getRunning();
                if (running.count > 0) {
                    return '&#x' + scaleConfig.activityIconCode + ';';
                }
                return '';
            },
            getCellActivityTotal: function () {
                return this.getRunning().count > 0 ? this.getRunning().count : '';
            },
            getCellError: function () {
                var performance = this.getPerformance();
                return 'Failed: ' + (performance.failed);
            },
            getCellTotal: function () {
                var performance = this.getPerformance();
                return 'Completed: ' + performance.completed;
            },
            getCellPauseResume: function () {
                return;
            },
            getCellFailures: function () {
                return _.map(this.getFailures(), 'status');
            }
        };

        // static methods, assigned to class
        JobTypeStatus.build = function (data) {
            if (data) {
                return new JobTypeStatus(
                    data.job_type,
                    data.job_counts
                );
            }
            return new JobTypeStatus();
        };

        JobTypeStatus.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(JobTypeStatus.build)
                    .filter(Boolean);
            }
            return JobTypeStatus.build(data);
        };

        return JobTypeStatus;
    }]);
})();

(function (){
    'use strict';

    angular.module('scaleApp').factory('Product', ['JobType', 'scaleService', 'scaleConfig', function (JobType, scaleService, scaleConfig) {
        var Product = function (id, workspace, file_name, media_type, file_size, data_type, is_deleted, uuid, url, created, deleted, data_started, data_ended, geometry, center_point, meta_data, countries, last_modified, is_operational, is_published, published, unpublished, job_type, job, job_exe, update, source_files) {
            this.id = id;
            this.workspace = workspace;
            this.file_name = file_name;
            this.media_type = media_type;
            this.file_size = file_size;
            this.file_size_readable = this.getReadableFileSize();
            this.data_type = data_type;
            this.is_deleted = is_deleted;
            this.uuid = uuid;
            this.url = url;
            this.created = created;
            this.created_formatted = created ? moment.utc(created).toISOString() : created;
            this.deleted = deleted;
            this.data_started = data_started;
            this.data_ended = data_ended;
            this.geometry = geometry;
            this.center_point = center_point;
            this.meta_data = meta_data;
            this.countries = countries;
            this.last_modified = last_modified;
            this.last_modified_formatted = last_modified ? moment.utc(last_modified).toISOString() : last_modified;
            this.is_operational = is_operational;
            this.is_operational_label = is_operational ? 'Operational' : 'R&amp;D';
            this.is_published = is_published;
            this.published = published;
            this.unpublished = unpublished;
            this.job_type = JobType.transformer(job_type);
            this.job = job;
            this.job_exe = job_exe;
            this.update = update;
            this.source_files = source_files;
        };

        // public methods
        Product.prototype = {
            getDuration: function () {
                return moment.utc(this.last_modified).diff(moment.utc(this.created));
            },
            getReadableFileSize: function () {
                return scaleService.calculateFileSizeFromBytes(this.file_size);
            }
        };

        // static methods, assigned to class
        Product.build = function (data) {
            if (data) {
                return new Product(
                    data.id,
                    data.workspace,
                    data.file_name,
                    data.media_type,
                    data.file_size,
                    data.data_type,
                    data.is_deleted,
                    data.uuid,
                    data.url,
                    data.created,
                    data.deleted,
                    data.data_started,
                    data.data_ended,
                    data.geometry,
                    data.center_point,
                    data.meta_data,
                    data.countries,
                    data.last_modified,
                    data.is_operational,
                    data.is_published,
                    data.published,
                    data.unpublished,
                    data.job_type,
                    data.job,
                    data.job_exe,
                    data.update,
                    data.source_files
                );
            }
            return new Product();
        };

        Product.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Product.build)
                    .filter(Boolean);
            }
            return Product.build(data);
        };

        return Product;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RunningJob', ['scaleConfig', 'scaleService', 'JobType', function (scaleConfig, scaleService, JobType) {
        var RunningJob = function (count, longest_running, job_type) {
            this.count = count;
            this.longest_running = longest_running;
            this.job_type = JobType.transformer(job_type);
        };

        // public methods
        RunningJob.prototype = {
            getDuration: function () {
                return scaleService.calculateDuration(this.longest_running, moment.utc().toISOString());
            },
            getIcon: function () {
                var configJobType = _.find(scaleConfig.jobTypes, 'title', this.job_type.name);
                if (configJobType) {
                    return configJobType.icon;
                }
                return scaleConfig.defaultIcon;
            }
        };

        // static methods, assigned to class
        RunningJob.build = function (data) {
            if (data) {
                return new RunningJob(
                    data.count,
                    data.longest_running,
                    data.job_type
                );
            }
            return new RunningJob();
        };

        RunningJob.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RunningJob.build)
                    .filter(Boolean);
            }
            return RunningJob.build(data);
        };

        return RunningJob;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('SystemFailure', ['scaleConfig', 'scaleService', function (scaleConfig, scaleService) {
        var SystemFailure = function (count, job_type_name, job_type_version, error_name, first_error, last_error) {
            this.count = count;
            this.job_type_name = job_type_name;
            this.job_type_version = job_type_version;
            this.error_name = error_name;
            this.first_error = first_error;
            this.last_error = last_error;
        };

        // public methods
        SystemFailure.prototype = {
            getDuration: function () {
                return scaleService.calculateDuration(this.first_error, this.last_error);
            },
            getIcon: function () {
                var configJobType = _.find(scaleConfig.jobTypes, 'title', this.job_type_name);
                if (configJobType) {
                    return configJobType.icon;
                }
                return scaleConfig.defaultIcon;
            }
        };

        // static methods, assigned to class
        SystemFailure.build = function (data) {
            if (data) {
                return new SystemFailure(
                    data.count,
                    data.job_type_name,
                    data.job_type_version,
                    data.error_name,
                    data.first_error,
                    data.last_error
                );
            }
            return new SystemFailure();
        };

        SystemFailure.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(SystemFailure.build)
                    .filter(Boolean);
            }
            return SystemFailure.build(data);
        };

        return SystemFailure;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('jobExecutionService', ['$http', '$q', '$resource', 'poller', 'scaleConfig', 'JobExecution', 'JobExecutionLog', function ($http, $q, $resource, poller, scaleConfig, JobExecution, JobExecutionLog) {

        var getJobExecutionsParams = function( pageNumber, pageSize, filter ){
            var params = {
                page: pageNumber,
                page_size: pageSize
            };
            var jobTypeId = filter.job_type_id ? filter.jobTypeId : '';
            var jobStatus = filter.status ? filter.jobStatus : '';

            if (jobStatus && jobStatus !== '') {
                params.job_status = jobStatus;
            }
            return params;
        };

        return {
            getJobExecutions: function (pageNumber, pageSize, filter) {
                var jobExecutions = [],
                    d = $q.defer();

                var params = getJobExecutionsParams(pageNumber, pageSize, filter);
                $http({
                    url: scaleConfig.urls.apiPrefix + 'job-executions/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    jobExecutions.executions = JobExecution.transformer(data.results);
                    jobExecutions.count = data.count;
                    d.resolve(jobExecutions);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobExecutionDetails: function (id) {
                var d = $q.defer();

                $http.get(scaleConfig.urls.apiPrefix + 'job-executions/' + id + '/').success(function (data) {
                    d.resolve(JobExecution.transformer(data));
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getLogOnce: function(execId){
                var d = $q.defer();

                $http.get(scaleConfig.urls.apiPrefix + 'job-executions/' + execId + '/logs/').success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getLog: function(execId){
                var url = url || scaleConfig.urls.apiPrefix + 'job-executions/' + execId + '/logs/';

                // Update view. Since a promise can only be resolved or rejected once but we want
                // to keep track of all requests, poller service uses the notifyCallback. By default
                // poller only gets notified of success responses.
                var jobExecutionLogResource = $resource(url);
                var jobExecutionLogPoller = poller.get(jobExecutionLogResource, {
                        delay: scaleConfig.pollIntervals.jobExecutionLog
                    });

                return jobExecutionLogPoller.promise.then(null, null, function (result) {
                    if(result.$resolved){
                        result.execution_log = JobExecutionLog.transformer(result);
                        if(result.execution_log.status === 'COMPLETED' || result.execution_log.status === 'FAILED'){
                            jobExecutionLogPoller.stop();
                        }
                        return result;
                    } else {
                        jobExecutionLogPoller.stop();
                        return result;
                    }

                });
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('jobService', ['$http', '$q', '$resource', 'scaleConfig', 'Job', 'JobDetails', 'RunningJob', 'poller', 'pollerFactory', function($http, $q, $resource, scaleConfig, Job, JobDetails, RunningJob, poller, pollerFactory) {

        var getJobsParams = function (page, page_size, started, ended, order, status, job_type_id, job_type_name, job_type_category, url) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order,
                status: status,
                job_type_id: job_type_id,
                job_type_name: job_type_name,
                job_type_category: job_type_category,
                url: url
            };
        };

        var getJobUpdateData = function (status) {
            return {
                status: status
            };
        };

        return {
            getJobs: function (params) {
                params = params || getJobsParams();
                params.url = params.url ? params.url : scaleConfig.urls.apiPrefix + 'jobs/';

                var jobsResource = $resource(params.url, params),
                    jobsPoller = pollerFactory.newPoller(jobsResource, scaleConfig.pollIntervals.jobs);

                return jobsPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        data.results = Job.transformer(data.results);
                    } else {
                        jobsPoller.stop();
                    }
                    return data;
                });
            },
            getJobsOnce: function (params) {
                params = params || getJobsParams();
                var d = $q.defer();

                $http({
                    url: params.url ? params.url : scaleConfig.urls.apiPrefix + 'jobs/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = Job.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            getJobCountsByStatus: function (hour) {
                hour = hour || 3;
                var d = $q.defer();

                $http.get(scaleConfig.urls.getJobCountsByStatus(hour)).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobDetail: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.urls.apiPrefix + 'jobs/' + id + '/').success(function (data) {
                    d.resolve(JobDetails.transformer(data));
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getRunningJobs: function (pageNumber, pageSize) {
                var params = {
                    pageNumber: pageNumber,
                    pageSize: pageSize
                };
                var runningJobsResource = $resource(scaleConfig.urls.apiPrefix + 'job-types/running/', params),
                    runningJobsPoller = pollerFactory.newPoller(runningJobsResource, scaleConfig.pollIntervals.runningJobs);

                return runningJobsPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        data.results = RunningJob.transformer(data.results);
                    } else {
                        runningJobsPoller.stop();
                    }
                    return data;
                });
            },
            getRunningJobsOnce: function (pageNumber, pageSize) {
                var params = {
                    pageNumber: pageNumber,
                    pageSize: pageSize
                };
                var d = $q.defer();

                $http.get(scaleConfig.urls.apiPrefix + 'job-types/running/', params).success(function (data) {
                    data.results = RunningJob.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            updateJob: function (id, data) {
                data = data || getJobUpdateData();
                var d = $q.defer();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'jobs/' + id + '/',
                    method: 'PATCH',
                    data: data
                }).success(function (result) {
                    d.resolve(result);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('jobTypeService', ['$http', '$q', '$resource', 'poller', 'pollerFactory', 'scaleConfig', 'jobService', 'JobType', 'JobTypeDetails', 'JobTypeStatus', function ($http, $q, $resource, poller, pollerFactory, scaleConfig, jobService, JobType, JobTypeDetails, JobTypeStatus) {
        /*var totalJobTypes = 5;

        var getTotalJobTypes = function () {
            return totalJobTypes;
        };

        var setTotalJobTypes = function () {
            totalJobTypes = Math.floor(Math.random() * (20 - 1 + 1)) + 1;
        };

        setInterval(function () {
            setTotalJobTypes();
        }, 3100);*/

        var getJobTypeStatusParams = function (page, page_size, started, ended) {
            var params = {};

            if (page) { params.page = page; }
            if (page_size) { params.page_size = page_size; }
            if (started) { params.started = started; }
            if (ended) { params.ended = ended; }

            return params;
        };

        return {
            getJobTypes: function (order) {
                var params = {
                    order: order || ['name','version']
                };

                var jobTypesResource = $resource(scaleConfig.urls.apiPrefix + 'job-types/', params),
                    jobTypesPoller = pollerFactory.newPoller(jobTypesResource, scaleConfig.pollIntervals.jobTypes);

                return jobTypesPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        /*var returnResult = {
                            $resolved: true,
                            job_types: []
                        };
                        for (var i = 1; i < getTotalJobTypes(); i++) {
                            returnResult.job_types.push(
                                {
                                    "is_system": true,
                                    "paused": null,
                                    "disk": 64.0,
                                    "id": i,
                                    "docker_image": null,
                                    "archived": null,
                                    "uses_docker": false,
                                    "priority": 10,
                                    "version": "1.0",
                                    "icon_code": scaleConfig.jobTypes[i - 1].code,
                                    "description": "Ingests a source file into a workspace",
                                    "mem": 64.0,
                                    "is_active": true,
                                    "cpus": 1.0,
                                    "last_modified": "2015-03-11T00:00:00Z",
                                    "max_tries": 3,
                                    "is_paused": false,
                                    "name": scaleConfig.jobTypes[i - 1].title,
                                    "created": "2015-03-11T00:00:00Z",
                                    "timeout": 1800,
                                    "is_long_running": false
                                }
                            )
                        }
                        result = returnResult;*/

                        data.results = JobType.transformer(data.results);
                        return data;
                    } else {
                        jobTypesPoller.stop();
                        return data;
                    }
                });
            },
            getJobTypesOnce: function (order) {
                order = order || ['name','version'];

                var d = $q.defer();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'job-types/',
                    method: 'GET',
                    params: { order: order }
                }).success(function (data) {
                    data.results = JobType.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobTypeStatus: function (page, page_size, started, ended) {
                var params = getJobTypeStatusParams(page, page_size, started, ended);

                var jobTypeStatusResource = $resource(scaleConfig.urls.apiPrefix + 'job-types/status/', params),
                    jobTypeStatusPoller = pollerFactory.newPoller(jobTypeStatusResource, scaleConfig.pollIntervals.jobTypeStatus);

                return jobTypeStatusPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        /*var returndata = {
                            $resolved: true,
                            job_type_stats: []
                        };
                        for (var i = 0; i < getTotalJobTypes(); i++) {
                            returndata.job_type_stats.push(
                                {
                                    "id": i,
                                    "icon_code": "",
                                    "name": "",
                                    "version": "",
                                    "num_completed": Math.floor(Math.random() * (20000 - 10000 + 1)) + 10000,
                                    "num_canceled": Math.floor(Math.random() * (100 - 20 + 1)) + 20,
                                    "num_error_DATA": Math.floor(Math.random() * (9000 - 20 + 1)) + 20,
                                    "num_error_SYSTEM": Math.floor(Math.random() * (9000 - 20 + 1)) + 20,
                                    "num_error_ALGORITHM": Math.floor(Math.random() * (9000 - 20 + 1)) + 20
                                }
                            )
                        }
                        data = returndata;*/

                        data.results = JobTypeStatus.transformer(data.results);
                    } else {
                        jobTypeStatusPoller.stop();
                    }
                    return data;
                });
            },
            getJobTypeStatusOnce: function (page, page_size, started, ended) {
                var d = $q.defer(),
                    params = getJobTypeStatusParams(page, page_size, started, ended);

                $http({
                    url: scaleConfig.urls.apiPrefix + 'job-types/status/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = JobTypeStatus.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getJobTypeDetails: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.urls.apiPrefix + 'job-types/' + id + '/').success(function (data) {
                    d.resolve(JobTypeDetails.transformer(data));
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            updateJobType: function (data){
                var updatedJobType = function(data){
                    return {
                        error_mappings: data.error_mappings,
                        is_paused: data.is_paused
                    };
                };
                var updatedData = updatedJobType(data);
                var d = $q.defer();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'job-types/' + data.id + '/',
                    method: 'PATCH',
                    data: updatedData
                }).success(function (result) {
                    d.resolve(JobTypeDetails.transformer(result));
                }).error(function (error) {
                    d.reject(error);
                });                
                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('metricsController', ['$scope', '$location', 'scaleConfig', 'scaleService', 'navService', 'metricsService', 'moment', function ($scope, $location, scaleConfig, scaleService, navService, metricsService, moment) {
        var chart = null,
            colArr = [],
            colNames = {},
            xArr = [],
            removeIds = [],
            yUnits = [],
            locationParams = {
                chart: null
            },
            self = this;

        $scope._ = _;
        $scope.moment = moment;
        $scope.loadingMetrics = false;
        $scope.chartArr = [];
        $scope.chartData = [];
        $scope.chartStyle = '';
        $scope.selectedDataType = {};
        $scope.inputStartDate = moment.utc().subtract(1, 'M').toDate();
        $scope.inputEndDate = moment.utc().toDate();
        $scope.openInputStart = function ($event) {
            $event.stopPropagation();
            $scope.inputStartOpened = true;
        };
        $scope.inputStartOpened = false;
        $scope.openInputEnd = function ($event) {
            $event.stopPropagation();
            $scope.inputEndOpened = true;
        };
        $scope.inputEndOpened = false;
        $scope.dateModelOptions = {
            timezone: '+000'
        };
        $scope.dataTypeFilterText = '';
        $scope.filtersApplied = [];
        $scope.filteredChoices = [];
        $scope.filteredChoicesOptions = [];
        $scope.selectedMetrics = [];
        $scope.columnGroupsOptions = [];
        $scope.columns = [];
        $scope.groups = [];
        $scope.chartTitle = '';
        $scope.chartDisplay = 'stacked';
        $scope.stackedClass = 'btn-primary';
        $scope.groupedClass = 'btn-default';
        $scope.subchartClass = 'btn-primary';
        $scope.subchartEnabled = false;
        $scope.chartType = 'bar';
        $scope.chartTypeDisplay = 'Bar';
        $scope.barClass = 'btn-primary';
        $scope.areaClass = 'btn-default';
        $scope.lineClass = 'btn-default';
        $scope.splineClass = 'btn-default';
        $scope.scatterClass = 'btn-default';

        /*
        // check for locationParams in query string, and update as necessary
        _.forEach(_.pairs(locationParams), function (param) {
            var value = _.at($location.search(), param[0]);
            if (value.length > 0) {
                locationParams[param[0]] = value.length > 1 ? value : value[0];
            }
        });

        if (locationParams.chart) {
            try {
                $scope.chartArr = JSON.parse(atob(locationParams.chart));
            } catch (e) {
                toastr['error']('Unable to parse JSON');
            }
        }
        */

        self.getPlotDataParams = function (obj) {
            return {
                page: null,
                page_size: null,
                started: obj.started,
                ended: obj.ended,
                choice_id: obj.choice_id,
                column: obj.column,
                group: obj.group,
                dataType: obj.dataType.name
            };
        };

        self.resetSelections = function () {
            $scope.inputStartDate = moment.utc().subtract(1, 'M').toDate();
            $scope.inputEndDate = moment.utc().toDate();
            $scope.selectedDataType = {};
            $scope.changeDataTypeSelection();
        };

        self.updateChart = function () {
            $scope.chartData = [];
            if ($scope.chartArr.length === 0) {
                // nothing to show on chart
                chart.destroy();
                chart = null;
            } else {
                var callInit = _.after($scope.chartArr.length, function () {
                    // only initChart after this function has been called for all datasets in chartArr
                    $scope.loadingMetrics = false;
                    self.initChart();
                });

                _.forEach($scope.chartArr, function (obj) {
                    var params = self.getPlotDataParams(obj);
                    metricsService.getPlotData(params).then(function (data) {
                    //metricsService.getGeneratedPlotData({query: obj, params: params}).then(function (data) {
                        $scope.chartData.push({
                            query: obj,
                            results: data.results
                        });
                        callInit();
                    }).catch(function (error) {
                        $scope.loadingMetrics = false;
                        console.log(error);
                        toastr['error'](error);
                    });
                });
                /*
                locationParams.chart = btoa(JSON.stringify($scope.chartArr));
                $location.search('chart', locationParams.chart).replace();
                */
            }
        };

        $scope.addToChart = function () {
            $scope.chartArr = []; // comment this out if allowing multiple adds
            $scope.loadingMetrics = true;
            var filteredChoices = [],
                selectedColumns = [];
            // find the filter object associated with the chosen filter IDs
            _.forEach($scope.filtersApplied, function (id) {
                filteredChoices.push(_.find($scope.filteredChoices, { id: parseInt(id) }));
            });
            if (angular.isArray($scope.selectedMetrics)) {
                _.forEach($scope.selectedMetrics, function (metric) {
                    selectedColumns.push(_.find($scope.columns, { name: metric }));
                });
            } else {
                selectedColumns.push(_.find($scope.columns, { name: $scope.selectedMetrics }));
            }
            $scope.chartArr.push({
                started: $scope.inputStartDate.toISOString(),
                ended: $scope.inputEndDate.toISOString(),
                choice_id: $scope.filtersApplied,
                column: _.pluck(selectedColumns, 'name'),
                group: null,
                dataType: $scope.selectedDataType,
                filtersApplied: filteredChoices,
                selectedMetrics: selectedColumns
            });
            self.updateChart();
            //self.resetSelections();
        };

        $scope.deleteFromChart = function (objToDelete) {
            _.remove($scope.chartArr, function (obj) {
                return JSON.stringify(obj) === JSON.stringify(objToDelete);
            });
            self.updateChart();
        };

        $scope.getFilterOptions = function (param) {
            return _.uniq(_.pluck($scope.filteredChoices, param));
        };

        $scope.changeDataTypeSelection = function () {
            // reset options
            $scope.filtersApplied = [];
            //$scope.filteredChoices = [];
            $scope.selectedDataTypeOptions = [];
            $scope.dataTypeFilterText = '';
            $scope.selectedMetrics = [];
            //$scope.columnGroups = [];
            $scope.columns = [];

            if (!$scope.selectedDataType.name || $scope.selectedDataType.name === '') {
                $scope.selectedDataType = {};
                self.getDataTypes();
            } else {
                self.getDataTypeOptions($scope.selectedDataType);
            }
        };

        /*$scope.changeFilterSelection = function (name) {
            console.log(name + ': ' + $scope.filtersApplied[name]);
            // remove filter if value is null or empty
            if (!$scope.filtersApplied[name] || $scope.filtersApplied[name] === '') {
                delete $scope.filtersApplied[name];
            }
            // update filtered choices
            applyFiltersToChoices();
        };*/

        $scope.areFiltersApplied = function () {
            return $scope.filtersApplied.length > 0;
        };

        /*$scope.removeFilter = function (name) {
            // set value = null
            $scope.filtersApplied[name] = '';
            // trigger filter selection change
            $scope.changeFilterSelection(name);
        };*/

        $scope.updateChartDisplay = function (display) {
            $scope.chartDisplay = display;
            $scope.stackedClass = display === 'stacked' ? 'btn-primary' : 'btn-default';
            $scope.groupedClass = display === 'grouped' ? 'btn-primary' : 'btn-default';
            self.initChart();
        };

        $scope.updateChartType = function (type) {
            $scope.chartType = type;
            $scope.chartTypeDisplay = _.capitalize(type);
            $scope.barClass = type === 'bar' ? 'btn-primary' : 'btn-default';
            $scope.areaClass = type === 'area' ? 'btn-primary' : 'btn-default';
            $scope.lineClass = type === 'line' ? 'btn-primary' : 'btn-default';
            $scope.splineClass = type === 'spline' ? 'btn-primary' : 'btn-default';
            $scope.scatterClass = type === 'scatter' ? 'btn-primary' : 'btn-default';
            self.initChart();
        };

        $scope.toggleSubchart = function () {
            $scope.subchartEnabled = !$scope.subchartEnabled;
            if ($scope.subchartEnabled) {
                $scope.subchartClass = 'btn-primary';
            } else {
                $scope.subchartClass = 'btn-default';
            }
        };

        self.initialize = function () {
            navService.updateLocation('metrics');
            self.getDataTypes();
            /*
            if ($scope.chartArr.length > 0) {
                self.updateChart();
            }
            */
        };

        /*var applyFiltersToChoices = function () {
            var choices = $scope.selectedDataTypeOptions ? $scope.selectedDataTypeOptions.choices : [];
            var filteredChoices = _.where(choices,$scope.filtersApplied);
            $scope.filteredChoices = filteredChoices;
        };*/

        self.getDataTypes = function () {
            metricsService.getDataTypes().then(function (result) {
                $scope.availableDataTypes = result.results;
            }).catch(function (error) {
                console.log(error);
                toastr['error'](error);
            });
        };

        self.getDataType = function (id) {
            metricsService.getDataTypeMetrics(id).then(function (result) {
                $scope.selectedDataTypeAvailableMetrics = result.metrics;
            }).catch(function (error) {
                console.log(error);
            });
        };

        self.getDataTypeOptions = function (dataType) {
            metricsService.getDataTypeOptions(dataType.name).then(function (result) {
                $scope.selectedDataTypeOptions = result;
                _.forEach(result.filters, function (filter) {
                    $scope.dataTypeFilterText = $scope.dataTypeFilterText.length === 0 ? _.capitalize(filter.param) : $scope.dataTypeFilterText + ', ' + _.capitalize(filter.param);
                });
                $scope.filteredChoices = _.sortByOrder(result.choices, ['title','version'], ['asc','asc']);
                // format filteredChoices for use with multiselect directive
                var filteredChoicesOptions = [];
                _.forEach($scope.filteredChoices, function (choice) {
                    filteredChoicesOptions.push({
                        label: choice.version ? choice.title + ' ' + choice.version : choice.title,
                        title: choice.version ? choice.title + ' ' + choice.version : choice.title,
                        value: choice.id
                    });
                });
                $scope.filteredChoicesOptions = filteredChoicesOptions;
                $scope.columns = _.sortByOrder(result.columns, ['title'], ['asc']);
                $scope.groups = result.groups;

                // create an array of objects containing grouped columns
                var columnGroupsOptions = [],
                    columnGroups = _.pairs(_.groupBy(result.columns, 'group'));
                _.forEach(columnGroups, function (group) {
                    var option = {
                        label: _.find($scope.groups, { name: group[0] }).title,
                        children: []
                    };
                    _.forEach(group[1], function (column) {
                        var child = {
                            label: column.title,
                            title: column.title,
                            value: column.name
                        };
                        option.children.push(child);
                    });
                    columnGroupsOptions.push(option);
                });
                columnGroupsOptions.unshift({
                    label: 'None Selected',
                    title: 'None Selected',
                    value: ''
                });
                $scope.columnGroupsOptions = columnGroupsOptions;
            }).catch(function (error){
                console.log(error);
                toastr['error'](error);
            });
        };

        self.initialize();

        $scope.$watch('inputEndDate', function (value) {
            console.log(value)
        });

        // set up chart
        self.initChart = function () {
            // mark any existing data for removal
            // compare currCols (columns currently in the chart) with displayCols (columns to display)
            removeIds = [];
            var currCols = [],
                displayCols = [];
            _.forEach(colArr, function (col, idx) {
                if (idx > 0) {
                    currCols.push(col[0]);
                }
            });
            _.forEach($scope.chartData, function (d) {
                displayCols = displayCols.concat(_.pluck(d.query.filtersApplied, 'name'));
            });
            // determine the exact differences between currCols and displayCols
            // if none are found, then removeIds stays empty
            _.forEach(currCols, function (currCol) {
                var displayCol = _.find(displayCols, function (dCol) {
                    return dCol === currCol;
                });
                if (!displayCol) {
                    removeIds.push(currCol);
                }
            });

            // init with new data
            colArr = [];
            xArr = [];
            colNames = {};

            // create xArr
            var numDays = moment.utc($scope.inputEndDate).endOf('d').diff(moment.utc($scope.inputStartDate.toISOString()).startOf('d'), 'd') + 1; // add 1 to include starting day in count
            for (var i = 0; i < numDays; i++) {
                xArr.push(moment.utc($scope.inputStartDate.toISOString()).startOf('d').add(i, 'd').toDate());
            }

            // iterate over datatypes and add values to colArr
            _.forEach($scope.chartData, function (data) {
                var valueArr = [],
                    query = data.query,
                    queryFilter = {},
                    queryDates = [];

                yUnits = _.pluck(query.selectedMetrics, 'units');

                if (query.filtersApplied.length > 0) {
                    // filters were applied, so build data source accordingly
                    _.forEach(data.results, function (result) {
                        // values for all filters are returned in one array of arrays,
                        // so group results by id to isolate filter values
                        var groupedResult = _.groupBy(result.values, 'id'),
                            resultObj = {},
                            filterIds = _.pluck(query.filtersApplied, 'id');
                        // try to get each filter id from groupedResult.
                        // if it's undefined, an empty array will be returned
                        // this allows a zeroed array to appear in the chart,
                        // since we want to include all filters selected by the user
                        // regardless of value
                        if (filterIds.length > 1) {
                            // when more than one filter is requested, then an id
                            // value is present within data.results
                            _.forEach(filterIds, function (id) {
                                resultObj[id] = _.get(groupedResult, id, []);
                            });
                        } else {
                            // when one filter is requested, no id value is included
                            // in data.results, so build resultObj with the other
                            // info we have
                            resultObj[query.choice_id[0]] = _.pairs(groupedResult)[0][1];
                        }
                        _.forEach(_.pairs(resultObj), function (d) {
                            valueArr = [];
                            // d[0] will be choice id, d[1] will be values
                            // if only one filter was selected, d[0] will return as string 'undefined' since no id is included in this case
                            queryFilter = d[0] === 'undefined' ? query.filtersApplied[0] : _.find(query.filtersApplied, { id: parseInt(d[0]) });
                            queryDates = d[1];

                            // add result values to valueArr
                            _.forEach(xArr, function (xDate) {
                                var valueObj = _.find(queryDates, function (qDate) {
                                    return moment.utc(qDate.date).isSame(xDate, 'day');
                                });
                                // push 0 if data for xDate is not present in queryDates
                                valueArr.push(valueObj ? valueObj.value : 0);
                            });

                            // prepend valueArr with filter title, and push onto colArr
                            valueArr.unshift(queryFilter.name + queryFilter.id);
                            colNames[queryFilter.name + queryFilter.id] = queryFilter.version ? queryFilter.title + ' ' + queryFilter.version : queryFilter.title;
                            colArr.push(valueArr);
                        });
                    });
                } else {
                    // no filters were applied, so show aggregate statistics
                    _.forEach(data.results, function (result) {
                        // add result values to valueArr
                        _.forEach(xArr, function (xDate) {
                            var valueObj = _.find(result.values, function (qDate) {
                                return moment.utc(qDate.date).isSame(xDate, 'day');
                            });
                            // push 0 if data for xDate is not present in result.values
                            valueArr.push(valueObj ? valueObj.value : 0);
                        });

                        // prepend valueArr with filter title, and push onto colArr
                        var columnLabel = result.column.title + ' for all ' + query.dataType.title;
                        valueArr.unshift(columnLabel);
                        colNames['aggregate'] = columnLabel;
                        colArr.push(valueArr);
                    });
                }
            });

            // inform the user if the metrics they selected are empty
            if (_.sum(_.flatten(colArr)) === 0) {
                toastr['info']('There is no data to display.');
            }

            // prepend xArr with an 'x' label and add to colArr
            xArr.unshift('x');
            colArr.unshift(xArr);

            var types = {},
                type = {},
                groups = [];

            _.forEach(colArr, function (col) {
                type = {};
                if (col[0] !== 'x') {
                    type[col[0]] = $scope.chartType;
                    if ($scope.chartDisplay === 'stacked') {
                        groups.push(col[0]);
                    }
                }
                angular.extend(types, type);
            });

            if (chart) {
                // chart already exists, so update values
                chart.groups([groups]);
                chart.data.names(colNames);
                chart.axis.labels({
                    y: _.capitalize(yUnits[0])
                });
                chart.load({
                    columns: colArr,
                    types: types,
                    unload: removeIds
                });
            } else {
                // no chart yet, so set it up
                chart = c3.generate({
                    bindto: '#metrics',
                    data: {
                        x: 'x',
                        columns: colArr,
                        types: types,
                        groups: [groups],
                        names: colNames
                    },
                    subchart: {
                        show: $scope.subchartEnabled
                    },
                    transition: {
                        duration: 700
                    },
                    color: {
                        pattern: scaleConfig.colors.patternD320
                    },
                    axis: {
                        type: 'timeseries',
                        x: {
                            tick: {
                                format: function (d) {
                                    return moment.utc(d).toISOString();
                                }
                            },
                            label: {
                                text: 'Dates',
                                position: 'outer-center'
                            }
                        },
                        y: {
                            label: {
                                text: _.capitalize(yUnits[0]),
                                position: 'outer-middle'
                            }
                        }
                    }
                });
            }
        };

        // set chart height
        angular.element(document).ready(function () {
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                offset = scaleConfig.headerOffset,
                chartMaxHeight = viewport.height - offset;

            $scope.chartStyle = 'height: ' + chartMaxHeight + 'px; max-height: ' + chartMaxHeight + 'px;';
        });
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('metricsService', ['$http', '$q', '$resource', 'scaleConfig', function ($http, $q, $resource, scaleConfig) {
        var getPlotDataParams = function (page, page_size, started, ended, choice_id, column, group, dataType) {
            console.log(choice_id);
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                choice_id: choice_id,
                column: column,
                group: group,
                dataType: dataType
            };
        };

        return {
            getDataTypes: function () {
                var d = $q.defer();
                $http.get(scaleConfig.urls.apiPrefix + 'metrics/').success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getDataTypeMetrics: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.urls.apiPrefix + 'metrics/' + id + '/').success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getDataTypeOptions: function (name) {
                var d = $q.defer();
                var url = scaleConfig.urls.apiPrefix + 'metrics/' + name + '/';
                $http.get(url).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getPlotData: function (params) {
                var params = params || getPlotDataParams(),
                    d = $q.defer();

                $http({
                    method: 'GET',
                    url: scaleConfig.urls.apiPrefix + 'metrics/' + params.dataType + '/plot-data/',
                    params: params
                }).success(function (data) {
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },
            getGeneratedPlotData: function (obj) {
                var d = $q.defer();

                var returnObj = {
                    count: 28,
                    next: null,
                    previous: null,
                    results: []
                };

                var numDays = moment.utc(obj.params.ended).diff(moment.utc(obj.params.started), 'd') + 1;

                _.forEach(obj.query.selectedMetrics, function (metric) {
                    var returnResult = {
                        column: metric,
                        min_x: moment.utc(obj.params.started).format('YYYY-MM-DD'),
                        max_x: moment.utc(obj.params.ended).format('YYYY-MM-DD'),
                        min_y: 1,
                        max_y: 100,
                        values: []
                    };

                    for (var i = 0; i < numDays; i++) {
                        if (obj.query.filtersApplied.length > 1) {
                            _.forEach(obj.query.filtersApplied, function (filter) {
                                returnResult.values.push({
                                    date: moment.utc(obj.params.started).add(i, 'd').format('YYYY-MM-DD'),
                                    value: Math.floor(Math.random() * (1000 - 1 + 1)) + 1,
                                    id: filter.id
                                });
                            });
                        } else {
                            returnResult.values.push({
                                date: moment.utc(obj.params.started).add(i, 'd').format('YYYY-MM-DD'),
                                value: Math.floor(Math.random() * (1000 - 1 + 1)) + 1
                            });
                        }
                    }
                    returnObj.results.push(returnResult);
                });

                d.resolve(returnObj);

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('navController', ['$scope', '$location', '$window', 'scaleConfig', 'navService', function($scope, $location, $window, scaleConfig, navService) {
        document.getElementsByTagName('body')[0].style.backgroundColor = scaleConfig.colors.nav_bg;

        $scope.activePage = 'overview';
        $scope.docsUrl = scaleConfig.urls.documentation;

        $scope.goto = function(loc) {
            $location.search('');
            $location.path(loc);
        };

        var locationUpdated = function() {
            $scope.activePage = navService.location;
        };

        var initialize = function() {
            navService.registerObserver(locationUpdated);
        };
        initialize();

    }]);
})();

(function () {
    'use strict';
    /**
     * See: http://stackoverflow.com/questions/12576798/angularjs-how-to-watch-service-variables/17558885#17558885
     * Doing things this way so that ssNavbarController can get notified
     * when the location changes. Then, our controllers just need to call into
     * this service to updateLocation.
     *
     * The only thing I don't like about this is that the individual
     * controllers have to call in and tell the ssNavigationService what
     * page they are showing.
     */
    angular.module('scaleApp').service('navService', ['$location', function ($location) {

        this.location = 'overview'; // where the app starts

        var observers = [];

        this.registerObserver = function(callback) {
            observers.push(callback);
        };

        this.notifyObservers = function() {
            angular.forEach(observers, function(observer) {
                observer();
            });
        };

        this.updateLocation = function(locationIn) {
            this.location = locationIn;
            this.notifyObservers();
        };

    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('subnavService', ['$http', 'scaleConfig', function ($http, scaleConfig) {
        var currentPath = '';

        this.setCurrentPath = function (path) {
            currentPath = path;
        };

        this.getCurrentPath = function () {
            return currentPath;
        };
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('nodeDetailsController', ['$scope', '$location', '$routeParams', '$timeout', 'navService', 'nodeService', function($scope, $location, $routeParams, $timeout, navService, nodeService) {
        $scope.nodeId = $routeParams.id;

        var getNodeDetails = function (nodeId) {
            nodeService.getNode(nodeId).then( function (data) {
                $scope.node = data;
            });
        };

        var initialize = function() {
            navService.updateLocation('nodes');

            getNodeDetails($scope.nodeId);
            _.defer(function () {
                $scope.loading = false;
            });
        };

        initialize();

        /*$scope.$watch('nodeData', function (val) {
            $scope.redrawGrid();
        }, true);*/
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('nodesController', ['$scope', '$location', '$timeout', 'navService', 'nodeService', function($scope, $location, $timeout, navService, nodeService) {
        $scope.nodeCounts = [];
        $scope.loading = true;
        $scope.hourValue = 3;
        $scope.nodesError = null;
        $scope.nodesErrorStatus = null;
        $scope.nodeStatusError = null;
        $scope.nodeStatusErrorStatus = null;
        $scope.nodeData = {
            data: null,
            status: null
        };

        var debounceTimer = {};

        var debounceBroadcast = function (message, args) {
            if (debounceTimer[message]) {
                $timeout.cancel(debounceTimer[message]);
            }
            debounceTimer[message] = $timeout(function () {
                $scope.$broadcast(message, args);
            }, 500);
        };

        $scope.redrawGrid = function () {
            debounceBroadcast('redrawGrid', $scope.nodeData);
        };

        var getNodes = function () {
            nodeService.getNodes().then(null, null, function (data) {
                if (data.$resolved) {
                    $scope.nodesError = null;
                    $scope.nodeData.data = data.results;
                    $scope.redrawGrid();
                } else {
                    if (data.statusText && data.statusText !== '') {
                        $scope.nodesErrorStatus = data.statusText;
                    }
                    $scope.nodesError = 'Unable to retrieve nodes.';
                }
            });
        };

        var getNodeStatus = function () {
            nodeService.getNodeStatus(null, null, 'PT' + $scope.hourValue + 'H', null).then(null, null, function (data) {
                if (data.$resolved) {
                    $scope.nodeStatusError = null;
                    $scope.nodeData.status = data.results;
                    $scope.redrawGrid();
                } else {
                    if (data.statusText && data.statusText !== '') {
                        $scope.nodeStatusErrorStatus = data.statusText;
                    }
                    $scope.nodeStatusError = 'Unable to retrieve node status.';
                }
            });
        };

        var initialize = function() {
            getNodes();
            getNodeStatus();
            _.defer(function () {
                $scope.loading = false;
            });
            navService.updateLocation('nodes');
        };

        initialize();
    }]);
})();
(function (){
    'use strict';

    angular.module('scaleApp').controller('aisNodeHealthController', ['$rootScope', '$scope', 'nodeService', function ($rootScope, $scope, nodeService) {
        $scope.loadingNodeHealth = true;
        $scope.nodeHealthError = null;
        $scope.nodeHealthErrorStatus = null;
        $scope.nodeHealth = {};
        $scope.nodesOffline = 0;
        $scope.nodesPausedErrors = 0;
        $scope.nodesPaused = 0;
        $scope.nodesOfflineAndPaused = 0;
        $scope.nodesOfflineAndPausedErrors = 0;
        $scope.healthyNodes = 0;
        $scope.totalNodes = 0;

        var getNodeStatus = function () {
            $scope.loadingNodeHealth = true;
            nodeService.getNodeStatus(null, null, $scope.duration, null).then(null, null, function (data) {
                if (data.$resolved) {
                    $scope.totalNodes = data.results.length;

                    var nodesOffline = [],
                        nodesPausedErrors = [],
                        nodesPaused = [],
                        nodesOfflineAndPausedErrors = [],
                        nodesOfflineAndPaused = [];

                    _.forEach(data.results, function (n) {
                        if (!n.is_online) {
                            // node is offline
                            if (n.node.is_paused_errors) {
                                nodesOfflineAndPausedErrors.push(n);
                            } else if (n.node.is_paused) {
                                nodesOfflineAndPaused.push(n);
                            } else {
                                nodesOffline.push(n);
                            }
                        } else {
                            // node is online
                            if (n.node.is_paused_errors) {
                                nodesPausedErrors.push(n);
                            } else if (n.node.is_paused) {
                                nodesPaused.push(n);
                            }
                        }
                    });

                    $scope.nodesOffline = nodesOffline.length;
                    $scope.nodesPausedErrors = nodesPausedErrors.length;
                    $scope.nodesPaused = nodesPaused.length;
                    $scope.nodesOfflineAndPausedErrors = nodesOfflineAndPausedErrors.length;
                    $scope.nodesOfflineAndPaused = nodesOfflineAndPaused.length;

                    // add the length of nodes both offline and paused to produce an accurate healthy count
                    $scope.healthyNodes = $scope.totalNodes - $scope.nodesOffline - $scope.nodesPausedErrors - $scope.nodesPaused - $scope.nodesOfflineAndPaused - $scope.nodesOfflineAndPausedErrors;

                    var donutData = [];

                    // determine percentage of healthy nodes, and breakdown of why nodes are unhealthy
                    var gaugeData = $scope.totalNodes > 0 ? (($scope.healthyNodes / $scope.totalNodes) * 100).toFixed(2) : 0.00;

                    if ($scope.nodesOffline > 0) {
                        donutData.push({
                            status: 'Offline',
                            count: $scope.nodesOffline
                        });
                    }

                    if ($scope.nodesPausedErrors > 0) {
                        donutData.push({
                            status: 'High Failure Rate',
                            count: $scope.nodesPausedErrors
                        });
                    }

                    if ($scope.nodesPaused > 0) {
                        donutData.push({
                            status: 'Paused',
                            count: $scope.nodesPaused
                        });
                    }

                    $scope.nodeHealth = {
                        gaugeData: gaugeData,
                        donutData: donutData
                    };
                } else {
                    if (data.statusText && data.statusText !== '') {
                        $scope.nodeHealthErrorStatus = data.statusText;
                    }
                    $scope.nodeHealthError = 'Unable to retrieve node health.';
                }
                $scope.loadingNodeHealth = false;
            });
        };

        getNodeStatus();

        $rootScope.$on('updateNodeHealth', function () {
            getNodeStatus();
        });
    }]).directive('aisNodeHealth', function(){
        /**
         * Usage: <ais-node-health />
         **/
         return {
             controller: 'aisNodeHealthController',
             templateUrl: 'modules/nodes/directives/nodeHealthTemplate.html',
             restrict: 'E',
             scope: {
                 duration: '=',
                 showDescription: '='
             }
         };
    });
})();

(function(){
    'use strict';

    angular.module('scaleApp').factory('Node', ['NodeResources', 'scaleService', function (NodeResources, scaleService) {
        var Node = function (id, hostname, port, slave_id, pause_reason, is_paused, is_paused_errors, is_active, archived, created, last_offer, last_modified, resources) {
            this.id = id;
            this.hostname = hostname;
            this.port = port;
            this.slave_id = slave_id;
            this.pause_reason = pause_reason;
            this.is_paused = is_paused;
            this.is_paused_errors = is_paused_errors;
            this.is_active = is_active;
            this.archived = archived;
            this.created = created;
            this.last_offer = last_offer;
            this.last_modified = last_modified;
            this.resources = NodeResources.transformer(resources);
        };

        //public methods
        Node.prototype = {
            toString: function () {
                return 'Node';
            },
            getDuration: function () {
                return scaleService.calculateDuration(this.created, this.last_modified);
            },
            getCellText: function () {
                // this is only used reveal = true on gridChart directive
                return this.hostname;
            },
            getCellTitle: function () {
                return this.hostname;
            }
        };

        // static methods, assigned to class
        Node.build = function (data) {
            if (data) {
                return new Node(
                    data.id,
                    data.hostname,
                    data.port,
                    data.slave_id,
                    data.pause_reason,
                    data.is_paused,
                    data.is_paused_errors,
                    data.is_active,
                    data.archived,
                    data.created,
                    data.last_offer,
                    data.last_modified,
                    data.resources
                );
            }
            return new Node();
        };

        Node.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Node.build);
            }
            return Node.build(data);
        };

        return Node;
    }]);
})();

(function(){
    'use strict';

    angular.module('scaleApp').factory('NodeResources', function(){
        var NodeResources = function (cpus, mem, disk) {
            this.cpus = cpus;
            this.mem = mem;
            this.disk = disk;
        };

        //public methods
        NodeResources.prototype = {
            // getDuration: function() {
                //return scaleService.calculateDuration(this.created, this.last_modified);
            // }
        };

        // static methods, assigned to class
        NodeResources.build = function (data) {
            if (data) {
                return new NodeResources(
                    data.cpus,
                    data.mem,
                    data.disk
                );
            }
            return new NodeResources();
        };

        NodeResources.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(NodeResources.build)
                    .filter(Boolean);
            }
            return NodeResources.build(data);
        };

        return NodeResources;
    });
})();

(function() {
    'use strict';

    angular.module('scaleApp').factory('NodeStatus', ['scaleConfig', 'nodeUpdateService', 'Node', 'JobExecution', function (scaleConfig, nodeUpdateService, Node, JobExecution) {
        var NodeStatus = function (node, is_online, job_exe_counts, job_exes_running) {
            this.node = Node.transformer(node);
            this.is_online = is_online;
            this.job_exe_counts = job_exe_counts;
            this.job_exes_running = JobExecution.transformer(job_exes_running);
        };

        //public methods
        NodeStatus.prototype = {
            toString: function () {
                return 'NodeStatus';
            },
            getCompleted: function () {
                var completed = _.find(this.job_exe_counts, 'status', 'COMPLETED');
                return completed ? completed.count : 0;
            },
            getFailed: function () {
                var failed = _.find(this.job_exe_counts, 'status', 'FAILED');
                return failed ? failed.count : 0;
            },
            getCellFill: function () {
                var color = '';
                if (this.is_online) {
                    if (this.node.is_paused_errors) {
                        color = scaleConfig.colors.chart_orange;
                    } else if (this.node.is_paused) {
                        color = scaleConfig.colors.chart_yellow;
                    } else {
                        color = scaleConfig.colors.chart_green;
                    }
                } else {
                    color = scaleConfig.colors.chart_red;
                }
                return color;
            },
            getCellActivity: function () {
                return '';
            },
            getCellError: function () {
                return 'Failed: ' + this.getFailed();
            },
            getCellTotal: function () {
                return 'Completed: ' + this.getCompleted();
            },
            getCellStatus: function () {
                if (this.is_online) {
                    if (this.node.is_paused_errors) {
                        return 'High Failure Rate';
                    } else if (this.node.is_paused) {
                        return 'Paused';
                    } else {
                        return 'Online';
                    }
                } else {
                    return 'Offline';
                }
            },
            getCellJobs: function () {
                var text = '';
                _.forEach(this.job_exes_running, function (jobExecution) {
                    text = jobExecution.job.job_type.icon_code ?
                    text + ' ' + '&#x' + jobExecution.job.job_type.icon_code + ';' :
                    text + ' ' + '&#x' + scaleConfig.defaultIconCode + ';';
                });
                return text;
            },
            getCellPauseResume: function () {
                return this.node.is_paused ? '&#xf04b;' : '&#xf04c;';
            },
            pauseResumeCell: function (pause_reason) {
                var updateData = {
                    hostname: this.node.hostname,
                    port: this.node.port,
                    pause_reason: pause_reason || '',
                    is_paused: !this.node.is_paused
                };
                return nodeUpdateService.updateNode(this.node.id, updateData).then(function (result) {
                    return Node.transformer(result);
                }).catch(function (error) {
                    console.log(error);
                });
            }
        };

        // static methods, assigned to class
        NodeStatus.build = function (data) {
            if (data) {
                return new NodeStatus(
                    data.node,
                    data.is_online,
                    data.job_exe_counts,
                    data.job_exes_running
                );
            }
            return new NodeStatus();
        };

        NodeStatus.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(NodeStatus.build);
            }
            return NodeStatus.build(data);
        };

        return NodeStatus;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('nodeService', ['$http', '$q', '$resource', 'scaleConfig', 'Node', 'NodeStatus', 'poller', 'pollerFactory', function ($http, $q, $resource, scaleConfig, Node, NodeStatus, poller, pollerFactory) {
        /*var totalNodes = 5;

        var getTotalNodes = function () {
            return totalNodes;
        };

        var setTotalNodes = function () {
            totalNodes = Math.floor(Math.random() * (20 - 1 + 1)) + 1;
        };

        setInterval(function () {
            setTotalNodes();
        }, 3100);*/

        var getNodeStatusParams = function (page, page_size, started, ended) {
            var params = {};

            if(page) { params.page = page; }
            if(page_size) { params.page_size = page_size; }
            if(started) { params.started = started; }
            if(ended) { params.ended = ended; }

            return params;
        };

        return {
            getNodes: function () {
                var nodesResource = $resource(scaleConfig.urls.apiPrefix + 'nodes/'),
                    nodesPoller = pollerFactory.newPoller(nodesResource, scaleConfig.pollIntervals.nodes);

                return nodesPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        /*var returnResult = {
                            $resolved: true,
                            nodes: []
                        };
                        var newData = {};
                        for (var i = 0; i < getTotalNodes(); i++) {
                            newData = {
                                "id": i,
                                "hostname": "node" + i + ".local",
                                "port": 5051,
                                "slave_id": "20150616-103050-1800454536-5050-6193-S2",
                                "total_cpus": 2.0,
                                "total_mem": 6793.0,
                                "total_disk": 94639.0,
                                "is_paused": false,
                                "created": "2015-06-15T17:18:52.414Z",
                                "last_modified": "2015-06-15T17:18:52.414Z"
                            };
                            returnResult.nodes.push(newData);
                        }
                        result = returnResult;*/

                        data.results = Node.transformer(data.results);
                    } else {
                        nodesPoller.stop();
                    }
                    return data;
                });
            },
            getNodesOnce: function () {
                var d = $q.defer();
                $http.get(scaleConfig.urls.apiPrefix + 'nodes/').success(function (data) {
                    var returnData = Node.transformer(data.nodes);
                    d.resolve(returnData);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getNode: function (slaveId) {
                var d = $q.defer();
                $http.get(scaleConfig.urls.apiPrefix + 'nodes/' + slaveId + '/').success(function (data) {
                    var returnData = Node.transformer(data);
                    d.resolve(returnData);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getNodeStatus: function (page, page_size, started, ended) {
                var params = getNodeStatusParams(page, page_size, started, ended);

                var nodeStatusResource = $resource(scaleConfig.urls.apiPrefix + 'nodes/status/', params),
                    nodeStatusPoller = pollerFactory.newPoller(nodeStatusResource, scaleConfig.pollIntervals.nodeStatus);

                return nodeStatusPoller.promise.then(null, null, function (data) {
                    if (data.$resolved) {
                        /*var returnResult = {
                            $resolved: true,
                            node_stats: []
                        };
                        var newData = {};
                        for (var i = 0; i < getTotalNodes(); i++) {
                            newData = {
                                "hostname": "node" + i + ".local",
                                "jobs_completed": Math.floor(Math.random() * (100 - 20 + 1)) + 20,
                                "system_failures": Math.floor(Math.random() * (20 - 0 + 1)) + 0,
                                "id": i
                            };
                            returnResult.node_stats.push(newData);
                        }
                        result = returnResult;*/

                        data.results = NodeStatus.transformer(data.results);
                    } else {
                        nodeStatusPoller.stop();
                    }
                    return data;
                });
            },
            getNodeStatusOnce: function (page, page_size, started, ended) {
                var d = $q.defer();
                var params = getNodeStatusParams(page, page_size, started, ended);
                $http({
                    url: scaleConfig.urls.apiPrefix + 'nodes/status/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = NodeStatus.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },
            getNodeData: function (slaveId, since) {
                var data = {},
                    self = this;

                since = since || 'PT3H';

                return self.getNodes().then(function (nodes) {
                    data.nodes = nodes;
                    return self.getNodeStatus(since).then(function (stats) {
                        data.stats = stats;
                        return data;
                    });
                });
            }
        };

    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('nodeUpdateService', ['$http', '$q', 'scaleConfig', 'Node', function ($http, $q, scaleConfig, Node) {
        var getNodeUpdateData = function (hostname, port, pause_reason, is_paused) {
            return {
                hostname: hostname,
                port: port,
                pause_reason: pause_reason,
                is_paused: is_paused
            };
        };

        return {
            updateNode: function (id, data) {
                data = data || getNodeUpdateData();
                var d = $q.defer();

                $http({
                    url: scaleConfig.urls.apiPrefix + 'nodes/' + id + '/',
                    method: 'PATCH',
                    data: data
                }).success(function (result) {
                    d.resolve(Node.transformer(result));
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }])
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('ovController', ['$rootScope', '$scope', 'navService', 'nodeService', 'jobService', 'jobTypeService', 'statusService', 'gaugeFactory', 'scaleConfig', 'scaleService', 'schedulerService', 'userService', function($rootScope, $scope, navService, nodeService, jobService, jobTypeService, statusService, gaugeFactory, scaleConfig, scaleService, schedulerService, userService) {
        $scope.date = new Date();
        $scope.jobError = null;
        $scope.jobErrorStatus = null;
        $scope.loadingJobs = true;
        $scope.jobTypes = [];
        $scope.hourValue = 3;
        $scope.jobData = {
            data: null,
            status: null
        };
        $scope.jobErrorBreakdown = [];
        $scope.status = null;
        $scope.loadingStatus = true;
        $scope.statusError = null;
        $scope.statusErrorStatus = null;
        $scope.masterStatus = '';
        $scope.masterStatusClass = 'alert-success';
        $scope.schedulerStatus = '';
        $scope.schedulerStatusClass = 'alert-success';
        $scope.memCalc = '';
        $scope.diskCalc = '';
        $scope.schedulerIsPaused = false;
        $scope.user = userService.getUserCreds();
        $scope.schedulerContainerClass = $scope.user ? $scope.user.is_admin ? 'col-xs-8 col-lg-10' : 'col-xs-12' : 'col-xs-12';
        $scope.schedulerBtnClass = 'fa-pause';

        $scope.toggleScheduler = function () {
            $scope.schedulerIsPaused = !$scope.schedulerIsPaused;
            var schedulerData = {
                is_paused: $scope.schedulerIsPaused
            };
            schedulerService.updateScheduler(schedulerData).then(function (data) {
                $scope.schedulerStatus = data.is_paused ? 'Paused' : 'Running';
                $scope.schedulerStatusClass = data.is_paused ? 'alert-warning' : 'alert-success';
                $scope.schedulerBtnClass = data.is_paused ? 'fa-play' : 'fa-pause';
            }).catch(function (error) {
                console.log(error);
            });
        };

        var redrawGrid = function () {
            $scope.$broadcast('redrawGrid', $scope.jobData);
        };

        var getJobTypes = function () {
            jobTypeService.getJobTypes().then(null, null, function (data) {
                if (data.$resolved) {
                    $scope.jobError = null;
                    $scope.jobData.data = data.results;
                    redrawGrid();
                } else {
                    if (data.statusText && data.statusText !== '') {
                        $scope.jobErrorStatus = data.statusText;
                    }
                    $scope.jobError = 'Unable to retrieve job types.'
                }
                $scope.loadingJobs = false
            });
        };

        var getStatus = function () {
            var cpuGauge = gaugeFactory.createGauge('cpu', 'CPU', 0, 100, 180),
                memGauge = gaugeFactory.createGauge('memory', 'Memory', 0, 100, 180),
                diskGauge = gaugeFactory.createGauge('disk', 'Disk', 0, 100, 180);

            statusService.getStatus().then(null, null, function (result) {
                if (result.$resolved) {
                    $scope.statusError = null;
                    $scope.status = result;
                    cpuGauge.redraw(result.getCpuUsage());
                    memGauge.redraw(result.getMemUsage());
                    diskGauge.redraw(result.getDiskUsage());
                    $scope.masterStatus = result.master.is_online ? 'Online' : 'Offline';
                    $scope.masterStatusClass = result.master.is_online ? 'alert-success' : 'alert-danger';
                    if (result.scheduler.is_online) {
                        $scope.schedulerStatus = result.scheduler.is_paused ? 'Paused' : 'Running';
                        $scope.schedulerStatusClass = result.scheduler.is_paused ? 'alert-warning' : 'alert-success';
                        $scope.schedulerIsPaused = result.scheduler.is_paused;
                        $scope.schedulerBtnClass = result.scheduler.is_paused ? 'fa-play' : 'fa-pause';
                    } else {
                        $scope.schedulerStatus = result.scheduler.is_paused ? 'Offline; Paused' : 'Offline';
                        $scope.schedulerStatusClass = 'alert-danger';
                        $scope.schedulerIsPaused = result.scheduler.is_paused;
                        $scope.schedulerBtnClass = result.scheduler.is_paused ? 'fa-play' : 'fa-pause';
                    }
                    if (result.resources.scheduled.mem && result.resources.total.mem) {
                        $scope.memCalc = scaleService.calculateFileSizeFromMib(result.resources.scheduled.mem) + ' / ' + scaleService.calculateFileSizeFromMib(result.resources.total.mem);
                    }
                    if (result.resources.scheduled.disk && result.resources.total.disk) {
                        $scope.diskCalc = scaleService.calculateFileSizeFromMib(result.resources.scheduled.disk) + ' / ' + scaleService.calculateFileSizeFromMib(result.resources.total.disk);
                    }
                } else {
                    if (result.statusText && result.statusText !== '') {
                        $scope.statusErrorStatus = result.statusText;
                    }
                    $scope.statusError = 'Unable to retrieve cluster status.';
                }
                $scope.loadingStatus = false;
            });
        };

        $rootScope.$on('jobTypeStatus', function (event, data) {
            $scope.jobData.status = data;
            redrawGrid();
        });

        var initialize = function () {
            getJobTypes();
            getStatus();
            navService.updateLocation('overview');
        };

        initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('recipeDetailsController', ['$rootScope', '$scope', '$location', '$routeParams', 'navService', 'recipeService', 'scaleConfig', 'subnavService', 'userService', function ($rootScope, $scope, $location, $routeParams, navService, recipeService, scaleConfig, subnavService, userService) {

        var self = this;

        $scope.recipe = {};
        $scope.recipeId = $routeParams.id;
        $scope.subnavLinks = scaleConfig.subnavLinks.recipes;
        subnavService.setCurrentPath('recipes');
        $scope.loadingRecipeDetail = true;
        $scope.activeTab = 'status';
        $scope.lastStatusChange = '';

        self.getRecipeDetail = function (recipeId) {
            $scope.loadingRecipeDetail = true;
            recipeService.getRecipeDetails(recipeId).then(function (data) {
                $scope.recipe = data;
                recipeService.getRecipeTypeDetail(data.recipe_type.id).then(function(recipeType){
                    $scope.recipeType = recipeType;
                }).catch(function(error){
                   console.log(error);
                });
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                $scope.loadingRecipeDetail = false;
            });
        };

        self.initialize = function () {
            navService.updateLocation('recipes');
            $rootScope.user = userService.getUserCreds();

            self.getRecipeDetail($scope.recipeId);
        };



        $scope.switchTab = function (tab) {
            $('#' + $scope.activeTab).hide();
            $scope.activeTab = tab;
            $('#' + $scope.activeTab).show();
        };

        self.initialize();
    }]);
})();

(function(){
    'use strict';

    angular.module('scaleApp').controller('recipeEditorController', ['$scope', '$log', '$location', '$routeParams', '$uibModal', 'navService', 'recipeService', 'RecipeType', 'subnavService', 'jobTypeService', 'scaleConfig', function($scope, $log, $location, $routeParams, $uibModal, navService, recipeService, RecipeType, subnavService, jobTypeService, scaleConfig) {

        $scope.date = new Date();
        $scope.recipes = null;
        $scope.recipeTypeId = parseInt($routeParams.id);

        $scope.jobTypeValues = [];

        $scope.subnavLinks = scaleConfig.subnavLinks.recipes;
        subnavService.setCurrentPath('recipes/builder');

        $scope.items = ['item1', 'item2', 'item3'];
        $scope.animationsEnabled = true;
        $scope.selected = null;

        var getJobTypes = function () {
            jobTypeService.getJobTypesOnce().then(function (data) {
                $scope.jobTypeValues = data;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                $scope.loading = false;
            });
        };

        $scope.openAddJob = function (size) {
           var modalInstance = $uibModal.open({
             animation: $scope.animationsEnabled,
             templateUrl: 'addJobContent.html',
             scope: $scope,
             size: 'sm'
           });

           modalInstance.result.then(function () {
             $scope.addJobType($scope.selectedItem);
           }, function () {

           });
         };

         $scope.addJobType = function(selectedJobType){
             $scope.recipeType.definition.addJobType(selectedJobType);
             $scope.redrawGraph();
         };

         $scope.selectItem = function(item){
             $scope.selectedItem = item;
         };

        $scope.initialize = function() {
            getJobTypes();
            navService.updateLocation('recipes');
            if($scope.recipeTypeId){
                $scope.getRecipeTypeDetail($scope.recipeTypeId);
            }
            else{
                $scope.recipeType = RecipeType.new();
            }

        };

        $scope.getRecipeTypeDetail = function (id) {
            recipeService.getRecipeTypeDetail(id).then(function (data) {
                $scope.recipeType = data;
                if ($scope.redrawGraph) {
                    $scope.redrawGraph();
                }
            });
        };

        $scope.saveRecipeType = function(){
                console.log($scope.recipeType.name);
        };

        $scope.initialize();
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').controller('recipeTypesController', ['$rootScope', '$scope', '$routeParams', '$location', '$uibModal', 'hotkeys', 'scaleService', 'navService', 'recipeService', 'subnavService', 'jobTypeService', 'scaleConfig', 'RecipeType', 'userService', function ($rootScope, $scope, $routeParams, $location, $uibModal, hotkeys, scaleService, navService, recipeService, subnavService, jobTypeService, scaleConfig, RecipeType, userService) {
        $scope.loading = true;
        $scope.masterContainerStyle = '';
        $scope.detailContainerStyle = '';
        $scope.masterMaxHeight = 0;
        $scope.detailMaxHeight = 0;
        $scope.recipeTypes = [];
        $scope.recipeTypeIds = [];
        $scope.requestedRecipeTypeId = parseInt($routeParams.id);
        $scope.activeRecipeType = null;
        $scope.percentage = 73;
        $scope.date = new Date();
        $scope.recipes = null;
        $scope.mode = 'view'; // valid values are add, view, and edit
        $scope.addBtnText = 'New Recipe';
        $scope.addBtnClass = 'btn-primary';
        $scope.addBtnIcon = 'fa-plus-circle';
        $scope.editBtnText = 'Edit';
        $scope.editBtnClass = 'btn-success';
        $scope.editBtnIcon = 'fa-edit';
        $scope.jobTypeValues = [];
        $scope.isRecipeModified = false;
        $scope.saveBtnClass = 'btn-default';
        $scope.masterClass = 'col-xs-3';
        $scope.detailClass = 'col-xs-9';
        $scope.minimizeMaster = false;
        $scope.newBtnContainerClass = 'hidden';
        $scope.minimizeBtnContainerClass = 'hidden';
        $scope.minimizeBtnClass = 'fa fa-chevron-left';
        $scope.user = $rootScope.user;

        $scope.subnavLinks = scaleConfig.subnavLinks.recipes;
        subnavService.setCurrentPath('recipes/types');

        var initialize = function () {
            navService.updateLocation('recipes');
            $rootScope.user = userService.getUserCreds();
            getRecipeTypes();
            //getJobTypes();
        };
        
        var getRecipeTypes = function () {
            recipeService.getRecipeTypes().then(function (data) {
                $scope.recipeTypes = data;
                $scope.recipeTypeIds = _.pluck(data, 'id');
                $scope.viewRecipeTypeDetail($scope.requestedRecipeTypeId);
                hotkeys.bindTo($scope)
                    .add({
                        combo: 'ctrl+up',
                        description: 'Previous Recipe Type',
                        callback: function () {
                            if ($scope.activeRecipeType) {
                                var idx = _.indexOf($scope.recipeTypeIds, $scope.activeRecipeType.id);
                                if (idx > 0) {
                                    $scope.loadRecipeType($scope.recipeTypeIds[idx - 1]);
                                }
                            }
                        }
                    }).add({
                        combo: 'ctrl+down',
                        description: 'Next Recipe Type',
                        callback: function () {
                            if ($scope.activeRecipeType) {
                                var idx = _.indexOf($scope.recipeTypeIds, $scope.activeRecipeType.id);
                                if (idx < ($scope.recipeTypeIds.length - 1)) {
                                    $scope.loadRecipeType($scope.recipeTypeIds[idx + 1]);
                                }
                            }
                        }
                    });
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                if ($scope.loading) {
                    $scope.loading = false;
                }
            })
        };

        $scope.newRecipeType = function(){
            $location.path('/recipes/types/0');
        };

        $scope.viewRecipeTypeDetail = function(recipeTypeId){
            if (recipeTypeId > 0) {
                recipeService.getRecipeTypeDetail(recipeTypeId).then(function (data){
                    $scope.activeRecipeType = data;
                });
            } else if( recipeTypeId === 0) {
                $scope.activeRecipeType = new RecipeType();
            }
        };

        $scope.loadRecipeType = function (id) {
            if($scope.activeRecipeType && $scope.activeRecipeType.modified){
                confirmChangeRecipe().then(function () {
                    // OK
                    $location.path('/recipes/types/' + id);
                }, function () {
                    // Cancel

                });
            } else {
                $location.path('/recipes/types/' + id);
            }
        };

        var confirmChangeRecipe = function () {
            var modalInstance = $uibModal.open({
                animation: $scope.animationsEnabled,
                templateUrl: 'confirmDialog.html',
                scope: $scope,
                size: 'sm'
            });

            return modalInstance.result;
        };

        $scope.toggleMaster = function (minimizeMaster) {
            if (typeof minimizeMaster !== 'undefined') {
                $scope.minimizeMaster = minimizeMaster;
            } else {
                $scope.minimizeMaster = !$scope.minimizeMaster;
            }
            $scope.masterClass = $scope.minimizeMaster ? 'col-xs-1' : 'col-xs-3';
            $scope.detailClass = $scope.minimizeMaster ? 'col-xs-11' : 'col-xs-9';
            $scope.minimizeBtnContainerClass = $scope.minimizeMaster ? 'col-xs-12' : $rootScope.user ? 'col-xs-6 text-right' : 'col-xs-12 text-right';
            $scope.minimizeBtnClass = $scope.minimizeMaster ? 'fa fa-chevron-right' : 'fa fa-chevron-left';
            $scope.newBtnContainerClass = $scope.minimizeMaster ? 'hidden' : 'col-xs-6';
        };

        $rootScope.$on('toggleEdit', function (event, data) {
            $scope.toggleMaster(data === 'edit');
        });

        initialize();

        $rootScope.$on('recipeModified', function () {
            $scope.isRecipeModified = true;
            $scope.saveBtnClass = 'btn-success';
        });

        angular.element(document).ready(function () {
            $scope.newBtnContainerClass = $rootScope.user ? 'col-xs-6' : 'hidden';
            $scope.minimizeBtnContainerClass = $rootScope.user ? 'col-xs-6 text-right' : 'col-xs-12 text-right';
            // set container heights equal to available page height
            var viewport = scaleService.getViewportSize(),
                masterOffset = scaleConfig.headerOffset + document.getElementsByClassName('master-controls')[0].scrollHeight,
                detailOffset = scaleConfig.headerOffset;

            $scope.masterMaxHeight = viewport.height - masterOffset;
            $scope.detailMaxHeight = viewport.height - detailOffset;

            $scope.masterContainerStyle = 'height: ' + $scope.masterMaxHeight + 'px; max-height: ' + $scope.masterMaxHeight + 'px; overflow-y: auto;';
            $scope.detailContainerStyle = 'height: ' + $scope.detailMaxHeight + 'px; max-height: ' + $scope.detailMaxHeight + 'px';
        });
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').controller('recipesController', ['$rootScope', '$scope', '$location', 'scaleService', 'navService', 'gridFactory', 'uiGridConstants', 'scaleConfig', 'subnavService', 'recipeService', function ($rootScope, $scope, $location, scaleService, navService, gridFactory, uiGridConstants, scaleConfig, subnavService, recipeService) {

        var recipesParams = {
            page: null, page_size: null, started: null, ended: null, order: $rootScope.recipesControllerOrder || null, type_id: null, type_name: null, url: null
        };

        // check for recipesParams in query string, and update as necessary
        _.forEach(_.pairs(recipesParams), function (param) {
            var value = _.at($location.search(), param[0]);
            if (value.length > 0) {
                recipesParams[param[0]] = value.length > 1 ? value : value[0];
            }
        });

        var gridPageNumber = recipesParams.page || 1,
            filteredByRecipeType = recipesParams.type_id ? true : false,
            filteredByOrder = recipesParams.order ? true : false;

        // this file will be similar to jobsController
        $scope.recipesData = {};
        $scope.loading = true;
        $scope.recipeTypeValues = [];
        $scope.selectedRecipeType = recipesParams.type_id || 0;
        $scope.subnavLinks = scaleConfig.subnavLinks.recipes;
        $scope.gridStyle = '';
        $scope.lastModifiedStart = recipesParams.started ? moment.utc(recipesParams.started).toDate() : moment.utc().subtract(1, 'weeks').startOf('d').toDate();
        $scope.lastModifiedStartPopup = {
            opened: false
        };
        $scope.openLastModifiedStartPopup = function ($event) {
            $event.stopPropagation();
            $scope.lastModifiedStartPopup.opened = true;
        };
        $scope.lastModifiedStop = recipesParams.ended ? moment.utc(recipesParams.ended).toDate() : moment.utc().endOf('d').toDate();
        $scope.lastModifiedStopPopup = {
            opened: false
        };
        $scope.openLastModifiedStopPopup = function ($event) {
            $event.stopPropagation();
            $scope.lastModifiedStopPopup.opened = true;
        };
        $scope.dateModelOptions = {
            timezone: '+000'
        };

        subnavService.setCurrentPath('recipes');

        var defaultColumnDefs = [
            {
                field: 'recipe_type',
                displayName: 'Recipe Type',
                cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.recipe_type.title }} {{ row.entity.recipe_type.version }}</div>',
                filterHeaderTemplate: '<div class="ui-grid-filter-container"><select class="form-control input-sm" ng-model="grid.appScope.selectedRecipeType"><option ng-selected="{{ grid.appScope.recipeTypeValues[$index].id == grid.appScope.selectedRecipeType }}" value="{{ grid.appScope.recipeTypeValues[$index].id }}" ng-repeat="recipeType in grid.appScope.recipeTypeValues track by $index">{{ grid.appScope.recipeTypeValues[$index].title }} {{ grid.appScope.recipeTypeValues[$index].version }}</option></select>'
            },
            //{ field: 'created', enableFiltering: false, cellFilter: 'date:\'yyyy-MM-dd HH:mm:ss\''},
            { field: 'created', enableFiltering: false},
            {
                field: 'last_modified',
                enableFiltering: false,
                //cellFilter: 'date:\'yyyy-MM-dd HH:mm:ss\'',                
            },
            { field: 'duration', enableFiltering: false, enableSorting: false, cellTemplate: '<div class="ui-grid-cell-contents">{{ row.entity.getDuration() }}</div>' },
            { field: 'completed', enableFiltering: false, enableSorting: true, cellTemplate: '<div class="ui-grid-cell-contents status completed" ng-if="row.entity.completed">Completed {{ row.entity.last_status_change }}</div>' }
        ];

        $scope.gridOptions = gridFactory.defaultGridOptions();
        $scope.gridOptions.paginationCurrentPage = parseInt(recipesParams.page || 1);
        $scope.gridOptions.paginationPageSize = parseInt(recipesParams.page_size) || $scope.gridOptions.paginationPageSize;
        var colDefs = $rootScope.recipeColDefs ? $rootScope.recipeColDefs : defaultColumnDefs;
        $scope.gridOptions.columnDefs = gridFactory.applySortConfig(colDefs, recipesParams);
        $scope.gridOptions.data = [];
        $scope.gridOptions.onRegisterApi = function (gridApi) {
            //set gridApi on scope
            $scope.gridApi = gridApi;
            $scope.gridApi.selection.on.rowSelectionChanged($scope, function (row) {
                $scope.$apply(function(){
                    $location.path('/recipes/recipe/' + row.entity.id);
                });

            });
            $scope.gridApi.pagination.on.paginationChanged($scope, function (currentPage, pageSize) {
                recipesParams.page = currentPage;
                recipesParams.page_size = pageSize;
                console.log('gridApi');
                $scope.filterResults();
            });
            $scope.gridApi.core.on.sortChanged($scope, function (grid, sortColumns) {
                $rootScope.recipeColDefs = null;
                _.forEach($scope.gridApi.grid.columns, function (col) {
                    col.colDef.sort = col.sort;
                });
                $rootScope.recipeColDefs = $scope.gridApi.grid.options.columnDefs;
                var sortArr = [];
                _.forEach(sortColumns, function (col) {
                    sortArr.push(col.sort.direction === 'desc' ? '-' + col.field : col.field);
                });
                updateRecipeOrder(sortArr);
            });
        };

        $scope.getPage = function (filter, pageNumber, pageSize, url) {
            $scope.loading = true;
            recipeService.getRecipes(filter, pageNumber, pageSize, url).then(function (data) {
                var newData = [];
                for (var i = 0; i < $scope.gridOptions.paginationPageSize; i++) {
                    if (data.results[i]) {
                        newData.push(data.results[i]);
                    }
                }
                $scope.gridOptions.data = newData;
                $scope.gridOptions.totalItems = data.count;
                $scope.jobsData = data;
                gridPageNumber = pageNumber;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                $scope.loading = false;
            });
        };

        $scope.filterResults = function () {
            _.forEach(_.pairs(recipesParams), function (param) {
                $location.search(param[0], param[1]);
            });
            $scope.loading = true;
            getRecipes();
        };

        var getRecipes = function () {
            recipeService.getRecipes(recipesParams).then(function (data) {
                $scope.recipesData = data;
                $scope.gridOptions.totalItems = data.count;
                $scope.gridOptions.data = data.results;
            }).catch(function (error) {
                console.log(error);
            }).finally(function () {
                $scope.loading = false;
            });
        };

        var getRecipeTypes = function () {
            recipeService.getRecipeTypes().then(function (data) {
                $scope.recipeTypeValues = data;
                $scope.recipeTypeValues.unshift({ name: 'VIEW ALL', title: 'VIEW ALL', version: '', id: 0 });
                getRecipes();
            }).catch(function (error) {
                $scope.loading = false;
                console.log(error);
            });
        };

        var updateRecipeOrder = function (sortArr) {
            recipesParams.order = sortArr.length > 0 ? sortArr : null;
            filteredByOrder = sortArr.length > 0;
            $scope.filterResults();
        };

        var updateRecipeType = function (value) {
            if (value != recipesParams.type_id) {
                recipesParams.page = 1;
            }
            recipesParams.type_id = value == 0 ? null : value;
            recipesParams.page_size = $scope.gridOptions.paginationPageSize;
            console.log('selectedRecipeType');
            if (!$scope.loading) {
                $scope.filterResults();
            }
        };

        $scope.$watch('lastModifiedStart', function (value) {
            if (!$scope.loading) {
                recipesParams.started = value.toISOString();
                $scope.filterResults();
            }
        });

        $scope.$watch('lastModifiedStop', function (value) {
            if (!$scope.loading) {
                recipesParams.ended = value.toISOString();
                $scope.filterResults();
            }
        });

        $scope.$watch('selectedRecipeType', function (value) {
            if ($scope.loading) {
                if (filteredByRecipeType) {
                    updateRecipeType(value);
                }
            } else {
                filteredByRecipeType = value != 0;
                updateRecipeType(value);
            }
        });

        var initialize = function () {
            if (typeof $rootScope.recipeColDefs === 'undefined') {
                // root column defs have not been altered by user, so set up defaults
                if (!recipesParams.order) {
                    recipesParams.order = '-last_modified';
                    $location.search('order', recipesParams.order).replace();
                }
                if (!recipesParams.page_size) {
                    recipesParams.page_size = $scope.gridOptions.paginationPageSize;
                    $location.search('page_size', recipesParams.page_size).replace();
                }
                if (!recipesParams.started) {
                    recipesParams.started = moment.utc($scope.lastModifiedStart).toISOString();
                    $location.search('started', recipesParams.started).replace();
                }
                if (!recipesParams.ended) {
                    recipesParams.ended = moment.utc($scope.lastModifiedStop).toISOString();
                    $location.search('ended', recipesParams.ended).replace();
                }
            }
            getRecipeTypes();
            navService.updateLocation('recipes');
        };

        initialize();

        angular.element(document).ready(function(){
           // set container height equal to available page height
            var viewport = scaleService.getViewportSize();
            var offset = scaleConfig.headerOffset + scaleConfig.dateFilterOffset;
            var gridMaxHeight = viewport.height - offset;
            $scope.gridStyle = 'height: ' + gridMaxHeight + 'px; max-height: ' + gridMaxHeight + 'px;';
        });
    }]);
})();

/**
 * <ais-scale-recipe-viewer />
 */
(function () {
    angular.module('scaleApp').controller('aisScaleRecipeGraphViewerController', ['$rootScope', '$scope', '$location', '$uibModal', 'scaleConfig', 'scaleService', 'jobTypeService', 'recipeService', 'workspacesService', function ($rootScope, $scope, $location, $uibModal, scaleConfig, scaleService, jobTypeService, recipeService, workspacesService) {
        $scope.vertices = [];
        $scope.edges = [];
        $scope.isUpdate = false;
        $scope.selectedJob = null;
        $scope.selectedInputProvider = null;
        $scope.mode = null;
        $scope.editMode = null;
        $scope.dependencyBtnClass = 'fa-plus';
        $scope.addBtnText = 'New Recipe';
        $scope.addBtnClass = 'btn-primary';
        $scope.addBtnIcon = 'fa-plus-circle';
        $scope.editBtnText = 'Edit';
        $scope.editBtnClass = 'btn-success';
        $scope.editBtnIcon = 'fa-edit';
        $scope.jobTypeValues = [];
        $scope.saveBtnClass = 'btn-default';
        $scope.savingRecipe = false;
        $scope.warnings = [];
        $scope.readonly = true;
        $scope.detailMaxHeight = 0;
        $scope.recipeTypeTrigger = { dataTypes: '' };
        $scope.detailContainerStyle = '';
        $scope.containerClass = $scope.hasContainer ? '' : 'detail-container no-tabs';
        $scope.lastStatusChange = '';
        $scope.availableWorkspaces = [];
        $scope.recipeInputTypes = [
            {
                name: 'property',
                title: 'Property',
                fields: []
            },
            {
                name: 'file',
                title: 'File',
                fields: [
                    {
                        name: 'media_types',
                        title: 'Media Types',
                        value: []
                    }
                ]
            },
            {
                name: 'files',
                title: 'Files',
                fields: [
                    {
                        name: 'media_types',
                        title: 'Media Types',
                        value: []
                    }
                ]
            }
        ];
        $scope.availableTriggerTypes = scaleConfig.triggerTypes;
        $scope.selectedRecipeInputType = {};
        $scope.recipeInput = {
            name: '',
            required: true,
            type: ''
        };
        $scope.isIE = scaleService.isIE();

        var startJob = null;

        // Dagre variables
        var svg = null;
        var inner = null;
        var graph = null;
        var zoom = null;
        var render = null;


        var resetEditBtn = function () {
            $scope.editBtnText = $scope.mode === 'edit' ? 'Cancel Edit' : 'Edit';
            $scope.editBtnClass = $scope.mode === 'edit' ? 'btn-warning' : 'btn-success';
            $scope.editBtnIcon = $scope.mode === 'edit' ? 'fa-close' : 'fa-edit';
        };

        var resetAddBtn = function () {
            $scope.addBtnText = $scope.mode === 'add' ? 'Cancel' : 'New Recipe';
            $scope.addBtnClass = $scope.mode === 'add' ? 'btn-warning' : 'btn-primary';
            $scope.addBtnIcon = $scope.mode === 'add' ? 'fa-close' : 'fa-plus-circle';
        };

        var toggleAddRecipe = function () {
            $scope.mode = $scope.mode === 'add' ? 'view' : 'add';
            resetAddBtn();
        };

        var toggleEditRecipe = function () {
            if($scope.mode === 'edit'){
                $scope.mode = 'view';
                $scope.reloadRecipeTypeDetail($scope.recipeType.id);
            } else {
                $scope.mode = 'edit';
            }
            $scope.editMode = '';
            resetEditBtn();
        };

        var enableSaveRecipe = function () {
            $scope.recipeType.modified = true;
            $scope.saveBtnClass = 'btn-success';
        };

        var disableSaveRecipe = function () {
            $scope.recipeType.modified = false;
            $scope.saveBtnClass = 'btn-default;'
        };

        var confirmChangeRecipe = function () {
            var modalInstance = $uibModal.open({
                animation: $scope.animationsEnabled,
                templateUrl: 'confirmDialog.html',
                scope: $scope,
                size: 'sm'
            });

            return modalInstance.result;
        };

        var getRecipeTypeJobClassName = function(job){
            // default to 'nostatus'
            var className = 'nostatus';
            // find the associated job in the recipe.jobs
            if($scope.recipe){
                var recipejob = _.find($scope.recipe.jobs,{job_name: job.name});
                if(recipejob){
                    className = recipejob.job.status.toLowerCase();
                }
            }
            return className;
        };

        $scope.reloadRecipeTypeDetail = function (id) {
            var getRecipeDetail = function () {
                recipeService.getRecipeTypeDetail(id).then(function (data) {
                    $scope.recipeType = data;

                });
            };

            if ($scope.recipeType.modified) {
                confirmChangeRecipe().then(function () {
                    // OK
                    disableSaveRecipe();
                    resetAddBtn();
                    if ($scope.mode === 'edit') {
                        toggleEditRecipe();
                    }
                    getRecipeDetail();
                }, function () {
                    // Cancel

                });
            } else {
                if ($scope.mode === 'edit') {
                    toggleEditRecipe();
                }
                resetAddBtn();
                getRecipeDetail();
            }
        };

        $scope.redraw = function () {
            initialize();
            //$rootScope.$broadcast('recipeModified');
        };

        $scope.nodeClick = function (name) {
            // Remove selection class
            $('div').removeClass('selected-node');
            $('div').removeClass('selected-node-dependency');
            $('div').removeClass('job-active');

            // find the job in the recipe definition
            var job = _.find($scope.recipeType.definition.jobs,{name: name});

            if(name === 'start'){
                job = startJob;
            }
            var $name = $('#' + name);
            var pos = $name.position();

            // click node different from selectedJob
            if (!$scope.selectedJob || job.name !== $scope.selectedJob.name) {
                if ($scope.editMode === 'addDependency') {
                    addDependency(name);
                    enableSaveRecipe();
                    $scope.redraw();

                } else if ($scope.editMode === 'addInput') {
                    $scope.selectedInputProvider = job;
                    $('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
                    $('#' + name).addClass('selected-node-dependency');
                    $('#output-selector').css({top: pos.top, left: pos.left, position: 'absolute'});
                    console.log('toggle input selector');
                } else if ($scope.editMode === 'addOutput'){
                    $scope.selectedOutputReceiver = job;
                    // set position of output-selector
                    $('#input-selector').css({top: pos.top, left: pos.left, position: 'absolute'});
                    //$scope.mode = 'addInputActive';
                    $('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
                    $('#' + name).addClass('selected-node-dependency');
                    console.log('toggle output selector');
                } else {
                    // update the selected job
                    $scope.selectedJob = job;
                    if($scope.recipe){
                        $scope.selectedRecipeJob = _.find($scope.recipe.jobs, { job_name: job.name });
                    }
                    // apply the selected-node class
                    $name.addClass('selected-node');
                }
            }
            else { // click selected node
                $('div').removeClass('selected-node');
                $scope.selectedJob = null;
                $scope.selectedRecipeJob = null;
                $scope.selectedOutputReceiver = null;
                $scope.selectedInputProvider = null;
                $scope.editMode = '';
                $scope.dependencyBtnClass = 'fa-plus';

                $('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
            }
            if($scope.selectedJob){
                $('#' + $scope.selectedJob.name).addClass('selected-node');
            }
        };
        $scope.toggleEditMode = function () {
            if ($scope.mode === 'edit') {
                $scope.reloadRecipeTypeDetail($scope.recipeType.id);
            } else {
                toggleEditRecipe();
                resetAddBtn();
            }
            $rootScope.$broadcast('toggleEdit', $scope.mode);
        };

        $scope.openAddJob = function () {
            var modalInstance = $uibModal.open({
                animation: $scope.animationsEnabled,
                templateUrl: 'addJobContent.html',
                scope: $scope,
                size: 'sm'
            });

            modalInstance.result.then(function () {
                if($scope.selectedJobType){
                    jobTypeService.getJobTypeDetails($scope.selectedJobType.id).then(function(data){
                        $scope.addJobType(data);
                        enableSaveRecipe();
                    });
                }
            }, function () {

            });
        };

        $scope.openEditTrigger = function () {
            var modalInstance = $uibModal.open({
                animation: $scope.animationsEnabled,
                templateUrl: 'editTrigger.html',
                scope: $scope,
                size: 'md'
            });

            modalInstance.result.then(function () {
                if( $scope.mode === 'edit' || $scope.mode === 'add' ) {
                    $scope.recipeType.trigger_rule.configuration.condition.data_types = $scope.recipeTypeTrigger.dataTypes ? $scope.recipeTypeTrigger.dataTypes.split(',') : [];
                    enableSaveRecipe();
                }
            }, function () {

            });


        };

        $scope.deleteRecipeInput = function(inputName){
            var removedRecipeInput = _.remove($scope.recipeType.definition.input_data, function (recipeInput) {
                return recipeInput.name === inputName;
            });
            console.log('removed ' + removedRecipeInput.length + ' recipe inputs.');
            enableSaveRecipe();
            $scope.redraw();

        };

        $scope.openAddInput = function(){
            var modalInstance = $uibModal.open({
                animation: $scope.animationsEnabled,
                templateUrl: 'addInput.html',
                scope: $scope
            });

            modalInstance.result.then(function(){
                // check for fields and add as necessary
                if( $scope.selectedRecipeInputType.fields.length > 0){
                    var fieldArr = [];
                    _.forEach($scope.selectedRecipeInputType.fields, function(field){
                        _.forEach(field.value.split(','), function(value){
                            fieldArr.push(value);
                        });
                        $scope.recipeInput[field.name] = fieldArr;
                    });
                }

                // add input to recipe type definition
                $scope.recipeType.definition.input_data.push($scope.recipeInput);
                _.forEach($scope.recipeType.definition.jobs, function(job){
                    if(job.recipe_inputs.length === 0){
                        job.recipe_inputs.push({
                            job_input: $scope.recipeInput.name,
                            recipe_input: $scope.recipeInput.name
                        });
                    }
                });
                getIoMappings();

                // reset form fields
                $scope.recipeInput = {
                    name: '',
                    required: true,
                    type: ''
                };
                $scope.selectedRecipeInputType = {};
            });
        };

        $scope.changeInputType = function(){
            $scope.selectedRecipeInputType = _.find($scope.recipeInputTypes, {'name': $scope.recipeInput.type});
        };

        var getWarningsHtml = function (warnings) {
            var warningsHtml = '';
            _.forEach(warnings, function (warning) {
                warningsHtml += '<b>' + warning.id + ':</b> ' + warning.details + '<br /><br />';
            });
            warningsHtml += '<button type="button" class="btn btn-default btn-xs clear">Hide</button>';
            return warningsHtml;
        };

        $scope.validateRecipeType = function () {
            recipeService.validateRecipeType($scope.recipeType).then(function(validationResult){
                if(validationResult.warnings && validationResult.warnings.length > 0){
                    // display the warnings
                    var warningsHtml = getWarningsHtml(validationResult.warnings);
                    toastr["error"](warningsHtml);
                } else {
                    toastr["success"]('Recipe is valid.');
                }
            }).catch(function(error){
                if(error.detail){
                    toastr["error"](error.detail);
                } else {
                    toastr["error"](error);
                }
            });

        };


        $scope.saveRecipeType = function () {
            $scope.savingRecipe = true;
            console.log('save recipe: ' + $scope.recipeType.name);
            recipeService.validateRecipeType($scope.recipeType).then(function(validationResult){
                if(validationResult.warnings && validationResult.warnings.length > 0){
                    // display the warnings
                    var warningsHtml = getWarningsHtml(validationResult.warnings);
                    toastr["error"](warningsHtml);
                    $scope.savingRecipe = false;
                } else {
                    recipeService.saveRecipeType($scope.recipeType).then(function(saveResult){
                        $scope.savingRecipe = false;
                        $scope.recipeType = saveResult;
                        $scope.redraw();
                        //$location.path('/recipes/types/' + saveResult.id);
                    });
                }
            }).catch(function(error){
                if(error && error.detail){
                    toastr['error'](error.detail);
                } else {
                    toastr['error'](error);
                }
                $scope.savingRecipe = false;
            });

            disableSaveRecipe();
        };

        $scope.addJobType = function (selectedJobType) {
            console.log(selectedJobType.name);
            $scope.recipeType.definition.addJob(selectedJobType);
            $scope.$broadcast('redrawRecipes');
        };

        $scope.mapInput = function (providerName, providerOutput) {
            console.log('map selected job input to ' + providerName + '.' + providerOutput);
            var dependency = _.find($scope.selectedJob.dependencies, {name: providerName});

            if(dependency && dependency.connections && dependency.connections.length > 0){
                var conn = _.find(dependency.connections, { output: providerOutput, input: $scope.selectedJobInput.name });
                if(!conn){
                    dependency.connections.push({ output: providerOutput, input: $scope.selectedJobInput.name });
                }
            }
            else if(!dependency){
                dependency = {name: providerName, connections: [{ output: providerOutput, input: $scope.selectedJobInput.name }]};
                $scope.selectedJob.dependencies.push(dependency);
            }
            else {
                dependency.connections = [{ output: providerOutput, input: $scope.selectedJobInput.name }];
            }
            $scope.selectedJob.depStart = false;
            $scope.editMode = '';
            $scope.selectedJobInput = null;
            $scope.selectedInputProvider = null;
            enableSaveRecipe();
            $scope.redraw();
        };

        $scope.mapInputRecipeInput = function(recipeInput){
            console.log('map selected job to recipe input ' + recipeInput);
            var existingInput = _.find($scope.selectedJob.recipe_inputs, { job_input: $scope.selectedJobInput.name });
            if( existingInput && existingInput.recipe_name !== recipeInput){
                // update it
                existingInput.recipe_input = recipeInput;
                enableSaveRecipe();
                $scope.redraw();
            } else if( !existingInput ){
                // create it
                $scope.selectedJob.recipe_inputs.push({
                    job_input: $scope.selectedJobInput.name,
                    recipe_input: recipeInput
                });
                enableSaveRecipe();
                $scope.redraw();
            }
            $scope.editMode = '';
            $scope.selectedJobInput = null;
            $scope.selectedInputProvider = null;
        };

        $scope.mapOutput = function (receiverName, receiverInput) {
            var dependency = _.find($scope.selectedOutputReceiver.dependencies, {name: $scope.selectedJob.name});

            if(dependency && dependency.connections && dependency.connections.length > 0){
                var conn = _.find(dependency.connections, { output: $scope.selectedJobOutput.name, input: receiverInput });
                if(!conn){
                    dependency.connections.push({output: $scope.selectedJobOutput.name, input: receiverInput});
                }
            }
            else if(!dependency){
                dependency = {name: $scope.selectedJob.name, connections: [{output: $scope.selectedJobOutput.name, input: receiverInput}]};
                $scope.selectedOutputReceiver.dependencies.push(dependency);
            }
            else {
                dependency.connections = [{output: $scope.selectedJobOutput.name, input: receiverInput}];
            }
            $scope.selectedOutputReceiver.depStart = false;
            $scope.editMode = '';
            $scope.selectedJobOutput = null;
            $scope.selectedOutputReceiver = null;
            enableSaveRecipe();
            $scope.redraw();
        };

        $scope.toggleAddDependency = function () {
            if ($scope.editMode === 'addDependency') {
                $scope.editMode = '';
                $scope.dependencyBtnClass = 'fa-plus';
                $('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
            } else {
                console.log('toggle addDependency mode');
                $scope.editMode = 'addDependency';
                $scope.dependencyBtnClass = 'fa-minus';
                $('.recipeNode:not(".selected-node")').addClass('selected-node-selectable');
            }
        };

        $scope.toggleAddInput = function (jobinput) {
            if ($scope.editMode === 'addInput') {
                $scope.editMode = '';
                $('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
            } else {
                $scope.selectedJobInput = jobinput;
                console.log('toggle addInput mode');
                $scope.editMode = 'addInput';
                $('.recipeNode:not(".selected-node")').addClass('selected-node-selectable');
            }
        };

        $scope.toggleAddOutput = function (joboutput) {
            if ($scope.editMode === 'addOutput') {
                $scope.editMode = '';
                $('.recipeNode:not(".selected-node")').removeClass('selected-node-selectable');
            } else {
                $scope.selectedJobOutput = joboutput;
                console.log('toggle addOutput mode');
                $scope.editMode = 'addOutput';
                $('.recipeNode:not(".selected-node")').addClass('selected-node-selectable');
            }
        };

        $scope.removeDependency = function (depName) {
            var removedDeps = _.remove($scope.selectedJob.dependencies, function (dep) {
                return dep.name === depName;
            });
            console.log('removed ' + removedDeps.length + ' dependencies.');
            enableSaveRecipe();
            $scope.redraw();
        };

        $scope.removeInputMapping = function (depName, depOutput) {
            if( depName === 'recipe' ){
                // remove it from selectedJob.recipe_inputs
                var dep = _.remove($scope.selectedJob.recipe_inputs, { recipe_input: depOutput });
                enableSaveRecipe();
                $scope.redraw();
            } else {
                var dep = _.find($scope.selectedJob.dependencies, {name: depName});
                if (dep && dep.connections) {
                    // it's an input from another job
                    var removedCon = _.remove(dep.connections, function (conn) {
                        return conn.output === depOutput;
                    });
                    console.log('removed ' + removedCon.length + ' input connections.');
                    enableSaveRecipe();
                    $scope.redraw();
                }
            }

        };

        $scope.deleteRecipeJob = function(jobName){
            // remove dependent connections
            _.forEach($scope.recipeType.definition.jobs, function(job){
                _.remove(job.dependencies, {name: jobName});
            });
            // remove job from definition.jobs
            _.remove($scope.recipeType.definition.jobs, { name: jobName });
            // enable save and redraw
            $scope.selectedJob = null;
            enableSaveRecipe();
            $scope.redraw();
        };

        $scope.removeOutputMapping = function (jobName, depOutput) {
            // we have to remove output mapping from the job where the dependency is defined
            var receiver = _.find($scope.recipeType.definition.jobs,{name: jobName});
            // remove it from receiver.dependencies
            var dep = _.find(receiver.dependencies, {name: $scope.selectedJob.name});
            if (dep && dep.connections) {
                var removedCon = _.remove(dep.connections, function (conn) {
                    return conn.output === depOutput;
                });
                console.log('removed ' + removedCon.length + ' output connections.');
                enableSaveRecipe();
                $scope.redraw();
            }
        };

        $scope.selectJobTypeToAdd = function(item){
            $scope.selectedJobType = item;
        };

        $scope.$on('redrawRecipes', function () {
            $scope.redraw();
        });

        var addDependency = function(jobName){
            console.log($scope.selectedJob.name + '->' + jobName);
            if (!$scope.selectedJob.dependencies) {
                $scope.selectedJob.dependencies = [];
            }
            var existingDependency = _.find($scope.selectedJob.dependencies, {name: jobName});

            if(!existingDependency){ $scope.selectedJob.dependencies.push({name: jobName}); }
            $scope.selectedJob.depStart = false;
            $scope.editMode = '';
            $scope.dependencyBtnClass = 'fa-plus';

        };

        var getIoMappings = function () {
            if($scope.recipeType.definition){
                _.forEach($scope.recipeType.definition.jobs, function (job) {
                    // populate the current jobType
                    /*var thisJobType = _.find($scope.recipeType.job_types,{id: job.job_type_id});
                    job.job_type = thisJobType;*/

                    // find dependents
                    if (job.job_type && job.job_type.job_type_interface) {
                        _.forEach(job.job_type.job_type_interface.output_data, function (jobOutput, key) {
                            if (jobOutput) {
                                var deps = getDependents(job.name,jobOutput.name);
                                jobOutput.dependents = deps;
                            }
                        });
                        // add dependency mappings
                        _.forEach(job.job_type.job_type_interface.input_data, function (jobInput, key) {
                            if (jobInput) {
                                var inputMappings = [];
                                _.forEach(job.dependencies, function (dependency,key) {
                                    _.forEach(dependency.connections, function (conn,key) {
                                        if (conn.input === jobInput.name) {
                                            inputMappings.push({
                                                name: dependency.name,
                                                output: conn.output,
                                                input: conn.input
                                            });
                                        }
                                    });
                                });
                                _.forEach(job.recipe_inputs, function(recipeInput, key){
                                    if(recipeInput.job_input === jobInput.name){
                                        inputMappings.push({
                                            name: 'recipe',
                                            output: recipeInput.recipe_input,
                                            input: recipeInput.job_input
                                        });
                                    }
                                });
                                jobInput.dependencies = inputMappings;
                            }
                        });

                    }
                });
            }

        };

        var initialize = function () {

            jobTypeService.getJobTypesOnce().then(function(data){
                $scope.jobTypeValues = data.results;
            });

            workspacesService.getWorkspaces().then(function(data){
                $scope.availableWorkspaces = data
            });

            $scope.$watch('recipeType', function (newValue, oldValue) {
                if ($scope.recipeType) {
                    if (!$scope.recipeType.id || $scope.recipeType.id === 0) {
                        $scope.mode = 'add';
                    }
                    _.forEach($scope.recipeType.definition.jobs, function (job, idx) {
                        if(!job.job_type.job_type_interface && $scope.recipeType.job_types){
                            var jobTypeData = _.find($scope.recipeType.job_types, {name: job.job_type.name, version: job.job_type.version});
                            $scope.recipeType.definition.jobs[idx].job_type = jobTypeData;
                        }

                    });

                    // setup string to bind comma delimited list of trigger rule configuration condition data types
                    if($scope.recipeType.trigger_rule && $scope.recipeType.trigger_rule.configuration && $scope.recipeType.trigger_rule.configuration.condition && $scope.recipeType.trigger_rule.configuration.condition.data_types){
                        $scope.recipeTypeTrigger.dataTypes = $scope.recipeType.trigger_rule.configuration.condition.data_types.join(',');
                    }

                    initGraph();
                    getIoMappings();
                    drawGraph($scope.isUpdate);
                }
            });
            if($rootScope.user){
                $scope.readonly = false;
            }
        };

        var initGraph = function () {
            // ******
            // setup D3 container and Graph
            // ******
            //$scope.selectedJob = null;
            function clicked() {
                var d = d3.event;
                var x = d3.event.x;
                var y = d3.event.y;
                var width = parseInt(svg.style("width").replace(/px/, ""));
                var height = parseInt(svg.style("height").replace(/px/, ""));

                inner.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(2)translate(" + -x + "," + -y + ")");

                //inner.attr("transform", "translate(50px, 50px)scale(2,3)");

                console.log(d);
            }

            svg = d3.select("svg");
            inner = svg.select("g"); //.on("click", clicked);
            // Set up zoom support
            zoom = d3.behavior.zoom().on("zoom", function () {
                inner.attr("transform", "translate(" + d3.event.translate + ")" +
                    "scale(" + d3.event.scale + ")");
            });
            svg.call(zoom);

            render = new dagreD3.render();

            // Left-to-right layout
            graph = new dagreD3.graphlib.Graph();
            graph.setGraph({
                nodesep: 70,
                ranksep: 50,
                rankdir: "TB",
                marginx: 20,
                marginy: 20
            });
        };

        drawGraph = function (isUpdate) {
            // globals because dagre needs a reference to angular scope
            window.nodeClick = function(name) {
                var scope = angular.element(document.getElementById('recipeviewer')).scope();
                scope.$apply(function () {
                    scope.nodeClick(name);
                });
            };

            window.mapInput = function(jobName, jobOutput){
                var scope = angular.element(document.getElementById('recipeviewer')).scope();
                scope.$apply(function () {
                    scope.mapInput(jobName, jobOutput);
                });
            };

            $scope.isUpdate = true;
            if($scope.recipe){
                $scope.lastStatusChange = $scope.recipe.last_modified ? moment.duration(moment.utc($scope.recipe.last_modified).diff(moment.utc())).humanize(true) : '';
            }

            var jobs = [];
            if ($scope.recipeType.definition) {
                jobs = $scope.recipeType.definition.jobs;
            }
            var childCounts = [];
            // create graph objects
            for (var idx in jobs) {
                var job = jobs[idx];

                if ( job.dependencies === undefined || job.dependencies.length < 1) {
                    job.depStart = true;
                }
                var className = getRecipeTypeJobClassName(job);

                var html = '<div>';
                //var html = "<div onclick=\"console.log('" + job.job_type.name + "')\">";
                html += '<span class="status"></span>';
                //   html += "<span class=consumers>"+worker.consumers+"</span>";
                html += '<span class="name">';
                if (job.job_type) {
                    //console.log(job.jobType);
                    html += '<div id="' + job.name + '" class="recipeNode" onclick="nodeClick(\'' + job.name + '\')"><span class="name">' + job.job_type.getIcon() + ' ' + job.name + '</span></div>';
                    //if(jobType.name){
                    //    html += '<div id="' + job.name + '" class="recipeNode" onclick="nodeClick(\'' + job.name + '\')"><span class="name">' + jobType.getIcon() + ' ' + jobType.title + '</span></div>';
                    //} else {
                    //    html += '<div id="' + job.name + '" class="recipeNode" onclick="nodeClick(\'' + job.name + '\')"><span class="name">' + jobType.getIcon() + ' ' + job.name + '</span></div>';
                    //}

                }
                html += '</span>';
                //   html += "<span class=queue><span class=counter>"+worker.count+"</span></span>";
                html += '</div>';
                graph.setNode(job.name, {
                    labelType: 'html',
                    label: html,
                    rx: 5,
                    ry: 5,
                    padding: 0,
                    class: className
                });
                // setup edges
                for (var d in job.dependencies) {
                    var dep = job.dependencies[d];

                    if (dep.name) {
                        graph.setEdge(dep.name, job.name, {
                            //labelType: 'html',
                            //label: dep.name + '-->' + job.name,
                            width: 20

                        });
                        if (childCounts[dep.name]) {
                            childCounts[dep.name] += 1;
                        } else {
                            childCounts[dep.name] = 1;
                        }
                    }
                }
            }

            // set start node and edges
            graph.setNode('start', {
                labelType: 'html',
                label: '<div id="start" class="recipeNode" onclick="nodeClick(\'start\')"><span class=name>Start</span></div>',
                rx: 5,
                ry: 5,
                padding: 0
            });
            startJob = {
                name: 'start',
                job_type: {
                    title: 'Start'
                },
                input_data: $scope.recipeType.input_data
            };
            var noDeps = _.filter(jobs, 'depStart', true);
            for (var n in noDeps) {
                graph.setEdge('start', noDeps[n].name, {
                    width: 20
                });
            }

            // set end node and edges
            graph.setNode('end', {
                labelType: 'html',
                label: '<div><span class=name>End</span></div>',
                rx: 5,
                ry: 5,
                padding: 0
            });
            var noChildren =_.filter(jobs, function (job) {
                return !childCounts[job.name];
            });
            for (var o in noChildren) {
                graph.setEdge(noChildren[o].name, 'end', {
                    width: 20
                });
            }

            // wait for current call stack to clear
            _.defer(function () {
                inner.call(render, graph);

                // Zoom and scale to fit
                var zoomScale = zoom.scale();
                var graphWidth = graph.graph().width + 40;
                var graphHeight = graph.graph().height + 40;
                var width = parseInt(svg.style("width").replace(/px/, ""));
                var height = parseInt(svg.style("height").replace(/px/, ""));
                //zoomScale = Math.min(width / graphWidth, height / graphHeight);
                //if(zoomScale<0.80){
                //  zoomScale = 0.80;
                // }
                zoomScale = 0.75;
                if(zoomScale < 1){
                    //console.log('zoomScale: ' + zoomScale);
                    var translate = [0,0];// [(width*zoomScale)-(graphWidth*zoomScale), 0];
                    zoom.translate(translate);
                    zoom.scale(zoomScale);
                    zoom.event(isUpdate ? svg.transition().duration(500) : d3.select("svg"));
                }

                // add selected class to appropriate node
                if($scope.selectedJob){
                    $('#' + $scope.selectedJob.name).addClass('selected-node');
                }
            });
        };

        var getDependents = function (name,outputName) {
            var results = [];

            _.forEach($scope.recipeType.definition.jobs, function (job, key) {
                if (job.name !== name) {
                    _.forEach(job.dependencies, function (dependency, key) {
                        if (dependency.name === name) {
                            _.forEach(dependency.connections, function (conn, key) {
                                if (conn.output === outputName) {
                                    results.push({
                                        name: job.name,
                                        output: conn.output,
                                        input: conn.input
                                    });
                                }
                            });
                        }
                    });
                }
            });
            return results;
        };

        initialize();

    }]).directive('aisScaleRecipeGraphViewer', function () {
        'use strict';
        /**
         * Usage: <ais-scale-recipe-viewer recipe="recipe" />
         */
        return {
            controller: 'aisScaleRecipeGraphViewerController',
            templateUrl: 'modules/recipes/partials/recipeGraphViewerTemplate.html',
            restrict: 'E',
            scope: {
                recipeType: '=',
                recipe: '=',
                isModified: '=modified',
                allowEdit: '=',
                hasContainer: '='
            },
            link: function (scope) {
                angular.element(document).ready(function () {
                    var elHeight = document.getElementsByClassName('recipe-viewer-title')[0].scrollHeight;
                    scope.detailMaxHeight = scope.$parent.detailMaxHeight ? scope.$parent.detailMaxHeight - elHeight : 700;
                    scope.detailContainerStyle = 'height: ' + scope.detailMaxHeight + 'px; max-height: ' + scope.detailMaxHeight + 'px; overflow-y: auto;';
                });
            }
        };

    });
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('Recipe', ['RecipeType', 'scaleService', function (RecipeType, scaleService) {
        var Recipe = function (id, created, completed, last_modified, recipe_type) {
            this.id = id;
            this.created = created;
            this.completed = completed;
            this.last_modified = last_modified;
            this.last_status_change = last_modified ? moment.duration(moment.utc(last_modified).diff(moment.utc())).humanize(true) : '';
            this.recipe_type = RecipeType.transformer(recipe_type);
        };

        // public methods
        Recipe.prototype = {
            getDuration: function () {
                return scaleService.calculateDuration(this.created, this.last_modified);
            }
        };

        // static methods, assigned to class
        Recipe.build = function (data) {
            if (data) {
                return new Recipe(
                    data.id,
                    data.created,
                    data.completed,
                    data.last_modified,
                    data.recipe_type
                );
            }
            return new Recipe();
        };

        Recipe.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(Recipe.build)
                    .filter(Boolean);
            }
            return Recipe.build(data);
        };

        return Recipe;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeData', function () {
        var RecipeData = function (input_data, version, workspace_id) {
            this.input_data = input_data;
            this.version = version;
            this.workspace_id = workspace_id;
        };

        // static methods, assigned to class
        RecipeData.build = function (data) {
            if (data) {
                return new RecipeData(
                    data.input_data,
                    data.version,
                    data.workspace_id
                );
            }
            return new RecipeData();
        };

        RecipeData.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeData.build)
                    .filter(Boolean);
            }
            return RecipeData.build(data);
        };

        return RecipeData;
    });
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeDetails', ['RecipeData', 'RecipeTypeDefinition', 'RecipeType', 'RecipeTypeDetail', 'RecipeJobContainer', 'scaleConfig', function (RecipeData, RecipeTypeDefinition, RecipeType, RecipeTypeDetail, RecipeJobContainer, scaleConfig) {
        var RecipeDetails = function (id, created, completed, last_modified, data, recipe_type, recipe_type_rev, jobs) {
            this.id = id;
            this.created = created;
            this.completed = completed;
            this.completed_formatted = this.completed ? moment.utc(this.completed).toISOString() : this.completed;
            this.last_modified = last_modified;
            this.data = RecipeData.transformer(data);
            this.recipe_type = RecipeType.transformer(recipe_type);
            this.recipe_type_rev = RecipeTypeDetail.transformer(recipe_type_rev);
            this.jobs = RecipeJobContainer.transformer(jobs);
        };

        // static methods, assigned to class
        RecipeDetails.build = function (data) {
            if (data) {
                return new RecipeDetails(
                    data.id,
                    data.created,
                    data.completed,
                    data.last_modified,
                    data.data,
                    data.recipe_type,
                    data.recipe_type_rev,
                    data.jobs
                );
            }
            return new RecipeDetails();
        };

        RecipeDetails.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeDetails.build)
                    .filter(Boolean);
            }
            return RecipeDetails.build(data);
        };

        return RecipeDetails;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeJob', ['JobType', function (JobType) {
        var RecipeJob = function (id, status, job_type) {
            this.id = id;
            this.status = status;
            this.job_type = JobType.transformer(job_type);
        };

        // static methods, assigned to class
        RecipeJob.build = function (data) {
            if (data) {
                return new RecipeJob(
                    data.id,
                    data.status,
                    data.job_type
                );
            }
            return new RecipeJob();
        };

        RecipeJob.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeJob.build)
                    .filter(Boolean);
            }
            return RecipeJob.build(data);
        };

        return RecipeJob;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeJobContainer', ['RecipeJob', function (RecipeJob) {
        var RecipeJobContainer = function (job_name, job) {
            this.job_name = job_name;
            this.job = RecipeJob.transformer(job);
        };

        // static methods, assigned to class
        RecipeJobContainer.build = function (data) {
            if (data) {
                return new RecipeJobContainer(
                    data.job_name,
                    data.job
                );
            }
            return new RecipeJobContainer();
        };

        RecipeJobContainer.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeJobContainer.build)
                    .filter(Boolean);
            }
            return RecipeJobContainer.build(data);
        };

        return RecipeJobContainer;
    }]);
})();
(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeType', ['scaleConfig', 'RecipeTypeDefinition', function (scaleConfig, RecipeTypeDefinition) {
        var RecipeType = function (id, name, version, title, description, is_active, definition, revision_num, created,  last_modified, archived, trigger_rule) {
            this.id = id;
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            this.is_active = is_active;
            this.definition = definition ? RecipeTypeDefinition.transformer(definition) : new RecipeTypeDefinition();
            this.revision_num = revision_num;
            this.created = created;
            this.last_modified = last_modified;
            this.archived = archived;
            this.trigger_rule = trigger_rule;
            this.modified = false;
        };

        // static methods, assigned to class
        RecipeType.build = function (data) {
            if(data){
                return new RecipeType(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.is_active,
                    data.definition,
                    data.revision_num,
                    data.created,
                    data.last_modified,
                    data.archived,
                    data.trigger_rule
                );
            }
            return new RecipeType();
        };

        RecipeType.transformer = function (data) {
            if (angular.isArray(data)) {
                return data.map(RecipeType.build);
            }
            return RecipeType.build(data);
        };

        return RecipeType;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeDefinition', ['scaleConfig', 'RecipeTypeDefinitionJob', 'JobTypeInputData', function (scaleConfig, RecipeTypeDefinitionJob, JobTypeInputData) {

        var self = this;
        // private methods
        var RecipeTypeDefinition = function (input_data, version, jobs) {
            this.input_data = input_data ? JobTypeInputData.transformer(input_data) : [];
            this.version = version || '1.0';
            this.jobs = jobs ? RecipeTypeDefinitionJob.transformer(jobs) : [];
        };

        var getJobName = function(jobs, jobName){
            var theName = jobName;
            var existing = _.find(jobs, { 'name': jobName });
            var idx = 2;
            while(existing){
                theName = jobName + '-' + idx;
                existing = _.find(jobs, { 'name': theName });
                idx++;
            }
            return theName;
        };

        // public methods
        RecipeTypeDefinition.prototype = {
            addJob: function (jobType) {
                var jname = getJobName(this.jobs, jobType.name);
                console.log(jname);
                var job = {
                    dependencies: [],
                    recipe_inputs: [],
                    name: jname,
                    job_type_id: jobType.id,
                    job_type: jobType
                };
                this.jobs.push(job);
            }
        };

        // static methods, assigned to class
        RecipeTypeDefinition.build = function (data) {
            if(data){
                return new RecipeTypeDefinition(
                    data.input_data,
                    data.version,
                    data.jobs
                );
            }
            return new RecipeTypeDefinition();
        };

        RecipeTypeDefinition.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeDefinition.build);
            }
            return RecipeTypeDefinition.build(data);
        };

        return RecipeTypeDefinition;
    }]);
})();

(function(){
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeDefinitionJob', ['scaleConfig', 'JobTypeDetails', function (scaleConfig, JobTypeDetails) {
        // private methods
        var RecipeTypeDefinitionJob = function (recipe_inputs, name, job_type, dependencies) {
            this.recipe_inputs = recipe_inputs;
            this.name = name;
            this.job_type = job_type;
            //this.job_type = {
            //    name: job_type.name,
            //    version: job_type.version
            //};
            this.dependencies = dependencies || [];
        };

        // static methods, assigned to class
        RecipeTypeDefinitionJob.build = function (data) {
            if (data) {
                return new RecipeTypeDefinitionJob(
                    data.recipe_inputs,
                    data.name,
                    data.job_type,
                    data.dependencies
                );
            }
            return new RecipeTypeDefinitionJob();
        };

        RecipeTypeDefinitionJob.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeDefinitionJob.build);
            }
            return RecipeTypeDefinitionJob.build(data);
        };


        return RecipeTypeDefinitionJob;

    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeDetail', ['scaleConfig', 'RecipeTypeDefinition', 'JobTypeDetails', function (scaleConfig, RecipeTypeDefinition, JobTypeDetails) {
        var RecipeTypeDetail = function (id, name, version, title, description, is_active, definition, created, last_modified, archived, trigger_rule, job_types) {
            this.id = id;
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            this.is_active = is_active;
            this.definition = RecipeTypeDefinition.transformer(definition);
            this.created = created;
            this.last_modified = last_modified;
            this.archived = archived;
            this.trigger_rule = trigger_rule;
            this.job_types = JobTypeDetails.transformer(job_types);
            this.modified = false;
        };

        // static methods, assigned to class
        RecipeTypeDetail.build = function (data) {
            if (data) {
                return new RecipeTypeDetail(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.is_active,
                    data.definition,
                    data.created,
                    data.last_modified,
                    data.archived,
                    data.trigger_rule,
                    data.job_types
                );
            }
            return new RecipeTypeDetail();
        };

        RecipeTypeDetail.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeDetail.build);
            }
            return RecipeTypeDetail.build(data);
        };

        return RecipeTypeDetail;
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').factory('RecipeTypeValidation', ['RecipeTypeDefinition', function (RecipeTypeDefinition) {

        var getRecipeTypeValidationJobs = function(jobs){
            var jobsOut = [];
            _.forEach(jobs, function(job){
               jobsOut.push({
                   recipe_inputs: job.recipe_inputs,
                   name: job.name,
                   job_type: {
                       name: job.job_type.name,
                       version: job.job_type.version
                   },
                   dependencies: job.dependencies
               })
            });
            return jobsOut;
        }
        var RecipeTypeValidation = function (id, name, version, title, description, definition, trigger_rule) {
            if(id){
                this.id = id;
            }
            this.name = name;
            this.version = version;
            this.title = title;
            this.description = description;
            //this.definition = definition ? RecipeTypeDefinition.transformer(definition) : new RecipeTypeDefinition();
            this.definition = {
                input_data: definition.input_data,
                version: definition.version,
                jobs: getRecipeTypeValidationJobs(definition.jobs)
            };
            this.trigger_rule = trigger_rule;
        };

        // static methods, assigned to class
        RecipeTypeValidation.build = function (data) {
            if (data) {
                return new RecipeTypeValidation(
                    data.id,
                    data.name,
                    data.version,
                    data.title,
                    data.description,
                    data.definition,
                    data.trigger_rule
                );
            }
            return new RecipeTypeValidation();
        };

        RecipeTypeValidation.transformer = function (data) {
            if (angular.isArray(data)) {
                return data
                    .map(RecipeTypeValidation.build);
            }
            return RecipeTypeValidation.build(data);
        };

        return RecipeTypeValidation;
    }]);
})();
(function () {
    'use strict';
    /**
     *
     */
    angular.module('scaleApp').service('recipeService', ['$http', '$q', '$timeout', 'scaleConfig', 'RecipeType', 'RecipeTypeDetail', 'Recipe', 'RecipeDetails', 'RecipeTypeValidation', function ($http, $q, $timeout, scaleConfig, RecipeType, RecipeTypeDetail, Recipe, RecipeDetails, RecipeTypeValidation) {
        var getRecipesParams = function (page, page_size, started, ended, order, completed, recipe_type_id, recipe_type_name, url) {
            return {
                page: page,
                page_size: page_size,
                started: started,
                ended: ended,
                order: order,
                completed: completed,
                recipe_type_id: recipe_type_id,
                recipe_type_name: recipe_type_name,
                url: url
            };
        };

        return {
            getRecipeTypes: function () {
                var d = $q.defer();
                $http.get(scaleConfig.urls.apiPrefix + 'recipe-types/').success(function (data) {
                    d.resolve(RecipeType.transformer(data.results));
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },

            getRecipeTypeDetail: function (id) {
              var d = $q.defer();

              $http.get(scaleConfig.urls.apiPrefix + 'recipe-types/' + id + '/').success(function (data) {
                var returnData = RecipeTypeDetail.transformer(data);
                d.resolve(returnData);
              });
              return d.promise;
            },

            getRecipes: function (params) {
                params = params || getRecipesParams();
                var d = $q.defer();

                $http({
                    url: params.url ? params.url : scaleConfig.urls.apiPrefix + 'recipes/',
                    method: 'GET',
                    params: params
                }).success(function (data) {
                    data.results = Recipe.transformer(data.results);
                    d.resolve(data);
                }).error(function (error) {
                    d.reject(error);
                });

                return d.promise;
            },

            getRecipeDetails: function (id) {
                var d = $q.defer();
                $http.get(scaleConfig.urls.apiPrefix + 'recipes/' + id + '/').success(function (data) {
                    var result = RecipeDetails.transformer(data);
                    d.resolve(result);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            },

            saveRecipeType: function(recipeType) {
                var d = $q.defer();
                var cleanRecipeType = RecipeTypeValidation.transformer(recipeType);

                if(!cleanRecipeType.id){
                    $http.post(scaleConfig.urls.apiPrefix + 'recipe-types/', cleanRecipeType).success(function (result) {
                        recipeType.id = result;
                        d.resolve(recipeType);
                    }).error(function(error){
                        d.reject(error);
                    });
                } else {
                    $http.patch(scaleConfig.urls.apiPrefix + 'recipe-types/' + cleanRecipeType.id + '/', cleanRecipeType).success(function (result) {
                        recipeType = result;
                        d.resolve(recipeType);
                    }).error(function(error){
                        d.reject(error);
                    });
                }

                return d.promise;
            },

            validateRecipeType: function (recipeType) {
                var d = $q.defer();
                var cleanRecipeType = RecipeTypeValidation.transformer(recipeType);

                $http.post(scaleConfig.urls.apiPrefix + 'recipe-types/validation/', cleanRecipeType).success(function (result) {
                    d.resolve(result);
                }).error(function(error){
                    d.reject(error);
                });

                return d.promise;
            }
        };
    }]);
})();

(function () {
    'use strict';

    angular.module('scaleApp').service('workspacesService', ['$http', '$q', '$resource', 'scaleConfig', function($http, $q, $resource, scaleConfig) {

        return {
            getWorkspaces: function () {
                var d = $q.defer();
                var url = scaleConfig.urls.apiPrefix + 'workspaces/';

                $http({
                    url: url,
                    method: 'GET'
                }).success(function (data) {
                    d.resolve(data.results);
                }).error(function (error) {
                    d.reject(error);
                });
                return d.promise;
            }//,
            //getWorkspaceDetails: function(id) {
            //
            //}
        };
    }]);
})();

/**
 * @author Dimitry Kudrayvtsev
 * @version 2.1
 */

 var updateWindow = function(){
    //  x = w.innerWidth || e.clientWidth || g.clientWidth;
    //  y = w.innerHeight|| e.clientHeight|| g.clientHeight;
     //
    //  svg.attr("width", x).attr("height", y);
    console.log('resize');
 };

 window.onresize = updateWindow;

d3.gantt = function() {
    var FIT_TIME_DOMAIN_MODE = "fit";
    var FIXED_TIME_DOMAIN_MODE = "fixed";

    var margin = {
		top : 20,
		right : 20,
		bottom : 20,
		left : 60
    };
    var timeDomainStart = d3.time.day.offset(new Date(),-3);
    var timeDomainEnd = d3.time.hour.offset(new Date(),+3);
    var timeDomainMode = FIT_TIME_DOMAIN_MODE;// fixed or fit
    var taskTypes = [];
    var taskStatus = [];
    var height = document.body.clientHeight - margin.top - margin.bottom-5;
    var width = document.body.clientWidth - margin.right - margin.left-5;
	var renderTo = "body";
	var begin = '';
	var ended = '';

    var tickFormat = "%H:%M:%S";

    var keyFunction = function(d) {
		return d[begin] + d.taskName + d[ended];
    };

    var rectTransform = function(d) {
		return "translate(" + x(d[begin]) + "," + y(d.taskName) + ")";
    };

    var x = d3.time.scale().domain([ timeDomainStart, timeDomainEnd ]).range([ 0, width ]).clamp(true);

    var y = d3.scale.ordinal().domain(taskTypes).rangeRoundBands([ 0, height - margin.top - margin.bottom ], .1);

    var xAxis = d3.svg.axis().scale(x).orient("bottom").tickFormat(d3.time.format(tickFormat)).tickSubdivide(true)
	    .tickSize(8).tickPadding(8);

    var yAxis = d3.svg.axis().scale(y).orient("left").tickSize(0);

    var initTimeDomain = function(tasks) {
	if (timeDomainMode === FIT_TIME_DOMAIN_MODE) {
	    if (tasks === undefined || tasks.length < 1) {
		timeDomainStart = d3.time.day.offset(new Date(), -3);
		timeDomainEnd = d3.time.hour.offset(new Date(), +3);
		return;
	    }
	    tasks.sort(function(a, b) {
		return a[ended] - b[ended];
	    });
	    timeDomainEnd = tasks[tasks.length - 1][ended];
	    tasks.sort(function(a, b) {
		return a[begin] - b[begin];
	    });
	    timeDomainStart = tasks[0][begin];
	}
    };

    var initAxis = function() {
	x = d3.time.scale().domain([ timeDomainStart, timeDomainEnd ]).range([ 0, width ]).clamp(true);
	y = d3.scale.ordinal().domain(taskTypes).rangeRoundBands([ 0, height - margin.top - margin.bottom ], .1);
	xAxis = d3.svg.axis().scale(x).orient("bottom").ticks(Math.ceil(width/150)).tickFormat(d3.time.format(tickFormat)).tickSubdivide(true)
		.tickSize(8).tickPadding(8);

	yAxis = d3.svg.axis().scale(y).orient("left").tickSize(0);
    };

    function gantt(tasks) {

	initTimeDomain(tasks);
	initAxis();

	var svg = d3.select(renderTo)
	.append("svg")
	.attr("class", "chart")
	.attr("width", width + margin.left + margin.right)
	.attr("height", height + margin.top + margin.bottom)
	.append("g")
        .attr("class", "gantt-chart")
	.attr("width", width + margin.left + margin.right)
	.attr("height", height + margin.top + margin.bottom)
	.attr("transform", "translate(" + margin.left + ", " + margin.top + ")");

      svg.selectAll(".chart")
	 .data(tasks, keyFunction).enter()
	 .append("rect")
	 .attr("rx", 5)
         .attr("ry", 5)
	 .attr("class", function(d){
	     if(taskStatus[d.status] == null){ return "bar";}
	     return taskStatus[d.status];
	     })
	 .attr("y", 0)
	 .attr("transform", rectTransform)
	 .attr("height", function(d) { return y.rangeBand(); })
	 .attr("width", function(d) {
	     return (x(d[ended]) - x(d[begin]));
	     });


	 svg.append("g")
	 .attr("class", "x axis")
	 .attr("transform", "translate(0, " + (height - margin.top - margin.bottom) + ")")
	 .transition()
	 .call(xAxis);

	 svg.append("g").attr("class", "y axis").transition().call(yAxis);

	 return gantt;

    };

    gantt.redraw = function(tasks) {
        console.log('redraw');
	initTimeDomain(tasks);
	initAxis();

        var svg = d3.select("svg");

        var ganttChartGroup = svg.select(".gantt-chart");
        var rect = ganttChartGroup.selectAll("rect").data(tasks, keyFunction);

        rect.enter()
         .insert("rect",":first-child")
         .attr("rx", 5)
         .attr("ry", 5)
	 .attr("class", function(d){
	     if(taskStatus[d.status] == null){ return "bar";}
	     return taskStatus[d.status];
	     })
	 .transition()
	 .attr("y", 0)
	 .attr("transform", rectTransform)
	 .attr("height", function(d) { return y.rangeBand(); })
	  .attr("width", function(d) {
	     return (x(d[ended]) - x(d[begin]));
	     });

        rect.transition()
          .attr("transform", rectTransform)
	 .attr("height", function(d) { return y.rangeBand(); })
	 .attr("width", function(d) {
	     return (x(d[ended]) - x(d[begin]));
	     });

	rect.exit().remove();

	svg.select(".x").transition().call(xAxis);
	svg.select(".y").transition().call(yAxis);

	return gantt;
    };

    gantt.margin = function(value) {
	if (!arguments.length)
	    return margin;
	margin = value;
	return gantt;
    };

    gantt.timeDomain = function(value) {
	if (!arguments.length)
	    return [ timeDomainStart, timeDomainEnd ];
	timeDomainStart = +value[0], timeDomainEnd = +value[1];
	return gantt;
    };

    /**
     * @param {string}
     *                vale The value can be "fit" - the domain fits the data or
     *                "fixed" - fixed domain.
     */
    gantt.timeDomainMode = function(value) {
	if (!arguments.length)
	    return timeDomainMode;
        timeDomainMode = value;
        return gantt;

    };

    gantt.taskTypes = function(value) {
	if (!arguments.length)
	    return taskTypes;
	taskTypes = value;
	return gantt;
    };

    gantt.taskStatus = function(value) {
	if (!arguments.length)
	    return taskStatus;
	taskStatus = value;
	return gantt;
    };

	gantt.begin = function(value){
		if(!arguments.length){
			return begin;
		}
		begin = value;
		return gantt;
	};

	gantt.ended = function(value){
		if(!arguments.length){
			return ended;
		}
		ended = value;
		return gantt;
	};

    gantt.width = function(value) {
	if (!arguments.length)
	    return width;
	width = +value;
	return gantt;
    };

    gantt.height = function(value) {
	if (!arguments.length)
	    return height;
	height = +value;
	return gantt;
    };

    gantt.tickFormat = function(value) {
	if (!arguments.length)
	    return tickFormat;
	tickFormat = value;
	return gantt;
    };

	gantt.renderTo = function(value) {
		if(!arguments.length){
			return renderTo;
		}
		renderTo = value;
		return gantt;
	};



    return gantt;
};

function Gauge(placeholderName, configuration)
{
    this.placeholderName = placeholderName;

    var self = this; // for internal d3 functions

    this.configure = function(configuration)
    {
        this.config = configuration;

        this.config.size = this.config.size * 0.9;

        this.config.raduis = this.config.size * 0.97 / 2;
        this.config.cx = this.config.size / 2;
        this.config.cy = this.config.size / 2;

        this.config.min = undefined != configuration.min ? configuration.min : 0;
        this.config.max = undefined != configuration.max ? configuration.max : 100;
        this.config.range = this.config.max - this.config.min;

        this.config.majorTicks = configuration.majorTicks || 5;
        this.config.minorTicks = configuration.minorTicks || 2;

        this.config.greenColor 	= configuration.greenColor || "#8fca0e";
        this.config.yellowColor = configuration.yellowColor || "#ffc317";
        this.config.redColor 	= configuration.redColor || "#f54d36";

        this.config.transitionDuration = configuration.transitionDuration || 500;
    };

    this.render = function()
    {
        this.body = d3.select("#" + this.placeholderName)
            .append("svg:svg")
            .attr("class", "gauge")
            .attr("width", this.config.size)
            .attr("height", this.config.size);

        this.body.append("svg:circle")
            .attr("class", "outer-circle")
            .attr("cx", this.config.cx)
            .attr("cy", this.config.cy)
            .attr("r", this.config.raduis * 0.95)
            .style("fill", "#ccc");
            /*.style("stroke", "#000")
            .style("stroke-width", "0.5px");*/

        this.body.append("svg:circle")
            .attr("cx", this.config.cx)
            .attr("cy", this.config.cy)
            .attr("r", 0.9 * this.config.raduis)
            .style("fill", "#fff")
            .style("stroke", "#e0e0e0")
            .style("stroke-width", "2px");

        for (var greenIdx in this.config.greenZones)
        {
            this.drawBand(this.config.greenZones[greenIdx].from, this.config.greenZones[greenIdx].to, self.config.greenColor);
        }

        for (var yellowIdx in this.config.yellowZones)
        {
            this.drawBand(this.config.yellowZones[yellowIdx].from, this.config.yellowZones[yellowIdx].to, self.config.yellowColor);
        }

        for (var redIdx in this.config.redZones)
        {
            this.drawBand(this.config.redZones[redIdx].from, this.config.redZones[redIdx].to, self.config.redColor);
        }

        var fontSize = 0;

        if (undefined != this.config.label)
        {
            fontSize = Math.round(this.config.size / 9);
            this.body.append("svg:text")
                .attr("x", this.config.cx)
                .attr("y", this.config.cy / 2 + fontSize / 2)
                .attr("dy", fontSize / 2)
                .attr("text-anchor", "middle")
                .text(this.config.label)
                .style("font-size", fontSize + "px")
                .style("fill", "#333")
                .style("stroke-width", "0px");
        }

        fontSize = Math.round(this.config.size / 16);
        var majorDelta = this.config.range / (this.config.majorTicks - 1);
        for (var major = this.config.min; major <= this.config.max; major += majorDelta)
        {
            var minorDelta = majorDelta / this.config.minorTicks,
                point1 = 0,
                point2 = 0;
            for (var minor = major + minorDelta; minor < Math.min(major + majorDelta, this.config.max); minor += minorDelta)
            {
                point1 = this.valueToPoint(minor, 0.75);
                point2 = this.valueToPoint(minor, 0.85);

                this.body.append("svg:line")
                    .attr("x1", point1.x)
                    .attr("y1", point1.y)
                    .attr("x2", point2.x)
                    .attr("y2", point2.y)
                    .style("stroke", "#666")
                    .style("stroke-width", "1px");
            }

            point1 = this.valueToPoint(major, 0.7);
            point2 = this.valueToPoint(major, 0.85);

            this.body.append("svg:line")
                .attr("x1", point1.x)
                .attr("y1", point1.y)
                .attr("x2", point2.x)
                .attr("y2", point2.y)
                .style("stroke", "#333")
                .style("stroke-width", "2px");

            if (major == this.config.min || major == this.config.max)
            {
                var point = this.valueToPoint(major, 0.63);

                this.body.append("svg:text")
                    .attr("x", point.x)
                    .attr("y", point.y)
                    .attr("dy", fontSize / 3)
                    .attr("text-anchor", major == this.config.min ? "start" : "end")
                    .text(major)
                    .style("font-size", fontSize + "px")
                    .style("fill", "#333")
                    .style("stroke-width", "0px");
            }
        }

        var pointerContainer = this.body.append("svg:g").attr("class", "pointerContainer");

        var midValue = (this.config.min + this.config.max) / 2;

        var pointerPath = this.buildPointerPath(midValue);

        var pointerLine = d3.svg.line()
            .x(function(d) { return d.x })
            .y(function(d) { return d.y })
            .interpolate("basis");

        pointerContainer.selectAll("path")
            .data([pointerPath])
            .enter()
            .append("svg:path")
            .attr("d", pointerLine)
            .style("fill", "#888");

        pointerContainer.append("svg:circle")
            .attr("cx", this.config.cx)
            .attr("cy", this.config.cy)
            .attr("r", 0.12 * this.config.raduis)
            .style("fill", "#888");

        fontSize = Math.round(this.config.size / 10);
        pointerContainer.selectAll("text")
            .data([midValue])
            .enter()
            .append("svg:text")
            .attr("x", this.config.cx)
            .attr("y", this.config.size - this.config.cy / 4 - fontSize)
            .attr("dy", fontSize / 2)
            .attr("text-anchor", "middle")
            .style("font-size", fontSize + "px")
            .style("fill", "#000")
            .style("stroke-width", "0px");

        this.redraw(this.config.min, 0);
    };

    this.buildPointerPath = function(value)
    {
        var delta = this.config.range / 13;

        var head = valueToPoint(value, 0.85);
        var head1 = valueToPoint(value - delta, 0.12);
        var head2 = valueToPoint(value + delta, 0.12);

        var tailValue = value - (this.config.range * (1/(270/360)) / 2);
        var tail = valueToPoint(tailValue, 0.28);
        var tail1 = valueToPoint(tailValue - delta, 0.12);
        var tail2 = valueToPoint(tailValue + delta, 0.12);

        return [head, head1, tail2, tail, tail1, head2, head];

        function valueToPoint(value, factor)
        {
            var point = self.valueToPoint(value, factor);
            point.x -= self.config.cx;
            point.y -= self.config.cy;
            return point;
        }
    };

    this.drawBand = function(start, end, color)
    {
        if (0 >= end - start) return;

        this.body.append("svg:path")
            .style("fill", color)
            .attr("d", d3.svg.arc()
                .startAngle(this.valueToRadians(start))
                .endAngle(this.valueToRadians(end))
                .innerRadius(0.65 * this.config.raduis)
                .outerRadius(0.85 * this.config.raduis))
            .attr("transform", function() { return "translate(" + self.config.cx + ", " + self.config.cy + ") rotate(270)" });
    };

    this.redraw = function(value, transitionDuration)
    {
        var pointerContainer = this.body.select(".pointerContainer");

        pointerContainer.selectAll("text").text(Math.round(value));

        var pointer = pointerContainer.selectAll("path");
        pointer.transition()
            .duration(undefined != transitionDuration ? transitionDuration : this.config.transitionDuration)
            //.delay(0)
            //.ease("linear")
            //.attr("transform", function(d)
            .attrTween("transform", function()
            {
                var pointerValue = value;
                if (value > self.config.max) pointerValue = self.config.max + 0.02*self.config.range;
                else if (value < self.config.min) pointerValue = self.config.min - 0.02*self.config.range;
                var targetRotation = (self.valueToDegrees(pointerValue) - 90);
                var currentRotation = self._currentRotation || targetRotation;
                self._currentRotation = targetRotation;

                return function(step)
                {
                    var rotation = currentRotation + (targetRotation-currentRotation)*step;
                    return "translate(" + self.config.cx + ", " + self.config.cy + ") rotate(" + rotation + ")";
                }
            });

        var outerCircle = this.body.select(".outer-circle")
            .transition()
            .duration(750)
            .style("fill", function () {
                var i = parseInt(value);
                if (i > 0 && i < 75) {
                    return self.config.greenColor;
                } else if (i >= 75 && i < 90) {
                    return self.config.yellowColor;
                } else {
                    return self.config.redColor;
                }
            });
    };

    this.valueToDegrees = function(value)
    {
        // thanks @closealert
        //return value / this.config.range * 270 - 45;
        return value / this.config.range * 270 - (this.config.min / this.config.range * 270 + 45);
    };

    this.valueToRadians = function(value)
    {
        return this.valueToDegrees(value) * Math.PI / 180;
    };

    this.valueToPoint = function(value, factor)
    {
        return { 	x: this.config.cx - this.config.raduis * factor * Math.cos(this.valueToRadians(value)),
            y: this.config.cy - this.config.raduis * factor * Math.sin(this.valueToRadians(value)) 		};
    };

    // initialization
    this.configure(configuration);
}
/*! 
 * angular-hotkeys v1.5.0
 * https://chieffancypants.github.io/angular-hotkeys
 * Copyright (c) 2015 Wes Cruver
 * License: MIT
 */
!function(){"use strict";angular.module("cfp.hotkeys",[]).provider("hotkeys",["$injector",function(a){this.includeCheatSheet=!0,this.useNgRoute=a.has("ngViewDirective"),this.templateTitle="Keyboard Shortcuts:",this.templateHeader=null,this.templateFooter=null,this.template='<div class="cfp-hotkeys-container fade" ng-class="{in: helpVisible}" style="display: none;"><div class="cfp-hotkeys"><h4 class="cfp-hotkeys-title" ng-if="!header">{{ title }}</h4><div ng-bind-html="header" ng-if="header"></div><table><tbody><tr ng-repeat="hotkey in hotkeys | filter:{ description: \'!$$undefined$$\' }"><td class="cfp-hotkeys-keys"><span ng-repeat="key in hotkey.format() track by $index" class="cfp-hotkeys-key">{{ key }}</span></td><td class="cfp-hotkeys-text">{{ hotkey.description }}</td></tr></tbody></table><div ng-bind-html="footer" ng-if="footer"></div><div class="cfp-hotkeys-close" ng-click="toggleCheatSheet()"></div></div></div>',this.cheatSheetHotkey="?",this.cheatSheetDescription="Show / hide this help menu",this.$get=["$rootElement","$rootScope","$compile","$window","$document",function(a,b,c,d,e){function f(a){var b={command:"",shift:"",left:"",right:"",up:"",down:"","return":"",backspace:""};a=a.split("+");for(var c=0;c<a.length;c++)"mod"===a[c]&&(d.navigator&&d.navigator.platform.indexOf("Mac")>=0?a[c]="command":a[c]="ctrl"),a[c]=b[a[c]]||a[c];return a.join(" + ")}function g(a,b,c,d,e,f){this.combo=a instanceof Array?a:[a],this.description=b,this.callback=c,this.action=d,this.allowIn=e,this.persistent=f,this._formated=null}function h(){for(var a=o.hotkeys.length;a--;){var b=o.hotkeys[a];b&&!b.persistent&&k(b)}}function i(){o.helpVisible=!o.helpVisible,o.helpVisible?(t=l("esc"),k("esc"),j("esc",t.description,i,null,["INPUT","SELECT","TEXTAREA"])):(k("esc"),t!==!1&&j(t))}function j(a,b,c,d,e,f){var h,i=["INPUT","SELECT","TEXTAREA"],j=Object.prototype.toString.call(a);if("[object Object]"===j&&(b=a.description,c=a.callback,d=a.action,f=a.persistent,e=a.allowIn,a=a.combo),b instanceof Function?(d=c,c=b,b="$$undefined$$"):angular.isUndefined(b)&&(b="$$undefined$$"),void 0===f&&(f=!0),"function"==typeof c){h=c,e instanceof Array||(e=[]);for(var k,l=0;l<e.length;l++)e[l]=e[l].toUpperCase(),k=i.indexOf(e[l]),-1!==k&&i.splice(k,1);c=function(a){var b=!0,c=a.target||a.srcElement,d=c.nodeName.toUpperCase();if((" "+c.className+" ").indexOf(" mousetrap ")>-1)b=!0;else for(var e=0;e<i.length;e++)if(i[e]===d){b=!1;break}b&&n(h.apply(this,arguments))}}"string"==typeof d?Mousetrap.bind(a,n(c),d):Mousetrap.bind(a,n(c));var m=new g(a,b,c,d,e,f);return o.hotkeys.push(m),m}function k(a){var b=a instanceof g?a.combo:a;if(Mousetrap.unbind(b),angular.isArray(b)){for(var c=!0,d=b.length;d--;)c=k(b[d])&&c;return c}var e=o.hotkeys.indexOf(l(b));return e>-1?(o.hotkeys[e].combo.length>1?o.hotkeys[e].combo.splice(o.hotkeys[e].combo.indexOf(b),1):o.hotkeys.splice(e,1),!0):!1}function l(a){if(!a)return o.hotkeys;for(var b,c=0;c<o.hotkeys.length;c++)if(b=o.hotkeys[c],b.combo.indexOf(a)>-1)return b;return!1}function m(a){return a.$id in p||(p[a.$id]=[],a.$on("$destroy",function(){for(var b=p[a.$id].length;b--;)k(p[a.$id].pop())})),{add:function(b){var c;return c=arguments.length>1?j.apply(this,arguments):j(b),p[a.$id].push(c),this}}}function n(a){return function(c,d){if(a instanceof Array){var e=a[0],f=a[1];a=function(a){f.scope.$eval(e)}}b.$apply(function(){a(c,l(d))})}}Mousetrap.prototype.stopCallback=function(a,b){return(" "+b.className+" ").indexOf(" mousetrap ")>-1?!1:b.contentEditable&&"true"==b.contentEditable},g.prototype.format=function(){if(null===this._formated){for(var a=this.combo[0],b=a.split(/[\s]/),c=0;c<b.length;c++)b[c]=f(b[c]);this._formated=b}return this._formated};var o=b.$new();o.hotkeys=[],o.helpVisible=!1,o.title=this.templateTitle,o.header=this.templateHeader,o.footer=this.templateFooter,o.toggleCheatSheet=i;var p=[];if(this.useNgRoute&&b.$on("$routeChangeSuccess",function(a,b){h(),b&&b.hotkeys&&angular.forEach(b.hotkeys,function(a){var c=a[2];("string"==typeof c||c instanceof String)&&(a[2]=[c,b]),a[5]=!1,j.apply(this,a)})}),this.includeCheatSheet){var q=e[0],r=a[0],s=angular.element(this.template);j(this.cheatSheetHotkey,this.cheatSheetDescription,i),(r===q||r===q.documentElement)&&(r=q.body),angular.element(r).append(c(s)(o))}var t=!1,u={add:j,del:k,get:l,bindTo:m,template:this.template,toggleCheatSheet:i,includeCheatSheet:this.includeCheatSheet,cheatSheetHotkey:this.cheatSheetHotkey,cheatSheetDescription:this.cheatSheetDescription,useNgRoute:this.useNgRoute,purgeHotkeys:h,templateTitle:this.templateTitle};return u}]}]).directive("hotkey",["hotkeys",function(a){return{restrict:"A",link:function(b,c,d){var e,f;angular.forEach(b.$eval(d.hotkey),function(b,c){f="string"==typeof d.hotkeyAllowIn?d.hotkeyAllowIn.split(/[\s,]+/):[],e=c,a.add({combo:c,description:d.hotkeyDescription,callback:b,action:d.hotkeyAction,allowIn:f})}),c.bind("$destroy",function(){a.del(e)})}}}]).run(["hotkeys",function(a){}])}(),function(a,b,c){function d(a,b,c){return a.addEventListener?void a.addEventListener(b,c,!1):void a.attachEvent("on"+b,c)}function e(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase()),b}return r[a.which]?r[a.which]:s[a.which]?s[a.which]:String.fromCharCode(a.which).toLowerCase()}function f(a,b){return a.sort().join(",")===b.sort().join(",")}function g(a){var b=[];return a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),b}function h(a){return a.preventDefault?void a.preventDefault():void(a.returnValue=!1)}function i(a){return a.stopPropagation?void a.stopPropagation():void(a.cancelBubble=!0)}function j(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function k(){if(!q){q={};for(var a in r)a>95&&112>a||r.hasOwnProperty(a)&&(q[r[a]]=a)}return q}function l(a,b,c){return c||(c=k()[a]?"keydown":"keypress"),"keypress"==c&&b.length&&(c="keydown"),c}function m(a){return"+"===a?["+"]:(a=a.replace(/\+{2}/g,"+plus"),a.split("+"))}function n(a,b){var c,d,e,f=[];for(c=m(a),e=0;e<c.length;++e)d=c[e],u[d]&&(d=u[d]),b&&"keypress"!=b&&t[d]&&(d=t[d],f.push("shift")),j(d)&&f.push(d);return b=l(d,f,b),{key:d,modifiers:f,action:b}}function o(a,c){return a===b?!1:a===c?!0:o(a.parentNode,c)}function p(a){function c(a){a=a||{};var b,c=!1;for(b in u)a[b]?c=!0:u[b]=0;c||(x=!1)}function k(a,b,c,d,e,g){var h,i,k=[],l=c.type;if(!s._callbacks[a])return[];for("keyup"==l&&j(a)&&(b=[a]),h=0;h<s._callbacks[a].length;++h)if(i=s._callbacks[a][h],(d||!i.seq||u[i.seq]==i.level)&&l==i.action&&("keypress"==l&&!c.metaKey&&!c.ctrlKey||f(b,i.modifiers))){var m=!d&&i.combo==e,n=d&&i.seq==d&&i.level==g;(m||n)&&s._callbacks[a].splice(h,1),k.push(i)}return k}function l(a,b,c,d){s.stopCallback(b,b.target||b.srcElement,c,d)||a(b,c)===!1&&(h(b),i(b))}function m(a){"number"!=typeof a.which&&(a.which=a.keyCode);var b=e(a);if(b)return"keyup"==a.type&&v===b?void(v=!1):void s.handleKey(b,g(a),a)}function o(){clearTimeout(t),t=setTimeout(c,1e3)}function q(a,b,d,f){function g(b){return function(){x=b,++u[a],o()}}function h(b){l(d,b,a),"keyup"!==f&&(v=e(b)),setTimeout(c,10)}u[a]=0;for(var i=0;i<b.length;++i){var j=i+1===b.length,k=j?h:g(f||n(b[i+1]).action);r(b[i],k,f,a,i)}}function r(a,b,c,d,e){s._directMap[a+":"+c]=b,a=a.replace(/\s+/g," ");var f,g=a.split(" ");return g.length>1?void q(a,g,b,c):(f=n(a,c),s._callbacks[f.key]=s._callbacks[f.key]||[],k(f.key,f.modifiers,{type:f.action},d,a,e),void s._callbacks[f.key][d?"unshift":"push"]({callback:b,modifiers:f.modifiers,action:f.action,seq:d,level:e,combo:a}))}var s=this;if(a=a||b,!(s instanceof p))return new p(a);s.target=a,s._callbacks={},s._directMap={};var t,u={},v=!1,w=!1,x=!1;s._handleKey=function(a,b,d){var e,f=k(a,b,d),g={},h=0,i=!1;for(e=0;e<f.length;++e)f[e].seq&&(h=Math.max(h,f[e].level));for(e=0;e<f.length;++e)if(f[e].seq){if(f[e].level!=h)continue;i=!0,g[f[e].seq]=1,l(f[e].callback,d,f[e].combo,f[e].seq)}else i||l(f[e].callback,d,f[e].combo);var m="keypress"==d.type&&w;d.type!=x||j(a)||m||c(g),w=i&&"keydown"==d.type},s._bindMultiple=function(a,b,c){for(var d=0;d<a.length;++d)r(a[d],b,c)},d(a,"keypress",m),d(a,"keydown",m),d(a,"keyup",m)}for(var q,r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},s={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},t={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},u={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},v=1;20>v;++v)r[111+v]="f"+v;for(v=0;9>=v;++v)r[v+96]=v;p.prototype.bind=function(a,b,c){var d=this;return a=a instanceof Array?a:[a],d._bindMultiple.call(d,a,b,c),d},p.prototype.unbind=function(a,b){var c=this;return c.bind.call(c,a,function(){},b)},p.prototype.trigger=function(a,b){var c=this;return c._directMap[a+":"+b]&&c._directMap[a+":"+b]({},a),c},p.prototype.reset=function(){var a=this;return a._callbacks={},a._directMap={},a},p.prototype.stopCallback=function(a,b){var c=this;return(" "+b.className+" ").indexOf(" mousetrap ")>-1?!1:o(b,c.target)?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable},p.prototype.handleKey=function(){var a=this;return a._handleKey.apply(a,arguments)},p.init=function(){var a=p(b);for(var c in a)"_"!==c.charAt(0)&&(p[c]=function(b){return function(){return a[b].apply(a,arguments)}}(c))},p.init(),a.Mousetrap=p,"undefined"!=typeof module&&module.exports&&(module.exports=p),"function"==typeof define&&define.amd&&define(function(){return p})}(window,document);
(function () {
    'use strict';

    angular.module('scaleApp').config(['$provide', function ($provide) {
        $provide.decorator('$httpBackend', angular.mock.e2e.$httpBackendDecorator);
    }]).run(['$httpBackend', 'scaleConfig', 'XMLHttpRequest', function ($httpBackend, scaleConfig, XMLHttpRequest) {

        var getSync = function (url) {
            var request = new XMLHttpRequest();
            request.open('GET', url, false);
            request.send(null);
            return [request.status, request.response, {}];
        };

        // Ingests Status
        var ingestsStatusOverrideUrl = 'test/data/ingestStatus.json';
        var ingestsStatusRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'ingests/status/', 'i');
        $httpBackend.whenGET(ingestsStatusRegex).respond(function () {
            return getSync(ingestsStatusOverrideUrl);
        });


        // Job load
        var jobLoadRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'load/', 'i');
        $httpBackend.whenGET(jobLoadRegex).respond(function () {
            var numHours = moment.utc().endOf('d').diff(moment.utc().subtract(7, 'd').startOf('d'), 'h');
            var startTime = moment.utc().subtract(7, 'd').startOf('d');
            var data = {
                count: numHours,
                next: null,
                previous: null,
                results: []
            };

            for (var i = 0; i < data.count; i++) {
                data.results.push({
                    time: moment.utc(startTime).add(i, 'h').toISOString(),
                    pending_count: Math.floor(Math.random() * (100 - 20 + 1)) + 20,
                    queued_count: Math.floor(Math.random() * (100 - 20 + 1)) + 20,
                    running_count: Math.floor(Math.random() * (100 - 20 + 1)) + 20
                });
            }

            return [200, data, {}];
        });

        // Job details
        var jobDetailsOverrideUrl = 'test/data/jobDetails.json';
        var jobDetailsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'jobs/.*/', 'i');
        $httpBackend.whenGET(jobDetailsRegex).respond(function () {
            return getSync(jobDetailsOverrideUrl);
        });

        // Jobs
        var jobsOverrideUrl = 'test/data/jobs.json';
        var jobsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'jobs/', 'i');
        $httpBackend.whenGET(jobsRegex).respond(function () {
            return getSync(jobsOverrideUrl);
        });

        // Job type status
        var jobTypeStatusOverrideUrl = 'test/data/jobTypeStatus.json';
        var jobTypeStatusRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'job-types/status/', 'i');
        $httpBackend.whenGET(jobTypeStatusRegex).respond(function () {
            return getSync(jobTypeStatusOverrideUrl);
        });

        // Job types
        var jobTypesOverrideUrl = 'test/data/jobTypes.json';
        var jobTypesRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'job-types/', 'i');
        $httpBackend.whenGET(jobTypesRegex).respond(function () {
            return getSync(jobTypesOverrideUrl);
        });

        // Metrics Plot Data Detail
        var metricsPlotDataOverrideUrl = 'test/data/metricsJobTypesPlotData.json';
        var metricsPlotDataRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'metrics/.*/.*/','i');
        $httpBackend.whenGET(metricsPlotDataRegex).respond(function () {
            return getSync(metricsPlotDataOverrideUrl);
        });

        // Metrics Detail
        var metricsDetailOverrideUrl = 'test/data/metricsIngest.json';
        var metricsDetailRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'metrics/.*/','i');
        $httpBackend.whenGET(metricsDetailRegex).respond(function () {
            return getSync(metricsDetailOverrideUrl);
        });

        // Metrics
        var metricsOverrideUrl = 'test/data/metrics.json';
        var metricsRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'metrics/','i');
        $httpBackend.whenGET(metricsRegex).respond(function () {
            return getSync(metricsOverrideUrl);
        });

        // Node status
        var nodeStatusOverrideUrl = 'test/data/nodeStatus.json';
        var nodeStatusRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'nodes/status/', 'i');
        $httpBackend.whenGET(nodeStatusRegex).respond(function () {
            return getSync(nodeStatusOverrideUrl);
        });

        // Nodes
        var nodesOverrideUrl = 'test/data/nodes.json';
        var nodesRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'nodes/', 'i');
        $httpBackend.whenGET(nodesRegex).respond(function () {
            return getSync(nodesOverrideUrl);
        });

        // Queue Status service
        var queueStatusOverrideUrl = 'test/data/queueStatus.json';
        var queueStatusRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'queue/status/', 'i');
        $httpBackend.whenGET(queueStatusRegex).respond(function () {
            return getSync(queueStatusOverrideUrl);
        });

        // Recipes service
        var recipesOverrideUrl = 'test/data/recipes.json';
        var recipesRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'recipes/', 'i');
        $httpBackend.whenGET(recipesRegex).respond(function () {
            return getSync(recipesOverrideUrl);
        });

        // Recipe Type Detail service
        var recipeTypeDetailOverrideUrl = 'test/data/recipeTypeDetail.json';
        var recipeTypeDetailRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'recipe-types/.*/', 'i');
        $httpBackend.whenGET(recipeTypeDetailRegex).respond(function () {
            return getSync(recipeTypeDetailOverrideUrl);
        });

        // Recipe Types service
        var recipeTypesOverrideUrl = 'test/data/recipeTypes.json';
        var recipeTypesRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'recipe-types/', 'i');
        $httpBackend.whenGET(recipeTypesRegex).respond(function () {
            return getSync(recipeTypesOverrideUrl);
        });

        // Status service
        var statusOverrideUrl = 'test/data/status.json';
        var statusRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'status/', 'i');
        $httpBackend.whenGET(statusRegex).respond(function () {
            return getSync(statusOverrideUrl);
        });

        // Workspaces
        var workspacesOverrideUrl = 'test/data/workspaces.json';
        var workspacesRegex = new RegExp('^' + scaleConfig.urls.apiPrefix + 'workspaces/', 'i');
        $httpBackend.whenGET(workspacesRegex).respond(function () {
            return getSync(workspacesOverrideUrl);
        });





        // For everything else, don't mock
        $httpBackend.whenGET(/^\w+.*/).passThrough();
        $httpBackend.whenPOST(/^\w+.*/).passThrough();
    }]);
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInNjYWxlQ29uZmlnLmpzIiwiaGVhZGVyL2hlYWRlckRpcmVjdGl2ZS5qcyIsIm5hdmlnYXRpb24vbmF2RGlyZWN0aXZlLmpzIiwiYWJvdXQvY29udHJvbGxlcnMvYWJvdXRDb250cm9sbGVyLmpzIiwiYWRtaW4vY29udHJvbGxlcnMvYWRtaW5Mb2dpbkNvbnRyb2xsZXIuanMiLCJhZG1pbi9jb250cm9sbGVycy9sb2dvdXRDb250cm9sbGVyLmpzIiwiY2hhcnRzL2RhdGFGZWVkL2RhdGFGZWVkRGlyZWN0aXZlLmpzIiwiY2hhcnRzL2RvbnV0L2RvbnV0Q29udHJvbGxlci5qcyIsImNoYXJ0cy9kb251dC9kb251dERpcmVjdGl2ZS5qcyIsImNoYXJ0cy9oZWFsdGgvaGVhbHRoQ29udHJvbGxlci5qcyIsImNoYXJ0cy9oZWFsdGgvaGVhbHRoRGlyZWN0aXZlLmpzIiwiY2hhcnRzL2dyaWQvZ3JpZENoYXJ0Q29udHJvbGxlci5qcyIsImNoYXJ0cy9ncmlkL2dyaWRDaGFydERpcmVjdGl2ZS5qcyIsImNoYXJ0cy9qb2JMb2FkL2pvYkxvYWRDb250cm9sbGVyLmpzIiwiY2hhcnRzL2pvYkxvYWQvam9iTG9hZERpcmVjdGl2ZS5qcyIsImNoYXJ0cy9yYWRpYWxQZXJjZW50YWdlL3JhZGlhbFBlcmNlbnRhZ2VDb250cm9sbGVyLmpzIiwiY2hhcnRzL3JhZGlhbFBlcmNlbnRhZ2UvcmFkaWFsUGVyY2VudGFnZURpcmVjdGl2ZS5qcyIsImNoYXJ0cy90aW1lbGluZS90aW1lbGluZURpcmVjdGl2ZS5qcyIsImNvbW1vbi9kaXJlY3RpdmVzL2Fpc011bHRpc2VsZWN0LmpzIiwiY29tbW9uL2ZhY3Rvcmllcy9nYXVnZUZhY3RvcnkuanMiLCJjb21tb24vZmFjdG9yaWVzL2dyaWRGYWN0b3J5LmpzIiwiY29tbW9uL2ZhY3Rvcmllcy9wb2xsZXJGYWN0b3J5LmpzIiwiY29tbW9uL21vZGVscy9TdGF0dXMuanMiLCJjb21tb24vbW9kZWxzL1N0YXR1c01hc3Rlci5qcyIsImNvbW1vbi9tb2RlbHMvU3RhdHVzUmVzb3VyY2UuanMiLCJjb21tb24vbW9kZWxzL1N0YXR1c1Jlc291cmNlcy5qcyIsImNvbW1vbi9tb2RlbHMvU3RhdHVzU2NoZWR1bGVyLmpzIiwiY29tbW9uL3NlcnZpY2VzL3NjYWxlU2VydmljZS5qcyIsImNvbW1vbi9zZXJ2aWNlcy9zY2hlZHVsZXJTZXJ2aWNlLmpzIiwiY29tbW9uL3NlcnZpY2VzL3N0YXR1c1NlcnZpY2UuanMiLCJjb21tb24vc2VydmljZXMvdXNlclNlcnZpY2UuanMiLCJmZWVkL2NvbnRyb2xsZXJzL2ZlZWREZXRhaWxzQ29udHJvbGxlci5qcyIsImZlZWQvY29udHJvbGxlcnMvaW5nZXN0UmVjb3Jkc0NvbnRyb2xsZXIuanMiLCJmZWVkL21vZGVscy9GZWVkLmpzIiwiZmVlZC9tb2RlbHMvRmVlZFN0YXR1cy5qcyIsImZlZWQvc2VydmljZXMvZmVlZFNlcnZpY2UuanMiLCJsb2FkL2NvbnRyb2xsZXJzL2xvYWRDb250cm9sbGVyLmpzIiwibG9hZC9jb250cm9sbGVycy9sb2FkRGVwdGhDb250cm9sbGVyLmpzIiwibG9hZC9jb250cm9sbGVycy9xdWV1ZVJ1bm5pbmdDb250cm9sbGVyLmpzIiwibG9hZC9tb2RlbHMvUXVldWVTdGF0dXMuanMiLCJsb2FkL3NlcnZpY2VzL2xvYWRTZXJ2aWNlLmpzIiwiam9icy9jb250cm9sbGVycy9qb2JEZXRhaWxDb250cm9sbGVyLmpzIiwiam9icy9jb250cm9sbGVycy9qb2JFeGVjdXRpb25EZXRhaWxDb250cm9sbGVyLmpzIiwiam9icy9jb250cm9sbGVycy9qb2JFeGVjdXRpb25zQ29udHJvbGxlci5qcyIsImpvYnMvY29udHJvbGxlcnMvam9iVHlwZXNDb250cm9sbGVyLmpzIiwiam9icy9jb250cm9sbGVycy9qb2JzQ29udHJvbGxlci5qcyIsImpvYnMvZGlyZWN0aXZlcy9qb2JFeGVjdXRpb25Mb2dEaXJlY3RpdmUuanMiLCJqb2JzL2RpcmVjdGl2ZXMvam9iSGVhbHRoRGlyZWN0aXZlLmpzIiwiam9icy9kaXJlY3RpdmVzL2pvYlR5cGVJbnRlcmZhY2VEaXJlY3RpdmUuanMiLCJqb2JzL21vZGVscy9Kb2IuanMiLCJqb2JzL21vZGVscy9Kb2JEZXRhaWxFdmVudC5qcyIsImpvYnMvbW9kZWxzL0pvYkRldGFpbEV2ZW50UnVsZS5qcyIsImpvYnMvbW9kZWxzL0pvYkRldGFpbElucHV0RGF0YS5qcyIsImpvYnMvbW9kZWxzL0pvYkRldGFpbE91dHB1dERhdGEuanMiLCJqb2JzL21vZGVscy9Kb2JEZXRhaWxzLmpzIiwiam9icy9tb2RlbHMvSm9iRXhlY3V0aW9uLmpzIiwiam9icy9tb2RlbHMvSm9iRXhlY3V0aW9uTG9nLmpzIiwiam9icy9tb2RlbHMvSm9iVHlwZS5qcyIsImpvYnMvbW9kZWxzL0pvYlR5cGVEZXRhaWxzLmpzIiwiam9icy9tb2RlbHMvSm9iVHlwZUVycm9yLmpzIiwiam9icy9tb2RlbHMvSm9iVHlwZUVycm9yTWFwcGluZy5qcyIsImpvYnMvbW9kZWxzL0pvYlR5cGVJbnB1dERhdGEuanMiLCJqb2JzL21vZGVscy9Kb2JUeXBlSW50ZXJmYWNlLmpzIiwiam9icy9tb2RlbHMvSm9iVHlwZU91dHB1dERhdGEuanMiLCJqb2JzL21vZGVscy9Kb2JUeXBlU3RhdHVzLmpzIiwiam9icy9tb2RlbHMvUHJvZHVjdC5qcyIsImpvYnMvbW9kZWxzL1J1bm5pbmdKb2IuanMiLCJqb2JzL21vZGVscy9TeXN0ZW1GYWlsdXJlLmpzIiwiam9icy9zZXJ2aWNlcy9qb2JFeGVjdXRpb25TZXJ2aWNlLmpzIiwiam9icy9zZXJ2aWNlcy9qb2JTZXJ2aWNlLmpzIiwiam9icy9zZXJ2aWNlcy9qb2JUeXBlU2VydmljZS5qcyIsIm1ldHJpY3MvY29udHJvbGxlcnMvbWV0cmljc0NvbnRyb2xsZXIuanMiLCJtZXRyaWNzL3NlcnZpY2VzL21ldHJpY3NTZXJ2aWNlLmpzIiwibmF2aWdhdGlvbi9jb250cm9sbGVycy9uYXZDb250cm9sbGVyLmpzIiwibmF2aWdhdGlvbi9zZXJ2aWNlcy9uYXZTZXJ2aWNlLmpzIiwibmF2aWdhdGlvbi9zZXJ2aWNlcy9zdWJuYXZTZXJ2aWNlLmpzIiwibm9kZXMvY29udHJvbGxlcnMvbm9kZURldGFpbHNDb250cm9sbGVyLmpzIiwibm9kZXMvY29udHJvbGxlcnMvbm9kZXNDb250cm9sbGVyLmpzIiwibm9kZXMvZGlyZWN0aXZlcy9ub2RlSGVhbHRoRGlyZWN0aXZlLmpzIiwibm9kZXMvbW9kZWxzL05vZGUuanMiLCJub2Rlcy9tb2RlbHMvTm9kZVJlc291cmNlcy5qcyIsIm5vZGVzL21vZGVscy9Ob2RlU3RhdHVzLmpzIiwibm9kZXMvc2VydmljZXMvbm9kZVNlcnZpY2UuanMiLCJub2Rlcy9zZXJ2aWNlcy9ub2RlVXBkYXRlU2VydmljZS5qcyIsIm92ZXJ2aWV3L2NvbnRyb2xsZXJzL292Q29udHJvbGxlci5qcyIsInJlY2lwZXMvY29udHJvbGxlcnMvcmVjaXBlRGV0YWlsc0NvbnRyb2xsZXIuanMiLCJyZWNpcGVzL2NvbnRyb2xsZXJzL3JlY2lwZUVkaXRvckNvbnRyb2xsZXIuanMiLCJyZWNpcGVzL2NvbnRyb2xsZXJzL3JlY2lwZVR5cGVzQ29udHJvbGxlci5qcyIsInJlY2lwZXMvY29udHJvbGxlcnMvcmVjaXBlc0NvbnRyb2xsZXIuanMiLCJyZWNpcGVzL2RpcmVjdGl2ZXMvcmVjaXBlR3JhcGhWaWV3ZXJEaXJlY3RpdmUuanMiLCJyZWNpcGVzL21vZGVscy9SZWNpcGUuanMiLCJyZWNpcGVzL21vZGVscy9SZWNpcGVEYXRhLmpzIiwicmVjaXBlcy9tb2RlbHMvUmVjaXBlRGV0YWlscy5qcyIsInJlY2lwZXMvbW9kZWxzL1JlY2lwZUpvYi5qcyIsInJlY2lwZXMvbW9kZWxzL1JlY2lwZUpvYkNvbnRhaW5lci5qcyIsInJlY2lwZXMvbW9kZWxzL1JlY2lwZVR5cGUuanMiLCJyZWNpcGVzL21vZGVscy9SZWNpcGVUeXBlRGVmaW5pdGlvbi5qcyIsInJlY2lwZXMvbW9kZWxzL1JlY2lwZVR5cGVEZWZpbml0aW9uSm9iLmpzIiwicmVjaXBlcy9tb2RlbHMvUmVjaXBlVHlwZURldGFpbC5qcyIsInJlY2lwZXMvbW9kZWxzL1JlY2lwZVR5cGVWYWxpZGF0aW9uLmpzIiwicmVjaXBlcy9zZXJ2aWNlcy9yZWNpcGVTZXJ2aWNlLmpzIiwid29ya3NwYWNlcy9zZXJ2aWNlcy93b3Jrc3BhY2VzU2VydmljZS5qcyIsImdhbnR0LWNoYXJ0LWQzLmpzIiwiZ2F1Z2UuanMiLCJob3RrZXlzLm1pbi5qcyIsImJhY2tlbmRTdHVicy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxJQUFBLE1BQUEsUUFBQSxPQUFBLFlBQUE7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBOzs7SUFHQSxJQUFBLCtEQUFBLFNBQUEsZ0JBQUEsbUJBQUEsY0FBQTs7UUFFQSxhQUFBLG9CQUFBO1FBQ0EsYUFBQSxRQUFBOzs7UUFHQSxrQkFBQSxTQUFBLHVCQUFBOzs7UUFHQTthQUNBLEtBQUEsS0FBQTtnQkFDQSxZQUFBO2dCQUNBLGFBQUE7O2FBRUEsS0FBQSxlQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsYUFBQTs7YUFFQSxLQUFBLGdCQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsYUFBQTs7YUFFQSxLQUFBLFVBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxhQUFBOzthQUVBLEtBQUEsU0FBQTtnQkFDQSxZQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsZ0JBQUE7O2FBRUEsS0FBQSxpQkFBQTtnQkFDQSxZQUFBO2dCQUNBLGFBQUE7Z0JBQ0EsZ0JBQUE7O2FBRUEsS0FBQSxZQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsYUFBQTtnQkFDQSxnQkFBQTs7YUFFQSxLQUFBLFVBQUE7Z0JBQ0EsWUFBQTtnQkFDQSxhQUFBOzthQUVBLEtBQUEsY0FBQTtnQkFDQSxZQUFBO2dCQUNBLGFBQUE7O2FBRUEsS0FBQSxTQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsYUFBQTs7YUFFQSxLQUFBLGlCQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsYUFBQTs7YUFF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QSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsV0FBQSw0REFBQSxTQUFBLFFBQUEsVUFBQSxhQUFBO1FBQ0EsSUFBQSxRQUFBOztRQUVBLElBQUEsV0FBQSxZQUFBO1lBQ0EsSUFBQSxPQUFBOzs7Z0JBR0EsSUFBQSxVQUFBO29CQUNBLFlBQUE7OztnQkFHQSxFQUFBLFFBQUEsTUFBQSxRQUFBLFVBQUEsR0FBQTtvQkFDQSxRQUFBLEtBQUEsQ0FBQSxFQUFBLE9BQUEsR0FBQSxJQUFBLEVBQUEsT0FBQSxHQUFBOzs7O2dCQUlBLEVBQUEsUUFBQSxTQUFBLFVBQUEsSUFBQTtvQkFDQSxJQUFBLE9BQUEsRUFBQSxLQUFBLE9BQUEsU0FBQSxVQUFBLElBQUE7d0JBQ0EsT0FBQSxHQUFBLE9BQUEsR0FBQTs7b0JBRUEsSUFBQSxDQUFBLE1BQUE7d0JBQ0EsVUFBQSxLQUFBLEdBQUE7Ozs7Ozs7Z0JBT0EsTUFBQSxLQUFBO29CQUNBLFNBQUEsT0FBQTtvQkFDQSxRQUFBOzttQkFFQTtnQkFDQSxRQUFBLEdBQUEsU0FBQTtvQkFDQSxRQUFBLFNBQUE7b0JBQ0EsTUFBQTt3QkFDQSxTQUFBLE9BQUE7d0JBQ0EsTUFBQSxPQUFBO3dCQUNBLFFBQUE7NEJBQ0EsTUFBQSxZQUFBLE9BQUE7NEJBQ0EsU0FBQSxZQUFBLE9BQUE7NEJBQ0EsSUFBQSxZQUFBLE9BQUE7NEJBQ0EsV0FBQSxZQUFBLE9BQUE7NEJBQ0EsTUFBQTs0QkFDQSxPQUFBLFlBQUEsT0FBQTs0QkFDQSxRQUFBLFlBQUEsT0FBQTs0QkFDQSxXQUFBOzRCQUNBLE1BQUE7NEJBQ0EsUUFBQTs0QkFDQSxTQUFBLFlBQUEsT0FBQTs0QkFDQSxxQkFBQSxZQUFBLE9BQUE7NEJBQ0EsUUFBQSxZQUFBLE9BQUE7OztvQkFHQSxZQUFBO3dCQUNBLFVBQUE7O29CQUVBLEtBQUE7d0JBQ0EsT0FBQTs0QkFDQSxRQUFBLEdBQUEsT0FBQTs7O29CQUdBLE9BQUE7d0JBQ0EsT0FBQTs0QkFDQSxRQUFBLE9BQUEsWUFBQSxHQUFBLE9BQUEsT0FBQSxZQUFB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QUE7WUFDQSxPQUFBLE9BQUEsVUFBQSxPQUFBLFVBQUE7OztRQUdBLElBQUEsUUFBQSxFQUFBLGVBQUE7WUFDQSxTQUFBLE9BQUEsT0FBQSxDQUFBLE9BQUEsYUFBQSxPQUFBLFFBQUEsS0FBQSxDQUFBLE9BQUEsYUFBQSxLQUFBO1lBQ0EsT0FBQTtZQUNBLE9BQUE7WUFDQSxhQUFBO1lBQ0EsYUFBQTs7UUFFQSxJQUFBLGdCQUFBLFVBQUEsTUFBQTtZQUNBLE9BQUEsV0FBQTtZQUNBLE9BQUEsYUFBQTtZQUNBLElBQUEsS0FBQSxNQUFBO2dCQUNBLElBQUEsV0FBQSxLQUFBLEtBQUEsV0FBQSxNQUFBLEtBQUE7Z0JBQ0EsSUFBQSxhQUFBLFdBQUE7b0JBQ0EsT0FBQSxhQUFBLEVBQUEsWUFBQSxFQUFBLE9BQUEsS0FBQSxPQUFBLENBQUEsU0FBQSxDQUFBOztvQkFFQSxFQUFBLFFBQUEsT0FBQSxZQUFBLFVBQUEsS0FBQTt3QkFDQSxJQUFBLFNBQUEsRUFBQSxLQUFBLEtBQUEsUUFBQSxlQUFBLElBQUE7O29CQUVBLE9BQUEsYUFBQSxFQUFBLFlBQUEsRUFBQSxPQUFBLEtBQUEsT0FBQSxDQUFBLHNCQUFBLHNCQUFBLFNBQUEsQ0FBQSxPQUFBLE9BQUE7dUJBQ0EsSUFBQSxhQUFBLFFBQUE7b0JBQ0EsT0FBQSxhQUFBLEVBQUEsWUFBQSxFQUFBLE9BQUEsS0FBQSxPQUFBLENBQUEsYUFBQSxDQUFBOztvQkFFQSxFQUFBLFFBQUEsT0FBQSxZQUFBLFVBQUEsS0FBQTt3QkFDQSxJQUFBLFNBQUEsRUFBQSxLQUFBLEtBQUEsUUFBQSxXQUFBLElBQUE7O29CQUVBLE9BQUEsYUFBQSxFQUFBLFlBQUEsT0FBQSxZQUFBLENBQUEsYUFBQSxDQUFBO3VCQUNBO29CQUNBLE9BQUEsYUFBQSxLQUFBOzs7Z0JBR0EsT0FBQSxPQUFBLFVBQUEsT0FBQSxVQUFBLEtBQUEsTUFBQSxRQUFBLE9BQUE7Z0JBQ0EsT0FBQSxPQUFBLE9BQUEsT0FBQSxPQUFBLEtBQUEsS0FBQSxPQUFBLFdBQUEsU0FBQTs7Z0JBRUEsR0FBQSxNQUFBLE1BQUEsSUFBQSxVQUFBLEtBQUE7b0JBQ0EsR0FBQSxNQUFBLE1BQUEsSUFBQSxVQUFBLEtBQUE7d0JBQ0EsSUFBQSxPQUFBLE9BQUEsV0FBQSxTQUFBLEdBQUE7NEJBQ0EsSUFBQSxVQUFBLE9BQUEsV0FBQSxDQUFBLE9BQUEsT0FBQTs0QkFDQSxJQUFBLFNBQUE7Z0NBQ0EsUUFBQSxTQUFBLENBQUEsTUFBQSxPQUFBLFlBQUEsTUFBQSxPQUFBO2dDQUNBLE9BQUEsU0FBQSxLQUFBOzs7Ozs7Z0JBTUE7Ozs7UUFJQSxJQUFBLGFBQUEsWUFBQTtZQUNBLEdBQUEsVUFBQTtpQkFDQSxNQUFBLFdBQUE7WUFDQSxHQUFBLFVBQUE7aUJBQ0EsTUFBQSxXQUFBO1lBQ0EsR0FBQSxVQUFBO2lCQUNBLE1BQUEsV0FBQTs7O1FBR0EsSUFBQSxXQUFBLFlBQUE7WUFDQSxHQUFBLFVBQUE7aUJBQ0EsTUFBQSxXQUFBO1lBQ0EsR0FBQSxVQUFBO2lCQUNBLE1BQUEsV0FBQTtZQUNBLEdBQUEsVUFBQTtpQkFDQSxNQUFBLFdBQUE7OztRQUdBLElBQUEsYUFBQSxVQUFBLE1BQUE7WUFDQSxPQUFBLE9BQUEsVUFBQSxPQUFBLFVBQUEsS0FBQSxNQUFBLFFBQUEsT0FBQTtZQUNBLE9BQUEsT0FBQSxPQUFBLE9BQUEsT0FBQSxLQUFBLEtBQUEsT0FBQSxXQUFBLFNBQUE7O1lBRUEsSUFBQSxhQUFBLE1BQUEsTUFBQSxNQUFBLENBQUEsUUFBQSxPQUFBLElBQUEsT0FBQSxNQUFBOztZQUVBLElBQUEsT0FBQSxHQUFBLFNBQUE7aUJBQ0EsWUFBQSxDQUFBLEdBQUE7O2lCQUVBLEdBQUEsUUFBQTs7WUFFQSxJQUFBLE9BQUEsWUFBQTtnQkFDQSxNQUFBLEdBQUEsT0FBQSxlQUFBLE9BQUE7cUJBQ0EsS0FBQSxTQUFBO3FCQUNBLEtBQUEsVUFBQTtxQkFDQSxPQUFBO3FCQUNBLEtBQUE7cUJBQ0EsT0FBQTttQkFDQSxJQUFBLE9BQUEsZUFBQTtnQkFDQSxNQUFBLEdBQUEsT0FBQSxlQUFBLE9BQUE7cUJBQ0EsS0FBQSxTQUFBO3FCQUNBLEtBQUEsVUFBQTtxQkFDQSxPQUFBO3FCQUNBLEtBQUE7bUJBQ0E7Z0JBQ0EsTUFBQSxHQUFBLE9BQUEsZUFBQSxPQUFBO3FCQUNBLEtBQUEsU0FBQTtxQkFDQSxLQUFBLFVBQUE7cUJBQ0EsT0FBQTs7O1lBR0EsSUFBQSxPQUFBO2lCQUNBLEtBQUEsU0FBQTtpQkFDQSxLQUFBLFNBQUE7aUJBQ0EsS0FBQSxVQUFBOztZQUVBLElBQUEsT0FBQSxVQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBLE1BQUE7cUJBQ0EsT0FBQSxDQUFBLEdBQUE7cUJBQ0EsTUFBQSxDQUFBLEdBQUEsT0FBQTs7Z0JBRUEsSUFBQSxRQUFBLEdBQUEsSUFBQTtxQkFDQSxNQUFBO3FCQUNBLE9BQUE7cUJBQ0EsV0FBQTs7Z0JBRUEsSUFBQSxLQUFBLGFBQUEsZUFBQSxLQUFBLE1BQUEsSUFBQTtxQkFDQSxPQUFBO3FCQUNBLEtBQUEsU0FBQTtxQkFDQSxLQUFBLGFBQUEsZUFBQSxJQUFBLE1BQUEsT0FBQSxhQUFBLElBQUE7cUJBQ0EsS0FBQTs7O1lBR0EsY0FBQTs7WUFFQSxTQUFBLFNBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUEsTUFBQTs7Z0JBRUEsSUFBQSxPQUFBLGNBQUE7b0JBQ0EsSUFBQSxJQUFBLEdBQUE7d0JBQ0E7MkJBQ0E7d0JBQ0E7OztnQkFHQSxJQUFBLE1BQUEsR0FBQTtvQkFDQSxJQUFBLE9BQUEsVUFBQTt3QkFDQSxLQUFBLFVBQUEsQ0FBQSxJQUFBOzJCQUNBO3dCQUNBLEtBQUEsVUFBQSxDQUFBLEdBQUE7OztnQkFHQSxJQUFBLEtBQUEsYUFBQSxlQUFBLEtBQUEsY0FBQSxZQUFBLEdBQUEsTUFBQSxRQUFBOzs7WUFHQSxPQUFBLFVBQUE7OztRQUdBLElBQUEsY0FBQTtZQUNBLGNBQUE7WUFDQSxlQUFBO1lBQ0EsZUFBQTs7UUFFQSxJQUFBLE9BQUEsR0FBQSxTQUFBO2FBQ0EsR0FBQSxhQUFBLFlBQUE7O2dCQUVBLGNBQUEsR0FBQSxNQUFBLFlBQUE7Z0JBQ0EsY0FBQSxHQUFBLE1BQUEsWUFBQTs7O1FBR0EsSUFBQSxjQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsS0FBQSxFQUFBLFFBQUE7Z0JBQ0EsT0FBQSxFQUFBLE9BQUE7O1lBRUEsT0FBQTs7O1FBR0EsSUFBQSxjQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsR0FBQTtnQkFDQSxPQUFBLEVBQUE7Ozs7UUFJQSxJQUFBLGtCQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsS0FBQSxFQUFBLFFBQUE7Z0JBQ0EsT0FBQSxFQUFBLE9BQUE7Ozs7UUFJQSxJQUFBLHFCQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsS0FBQSxFQUFBLFFBQUE7Z0JBQ0EsT0FBQSxFQUFBLE9BQUE7Ozs7UUFJQSxJQUFBLHVCQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsS0FBQSxFQUFBLFFBQUE7Z0JBQ0EsT0FBQSxFQUFBLE9BQUE7Ozs7UUFJQSxJQUFBLGVBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxHQUFBO2dCQUNBLE9BQUEsRUFBQTs7OztRQUlBLElBQUEsZUFBQSxVQUFBLEdBQUE7WUFDQSxJQUFBLEtBQUEsRUFBQSxRQUFBO2dCQUNBLE9BQUEsRUFBQSxPQUFBOztZQUVBLE9BQUE7OztRQUdBLElBQUEsZUFBQSxVQUFBLEdBQUE7WUFDQSxJQUFBLEtBQUEsRUFBQSxRQUFBO2dCQUNBLE9BQUEsRUFBQSxPQUFBOztZQUVBLE9BQUE7OztRQUdBLElBQUEsZ0JBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxLQUFBLEVBQUEsUUFBQTtnQkFDQSxJQUFBLEVBQUEsZUFBQSxRQUFBO29CQUNBLE9BQUEsRUFBQSxPQUFBOzs7WUFHQSxPQUFBOzs7UUFHQSxJQUFBLGNBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxLQUFBLEVBQUEsUUFBQTtnQkFDQSxJQUFBLEVBQUEsZUFBQSxRQUFBO29CQUNBLE9BQUEsRUFBQSxPQUFBOzs7OztRQUtBLElBQUEsa0JBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxLQUFBLEVBQUEsUUFBQTtnQkFDQSxJQUFBLEVBQUEsZUFBQSxXQUFBO29CQUNBLE9BQUEsRUFBQSxPQUFBOzs7OztRQUtBLElBQUEsbUJBQUEsVUFBQSxRQUFBOztZQUVBLGVBQUEsR0FBQSxNQUFBO1lBQ0EsZUFBQSxHQUFBLE1BQUE7WUFDQSxJQUFBLGdCQUFBLGdCQUFBLGdCQUFBLGNBQUE7O2dCQUVBLE9BQUEsT0FBQSxZQUFBO29CQUNBLElBQUEsT0FBQSxlQUFBLFdBQUE7d0JBQ0EsVUFBQSxLQUFBLFNBQUEsT0FBQSxlQUFBLE9BQUEsSUFBQSxPQUFBLFVBQUEsT0FBQSxPQUFBLFlBQUE7MkJBQ0EsSUFBQSxPQUFBLGVBQUEsUUFBQTt3QkFDQSxVQUFBLEtBQUEsWUFBQSxPQUFBOzs7Ozs7UUFNQSxJQUFBLFNBQUEsWUFBQTs7O1lBR0EsSUFBQSxPQUFBLGVBQUE7Z0JBQ0EsSUFBQSxpQkFBQSxJQUFBLFVBQUE7cUJBQ0EsS0FBQSxPQUFBLFVBQUEsVUFBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO3FCQUNBLEdBQUEsYUFBQSxJQUFBO3FCQUNBLEdBQUEsWUFBQSxJQUFBO3FCQUNBLEdBQUEsU0FBQSxJQUFBO21CQUNBO2dCQUNBLElBQUEsaUJBQUEsSUFBQSxVQUFBO3FCQUNBLEtBQUEsT0FBQSxVQUFBLFVBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQTs7Ozs7WUFLQSxlQUFBLFVBQUE7aUJBQ0EsS0FBQSxPQUFBLFVBQUEsVUFBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO2lCQUNBO2lCQUNBLFNBQUE7aUJBQ0EsTUFBQSxVQUFBLFVBQUEsR0FBQTtvQkFDQSxPQUFBLElBQUEsU0FBQTs7aUJBRUEsTUFBQSxRQUFBLFVBQUEsR0FBQTtvQkFDQSxPQUFBLFlBQUE7OztZQUdBLGVBQUEsVUFBQTtpQkFDQSxLQUFBLE9BQUEsVUFBQSxVQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUE7aUJBQ0E7aUJBQ0EsU0FBQTtpQkFDQSxLQUFBLEtBQUE7aUJBQ0EsS0FBQSxLQUFBO2lCQUNBLEtBQUEsU0FBQSxVQUFBLEdBQUE7b0JBQ0EsSUFBQSxXQUFBLGdCQUFBO29CQUNBLElBQUEsWUFBQSxTQUFBLFNBQUEsR0FBQTt3QkFDQSxPQUFBLE9BQUEsWUFBQSxTQUFBOztvQkFFQSxPQUFBLE9BQUE7O2lCQUVBLE1BQUEsUUFBQSxVQUFBLEdBQUE7b0JBQ0EsSUFBQSxXQUFBLGdCQUFBO29CQUNBLElBQUEsRUFBQSxVQUFBLFVBQUEsV0FBQTt3QkFDQSxPQUFBOztvQkFFQSxPQUFBOztpQkFFQSxNQUFBLFdBQUEsVUFBQSxHQUFBO29CQUNBLElBQUEsVUFBQSxFQUFBLFVBQUEsZ0JBQUEsSUFBQTtvQkFDQSxPQUFBLFVBQUEsVUFBQTs7aUJBRUEsTUFBQSxVQUFBLFVBQUEsR0FBQTtvQkFDQSxPQUFBLEVBQUEsZUFBQSxZQUFBLFNBQUE7OztZQUdBLGVBQUEsVUFBQTtpQkFDQSxLQUFBLE9BQUEsVUFBQSxVQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUE7aUJBQ0E7aUJBQ0EsU0FBQTtpQkFDQSxLQUFBLEtBQUEsVUFBQSxHQUFBO29CQUNBLElBQUEsV0FBQSxnQkFBQTtvQkFDQSxJQUFBLFlBQUEsU0FBQSxTQUFBLEdBQUE7d0JBQ0EsSUFBQSxFQUFBLFVBQUEsVUFBQSxXQUFBOzRCQUNBLE9BQUEsT0FBQSxZQUFBLFNBQUE7OztvQkFHQSxPQUFBOztpQkFFQSxLQUFBLEtBQUE7aUJBQ0EsS0FBQSxTQUFBLFVBQUEsR0FBQTtvQkFDQSxJQUFBLFdBQUEsZ0JBQUE7b0JBQ0EsSUFBQSxZQUFBLFNBQUEsU0FBQSxHQUFBO3dCQUNBLE9BQUEsT0FBQSxZQUFBLFNBQUE7O29CQUVBLE9BQUEsT0FBQTs7aUJBRUEsTUFBQSxRQUFBLFVBQUEsR0FBQTtvQkFDQSxJQUFBLFdBQUEsZ0JBQUE7b0JBQ0EsSUFBQSxFQUFBLFVBQUEsVUFBQSxTQUFBO3dCQUNBLE9BQUE7O29CQUVBLE9BQUE7O2lCQUVBLE1BQUEsV0FBQSxVQUFBLEdBQUE7b0JBQ0EsSUFBQSxVQUFBLEVBQUEsVUFBQSxnQkFBQSxJQUFBO29CQUNBLE9BQUEsVUFBQSxVQUFBOztpQkFFQSxNQUFBLFVBQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsRUFBQSxl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QkFDQSxLQUFBLE9BQUEsVUFBQSxVQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUE7aUJBQ0EsR0FBQSxTQUFBLFVBQUEsUUFBQTtvQkFDQSxpQkFBQTs7Ozs7WUFLQSxJQUFBLFlBQUEsZUFBQTtpQkFDQSxPQUFBO2lCQUNBLEtBQUEsU0FBQTs7WUFFQSxVQUFBLE9BQUE7aUJBQ0EsS0FBQSxTQUFBO2lCQUNBLEtBQUEsU0FBQSxPQUFBO2lCQUNBLEtBQUEsVUFBQSxPQUFBO2lCQUNBLE1BQUEsUUFBQSxVQUFBLEdBQUE7b0JBQ0EsT0FBQSxZQUFBOztpQkFFQSxNQUFBLFVBQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsSUFBQSxTQUFBOztpQkFFQTtpQkFDQSxTQUFBOztZQUVBLFVBQUEsT0FBQTtpQkFDQSxLQUFBLFNBQUE7aUJBQ0EsS0FBQSxTQUFBLE9BQUEsWUFBQTtpQkFDQSxLQUFBLFVBQUEsT0FBQSxhQUFBO2lCQUNBLEtBQUEsS0FBQTtpQkFDQSxLQUFBLEtBQUE7aUJBQ0EsTUFBQSxRQUFBOztZQUVBLFVBQUEsT0FBQTtpQkFDQSxLQUFBLFNBQUE7aUJBQ0EsS0FBQSxTQUFBLE9BQUEsWUFBQTtpQkFDQSxLQUFBLFVBQUEsT0FBQSxhQUFBO2lCQUNBLEtBQUEsS0FBQTtpQkFDQSxLQUFBLEtBQUE7aUJBQ0EsTUFBQSxRQUFBOztZQUVBLFVBQUEsT0FBQTtpQkFDQSxLQUFBLFNBQUE7aUJBQ0EsS0FBQSxTQUFBLE9BQUEsWUFBQTtpQkFDQSxLQUFBLFVBQUEsT0FBQSxhQUFBO2lCQUNBLEtBQUEsS0FBQTtpQkFDQSxLQUFBLEtBQUE7aUJBQ0EsTUFBQSxRQUFBOztZQUVBLFVBQUEsT0FBQTtpQkFDQSxLQUFBLFNBQUE7aUJBQ0EsS0FBQSxVQUFBLEdBQUE7b0JBQ0EsT0FBQSxZQUFBOztpQkFFQSxLQUFBLGVBQUE7aUJBQ0EsS0FBQSxLQUFBLE9BQUEsWUFBQTtpQkFDQSxLQUFBLEtBQUEsQ0FBQSxPQUFBLGFBQUEsS0FBQTtpQkFDQSxNQUFBLFdBQUEsT0FBQSxlQUFBLFVBQUE7O1lBRUEsVUFBQSxPQUFBO2lCQUNBLEtBQUEsU0FBQTtpQkFDQSxLQUFBLFVBQUEsR0FBQTtvQkFDQSxJQUFBLEVBQUEsZUFBQSxXQUFBO3dCQUNBLE9BQUEscUJBQUE7OztpQkFHQSxLQUFBLGVBQUE7aUJBQ0EsS0FBQSxLQUFBLE9BQUEsWUFBQTtpQkFDQSxLQUFBLEtBQUEsT0FBQSxhQUFBO2lCQUNBLE1BQUEsV0FBQSxPQUFBLGVBQUEsVUFBQTs7WUFFQSxVQUFBLE9BQUE7aUJBQ0EsS0FBQSxTQUFBO2lCQUNBLE9BQUE7aUJBQ0EsS0FBQSxTQUFBO2lCQUNBLEtBQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsZ0JBQUE7O2lCQUVBLEtBQUEsZUFBQTtpQkFDQSxLQUFBLEtBQUE7aUJBQ0EsS0FBQSxLQUFBLE9BQUEsYUFBQTs7WUFFQSxJQUFBLFNBQUEsVUFBQSxPQUFBO2lCQUNBLEtBQUEsU0FBQTtpQkFDQSxLQUFBLGVBQUE7aUJBQ0EsS0FBQSxLQUFBLE9BQUEsWUFBQTtpQkFDQSxLQUFBLEtBQUEsS0FBQSxNQUFBLE9BQUEsWUFBQTtpQkFDQSxLQUFBLE1BQUE7aUJBQ0EsTUFBQSxXQUFBLE9BQUEsZUFBQSxTQUFBOztZQUVBLE9BQUEsT0FBQTtpQkFDQSxLQUFBLFNBQUE7aUJBQ0EsS0FBQSxlQUFBO2lCQUNBLEtBQUEsS0FBQSxPQUFBLFlBQUE7aUJBQ0EsS0FBQSxLQUFBLEtBQUEsTUFBQSxPQUFBLGFBQUE7aUJBQ0EsS0FBQSxNQUFBO2lCQUNBLE1BQUEsYUFBQSxhQUFBLFFBQUE7aUJBQ0EsS0FBQSxVQUFBLEdBQUE7b0JBQ0EsT0FBQSxhQUFBOztpQkFFQSxLQUFBOztZQUVBLE9BQUEsT0FBQTtpQkFDQSxLQUFBLFNBQUE7aUJBQ0EsS0FBQSxlQUFBO2lCQUNBLEtBQUEsS0FBQSxPQUFBLFlBQUE7aUJBQ0EsS0FBQSxLQUFBLEtBQUEsTUFBQSxPQUFBLFlBQUE7aUJBQ0EsS0FBQSxNQUFBO2lCQUNBLE1BQUEsYUFBQSxhQUFBLFFBQUE7aUJBQ0EsS0FBQSxVQUFBLEdBQUE7b0JBQ0EsT0FBQSxhQUFBOztpQkFFQSxLQUFBOztZQUVBLE9BQUEsT0FBQTtpQkFDQSxLQUFBLFNBQUE7aUJBQ0EsS0FBQSxlQUFBO2lCQUNBLEtBQUEsS0FBQSxPQUFBLFlBQUE7aUJBQ0EsS0FBQSxLQUFBLEtBQUEsTUFBQSxPQUFBLFlBQUE7aUJBQ0EsS0FBQSxNQUFBO2lCQUNBLE1BQUEsYUFBQSxhQUFBLFFBQUE7aUJBQ0EsS0FBQSxVQUFBLEdBQUE7b0JBQ0EsT0FBQSxhQUFBOztpQkFFQSxLQUFBOztZQUVBLE9BQUEsT0FBQTtpQkFDQSxLQUFBLFNBQUE7aUJBQ0EsS0FBQSxlQUFBO2lCQUNBLEtBQUEsS0FBQSxPQUFBLFlBQUE7aUJBQ0EsS0FBQSxLQUFBLEtBQUEsTUFBQSxPQUFBLGFBQUE7aUJBQ0EsS0FBQSxNQUFBO2lCQUNBLE1BQUEsYUFBQSxhQUFBLFFBQUE7aUJBQ0EsS0FBQSxVQUFBLEdBQUE7b0JBQ0EsT0FBQSxjQUFBOzs7WUFHQSxPQUFBLE9BQUE7aUJBQ0EsS0FBQSxTQUFBO2lCQUNBLEtBQUEsZUFBQTtpQkFDQSxLQUFBLEtBQUEsT0FBQSxZQUFBO2lCQUNBLEtBQUEsS0FBQSxLQUFBLE1BQUEsT0FBQSxhQUFBO2lCQUNBLEtBQUEsTUFBQTtpQkFDQSxNQUFBLGFBQUEsYUFBQSxRQUFBO2lCQUNBLEtBQUEsVUFBQSxHQUFBO29CQUNBLE9BQUEsWUFBQTs7aUJBRUEsS0FBQTs7WUFFQSxVQUFBLE9BQUE7aUJBQ0EsS0FBQSxTQUFBO2lCQUNBLEtBQUEsU0FBQSxPQUFBO2lCQUNBLEtBQUEsVUFBQSxPQUFBO2lCQUNBLEdBQUEsYUFBQSxZQUFBO29CQUNBLEdBQUEsT0FBQSxHQUFBLE9BQUEsTUFBQSxHQUFBLEdBQUEsY0FBQSxTQUFBO3lCQUNBLE1BQUEsZ0JBQUE7O2lCQUVBLEdBQUEsWUFBQSxZQUFBO29CQUNBLEdBQUEsT0FBQSxHQUFBLE9BQUEsTUFBQSxHQUFBLEdBQUEsY0FBQSxTQUFBO3lCQUNBLE1BQUEsZ0JBQUE7O2lCQUVBLEdBQUEsU0FBQSxVQUFBLEdBQUE7b0JBQ0EsaUJBQUE7O2lC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LFFBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxFQUFBLEtBQUEsTUFBQSxTQUFBLEdBQUE7Z0JBQ0EsRUFBQSxlQUFBO2dCQUNBLFdBQUE7Ozs7UUFJQSxPQUFBLElBQUEsY0FBQSxVQUFBLE9BQUEsTUFBQTtZQUNBLGNBQUE7Ozs7O0FDdHdCQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxVQUFBLGdCQUFBLFlBQUE7UUFDQSxPQUFBO1lBQ0EsWUFBQTtZQUNBLGFBQUE7WUFDQSxVQUFBO1lBQ0EsT0FBQTtnQkFDQSxNQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsT0FBQTtnQkFDQSxRQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsU0FBQTtnQkFDQSxNQUFBO2dCQUNBLFVBQUE7Ozs7OztBQ2hCQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxXQUFBLGlGQUFBLFVBQUEsUUFBQSxhQUFBLGNBQUEsYUFBQTtRQUNBLElBQUEsUUFBQTtZQUNBLFNBQUE7WUFDQSxPQUFBO1lBQ0EsYUFBQTtZQUNBLFlBQUE7WUFDQSxhQUFBO1lBQ0EsWUFBQTtZQUNBLGFBQUE7O1FBRUEsT0FBQSxjQUFBO1FBQ0EsT0FBQSxpQkFBQTtRQUNBLE9BQUEsa0JBQUEsQ0FBQSxLQUFBLEtBQUE7UUFDQSxPQUFBLGNBQUE7UUFDQSxPQUFBLFlBQUE7UUFDQSxPQUFBLFdBQUE7UUFDQSxPQUFBLGNBQUE7UUFDQSxPQUFBLGlCQUFBO1FBQ0EsT0FBQSxlQUFBO1FBQ0EsT0FBQSxxQkFBQTtRQUNBLE9BQUEsUUFBQTtRQUNBLE9BQUEsYUFBQTs7UUFFQSxJQUFBLGdCQUFBO1lBQ0EsU0FBQSxPQUFBLE1BQUEsU0FBQSxPQUFBLGFBQUEsT0FBQSxnQkFBQSxRQUFBLEtBQUEsVUFBQSxPQUFBLE9BQUEsTUFBQSxNQUFBLEtBQUEsVUFBQSxhQUFBLE1BQUEsZUFBQSxNQUFBLG1CQUFBLE1BQUEsS0FBQTs7O1FBR0EsT0FBQSxhQUFBLFlBQUE7WUFDQSxPQUFBLGNBQUEsQ0FBQSxPQUFBO1lBQ0EsTUFBQSxLQUFB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R0FBQTtZQUNBLGNBQUE7Ozs7O1FBS0EsSUFBQSxPQUFBLFNBQUEsR0FBQSxXQUFBO1FBQ0EsSUFBQSxTQUFBLEdBQUEsV0FBQSxlQUFBLE1BQUE7WUFDQSxPQUFBLFNBQUEsR0FBQSxXQUFBOzs7O1FBSUEsSUFBQSxXQUFBO1FBQ0EsSUFBQSxnQkFBQSxHQUFBLE9BQUE7O1FBRUEsSUFBQSxNQUFBLEdBQUEsSUFBQTthQUNBLFdBQUE7YUFDQSxZQUFBLE9BQUEsT0FBQTthQUNBLFlBQUEsT0FBQSxPQUFBOztRQUVBLElBQUEsTUFBQSxHQUFBLE9BQUEsU0FBQSxJQUFBLE9BQUEsT0FBQSxLQUFBO1lBQ0EsT0FBQTtZQUNBLFFBQUE7V0FDQSxPQUFBLEtBQUEsS0FBQTtZQUNBLGFBQUEsZUFBQSxPQUFBLElBQUEsTUFBQSxPQUFBLElBQUE7WUFDQSxTQUFBOzs7UUFHQSxJQUFBLFFBQUEsSUFBQSxPQUFBLEtBQUEsS0FBQTtZQUNBLGFBQUE7O1FBRUEsTUFBQSxPQUFBO2FBQ0EsTUFBQTtnQkFDQSxXQUFBLElBQUEsS0FBQTs7YUFFQSxLQUFBLFNBQUE7YUFDQSxLQUFBLEtBQUE7O1FBRUEsYUFBQSxNQUFBLE9BQUE7YUFDQSxNQUFBO2dCQUNBLFVBQUE7O2FBRUEsS0FBQTtnQkFDQSxLQUFBOzthQUVBLE1BQUEsUUFBQSxZQUFBO2dCQUNBLE9BQUE7OztRQUdBLE9BQUEsSUFBQSxPQUFBO2FBQ0EsTUFBQTtnQkFDQSxZQUFBOzthQUVBLEtBQUEsZUFBQTthQUNBLEtBQUEsTUFBQTs7O1FBR0EsWUFBQSxTQUFBLFlBQUEsZUFBQTtZQUNBLFdBQUEsVUFBQSxRQUFBLFNBQUEsR0FBQTtnQkFDQSxJQUFBLE9BQUEsTUFBQSxhQUFBO29CQUNBLElBQUE7O2dCQUVBLElBQUEsSUFBQSxHQUFBLFlBQUEsRUFBQSxZQUFBO2dCQUNBLE9BQUEsU0FBQSxHQUFBO29CQUNBLEVBQUEsYUFBQSxFQUFBO29CQUNBLEtBQUEsS0FBQSxjQUFBLEVBQUE7b0JBQ0EsT0FBQTs7OztRQUlBLFdBQUEsU0FBQSxZQUFBLFVBQUE7WUFDQSxXQUFBLFVBQUEsS0FBQSxTQUFBLEdBQUE7Z0JBQ0EsSUFBQSxJQUFBLEdBQUEsWUFBQSxFQUFBLFVBQUE7Z0JBQ0EsT0FBQSxTQUFBLEdBQUE7b0JBQ0EsRUFBQSxXQUFBLEVBQUE7b0JBQ0EsT0FBQSxJQUFBOzs7OztRQUtBLGdCQUFBOztRQUVBLE9BQUE7Ozs7Ozs7O0lBUUEsSUFBQSxTQUFBLFVBQUEsT0FBQTtRQUNBLElBQUEsZUFBQTtZQUNBLElBQUEsYUFBQTtZQUNBLElBQUEsYUFBQSxHQUFBO2dCQUNBLGNBQUE7Ozs7O1lBS0EsV0FBQSxhQUFBLFNBQUE7aUJBQ0EsTUFBQSxRQUFBLFlBQUE7b0JBQ0EsT0FBQTs7aUJBRUEsS0FBQSxVQUFBLENBQUEsS0FBQSxLQUFBLEtBQUE7O1lBRUEsS0FBQSxhQUFBLFNBQUEsTUFBQSxLQUFBLFdBQUE7Ozs7SUFJQSxPQUFBLE9BQUEsY0FBQSxTQUFBLE9BQUE7UUFDQSxJQUFBLFNBQUEsQ0FBQSxlQUFBO1lBQ0E7ZUFDQTtZQUNBLE9BQUE7Ozs7O0FDeElBOztBQUVBLFFBQUEsT0FBQSxZQUFBLFVBQUEsdUJBQUEsWUFBQTtJQUNBLE9BQUE7UUFDQSxZQUFBO1FBQ0EsVUFBQTtRQUNBLE9BQUE7WUFDQSxZQUFBOzs7OztBQ1BBLENBQUEsWUFBQTtJQUNBOztJQUVBLFFBQUEsT0FBQSxZQUFBLFdBQUEsd0VBQUEsVUFBQSxRQUFBLFVBQUEsYUFBQTs7UUFFQSxJQUFBLFFBQUE7O1FBRUEsU0FBQSxHQUFBLFdBQUEsVUFBQTtZQUNBLFFBQUEsSUFBQTs7O1FBR0EsSUFBQSxhQUFBLFdBQUE7WUFDQSxPQUFBLE9BQUEsU0FBQSxVQUFBLE9BQUE7Z0JBQ0E7Ozs7UUFJQSxJQUFBLGVBQUEsVUFBQTtZQUNBLEdBQUEsT0FBQSxTQUFBLE9BQUEsTUFBQSxTQUFBLEVBQUE7Z0JBQ0EsT0FBQSxNQUFBLEtBQUEsU0FBQSxHQUFBLEdBQUE7b0JBQ0EsT0FBQSxFQUFBLE9BQUEsU0FBQSxFQUFBLE9BQUE7OztnQkFHQSxPQUFBLFlBQUEsRUFBQSxPQUFBLE9BQUEsTUFBQSxZQUFBLE9BQUE7Z0JBQ0EsSUFBQSxTQUFBLE9BQUEsVUFBQSxTQUFBLEtBQUE7O2dCQUVBLElBQUEsUUFBQSxTQUFBLEdBQUE7Z0JBQ0EsSUFBQSxDQUFBLFNBQUEsVUFBQSxHQUFBLEVBQUEsUUFBQTs7O2dCQUdBLE9BQUEsTUFBQSxLQUFBLFNBQUEsR0FBQSxHQUFBO29CQUNBLE9BQUEsRUFBQSxPQUFBLFdBQUEsRUFBQSxPQUFBOztnQkFFQSxJQUFBLFVBQUEsT0FBQSxNQUFBLEdBQUEsT0FBQTtnQkFDQSxJQUFBLFVBQUEsT0FBQSxNQUFBLE9BQUEsTUFBQSxTQUFBLEdBQUEsT0FBQTtnQkFDQSxJQUFBLFdBQUEsT0FBQSxJQUFBLFNBQUEsS0FBQSxPQUFBLElBQUEsU0FBQTtnQkFDQSxJQUFBLFNBQUE7Z0JBQ0EsR0FBQSxXQUFBLEVBQUE7b0JBQ0EsU0FBQTs7O2dCQUdBLFFBQUEsR0FBQSxRQUFBLFNBQUEsaUJBQUEsVUFBQSxPQUFBLFdBQUEsV0FBQSxZQUFBLGtCQUFBLFdBQUEsUUFBQSxNQUFBLE9BQUEsU0FBQSxNQUFBLE9BQUEsT0FBQSxPQUFBLFFBQUEsTUFBQTs7Z0JBRUEsTUFBQSxlQUFBOztnQkFFQSxNQUFBLE9BQUE7Ozs7O1FBS0EsU0FBQSxTQUFBO1lBQ0EsSUFBQSxVQUFBLEtBQUE7WUFDQSxJQUFBLE9BQUEsTUFBQSxTQUFBLEdBQUE7Z0JBQ0EsVUFBQSxPQUFBLE1BQUEsT0FBQSxNQUFBLFNBQUEsR0FBQSxPQUFBOzs7WUFHQSxPQUFBO1NBQ0E7O1FBRUEsT0FBQSxhQUFBLFNBQUEsS0FBQTtZQUNBLEdBQUEsS0FBQTtnQkFDQSxPQUFBLE9BQUEsSUFBQSxNQUFBOztpQkFFQTtnQkFDQSxPQUFBOzs7UUFHQTs7UUFFQSxVQUFBLGVBQUEsWUFBQTtRQUNBLE9BQUE7WUFDQSxZQUFBO1lBQ0EsYUFBQTtZQUNBLFVBQUE7WUFDQSxPQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsU0FBQTtnQkFDQSxPQUFBOzs7Ozs7O0FDN0VBLENBQUEsWUFBQTtJQUNBOztJ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QUFBLE9BQUEsWUFBQSxXQUFBLElBQUEsS0FBQSxPQUFBOzs7Z0JBR0EsS0FBQSxJQUFBLFVBQUEsS0FBQSxPQUFBO2dCQUNBO29CQUNBLEtBQUEsU0FBQSxLQUFBLE9BQUEsU0FBQSxRQUFBLE1BQUEsS0FBQSxPQUFBLFNBQUEsUUFBQSxJQUFBLEtBQUEsT0FBQTs7O2dCQUdBLElBQUEsV0FBQTs7Z0JBRUEsSUFBQSxhQUFBLEtBQUEsT0FBQTtnQkFDQTtvQkFDQSxXQUFBLEtBQUEsTUFBQSxLQUFBLE9BQUEsT0FBQTtvQkFDQSxLQUFBLEtBQUEsT0FBQTt5QkFDQSxLQUFBLEtBQUEsS0FBQSxPQUFBO3lCQUNBLEtBQUEsS0FBQSxLQUFBLE9BQUEsS0FBQSxJQUFBLFdBQUE7eUJBQ0EsS0FBQSxNQUFBLFdBQUE7eUJBQ0EsS0FBQSxlQUFBO3lCQUNBLEtBQUEsS0FBQSxPQUFBO3lCQUNBLE1BQUEsYUFBQSxXQUFBO3lCQUNBLE1BQUEsUUFBQTt5QkFDQSxNQUFBLGdCQUFBOzs7Z0JBR0EsV0FBQSxLQUFBLE1BQUEsS0FBQSxPQUFBLE9BQUE7Z0JBQ0EsSUFBQSxhQUFBLEtBQUEsT0FBQSxTQUFBLEtBQUEsT0FBQSxhQUFBO2dCQUNBLEtBQUEsSUFBQSxRQUFBLEtBQUEsT0FBQSxLQUFBLFNBQUEsS0FBQSxPQUFBLEtBQUEsU0FBQTtnQkFDQTtvQkFDQSxJQUFBLGFBQUEsYUFBQSxLQUFBLE9BQUE7d0JBQ0EsU0FBQTt3QkFDQSxTQUFBO29CQUNBLEtBQUEsSUFBQSxRQUFBLFFBQUEsWUFBQSxRQUFBLEtBQUEsSUFBQSxRQUFBLFlBQUEsS0FBQSxPQUFBLE1BQUEsU0FBQTtvQkFDQTt3QkFDQSxTQUFBLEtBQUEsYUFBQSxPQUFBO3dCQUNBLFNBQUEsS0FBQSxhQUFBLE9BQUE7O3dCQUVBLEtBQUEsS0FBQSxPQUFBOzZCQUNBLEtBQUEsTUFBQSxPQUFBOzZCQUNBLEtBQUEsTUFBQSxPQUFBOzZCQUNBLEtBQUEsTUFBQSxPQUFBOzZCQUNBLEtBQUEsTUFBQSxPQUFBOzZCQUNBLE1BQUEsVUFBQTs2QkFD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O1FBR0EsT0FBQTtZQUNBLDBCQUFBLFNBQUEsSUFBQTtnQkFDQSxJQUFBLE1BQUEsR0FBQTtvQkFDQSxJQUFBLE1BQUEsTUFBQTt3QkFDQSxPQUFBLElBQUEsUUFBQSxLQUFBOztvQkFFQSxJQUFBLE9BQUEsUUFBQSxNQUFBLEtBQUEsTUFBQTt3QkFDQSxPQUFBLENBQUEsSUFBQSxNQUFBLFFBQUEsS0FBQTs7b0JBRUEsT0FBQSxDQUFBLElBQUEsS0FBQSxNQUFBLFFBQUEsS0FBQTs7Z0JBRUEsT0FBQTs7WUFFQSw0QkFBQSxTQUFBLElBQUEsU0FBQTs7Ozs7Z0JBS0EsSUFBQSxNQUFBLEdBQUE7b0JBQ0EsSUFBQSxNQUFBLE1BQUE7d0JBQ0EsT0FBQSxJQUFBLFFBQUEsWUFBQTs7b0JBRUEsSUFBQSxPQUFBLFFBQUEsTUFBQSxLQUFBLE1BQUE7d0JBQ0EsT0FBQSxDQUFBLElBQUEsTUFBQSxRQUFBLFlBQUE7O29CQUVBLElBQUEsT0FBQSxLQUFBLFFBQUEsTUFBQSxLQUFBLEtBQUEsTUFBQTt3QkFDQSxPQUFBLENBQUEsSUFBQSxLQUFBLE1BQUEsUUFBQSxZQUFBOztvQkFFQSxJQUFBLE9BQUEsS0FBQSxLQUFBLFFBQUEsTUFBQSxLQUFBLEtBQUEsS0FBQSxNQUFBO3dCQUNBLE9BQUEsQ0FBQSxJQUFBLEtBQUEsS0FBQSxNQUFBLFFBQUEsWUFBQTs7b0JBRUEsT0FBQSxDQUFBLElBQUEsS0FBQSxLQUFBLEtBQUEsTUFBQSxRQUFBLFlBQUE7O2dCQUVBLE9BQUE7O1lBRUEsaUJBQUEsWUFBQTtnQkFDQSxJQUFBLElBQUE7b0JBQ0EsSUFBQTtvQkFDQSxJQUFBLEVBQUE7b0JBQ0EsSUFBQSxTQUFBO29CQUNBLElBQUEsRUFBQSxjQUFBLEVBQUEsZUFBQSxFQUFBO29CQUNBLElBQUEsRUFBQSxlQUFBLEVBQUEsZ0JBQUEsRUFBQTs7Z0JBRUEsT0FBQTtvQkFDQSxPQUFBO29CQUNBLFFBQUE7OztZQUdBLG1CQUFBLFVBQUEsT0FBQSxNQUFBO2dCQUNBLElBQUEsS0FBQSxPQUFBLElBQUE7b0JBQ0EsT0FBQSxPQUFBLElBQUE7b0JBQ0EsT0FBQSxPQUFBLElBQUEsSUFBQSxLQUFBLE9BQUEsSUFBQTs7Z0JBRUEsSUFBQSxXQUFBLE9BQUEsU0FBQTs7Z0JBRUEsT0FBQSxZQUFBLFNBQUEsUUFBQSxLQUFBLFFBQUEsWUFBQSxTQUFBLFNBQUEsS0FBQSxRQUFBLFlBQUEsU0FBQSxXQUFBLEtBQUEsUUFBQSxZQUFBLFNBQUEsV0FBQSxLQUFBOztZQUVBLGNBQUEsU0FBQSxVQUFBO2dCQUNBLElBQUEsU0FBQSxDQUFBLFNBQUEsU0FBQSxVQUFBLFlBQUEsV0FBQSxTQUFBO2dCQUNBLE9BQUEsT0FBQTs7WUFFQSxNQUFBLFlBQUE7Z0JBQ0EsSUFBQSxLQUFBLE9BQUEsVUFBQTtvQkFDQSxRQUFBLEdBQUEsUUFBQTtvQkFDQSxRQUFBLEdBQUEsUUFBQTs7Z0JBRUEsSUFBQSxDQUFBLFFBQUEsQ0FBQSxPQUFBLFFBQUEsQ0FBQSxJQUFBO29CQUNBLE9BQUE7O2dCQUVBLE9BQUE7Ozs7OztBQ2pGQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLG1EQUFBLFVBQUEsT0FBQSxJQUFBLGFBQUE7UUFDQSxJQUFBLHlCQUFBLFVBQUEsV0FBQTtZQUNBLE9BQUE7Z0JBQ0EsV0FBQTs7OztRQUlBLE9BQUE7WUFDQSxpQkFBQSxVQUFBLE1BQUE7Z0JBQ0EsT0FBQSxRQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBOztnQkFFQSxNQUFBO29CQUNBLEtBQUEsWUFBQSxLQUFBLFlBQUE7b0JBQ0EsUUFBQTtvQkFDQSxNQUFBO21CQUNBLFFBQUEsVUFBQSxRQUFBO29CQUNBLEVBQUEsUUFBQTttQkFDQSxNQUFBLFVBQUEsT0FBQTtvQkFDQSxFQUFBLE9BQUE7OztnQkFHQSxPQUFBLEVBQUE7Ozs7OztBQ3pCQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLG1GQUFBLFVBQUEsV0FBQSxhQUFBLFFBQUEsZUFBQSxRQUFBO1FBQ0EsT0FBQTtZQUNBLFdBQUEsWUFBQTtnQkFDQSxJQUFB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QUEsYUFBQSxVQUFBLE9BQUE7Z0JBQ0EsVUFBQSxPQUFBLE1BQUEsSUFBQSxNQUFBOztZQUVBOzs7UUFHQSxJQUFBLGNBQUEsVUFBQSxTQUFBO1lBQ0EsV0FBQSxRQUFBLFFBQUEsU0FBQSxJQUFBLFVBQUE7WUFDQSxrQkFBQSxRQUFBLFNBQUE7WUFDQSxPQUFBOzs7UUFHQSxJQUFBLGFBQUEsWUFBQTtZQUNBLE9BQUEsVUFBQTtZQUNBLFlBQUEsZUFBQSxZQUFBLEtBQUEsVUFBQSxNQUFBO2dCQUNBLE9BQUEsVUFBQSxLQUFBO2dCQUNBLE9BQUEsWUFBQSxhQUFBLEtBQUE7Z0JBQ0EsT0FBQSxZQUFBLE9BQUEsT0FBQTtnQkFDQSxPQUFBLFVBQUE7ZUFDQSxNQUFBLFVBQUEsT0FBQTtnQkFDQSxRQUFBLElBQUE7ZUFDQSxRQUFBLFlBQUE7Z0JBQ0EsT0FBQSxVQUFBOzs7OztRQUtBLElBQUEsYUFBQSxZQUFBO1lBQ0EsV0FBQSxlQUFBO1lBQ0EsY0FBQSxlQUFBO1lBQ0EsSUFBQSxDQUFBLFdBQUEsU0FBQTtnQkFDQSxRQUFBLElBQUEsd0JBQUEsT0FBQTtnQkFDQSxXQUFBLFVBQUEsT0FBQSxJQUFBLE9BQUEsbUJBQUE7Z0JBQ0EsVUFBQSxPQUFBLFdBQUEsV0FBQSxTQUFBOztZQUVBLElBQUEsQ0FBQSxXQUFBLE9BQUE7Z0JBQ0EsV0FBQSxRQUFBLE9BQUEsSUFBQSxPQUFBLGtCQUFBO2dCQUNBLFVBQUEsT0FBQSxTQUFBLFdBQUEsT0FBQTs7WUFFQTs7O1FBR0E7O1FBRUEsUUFBQSxRQUFBLFVBQUEsTUFBQSxZQUFBOztZQUVBLElBQUEsV0FBQSxhQUFBO2dCQUNBLFNBQUEsWUFBQSxlQUFBLFlBQUE7Z0JBQ0EsZ0JBQUEsU0FBQSxTQUFBOztZQUVBLE9BQUEsWUFBQSxhQUFBLGdCQUFBLHFCQUFBLGdCQUFBOzs7OztBQ25NQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLHdCQUFBLFVBQUEsYUFBQTtRQUNBLElBQUEsT0FBQSxVQUFBLE9BQUEsUUFBQTtZQUNBLEtB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QUFBO1lBQ0EsT0FBQSxjQUFBLGVBQUEsZUFBQSxPQUFBLGNBQUE7O1lBRUEsVUFBQSxLQUFBLGdCQUFBOztZQUVBLGtCQUFBLE9BQUEsY0FBQTs7OztZQUlBLE9BQUEsa0JBQUE7WUFDQSxPQUFBLGlCQUFBOzs7UUFHQSxPQUFBLGNBQUEsWUFBQTtZQUNBLE9BQUEsY0FBQSxZQUFBLENBQUEsT0FBQSxjQUFBO1lBQ0EsT0FBQSxxQkFBQSxZQUFBLE9BQUEsY0FBQTtZQUNBLE9BQUEsVUFBQTtZQUNBLGVBQUEsY0FBQSxPQUFBLHNCQUFBLEtBQUEsU0FBQSxLQUFBO2dCQUNBLE9BQUEsdUJBQUE7Z0JBQ0EsT0FBQSxnQkFBQSxPQUFBLG9CQUFBLE9BQUEscUJBQUE7Z0JBQ0EsT0FBQSxVQUFBO2VBQ0EsTUFBQSxVQUFBLE9BQUE7Z0JBQ0EsUUFBQSxJQUFBO2dCQUNBLE9BQUEsU0FBQTtnQkFDQSxPQUFBLFVBQUE7Ozs7UUFJQSxPQUFBLHNCQUFBLFNBQUEsVUFBQTtZQUNBLE9BQUEsWUFBQSxZQUFBOzs7UUFHQSxPQUFBLDBCQUFBLFNBQUEsUUFBQTtZQUNBLE9BQUEsUUFBQSxZQUFBLFdBQUE7OztRQUdBLElBQUEsaUJBQUEsVUFBQSxJQUFBO1lBQ0EsT0FBQSxPQUFBLElBQUEsSUFBQTs7O1FBR0EsSUFBQSxjQUFBLFlBQUE7WUFDQSxlQUFBLGtCQUFBLEtBQUEsVUFBQSxNQUFBO2dCQUNBLE9BQUEsV0FBQSxLQUFBO2dCQUNBLE9BQUEsYUFBQSxFQUFBLE1BQUEsS0FBQSxTQUFBO2dCQUNBLE9BQUEsZUFBQSxLQUFBO2dCQUNBLElBQUEsT0FBQSxvQkFBQTtvQkFDQSxPQUFBLFlBQUEsT0FBQTt1QkFDQTtvQkFDQSxPQUFBLFVBQUE7O2dCQUVBLFFBQUEsT0FBQTtxQkFDQSxJQUFBO3dCQUNBLE9BQUE7d0JBQ0EsYUFBQTt3QkFDQSxVQUFBLFlBQUE7NEJBQ0EsSUFBQSxPQUFBLGVBQUE7Z0NBQ0EsSUFBQSxNQUFBLEVBQUEsUUFBQSxPQUFBLFlBQUEsT0FBQSxjQUFBO2dDQUNBLElBQUEsTUFBQSxHQUFBO29DQUNBLE9BQUEsWUFBQSxPQUFBLFdBQUEsTUFBQTs7Ozt1QkFJQSxJQUFBO3dCQUNBLE9BQUE7d0JBQ0EsYUFBQTt3QkFDQSxVQUFBLFlBQUE7NEJBQ0EsSUFBQSxPQUFBLGVBQUE7Z0NBQ0EsSUFBQSxNQUFBLEVBQUEsUUFBQSxPQUFBLFlBQUEsT0FBQSxjQUFBO2dDQUNBLElBQUEsT0FBQSxPQUFBLFdBQUEsU0FBQSxJQUFBO29DQUNBLE9BQUEsWUFBQSxPQUFBLFdBQUEsTUFBQTs7Ozs7ZUFLQSxNQUFBLFVBQUEsT0FBQTtnQkFDQSxRQUFBLElBQUE7Z0JBQ0EsT0FBQSxVQUFBOzs7O1FBSUEsSUFBQSxvQkFBQSxVQUFBLElBQUE7WUFDQSxPQUFBLFVBQUE7WUFDQSxlQUFBLGtCQUFBLElBQUEsS0FBQSxVQUFBLE1BQUE7Z0JBQ0EsT0FBQSx1QkFBQTtnQkFDQSxPQUFBLCtCQUFBLEVBQUEsTUFBQSxLQUFBO2dCQUNBLE9BQUEsZ0JBQUEsT0FBQSxvQkFBQSxPQUFBLHFCQUFBOztnQkFFQSxPQUFBLHNCQUFBO2dCQUNBLE9BQUEsb0JBQUEsRUFBQSxLQUFBLEtBQUEsY0FBQSxZQUFBLFNBQUE7Z0JBQ0EsSUFBQSxPQUFBLG1CQUFBO29CQUNBLEVBQUEsUUFBQSxLQUFBLGNBQUEsWUFBQSxVQUFBLFlBQUE7d0JBQ0EsSUFBQSxRQUFBLEVBQUEsS0FBQSxLQUFBLFFBQUEsUUFBQTs0QkFDQSxXQUFBLEVBQUEsT0FBQSxLQUFBLGNBQUEsWUFBQTt3QkFDQSxPQUFBLG9CQUFBLEtBQUEsQ0FBQSxNQUFBLFVBQUEsTUFBQTs7Ozs7Z0JBS0EsSUFBQSxjQUFBLEtBQUE7b0JBQ0EsV0FBQSxLQUFBOztnQkFFQSxPQUFBLHFCQUFBOztnQkFFQSxPQUFBLGNBQUE7b0JBQ0EsV0FBQSxZQUFBLE1BQUE7b0JBQ0EsV0FBQSxTQUFBOztnQkFFQSxPQUFBLGVBQUE7b0JBQ0EsV0FBQSxZQUFBLE9BQUE7b0JBQ0EsV0FBQSxTQUFBOztnQkFFQSxPQUFBLGVBQUE7b0JBQ0EsV0FBQSxZQUFBLE9BQUE7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QUFBLFVBQUEsTUFBQTtnQkFDQSxPQUFBOzs7O1FBSUEsT0FBQSxPQUFBLG9CQUFBLFVBQUEsT0FBQTtZQUNBLElBQUEsQ0FBQSxPQUFBLFNBQUE7Z0JBQ0EsS0FBQSxXQUFBLFFBQUEsTUFBQTtnQkFDQSxPQUFBOzs7Ozs7Ozs7O1FBVUEsT0FBQSxVQUFBLFVBQUEsT0FBQTs7WUFFQSxPQUFBLGdCQUFBO1lBQ0EsUUFBQSxJQUFBO1lBQ0EsV0FBQSxhQUFBLE9BQUEsS0FBQSxVQUFBLE1BQUE7Z0JBQ0EsT0FBQSxjQUFBLEtBQUEsU0FBQSxRQUFBLE1BQUEsS0FBQSxTQUFBO2dCQUNBLE9BQUEsZUFBQSxLQUFBO2dCQUNBLElBQUEsZ0JBQUEsVUFBQSxLQUFBO29CQUNBLFdBQUE7b0JBQ0EsYUFBQTtvQkFDQSxPQUFBO29CQUNBLE1BQUE7b0JBQ0EsYUFBQTs7Ozs7UUFLQSxPQUFBLGdCQUFBLFlBQUE7WUFDQSxFQUFBLFFBQUEsRUFBQSxNQUFBLEtBQUEsYUFBQSxVQUFBLE9BQUE7Z0JBQ0EsVUFBQSxPQUFBLE1BQUEsSUFBQSxNQUFBOztZQUVBLE9BQUEsVUFBQTtZQUNBLEtBQUE7OztRQUdBLE9BQUEsY0FBQSxVQUFBLFlBQUE7WUFDQSxhQUFBLGNBQUEsRUFBQSxTQUFBLE9BQUEsa0JBQUEsZUFBQSxPQUFBLE9BQUEsaUJBQUE7WUFDQSxPQUFBLGdCQUFBO1lBQ0EsT0FBQSxVQUFBO1lBQ0EsWUFBQSxZQUFBLFlBQUEsS0FBQSxZQUFBO2dCQUNBLE9BQUEsV0FBQTtnQkFDQSxLQUFBO2VBQ0EsTUFBQSxVQUFBLE9BQUE7Z0JBQ0EsT0FBQSxTQUFBO2dCQUNBLFFBQUEsSUFBQTtnQkFDQSxPQUFBLFVBQUE7Ozs7UUFJQSxPQUFBLFlBQUEsVUFBQSxLQUFBO1lBQ0EsT0FBQSxnQkFBQTtZQUNBLE9BQUEsVUFBQTtZQUNBLElBQUEsaUJBQUEsSUFBQTtZQUNBLElBQUEsU0FBQTtZQUNBLFdBQUEsVUFBQSxJQUFBLElBQUEsRUFBQSxRQUFBLGNBQUEsS0FBQSxVQUFBLE1BQUE7Z0JBQ0EsT0FBQSxXQUFBO2dCQUNBLElBQUEsU0FBQTtlQUNBLE1BQUEsVUFBQSxPQUFBO2dCQUNBLE9BQUEsU0FBQTtnQkFDQSxRQUFBLElBQUE7Z0JBQ0EsSUFBQSxTQUFBO2VBQ0EsUUFBQSxZQUFBO2dCQUNBLE9BQUEsVUFBQTs7OztRQUlBLEtBQUEsVUFBQSxZQUFBO1lBQ0EsV0FBQSxZQUFBLEtBQUEsWUFBQSxLQUFBLFVBQUEsTUFBQTtnQkFDQSxPQUFBLFdBQUEsS0FBQTtnQkFDQSxPQUFBLFlBQUEsYUFBQSxLQUFBO2dCQUNBLE9BQUEsWUFBQSxPQUFBLEtBQUE7ZUFDQSxNQUFBLFVBQUEsT0FBQTtnQkFDQSxRQUFBLElBQUE7ZUFDQSxRQUFBLFlBQUE7Z0JBQ0EsT0FBQSxVQUFBOzs7O1FBSUEsS0FBQSxjQUFBLFlBQUE7WUFDQSxlQUFBLGtCQUFBLEtBQUEsVUFBQSxNQUFBO2dCQUNBLE9BQUEsZ0JBQUEsS0FBQTtnQkFDQSxPQUFBLGNBQUEsUUFBQSxFQUFBLE1BQUEsWUFBQSxPQUFBLFlBQUEsU0FBQSxJQUFBLElBQUE7Ozs7Ozs7O2dCQVFBLEtBQUEsUUFBQSxLQUFBO2VBQ0EsTUFBQSxVQUFBLE9BQUE7Z0JBQ0EsT0FBQSxVQUFBO2dCQUNBLFFBQUEsSUFBQTs7OztRQUlBLEtBQUEsYUFBQSxZQUFBO1lBQ0EsSUFBQSxPQUFBLFdBQUEsWUFBQSxhQUFBOztnQkFFQSxJQUFBLENBQUEsS0FBQSxXQUFBLE9BQUE7b0JBQ0EsS0FBQSxXQUFBLFFBQUE7b0JBQ0EsVUFBQSxPQUFBLFNBQUEsS0FBQSxXQUFBLE9BQUE7O2dCQUVBLElBQUEsQ0FBQSxLQUFBLFdBQUEsV0FBQTtvQkFDQSxLQUFBLFdBQUEsWUFBQSxPQUFBLFlBQUE7b0JBQ0EsVUFBQSxPQUFBLGFBQUEsS0FBQSxXQUFBLFdBQUE7O2dCQUVBLElBQUEsQ0FBQSxLQUFBLFdBQUEsU0FBQTtvQkFDQSxLQUFBLFdBQUEsVUFBQSxPQUFBLElBQUEsT0FBQSxtQkFBQTtvQkFDQSxVQUFBLE9BQUEsV0FBQSxLQUFBLFdBQUEsU0FBQTs7Z0JBRUEsSUFB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QTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7OztZQUdBLE9BQUEsSUFBQTs7O1FBR0EsSUFBQSxjQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsT0FBQTtxQkFDQSxJQUFBLElBQUE7cUJBQ0EsT0FBQTs7WUFFQSxPQUFBLElBQUEsTUFBQTs7O1FBR0EsT0FBQTs7OztBQzFFQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLHlDQUFBLFVBQUEsb0JBQUE7UUFDQSxJQUFBLGlCQUFBLFVBQUEsSUFBQSxNQUFBLE1BQUEsVUFBQTtZQUNBLEtBQUEsS0FBQTtZQUNBLEtBQUEsT0FBQTtZQUNBLEtBQUEsT0FBQSxtQkFBQSxZQUFBO1lBQ0EsS0FBQSxXQUFBOzs7O1FBSUEsZUFBQSxZQUFBOzs7OztRQUtBLGVBQUEsUUFBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLE1BQUE7Z0JBQ0EsT0FBQSxJQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7OztZQUdBLE9BQUEsSUFBQTs7O1FBR0EsZUFBQSxjQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsT0FBQTtxQkFDQSxJQUFBLGVBQUE7cUJBQ0EsT0FBQTs7WUFFQSxPQUFBLGVBQUEsTUFBQTs7O1FBR0EsT0FBQTs7OztBQ3RDQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLHNCQUFBLFlBQUE7UUFDQSxJQUFBLHFCQUFBLFVBQUEsSUFBQSxNQUFBLFdBQUEsU0FBQSxVQUFBLGVBQUE7WUFDQSxLQUFBLEtBQUE7WUFDQSxLQUFBLE9BQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLFdBQUE7WUFDQSxLQUFB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LFNBQUE7WUFDQSxLQUFBLFNBQUE7WUFDQSxLQUFBLG1CQUFBLE9BQUEsSUFBQSxRQUFBO1lBQ0EsS0FBQSxVQUFBO1lBQ0EsS0FBQSxvQkFBQSxPQUFBLElBQUEsU0FBQTtZQUNBLEtBQUEsUUFBQTtZQUNBLEtBQUEsa0JBQUEsT0FBQSxJQUFBLE9BQUE7WUFDQSxLQUFBLHFCQUFBO1lBQ0EsS0FBQSxnQkFBQTtZQUNBLEtBQUEsT0FBQTtnQkFDQSxZQUFBLG1CQUFBLFlBQUEsS0FBQTtnQkFDQSxTQUFBLEtBQUE7Z0JBQ0EsYUFBQSxvQkFBQSxZQUFBLEtBQUE7O1lBRUEsS0FBQSxVQUFBO2dCQUNBLGFBQUEsb0JBQUEsWUFBQSxRQUFBO2dCQUNBLFNBQUEsUUFBQTs7WUFFQSxLQUFBLFVBQUEsT0FBQSxZQUFBO1lBQ0EsS0FBQSxXQUFBLGFBQUEsWUFBQTtZQUNBLEtBQUEsU0FBQTtZQUNBLEtBQUEsVUFBQTs7OztRQUlBLFdBQUEsWUFBQTtZQUNBLGFBQUEsWUFBQTtnQkFDQSxPQUFBLGFBQUEsa0JBQUEsS0FBQSxTQUFBLEtBQUE7O1lBRUEsb0JBQUEsVUFBQTtnQkFDQSxJQUFBLEtBQUEsV0FBQSxJQUFBO29CQUNBLE9BQUEsS0FBQSxTQUFBOztnQkFFQSxPQUFBOztZQUVBLGdCQUFBLFVBQUE7Ozs7Ozs7Ozs7Z0JBVUEsT0FBQSxLQUFBLE9BQUE7Ozs7O1FBS0EsV0FBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBOzs7WUFHQSxPQUFBLElBQUE7OztRQUdBLFdBQUEsY0FBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLFFBQUEsUUFBQSxPQUFBO2dCQUNBLE9BQUE7cUJBQ0EsSUFBQSxXQUFBO3FCQUNBLE9BQUE7O1lBRUEsT0FBQSxXQUFBLE1BQUE7OztRQUdBLE9BQUE7Ozs7QUNqSEEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSx5REFBQSxVQUFBLGFBQUEsS0FBQSxNQUFBLFFBQUE7UUFDQSxJQUFBLGVBQUEsVUFBQSxJQUFBLFFBQUEsbUJBQUEsU0FBQSxhQUFBLGVBQUEsZUFBQSxhQUFBLGVBQUEsZUFBQSxjQUFBLGdCQUFBLGdCQUFBLFNBQUEsUUFBQSxTQUFBLE9BQUEsZUFBQSxLQUFBLE1BQUEsT0FBQSxhQUFBLGdCQUFBLGVBQUEsbUJBQUEsb0JBQUEsc0JBQUEsU0FBQSxvQkFBQSxvQkFBQSxrQkFBQTtZQUNBLEtBQUEsS0FBQTtZQUNBLEtBQUEsU0FBQTtZQUNBLEtBQUEsb0JBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLGNBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxnQkFBQTtZQUNBLEtBQUEsY0FBQTtZQUNBLEtBQUEsZ0JBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxlQUFBO1lBQ0EsS0FBQSxpQkFBQTtZQUNBLEtBQUEsaUJBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLG9CQUFBLFVBQUEsT0FBQSxJQUFBLFNBQUEsZ0JBQUE7WUFDQSxLQUFBLFNBQUE7WUFDQSxLQUFBLG1CQUFBLFNBQUEsT0FBQSxJQUFBLFFBQUEsZ0JBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLG9CQUFBLFVBQUEsT0FBQSxJQUFBLFNBQUEsZ0JBQUE7WUFDQSxLQUFBLFFBQUE7WUFDQSxLQUFBLGtCQUFBLFFBQUEsT0FBQSxJQUFBLE9BQUEsZ0JBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSwwQkFBQSxnQkFBQSxPQUFBLElBQUEsZUFBQSxnQkFBQTtZQUNBLEtBQUEsTUFBQSxJQUFBLFlBQUE7WUFDQSxLQUFBLE9BQUEsS0FBQSxZQUFBO1lBQ0EsS0FBQSxRQUFBO1lBQ0EsS0FBQSxjQUFBO1lBQ0EsS0FBQSxpQkFBQTtZQUNBLEtBQUEsZ0JBQUE7WUFDQSxLQUFBLG9CQUFBO1lBQ0EsS0FBQSxxQkFBQTtZQUNBLEtBQUEsdUJBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLHFCQUFBO1lBQ0EsS0FBQSxxQkFBQTtZQUNBLEtBQUEsbUJBQUE7Ozs7UUFJQSxhQUFBLFlBQUE7WUFDQSxhQUFBLFlBQUE7Z0JBQ0EsT0FBQSxPQUFBLElBQUEsS0FBQSxlQUFBLEtBQUEsT0FBQSxJQUFBLEtBQUE7O1lBRUEsU0FBQSxZQUFBO2dCQUNBLE9BQUEsS0FBQSxJQUFBLFFBQUEsV0FBQSxzQkFBQSxLQUFBLElBQUEsUUFBQSxXQUFBLFNBQUEsc0JBQUEsWUFBQSxrQkFBQTs7Ozs7UUFLQSxhQUFBLFFBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxNQUFBO2dCQUNBLE9BQUEsSUFBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBOzs7WUFHQSxPQUFBLElBQUE7OztRQUdBLGFBQUEsY0FBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLFFBQUEsUUFBQSxPQUFBO2dCQUNBLE9BQUE7cUJBQ0EsSUFBQSxhQUFBO3FCQUNBLE9BQUE7O1lBRUEsT0FBQSxhQUFBLE1BQUE7OztRQUdBLE9BQUE7Ozs7QUN0R0EsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSxrREFBQSxVQUFBLGFBQUEsS0FBQSxNQUFBO1FBQ0EsSUFBQSxrQkFBQSxVQUFBLElBQUEsUUFBQSxtQkFBQSxTQUFBLFdBQUEsU0FBQSxRQUFBLFdBQUEsYUFBQSxlQUFBLGFBQUEsZUFBQSxjQUFBLGdCQUFBLE9BQUEsZUFBQSxLQUFBLE1BQUEsT0FBQSxhQUFBLFFBQUEsUUFBQTtZQUNBLEtBQUEsS0FBQTtZQUNBLEtBQUEsU0FBQTtZQUNBLEtBQUEsb0JBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLFNBQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLGNBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxjQUFBO1lBQ0EsS0FBQSxnQkFBQTtZQUNBLEtBQUEsZUFBQTtZQUNBLEtBQUEsaUJBQUE7WUFDQSxLQUFBLFFBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxNQUFBLElBQUEsWUFBQTtZQUNBLEtBQUEsT0FBQSxLQUFBLFlBQUE7WUFDQSxLQUFBLFFBQUE7WUFDQSxLQUFBLGNBQUE7WUFDQSxLQUFBLFNBQUE7WUFDQSxLQUFBLGFBQUEsU0FBQSxPQUFBLFFBQUEsSUFBQSxPQUFBLFFBQUEsTUFBQSxZQUFBO1lBQ0EsS0FBQSxTQUFBOzs7O1FBSUEsZ0JBQUEsWUFBQTtZQUNBLFFBQUEsU0FBQSxNQUFBO2dCQUNBLE9BQUE7Ozs7OztRQU1BLGdCQUFBLFFBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxNQUFBO2dCQUNBLE9BQUEsSUFBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBOzs7WUFHQSxPQUFBLElBQUE7OztRQUdBLGdCQUFBLGNBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxRQUFBLFFBQUEsT0FBQTtnQkFDQSxPQUFBO3FCQUNBLElBQUEsZ0JBQUE7cUJBQ0EsT0FBQTs7WUFFQSxPQUFBLGdCQUFBLE1BQUE7OztRQUdBLE9BQUE7Ozs7QUM5RUEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsUUFBQSwrQ0FBQSxVQUFBLGFBQUEsa0JBQUE7UUFDQSxJQUFBLFVBQUEsVUFBQSxJQUFBLE1BQUEsT0FBQSxTQUFBLGFBQUEsV0FBQSxpQkFBQSxXQUFBLGdCQUFBLFdBQUEsYUFBQSxtQkFBQSxjQUFBLFVBQUEsU0FBQSxXQUFBLGVBQUEsY0FBQSx5QkFBQSx3QkFBQSxXQUFBLFNBQUEsVUFBQSxRQUFBLGVBQUEsb0JBQUE7WUFDQSxLQUFBLEtBQUE7WUFDQSxLQUFBLE9BQUE7WUFDQSxLQUFBLFFBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLGNBQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLGtCQUFBO1lBQ0EsS0FBQSxZQUFBO1lBQ0EsS0FBQSxpQkFBQTtZQUNBLEtBQUEsWUFBQTtZQUNBLEtBQUEsY0FBQTtZQUNBLEtBQUEsb0JBQUE7WUFDQSxLQUFBLGVBQUE7WUFDQSxLQUFBLFdBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxlQUFBO1lBQ0EsS0FBQSwwQkFBQTtZQUNBLEtBQUEseUJBQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLFVBQUE7WUFDQSxLQUFBLFdBQUE7WUFDQSxLQUFBLFNBQUE7WUFDQSxLQUFBLGdCQUFBO1lBQ0EsS0FBQSxxQkFBQSxpQkFBQSxZQUFBOzs7O1FBSUEsUUFBQSxZQUFBO1lBQ0EsVUFBQSxZQUFBO2dCQUNBLE9BQUE7O1lBRUEsU0FBQSxZQUFBO2dCQUNBLE9BQUEsS0FBQSxZQUFBLHNCQUFBLEtBQUEsWUFBQSxTQUFBLHNCQUFBLFlBQUEsa0JBQUE7O1lBRUEsYUFBQSxZQUFBO2dCQUNBLE9BQUEsS0FBQSxZQUFBLFFBQUEsS0FBQSxZQUFBLE1BQUEsUUFBQSxZQUFBLGtCQUFBOztZQUVBLGNBQUEsWUFBQTtnQkFDQSxPQUFBLEtBQUE7Ozs7O1FBS0EsUUFBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBOzs7WUFHQSxPQUFBLElBQUE7OztRQUdBLFFBQUEsY0FBQSxVQUFBLE1BQUE7WUFDQSxJQUFBLFFBQUEsUUFBQSxPQUFBO2dCQUNBLE9BQUE7cUJBQ0EsSUFBQSxRQUFBO3FCQUNBLE9BQUE7O1lBRUEsT0FBQSxRQUFBLE1BQUE7OztRQUdBLE9BQUE7OztBQzdGQSxDQUFBLFlBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxRQUFBLDZHQUFBLFVBQUEsYUFBQSxrQkFBQSxxQkFBQSxjQUFBLGNBQUE7UUFDQSxJQUFBLGlCQUFBLFVBQUEsSUFBQSxNQUFBLFNBQUEsT0FBQSxhQUFBLFVBQUEsYUFBQSxZQUFBLFdBQUEsaUJBQUEsV0FBQSxnQkFBQSxXQUFBLFdBQUEsYUFBQSxtQkFBQSxjQUFBLFVBQUEsU0FBQSxXQUFBLGVBQUEsY0FBQSx5QkFBQSx3QkFBQSxTQUFBLFVBQUEsUUFBQSxlQUFBLG9CQUFBLGVBQUEsUUFBQSxlQUFBLGdCQUFBLGdCQUFBO1lBQ0EsS0FBQSxLQUFBO1lBQ0EsS0FBQSxPQUFBO1lBQ0EsS0FBQSxVQUFBO1lBQ0EsS0FBQSxRQUFBO1lBQ0EsS0FBQSxjQUFBO1lBQ0EsS0FBQSxXQUFBO1lBQ0EsS0FBQSxjQUFBO1lBQ0EsS0FBQSxhQUFBO1lBQ0EsS0FBQSxZQUFBO1lBQ0EsS0FBQSxrQkFBQTtZQUNBLEtBQUEsWUFBQTtZQUNBLEtBQUEsaUJBQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLFlBQUE7WUFDQSxLQUFBLGNBQUE7WUFDQSxLQUFBLG9CQUFBO1lBQ0EsS0FBQSxlQUFBO1lBQ0EsS0FBQSxXQUFBO1lBQ0EsS0FBQSxVQUFBO1lBQ0EsS0FBQSxZQUFBO1lBQ0EsS0FBQSxnQkFBQTtZQUNBLEtBQUEsZUFBQTtZQUNBLEtBQUEseUJBQUEsYUFBQSx5QkFBQTtZQUNBLEtBQUEsMEJBQUE7WUFDQSxLQUFBLG9DQUFBLGFBQUEseUJBQUE7WUFDQSxLQUFBLHlCQUFBO1lBQ0EsS0FBQSxVQUFBO1lBQ0EsS0FBQSxXQUFBO1lBQ0EsS0FBQSxTQUFBO1lBQ0EsS0FBQSxnQkFBQTtZQUNBLEtBQUEscUJBQUE7WUFDQSxLQUFBLGdCQUFBLG9CQUFBLFlBQUE7WUFDQSxLQUFBLFNBQUEsYUFBQSxZQUFBO1lBQ0EsS0FBQSxnQkFBQTtZQUNBLEtBQUEsaUJBQUE7WUFDQSxLQUFBLGlCQUFBOzs7O1FBSUEsZUFBQSxZQUFBO1lBQ0EsU0FBQSxZQUFBO2dCQUNBLE9BQUEsS0FBQSxZQUFBLHNCQUFBLEtBQUEsWUFBQSxTQUFBLHNCQUFBLFlBQUEsa0JBQUE7O1lBRUEsZ0JBQUEsWUFBQTtnQkFDQSxJQUFBLGFBQUEsRUFBQSxNQUFBLEtBQUEsZUFBQSxFQUFBLFVBQUE7b0JBQ0EsY0FBQSxFQUFBLE1BQUEsS0FBQSxnQkFBQSxFQUFBLFVBQUE7b0JBQ0EsY0FBQSxFQUFBLE1BQUEsS0FBQSxnQkFBQSxFQUFBLFVBQUE7O2dCQUVBLElBQUEsYUFBQSxFQUFBLEtBQUEsS0FBQSxlQUFBLFVBQUEsZ0JBQUEsRUFBQSxPQUFBO29CQUNBLFVBQUEsRUFBQSxJQUFBLFlBQUE7b0JBQ0EsU0FBQSxXQUFBLFNBQUEsSUFBQSxVQUFBLFdBQUEsUUFBQSxXQUFBO29CQUNBLGVBQUEsV0FBQSxJQUFBLElBQUEsTUFBQSxDQUFBLENBQUEsVUFBQSxVQUFBLEtBQUEsUUFBQTtvQkFDQSxjQUFBLEVBQUEsS0FBQSxLQUFBLGdCQUFBLFVBQUEsZ0JBQUEsRUFBQSxPQUFBO29CQUNBLFdBQUEsRUFBQSxJQUFBLGFBQUE7b0JBQ0EsVUFBQSxZQUFBLFNBQUEsSUFBQSxXQUFBLFlBQUEsUUFBQSxZQUFBO29CQUNBLGdCQUFBLFlBQUEsSUFBQSxJQUFBLE1BQUEsQ0FBQSxDQUFBLFdBQUEsV0FBQSxLQUFBLFFBQUE7b0JBQ0EsY0FBQSxFQUFBLEtBQUEsS0FBQSxnQkFBQSxVQUFBLGdCQUFBLEVBQUEsT0FBQTtvQkFDQSxXQUFBLEVBQUEsSUFBQSxhQUFBO29CQUNBLFVBQUEsWUFBQSxTQUFBLElBQUEsV0FBQSxZQUFBLFFBQUEsWUFBQTtvQkFDQSxnQkFBQSxZQUFBLElBQUEsSUFBQSxNQUFBLENBQUEsQ0FBQSxXQUFBLFdBQUEsS0FBQSxRQUFBOztnQkFFQSxPQUFBO29CQUNBLE9BQUE7d0JBQ0EsTUFBQTt3QkFDQSxRQUFBO3dCQUNBLFdBQUEsV0FBQTt3QkFDQSxPQUFBOztvQkFFQSxRQUFBO3dCQUNBLE1BQUE7d0JBQ0EsUUFBQTt3QkFDQSxXQUFBLFlBQUE7d0JBQ0EsT0FBQTs7b0JBRUEsUUFBQTt3QkFDQSxNQUFBO3dCQUNBLFFBQUE7d0JBQ0EsV0FBQSxZQUFBO3dCQUNBLE9BQUE7Ozs7WUFJQSxhQUFBLFlBQUE7Z0JBQ0EsSUFBQSxVQUFBLEVBQUEsTUFBQSxLQUFBLGVBQUEsRUFBQSxVQUFBO29CQUNBLGdCQUFBLEVBQUEsT0FBQSxFQUFBLFFBQUEsU0FBQTtvQkFDQSxXQUFBLEVBQUEsTUFBQSxLQUFBLGdCQUFBLEVBQUEsVUFBQTtvQkFDQSxpQkFBQSxFQUFBLE9BQUEsRUFBQSxRQUFBLFVBQUE7b0JBQ0EsV0FBQSxFQUFBLE1BQUEsS0FBQSxnQkFBQSxFQUFBLFVBQUE7b0JBQ0EsaUJBQUEsRUFBQSxPQUFBLEVBQUEsUUFBQSxVQUFBOztnQkFFQSxJQUFBLG1CQUFBLFVBQUEsWUFBQTtvQkFDQSxJQUFBLFlBQUE7b0JBQ0EsRUFBQSxRQUFBLFlBQUEsVUFBQSxVQUFBO3dCQUNBLEVBQUEsUUFBQSxVQUFBLFVBQUEsS0FBQTs0QkFDQSxVQUFBLEtBQUEsRUFBQSxRQUFBLElBQUEsVUFBQSxPQUFBLElBQUE7OztvQkFHQSxPQUFBOzs7Z0JBR0EsT0FBQTtvQkFDQSxPQUFBLGlCQUFBO29CQUNBLFFBQUEsaUJBQUE7b0JBQ0EsUUFBQSxpQkFBQTs7Ozs7O1FBTUEsZUFBQSxRQUFBLFVBQUEsTUFBQTtZQUNBLElBQUEsTUFBQTtnQkFDQSxPQUFBLElBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTtvQkFDQSxLQUFBO29CQUNBLEtBQUE7b0JBQ0EsS0FBQTs7O1lBR0EsT0FBQSxJQUFBOzs7UUFHQSxlQUFBLGNBQUEsVUFBQSxNQUFBO1lBQ0EsSUFBQSxR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QSxPQUFBLGNBQUEsT0FBQSxZQUFBO1lBQ0EsSUFBQSxZQUFBLE9BQUEsU0FBQSxPQUFBLFlBQUE7O1lBRUEsSUFBQSxhQUFBLGNBQUEsSUFBQTtnQkFDQSxPQUFBLGFBQUE7O1lBRUEsT0FBQTs7O1FBR0EsT0FBQTtZQUNBLGtCQUFBLFVBQUEsWUFBQSxVQUFBLFFBQUE7Z0JBQ0EsSUFBQSxnQkFBQTtvQkFDQSxJQUFBLEdBQUE7O2dCQUVBLElBQUEsU0FBQSx1QkFBQSxZQUFBLFVBQUE7Z0JBQ0EsTUFBQTtvQkFDQSxLQUFBLFlBQUEsS0FBQSxZQUFBO29CQUNBLFFBQUE7b0JBQ0EsUUFBQTttQkFDQSxRQUFBLFVBQUEsTUFBQTtvQkFDQSxjQUFBLGFBQUEsYUFBQSxZQUFBLEtBQUE7b0JBQ0EsY0FBQSxRQUFBLEtBQUE7b0JBQ0EsRUFBQSxRQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7Z0JBRUEsT0FBQSxFQUFBOztZQUVBLHdCQUFBLFVBQUEsSUFBQTtnQkFDQSxJQUFBLElBQUEsR0FBQTs7Z0JBRUEsTUFBQSxJQUFBLFlBQUEsS0FBQSxZQUFBLG9CQUFBLEtBQUEsS0FBQSxRQUFBLFVBQUEsTUFBQTtvQkFDQSxFQUFBLFFBQUEsYUFBQSxZQUFBO21CQUNBLE1BQUEsVUFBQSxPQUFBO29CQUNBLEVBQUEsT0FBQTs7Z0JBRUEsT0FBQSxFQUFBOztZQUVBLFlBQUEsU0FBQSxPQUFBO2dCQUNBLElBQUEsSUFBQSxHQUFBOztnQkFFQSxNQUFBLElBQUEsWUFBQSxLQUFBLFlBQUEsb0JBQUEsU0FBQSxVQUFBLFFBQUEsVUFBQSxNQUFBO29CQUNBLEVBQUEsUUFBQTttQkFDQSxNQUFBLFVBQUEsT0FBQTtvQkFDQSxFQUFBLE9BQUE7O2dCQUVBLE9BQUEsRUFBQTs7WUFFQSxRQUFBLFNBQUEsT0FBQTtnQkFDQSxJQUFBLE1BQUEsT0FBQSxZQUFBLEtBQUEsWUFBQSxvQkFBQSxTQUFBOzs7OztnQkFLQSxJQUFBLDBCQUFBLFVBQUE7Z0JBQ0EsSUFBQSx3QkFBQSxPQUFBLElB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QUE7UUFDQSxPQUFBLFlBQUE7UUFDQSxPQUFBLGFBQUE7UUFDQSxPQUFBLG1CQUFBO1FBQ0EsT0FBQSxpQkFBQSxPQUFBLE1BQUEsU0FBQSxHQUFBLEtBQUE7UUFDQSxPQUFBLGVBQUEsT0FBQSxNQUFBO1FBQ0EsT0FBQSxpQkFBQSxVQUFBLFFBQUE7WUFDQSxPQUFBO1lBQ0EsT0FBQSxtQkFBQTs7UUFFQSxPQUFBLG1CQUFBO1FBQ0EsT0FBQSxlQUFBLFVBQUEsUUFBQTtZQUNBLE9BQUE7WUFDQSxPQUFBLGlCQUFBOztRQUVBLE9BQUEsaUJBQUE7UUFDQSxPQUFBLG1CQUFBO1lBQ0EsVUFBQTs7UUFFQSxPQUFBLHFCQUFBO1FBQ0EsT0FBQSxpQkFBQTtRQUNBLE9BQUEsa0JBQUE7UUFDQSxPQUFBLHlCQUFBO1FBQ0EsT0FBQSxrQkFBQTtRQUNBLE9BQUEsc0JBQUE7UUFDQSxPQUFBLFVBQUE7UUFDQSxPQUFBLFNBQUE7UUFDQSxPQUFBLGFBQUE7UUFDQSxPQUFBLGVBQUE7UUFDQSxPQUFBLGVBQUE7UUFDQSxPQUFBLGVBQUE7UUFDQSxPQUFBLGdCQUFBO1FBQ0EsT0FBQSxrQkFBQTtRQUNBLE9BQUEsWUFBQTtRQUNBLE9BQUEsbUJBQUE7UUFDQSxPQUFBLFdBQUE7UUFDQSxPQUFBLFlBQUE7UUFDQSxPQUFBLFlBQUE7UUFDQSxPQUFBLGNBQUE7UUFDQSxPQUFBLGVBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O1FBb0JBLEtBQUEsb0JBQUEsVUFBQSxLQUFBO1lBQ0EsT0FBQTtnQkFDQSxNQUFBO2dCQUNBLFdBQUE7Z0JBQ0EsU0FBQSxJQUFBO2dCQUNBLE9BQUEsSUFBQTtnQkFDQSxXQUFBLElBQUE7Z0JBQ0EsUUFBQSxJQUFBO2dCQUNBLE9BQUEsSUFBQTtnQkFDQSxVQUFBLElBQUEsU0FBQTs7OztRQUlBLEtBQUEsa0JBQUEsWUFBQTtZQUNBLE9BQUEsaUJBQUEsT0FBQSxNQUFBLFNBQUEsR0FBQSxLQUFBO1lBQ0EsT0FBQSxlQUFBLE9BQUEsTUFBQTtZQUNBLE9BQUEsbUJBQUE7WUFDQSxPQUFBOzs7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QSxPQUFBLGdCQUFBO21CQUNBO2dCQUNBLE9BQUEsZ0JBQUE7Ozs7UUFJQSxLQUFBLGFBQUEsWUFBQTtZQUNBLFdBQUEsZUFBQTtZQUNBLEtBQUE7Ozs7Ozs7Ozs7Ozs7O1FBY0EsS0FBQSxlQUFBLFlBQUE7WUFDQSxlQUFBLGVBQUEsS0FBQSxVQUFBLFFBQUE7Z0JBQ0EsT0FBQSxxQkFBQSxPQUFBO2VBQ0EsTUFBQSxVQUFBLE9BQUE7Z0JBQ0EsUUFBQSxJQUFBO2dCQUNBLE9BQUEsU0FBQTs7OztRQUlBLEtBQUEsY0FBQSxVQUFBLElBQUE7WUFDQSxlQUFBLG1CQUFBLElBQUEsS0FBQSxVQUFBLFFBQUE7Z0JBQ0EsT0FBQSxtQ0FBQSxPQUFBO2VBQ0EsTUFBQSxVQUFBLE9BQUE7Z0JBQ0EsUUFBQSxJQUFBOzs7O1FBSUEsS0FBQSxxQkFBQSxVQUFBLFVBQUE7WUFDQSxlQUFBLG1CQUFBLFNBQUEsTUFBQSxLQUFBLFVBQUEsUUFBQTtnQkFDQSxPQUFBLDBCQUFBO2dCQUNBLEVBQUEsUUFBQSxPQUFBLFNBQUEsVUFBQSxRQUFBO29CQUNBLE9BQUEscUJBQUEsT0FBQSxtQkFBQSxXQUFBLElBQUEsRUFBQSxXQUFBLE9BQUEsU0FBQSxPQUFBLHFCQUFBLE9BQUEsRUFBQSxXQUFBLE9BQUE7O2dCQUVBLE9BQUEsa0JBQUEsRUFBQSxZQUFBLE9BQUEsU0FBQSxDQUFBLFFBQUEsWUFBQSxDQUFBLE1BQUE7O2dCQUVBLElBQUEseUJBQUE7Z0JBQ0EsRUFBQSxRQUFBLE9BQUEsaUJBQUEsVUFBQSxRQUFBO29CQUNBLHVCQUFBLEtBQUE7d0JBQ0EsT0FBQSxPQUFBLFVBQUEsT0FBQSxRQUFBLE1BQUEsT0FBQSxVQUFBLE9BQUE7d0JBQ0EsT0FBQSxPQUFBLFVBQUEsT0FBQSxRQUFBLE1BQUEsT0FBQSxVQUFBLE9BQUE7d0JBQ0EsT0FBQSxPQUFBOzs7Z0JBR0EsT0FBQSx5QkFBQTtnQkFDQSxPQUFBLFVBQUEsRUFBQSxZQUFBLE9BQUEsU0FBQSxDQUFBLFVBQUEsQ0FBQTtnQkFDQSxPQUFBLFNBQUEsT0FBQTs7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QSxRQUFBLElBQUE7ZUFDQSxRQUFBLFlBQUE7Z0JBQ0EsT0FBQSxzQkFBQTs7OztRQUlBLEtBQUEsYUFBQSxZQUFBO1lBQ0EsV0FBQSxlQUFBO1lBQ0EsV0FBQSxPQUFBLFlBQUE7O1lBRUEsS0FBQSxnQkFBQSxPQUFBOzs7OztRQUtBLE9BQUEsWUFBQSxVQUFBLEtBQUE7WUFDQSxFQUFBLE1BQUEsT0FBQSxXQUFBO1lBQ0EsT0FBQSxZQUFBO1lBQ0EsRUFBQSxNQUFBLE9BQUEsV0FBQTs7O1FBR0EsS0FBQTs7OztBQzlDQSxDQUFBLFVBQUE7SUFDQTs7SUFFQSxRQUFBLE9BQUEsWUFBQSxXQUFBLHNMQUFBLFNBQUEsUUFBQSxNQUFBLFdBQUEsY0FBQSxXQUFBLFlBQUEsZUFBQSxZQUFBLGVBQUEsZ0JBQUEsYUFBQTs7UUFFQSxPQUFBLE9BQUEsSUFBQTtRQUNBLE9BQUEsVUFBQTtRQUNBLE9BQUEsZUFBQSxTQUFBLGFBQUE7O1FBRUEsT0FBQSxnQkFBQTs7UUFFQSxPQUFBLGNBQUEsWUFBQSxZQUFBO1FBQ0EsY0FBQSxlQUFBOztRQUVBLE9BQUEsUUFBQSxDQUFBLFNBQUEsU0FBQTtRQUNBLE9BQUEsb0JBQUE7UUFDQSxPQUFBLFdBQUE7O1FBRUEsSUFBQSxjQUFBLFlBQUE7WUFDQSxlQUFBLGtCQUFBLEtBQUEsVUFBQSxNQUFBO2dCQUNBLE9BQUEsZ0JBQUE7ZUFDQSxNQUFBLFVBQUEsT0FBQTtnQkFDQSxRQUFBLElBQUE7ZUFDQSxRQUFBLFlBQUE7Z0JBQ0EsT0FBQSxVQUFBOzs7O1FBSUEsT0FBQSxhQUFBLFVBQUEsTUFBQTtXQUNBLElBQUEsZ0JBQUEsVUFBQSxLQUFBO2FBQ0EsV0FBQSxPQUFBO2FBQ0EsYUFBQTthQUNBLE9BQUE7YUFDQSxNQUFBOzs7V0FHQSxjQUFBLE9BQUEsS0FBQSxZQUFBO2FBQ0EsT0FBQSxXQUFBLE9BQUE7Y0FDQSxZQUFBOzs7OztTQUtBLE9BQUEsYUFBQSxTQUFBLGdCQUFBO2FBQ0EsT0FBQSxXQUFBLFdBQUEsV0FBQTthQUNBLE9BQUE7OztTQUdBLE9BQUEsYUFB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QSxJQUFBLFVBQUE7O29CQUVBLFFBQUEsY0FBQSxJQUFBLE9BQUEsK0NBQUEsSUFBQSxPQUFBLDZCQUFBLElBQUEsU0FBQSxZQUFBLE1BQUEsSUFBQSxPQUFBOzs7Ozs7OztnQkFRQSxRQUFBOztnQkFFQSxRQUFBO2dCQUNBLE1BQUEsUUFBQSxJQUFBLE1BQUE7b0JBQ0EsV0FBQTtvQkFDQSxPQUFBO29CQUNBLElBQUE7b0JBQ0EsSUFBQTtvQkFDQSxTQUFBO29CQUNBLE9BQUE7OztnQkFHQSxLQUFBLElBQUEsS0FBQSxJQUFBLGNBQUE7b0JBQ0EsSUFBQSxNQUFBLElBQUEsYUFBQTs7b0JBRUEsSUFBQSxJQUFBLE1BQUE7d0JBQ0EsTUFBQSxRQUFBLElBQUEsTUFBQSxJQUFBLE1BQUE7Ozs0QkFHQSxPQUFBOzs7d0JBR0EsSUFBQSxZQUFBLElBQUEsT0FBQTs0QkFDQSxZQUFBLElBQUEsU0FBQTsrQkFDQTs0QkFDQSxZQUFBLElBQUEsUUFBQTs7Ozs7OztZQU9BLE1BQUEsUUFBQSxTQUFBO2dCQUNBLFdBQUE7Z0JBQ0EsT0FBQTtnQkFDQSxJQUFBO2dCQUNBLElBQUE7Z0JBQ0EsU0FBQTs7WUFFQSxXQUFBO2dCQUNBLE1BQUE7Z0JBQ0EsVUFBQTtvQkFDQSxPQUFBOztnQkFFQSxZQUFBLE9BQUEsV0FBQTs7WUFFQSxJQUFBLFNBQUEsRUFBQSxPQUFBLE1BQUEsWUFBQTtZQUNBLEtBQUEsSUFBQSxLQUFBLFFBQUE7Z0JBQ0EsTUFBQSxRQUFBLFNBQUEsT0FBQSxHQUFBLE1BQUE7b0JBQ0EsT0FBQTs7Ozs7WUFLQSxNQUFBLFFBQUEsT0FBQTtnQkFDQSxXQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsSUFBQTtnQkFDQSxJQUFBO2dCQUNBLFNBQUE7O1lBRUEsSUFBQSxZQUFBLEVBQUEsT0FBQSxNQUFBLFVBQUEsS0FBQTtnQkFDQSxPQUFBLENBQUEsWUFBQSxJQUFBOztZQUVBLEtBQUEsSUFBQSxLQUFBLFlBQUE7Z0JBQ0EsTUFBQSxRQUFBLFdBQUEsR0FBQSxNQUFBLE9BQUE7b0JBQ0EsT0FBQTs7Ozs7WUFLQSxFQUFBLE1BQUEsWUFBQTtnQkFDQSxNQUFBLEtBQUEsUUFBQTs7O2dCQUdBLElBQUEsWUFBQSxLQUFBO2dCQUNBLElBQUEsYUFBQSxNQUFBLFFBQUEsUUFBQTtnQkFDQSxJQUFBLGNBQUEsTUFBQSxRQUFBLFNBQUE7Z0JBQ0EsSUFBQSxRQUFBLFNBQUEsSUFBQSxNQUFBLFNBQUEsUUFBQSxNQUFBO2dCQUNBLElBQUEsU0FBQSxTQUFBLElBQUEsTUFBQSxVQUFBLFFBQUEsTUFBQTs7Ozs7Z0JBS0EsWUFBQTtnQkFDQSxHQUFBLFlBQUEsRUFBQTs7b0JBRUEsSUFBQSxZQUFBLENBQUEsRUFBQTtvQkFDQSxLQUFBLFVBQUE7b0JBQ0EsS0FBQSxNQUFBO29CQUNBLEtBQUEsTUFBQSxXQUFBLElBQUEsYUFBQSxTQUFBLE9BQUEsR0FBQSxPQUFBOzs7O2dCQUlBLEdBQUEsT0FBQSxZQUFBO29CQUNBLEVBQUEsTUFBQSxPQUFBLFlBQUEsTUFBQSxTQUFBOzs7OztRQUtBLElBQUEsZ0JBQUEsVUFBQSxLQUFBLFlBQUE7WUFDQSxJQUFBLFVBQUE7O1lBRUEsRUFBQSxRQUFBLE9BQUEsV0FBQSxXQUFBLE1BQUEsVUFBQSxLQUFBLEtBQUE7Z0JBQ0EsSUFBQSxJQUFBLFNBQUEsTUFBQTtvQkFDQSxFQUFBLFFBQUEsSUFBQSxjQUFBLFVBQUEsWUFBQSxLQUFBO3dCQUNBLElBQUEsV0FBQSxTQUFBLE1BQUE7NEJBQ0EsRUFBQSxRQUFBLFdBQUEsYUFBQSxVQUFBLE1BQUEsS0FBQTtnQ0FDQSxJQUFBLEtBQUEsV0FBQSxZQUFBO29DQUNBLFFBQUEsS0FBQTt3Q0FDQSxNQUFBLElBQUE7d0NBQ0EsUUFBQSxLQUFBO3dDQUNBLE9BQUEsS0FBQTs7Ozs7Ozs7WUFRQSxPQUFBOzs7UUFHQTs7UUFFQSxVQUFBLDZCQUFBLFlBQUE7UUFDQTs7OztRQUlBLE9BQUE7WUFDQSxZQUFBO1lBQ0EsYUFBQTtZQUNBLFVBQUE7WUFDQSxPQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsUUFBQTtnQkFDQSxZQUFBO2dCQUNBLFdBQUE7Z0JBQ0Es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QUFBLHlCQUFBOztJQUVBLElBQUEsU0FBQTtFQUNBLE1BQUE7RUFDQSxRQUFBO0VBQ0EsU0FBQTtFQUNBLE9BQUE7O0lBRUEsSUFBQSxrQkFBQSxHQUFBLEtBQUEsSUFBQSxPQUFBLElBQUEsT0FBQSxDQUFBO0lBQ0EsSUFBQSxnQkFBQSxHQUFBLEtBQUEsS0FBQSxPQUFBLElBQUEsT0FBQSxDQUFBO0lBQ0EsSUFBQSxpQkFBQTtJQUNBLElBQUEsWUFBQTtJQUNBLElBQUEsYUFBQTtJQUNBLElBQUEsU0FBQSxTQUFBLEtBQUEsZUFBQSxPQUFBLE1BQUEsT0FBQSxPQUFBO0lBQ0EsSUFBQSxRQUFBLFNBQUEsS0FBQSxjQUFBLE9BQUEsUUFBQSxPQUFBLEtBQUE7Q0FDQSxJQUFBLFdBQUE7Q0FDQSxJQUFBLFFBQUE7Q0FDQSxJQUFBLFFBQUE7O0lBRUEsSUFBQSxhQUFBOztJQUVBLElBQUEsY0FBQSxTQUFBLEdBQUE7RUFDQSxPQUFBLEVBQUEsU0FBQSxFQUFBLFdBQUEsRUFBQTs7O0lBR0EsSUFBQSxnQkFBQSxTQUFBLEdBQUE7RUFDQSxPQUFBLGVBQUEsRUFBQSxFQUFBLFVBQUEsTUFBQSxFQUFBLEVBQUEsWUFBQTs7O0lBR0EsSUFBQSxJQUFBLEdBQUEsS0FBQSxRQUFBLE9BQUEsRUFBQSxpQkFBQSxpQkFBQSxNQUFBLEVBQUEsR0FBQSxTQUFBLE1BQUE7O0lBRUEsSUFBQSxJQUFBLEdBQUEsTUFBQSxVQUFBLE9BQUEsV0FBQSxnQkFBQSxFQUFBLEdBQUEsU0FBQSxPQUFBLE1BQUEsT0FBQSxVQUFBOztJQUVBLElBQUEsUUFBQSxHQUFBLElBQUEsT0FBQSxNQUFBLEdBQUEsT0FBQSxVQUFBLFdBQUEsR0FBQSxLQUFBLE9BQUEsYUFBQSxjQUFBO01BQ0EsU0FBQSxHQUFBLFlBQUE7O0lBRUEsSUFBQSxRQUFBLEdBQUEsSUFBQSxPQUFBLE1BQUEsR0FBQSxPQUFBLFFBQUEsU0FBQTs7SUFFQSxJQUFBLGlCQUFBLFNBQUEsT0FBQTtDQUNBLElBQUEsbUJBQUEsc0JBQUE7S0FDQSxJQUFBLFVBQUEsYUFBQSxNQUFBLFNBQUEsR0FBQTtFQUNBLGtCQUFBLEdBQUEsS0FBQSxJQUFBLE9BQUEsSUFBQSxRQUFBLENBQUE7RUFDQSxnQkFBQSxHQUFBLEtBQUEsS0FBQSxPQUFBLElBQUEsUUFBQSxDQUFBO0VBQ0E7O0tBRUEsTUFBQSxLQUFBLFNBQUEsR0FBQSxHQUFBO0VBQ0EsT0FBQSxFQUFBLFNBQUEsRUFBQTs7S0FFQSxnQkFBQSxNQUFBLE1BQUEsU0FBQSxHQUFBO0tBQ0EsTUFBQSxLQUFBLFNBQUEsR0FBQSxHQUFBO0VBQ0EsT0FBQSxFQUFBLFNBQUEsRUFBQTs7S0FFQSxrQkFBQSxNQUFBLEdBQUE7Ozs7SUFJQSxJQUFBLFdBQUEsV0FBQTtDQUNBLElBQUEsR0FBQSxLQUFBLFFBQUEsT0FBQSxFQUFBLGlCQUFBLGlCQUFBLE1BQUEsRUFBQSxHQUFBLFNBQUEsTUFBQTtDQUNBLElBQUEsR0FBQSxNQUFBLFVBQUEsT0FBQSxXQUFBLGdCQUFBLEVBQUEsR0FBQSxTQUFBLE9BQUEsTUFBQSxPQUFBLFVBQUE7Q0FDQSxRQUFBLEdBQUEsSUFBQSxPQUFBLE1BQUEsR0FBQSxPQUFBLFVBQUEsTUFBQSxLQUFBLEtBQUEsTUFBQSxNQUFBLFdBQUEsR0FBQSxLQUFBLE9BQUEsYUFBQSxjQUFBO0dBQ0EsU0FBQSxHQUFBLFlBQUE7O0NBRUEsUUFBQSxHQUFBLElBQUEsT0FBQSxNQUFBLEdBQUEsT0FBQSxRQUFBLFNBQUE7OztJQUdBLFNBQUEsTUFBQSxPQUFBOztDQUVBLGVBQUE7Q0FDQTs7Q0FFQSxJQUFBLE1BQUEsR0FBQSxPQUFBO0VBQ0EsT0FBQTtFQUNBLEtBQUEsU0FBQTtFQUNBLEtBQUEsU0FBQSxRQUFBLE9BQUEsT0FBQSxPQUFBO0VBQ0EsS0FBQSxVQUFBLFNBQUEsT0FBQSxNQUFBLE9BQUE7RUFDQSxPQUFBO1NBQ0EsS0FBQSxTQUFBO0VBQ0EsS0FBQSxTQUFBLFFBQUEsT0FBQSxPQUFBLE9BQUE7RUFDQSxLQUFBLFVBQUEsU0FBQSxPQUFBLE1BQUEsT0FBQTtFQUNBLEtBQUEsYUFBQSxlQUFBLE9BQUEsT0FBQSxPQUFBLE9BQUEsTUFBQTs7TUFFQSxJQUFBLFVBQUE7R0FDQSxLQUFBLE9BQUEsYUFBQTtHQUNBLE9BQUE7R0FDQSxLQUFBLE1BQUE7VUFDQSxLQUFBLE1BQUE7R0FDQSxLQUFBLFNBQUEsU0FBQSxFQUFBO01BQ0EsR0FBQSxXQUFBLEVBQUEsV0FBQSxLQUFBLEVBQUEsT0FBQTtNQUNBLE9BQUEsV0FBQSxFQUFBOztHQUVBLEtBQUEsS0FBQTtHQUNBLEtBQUEsYUFBQTtHQUNBLEtBQUEsVUFBQSxTQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUE7R0FDQSxLQUFBLFNBQUEsU0FBQSxHQUFBO01BQ0EsUUFBQSxFQUFBLEVBQUEsVUFBQSxFQUFBLEVBQUE7Ozs7RUFJQSxJQUFBLE9BQUE7R0FDQSxLQUFBLFNBQUE7R0FDQSxLQUFBLGFBQUEsbUJBQUEsU0FBQSxPQUFBLE1BQUEsT0FBQSxVQUFBO0dBQ0E7R0FDQSxLQUFBOztFQUVBLElBQUEsT0FBQSxLQUFBLEtBQUEsU0FBQSxVQUFBLGFBQUEsS0FBQTs7RUFFQSxPQUFBOztLQUVBOztJQUVBLE1BQUEsU0FBQSxTQUFBLE9BQUE7UUFDQSxRQUFBLElBQUE7Q0FDQSxlQUFBO0NBQ0E7O1FBRUEsSUFBQSxNQUFBLEdBQUEsT0FBQTs7UUFFQSxJQUFBLGtCQUFBLElBQUEsT0FBQTtRQUNBLElBQUEsT0FBQSxnQkFBQSxVQUFBLFFBQUEsS0FBQSxPQUFBOztRQUVBLEtBQUE7VUFDQSxPQUFBLE9BQUE7VUFDQSxLQUFBLE1BQUE7VUFDQSxLQUFBLE1BQUE7R0FDQSxLQUFBLFNBQUEsU0FBQSxFQUFBO01BQ0EsR0FBQSxXQUFBLEVBQUEsV0FBQSxLQUFBLEVBQUEsT0FBQTtNQUNBLE9BQUEsV0FBQSxFQUFBOztHQUVBO0dBQ0EsS0FBQSxLQUFBO0dBQ0EsS0FBQSxhQUFBO0dBQ0EsS0FBQSxVQUFBLFNBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQTtJQUNBLEtBQUEsU0FBQSxTQUFBLEdBQUE7TUFDQSxRQUFBLEVBQUEsRUFBQSxVQUFBLEVBQUEsRUFBQTs7O1FBR0EsS0FBQTtXQUNBLEtBQUEsYUFBQTtHQUNBLEtBQUEsVUFBQSxTQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUE7R0FDQSxLQUFBLFNBQUEsU0FBQSxHQUFBO01BQ0EsUUFBQSxFQUFBLEVBQUEsVUFBQSxFQUFBLEVBQUE7OztDQUdBLEtBQUEsT0FBQTs7Q0FFQSxJQUFBLE9BQUEsTUFBQSxhQUFBLEtBQUE7Q0FDQSxJQUFBLE9BQUEsTUFBQSxhQUFBLEtBQUE7O0NBRUEsT0FBQTs7O0lBR0EsTUFBQSxTQUFBLFNBQUEsT0FBQTtDQUNBLElBQUEsQ0FBQSxVQUFBO0tBQ0EsT0FBQTtDQUNBLFNBQUE7Q0FDQSxPQUFBOzs7SUFHQSxNQUFBLGFBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxDQUFBLFVBQUE7S0FDQSxPQUFBLEVBQUEsaUJBQUE7Q0FDQSxrQkFBQSxDQUFBLE1BQUEsSUFBQSxnQkFBQSxDQUFBLE1BQUE7Q0FDQSxPQUFBOzs7Ozs7OztJQVFBLE1BQUEsaUJBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxDQUFBLFVBQUE7S0FDQSxPQUFBO1FBQ0EsaUJBQUE7UUFDQSxPQUFBOzs7O0lBSUEsTUFBQSxZQUFBLFNBQUEsT0FBQTtDQUNBLElBQUEsQ0FBQSxVQUFBO0tBQ0EsT0FBQTtDQUNBLFlBQUE7Q0FDQSxPQUFBOzs7SUFHQSxNQUFBLGFBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxDQUFBLFVBQUE7S0FDQSxPQUFBO0NBQ0EsYUFBQTtDQUNBLE9BQUE7OztDQUdBLE1BQUEsUUFBQSxTQUFBLE1BQUE7RUFDQSxHQUFBLENBQUEsVUFBQSxPQUFBO0dBQ0EsT0FBQTs7RUFFQSxRQUFBO0VBQ0EsT0FBQTs7O0NBR0EsTUFBQSxRQUFBLFNBQUEsTUFBQTtFQUNBLEdBQUEsQ0FBQSxVQUFBLE9BQUE7R0FDQSxPQUFBOztFQUVBLFFBQUE7RUFDQSxPQUFBOzs7SUFHQSxNQUFBLFFBQUEsU0FBQSxPQUFBO0NBQ0EsSUFBQSxDQUFBLFVBQUE7S0FDQSxPQUFBO0NBQ0EsUUFBQSxDQUFBO0NBQ0EsT0FBQTs7O0lBR0EsTUFBQSxTQUFBLFNBQUEsT0FBQTtDQUNBLElBQUEsQ0FBQSxVQUFBO0tBQ0EsT0FBQTtDQUNBLFNBQUEsQ0FBQTtDQUNBLE9BQUE7OztJQUdBLE1BQUEsYUFBQSxTQUFBLE9BQUE7Q0FDQSxJQUFBLENBQUEsVUFBQTtLQUNBLE9BQUE7Q0FDQSxhQUFBO0NBQ0EsT0FBQTs7O0NBR0EsTUFBQSxXQUFBLFNBQUEsT0FBQTtFQUNBLEdBQUEsQ0FBQSxVQUFBLE9BQUE7R0FDQSxPQUFBOztFQUVBLFdBQUE7RUFDQSxPQUFBOzs7OztJQUtBLE9BQUE7OztBQ2hRQSxTQUFBLE1BQUEsaUJBQUE7QUFDQTtJQUNBLEtBQUEsa0JBQUE7O0lBRUEsSUFBQSxPQUFBOztJQUVBLEtBQUEsWUFBQSxTQUFBO0lBQ0E7UUFDQSxLQUFBLFNBQUE7O1FBRUEsS0FBQSxPQUFBLE9BQUEsS0FBQSxPQUFBLE9BQUE7O1FBRUEsS0FBQSxPQUFBLFNBQUEsS0FBQSxPQUFBLE9BQUEsT0FBQTtRQUNBLEtBQUEsT0FBQSxLQUFBLEtBQUEsT0FBQSxPQUFBO1FBQ0EsS0FBQSxPQUFBLEtBQUEsS0FBQSxPQUFBLE9BQUE7O1FBRUEsS0FBQSxPQUFBLE1BQUEsYUFBQSxjQUFBLE1BQUEsY0FBQSxNQUFBO1FBQ0EsS0FBQSxPQUFBLE1BQUEsYUFBQSxjQUFBLE1BQUEsY0FBQSxNQUFBO1FBQ0EsS0FBQSxPQUFBLFFBQUEsS0FBQSxPQUFBLE1BQUEsS0FBQSxPQUFBOztRQUVBLEtBQUEsT0FBQSxhQUFBLGNBQUEsY0FBQTtRQUNBLEtBQUEsT0FBQSxhQUFBLGNBQUEsY0FBQTs7UUFFQSxLQUFBLE9BQUEsY0FBQSxjQUFBLGNBQUE7UUFDQSxLQUFBLE9BQUEsY0FBQSxjQUFBLGVBQUE7UUFDQSxLQUFBLE9BQUEsWUFBQSxjQUFBLFlBQUE7O1FBRUEsS0FBQSxPQUFBLHFCQUFBLGNBQUEsc0JBQUE7OztJQUdBLEtBQUEsU0FBQTtJQUNBO1FBQ0EsS0FBQSxPQUFBLEdBQUEsT0FBQSxNQUFBLEtBQUE7YUFDQSxPQUFBO2FBQ0EsS0FBQSxTQUFBO2FBQ0EsS0FBQSxTQUFBLEtBQUEsT0FBQTthQUNBLEtBQUEsVUFBQSxLQUFBLE9BQUE7O1FBRUEsS0FBQSxLQUFBLE9BQUE7YUFDQSxLQUFBLFNBQUE7YUFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxNQUFBLEtBQUEsT0FBQTthQUNBLEtBQUEsS0FBQSxLQUFBLE9BQUEsU0FBQTthQUNBLE1BQUEsUUFBQTs7OztRQUlBLEtBQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxNQUFBLEtBQUEsT0FBQTthQUNBLEtBQUEsTUFBQSxLQUFBLE9BQUE7YUFDQSxLQUFBLEtBQUEsTUFBQSxLQUFBLE9BQUE7YUFDQSxNQUFBLFFBQUE7YUFDQSxNQUFBLFVBQUE7YUFDQSxNQUFBLGdCQUFBOztRQUVBLEtBQUEsSUFBQSxZQUFBLEtBQUEsT0FBQTtRQUNBO1lBQ0EsS0FBQSxTQUFBLEtBQUEsT0FBQSxXQUFBLFVBQUEsTUFBQSxLQUFBLE9BQUEsV0FBQSxVQUFBLElBQUEsS0FBQSxPQUFBOzs7UUFHQSxLQUFBLElBQUEsYUFBQSxLQUFBLE9BQUE7UUFDQTtZQUNBLEtBQUEsU0FBQSxLQUFBLE9BQUEsWUFBQSxXQUFBLE1BQUEsS0FBQSxPQUFBLFlBQUEsV0FBQSxJQUFBLEtBQUEsT0FBQTs7O1FBR0EsS0FBQSxJQUFBLFVBQUEsS0FBQSxPQUFBO1FBQ0E7WUFDQSxLQUFBLFNBQUEsS0FBQSxPQUFBLFNBQUEsUUFBQSxNQUFBLEtBQUEsT0FBQSxTQUFBLFFBQUEsSUFBQSxLQUFBLE9BQUE7OztRQUdBLElBQUEsV0FBQTs7UUFFQSxJQUFBLGFBQUEsS0FBQSxPQUFBO1FBQ0E7WUFDQSxXQUFBLEtBQUEsTUFBQSxLQUFBLE9BQUEsT0FBQTtZQUNBLEtBQUEsS0FBQSxPQUFBO2lCQUNBLEtBQUEsS0FBQSxLQUFBLE9BQUE7aUJBQ0EsS0FBQSxLQUFBLEtBQUEsT0FBQSxLQUFBLElBQUEsV0FBQTtpQkFDQSxLQUFBLE1BQUEsV0FBQTtpQkFDQSxLQUFBLGVBQUE7aUJBQ0EsS0FBQSxLQUFBLE9BQUE7aUJBQ0EsTUFBQSxhQUFBLFdBQUE7aUJBQ0EsTUFBQSxRQUFBO2lCQUNBLE1BQUEsZ0JBQUE7OztRQUdBLFdBQUEsS0FBQSxNQUFBLEtBQUEsT0FBQSxPQUFBO1FBQ0EsSUFBQSxhQUFBLEtBQUEsT0FBQSxTQUFBLEtBQUEsT0FBQSxhQUFBO1FBQ0EsS0FBQSxJQUFBLFFBQUEsS0FBQSxPQUFBLEtBQUEsU0FBQSxLQUFBLE9BQUEsS0FBQSxTQUFBO1FBQ0E7WUFDQSxJQUFBLGFBQUEsYUFBQSxLQUFBLE9BQUE7Z0JBQ0EsU0FBQTtnQkFDQSxTQUFBO1lBQ0EsS0FBQSxJQUFBLFFBQUEsUUFBQSxZQUFBLFFBQUEsS0FBQSxJQUFBLFFBQUEsWUFBQSxLQUFBLE9BQUEsTUFBQSxTQUFBO1lBQ0E7Z0JBQ0EsU0FBQSxLQUFBLGFBQUEsT0FBQTtnQkFDQSxTQUFBLEtBQUEsYUFBQSxPQUFBOztnQkFFQSxLQUFBLEtBQUEsT0FBQTtxQkFDQSxLQUFBLE1BQUEsT0FBQTtxQkFDQSxLQUFBLE1BQUEsT0FBQTtxQkFDQSxLQUFBLE1BQUEsT0FBQTtxQkFDQSxLQUFBLE1BQUEsT0FBQTtxQkFDQSxNQUFBLFVBQUE7cUJBQ0EsTUFBQSxnQkFBQTs7O1lBR0EsU0FBQSxLQUFBLGFBQUEsT0FBQTtZQUNBLFNBQUEsS0FBQSxhQUFBLE9BQUE7O1lBRUEsS0FBQSxLQUFBLE9BQUE7aUJBQ0EsS0FBQSxNQUFBLE9BQUE7aUJBQ0EsS0FBQSxNQUFBLE9BQUE7aUJBQ0EsS0FBQSxNQUFBLE9BQUE7aUJBQ0EsS0FBQSxNQUFBLE9BQUE7aUJBQ0EsTUFBQSxVQUFBO2lCQUNBLE1BQUEsZ0JBQUE7O1lBRUEsSUFBQSxTQUFBLEtBQUEsT0FBQSxPQUFBLFNBQUEsS0FBQSxPQUFBO1lBQ0E7Z0JBQ0EsSUFBQSxRQUFBLEtBQUEsYUFBQSxPQUFBOztnQkFFQSxLQUFBLEtBQUEsT0FBQTtxQkFDQSxLQUFBLEtBQUEsTUFBQTtxQkFDQSxLQUFBLEtBQUEsTUFBQTtxQkFDQSxLQUFBLE1BQUEsV0FBQTtxQkFDQSxLQUFBLGVBQUEsU0FBQSxLQUFBLE9BQUEsTUFBQSxVQUFBO3FCQUNBLEtBQUE7cUJBQ0EsTUFBQSxhQUFBLFdBQUE7cUJBQ0EsTUFBQSxRQUFBO3FCQUNBLE1BQUEsZ0JBQUE7Ozs7UUFJQSxJQUFBLG1CQUFBLEtBQUEsS0FBQSxPQUFBLFNBQUEsS0FBQSxTQUFBOztRQUVBLElBQUEsV0FBQSxDQUFBLEtBQUEsT0FBQSxNQUFBLEtBQUEsT0FBQSxPQUFBOztRQUVBLElBQUEsY0FBQSxLQUFBLGlCQUFBOztRQUVBLElBQUEsY0FBQSxHQUFBLElBQUE7YUFDQSxFQUFBLFNBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQTthQUNBLEVBQUEsU0FBQSxHQUFBLEVBQUEsT0FBQSxFQUFBO2FBQ0EsWUFBQTs7UUFFQSxpQkFBQSxVQUFBO2FBQ0EsS0FBQSxDQUFBO2FBQ0E7YUFDQSxPQUFBO2FBQ0EsS0FBQSxLQUFBO2FBQ0EsTUFBQSxRQUFBOztRQUVBLGlCQUFBLE9BQUE7YUFDQSxLQUFBLE1BQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxNQUFBLEtBQUEsT0FBQTthQUNBLEtBQUEsS0FBQSxPQUFBLEtBQUEsT0FBQTthQUNBLE1BQUEsUUFBQTs7UUFFQSxXQUFBLEtBQUEsTUFBQSxLQUFBLE9BQUEsT0FBQTtRQUNBLGlCQUFBLFVBQUE7YUFDQSxLQUFBLENBQUE7YUFDQTthQUNBLE9BQUE7YUFDQSxLQUFBLEtBQUEsS0FBQSxPQUFBO2FBQ0EsS0FBQSxLQUFBLEtBQUEsT0FBQSxPQUFBLEtBQUEsT0FBQSxLQUFBLElBQUE7YUFDQSxLQUFBLE1BQUEsV0FBQTthQUNBLEtBQUEsZUFBQTthQUNBLE1BQUEsYUFBQSxXQUFBO2FBQ0EsTUFBQSxRQUFBO2FBQ0EsTUFBQSxnQkFBQTs7UUFFQSxLQUFBLE9BQUEsS0FBQSxPQUFBLEtBQUE7OztJQUdBLEtBQUEsbUJBQUEsU0FBQTtJQUNBO1FBQ0EsSUFBQSxRQUFBLEtBQUEsT0FBQSxRQUFBOztRQUVBLElBQUEsT0FBQSxhQUFBLE9BQUE7UUFDQSxJQUFBLFFBQUEsYUFBQSxRQUFBLE9BQUE7UUFDQSxJQUFBLFFBQUEsYUFBQSxRQUFBLE9BQUE7O1FBRUEsSUFBQSxZQUFBLFNBQUEsS0FBQSxPQUFBLFNBQUEsR0FBQSxJQUFBLFFBQUE7UUFDQSxJQUFBLE9BQUEsYUFBQSxXQUFBO1FBQ0EsSUFBQSxRQUFBLGFBQUEsWUFBQSxPQUFBO1FBQ0EsSUFBQSxRQUFBLGFBQUEsWUFBQSxPQUFBOztRQUVBLE9BQUEsQ0FBQSxNQUFBLE9BQUEsT0FBQSxNQUFBLE9BQUEsT0FBQTs7UUFFQSxTQUFBLGFBQUEsT0FBQTtRQUNBO1lBQ0EsSUFBQSxRQUFBLEtBQUEsYUFBQSxPQUFBO1lBQ0EsTUFBQSxLQUFBLEtBQUEsT0FBQTtZQUNBLE1BQUEsS0FBQSxLQUFBLE9BQUE7WUFDQSxPQUFBOzs7O0lBSUEsS0FBQSxXQUFBLFNBQUEsT0FBQSxLQUFBO0lBQ0E7UUFDQSxJQUFBLEtBQUEsTUFBQSxPQUFBOztRQUVBLEtBQUEsS0FBQSxPQUFBO2FBQ0EsTUFBQSxRQUFBO2FBQ0EsS0FBQSxLQUFBLEdBQUEsSUFBQTtpQkFDQSxXQUFBLEtBQUEsZUFBQTtpQkFDQSxTQUFBLEtBQUEsZUFBQTtpQkFDQSxZQUFBLE9BQUEsS0FBQSxPQUFBO2lCQUNBLFlBQUEsT0FBQSxLQUFBLE9BQUE7YUFDQSxLQUFBLGFBQUEsV0FBQSxFQUFBLE9BQUEsZUFBQSxLQUFBLE9BQUEsS0FBQSxPQUFBLEtBQUEsT0FBQSxLQUFBOzs7SUFHQSxLQUFBLFNBQUEsU0FBQSxPQUFBO0lBQ0E7UUFDQSxJQUFBLG1CQUFBLEtBQUEsS0FBQSxPQUFBOztRQUVBLGlCQUFBLFVBQUEsUUFBQSxLQUFBLEtBQUEsTUFBQTs7UUFFQSxJQUFBLFVBQUEsaUJBQUEsVUFBQTtRQUNBLFFBQUE7YUFDQSxTQUFBLGFBQUEscUJBQUEscUJBQUEsS0FBQSxPQUFBOzs7O2FBSUEsVUFBQSxhQUFBO1lBQ0E7Z0JBQ0EsSUFBQSxlQUFBO2dCQUNBLElBQUEsUUFBQSxLQUFBLE9BQUEsS0FBQSxlQUFBLEtBQUEsT0FBQSxNQUFBLEtBQUEsS0FBQSxPQUFBO3FCQUNBLElBQUEsUUFBQSxLQUFBLE9BQUEsS0FBQSxlQUFBLEtBQUEsT0FBQSxNQUFBLEtBQUEsS0FBQSxPQUFBO2dCQUNBLElBQUEsa0JBQUEsS0FBQSxlQUFBLGdCQUFBO2dCQUNBLElBQUEsa0JBQUEsS0FBQSxvQkFBQTtnQkFDQSxLQUFBLG1CQUFBOztnQkFFQSxPQUFBLFNBQUE7Z0JBQ0E7b0JBQ0EsSUFBQSxXQUFBLGtCQUFBLENBQUEsZUFBQSxpQkFBQTtvQkFDQSxPQUFBLGVBQUEsS0FBQSxPQUFBLEtBQUEsT0FBQSxLQUFBLE9BQUEsS0FBQSxjQUFBLFdBQUE7Ozs7UUFJQSxJQUFBLGNBQUEsS0FBQSxLQUFBLE9BQUE7YUFDQTthQUNBLFNBQUE7YUFDQSxNQUFBLFFBQUEsWUFBQTtnQkFDQSxJQUFBLElBQUEsU0FBQTtnQkFDQSxJQUFBLElBQUEsS0FBQSxJQUFBLElBQUE7b0JBQ0EsT0FBQSxLQUFBLE9BQUE7dUJBQ0EsSUFBQSxLQUFBLE1BQUEsSUFBQSxJQUFBO29CQUNBLE9BQUEsS0FBQSxPQUFBO3VCQUNBO29CQUNBLE9BQUEsS0FBQSxPQUFBOzs7OztJQUtBLEtBQUEsaUJBQUEsU0FBQTtJQUNBOzs7UUFHQSxPQUFBLFFBQUEsS0FBQSxPQUFBLFFBQUEsT0FBQSxLQUFBLE9BQUEsTUFBQSxLQUFBLE9BQUEsUUFBQSxNQUFBOzs7SUFHQSxLQUFBLGlCQUFBLFNBQUE7SUFDQTtRQUNBLE9BQUEsS0FBQSxlQUFBLFNBQUEsS0FBQSxLQUFBOzs7SUFHQSxLQUFBLGVBQUEsU0FBQSxPQUFBO0lBQ0E7UUFDQSxPQUFBLEdBQUEsR0FBQSxLQUFBLE9BQUEsS0FBQSxLQUFBLE9BQUEsU0FBQSxTQUFBLEtBQUEsSUFBQSxLQUFBLGVBQUE7WUFDQSxHQUFBLEtBQUEsT0FBQSxLQUFBLEtBQUEsT0FBQSxTQUFBLFNBQUEsS0FBQSxJQUFBLEtBQUEsZUFBQTs7OztJQUlBLEtBQUEsVUFBQTs7Ozs7Ozs7QUM1UUEsQ0FBQSxVQUFBLENBQUEsYUFBQSxRQUFBLE9BQUEsY0FBQSxJQUFBLFNBQUEsVUFBQSxDQUFBLFlBQUEsU0FBQSxFQUFBLENBQUEsS0FBQSxrQkFBQSxDQUFBLEVBQUEsS0FBQSxXQUFBLEVBQUEsSUFBQSxtQkFBQSxLQUFBLGNBQUEsc0JBQUEsS0FBQSxlQUFBLEtBQUEsS0FBQSxlQUFBLEtBQUEsS0FBQSxTQUFBLHFwQkFBQSxLQUFBLGlCQUFBLElBQUEsS0FBQSxzQkFBQSw2QkFBQSxLQUFBLEtBQUEsQ0FBQSxlQUFBLGFBQUEsV0FBQSxVQUFBLFlBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxDQUFBLFFBQUEsSUFBQSxNQUFBLElBQUEsS0FBQSxJQUFBLE1BQUEsSUFBQSxHQUFBLElBQUEsS0FBQSxJQUFBLFNBQUEsSUFBQSxVQUFBLEtBQUEsRUFBQSxFQUFBLE1BQUEsS0FBQSxJQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLElBQUEsUUFBQSxFQUFBLEtBQUEsRUFBQSxXQUFBLEVBQUEsVUFBQSxTQUFBLFFBQUEsUUFBQSxFQUFBLEVBQUEsR0FBQSxVQUFBLEVBQUEsR0FBQSxRQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsS0FBQSxFQUFBLEdBQUEsT0FBQSxFQUFBLEtBQUEsT0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxLQUFBLE1BQUEsYUFBQSxNQUFBLEVBQUEsQ0FBQSxHQUFBLEtBQUEsWUFBQSxFQUFBLEtBQUEsU0FBQSxFQUFBLEtBQUEsT0FBQSxFQUFBLEtBQUEsUUFBQSxFQUFBLEtBQUEsV0FBQSxFQUFBLEtBQUEsVUFBQSxLQUFBLFNBQUEsR0FBQSxDQUFBLElBQUEsSUFBQSxFQUFBLEVBQUEsUUFBQSxPQUFBLEtBQUEsQ0FBQSxJQUFBLEVBQUEsRUFBQSxRQUFBLEdBQUEsR0FBQSxDQUFBLEVBQUEsWUFBQSxFQUFBLElBQUEsU0FBQSxHQUFBLENBQUEsRUFBQSxZQUFBLENBQUEsRUFBQSxZQUFBLEVBQUEsYUFBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLE9BQUEsRUFBQSxNQUFBLEVBQUEsWUFBQSxFQUFBLEtBQUEsQ0FBQSxRQUFBLFNBQUEsZUFBQSxFQUFBLE9BQUEsSUFBQSxDQUFBLEdBQUEsRUFBQSxJQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLENBQUEsUUFBQSxTQUFBLFlBQUEsRUFBQSxPQUFBLFVBQUEsU0FBQSxLQUFBLEdBQUEsR0FBQSxvQkFBQSxJQUFBLEVBQUEsRUFBQSxZQUFBLEVBQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxXQUFBLEVBQUEsRUFBQSxRQUFBLEVBQUEsRUFBQSxPQUFBLGFBQUEsVUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsaUJBQUEsUUFBQSxZQUFBLEtBQUEsRUFBQSxpQkFBQSxLQUFBLElBQUEsSUFBQSxFQUFBLENBQUEsR0FBQSxZQUFBLE9BQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxhQUFBLFFBQUEsRUFBQSxJQUFBLElBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsY0FBQSxFQUFBLEVBQUEsUUFBQSxFQUFBLElBQUEsQ0FBQSxJQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUEsR0FBQSxFQUFBLFNBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxFQUFBLFFBQUEsRUFBQSxXQUFBLEVBQUEsRUFBQSxTQUFBLGNBQUEsR0FBQSxDQUFBLElBQUEsRUFBQSxVQUFBLEtBQUEsUUFBQSxlQUFBLENBQUEsRUFBQSxFQUFBLENBQUEsT0FBQSxJQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLElBQUEsR0FBQSxFQUFBLEtBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLE1BQUEsR0FBQSxFQUFBLEVBQUEsTUFBQSxLQUFBLGFBQUEsVUFBQSxPQUFBLEVBQUEsVUFBQSxLQUFBLEVBQUEsRUFBQSxHQUFBLEdBQUEsVUFBQSxLQUFBLEVBQUEsRUFBQSxJQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsT0FBQSxFQUFBLFFBQUEsS0FBQSxHQUFBLEVBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsYUFBQSxFQUFBLEVBQUEsTUFBQSxFQUFBLEdBQUEsVUFBQSxPQUFBLEdBQUEsUUFBQSxRQUFBLEdBQUEsQ0FBQSxJQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsS0FBQSxFQUFBLEVBQUEsRUFBQSxLQUFBLEVBQUEsT0FBQSxFQUFBLElBQUEsRUFBQSxFQUFBLFFBQUEsUUFBQSxFQUFBLElBQUEsT0FBQSxFQUFBLENBQUEsR0FBQSxFQUFBLFFBQUEsR0FBQSxNQUFBLE9BQUEsRUFBQSxFQUFBLFFBQUEsR0FBQSxNQUFBLE9BQUEsRUFBQSxRQUFBLEdBQUEsTUFBQSxRQUFBLEdBQUEsR0FBQSxFQUFBLFFBQUEsT0FBQSxFQUFBLEdBQUEsQ0FBQSxHQUFBLENBQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLEdBQUEsQ0FBQSxFQUFBLE9BQUEsRUFBQSxRQUFBLElBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsUUFBQSxPQUFBLElBQUEsR0FBQSxFQUFBLEVBQUEsUUFBQSxHQUFBLEVBQUEsTUFBQSxRQUFBLEdBQUEsQ0FBQSxFQUFBLE9BQUEsRUFBQSxNQUFBLENBQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE9BQUEsRUFBQSxPQUFBLElBQUEsRUFBQSxFQUFBLEtBQUEsR0FBQSxFQUFBLElBQUEsV0FBQSxVQUFBLENBQUEsSUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEtBQUEsT0FBQSxLQUFBLEVBQUEsRUFBQSxFQUFBLEtBQUEsVUFBQSxDQUFBLElBQUEsU0FBQSxFQUFBLENBQUEsSUFBQSxFQUFBLE9BQUEsRUFBQSxVQUFBLE9BQUEsRUFBQSxFQUFBLE1BQUEsS0FBQSxXQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsS0FBQSxLQUFBLEdBQUEsT0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE9BQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxHQUFBLGFBQUEsTUFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxTQUFBLEVBQUEsQ0FBQSxFQUFBLE1BQUEsTUFBQSxJQUFBLEVBQUEsT0FBQSxVQUFBLENBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxVQUFBLFVBQUEsYUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE1BQUEsQ0FBQSxJQUFBLEVBQUEsVUFBQSxLQUFBLFFBQUEsZUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsaUJBQUEsUUFBQSxFQUFBLGlCQUFBLEVBQUEsVUFBQSxPQUFBLFVBQUEsQ0FBQSxHQUFBLE9BQUEsS0FBQSxVQUFBLENBQUEsSUFBQSxJQUFBLEVBQUEsS0FBQSxNQUFBLEdBQUEsRUFBQSxFQUFBLE1BQUEsUUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsSUFBQSxFQUFBLEdBQUEsRUFBQSxFQUFBLElBQUEsS0FBQSxVQUFBLEVBQUEsT0FBQSxLQUFBLFdBQUEsSUFBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLFFBQUEsR0FBQSxFQUFBLFlBQUEsQ0FBQSxFQUFBLEVBQUEsTUFBQSxLQUFBLGNBQUEsRUFBQSxPQUFBLEtBQUEsZUFBQSxFQUFBLE9BQUEsS0FBQSxlQUFBLEVBQUEsaUJBQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxHQUFBLEtBQUEsWUFBQSxFQUFBLElBQUEsc0JBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEdBQUEsRUFBQSxTQUFBLFFBQUEsUUFBQSxFQUFBLFFBQUEsU0FBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsR0FBQSxDQUFBLFVBQUEsT0FBQSxHQUFBLGFBQUEsVUFBQSxFQUFBLEdBQUEsQ0FBQSxFQUFBLElBQUEsRUFBQSxHQUFBLENBQUEsRUFBQSxFQUFBLE1BQUEsS0FBQSxPQUFBLEtBQUEsa0JBQUEsQ0FBQSxJQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsUUFBQSxRQUFBLEtBQUEsVUFBQSxFQUFBLEtBQUEsaUJBQUEsS0FBQSxzQkFBQSxHQUFBLENBQUEsSUFBQSxHQUFBLElBQUEsRUFBQSxtQkFBQSxFQUFBLEVBQUEsTUFBQSxRQUFBLFFBQUEsR0FBQSxPQUFBLEVBQUEsR0FBQSxJQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLE9BQUEsRUFBQSxTQUFBLEtBQUEsU0FBQSxpQkFBQSxFQUFBLGtCQUFBLEtBQUEsa0JBQUEsaUJBQUEsS0FBQSxpQkFBQSxzQkFBQSxLQUFBLHNCQUFBLFdBQUEsS0FBQSxXQUFBLGFBQUEsRUFBQSxjQUFBLEtBQUEsZUFBQSxPQUFBLE9BQUEsVUFBQSxTQUFBLENBQUEsVUFBQSxTQUFBLEVBQUEsQ0FBQSxNQUFBLENBQUEsU0FBQSxJQUFBLEtBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLFFBQUEsUUFBQSxFQUFBLE1BQUEsRUFBQSxRQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxVQUFBLE9BQUEsRUFBQSxjQUFBLEVBQUEsY0FBQSxNQUFBLFVBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxJQUFBLENBQUEsTUFBQSxFQUFBLFlBQUEsRUFBQSxrQkFBQSxTQUFBLEVBQUEsT0FBQSxFQUFBLGFBQUEsUUFBQSxNQUFBLEVBQUEsS0FBQSxXQUFBLFVBQUEsQ0FBQSxFQUFBLElBQUEsVUFBQSxJQUFBLENBQUEsVUFBQSxTQUFBLEVBQUEsUUFBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsT0FBQSxFQUFBLGlCQUFBLEtBQUEsRUFBQSxpQkFBQSxFQUFBLEVBQUEsQ0FBQSxHQUFBLEtBQUEsRUFBQSxZQUFBLEtBQUEsRUFBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsR0FBQSxZQUFBLEVBQUEsS0FBQSxDQUFBLElBQUEsRUFBQSxPQUFBLGFBQUEsRUFBQSxPQUFBLE9BQUEsRUFBQSxXQUFBLEVBQUEsRUFBQSxlQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsT0FBQSxPQUFBLGFBQUEsRUFBQSxPQUFBLGNBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLE9BQUEsRUFBQSxPQUFBLEtBQUEsT0FBQSxFQUFBLE9BQUEsS0FBQSxLQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEdBQUEsT0FBQSxFQUFBLFVBQUEsRUFBQSxLQUFBLFNBQUEsRUFBQSxRQUFBLEVBQUEsS0FBQSxPQUFBLEVBQUEsU0FBQSxFQUFBLEtBQUEsUUFBQSxFQUFBLFNBQUEsRUFBQSxLQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE9BQUEsRUFBQSxlQUFBLEtBQUEsRUFBQSxpQkFBQSxLQUFBLEVBQUEsWUFBQSxDQUFBLEdBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxPQUFBLEVBQUEsZ0JBQUEsS0FBQSxFQUFBLGtCQUFBLEtBQUEsRUFBQSxhQUFBLENBQUEsR0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLE1BQUEsU0FBQSxHQUFBLFFBQUEsR0FBQSxPQUFBLEdBQUEsUUFBQSxFQUFBLFNBQUEsR0FBQSxDQUFBLEdBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxHQUFBLElBQUEsSUFBQSxLQUFBLEVBQUEsRUFBQSxJQUFBLElBQUEsR0FBQSxFQUFBLGVBQUEsS0FBQSxFQUFBLEVBQUEsSUFBQSxHQUFBLE9BQUEsRUFBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxPQUFBLElBQUEsRUFBQSxJQUFBLEdBQUEsVUFBQSxZQUFBLFlBQUEsR0FBQSxFQUFBLFNBQUEsRUFBQSxXQUFBLEVBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxNQUFBLE1BQUEsRUFBQSxDQUFBLE1BQUEsRUFBQSxFQUFBLFFBQUEsU0FBQSxTQUFBLEVBQUEsTUFBQSxNQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxJQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxLQUFBLEVBQUEsRUFBQSxJQUFBLEdBQUEsWUFBQSxHQUFBLEVBQUEsS0FBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUEsVUFBQSxFQUFBLElBQUEsRUFBQSxLQUFBLEdBQUEsT0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsQ0FBQSxJQUFBLEVBQUEsVUFBQSxFQUFBLE9BQUEsR0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsT0FBQSxJQUFBLEVBQUEsQ0FBQSxFQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxFQUFBLFdBQUEsR0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEdBQUEsSUFBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLElBQUEsS0FBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLENBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUEsQ0FBQSxHQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsS0FBQSxHQUFBLENBQUEsRUFBQSxXQUFBLEdBQUEsTUFBQSxHQUFBLElBQUEsU0FBQSxHQUFBLEVBQUEsS0FBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLFdBQUEsR0FBQSxPQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxXQUFBLEdBQUEsR0FBQSxDQUFBLEdBQUEsQ0FBQSxFQUFBLEtBQUEsRUFBQSxFQUFBLE1BQUEsRUFBQSxRQUFBLEdBQUEsRUFBQSxTQUFBLFlBQUEsR0FBQSxDQUFBLEVBQUEsU0FBQSxDQUFBLEVBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxZQUFBLENBQUEsSUFBQSxFQUFBLENBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxLQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUEsQ0FBQSxHQUFBLElBQUEsRUFBQSxXQUFBLEdBQUEsT0FBQSxFQUFBLEdBQUEsRUFBQSxLQUFBLEdBQUEsT0FBQSxFQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxhQUFBLEVBQUEsRUFBQSxRQUFBLEVBQUEsV0FBQSxFQUFBLElBQUEsRUFBQSxFQUFBLEtBQUEsQ0FBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLElBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxVQUFBLE9BQUEsRUFBQSxRQUFBLEVBQUEsTUFBQSxFQUFBLFNBQUEsSUFBQSxFQUFBLEVBQUEsR0FBQSxHQUFBLEVBQUEsTUFBQSxTQUFBLEVBQUEsTUFBQSxJQUFBLEVBQUEsS0FBQSxFQUFBLENBQUEsR0FBQSxLQUFBLEVBQUEsVUFBQSxFQUFBLEVBQUEsR0FBQSxHQUFBLFNBQUEsR0FBQSxDQUFBLGFBQUEsR0FBQSxFQUFBLFdBQUEsRUFBQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxPQUFBLFVBQUEsQ0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsS0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsVUFBQSxJQUFBLEVBQUEsRUFBQSxJQUFBLFdBQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLElBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLElBQUEsUUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxJQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxFQUFBLFdBQUEsRUFBQSxJQUFBLEdBQUEsRUFBQSxFQUFBLEVBQUEsUUFBQSxPQUFBLEtBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxNQUFBLEtBQUEsT0FBQSxFQUFBLE9BQUEsRUFBQSxLQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsV0FBQSxFQUFBLEtBQUEsRUFBQSxXQUFBLEVBQUEsTUFBQSxHQUFBLEVBQUEsRUFBQSxJQUFBLEVBQUEsVUFBQSxDQUFBLEtBQUEsRUFBQSxRQUFBLEVBQUEsRUFBQSxHQUFBLEtBQUEsRUFBQSxXQUFBLEVBQUEsS0FBQSxFQUFBLFVBQUEsUUFBQSxDQUFBLFNBQUEsRUFBQSxVQUFBLEVBQUEsVUFBQSxPQUFBLEVBQUEsT0FBQSxJQUFBLEVBQUEsTUFBQSxFQUFBLE1BQUEsS0FBQSxJQUFBLEVBQUEsS0FBQSxHQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsYUFBQSxHQUFBLE9BQUEsSUFBQSxFQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxXQUFBLEdBQUEsRUFBQSxXQUFBLEdBQUEsSUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLENBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxFQUFBLFdBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsRUFBQSxHQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLE1BQUEsRUFBQSxLQUFBLElBQUEsRUFBQSxFQUFBLEdBQUEsUUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsSUFBQSxDQUFBLEdBQUEsRUFBQSxHQUFBLE9BQUEsRUFBQSxTQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLEtBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxTQUFBLEVBQUEsRUFBQSxHQUFBLE1BQUEsRUFBQSxHQUFBLFVBQUEsR0FBQSxFQUFBLEVBQUEsR0FBQSxTQUFBLEVBQUEsRUFBQSxHQUFBLE9BQUEsSUFBQSxFQUFBLFlBQUEsRUFBQSxNQUFBLEVBQUEsRUFBQSxNQUFBLEdBQUEsRUFBQSxJQUFBLEdBQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxXQUFBLEVBQUEsTUFBQSxFQUFBLGNBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsV0FBQSxHQUFBLEVBQUEsRUFBQSxVQUFBLEdBQUEsRUFBQSxFQUFBLFFBQUEsR0FBQSxJQUFBLElBQUEsRUFBQSxFQUFBLENBQUEsRUFBQSxZQUFBLEVBQUEsTUFBQSxHQUFBLFFBQUEsR0FBQSxRQUFBLEdBQUEsT0FBQSxHQUFBLE1BQUEsR0FBQSxXQUFBLEdBQUEsTUFBQSxHQUFBLFFBQUEsR0FBQSxTQUFBLEdBQUEsV0FBQSxHQUFBLE1BQUEsR0FBQSxPQUFBLEdBQUEsT0FBQSxHQUFBLEtBQUEsR0FBQSxRQUFBLEdBQUEsT0FBQSxHQUFBLE1BQUEsR0FBQSxNQUFBLEdBQUEsT0FBQSxHQUFBLE9BQUEsSUFBQSxRQUFBLEVBQUEsQ0FBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxLQUFBLElBQUEsSUFBQSxJQUFBLEtBQUEsRUFBQSxDQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxFQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsRUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsSUFBQSxJQUFBLElBQUEsTUFBQSxFQUFBLENBQUEsT0FBQSxNQUFBLFFBQUEsT0FBQSxTQUFBLFFBQUEsT0FBQSxNQUFBLEtBQUEsSUFBQSxJQUFBLHVCQUFBLEtBQUEsVUFBQSxVQUFBLE9BQUEsUUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLElBQUEsR0FBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsVUFBQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsS0FBQSxPQUFBLEVBQUEsYUFBQSxNQUFBLEVBQUEsQ0FBQSxHQUFBLEVBQUEsY0FBQSxLQUFBLEVBQUEsRUFBQSxFQUFBLEdBQUEsR0FBQSxFQUFBLFVBQUEsT0FBQSxTQUFBLEVBQUEsRUFBQSxDQUFBLElBQUEsRUFBQSxLQUFBLE9BQUEsRUFBQSxLQUFBLEtBQUEsRUFBQSxFQUFBLFVBQUEsR0FBQSxJQUFBLEVBQUEsVUFBQSxRQUFBLFNBQUEsRUFBQSxFQUFBLENBQUEsSUFBQSxFQUFBLEtBQUEsT0FBQSxFQUFBLFdBQUEsRUFBQSxJQUFBLElBQUEsRUFBQSxXQUFBLEVBQUEsSUFBQSxHQUFBLEdBQUEsR0FBQSxHQUFBLEVBQUEsVUFBQSxNQUFBLFVBQUEsQ0FBQSxJQUFBLEVBQUEsS0FBQSxPQUFBLEVBQUEsV0FBQSxHQUFBLEVBQUEsV0FBQSxHQUFBLEdBQUEsRUFBQSxVQUFBLGFBQUEsU0FBQSxFQUFBLEVBQUEsQ0FBQSxJQUFBLEVBQUEsS0FBQSxNQUFBLENBQUEsSUFBQSxFQUFBLFVBQUEsS0FBQSxRQUFBLGVBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxRQUFBLENBQUEsRUFBQSxTQUFBLEVBQUEsU0FBQSxVQUFBLEVBQUEsU0FBQSxZQUFBLEVBQUEsU0FBQSxFQUFBLG1CQUFBLEVBQUEsVUFBQSxVQUFBLFVBQUEsQ0FBQSxJQUFBLEVBQUEsS0FBQSxPQUFBLEVBQUEsV0FBQSxNQUFBLEVBQUEsWUFBQSxFQUFBLEtBQUEsVUFBQSxDQUFBLElBQUEsRUFBQSxFQUFBLEdBQUEsSUFBQSxJQUFBLEtBQUEsRUFBQSxNQUFBLEVBQUEsT0FBQSxLQUFBLEVBQUEsR0FBQSxTQUFBLEVBQUEsQ0FBQSxPQUFBLFVBQUEsQ0FBQSxPQUFBLEVBQUEsR0FBQSxNQUFBLEVBQUEsYUFBQSxLQUFBLEVBQUEsT0FBQSxFQUFBLFVBQUEsRUFBQSxhQUFBLE9BQUEsUUFBQSxPQUFBLFVBQUEsT0FBQSxRQUFBLEdBQUEsWUFBQSxPQUFBLFFBQUEsT0FBQSxLQUFBLE9BQUEsVUFBQSxDQUFBLE9BQUEsS0FBQSxPQUFBO0FDTkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUEsUUFBQSxPQUFBLFlBQUEsb0JBQUEsVUFBQSxVQUFBO1FBQ0EsU0FBQSxVQUFBLGdCQUFBLFFBQUEsS0FBQSxJQUFBO1FBQ0Esc0RBQUEsVUFBQSxjQUFBLGFBQUEsZ0JBQUE7O1FBRUEsSUFBQSxVQUFBLFVBQUEsS0FBQTtZQUNBLElBQUEsVUFBQSxJQUFBO1lBQ0EsUUFBQSxLQUFBLE9BQUEsS0FBQTtZQUNBLFFBQUEsS0FBQTtZQUNBLE9BQUEsQ0FBQSxRQUFBLFFBQUEsUUFBQSxVQUFBOzs7O1FBSUEsSUFBQSwyQkFBQTtRQUNBLElBQUEscUJBQUEsSUFBQSxPQUFBLE1BQUEsWUFBQSxLQUFBLFlBQUEsbUJBQUE7UUFDQSxhQUFBLFFBQUEsb0JBQUEsUUFBQSxZQUFBO1lBQ0EsT0FBQSxRQUFBOzs7OztRQUtBLElBQUEsZUFBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLEtBQUEsWUFBQSxTQUFBO1FBQ0EsYUFBQSxRQUFBLGNBQUEsUUFBQSxZQUFBO1lBQ0EsSUFBQSxXQUFBLE9BQUEsTUFBQSxNQUFBLEtBQUEsS0FBQSxPQUFBLE1BQUEsU0FBQSxHQUFBLEtBQUEsUUFBQSxNQUFBO1lBQ0EsSUFBQSxZQUFBLE9BQUEsTUFBQSxTQUFBLEdBQUEsS0FBQSxRQUFBO1lBQ0EsSUFBQSxP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QUEsUUFBQSxZQUFBO1lBQ0EsT0FBQSxRQUFBOzs7O1FBSUEsSUFBQSxvQkFBQTtRQUNBLElBQUEsY0FBQSxJQUFBLE9BQUEsTUFBQSxZQUFBLEtBQUEsWUFBQSxXQUFBO1FBQ0EsYUFBQSxRQUFBLGFBQUEsUUFBQSxZQUFBO1lBQ0EsT0FBQSxRQUFBOzs7O1FBSUEsSUFBQSx3QkFBQTtRQUNBLElBQUEsa0JBQUEsSUFBQSxPQUFBLE1BQUEsWUFBQSxLQUFBLFlBQUEsZUFBQTtRQUNBLGFBQUEsUUFBQSxpQkFBQSxRQUFBLFlBQUE7WUFDQSxPQUFBLFFBQUE7Ozs7Ozs7O1FBUUEsYUFBQSxRQUFBLFVBQUE7UUFDQSxhQUFBLFNBQUEsVUFBQTs7S0FFQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnLCBbXG4gICAgICAgICdzY2FsZUNvbmZpZ01vZHVsZScsXG4gICAgICAgICduZ1Jlc291cmNlJyxcbiAgICAgICAgJ25nU2FuaXRpemUnLFxuICAgICAgICAnbmdSb3V0ZScsXG4gICAgICAgICdlbWd1by5wb2xsZXInLFxuICAgICAgICAndWkuYm9vdHN0cmFwJyxcbiAgICAgICAgJ3VpLmdyaWQnLFxuICAgICAgICAndWkuZ3JpZC5zZWxlY3Rpb24nLFxuICAgICAgICAndWkuZ3JpZC5wYWdpbmF0aW9uJyxcbiAgICAgICAgJ3VpLmdyaWQucmVzaXplQ29sdW1ucycsXG4gICAgICAgICdjZnAuaG90a2V5cydcbiAgICBdKTtcblxuICAgIGFwcC5jb25maWcoZnVuY3Rpb24oJHJvdXRlUHJvdmlkZXIsICRyZXNvdXJjZVByb3ZpZGVyLCBwb2xsZXJDb25maWcpIHtcbiAgICAgICAgLy8gc3RvcCBwb2xsZXJzIHdoZW4gcm91dGUgY2hhbmdlc1xuICAgICAgICBwb2xsZXJDb25maWcuc3RvcE9uUm91dGVDaGFuZ2UgPSB0cnVlO1xuICAgICAgICBwb2xsZXJDb25maWcuc21hcnQgPSB0cnVlO1xuXG4gICAgICAgIC8vIHByZXNlcnZlIHRyYWlsaW5nIHNsYXNoZXNcbiAgICAgICAgJHJlc291cmNlUHJvdmlkZXIuZGVmYXVsdHMuc3RyaXBUcmFpbGluZ1NsYXNoZXMgPSBmYWxzZTtcblxuICAgICAgICAvL3JvdXRpbmdcbiAgICAgICAgJHJvdXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC53aGVuKCcvJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdvdkNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9vdmVydmlldy9wYXJ0aWFscy9vdlRlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9hZG1pbi9sb2dpbicse1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhZG1pbkxvZ2luQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2FkbWluL3BhcnRpYWxzL2FkbWluTG9naW5UZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvYWRtaW4vbG9nb3V0Jyx7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2xvZ291dENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9hZG1pbi9wYXJ0aWFscy9hZG1pbkxvZ2luVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2Fib3V0Jywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhYm91dENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9hYm91dC9wYXJ0aWFscy9hYm91dFRlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9mZWVkJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdmZWVkRGV0YWlsc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9mZWVkL3BhcnRpYWxzL2ZlZWREZXRhaWxzVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICAgICAgcmVsb2FkT25TZWFyY2g6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9mZWVkL2luZ2VzdHMnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2luZ2VzdFJlY29yZHNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvZmVlZC9wYXJ0aWFscy9pbmdlc3RSZWNvcmRzVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICAgICAgcmVsb2FkT25TZWFyY2g6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9tZXRyaWNzJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdtZXRyaWNzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL21ldHJpY3MvcGFydGlhbHMvbWV0cmljc1RlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvbm9kZXMnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ25vZGVzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL25vZGVzL3BhcnRpYWxzL25vZGVzVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL25vZGVzLzppZCcsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnbm9kZURldGFpbHNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvbm9kZXMvcGFydGlhbHMvbm9kZURldGFpbHNUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvbG9hZCcsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnbG9hZENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9sb2FkL3BhcnRpYWxzL2xvYWRUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvbG9hZC9ydW5uaW5nJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdxdWV1ZVJ1bm5pbmdDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvbG9hZC9wYXJ0aWFscy9xdWV1ZVJ1bm5pbmdUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvbG9hZC9kZXB0aCcsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnbG9hZERlcHRoQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2xvYWQvcGFydGlhbHMvbG9hZERlcHRoVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL3JlY2lwZXMnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3JlY2lwZXNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvcmVjaXBlcy9wYXJ0aWFscy9yZWNpcGVzVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICAgICAgcmVsb2FkT25TZWFyY2g6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9yZWNpcGVzL3JlY2lwZS86aWQnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3JlY2lwZURldGFpbHNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvcmVjaXBlcy9wYXJ0aWFscy9yZWNpcGVEZXRhaWxzVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL3JlY2lwZXMvdHlwZXMvOmlkPycsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAncmVjaXBlVHlwZXNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvcmVjaXBlcy9wYXJ0aWFscy9yZWNpcGVUeXBlc1RlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9yZWNpcGVzL2J1aWxkZXInLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3JlY2lwZUVkaXRvckNvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9yZWNpcGVzL3BhcnRpYWxzL3JlY2lwZUVkaXRvclRlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9yZWNpcGVzL2J1aWxkZXIvOmlkJywge1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdyZWNpcGVFZGl0b3JDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvcmVjaXBlcy9wYXJ0aWFscy9yZWNpcGVFZGl0b3JUZW1wbGF0ZS5odG1sJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVuKCcvam9icycsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnam9ic0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9qb2JzL3BhcnRpYWxzL2pvYnNUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2VcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMvam9iLzppZCcsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnam9iRGV0YWlsQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2pvYnMvcGFydGlhbHMvam9iRGV0YWlsVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMvdHlwZXMvOmlkPycsIHtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnam9iVHlwZXNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvam9icy9wYXJ0aWFscy9qb2JUeXBlc1RlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZW4oJy9qb2JzL2V4ZWN1dGlvbnMnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2pvYkV4ZWN1dGlvbnNDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvam9icy9wYXJ0aWFscy9qb2JFeGVjdXRpb25zVGVtcGxhdGUuaHRtbCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlbignL2pvYnMvZXhlY3V0aW9ucy86aWQnLCB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2pvYkV4ZWN1dGlvbkRldGFpbENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9qb2JzL3BhcnRpYWxzL2pvYkV4ZWN1dGlvbkRldGFpbFRlbXBsYXRlLmh0bWwnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm90aGVyd2lzZSh7XG4gICAgICAgICAgICAgICAgcmVkaXJlY3RUbzogJy8nXG4gICAgICAgICAgICB9KTtcbiAgICB9KVxuICAgIC52YWx1ZSgnbW9tZW50Jywgd2luZG93Lm1vbWVudClcbiAgICAudmFsdWUoJ2xvY2FsU3RvcmFnZScsIHdpbmRvdy5sb2NhbFN0b3JhZ2UpXG4gICAgLnZhbHVlKCdYTUxIdHRwUmVxdWVzdCcsIHdpbmRvdy5YTUxIdHRwUmVxdWVzdClcbiAgICAudmFsdWUoJ3RvYXN0cicsIHdpbmRvdy50b2FzdHIpO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQ29uZmlnTW9kdWxlJywgW10pLnByb3ZpZGVyKCdzY2FsZUNvbmZpZycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNjYWxlQ29uZmlnID0ge30sXG4gICAgICAgICAgICBzY2FsZUNvbmZpZ0xvY2FsID0ge307XG5cbiAgICAgICAgdGhpcy4kZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9ICQuYWpheCh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgdXJsOiAnY29uZmlnL3NjYWxlQ29uZmlnLmpzb24nLFxuICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGNvbmZpZy5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHNjYWxlQ29uZmlnID0gY29uZmlnLnJlc3BvbnNlSlNPTi5zY2FsZUNvbmZpZztcblxuICAgICAgICAgICAgICAgIHZhciBjb25maWdMb2NhbCA9ICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICB1cmw6ICdjb25maWcvc2NhbGVDb25maWcubG9jYWwuanNvbicsXG4gICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnTG9jYWwuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgc2NhbGVDb25maWdMb2NhbCA9IGNvbmZpZ0xvY2FsLnJlc3BvbnNlSlNPTi5zY2FsZUNvbmZpZ0xvY2FsO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIF8ubWVyZ2Uoc2NhbGVDb25maWcsIHNjYWxlQ29uZmlnTG9jYWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gc2NhbGVDb25maWc7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc0hlYWRlckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRlbGVtZW50LCBzdWJuYXZTZXJ2aWNlKSB7XG4gICAgICAgICRzY29wZS5kYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgJHNjb3BlLmN1cnJlbnRQYXRoID0gc3VibmF2U2VydmljZS5nZXRDdXJyZW50UGF0aCgpO1xuICAgIH0pXG4gICAgLmRpcmVjdGl2ZSgnYWlzSGVhZGVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVXNhZ2U6IDxhaXMtaGVhZGVyIG5hbWU9e25hbWV9PjwvYWlzLWhlYWRlcj5cbiAgICAgICAgICovXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzSGVhZGVyQ29udHJvbGxlcicsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2hlYWRlci9oZWFkZXJUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgbmFtZTogJz0nLFxuICAgICAgICAgICAgICAgIGhpZGVUaXRsZTogJz0nLFxuICAgICAgICAgICAgICAgIGxvYWRpbmc6ICc9JywgLy8gb3B0aW9uYWwgLSB3aWxsIG92ZXJsYXkgYSBsb2FkaW5nIHNwaW5uZXIgb24gdGhlIHBhZ2UgYmFzZWQgb24gdGhlIHBhc3NlZC1pbiB2YWx1ZVxuICAgICAgICAgICAgICAgIHNob3dTdWJuYXY6ICc9JyxcbiAgICAgICAgICAgICAgICBzdWJuYXZMaW5rczogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmRpcmVjdGl2ZSgnc2NhbGVOYXZpZ2F0aW9uJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9uYXZpZ2F0aW9uL3BhcnRpYWxzL25hdlRlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ25hdkNvbnRyb2xsZXInXG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhYm91dENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgJHdpbmRvdywgbmF2U2VydmljZSkge1xuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignYWJvdXQnKTtcbiAgICAgICAgfTtcbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWRtaW5Mb2dpbkNvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHRpbWVvdXQsICRyb290U2NvcGUsICRsb2NhdGlvbiwgdXNlclNlcnZpY2UpIHtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJDcmVkcygpO1xuICAgICAgICAgICAgaWYoISRyb290U2NvcGUudXNlcil7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS51c2VyID0gdXNlclNlcnZpY2UubG9naW4oJ2FkbWluJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCRyb290U2NvcGUudXNlcik7XG5cbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgLy8gQW55IGNvZGUgaW4gaGVyZSB3aWxsIGF1dG9tYXRpY2FsbHkgaGF2ZSBhbiAkc2NvcGUuYXBwbHkoKSBydW4gYWZ0ZXJ3YXJkc1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL1wiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdsb2dvdXRDb250cm9sbGVyJywgZnVuY3Rpb24gKCR0aW1lb3V0LCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sIHVzZXJTZXJ2aWNlKSB7XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB1c2VyU2VydmljZS5sb2dvdXQoKTtcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgLy8gQW55IGNvZGUgaW4gaGVyZSB3aWxsIGF1dG9tYXRpY2FsbHkgaGF2ZSBhbiAkc2NvcGUuYXBwbHkoKSBydW4gYWZ0ZXJ3YXJkc1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL1wiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhaXNEYXRhRmVlZENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCBzY2FsZUNvbmZpZywgbG9hZFNlcnZpY2UsIHNjYWxlU2VydmljZSkge1xuICAgICAgICAkc2NvcGUuZGF5cyA9IFtdO1xuICAgICAgICAkc2NvcGUuaG91cnMgPSBbMCwxLDIsMyw0LDUsNiw3LDgsOSwxMCwxMSwxMiwxMywxNCwxNSwxNiwxNywxOCwxOSwyMCwyMSwyMiwyM107XG4gICAgICAgICRzY29wZS52YWx1ZXMgPSB7fTtcbiAgICAgICAgdmFyIHByb2Nlc3NOZXdGZWVkID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBjdXJyZW50RGF5ID0gbW9tZW50LnV0YygpO1xuICAgICAgICAgICAgJHNjb3BlLmRheXMgPSBbXTtcbiAgICAgICAgICAgIHZhciBkYXkgPSAnJztcbiAgICAgICAgICAgIGlmKCRzY29wZS5mZWVkKXtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLmZlZWQudmFsdWVzLCBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsZGF5ID0gbW9tZW50LnV0Yyh2YWwudGltZSkuZm9ybWF0KHNjYWxlQ29uZmlnLmRhdGVGb3JtYXRzLmRheSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWxob3VyID0gbW9tZW50LnV0Yyh2YWwudGltZSkuaG91cigpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaWQgPSB2YWxkYXkgKyAnXycgKyB2YWxob3VyO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudmFsdWVzW2lkXSA9IHZhbDtcbiAgICAgICAgICAgICAgICAgICAgaWYodmFsZGF5ICE9PSBkYXkpe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF5ID0gdmFsZGF5O1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRheXMucHVzaCh2YWxkYXkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnVpbGRUYWJsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBidWlsZFRhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGN1cnJEYXkgPSBtb21lbnQoKS51dGMoKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5KTtcbiAgICAgICAgICAgIHZhciBjdXJySG91ciA9IG1vbWVudCgpLnV0YygpLmhvdXIoKTtcblxuICAgICAgICAgICAgdmFyIHRhYmxlX2h0bWwgPSAnPGRpdiBjbGFzcz1cInRhYmxlLXJlc3BvbnNpdmVcIj48dGFibGU+JztcbiAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzx0cj48dGg+SG91ciAoVVRDKTwvdGg+JztcbiAgICAgICAgICAgIGZvcihkYXkgaW4gJHNjb3BlLmRheXMpe1xuICAgICAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzx0ZCBjbGFzcz1cImRheS1sYWJlbFwiIHRpdGxlPVwiJyArICRzY29wZS5kYXlzW2RheV0gKyAnXCI+PGRpdiBjbGFzcz1cImRheS1vZi13ZWVrXCI+JyArIHNjYWxlU2VydmljZS5nZXREYXlTdHJpbmcobW9tZW50KCRzY29wZS5kYXlzW2RheV0pLmRheSgpKSArICc8L2Rpdj4nICsgbW9tZW50KCRzY29wZS5kYXlzW2RheV0pLmZvcm1hdCgnTU0vREQnKSArICc8L3RkPic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0YWJsZV9odG1sICs9ICc8L3RyPic7XG4gICAgICAgICAgICBmb3IodmFyIGhvdXIgaW4gJHNjb3BlLmhvdXJzKXtcbiAgICAgICAgICAgICAgICBob3VyID0gMjMtaG91cjtcbiAgICAgICAgICAgICAgICB0YWJsZV9odG1sICs9ICc8dHI+JztcbiAgICAgICAgICAgICAgICB0YWJsZV9odG1sICs9ICc8dGggdGl0bGU9XCInICsgJHNjb3BlLmhvdXJzW2hvdXJdICsgJzowMFwiPicgKyAkc2NvcGUuaG91cnNbaG91cl0gKyAnPC90aD4nO1xuXG4gICAgICAgICAgICAgICAgZm9yKHZhciBkYXkgaW4gJHNjb3BlLmRheXMpe1xuICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gICRzY29wZS5kYXlzW2RheV0gKyAnXycgKyAkc2NvcGUuaG91cnNbaG91cl07XG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWxlcyA9ICRzY29wZS52YWx1ZXNba2V5XS5maWxlcztcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNpemUgPSAkc2NvcGUudmFsdWVzW2tleV0uc2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNscyA9ICdnb29kJztcbiAgICAgICAgICAgICAgICAgICAgaWYoJHNjb3BlLmRheXNbZGF5XSA9PT0gY3VyckRheSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZigkc2NvcGUuaG91cnNbaG91cl0gPT09IGN1cnJIb3VyKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbHMgPSAnY3VycmVudCc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKCRzY29wZS5ob3Vyc1tob3VyXSA+IGN1cnJIb3VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xzID0gJ2Z1dHVyZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoZmlsZXMgPT09IDAgJiYgc2l6ZSA9PT0gMCAmJiBjbHMgIT09ICdjdXJyZW50JyAmJiBjbHMgIT09ICdmdXR1cmUnKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNscyA9ICd1bmtub3duJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGtleSk7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzx0ZCBpZD1cIicgKyBrZXkgKyAnXCIgdGl0bGU9XCInICsgJHNjb3BlLmRheXNbZGF5XSArICcgJyArICRzY29wZS5ob3Vyc1tob3VyXSArICc6MDBcIj4nO1xuICAgICAgICAgICAgICAgICAgICBpZihjbHMgPT09ICdmdXR1cmUnKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGFibGVfaHRtbCArPSAnPHNwYW4gY2xhc3M9XCInICsgY2xzICsgJ1wiIGlkPVwic3Bhbl8nICsgJHNjb3BlLmRheXNbZGF5XSArICdfJyArICRzY29wZS5ob3Vyc1tob3VyXSArICdcIiBzdHlsZT1cImRpc3BsYXk6IGJsb2NrO1wiPjxkaXYgY2xhc3M9XCJmaWxlLWNvdW50XCI+Jm5ic3A7PC9kaXY+PGRpdiBjbGFzcz1cImZpbGUtc2l6ZVwiPiZuYnNwOzwvZGl2Pjwvc3Bhbj48L3RkPic7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZV9odG1sICs9ICc8c3BhbiBjbGFzcz1cIicgKyBjbHMgKyAnXCIgaWQ9XCJzcGFuXycgKyAkc2NvcGUuZGF5c1tkYXldICsgJ18nICsgJHNjb3BlLmhvdXJzW2hvdXJdICsgJ1wiIHN0eWxlPVwiZGlzcGxheTogYmxvY2s7XCI+Jm5ic3A7PC9zcGFuPjwvdGQ+JztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgLy90YWJsZV9odG1sICs9ICc8c3BhbiBjbGFzcz1cIicgKyBjbHMgKyAnXCIgaWQ9XCJzcGFuXycgKyAkc2NvcGUuZGF5c1tkYXldICsgJ18nICsgJHNjb3BlLmhvdXJzW2hvdXJdICsgJ1wiIHN0eWxlPVwiZGlzcGxheTogYmxvY2s7XCI+PGRpdiBjbGFzcz1cImZpbGUtY291bnRcIj4nICsgZmlsZXMgKyAnPC9kaXY+PGRpdiBjbGFzcz1cImZpbGUtc2l6ZVwiPicgKyBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tQnl0ZXMoc2l6ZSwxKSArICc8L2Rpdj48L3NwYW4+PC90ZD4nO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy90YWJsZV9odG1sICs9ICc8c3BhbiBjbGFzcz1cIicgKyBjbHMgKyAnXCIgaWQ9XCJzcGFuXycgKyAkc2NvcGUuZGF5c1tkYXldICsgJ18nICsgJHNjb3BlLmhvdXJzW2hvdXJdICsgJ1wiIHN0eWxlPVwiZGlzcGxheTogYmxvY2s7XCI+PHNwYW4gY2xhc3M9XCJmaWxlLWNvdW50XCI+JyArIGZpbGVzICsgJzwvc3Bhbj4gLyA8c3BhbiBjbGFzcz1cImZpbGUtc2l6ZVwiPicgKyBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tQnl0ZXMoc2l6ZSwxKSArICc8L3NwYW4+PC9zcGFuPjwvdGQ+JztcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlX2h0bWwgKz0gJzxzcGFuIGNsYXNzPVwiJyArIGNscyArICdcIiBpZD1cInNwYW5fJyArICRzY29wZS5kYXlzW2RheV0gKyAnXycgKyAkc2NvcGUuaG91cnNbaG91cl0gKyAnXCIgc3R5bGU9XCJkaXNwbGF5OiBibG9jaztcIj4nICsgc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUZpbGVTaXplRnJvbUJ5dGVzKHNpemUsMSkgKyAnIC8gJyArIGZpbGVzICsgJzwvc3Bhbj48L3RkPic7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0YWJsZV9odG1sICs9ICc8L3RyPic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0YWJsZV9odG1sICs9ICc8L3RhYmxlPjwvZGl2Pic7XG4gICAgICAgICAgICAkKCcjaGlzdG9yeScpLmh0bWwodGFibGVfaHRtbCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCdmZWVkJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYoJHNjb3BlLmZlZWQpe1xuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzTmV3RmVlZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcbiAgICB9KS5kaXJlY3RpdmUoJ2Fpc0RhdGFGZWVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fpc0RhdGFGZWVkQ29udHJvbGxlcicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvY2hhcnRzL2RhdGFGZWVkL2RhdGFGZWVkVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBmZWVkOiAnPScgLy8gRmVlZCBkYXRhXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc0RvbnV0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGVsZW1lbnQsIHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBjaGFydCA9IG51bGw7XG5cbiAgICAgICAgdmFyIGdlbkNoYXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKGNoYXJ0KSB7XG4gICAgICAgICAgICAgICAgLy9jaGFydC5kYXRhKClcbiAgICAgICAgICAgICAgICAvLyRzY29wZS5jb2xEYXRhXG4gICAgICAgICAgICAgICAgdmFyIG9sZERhdGEgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSWRzID0gW107XG5cbiAgICAgICAgICAgICAgICAvLyByZWFzc2VtYmxlIGN1cnJlbnRseSBkaXNwbGF5ZWQgZGF0YSB0byBtYXRjaCAkc2NvcGUuY29sRGF0YVxuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChjaGFydC5kYXRhKCksIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIG9sZERhdGEucHVzaChbZC52YWx1ZXNbMF0uaWQsIGQudmFsdWVzWzBdLnZhbHVlXSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBkZXRlcm1pbmUgd2hpY2ggZWxlbWVudHMgdG8gcmVtb3ZlXG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKG9sZERhdGEsIGZ1bmN0aW9uIChvZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIga2VlcCA9IF8uZmluZCgkc2NvcGUuY29sRGF0YSwgZnVuY3Rpb24gKGNkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2RbMF0gPT09IG9kWzBdO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFrZWVwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVJZHMucHVzaChvZFswXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBjaGFydFxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmNvbERhdGEpKTtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHJlbW92ZUlkcykpO1xuICAgICAgICAgICAgICAgIGNoYXJ0LmxvYWQoe1xuICAgICAgICAgICAgICAgICAgICBjb2x1bW5zOiAkc2NvcGUuY29sRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgdW5sb2FkOiByZW1vdmVJZHNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2hhcnQgPSBjMy5nZW5lcmF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGJpbmR0bzogJGVsZW1lbnRbMF0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnM6ICRzY29wZS5jb2xEYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJHNjb3BlLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb3duOiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfcmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhcm5pbmc6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF95ZWxsb3csXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXA6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9ncmVlbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb21wbGV0ZWQ6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9ncmVlbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEb25lOiAnIzM2ODFiZicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUXVldWU6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF95ZWxsb3csXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFpbGVkOiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfcmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsZ29yaXRobTogJyM0NDQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGE6ICcjODg4JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW06ICcjY2NjJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPZmZsaW5lOiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfcmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdIaWdoIEZhaWx1cmUgUmF0ZSc6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9vcmFuZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUGF1c2VkOiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfeWVsbG93XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA3MDBcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcGllOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogZDMuZm9ybWF0KCcsJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZG9udXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiAkc2NvcGUuc2hvd0xhYmVsID8gZDMuZm9ybWF0KCcsJykgOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICRzY29wZS53aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAkc2NvcGUubmFtZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZDMuZm9ybWF0KCcsJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAkc2NvcGUuc2l6ZSB8fCAzMjBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGVsZW1lbnRbMF0uc3R5bGUucG9zaXRpb24gPSAnc3RhdGljJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdENvbHVtbkRhdGEgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgJHNjb3BlLmNvbERhdGEgPSBbXTtcbiAgICAgICAgICAgICRzY29wZS5kYXRhLmZvckVhY2goZnVuY3Rpb24ob2JqKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29sRGF0YS5wdXNoKFtvYmouc3RhdHVzLG9iai5jb3VudF0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGluaXRDb2x1bW5EYXRhKCk7XG4gICAgICAgICAgICBnZW5DaGFydCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ2RhdGEnLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemUoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKCRlbGVtZW50WzBdKS5lbXB0eSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgd2luZG93Lm9ucmVzaXplID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIHdpZHRoID0gJCgkZWxlbWVudFswXSkud2lkdGgoKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyh3aWR0aCk7XG4gICAgICAgICAgZ2VuQ2hhcnQoKTtcbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZGlyZWN0aXZlKCdhaXNEb251dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhaXNEb251dENvbnRyb2xsZXInLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgZGF0YTogJz0nLFxuICAgICAgICAgICAgICAgIHR5cGU6ICc9JyxcbiAgICAgICAgICAgICAgICBzaXplOiAnPScsXG4gICAgICAgICAgICAgICAgc2hvd0xhYmVsOiAnPScsXG4gICAgICAgICAgICAgICAgd2lkdGg6ICc9JyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc0hlYWx0aENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCBnYXVnZUZhY3RvcnkpIHtcbiAgICAgICAgdmFyIGdhdWdlID0gbnVsbCxcbiAgICAgICAgICAgIGluaXRpYWxpemVkID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpbml0aWFsaXplZCA9IHRydWU7XG4gICAgICAgICAgICB2YXIgc2NhbGUgPSAkc2NvcGUuc2NhbGUgfHwgMTtcbiAgICAgICAgICAgIC8vJHNjb3BlLmdhdWdlU2l6ZSA9IDE1MCAqIHNjYWxlO1xuICAgICAgICAgICAgLy8kc2NvcGUuZ2F1Z2VXaWR0aCA9IDI1ICogc2NhbGU7XG4gICAgICAgICAgICAkc2NvcGUuZG9udXRTaXplID0gMjc1ICogc2NhbGU7XG4gICAgICAgICAgICAkc2NvcGUuZG9udXRXaWR0aCA9IDI1ICogc2NhbGU7XG4gICAgICAgICAgICAvL2dhdWdlID0gZ2F1Z2VGYWN0b3J5LmNyZWF0ZUdhdWdlKCRzY29wZS50eXBlLCAnRmFpbHVyZSBSYXRlJylcbiAgICAgICAgfTtcblxuICAgICAgICAvKnZhciByZWRyYXdHYXVnZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChnYXVnZSkge1xuICAgICAgICAgICAgICAgIGdhdWdlLnJlZHJhdygkc2NvcGUuZGF0YS5nYXVnZURhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9OyovXG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgnZGF0YScsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChfLmtleXMoZGF0YSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy9yZWRyYXdHYXVnZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZGlyZWN0aXZlKCdhaXNIZWFsdGgnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzSGVhbHRoQ29udHJvbGxlcicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvY2hhcnRzL2hlYWx0aC9oZWFsdGhUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIG5hbWU6ICc9JyxcbiAgICAgICAgICAgICAgICBkYXRhOiAnPScsXG4gICAgICAgICAgICAgICAgc2NhbGU6ICc9JyxcbiAgICAgICAgICAgICAgICBlcnJvckxhYmVsOiAnPScsXG4gICAgICAgICAgICAgICAgdHlwZTogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhaXNHcmlkQ2hhcnRDb250cm9sbGVyJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzY29wZSwgJGxvY2F0aW9uLCAkdWliTW9kYWwsIHVzZXJTZXJ2aWNlLCBzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgc3ZnID0gbnVsbCxcbiAgICAgICAgICAgIHJlY3QgPSBudWxsLFxuICAgICAgICAgICAgc2NhbGUgPSBwYXJzZUZsb2F0KCRzY29wZS5zY2FsZSksXG4gICAgICAgICAgICB0aXAgPSBkMy50aXAoKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdkMy10aXAnKVxuICAgICAgICAgICAgICAgIC5vZmZzZXQoWy0xMCwgMF0pXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBkLnN0YXR1cy5nZXRGYWlsdXJlcygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbFN0ciA9ICcnO1xuXG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChmYWlsdXJlcywgZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxTdHIgPSBmYWlsU3RyICsgXy5jYXBpdGFsaXplKGYuc3RhdHVzLnRvTG93ZXJDYXNlKCkpICsgJyBFcnJvcnM6ICcgKyBmLmNvdW50ICsgJzxiciAvPic7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC50aXRsZSArICcgJyArIGQudmVyc2lvbiArICc8YnIgLz4nICsgZmFpbFN0ciArIGdldENlbGxUb3RhbChkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgICRzY29wZS5kYXRhVmFsdWVzID0gW107XG4gICAgICAgICRzY29wZS5jZWxsV2lkdGggPSA1MCAqIHNjYWxlO1xuICAgICAgICAkc2NvcGUuY2VsbEhlaWdodCA9IDUwICogc2NhbGU7XG4gICAgICAgICRzY29wZS5lbmFibGVab29tID0gdHlwZW9mICRzY29wZS5tb2RlICE9PSAndW5kZWZpbmVkJyA/ICRzY29wZS5tb2RlID09PSAnem9vbScgOiB0cnVlO1xuICAgICAgICAkc2NvcGUuZW5hYmxlVG9vbHRpcCA9IHR5cGVvZiAkc2NvcGUubW9kZSAhPT0gJ3VuZGVmaW5lZCcgPyAkc2NvcGUubW9kZSA9PT0gJ3Rvb2x0aXAnIDogZmFsc2U7XG4gICAgICAgICRzY29wZS5lbmFibGVSZXZlYWwgPSB0eXBlb2YgJHNjb3BlLnJldmVhbCAhPT0gJ3VuZGVmaW5lZCcgPyAkc2NvcGUucmV2ZWFsIDogdHJ1ZTtcbiAgICAgICAgJHNjb3BlLnVzZXIgPSB1c2VyU2VydmljZS5nZXRVc2VyQ3JlZHMoKTtcbiAgICAgICAgJHNjb3BlLnBhdXNlUmVhc29uID0gJyc7XG4gICAgICAgICRzY29wZS5ncmlkRGF0YSA9IFtdO1xuICAgICAgICAkc2NvcGUuZ3JpZENsYXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICRzY29wZS5pY29ucyA9PT0gdHJ1ZSA/ICdpY29ucycgOiAnJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgd2lkdGggPSAkKCcuZ3JpZC1jaGFydCcpLndpZHRoKCksXG4gICAgICAgICAgICBoZWlnaHQgPSAkc2NvcGUucm93cyA/ICgkc2NvcGUuY2VsbEhlaWdodCAqICRzY29wZS5yb3dzKSArIDEwIDogKCRzY29wZS5jZWxsSGVpZ2h0ICogNikgKyAxMCwgLy8gbXVsdGlwbHkgY2VsbCBoZWlnaHQgYnkgOCAoaGlnaGVzdCB6b29tIHNjYWxlIGV4dGVudCB2YWx1ZSkgcGx1cyBzb21lIGJyZWF0aGluZyByb29tXG4gICAgICAgICAgICBjb2xzID0gMCxcbiAgICAgICAgICAgIHJvd3MgPSAwLFxuICAgICAgICAgICAgY2VsbEZvbnRMZyA9IC40LFxuICAgICAgICAgICAgY2VsbEZvbnRTbSA9IC4zO1xuXG4gICAgICAgIHZhciBnZXREYXRhVmFsdWVzID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICRzY29wZS5ncmlkRGF0YSA9IFtdO1xuICAgICAgICAgICAgJHNjb3BlLmRhdGFWYWx1ZXMgPSBbXTtcbiAgICAgICAgICAgIGlmIChkYXRhLmRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YVR5cGUgPSBkYXRhLmRhdGEudG9TdHJpbmcoKS5zcGxpdCgnLCcpWzBdO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhVHlwZSA9PT0gJ0pvYlR5cGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhVmFsdWVzID0gXy5zb3J0QnlPcmRlcihfLnZhbHVlcyhkYXRhLmRhdGEpLCBbJ25hbWUnXSwgWydhc2MnXSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFzc29jaWF0ZSBKb2JUeXBlIHdpdGggSm9iVHlwZVN0YXR1c1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLmRhdGFWYWx1ZXMsIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbC5zdGF0dXMgPSBfLmZpbmQoZGF0YS5zdGF0dXMsICdqb2JfdHlwZS5pZCcsIHZhbC5pZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YVZhbHVlcyA9IF8uc29ydEJ5T3JkZXIoXy52YWx1ZXMoZGF0YS5kYXRhKSwgWydzdGF0dXMuaGFzX3J1bm5pbmcnLCAnc3RhdHVzLmRlc2NyaXB0aW9uJywgJ25hbWUnXSwgWydhc2MnLCAnYXNjJywgJ2FzYyddKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGFUeXBlID09PSAnTm9kZScpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGFWYWx1ZXMgPSBfLnNvcnRCeU9yZGVyKF8udmFsdWVzKGRhdGEuZGF0YSksIFsnaG9zdG5hbWUnXSwgWydhc2MnXSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFzc29jaWF0ZSBOb2RlIHdpdGggTm9kZVN0YXR1c1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLmRhdGFWYWx1ZXMsIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbC5zdGF0dXMgPSBfLmZpbmQoZGF0YS5zdGF0dXMsICdub2RlLmlkJywgdmFsLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhVmFsdWVzID0gXy5zb3J0QnlPcmRlcigkc2NvcGUuZGF0YVZhbHVlcywgWydob3N0bmFtZSddLCBbJ2FzYyddKTsgLy8gc29ydCBieSBob3N0TmFtZSBhc2NcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YVZhbHVlcyA9IGRhdGEuZGF0YTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb2xzID0gJHNjb3BlLmNvbHVtbnMgPyAkc2NvcGUuY29sdW1ucyA6IE1hdGguZmxvb3Iod2lkdGggLyAkc2NvcGUuY2VsbFdpZHRoKTtcbiAgICAgICAgICAgICAgICByb3dzID0gJHNjb3BlLnJvd3MgPyAkc2NvcGUucm93cyA6IE1hdGguY2VpbCgkc2NvcGUuZGF0YVZhbHVlcy5sZW5ndGggLyBjb2xzKTtcblxuICAgICAgICAgICAgICAgIGQzLnJhbmdlKHJvd3MpLm1hcChmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgICAgICAgIGQzLnJhbmdlKGNvbHMpLm1hcChmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sIDw9ICRzY29wZS5kYXRhVmFsdWVzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YU9iaiA9ICRzY29wZS5kYXRhVmFsdWVzWyhjb2xzICogcm93KSArIGNvbF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFPYmopIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YU9iai5jb29yZHMgPSBbY29sICogJHNjb3BlLmNlbGxIZWlnaHQsIHJvdyAqICRzY29wZS5jZWxsV2lkdGhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ3JpZERhdGEucHVzaChkYXRhT2JqKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdXBkYXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHJldmVhbERhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5jZWxsLXRleHQnKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5jZWxsLXRleHQtZGV0YWlsJylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgICAgIGQzLnNlbGVjdEFsbCgnLmNlbGwtcGF1c2UtcmVzdW1lLWljb24nKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBoaWRlRGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGQzLnNlbGVjdEFsbCgnLmNlbGwtdGV4dCcpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICBkMy5zZWxlY3RBbGwoJy5jZWxsLXRleHQtZGV0YWlsJylcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICAgICAgZDMuc2VsZWN0QWxsKCcuY2VsbC1wYXVzZS1yZXN1bWUtaWNvbicpXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBjb2xzID0gJHNjb3BlLmNvbHVtbnMgPyAkc2NvcGUuY29sdW1ucyA6IE1hdGguZmxvb3Iod2lkdGggLyAkc2NvcGUuY2VsbFdpZHRoKTtcbiAgICAgICAgICAgIHJvd3MgPSAkc2NvcGUucm93cyA/ICRzY29wZS5yb3dzIDogTWF0aC5jZWlsKCRzY29wZS5kYXRhVmFsdWVzLmxlbmd0aCAvIGNvbHMpO1xuXG4gICAgICAgICAgICB2YXIgdGlja1ZhbHVlcyA9IEFycmF5LmFwcGx5KG51bGwsIHtsZW5ndGg6IHJvd3N9KS5tYXAoTnVtYmVyLmNhbGwsIE51bWJlcik7XG5cbiAgICAgICAgICAgIHZhciB6b29tID0gZDMuYmVoYXZpb3Iuem9vbSgpXG4gICAgICAgICAgICAgICAgLnNjYWxlRXh0ZW50KFsxLCA2XSlcbiAgICAgICAgICAgICAgICAvLy5jZW50ZXIoWzAsIDBdKVxuICAgICAgICAgICAgICAgIC5vbignem9vbScsIHpvb21lZCk7XG5cbiAgICAgICAgICAgIGlmICgkc2NvcGUuZW5hYmxlWm9vbSkge1xuICAgICAgICAgICAgICAgIHN2ZyA9IGQzLnNlbGVjdCgnLmdyaWQtY2hhcnQnKS5hcHBlbmQoJ3N2ZycpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHdpZHRoKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgaGVpZ2h0KVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCdnJylcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoem9vbSlcbiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgnZycpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgkc2NvcGUuZW5hYmxlVG9vbHRpcCkge1xuICAgICAgICAgICAgICAgIHN2ZyA9IGQzLnNlbGVjdCgnLmdyaWQtY2hhcnQnKS5hcHBlbmQoJ3N2ZycpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHdpZHRoKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgaGVpZ2h0KVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCdnJylcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwodGlwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc3ZnID0gZDMuc2VsZWN0KCcuZ3JpZC1jaGFydCcpLmFwcGVuZCgnc3ZnJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgd2lkdGgpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCBoZWlnaHQpXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJ2cnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3ZnLmFwcGVuZCgncmVjdCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ292ZXJsYXknKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHdpZHRoKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCBoZWlnaHQpO1xuXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnNob3dBeGVzKSB7XG4gICAgICAgICAgICAgICAgdmFyIHkgPSBkMy5zY2FsZS5saW5lYXIoKVxuICAgICAgICAgICAgICAgICAgICAuZG9tYWluKFswLCByb3dzXSlcbiAgICAgICAgICAgICAgICAgICAgLnJhbmdlKFswLCBoZWlnaHQtMTBdKTtcblxuICAgICAgICAgICAgICAgIHZhciB5QXhpcyA9IGQzLnN2Zy5heGlzKClcbiAgICAgICAgICAgICAgICAgICAgLnNjYWxlKHkpXG4gICAgICAgICAgICAgICAgICAgIC5vcmllbnQoJ2xlZnQnKVxuICAgICAgICAgICAgICAgICAgICAudGlja1ZhbHVlcyh0aWNrVmFsdWVzKTtcblxuICAgICAgICAgICAgICAgIHN2Zy5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyAyNSArICcsJyArIDAgKyAnKScpXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAneSBheGlzJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIDAgKyAnLCcgKyAkc2NvcGUuY2VsbEhlaWdodCAvIDIgKyAnKScpXG4gICAgICAgICAgICAgICAgICAgIC5jYWxsKHlBeGlzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZ2V0RGF0YVZhbHVlcyhkYXRhKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gem9vbWVkKCkge1xuICAgICAgICAgICAgICAgIHZhciBzID0gZDMuZXZlbnQuc2NhbGU7XG5cbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmVuYWJsZVJldmVhbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocyA+IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldmVhbERhdGEoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpZGVEYXRhKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHMgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5zaG93QXhlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgem9vbS50cmFuc2xhdGUoWzI1LCAwXSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB6b29tLnRyYW5zbGF0ZShbMCwgMF0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN2Zy5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyB6b29tLnRyYW5zbGF0ZSgpICsgJylzY2FsZSgnICsgZDMuZXZlbnQuc2NhbGUgKyAnKScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBkcmFnT2Zmc2V0WCA9IDAsXG4gICAgICAgICAgICBkcmFnT2Zmc2V0WSA9IDAsXG4gICAgICAgICAgICBjbGlja09mZnNldFggPSAwLFxuICAgICAgICAgICAgY2xpY2tPZmZzZXRZID0gMDtcblxuICAgICAgICB2YXIgZHJhZyA9IGQzLmJlaGF2aW9yLmRyYWcoKVxuICAgICAgICAgICAgLm9uKCdkcmFnc3RhcnQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8gdHJhY2sgb2Zmc2V0WCBhbmQgb2Zmc2V0WSB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIGRyYWcgYW5kIGNsaWNrXG4gICAgICAgICAgICAgICAgZHJhZ09mZnNldFggPSBkMy5ldmVudC5zb3VyY2VFdmVudC5vZmZzZXRYO1xuICAgICAgICAgICAgICAgIGRyYWdPZmZzZXRZID0gZDMuZXZlbnQuc291cmNlRXZlbnQub2Zmc2V0WTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBnZXRDZWxsRmlsbCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBpZiAoZCAmJiBkLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnN0YXR1cy5nZXRDZWxsRmlsbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICdub25lJztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbFRleHQgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5nZXRDZWxsVGV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRDZWxsQWN0aXZpdHkgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQgJiYgZC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5zdGF0dXMuZ2V0Q2VsbEFjdGl2aXR5KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldENlbGxQYXVzZVJlc3VtZSA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBpZiAoZCAmJiBkLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnN0YXR1cy5nZXRDZWxsUGF1c2VSZXN1bWUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbEFjdGl2aXR5VG90YWwgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQgJiYgZC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5zdGF0dXMuZ2V0Q2VsbEFjdGl2aXR5VG90YWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbFRpdGxlID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGlmIChkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQuZ2V0Q2VsbFRpdGxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldENlbGxFcnJvciA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBpZiAoZCAmJiBkLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnN0YXR1cy5nZXRDZWxsRXJyb3IoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAnRmFpbGVkOiBVbmF2YWlsYWJsZSc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldENlbGxUb3RhbCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBpZiAoZCAmJiBkLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnN0YXR1cy5nZXRDZWxsVG90YWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAnQ29tcGxldGVkOiBVbmF2YWlsYWJsZSc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldENlbGxTdGF0dXMgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgaWYgKGQgJiYgZC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnTm9kZScpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQuc3RhdHVzLmdldENlbGxTdGF0dXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJ1N0YXR1cyBVbmF2YWlsYWJsZSc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldENlbGxKb2JzID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGlmIChkICYmIGQuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGQudG9TdHJpbmcoKSA9PT0gJ05vZGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkLnN0YXR1cy5nZXRDZWxsSm9icygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Q2VsbEZhaWx1cmVzID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGlmIChkICYmIGQuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGQudG9TdHJpbmcoKSA9PT0gJ0pvYlR5cGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkLnN0YXR1cy5nZXRDZWxsRmFpbHVyZXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGNlbGxDbGlja0hhbmRsZXIgPSBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICAgICAgICAvLyB0cmFjayBvZmZzZXRYIGFuZCBvZmZzZXRZIHRvIGRpc3Rpbmd1aXNoIGJldHdlZW4gZHJhZyBhbmQgY2xpY2tcbiAgICAgICAgICAgIGNsaWNrT2Zmc2V0WCA9IGQzLmV2ZW50Lm9mZnNldFg7XG4gICAgICAgICAgICBjbGlja09mZnNldFkgPSBkMy5ldmVudC5vZmZzZXRZO1xuICAgICAgICAgICAgaWYgKGRyYWdPZmZzZXRYID09PSBjbGlja09mZnNldFggJiYgZHJhZ09mZnNldFkgPT09IGNsaWNrT2Zmc2V0WSkge1xuICAgICAgICAgICAgICAgIC8vIG9mZnNldHMgYXJlIHRoZSBzYW1lOyBubyBkcmFnZ2luZyBvY2N1cnJlZDsgcHJvY2VzcyBhcyBjbGljayBldmVudFxuICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LnRvU3RyaW5nKCkgPT09ICdKb2JUeXBlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9qb2JzJykuc2VhcmNoKCdqb2JfdHlwZV9pZCcsIHRhcmdldC5pZCkuc2VhcmNoKCdzdGF0dXMnLCB0YXJnZXQuc3RhdHVzLmhhc19ydW5uaW5nLnN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0LnRvU3RyaW5nKCkgPT09ICdOb2RlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ub2Rlcy8nICsgdGFyZ2V0LmlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciB1cGRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBEQVRBIEpPSU5cbiAgICAgICAgICAgIC8vIEpvaW4gbmV3IGRhdGEgd2l0aCBvbGQgZWxlbWVudHMsIGlmIGFueS5cbiAgICAgICAgICAgIGlmICgkc2NvcGUuZW5hYmxlVG9vbHRpcCkge1xuICAgICAgICAgICAgICAgIHZhciBjb250YWluZXJHcm91cCA9IHN2Zy5zZWxlY3RBbGwoJy5jZWxsLWdyb3VwJylcbiAgICAgICAgICAgICAgICAgICAgLmRhdGEoJHNjb3BlLmdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgICAgIC5vbignbW91c2VvdmVyJywgdGlwLnNob3cpXG4gICAgICAgICAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCB0aXAuaGlkZSlcbiAgICAgICAgICAgICAgICAgICAgLm9uKCdjbGljaycsIHRpcC5oaWRlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbnRhaW5lckdyb3VwID0gc3ZnLnNlbGVjdEFsbCgnLmNlbGwtZ3JvdXAnKVxuICAgICAgICAgICAgICAgICAgICAuZGF0YSgkc2NvcGUuZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFVQREFURVxuICAgICAgICAgICAgLy8gVXBkYXRlIG9sZCBlbGVtZW50cyBhcyBuZWVkZWQuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsJylcbiAgICAgICAgICAgICAgICAuZGF0YSgkc2NvcGUuZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSlcbiAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgLmR1cmF0aW9uKDc1MClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkID8gJyNmZmYnIDogJ25vbmUnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxGaWxsKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLWZhaWx1cmUtc3lzdGVtJylcbiAgICAgICAgICAgICAgICAuZGF0YSgkc2NvcGUuZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSlcbiAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgLmR1cmF0aW9uKDc1MClcbiAgICAgICAgICAgICAgICAuYXR0cigneCcsIDApXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3knLCAwKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuY2VsbFdpZHRoIC8gZmFpbHVyZXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuY2VsbFdpZHRoO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmVzID0gZ2V0Q2VsbEZhaWx1cmVzKGQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoXy5maW5kV2hlcmUoZmFpbHVyZXMsICdTWVNURU0nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcjMUY3N0I0JztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ25vbmUnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRpc3BsYXkgPSBfLmZpbmRXaGVyZShnZXRDZWxsRmFpbHVyZXMoZCksICdTWVNURU0nKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRpc3BsYXkgPyAnYmxvY2snIDogJ25vbmUnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2UnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC50b1N0cmluZygpID09PSAnSm9iVHlwZScgPyAnI2ZmZicgOiAnbm9uZSc7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtZmFpbHVyZS1kYXRhJylcbiAgICAgICAgICAgICAgICAuZGF0YSgkc2NvcGUuZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSlcbiAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgLmR1cmF0aW9uKDc1MClcbiAgICAgICAgICAgICAgICAuYXR0cigneCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfLmZpbmRXaGVyZShmYWlsdXJlcywgJ1NZU1RFTScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5jZWxsV2lkdGggLyBmYWlsdXJlcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cigneScsIDApXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmVzID0gZ2V0Q2VsbEZhaWx1cmVzKGQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbHVyZXMgJiYgZmFpbHVyZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5jZWxsV2lkdGggLyBmYWlsdXJlcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5jZWxsV2lkdGg7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfLmZpbmRXaGVyZShmYWlsdXJlcywgJ0RBVEEnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcjRkY3RjBFJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ25vbmUnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRpc3BsYXkgPSBfLmZpbmRXaGVyZShnZXRDZWxsRmFpbHVyZXMoZCksICdEQVRBJyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkaXNwbGF5ID8gJ2Jsb2NrJyA6ICdub25lJztcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQudG9TdHJpbmcoKSA9PT0gJ0pvYlR5cGUnID8gJyNmZmYnIDogJ25vbmUnO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLWZhaWx1cmUtYWxnb3JpdGhtJylcbiAgICAgICAgICAgICAgICAuZGF0YSgkc2NvcGUuZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSlcbiAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgLmR1cmF0aW9uKDc1MClcbiAgICAgICAgICAgICAgICAuYXR0cigneCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZhaWx1cmVzICYmIGZhaWx1cmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfLmZpbmRXaGVyZShmYWlsdXJlcywgJ0RBVEEnKSAmJiBfLmZpbmRXaGVyZShmYWlsdXJlcywgJ1NZU1RFTScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgkc2NvcGUuY2VsbFdpZHRoIC8gZmFpbHVyZXMubGVuZ3RoKSArICgkc2NvcGUuY2VsbFdpZHRoIC8gZmFpbHVyZXMubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoXy5maW5kV2hlcmUoZmFpbHVyZXMsICdEQVRBJykgJiYgIV8uZmluZFdoZXJlKGZhaWx1cmVzLCAnU1lTVEVNJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmNlbGxXaWR0aCAvIGZhaWx1cmVzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoXy5maW5kV2hlcmUoZmFpbHVyZXMsICdTWVNURU0nKSAmJiAhXy5maW5kV2hlcmUoZmFpbHVyZXMsICdEQVRBJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmNlbGxXaWR0aCAvIGZhaWx1cmVzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgMClcbiAgICAgICAgICAgICAgICAuYXR0cignd2lkdGgnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZXMgPSBnZXRDZWxsRmFpbHVyZXMoZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlcyAmJiBmYWlsdXJlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigkc2NvcGUuY2VsbFdpZHRoIC8gZmFpbHVyZXMubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmNlbGxXaWR0aDtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlcyA9IGdldENlbGxGYWlsdXJlcyhkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKF8uZmluZFdoZXJlKGZhaWx1cmVzLCAnQUxHT1JJVEhNJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnIzJDQTAyQyc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdub25lJztcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkaXNwbGF5ID0gXy5maW5kV2hlcmUoZ2V0Q2VsbEZhaWx1cmVzKGQpLCAnQUxHT1JJVEhNJyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkaXNwbGF5ID8gJ2Jsb2NrJyA6ICdub25lJztcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQudG9TdHJpbmcoKSA9PT0gJ0pvYlR5cGUnID8gJyNmZmYnIDogJ25vbmUnO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLXRleHQnKVxuICAgICAgICAgICAgICAgIC5kYXRhKCRzY29wZS5ncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsVGV4dChkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC10b3RhbC1hY3RpdmUnKVxuICAgICAgICAgICAgICAgIC5kYXRhKCRzY29wZS5ncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkLnRvU3RyaW5nKCkgPT09ICdKb2JUeXBlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxBY3Rpdml0eVRvdGFsKGQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtcGF1c2UtcmVzdW1lLWljb24nKVxuICAgICAgICAgICAgICAgIC5kYXRhKCRzY29wZS5ncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsUGF1c2VSZXN1bWUoZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtYWN0aXZpdHktaWNvbicpXG4gICAgICAgICAgICAgICAgLmRhdGEoJHNjb3BlLmdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxBY3Rpdml0eShkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC10aXRsZScpXG4gICAgICAgICAgICAgICAgLmRhdGEoJHNjb3BlLmdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxUaXRsZShkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC1lcnJvcicpXG4gICAgICAgICAgICAgICAgLmRhdGEoJHNjb3BlLmdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxFcnJvcihkLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC10b3RhbCcpXG4gICAgICAgICAgICAgICAgLmRhdGEoJHNjb3BlLmdyaWREYXRhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jb29yZHM7IH0pXG4gICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldENlbGxUb3RhbChkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC1zdGF0dXMnKVxuICAgICAgICAgICAgICAgIC5kYXRhKCRzY29wZS5ncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsU3RhdHVzKGQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsLWpvYnMnKVxuICAgICAgICAgICAgICAgIC5kYXRhKCRzY29wZS5ncmlkRGF0YSwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuY29vcmRzOyB9KVxuICAgICAgICAgICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsSm9icyhkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC1vdmVybGF5JylcbiAgICAgICAgICAgICAgICAuZGF0YSgkc2NvcGUuZ3JpZERhdGEsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNvb3JkczsgfSlcbiAgICAgICAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24gKHRhcmdldCkge1xuICAgICAgICAgICAgICAgICAgICBjZWxsQ2xpY2tIYW5kbGVyKHRhcmdldCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIEVOVEVSXG4gICAgICAgICAgICAvLyBDcmVhdGUgbmV3IGVsZW1lbnRzIGFzIG5lZWRlZC5cbiAgICAgICAgICAgIHZhciBjZWxsR3JvdXAgPSBjb250YWluZXJHcm91cC5lbnRlcigpXG4gICAgICAgICAgICAgICAgLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtZ3JvdXAnKTtcblxuICAgICAgICAgICAgY2VsbEdyb3VwLmFwcGVuZCgncmVjdCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsICRzY29wZS5jZWxsV2lkdGgpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2hlaWdodCcsICRzY29wZS5jZWxsSGVpZ2h0KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsRmlsbChkKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQgPyAnI2ZmZicgOiAnbm9uZSc7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgLmR1cmF0aW9uKDc1MCk7XG5cbiAgICAgICAgICAgIGNlbGxHcm91cC5hcHBlbmQoJ3JlY3QnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLWZhaWx1cmUtc3lzdGVtJylcbiAgICAgICAgICAgICAgICAuYXR0cignd2lkdGgnLCAkc2NvcGUuY2VsbFdpZHRoIC0gMilcbiAgICAgICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgJHNjb3BlLmNlbGxIZWlnaHQgLyA3KVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgMClcbiAgICAgICAgICAgICAgICAuYXR0cigneScsIDApXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgJ25vbmUnKTtcblxuICAgICAgICAgICAgY2VsbEdyb3VwLmFwcGVuZCgncmVjdCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtZmFpbHVyZS1kYXRhJylcbiAgICAgICAgICAgICAgICAuYXR0cignd2lkdGgnLCAkc2NvcGUuY2VsbFdpZHRoIC0gMilcbiAgICAgICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgJHNjb3BlLmNlbGxIZWlnaHQgLyA3KVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgMClcbiAgICAgICAgICAgICAgICAuYXR0cigneScsIDApXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgJ25vbmUnKTtcblxuICAgICAgICAgICAgY2VsbEdyb3VwLmFwcGVuZCgncmVjdCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtZmFpbHVyZS1hbGdvcml0aG0nKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsICRzY29wZS5jZWxsV2lkdGggLSAyKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCAkc2NvcGUuY2VsbEhlaWdodCAvIDcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCAwKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgMClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnbm9uZScpO1xuXG4gICAgICAgICAgICBjZWxsR3JvdXAuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC10ZXh0JylcbiAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbFRleHQoZCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnbWlkZGxlJylcbiAgICAgICAgICAgICAgICAuYXR0cigneCcsICRzY29wZS5jZWxsV2lkdGggLyAyKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgKCRzY29wZS5jZWxsSGVpZ2h0IC8gMikgKyA4KVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZGlzcGxheScsICRzY29wZS5lbmFibGVSZXZlYWwgPyAnYmxvY2snIDogJ25vbmUnKTtcblxuICAgICAgICAgICAgY2VsbEdyb3VwLmFwcGVuZCgndGV4dCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtdG90YWwtYWN0aXZlJylcbiAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZC50b1N0cmluZygpID09PSAnSm9iVHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsQWN0aXZpdHlUb3RhbChkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ2VuZCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCAkc2NvcGUuY2VsbFdpZHRoIC0gMilcbiAgICAgICAgICAgICAgICAuYXR0cigneScsICRzY29wZS5jZWxsSGVpZ2h0IC0gNSlcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2Rpc3BsYXknLCAkc2NvcGUuZW5hYmxlUmV2ZWFsID8gJ2Jsb2NrJyA6ICdub25lJyk7XG5cbiAgICAgICAgICAgIGNlbGxHcm91cC5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLWFjdGl2aXR5JylcbiAgICAgICAgICAgICAgICAuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC1hY3Rpdml0eS1pY29uJylcbiAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEFjdGl2aXR5KGQpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ3N0YXJ0JylcbiAgICAgICAgICAgICAgICAuYXR0cigneCcsIDIpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3knLCAkc2NvcGUuY2VsbEhlaWdodCAtIDQpO1xuXG4gICAgICAgICAgICB2YXIgZGV0YWlsID0gY2VsbEdyb3VwLmFwcGVuZCgndGV4dCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtdGV4dC1kZXRhaWwnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgJHNjb3BlLmNlbGxXaWR0aCAvIDIpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3knLCBNYXRoLmZsb29yKCRzY29wZS5jZWxsSGVpZ2h0ICouMTUpKSAvLyAxNSUgZnJvbSB0b3Agb2YgY2VsbFxuICAgICAgICAgICAgICAgIC5hdHRyKCdkeScsIDApXG4gICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgJHNjb3BlLmVuYWJsZVJldmVhbCA/ICdub25lJyA6ICdibG9jaycpO1xuXG4gICAgICAgICAgICBkZXRhaWwuYXBwZW5kKCd0c3BhbicpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtdGl0bGUnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgJHNjb3BlLmNlbGxXaWR0aCAvIDIpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3knLCBNYXRoLmZsb29yKCRzY29wZS5jZWxsSGVpZ2h0ICogLjE1KSkgLy8gMTUlIGZyb20gdG9wIG9mIGNlbGxcbiAgICAgICAgICAgICAgICAuYXR0cignZHknLCAwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgY2VsbEZvbnRTbSAqIHNjYWxlICsgJ2VtJylcbiAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbFRpdGxlKGQpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhbGwod3JhcCk7XG5cbiAgICAgICAgICAgIGRldGFpbC5hcHBlbmQoJ3RzcGFuJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC1lcnJvcicpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCAkc2NvcGUuY2VsbFdpZHRoIC8gMilcbiAgICAgICAgICAgICAgICAuYXR0cigneScsIE1hdGguZmxvb3IoJHNjb3BlLmNlbGxIZWlnaHQgKi4zKSkgLy8gMzAlIGZyb20gdG9wIG9mIGNlbGxcbiAgICAgICAgICAgICAgICAuYXR0cignZHknLCAwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgY2VsbEZvbnRTbSAqIHNjYWxlICsgJ2VtJylcbiAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEVycm9yKGQpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhbGwod3JhcCk7XG5cbiAgICAgICAgICAgIGRldGFpbC5hcHBlbmQoJ3RzcGFuJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC10b3RhbCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCAkc2NvcGUuY2VsbFdpZHRoIC8gMilcbiAgICAgICAgICAgICAgICAuYXR0cigneScsIE1hdGguZmxvb3IoJHNjb3BlLmNlbGxIZWlnaHQgKi40KSkgLy8gNDAlIGZyb20gdG9wIG9mIGNlbGxcbiAgICAgICAgICAgICAgICAuYXR0cignZHknLCAwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgY2VsbEZvbnRTbSAqIHNjYWxlICsgJ2VtJylcbiAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbFRvdGFsKGQpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhbGwod3JhcCk7XG5cbiAgICAgICAgICAgIGRldGFpbC5hcHBlbmQoJ3RzcGFuJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnY2VsbC1zdGF0dXMnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgJHNjb3BlLmNlbGxXaWR0aCAvIDIpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3knLCBNYXRoLmZsb29yKCRzY29wZS5jZWxsSGVpZ2h0ICogLjU1KSkgLy8gNTUlIGZyb20gdG9wIG9mIGNlbGxcbiAgICAgICAgICAgICAgICAuYXR0cignZHknLCAwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgY2VsbEZvbnRMZyAqIHNjYWxlICsgJ2VtJylcbiAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbFN0YXR1cyhkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZGV0YWlsLmFwcGVuZCgndHNwYW4nKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLWpvYnMnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgJHNjb3BlLmNlbGxXaWR0aCAvIDIpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3knLCBNYXRoLmZsb29yKCRzY29wZS5jZWxsSGVpZ2h0ICogLjc1KSkgLy8gNzUlIGZyb20gdG9wIG9mIGNlbGxcbiAgICAgICAgICAgICAgICAuYXR0cignZHknLCAwKVxuICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgY2VsbEZvbnRTbSAqIHNjYWxlICsgJ2VtJylcbiAgICAgICAgICAgICAgICAuaHRtbChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbEpvYnMoZCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2FsbCh3cmFwKTtcblxuICAgICAgICAgICAgY2VsbEdyb3VwLmFwcGVuZCgncmVjdCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtb3ZlcmxheScpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgJHNjb3BlLmNlbGxXaWR0aClcbiAgICAgICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgJHNjb3BlLmNlbGxIZWlnaHQpXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdChkMy5zZWxlY3QodGhpcylbMF1bMF0ucGFyZW50RWxlbWVudC5jaGlsZHJlblswXSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbC1vcGFjaXR5JywgJzAuNzUnKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdChkMy5zZWxlY3QodGhpcylbMF1bMF0ucGFyZW50RWxlbWVudC5jaGlsZHJlblswXSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbC1vcGFjaXR5JywgJzEuMCcpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKCdjbGljaycsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNlbGxDbGlja0hhbmRsZXIoZCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2FsbChkcmFnKTtcblxuICAgICAgICAgICAgaWYgKCRzY29wZS51c2VyICYmICRzY29wZS51c2VyLmlzX2FkbWluKSB7XG4gICAgICAgICAgICAgICAgY2VsbEdyb3VwLmFwcGVuZCgndGV4dCcpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdjZWxsLXBhdXNlLXJlc3VtZS1pY29uJylcbiAgICAgICAgICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsUGF1c2VSZXN1bWUoZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdzdGFydCcpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgNSlcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3knLCAyMClcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdkaXNwbGF5JywgJHNjb3BlLmVuYWJsZVJldmVhbCA/ICdub25lJyA6ICdibG9jaycpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgJzEuM2VtJylcbiAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2N1cnNvcicsICdwb2ludGVyJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfYmx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnd2hpdGUnKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLm9uKCdjbGljaycsIGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXVzZVJlc3VtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0RGF0YSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQgJiYgdGFyZ2V0LnN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXREYXRhID0gdGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXREYXRhLnN0YXR1cy5wYXVzZVJlc3VtZUNlbGwoJHNjb3BlLnBhdXNlUmVhc29uKS50aGVuKGZ1bmN0aW9uICh1cGRhdGVkRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldERhdGEudG9TdHJpbmcoKSA9PT0gJ05vZGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIHRhcmdldCBkYXRhIHZhbHVlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldERhdGEuaXNfcGF1c2VkID0gdXBkYXRlZERhdGEuaXNfcGF1c2VkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldERhdGEucGF1c2VfcmVhc29uID0gdXBkYXRlZERhdGEucGF1c2VfcmVhc29uO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldERhdGEuc3RhdHVzLm5vZGUgPSB1cGRhdGVkRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3VwZGF0ZU5vZGVIZWFsdGgnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBncmlkIGNlbGxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNlbGxGaWxsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVQYXVzZVJlc3VtZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ2VsbFN0YXR1cygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IHByb21wdCBmb3IgcmVhc29uIHdoZW4gcGF1c2luZyAobm90IHJlc3VtaW5nKVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0YXJnZXQuaXNfcGF1c2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdwYXVzZURpYWxvZy5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdXNlUmVzdW1lKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdXNlUmVzdW1lKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBFTlRFUiArIFVQREFURVxuICAgICAgICAgICAgLy8gQXBwZW5kaW5nIHRvIHRoZSBlbnRlciBzZWxlY3Rpb24gZXhwYW5kcyB0aGUgdXBkYXRlIHNlbGVjdGlvbiB0byBpbmNsdWRlXG4gICAgICAgICAgICAvLyBlbnRlcmluZyBlbGVtZW50czsgc28sIG9wZXJhdGlvbnMgb24gdGhlIHVwZGF0ZSBzZWxlY3Rpb24gYWZ0ZXIgYXBwZW5kaW5nIHRvXG4gICAgICAgICAgICAvLyB0aGUgZW50ZXIgc2VsZWN0aW9uIHdpbGwgYXBwbHkgdG8gYm90aCBlbnRlcmluZyBhbmQgdXBkYXRpbmcgbm9kZXMuXG4gICAgICAgICAgICBjb250YWluZXJHcm91cC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgICAgICAuZHVyYXRpb24oNzUwKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3RyYW5zbGF0ZSgnICsgZC5jb29yZHMgKyAnKSc7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciB1cGRhdGVDZWxsRmlsbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjb250YWluZXJHcm91cC5zZWxlY3RBbGwoJy5jZWxsJylcbiAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgICAgICAuZHVyYXRpb24oMjUwKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZCA/ICcjZmZmJyA6ICdub25lJztcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsRmlsbChkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgdXBkYXRlUGF1c2VSZXN1bWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuc2VsZWN0QWxsKCcuY2VsbC1wYXVzZS1yZXN1bWUtaWNvbicpXG4gICAgICAgICAgICAgICAgICAgIC5odG1sKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q2VsbFBhdXNlUmVzdW1lKGQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciB1cGRhdGVDZWxsU3RhdHVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lckdyb3VwLnNlbGVjdEFsbCgnLmNlbGwtc3RhdHVzJylcbiAgICAgICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRDZWxsU3RhdHVzKGQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIEVYSVRcbiAgICAgICAgICAgIC8vIFJlbW92ZSBvbGQgZWxlbWVudHMgYXMgbmVlZGVkLlxuICAgICAgICAgICAgY29udGFpbmVyR3JvdXAuZXhpdCgpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NlbGwtZXhpdCcpXG4gICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgICAgIC5kdXJhdGlvbig3NTApXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoMCwwKScpXG4gICAgICAgICAgICAgICAgLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiB3cmFwICh0ZXh0LCB3aWR0aCkge1xuICAgICAgICAgICAgICAgIHRleHQuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gZDMuc2VsZWN0KHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZHMgPSB0ZXh0LnRleHQoKS5zcGxpdCgvXFxzKy8pLnJldmVyc2UoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmQsXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lID0gW10sXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lTnVtYmVyID0gMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQgPSAxLjEsXG4gICAgICAgICAgICAgICAgICAgICAgICB5ID0gdGV4dC5hdHRyKCd5JyksXG4gICAgICAgICAgICAgICAgICAgICAgICBkeSA9IHBhcnNlRmxvYXQodGV4dC5hdHRyKCdkeScpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRzcGFuID0gdGV4dC50ZXh0KG51bGwpLmFwcGVuZCgndHNwYW4nKS5hdHRyKCd4JywgJHNjb3BlLmNlbGxXaWR0aCAvIDIpLmF0dHIoJ3knLCB5KS5hdHRyKCdkeScsIGR5ICsgJ2VtJyk7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICh3b3JkID0gd29yZHMucG9wKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3b3JkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUucHVzaCh3b3JkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0c3Bhbi50ZXh0KGxpbmUuam9pbignICcpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHNwYW4ubm9kZSgpLmdldENvbXB1dGVkVGV4dExlbmd0aCgpID4gKCRzY29wZS5jZWxsV2lkdGggLSAxMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZS5wb3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHNwYW4udGV4dChsaW5lLmpvaW4oJyAnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSBbd29yZF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRzcGFuID0gdGV4dC5hcHBlbmQoJ3RzcGFuJykuYXR0cigneCcsICRzY29wZS5jZWxsV2lkdGggLyAyKS5hdHRyKCd5JywgeSkuYXR0cignZHknLCArK2xpbmVOdW1iZXIgKiBsaW5lSGVpZ2h0ICsgZHkgKyAnZW0nKS50ZXh0KHdvcmQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ2RhdGEnLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKF8ua2V5cyhkYXRhKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgJCgnLmdyaWQtY2hhcnQnKS5lbXB0eSgpO1xuICAgICAgICAgICAgICAgIGluaXRpYWxpemUoZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kb24oJ3JlZHJhd0dyaWQnLCBmdW5jdGlvbiAoZXZlbnQsIGRhdGEpIHtcbiAgICAgICAgICAgIGdldERhdGFWYWx1ZXMoZGF0YSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZGlyZWN0aXZlKCdhaXNHcmlkQ2hhcnQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzR3JpZENoYXJ0Q29udHJvbGxlcicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvY2hhcnRzL2dyaWQvZ3JpZENoYXJ0VGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBkYXRhOiAnPScsXG4gICAgICAgICAgICAgICAgaWNvbnM6ICc9JywgLy8gaW5kaWNhdGVzIHdoZXRoZXIgY2VsbC10ZXh0IGlzIGVudGlyZWx5IG1hZGUgdXAgb2YgaWNvbnNcbiAgICAgICAgICAgICAgICBzY2FsZTogJz0nLCAvLyBtdWx0aXBsaWVyIHRvIGluY3JlYXNlIGNlbGwgc2l6ZVxuICAgICAgICAgICAgICAgIHJldmVhbDogJz0nLCAvLyBpZiB0cnVlLCBsZXNzIGRhdGEgd2lsbCBzaG93IHdoZW4gem9vbWVkIG91dFxuICAgICAgICAgICAgICAgIG1vZGU6ICdAJywgLy8gdmFsaWQgdmFsdWVzIGFyZSB6b29tIG9yIHRvb2x0aXBcbiAgICAgICAgICAgICAgICBjb2x1bW5zOiAnPScsXG4gICAgICAgICAgICAgICAgcm93czogJz0nLFxuICAgICAgICAgICAgICAgIHNob3dBeGVzOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc0pvYkxvYWRDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSwgbG9hZFNlcnZpY2UpIHtcbiAgICAgICAgdmFyIGNoYXJ0ID0gbnVsbCxcbiAgICAgICAgICAgIGNvbEFyciA9IFtdLFxuICAgICAgICAgICAgeEFyciA9IFtdLFxuICAgICAgICAgICAgcGVuZGluZ0FyciA9IFtdLFxuICAgICAgICAgICAgcXVldWVkQXJyID0gW10sXG4gICAgICAgICAgICBydW5uaW5nQXJyID0gW10sXG4gICAgICAgICAgICByZW1vdmVJZHMgPSBbXSxcbiAgICAgICAgICAgIGxlZ2VuZEhpZGUgPSBbXTtcblxuICAgICAgICAkc2NvcGUuZmlsdGVyVmFsdWUgPSAxO1xuICAgICAgICAkc2NvcGUuZmlsdGVyRHVyYXRpb24gPSAndyc7XG4gICAgICAgICRzY29wZS5maWx0ZXJEdXJhdGlvbnMgPSBbJ00nLCAndycsICdkJ107XG4gICAgICAgICRzY29wZS56b29tRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICAkc2NvcGUuem9vbUNsYXNzID0gJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgJHNjb3BlLnpvb21UZXh0ID0gJ0VuYWJsZSBab29tJztcbiAgICAgICAgJHNjb3BlLmpvYkxvYWREYXRhID0ge307XG4gICAgICAgICRzY29wZS5sb2FkaW5nSm9iTG9hZCA9IHRydWU7XG4gICAgICAgICRzY29wZS5qb2JMb2FkRXJyb3IgPSBudWxsO1xuICAgICAgICAkc2NvcGUuam9iTG9hZEVycm9yU3RhdHVzID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLnRvdGFsID0gMDtcbiAgICAgICAgJHNjb3BlLmNoYXJ0U3R5bGUgPSAnJztcblxuICAgICAgICB2YXIgam9iTG9hZFBhcmFtcyA9IHtcbiAgICAgICAgICAgIHN0YXJ0ZWQ6IG1vbWVudC51dGMoKS5zdWJ0cmFjdCgkc2NvcGUuZmlsdGVyVmFsdWUsICRzY29wZS5maWx0ZXJEdXJhdGlvbikuc3RhcnRPZignZCcpLnRvRGF0ZSgpLCBlbmRlZDogbW9tZW50LnV0YygpLmVuZE9mKCdkJykudG9EYXRlKCksIGpvYl90eXBlX2lkOiBudWxsLCBqb2JfdHlwZV9uYW1lOiBudWxsLCBqb2JfdHlwZV9jYXRlZ29yeTogbnVsbCwgdXJsOiBudWxsXG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnRvZ2dsZVpvb20gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc2NvcGUuem9vbUVuYWJsZWQgPSAhJHNjb3BlLnpvb21FbmFibGVkO1xuICAgICAgICAgICAgY2hhcnQuem9vbS5lbmFibGUoJHNjb3BlLnpvb21FbmFibGVkKTtcbiAgICAgICAgICAgIGlmICgkc2NvcGUuem9vbUVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuem9vbUNsYXNzID0gJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgICAgICAgICAkc2NvcGUuem9vbVRleHQgPSAnRGlzYWJsZSBab29tJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnpvb21DbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnpvb21UZXh0ID0gJ0VuYWJsZSBab29tJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdENoYXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29sQXJyID0gW107XG4gICAgICAgICAgICB4QXJyID0gW107XG4gICAgICAgICAgICBwZW5kaW5nQXJyID0gW107XG4gICAgICAgICAgICBxdWV1ZWRBcnIgPSBbXTtcbiAgICAgICAgICAgIHJ1bm5pbmdBcnIgPSBbXTtcblxuICAgICAgICAgICAgLypcbiAgICAgICAgICAgIC8vIHggYXhpcyB2YWx1ZXNcbiAgICAgICAgICAgIHZhciBudW1Ib3VycyA9IG1vbWVudC51dGMoam9iTG9hZFBhcmFtcy5lbmRlZCkuZGlmZihtb21lbnQudXRjKGpvYkxvYWRQYXJhbXMuc3RhcnRlZCksICdoJyk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bUhvdXJzOyBpKyspIHtcbiAgICAgICAgICAgICAgICB4QXJyLnB1c2gobW9tZW50LnV0Yyhqb2JMb2FkUGFyYW1zLnN0YXJ0ZWQpLmFkZChpLCAnaCcpLnN0YXJ0T2YoJ2gnKS50b0RhdGUoKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGRhdGEgdmFsdWVzXG4gICAgICAgICAgICBfLmZvckVhY2goeEFyciwgZnVuY3Rpb24gKHhEYXRlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGFPYmogPSBfLmZpbmQoJHNjb3BlLmpvYkxvYWREYXRhLnJlc3VsdHMsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQudXRjKGQudGltZSkuc3RhcnRPZignaCcpLmlzU2FtZSh4RGF0ZSwgJ2hvdXInKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyBwdXNoIDAgaWYgZGF0YSBmb3IgeERhdGUgaXMgbm90IHByZXNlbnQgaW4gcXVlcnlEYXRlc1xuICAgICAgICAgICAgICAgIHBlbmRpbmdBcnIucHVzaChkYXRhT2JqID8gZGF0YU9iai5wZW5kaW5nX2NvdW50IDogMCk7XG4gICAgICAgICAgICAgICAgcXVldWVkQXJyLnB1c2goZGF0YU9iaiA/IGRhdGFPYmoucXVldWVkX2NvdW50IDogMCk7XG4gICAgICAgICAgICAgICAgcnVubmluZ0Fyci5wdXNoKGRhdGFPYmogPyBkYXRhT2JqLnJ1bm5pbmdfY291bnQgOiAwKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB4QXJyLnVuc2hpZnQoJ3gnKTtcbiAgICAgICAgICAgIHBlbmRpbmdBcnIudW5zaGlmdCgnUGVuZGluZycpO1xuICAgICAgICAgICAgcXVldWVkQXJyLnVuc2hpZnQoJ1F1ZXVlZCcpO1xuICAgICAgICAgICAgcnVubmluZ0Fyci51bnNoaWZ0KCdSdW5uaW5nJyk7XG4gICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICB4QXJyID0gXy5wbHVjaygkc2NvcGUuam9iTG9hZERhdGEucmVzdWx0cywgJ3RpbWUnKTtcbiAgICAgICAgICAgIF8uZm9yRWFjaCh4QXJyLCBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICAgICAgICAgIHhBcnJbaV0gPSBtb21lbnQudXRjKGQpLnRvRGF0ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB4QXJyLnVuc2hpZnQoJ3gnKTtcblxuICAgICAgICAgICAgdmFyIHBlbmRpbmdBcnIgPSBfLnBsdWNrKCRzY29wZS5qb2JMb2FkRGF0YS5yZXN1bHRzLCAncGVuZGluZ19jb3VudCcpLFxuICAgICAgICAgICAgICAgIHF1ZXVlZEFyciA9IF8ucGx1Y2soJHNjb3BlLmpvYkxvYWREYXRhLnJlc3VsdHMsICdxdWV1ZWRfY291bnQnKSxcbiAgICAgICAgICAgICAgICBydW5uaW5nQXJyID0gXy5wbHVjaygkc2NvcGUuam9iTG9hZERhdGEucmVzdWx0cywgJ3J1bm5pbmdfY291bnQnKTtcblxuICAgICAgICAgICAgcGVuZGluZ0Fyci51bnNoaWZ0KCdQZW5kaW5nJyk7XG4gICAgICAgICAgICBxdWV1ZWRBcnIudW5zaGlmdCgnUXVldWVkJyk7XG4gICAgICAgICAgICBydW5uaW5nQXJyLnVuc2hpZnQoJ1J1bm5pbmcnKTtcblxuICAgICAgICAgICAgLy8gYWRkIHRvIGNvbEFyclxuICAgICAgICAgICAgY29sQXJyID0gW3hBcnIsIHBlbmRpbmdBcnIsIHF1ZXVlZEFyciwgcnVubmluZ0Fycl07XG5cbiAgICAgICAgICAgIHZhciB0eXBlcyA9IHt9LFxuICAgICAgICAgICAgICAgIHR5cGUgPSB7fSxcbiAgICAgICAgICAgICAgICBncm91cHMgPSBbXTtcblxuICAgICAgICAgICAgXy5mb3JFYWNoKGNvbEFyciwgZnVuY3Rpb24oY29sKXtcbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29sWzBdICE9PSAneCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVbY29sWzBdXSA9ICdhcmVhJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3Vwcy5wdXNoKGNvbFswXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCh0eXBlcywgdHlwZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy9pZiAoY2hhcnQpIHtcbiAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgIGNoYXJ0Lmdyb3VwcyhbZ3JvdXBzXSk7XG4gICAgICAgICAgICAgICAgY2hhcnQubG9hZCh7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbnM6IGNvbEFycixcbiAgICAgICAgICAgICAgICAgICAgdHlwZXM6IHR5cGVzLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICBjaGFydC5mbG93KHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uczogY29sQXJyXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIC8vfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChjaGFydCkge1xuICAgICAgICAgICAgICAgIGNoYXJ0LmZsdXNoKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gY2hhcnQgY29uZmlnXG4gICAgICAgICAgICAgICAgY2hhcnQgPSBjMy5nZW5lcmF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGJpbmR0bzogJyNqb2ItbG9hZCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6ICd4JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnM6IGNvbEFycixcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVzOiB0eXBlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwczogW2dyb3Vwc10sXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQZW5kaW5nOiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfcGluayxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBRdWV1ZWQ6IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9wdXJwbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUnVubmluZzogc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X2JsdWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDcwMFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vbWVudC51dGMoeCkuc3RhcnRPZignaCcpLmZvcm1hdChzY2FsZUNvbmZpZy5kYXRlRm9ybWF0cy5kYXlfc2Vjb25kKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGF4aXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGltZXNlcmllcycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGljazoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50LnV0YyhkKS5mb3JtYXQoc2NhbGVDb25maWcuZGF0ZUZvcm1hdHMuZGF5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy99XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZ0pvYkxvYWQgPSBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Sm9iTG9hZCA9IGZ1bmN0aW9uIChzaG93UGFnZUxvYWQpIHtcbiAgICAgICAgICAgIGlmIChzaG93UGFnZUxvYWQpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHBhcmVudC5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmdKb2JMb2FkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGpvYkxvYWRQYXJhbXMuc3RhcnRlZCA9IG1vbWVudC51dGMoKS5zdWJ0cmFjdCgkc2NvcGUuZmlsdGVyVmFsdWUsICRzY29wZS5maWx0ZXJEdXJhdGlvbikuc3RhcnRPZignZCcpLnRvRGF0ZSgpO1xuICAgICAgICAgICAgam9iTG9hZFBhcmFtcy5lbmRlZCA9IG1vbWVudC51dGMoam9iTG9hZFBhcmFtcy5zdGFydGVkKS5hZGQoMSwgJHNjb3BlLmZpbHRlckR1cmF0aW9uKS5lbmRPZignZCcpLnRvRGF0ZSgpO1xuICAgICAgICAgICAgam9iTG9hZFBhcmFtcy5wYWdlX3NpemUgPSAxMDAwO1xuXG4gICAgICAgICAgICBsb2FkU2VydmljZS5nZXRKb2JMb2FkKGpvYkxvYWRQYXJhbXMpLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5qb2JMb2FkRGF0YSA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgaW5pdENoYXJ0KCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXNUZXh0ICYmIHJlc3VsdC5zdGF0dXNUZXh0ICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmpvYkxvYWRFcnJvclN0YXR1cyA9IHJlc3VsdC5zdGF0dXNUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5qb2JMb2FkRXJyb3IgPSAnVW5hYmxlIHRvIHJldHJpZXZlIGpvYiBsb2FkLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzaG93UGFnZUxvYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRwYXJlbnQubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nSm9iTG9hZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS51cGRhdGVKb2JMb2FkUmFuZ2UgPSBmdW5jdGlvbiAoYWN0aW9uKSB7XG4gICAgICAgICAgICBpZiAoYWN0aW9uID09PSAnb2xkZXInKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlclZhbHVlKys7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ25ld2VyJykge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZmlsdGVyVmFsdWUgPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXJWYWx1ZS0tO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAndG9kYXknKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlclZhbHVlID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGdldEpvYkxvYWQodHJ1ZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgnZmlsdGVyVmFsdWUnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIHZhciAkam9iTG9hZE5ld2VyID0gJCgnLmpvYi1sb2FkLW5ld2VyJyksXG4gICAgICAgICAgICAgICAgJGpvYkxvYWRUb2RheSA9ICQoJy5qb2ItbG9hZC10b2RheScpO1xuXG4gICAgICAgICAgICBpZiAodmFsdWUgPiAxKSB7XG4gICAgICAgICAgICAgICAgJGpvYkxvYWROZXdlci5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICRqb2JMb2FkVG9kYXkucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJGpvYkxvYWROZXdlci5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICRqb2JMb2FkVG9kYXkuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cblxuICAgICAgICBpZiAoJHNjb3BlLmF1dG9IZWlnaHQpIHtcbiAgICAgICAgICAgIC8vIHNldCBjaGFydCBoZWlnaHRcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vIHNldCBjb250YWluZXIgaGVpZ2h0cyBlcXVhbCB0byBhdmFpbGFibGUgcGFnZSBoZWlnaHRcbiAgICAgICAgICAgICAgICB2YXIgdmlld3BvcnQgPSBzY2FsZVNlcnZpY2UuZ2V0Vmlld3BvcnRTaXplKCksXG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IHNjYWxlQ29uZmlnLmhlYWRlck9mZnNldCxcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyT2Zmc2V0ID0gJCgnLmpvYi1sb2FkLWhlYWRlcicpLmhlaWdodCgpLFxuICAgICAgICAgICAgICAgICAgICBsZWdlbmRPZmZzZXQgPSAkKCcuam9iLWxvYWQtbGVnZW5kLWxhYmVsJykuaGVpZ2h0KCksXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlck9mZnNldCA9ICQoJy5qb2ItbG9hZC1maWx0ZXInKS5vdXRlckhlaWdodCh0cnVlKSxcbiAgICAgICAgICAgICAgICAgICAgY2hhcnRNYXhIZWlnaHQgPSB2aWV3cG9ydC5oZWlnaHQgLSBvZmZzZXQgLSBoZWFkZXJPZmZzZXQgLSBsZWdlbmRPZmZzZXQgLSBmaWx0ZXJPZmZzZXQgLSA1O1xuXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNoYXJ0U3R5bGUgPSAnaGVpZ2h0OiAnICsgY2hhcnRNYXhIZWlnaHQgKyAncHg7IG1heC1oZWlnaHQ6ICcgKyBjaGFydE1heEhlaWdodCArICdweDsnO1xuICAgICAgICAgICAgICAgIGdldEpvYkxvYWQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2V0Sm9iTG9hZCgpO1xuICAgICAgICB9XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5kaXJlY3RpdmUoJ2Fpc0pvYkxvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzSm9iTG9hZENvbnRyb2xsZXInLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2NoYXJ0cy9qb2JMb2FkL2pvYkxvYWRUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIHNob3dGaWx0ZXI6ICc9JywgLy8gc2hvdyB0aW1lIHJhbmdlIGZpbHRlciBVSVxuICAgICAgICAgICAgICAgIGN1bGxMZWdlbmQ6ICc9JywgLy8gb25seSBzaG93IGpvYiB0eXBlcyBpbiBsZWdlbmQgd2hvc2UgdmFsdWUgaXMgPiAwXG4gICAgICAgICAgICAgICAgaGlkZVRpdGxlOiAnPScsXG4gICAgICAgICAgICAgICAgYXV0b0hlaWdodDogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhaXNSYWRpYWxQZXJjZW50YWdlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGVsZW1lbnQsIHNjYWxlQ29uZmlnKSB7XG4gICAgdmFyIGlzSW5pdGlhbGl6ZWQgPSBmYWxzZSxcbiAgICAgICAgZm9yZWdyb3VuZCA9ICcnLFxuICAgICAgICB0ZXh0ID0gJycsXG4gICAgICAgIGFyY1R3ZWVuID0gJycsXG4gICAgICAgIHRleHRUd2VlbiA9ICcnO1xuXG4gICAgdmFyIGdldEZvcmVncm91bmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHBhcnNlRmxvYXQoJHNjb3BlLnBlcmNlbnRhZ2UpO1xuICAgICAgICBpZiAodmFsdWUgPj0gNzUpIHtcbiAgICAgICAgICAgIHJldHVybiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfZ3JlZW47XG4gICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPCA3NSAmJiB2YWx1ZSA+PSA1MCkge1xuICAgICAgICAgICAgcmV0dXJuIHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF95ZWxsb3c7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X3JlZDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBoYW5kbGUgaW5wdXQgZWl0aGVyIC44MyBvciA4M1xuICAgICAgICB2YXIgcGVyY2VudGFnZSA9ICRzY29wZS5wZXJjZW50YWdlIHx8IDA7XG4gICAgICAgIGlmIChwZXJjZW50YWdlID4gMSkge1xuICAgICAgICAgICAgcGVyY2VudGFnZSAvPSAxMDA7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBzaXplIHRoZSBjaGFydCB0byB0aGUgcGFyZW50IGNvbnRhaW5lci4gSXQncyBzcXVhcmUsIHNvIHRha2UgdGhlXG4gICAgICAgIC8vIHNtYWxsZXIgb2Ygd2lkdGgvaGVpZ2h0XG4gICAgICAgIHZhciBzaXplID0gJGVsZW1lbnRbMF0ucGFyZW50Tm9kZS5jbGllbnRXaWR0aDtcbiAgICAgICAgaWYgKCRlbGVtZW50WzBdLnBhcmVudE5vZGUuY2xpZW50SGVpZ2h0IDwgc2l6ZSkge1xuICAgICAgICAgICAgc2l6ZSA9ICRlbGVtZW50WzBdLnBhcmVudE5vZGUuY2xpZW50SGVpZ2h0O1xuICAgICAgICB9XG5cblxuICAgICAgICB2YXIgZHVyYXRpb24gPSAxMDAwO1xuICAgICAgICB2YXIgZm9ybWF0UGVyY2VudCA9IGQzLmZvcm1hdCgnLjAlJyk7XG5cbiAgICAgICAgdmFyIGFyYyA9IGQzLnN2Zy5hcmMoKVxuICAgICAgICAgICAgLnN0YXJ0QW5nbGUoMClcbiAgICAgICAgICAgIC5vdXRlclJhZGl1cyhzaXplICogMC45NSAvIDIpXG4gICAgICAgICAgICAuaW5uZXJSYWRpdXMoc2l6ZSAqIDAuODAgLyAyKTtcblxuICAgICAgICB2YXIgc3ZnID0gZDMuc2VsZWN0KCRlbGVtZW50WzBdKS5hcHBlbmQoJ3N2ZycpLmF0dHIoe1xuICAgICAgICAgICAgd2lkdGg6IHNpemUsXG4gICAgICAgICAgICBoZWlnaHQ6IHNpemVcbiAgICAgICAgfSkuYXBwZW5kKCdnJykuYXR0cih7XG4gICAgICAgICAgICAndHJhbnNmb3JtJzogJ3RyYW5zbGF0ZSgnICsgc2l6ZSAvIDIgKyAnLCcgKyBzaXplIC8gMiArICcpJyxcbiAgICAgICAgICAgICdjbGFzcyc6ICdhaXNSYWRpYWwnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBtZXRlciA9IHN2Zy5hcHBlbmQoJ2cnKS5hdHRyKHtcbiAgICAgICAgICAgICd0cmFuc2Zvcm0nOiAncm90YXRlKDE4MCknXG4gICAgICAgIH0pO1xuICAgICAgICBtZXRlci5hcHBlbmQoJ3BhdGgnKVxuICAgICAgICAgICAgLmRhdHVtKHtcbiAgICAgICAgICAgICAgICBlbmRBbmdsZTogKDIgKiBNYXRoLlBJKSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnYmFja2dyb3VuZCcpXG4gICAgICAgICAgICAuYXR0cignZCcsIGFyYyk7XG5cbiAgICAgICAgZm9yZWdyb3VuZCA9IG1ldGVyLmFwcGVuZCgncGF0aCcpXG4gICAgICAgICAgICAuZGF0dW0oe1xuICAgICAgICAgICAgICAgIGVuZEFuZ2xlOiAwXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmF0dHIoe1xuICAgICAgICAgICAgICAgICdkJzogYXJjXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBnZXRGb3JlZ3JvdW5kKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB0ZXh0ID0gc3ZnLmFwcGVuZCgndGV4dCcpXG4gICAgICAgICAgICAuZGF0dW0oe1xuICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IDBcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnbWlkZGxlJylcbiAgICAgICAgICAgIC5hdHRyKCdkeScsICcuMzVlbScpO1xuXG5cbiAgICAgICAgdGV4dFR3ZWVuID0gZnVuY3Rpb24odHJhbnNpdGlvbiwgbmV3UGVyY2VudGFnZSkge1xuICAgICAgICAgICAgdHJhbnNpdGlvbi5hdHRyVHdlZW4oJ3RleHQnLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICBkID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGkgPSBkMy5pbnRlcnBvbGF0ZShkLnBlcmNlbnRhZ2UsIG5ld1BlcmNlbnRhZ2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucGVyY2VudGFnZSA9IGkodCk7XG4gICAgICAgICAgICAgICAgICAgIHRleHQudGV4dChmb3JtYXRQZXJjZW50KGkodCkpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGFyY1R3ZWVuID0gZnVuY3Rpb24odHJhbnNpdGlvbiwgbmV3QW5nbGUpIHtcbiAgICAgICAgICAgIHRyYW5zaXRpb24uYXR0clR3ZWVuKCdkJywgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHZhciBpID0gZDMuaW50ZXJwb2xhdGUoZC5lbmRBbmdsZSwgbmV3QW5nbGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQuZW5kQW5nbGUgPSBpKHQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXJjKGQpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBpc0luaXRpYWxpemVkID0gdHJ1ZTtcblxuICAgICAgICByZWRyYXcocGVyY2VudGFnZSk7XG5cbiAgICAgICAgLy8gZ2V0IHByb2dyZXNzLi4uXG5cbiAgICAgICAgLy9mb3JlZ3JvdW5kLmF0dHIoJ2QnLCBhcmMuZW5kQW5nbGUoKE1hdGguUEkgKiAyKSAqIDAuODMpKTtcbiAgICAgICAgLy90ZXh0LnRleHQoZm9ybWF0UGVyY2VudChwZXJjZW50YWdlKSk7XG4gICAgfTtcblxuICAgIHZhciByZWRyYXcgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIHZhciBwZXJjZW50YWdlID0gdmFsdWU7XG4gICAgICAgICAgICBpZiAocGVyY2VudGFnZSA+IDEpIHtcbiAgICAgICAgICAgICAgICBwZXJjZW50YWdlIC89IDEwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ1NldHRpbmcgcGVyY2VudGFnZSB0bzogJyArIHBlcmNlbnRhZ2UpO1xuXG4gICAgICAgICAgICAvL2ZvcmVncm91bmQudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwMDApLmF0dHIoJ2QnLCBhcmMpO1xuICAgICAgICAgICAgZm9yZWdyb3VuZC50cmFuc2l0aW9uKCkuZHVyYXRpb24oMTAwMClcbiAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRGb3JlZ3JvdW5kKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2FsbChhcmNUd2VlbiwgKE1hdGguUEkgKiAyKSAqIHBlcmNlbnRhZ2UpO1xuICAgICAgICAgICAgLy90ZXh0LnRleHQoZm9ybWF0UGVyY2VudChwZXJjZW50YWdlKSk7XG4gICAgICAgICAgICB0ZXh0LnRyYW5zaXRpb24oKS5kdXJhdGlvbigxMDAwKS5jYWxsKHRleHRUd2VlbiwgcGVyY2VudGFnZSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLiR3YXRjaCgncGVyY2VudGFnZScsIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSAmJiAhaXNJbml0aWFsaXplZCkge1xuICAgICAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVkcmF3KHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH0pXG59KTtcbiIsIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZGlyZWN0aXZlKCdhaXNSYWRpYWxQZXJjZW50YWdlJywgZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGNvbnRyb2xsZXI6ICdhaXNSYWRpYWxQZXJjZW50YWdlQ29udHJvbGxlcicsXG4gICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBwZXJjZW50YWdlOiAnQCdcbiAgICAgICAgfVxuICAgIH07XG59KTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWlzVGltZWxpbmVEaXJlY3RpdmVDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQsIHNjYWxlQ29uZmlnKSB7XG5cbiAgICAgICAgdmFyIGdhbnR0ID0gbnVsbDtcblxuICAgICAgICAkZWxlbWVudFswXS5vbnJlc2l6ZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZWxlbWVudCByZXNpemUnKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgndGFza3MnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBkcmF3VGltZWxpbmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBkcmF3VGltZWxpbmUgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYoJHNjb3BlLnRhc2tzICYmICRzY29wZS50YXNrcy5sZW5ndGggPiAwKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUudGFza3Muc29ydChmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhWyRzY29wZS5lbmRlZF0gLSBiWyRzY29wZS5lbmRlZF07XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAkc2NvcGUudGFza05hbWVzID0gXygkc2NvcGUudGFza3MpLnBsdWNrKCd0YXNrTmFtZScpLnVuaXEoKS52YWx1ZSgpO1xuICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSAkc2NvcGUudGFza05hbWVzLmxlbmd0aCAqIDMwICsgMjA7XG5cbiAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSAkZWxlbWVudFswXS5jbGllbnRXaWR0aDtcbiAgICAgICAgICAgICAgICBpZiAoIXdpZHRoIHx8IHdpZHRoID09PSAwKSB7IHdpZHRoID0gNjAwOyB9XG5cblxuICAgICAgICAgICAgICAgICRzY29wZS50YXNrcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFbJHNjb3BlLnN0YXJ0ZWRdIC0gYlskc2NvcGUuc3RhcnRlZF07XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdmFyIG1pbkRhdGUgPSAkc2NvcGUudGFza3NbMF1bJHNjb3BlLnN0YXJ0ZWRdO1xuICAgICAgICAgICAgICAgIHZhciBtYXhEYXRlID0gJHNjb3BlLnRhc2tzWyRzY29wZS50YXNrcy5sZW5ndGggLSAxXVskc2NvcGUuZW5kZWRdO1xuICAgICAgICAgICAgICAgIHZhciBkYXlzRGlmZiA9IG1vbWVudC51dGMobWF4RGF0ZSkuZGlmZihtb21lbnQudXRjKG1pbkRhdGUpLCdkYXlzJyk7XG4gICAgICAgICAgICAgICAgdmFyIGZvcm1hdCA9ICclSDolTTolUy4lbSc7XG4gICAgICAgICAgICAgICAgaWYoZGF5c0RpZmYgPiAwKXtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0ID0gXCIlbS8lZC8leSAlSDolTVwiO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGdhbnR0ID0gZDMuZ2FudHQoKS5yZW5kZXJUbyhcIiNhaXMtdGltZWxpbmVcIikudGFza1R5cGVzKCRzY29wZS50YXNrTmFtZXMpLnRhc2tTdGF0dXMoc2NhbGVDb25maWcudGFza1N0YXR1c1N0eWxlcykudGlja0Zvcm1hdChmb3JtYXQpLmJlZ2luKCRzY29wZS5zdGFydGVkKS5lbmRlZCgkc2NvcGUuZW5kZWQpLmhlaWdodChoZWlnaHQpLndpZHRoKHdpZHRoKTtcblxuICAgICAgICAgICAgICAgIGdhbnR0LnRpbWVEb21haW5Nb2RlKFwiZml0XCIpO1xuXG4gICAgICAgICAgICAgICAgZ2FudHQoJHNjb3BlLnRhc2tzKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldGVuZCgpIHtcbiAgICAgICAgICAgIHZhciBsYXN0ZW5kID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgIGlmICgkc2NvcGUudGFza3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGxhc3RlbmQgPSAkc2NvcGUudGFza3NbJHNjb3BlLnRhc2tzLmxlbmd0aCAtIDFdWyRzY29wZS5lbmRlZF07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBsYXN0ZW5kO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5mb3JtYXREYXRlID0gZnVuY3Rpb24oZGF0ZSl7XG4gICAgICAgICAgICBpZihkYXRlKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50LnV0YyhkYXRlKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgIH0pLmRpcmVjdGl2ZSgnYWlzVGltZWxpbmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWlzVGltZWxpbmVEaXJlY3RpdmVDb250cm9sbGVyJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9jaGFydHMvdGltZWxpbmUvdGltZWxpbmVEaXJlY3RpdmVUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIHRhc2tzOiAnPScsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogJz0nLFxuICAgICAgICAgICAgICAgIGVuZGVkOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZGlyZWN0aXZlKCdhaXNNdWx0aXNlbGVjdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgICAgICByZXF1aXJlOiAnXm5nTW9kZWwnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBtdWx0aXNlbGVjdERhdGFQcm92aWRlcjogJz0nLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogJz0nLFxuICAgICAgICAgICAgICAgIG1heEhlaWdodDogJz0nLFxuICAgICAgICAgICAgICAgIG51bWJlckRpc3BsYXllZDogJz0nLFxuICAgICAgICAgICAgICAgIGluY2x1ZGVTZWxlY3RBbGxPcHRpb246ICc9JyxcbiAgICAgICAgICAgICAgICBub25TZWxlY3RlZFRleHQ6ICc9JyxcbiAgICAgICAgICAgICAgICBuZ01vZGVsOiAnPSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnRbMF0pO1xuXG4gICAgICAgICAgICAgICAgZWxlbWVudC5tdWx0aXNlbGVjdCh7XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogc2NvcGUuZW5hYmxlRmlsdGVyaW5nLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVDYXNlSW5zZW5zaXRpdmVGaWx0ZXJpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG1heEhlaWdodDogc2NvcGUubWF4SGVpZ2h0IHx8IDMwMCxcbiAgICAgICAgICAgICAgICAgICAgbnVtYmVyRGlzcGxheWVkOiBzY29wZS5udW1iZXJEaXNwbGF5ZWQgfHwgMyxcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZVNlbGVjdEFsbE9wdGlvbjogc2NvcGUuaW5jbHVkZVNlbGVjdEFsbE9wdGlvbixcbiAgICAgICAgICAgICAgICAgICAgbm9uU2VsZWN0ZWRUZXh0OiBzY29wZS5ub25TZWxlY3RlZFRleHQgfHwgJ05vbmUgU2VsZWN0ZWQnLFxuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gKG9wdGlvbkVsZW1lbnQsIGNoZWNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubmdNb2RlbCA9IGVsZW1lbnQudmFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoQ29sbGVjdGlvbignbXVsdGlzZWxlY3REYXRhUHJvdmlkZXInLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5tdWx0aXNlbGVjdCgnZGF0YXByb3ZpZGVyJywgbmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAvLyBXYXRjaCBmb3IgYW55IGNoYW5nZXMgdG8gdGhlIGxlbmd0aCBvZiBvdXIgc2VsZWN0IGVsZW1lbnRcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudFswXTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAobmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVidWdnZXI7XG4gICAgICAgICAgICAgICAgICAgIC8vZWxlbWVudC5tdWx0aXNlbGVjdCgnc2V0T3B0aW9ucycsIGVsZW1lbnRbMF0pO1xuICAgICAgICAgICAgICAgICAgICAvL2VsZW1lbnQubXVsdGlzZWxlY3QoJ3JlYnVpbGQnKTtcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAgICAgICAgIC8vIFdhdGNoIGZvciBhbnkgY2hhbmdlcyBmcm9tIG91dHNpZGUgdGhlIGRpcmVjdGl2ZSBhbmQgcmVmcmVzaFxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChhdHRyaWJ1dGVzLm5nTW9kZWwsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5tdWx0aXNlbGVjdCgncmVmcmVzaCcpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ2dhdWdlRmFjdG9yeScsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgR2F1Z2UgPSBmdW5jdGlvbiAocGxhY2Vob2xkZXJOYW1lLCBjb25maWd1cmF0aW9uKVxuICAgICAgICB7XG4gICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyTmFtZSA9IHBsYWNlaG9sZGVyTmFtZTtcblxuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOyAvLyBmb3IgaW50ZXJuYWwgZDMgZnVuY3Rpb25zXG5cbiAgICAgICAgICAgIHRoaXMuY29uZmlndXJlID0gZnVuY3Rpb24oY29uZmlndXJhdGlvbilcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZ3VyYXRpb247XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5zaXplID0gdGhpcy5jb25maWcuc2l6ZSAqIDAuOTtcblxuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLnJhZGl1cyA9IHRoaXMuY29uZmlnLnNpemUgKiAwLjk3IC8gMjtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5jeCA9IHRoaXMuY29uZmlnLnNpemUgLyAyO1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmN5ID0gdGhpcy5jb25maWcuc2l6ZSAvIDI7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5taW4gPSB1bmRlZmluZWQgIT0gY29uZmlndXJhdGlvbi5taW4gPyBjb25maWd1cmF0aW9uLm1pbiA6IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcubWF4ID0gdW5kZWZpbmVkICE9IGNvbmZpZ3VyYXRpb24ubWF4ID8gY29uZmlndXJhdGlvbi5tYXggOiAxMDA7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcucmFuZ2UgPSB0aGlzLmNvbmZpZy5tYXggLSB0aGlzLmNvbmZpZy5taW47XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5tYWpvclRpY2tzID0gY29uZmlndXJhdGlvbi5tYWpvclRpY2tzIHx8IDU7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcubWlub3JUaWNrcyA9IGNvbmZpZ3VyYXRpb24ubWlub3JUaWNrcyB8fCAyO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcuZ3JlZW5Db2xvciBcdD0gY29uZmlndXJhdGlvbi5ncmVlbkNvbG9yIHx8ICcjOGZjYTBlJztcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy55ZWxsb3dDb2xvciA9IGNvbmZpZ3VyYXRpb24ueWVsbG93Q29sb3IgfHwgJyNmZmMzMTcnO1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLnJlZENvbG9yIFx0PSBjb25maWd1cmF0aW9uLnJlZENvbG9yIHx8ICcjZjU0ZDM2JztcblxuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLnRyYW5zaXRpb25EdXJhdGlvbiA9IGNvbmZpZ3VyYXRpb24udHJhbnNpdGlvbkR1cmF0aW9uIHx8IDUwMDtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMucmVuZGVyID0gZnVuY3Rpb24oKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRoaXMuYm9keSA9IGQzLnNlbGVjdCgnIycgKyB0aGlzLnBsYWNlaG9sZGVyTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgnc3ZnOnN2ZycpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdnYXVnZScpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIHRoaXMuY29uZmlnLnNpemUpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCB0aGlzLmNvbmZpZy5zaXplKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuYm9keS5hcHBlbmQoJ3N2ZzpjaXJjbGUnKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnb3V0ZXItY2lyY2xlJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2N4JywgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjeScsIHRoaXMuY29uZmlnLmN5KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cigncicsIHRoaXMuY29uZmlnLnJhZGl1cylcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgJyNjY2MnKTtcbiAgICAgICAgICAgICAgICAvKi5zdHlsZSgnc3Ryb2tlJywgJyMwMDAnKVxuICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZS13aWR0aCcsICcwLjVweCcpOyovXG5cbiAgICAgICAgICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKCdzdmc6Y2lyY2xlJylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2N4JywgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjeScsIHRoaXMuY29uZmlnLmN5KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cigncicsIDAuOSAqIHRoaXMuY29uZmlnLnJhZGl1cylcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgJyNmZmYnKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsICcjZTBlMGUwJylcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2Utd2lkdGgnLCAnMnB4Jyk7XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBncmVlbklkeCBpbiB0aGlzLmNvbmZpZy5ncmVlblpvbmVzKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmF3QmFuZCh0aGlzLmNvbmZpZy5ncmVlblpvbmVzW2dyZWVuSWR4XS5mcm9tLCB0aGlzLmNvbmZpZy5ncmVlblpvbmVzW2dyZWVuSWR4XS50bywgc2VsZi5jb25maWcuZ3JlZW5Db2xvcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgeWVsbG93SWR4IGluIHRoaXMuY29uZmlnLnllbGxvd1pvbmVzKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmF3QmFuZCh0aGlzLmNvbmZpZy55ZWxsb3dab25lc1t5ZWxsb3dJZHhdLmZyb20sIHRoaXMuY29uZmlnLnllbGxvd1pvbmVzW3llbGxvd0lkeF0udG8sIHNlbGYuY29uZmlnLnllbGxvd0NvbG9yKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciByZWRJZHggaW4gdGhpcy5jb25maWcucmVkWm9uZXMpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYXdCYW5kKHRoaXMuY29uZmlnLnJlZFpvbmVzW3JlZElkeF0uZnJvbSwgdGhpcy5jb25maWcucmVkWm9uZXNbcmVkSWR4XS50bywgc2VsZi5jb25maWcucmVkQ29sb3IpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBmb250U2l6ZSA9IDA7XG5cbiAgICAgICAgICAgICAgICBpZiAodW5kZWZpbmVkICE9IHRoaXMuY29uZmlnLmxhYmVsKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZm9udFNpemUgPSBNYXRoLnJvdW5kKHRoaXMuY29uZmlnLnNpemUgLyA5KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib2R5LmFwcGVuZCgnc3ZnOnRleHQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3gnLCB0aGlzLmNvbmZpZy5jeClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgdGhpcy5jb25maWcuY3kgLyAyICsgZm9udFNpemUgLyAyKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2R5JywgZm9udFNpemUgLyAyKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGV4dCh0aGlzLmNvbmZpZy5sYWJlbClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZm9udC1zaXplJywgZm9udFNpemUgKyAncHgnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgJyMzMzMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdzdHJva2Utd2lkdGgnLCAnMHB4Jyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9udFNpemUgPSBNYXRoLnJvdW5kKHRoaXMuY29uZmlnLnNpemUgLyAxNik7XG4gICAgICAgICAgICAgICAgdmFyIG1ham9yRGVsdGEgPSB0aGlzLmNvbmZpZy5yYW5nZSAvICh0aGlzLmNvbmZpZy5tYWpvclRpY2tzIC0gMSk7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgbWFqb3IgPSB0aGlzLmNvbmZpZy5taW47IG1ham9yIDw9IHRoaXMuY29uZmlnLm1heDsgbWFqb3IgKz0gbWFqb3JEZWx0YSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtaW5vckRlbHRhID0gbWFqb3JEZWx0YSAvIHRoaXMuY29uZmlnLm1pbm9yVGlja3MsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDEgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnQyID0gMDtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbWlub3IgPSBtYWpvciArIG1pbm9yRGVsdGE7IG1pbm9yIDwgTWF0aC5taW4obWFqb3IgKyBtYWpvckRlbHRhLCB0aGlzLmNvbmZpZy5tYXgpOyBtaW5vciArPSBtaW5vckRlbHRhKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDEgPSB0aGlzLnZhbHVlVG9Qb2ludChtaW5vciwgMC43NSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludDIgPSB0aGlzLnZhbHVlVG9Qb2ludChtaW5vciwgMC44NSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYm9keS5hcHBlbmQoJ3N2ZzpsaW5lJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneDEnLCBwb2ludDEueClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneTEnLCBwb2ludDEueSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneDInLCBwb2ludDIueClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneTInLCBwb2ludDIueSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsICcjNjY2JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZS13aWR0aCcsICcxcHgnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHBvaW50MSA9IHRoaXMudmFsdWVUb1BvaW50KG1ham9yLCAwLjcpO1xuICAgICAgICAgICAgICAgICAgICBwb2ludDIgPSB0aGlzLnZhbHVlVG9Qb2ludChtYWpvciwgMC44NSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib2R5LmFwcGVuZCgnc3ZnOmxpbmUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3gxJywgcG9pbnQxLngpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneTEnLCBwb2ludDEueSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCd4MicsIHBvaW50Mi54KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3kyJywgcG9pbnQyLnkpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZScsICcjMzMzJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlLXdpZHRoJywgJzJweCcpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChtYWpvciA9PSB0aGlzLmNvbmZpZy5taW4gfHwgbWFqb3IgPT0gdGhpcy5jb25maWcubWF4KVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnQgPSB0aGlzLnZhbHVlVG9Qb2ludChtYWpvciwgMC42Myk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYm9keS5hcHBlbmQoJ3N2Zzp0ZXh0JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigneCcsIHBvaW50LngpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3knLCBwb2ludC55KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCdkeScsIGZvbnRTaXplIC8gMylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCBtYWpvciA9PSB0aGlzLmNvbmZpZy5taW4gPyAnc3RhcnQnIDogJ2VuZCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQobWFqb3IpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmb250LXNpemUnLCBmb250U2l6ZSArICdweCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgJyMzMzMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlLXdpZHRoJywgJzBweCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHBvaW50ZXJDb250YWluZXIgPSB0aGlzLmJvZHkuYXBwZW5kKCdzdmc6ZycpLmF0dHIoJ2NsYXNzJywgJ3BvaW50ZXJDb250YWluZXInKTtcblxuICAgICAgICAgICAgICAgIHZhciBtaWRWYWx1ZSA9ICh0aGlzLmNvbmZpZy5taW4gKyB0aGlzLmNvbmZpZy5tYXgpIC8gMjtcblxuICAgICAgICAgICAgICAgIHZhciBwb2ludGVyUGF0aCA9IHRoaXMuYnVpbGRQb2ludGVyUGF0aChtaWRWYWx1ZSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgcG9pbnRlckxpbmUgPSBkMy5zdmcubGluZSgpXG4gICAgICAgICAgICAgICAgICAgIC54KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQueCB9KVxuICAgICAgICAgICAgICAgICAgICAueShmdW5jdGlvbihkKSB7IHJldHVybiBkLnkgfSlcbiAgICAgICAgICAgICAgICAgICAgLmludGVycG9sYXRlKCdiYXNpcycpO1xuXG4gICAgICAgICAgICAgICAgcG9pbnRlckNvbnRhaW5lci5zZWxlY3RBbGwoJ3BhdGgnKVxuICAgICAgICAgICAgICAgICAgICAuZGF0YShbcG9pbnRlclBhdGhdKVxuICAgICAgICAgICAgICAgICAgICAuZW50ZXIoKVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCdzdmc6cGF0aCcpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdkJywgcG9pbnRlckxpbmUpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsICcjODg4Jyk7XG5cbiAgICAgICAgICAgICAgICBwb2ludGVyQ29udGFpbmVyLmFwcGVuZCgnc3ZnOmNpcmNsZScpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdjeCcsIHRoaXMuY29uZmlnLmN4KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignY3knLCB0aGlzLmNvbmZpZy5jeSlcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3InLCAwLjA3ICogdGhpcy5jb25maWcucmFkaXVzKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCAnIzg4OCcpO1xuXG4gICAgICAgICAgICAgICAgZm9udFNpemUgPSBNYXRoLnJvdW5kKHRoaXMuY29uZmlnLnNpemUgLyAxMCk7XG4gICAgICAgICAgICAgICAgcG9pbnRlckNvbnRhaW5lci5zZWxlY3RBbGwoJ3RleHQnKVxuICAgICAgICAgICAgICAgICAgICAuZGF0YShbbWlkVmFsdWVdKVxuICAgICAgICAgICAgICAgICAgICAuZW50ZXIoKVxuICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCdzdmc6dGV4dCcpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd4JywgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd5JywgdGhpcy5jb25maWcuc2l6ZSAtIHRoaXMuY29uZmlnLmN5IC8gNCAtIGZvbnRTaXplKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cignZHknLCBmb250U2l6ZSAvIDIpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ2ZvbnQtc2l6ZScsIGZvbnRTaXplICsgJ3B4JylcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgJyMwMDAnKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoJ3N0cm9rZS13aWR0aCcsICcwcHgnKTtcblxuICAgICAgICAgICAgICAgIHRoaXMucmVkcmF3KHRoaXMuY29uZmlnLm1pbiwgMCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLmJ1aWxkUG9pbnRlclBhdGggPSBmdW5jdGlvbih2YWx1ZSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVsdGEgPSB0aGlzLmNvbmZpZy5yYW5nZSAvIDEzO1xuXG4gICAgICAgICAgICAgICAgdmFyIGhlYWQgPSB2YWx1ZVRvUG9pbnQodmFsdWUsIDAuODUpO1xuICAgICAgICAgICAgICAgIHZhciBoZWFkMSA9IHZhbHVlVG9Qb2ludCh2YWx1ZSAtIGRlbHRhLCAwLjEyKTtcbiAgICAgICAgICAgICAgICB2YXIgaGVhZDIgPSB2YWx1ZVRvUG9pbnQodmFsdWUgKyBkZWx0YSwgMC4xMik7XG5cbiAgICAgICAgICAgICAgICB2YXIgdGFpbFZhbHVlID0gdmFsdWUgLSAodGhpcy5jb25maWcucmFuZ2UgKiAoMS8oMjcwLzM2MCkpIC8gMik7XG4gICAgICAgICAgICAgICAgdmFyIHRhaWwgPSB2YWx1ZVRvUG9pbnQodGFpbFZhbHVlLCAwLjI4KTtcbiAgICAgICAgICAgICAgICB2YXIgdGFpbDEgPSB2YWx1ZVRvUG9pbnQodGFpbFZhbHVlIC0gZGVsdGEsIDAuMTIpO1xuICAgICAgICAgICAgICAgIHZhciB0YWlsMiA9IHZhbHVlVG9Qb2ludCh0YWlsVmFsdWUgKyBkZWx0YSwgMC4xMik7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gW2hlYWQsIGhlYWQxLCB0YWlsMiwgdGFpbCwgdGFpbDEsIGhlYWQyLCBoZWFkXTtcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHZhbHVlVG9Qb2ludCh2YWx1ZSwgZmFjdG9yKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50ID0gc2VsZi52YWx1ZVRvUG9pbnQodmFsdWUsIGZhY3Rvcik7XG4gICAgICAgICAgICAgICAgICAgIHBvaW50LnggLT0gc2VsZi5jb25maWcuY3g7XG4gICAgICAgICAgICAgICAgICAgIHBvaW50LnkgLT0gc2VsZi5jb25maWcuY3k7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwb2ludDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLmRyYXdCYW5kID0gZnVuY3Rpb24oc3RhcnQsIGVuZCwgY29sb3IpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWYgKDAgPj0gZW5kIC0gc3RhcnQpIHJldHVybjtcblxuICAgICAgICAgICAgICAgIHRoaXMuYm9keS5hcHBlbmQoJ3N2ZzpwYXRoJylcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCdmaWxsJywgY29sb3IpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKCdkJywgZDMuc3ZnLmFyYygpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3RhcnRBbmdsZSh0aGlzLnZhbHVlVG9SYWRpYW5zKHN0YXJ0KSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lbmRBbmdsZSh0aGlzLnZhbHVlVG9SYWRpYW5zKGVuZCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAuaW5uZXJSYWRpdXMoMC42NSAqIHRoaXMuY29uZmlnLnJhZGl1cylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5vdXRlclJhZGl1cygwLjg1ICogdGhpcy5jb25maWcucmFkaXVzKSlcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uKCkgeyByZXR1cm4gJ3RyYW5zbGF0ZSgnICsgc2VsZi5jb25maWcuY3ggKyAnLCAnICsgc2VsZi5jb25maWcuY3kgKyAnKSByb3RhdGUoMjcwKScgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLnJlZHJhdyA9IGZ1bmN0aW9uKHZhbHVlLCB0cmFuc2l0aW9uRHVyYXRpb24pXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIHBvaW50ZXJDb250YWluZXIgPSB0aGlzLmJvZHkuc2VsZWN0KCcucG9pbnRlckNvbnRhaW5lcicpO1xuXG4gICAgICAgICAgICAgICAgcG9pbnRlckNvbnRhaW5lci5zZWxlY3RBbGwoJ3RleHQnKS50ZXh0KHBhcnNlRmxvYXQodmFsdWUpLnRvRml4ZWQoMikgKyAnJScpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHBvaW50ZXIgPSBwb2ludGVyQ29udGFpbmVyLnNlbGVjdEFsbCgncGF0aCcpO1xuICAgICAgICAgICAgICAgIHBvaW50ZXIudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgICAgIC5kdXJhdGlvbih1bmRlZmluZWQgIT0gdHJhbnNpdGlvbkR1cmF0aW9uID8gdHJhbnNpdGlvbkR1cmF0aW9uIDogdGhpcy5jb25maWcudHJhbnNpdGlvbkR1cmF0aW9uKVxuICAgICAgICAgICAgICAgICAgICAvLy5kZWxheSgwKVxuICAgICAgICAgICAgICAgICAgICAvLy5lYXNlKCdsaW5lYXInKVxuICAgICAgICAgICAgICAgICAgICAvLy5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbihkKVxuICAgICAgICAgICAgICAgICAgICAuYXR0clR3ZWVuKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbigpXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb2ludGVyVmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IHNlbGYuY29uZmlnLm1heCkgcG9pbnRlclZhbHVlID0gc2VsZi5jb25maWcubWF4ICsgMC4wMipzZWxmLmNvbmZpZy5yYW5nZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlIDwgc2VsZi5jb25maWcubWluKSBwb2ludGVyVmFsdWUgPSBzZWxmLmNvbmZpZy5taW4gLSAwLjAyKnNlbGYuY29uZmlnLnJhbmdlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldFJvdGF0aW9uID0gKHNlbGYudmFsdWVUb0RlZ3JlZXMocG9pbnRlclZhbHVlKSAtIDkwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50Um90YXRpb24gPSBzZWxmLl9jdXJyZW50Um90YXRpb24gfHwgdGFyZ2V0Um90YXRpb247XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9jdXJyZW50Um90YXRpb24gPSB0YXJnZXRSb3RhdGlvbjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHN0ZXApXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvdGF0aW9uID0gY3VycmVudFJvdGF0aW9uICsgKHRhcmdldFJvdGF0aW9uLWN1cnJlbnRSb3RhdGlvbikqc3RlcDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3RyYW5zbGF0ZSgnICsgc2VsZi5jb25maWcuY3ggKyAnLCAnICsgc2VsZi5jb25maWcuY3kgKyAnKSByb3RhdGUoJyArIHJvdGF0aW9uICsgJyknO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZhciBvdXRlckNpcmNsZSA9IHRoaXMuYm9keS5zZWxlY3QoJy5vdXRlci1jaXJjbGUnKVxuICAgICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAgICAgICAgIC5kdXJhdGlvbig3NTApXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gcGFyc2VJbnQodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPj0gMCAmJiBpIDwgNzUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcuZ3JlZW5Db2xvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA+PSA3NSAmJiBpIDwgOTApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcueWVsbG93Q29sb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy5yZWRDb2xvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLnZhbHVlVG9EZWdyZWVzID0gZnVuY3Rpb24odmFsdWUpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgLy8gdGhhbmtzIEBjbG9zZWFsZXJ0XG4gICAgICAgICAgICAgICAgLy9yZXR1cm4gdmFsdWUgLyB0aGlzLmNvbmZpZy5yYW5nZSAqIDI3MCAtIDQ1O1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSAvIHRoaXMuY29uZmlnLnJhbmdlICogMjcwIC0gKHRoaXMuY29uZmlnLm1pbiAvIHRoaXMuY29uZmlnLnJhbmdlICogMjcwICsgNDUpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy52YWx1ZVRvUmFkaWFucyA9IGZ1bmN0aW9uKHZhbHVlKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlVG9EZWdyZWVzKHZhbHVlKSAqIE1hdGguUEkgLyAxODA7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLnZhbHVlVG9Qb2ludCA9IGZ1bmN0aW9uKHZhbHVlLCBmYWN0b3IpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgXHR4OiB0aGlzLmNvbmZpZy5jeCAtIHRoaXMuY29uZmlnLnJhZGl1cyAqIGZhY3RvciAqIE1hdGguY29zKHRoaXMudmFsdWVUb1JhZGlhbnModmFsdWUpKSxcbiAgICAgICAgICAgICAgICAgICAgeTogdGhpcy5jb25maWcuY3kgLSB0aGlzLmNvbmZpZy5yYWRpdXMgKiBmYWN0b3IgKiBNYXRoLnNpbih0aGlzLnZhbHVlVG9SYWRpYW5zKHZhbHVlKSkgXHRcdH07XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBpbml0aWFsaXphdGlvblxuICAgICAgICAgICAgdGhpcy5jb25maWd1cmUoY29uZmlndXJhdGlvbik7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNyZWF0ZUdhdWdlOiBmdW5jdGlvbiAobmFtZSwgbGFiZWwsIG1pbiwgbWF4LCBzaXplKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogc2l6ZSB8fCBzY2FsZUNvbmZpZy5kZWZhdWx0R2F1Z2VXaWR0aCxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGxhYmVsLFxuICAgICAgICAgICAgICAgICAgICBtaW46IG1pbiB8fCAwLFxuICAgICAgICAgICAgICAgICAgICBtYXg6IG1heCB8fCAxMDAsXG4gICAgICAgICAgICAgICAgICAgIG1pbm9yVGlja3M6IDVcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gY29uZmlnLm1heCAtIGNvbmZpZy5taW47XG4gICAgICAgICAgICAgICAgY29uZmlnLnllbGxvd1pvbmVzID0gW3sgZnJvbTogY29uZmlnLm1pbiArIHJhbmdlKjAuNzUsIHRvOiBjb25maWcubWluICsgcmFuZ2UqMC45IH1dO1xuICAgICAgICAgICAgICAgIGNvbmZpZy5yZWRab25lcyA9IFt7IGZyb206IGNvbmZpZy5taW4gKyByYW5nZSowLjksIHRvOiBjb25maWcubWF4IH1dO1xuXG4gICAgICAgICAgICAgICAgdmFyIGdhdWdlID0gbmV3IEdhdWdlKG5hbWUgKyAnR2F1Z2VDb250YWluZXInLCBjb25maWcpO1xuICAgICAgICAgICAgICAgIGdhdWdlLnJlbmRlcigpO1xuICAgICAgICAgICAgICAgIHJldHVybiBnYXVnZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ2dyaWRGYWN0b3J5JywgZnVuY3Rpb24gKHVpR3JpZENvbnN0YW50cykge1xuXG4gICAgICAgIHZhciBnZXRTb3J0Q29uZmlnID0gZnVuY3Rpb24ob3JkZXJQYXJhbSl7XG4gICAgICAgICAgICBpZihvcmRlclBhcmFtKXtcbiAgICAgICAgICAgICAgICB2YXIgc29ydEZpZWxkID0gb3JkZXJQYXJhbVxuICAgICAgICAgICAgICAgIHZhciBzb3J0RGlyZWN0aW9uID0gJ2FzYyc7XG4gICAgICAgICAgICAgICAgaWYoXy5zdGFydHNXaXRoKG9yZGVyUGFyYW0sICctJykpe1xuICAgICAgICAgICAgICAgICAgICBzb3J0RGlyZWN0aW9uID0gJ2Rlc2MnO1xuICAgICAgICAgICAgICAgICAgICBzb3J0RmllbGQgPSBzb3J0RmllbGRbMF0ubGVuZ3RoID09PSAxID8gc29ydEZpZWxkLnN1YnN0cmluZygxKSA6IHNvcnRGaWVsZFswXS5zdWJzdHJpbmcoMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogc29ydERpcmVjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IHNvcnRGaWVsZFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGRlZmF1bHRHcmlkT3B0aW9uczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZVJvd1NlbGVjdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlUm93SGVhZGVyU2VsZWN0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlSG9yaXpvbnRhbFNjcm9sbGJhcjogdWlHcmlkQ29uc3RhbnRzLnNjcm9sbGJhcnMuTkVWRVIsXG4gICAgICAgICAgICAgICAgICAgIG11bHRpU2VsZWN0OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB1c2VFeHRlcm5hbFNvcnRpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHVzZUV4dGVybmFsRmlsdGVyaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVTb3J0aW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBtaW5Sb3dzVG9TaG93OiAxNyxcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvblBhZ2VTaXplczogWzI1LCA1MCwgNzUsIDEwMF0sXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb25QYWdlU2l6ZTogMjUsXG4gICAgICAgICAgICAgICAgICAgIHVzZUV4dGVybmFsUGFnaW5hdGlvbjogdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhcHBseVNvcnRDb25maWc6IGZ1bmN0aW9uKGNvbHVtbkRlZnMsIGdyaWRQYXJhbXMpe1xuICAgICAgICAgICAgICAgIHZhciBzb3J0Q29uZmlnID0gZ2V0U29ydENvbmZpZyhncmlkUGFyYW1zLm9yZGVyKTtcbiAgICAgICAgICAgICAgICBpZihzb3J0Q29uZmlnLmZpZWxkKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbERlZiA9IF8uZmluZChjb2x1bW5EZWZzLCB7ZmllbGQ6IHNvcnRDb25maWcuZmllbGR9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYoY29sRGVmKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbERlZi5zb3J0ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogc29ydENvbmZpZy5kaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHk6IDFcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gY29sdW1uRGVmcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgncG9sbGVyRmFjdG9yeScsIGZ1bmN0aW9uIChwb2xsZXIpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5ld1BvbGxlcjogZnVuY3Rpb24gKHJlc291cmNlLCBpbnRlcnZhbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwb2xsZXIuZ2V0KHJlc291cmNlLCB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGF5OiBpbnRlcnZhbCxcbiAgICAgICAgICAgICAgICAgICAgY2F0Y2hFcnJvcjogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnU3RhdHVzJywgZnVuY3Rpb24gKFN0YXR1c01hc3RlciwgU3RhdHVzU2NoZWR1bGVyLCBTdGF0dXNSZXNvdXJjZXMpIHtcbiAgICAgICAgdmFyIFN0YXR1cyA9IGZ1bmN0aW9uICgkcmVzb2x2ZWQsIG1hc3Rlciwgc2NoZWR1bGVyLCBxdWV1ZV9kZXB0aCwgcmVzb3VyY2VzKSB7XG4gICAgICAgICAgICB0aGlzLiRyZXNvbHZlZCA9ICRyZXNvbHZlZDtcbiAgICAgICAgICAgIHRoaXMubWFzdGVyID0gU3RhdHVzTWFzdGVyLnRyYW5zZm9ybWVyKG1hc3Rlcik7XG4gICAgICAgICAgICB0aGlzLnNjaGVkdWxlciA9IFN0YXR1c1NjaGVkdWxlci50cmFuc2Zvcm1lcihzY2hlZHVsZXIpO1xuICAgICAgICAgICAgdGhpcy5xdWV1ZV9kZXB0aCA9IHF1ZXVlX2RlcHRoO1xuICAgICAgICAgICAgdGhpcy5yZXNvdXJjZXMgPSBTdGF0dXNSZXNvdXJjZXMudHJhbnNmb3JtZXIocmVzb3VyY2VzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBTdGF0dXMucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgZ2V0Q3B1VXNhZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXNvdXJjZXMuc2NoZWR1bGVkLmNwdXMgJiYgdGhpcy5yZXNvdXJjZXMudG90YWwuY3B1cykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXNvdXJjZXMudG90YWwuY3B1cyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoKHRoaXMucmVzb3VyY2VzLnNjaGVkdWxlZC5jcHVzIC8gdGhpcy5yZXNvdXJjZXMudG90YWwuY3B1cykgKiAxMDApLnRvRml4ZWQoMik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIDAuMDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0TWVtVXNhZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXNvdXJjZXMuc2NoZWR1bGVkLm1lbSAmJiB0aGlzLnJlc291cmNlcy50b3RhbC5tZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzb3VyY2VzLnRvdGFsLm1lbSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoKHRoaXMucmVzb3VyY2VzLnNjaGVkdWxlZC5tZW0gLyB0aGlzLnJlc291cmNlcy50b3RhbC5tZW0pICogMTAwKS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiAwLjAwO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldERpc2tVc2FnZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlc291cmNlcy5zY2hlZHVsZWQuZGlzayAmJiB0aGlzLnJlc291cmNlcy50b3RhbC5kaXNrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlc291cmNlcy50b3RhbC5kaXNrID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgodGhpcy5yZXNvdXJjZXMuc2NoZWR1bGVkLmRpc2sgLyB0aGlzLnJlc291cmNlcy50b3RhbC5kaXNrKSAqIDEwMCkudG9GaXhlZCgyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gMC4wMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgU3RhdHVzLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0dXMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuJHJlc29sdmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1hc3RlcixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zY2hlZHVsZXIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucXVldWVfZGVwdGgsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzb3VyY2VzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdHVzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgU3RhdHVzLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFN0YXR1cy5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBTdGF0dXMuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFN0YXR1cztcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnU3RhdHVzTWFzdGVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgU3RhdHVzTWFzdGVyID0gZnVuY3Rpb24gKGlzX29ubGluZSwgaG9zdG5hbWUsIHBvcnQpIHtcbiAgICAgICAgICAgIHRoaXMuaXNfb25saW5lID0gaXNfb25saW5lO1xuICAgICAgICAgICAgdGhpcy5ob3N0bmFtZSA9IGhvc3RuYW1lO1xuICAgICAgICAgICAgdGhpcy5wb3J0ID0gcG9ydDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBTdGF0dXNNYXN0ZXIucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFN0YXR1c01hc3Rlci5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdHVzTWFzdGVyKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX29ubGluZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5ob3N0bmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wb3J0XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdHVzTWFzdGVyKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgU3RhdHVzTWFzdGVyLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFN0YXR1c01hc3Rlci5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBTdGF0dXNNYXN0ZXIuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFN0YXR1c01hc3RlcjtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdTdGF0dXNSZXNvdXJjZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIFN0YXR1c1Jlc291cmNlID0gZnVuY3Rpb24gKGNwdXMsIG1lbSwgZGlzaykge1xuICAgICAgICAgICAgdGhpcy5jcHVzID0gY3B1cztcbiAgICAgICAgICAgIHRoaXMubWVtID0gbWVtO1xuICAgICAgICAgICAgdGhpcy5kaXNrID0gZGlzaztcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBTdGF0dXNSZXNvdXJjZS5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgU3RhdHVzUmVzb3VyY2UuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN0YXR1c1Jlc291cmNlKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNwdXMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVtLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0dXNSZXNvdXJjZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFN0YXR1c1Jlc291cmNlLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFN0YXR1c1Jlc291cmNlLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFN0YXR1c1Jlc291cmNlLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBTdGF0dXNSZXNvdXJjZTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdTdGF0dXNSZXNvdXJjZXMnLCBmdW5jdGlvbiAoU3RhdHVzUmVzb3VyY2UpIHtcbiAgICAgICAgdmFyIFN0YXR1c1Jlc291cmNlcyA9IGZ1bmN0aW9uICh0b3RhbCwgc2NoZWR1bGVkLCB1c2VkKSB7XG4gICAgICAgICAgICB0aGlzLnRvdGFsID0gU3RhdHVzUmVzb3VyY2UudHJhbnNmb3JtZXIodG90YWwpO1xuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZWQgPSBTdGF0dXNSZXNvdXJjZS50cmFuc2Zvcm1lcihzY2hlZHVsZWQpO1xuICAgICAgICAgICAgdGhpcy51c2VkID0gU3RhdHVzUmVzb3VyY2UudHJhbnNmb3JtZXIodXNlZCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgU3RhdHVzUmVzb3VyY2VzLnByb3RvdHlwZSA9IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBTdGF0dXNSZXNvdXJjZXMuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFN0YXR1c1Jlc291cmNlcyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50b3RhbCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zY2hlZHVsZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudXNlZFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFN0YXR1c1Jlc291cmNlcygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFN0YXR1c1Jlc291cmNlcy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChTdGF0dXNSZXNvdXJjZXMuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gU3RhdHVzUmVzb3VyY2VzLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBTdGF0dXNSZXNvdXJjZXM7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnU3RhdHVzU2NoZWR1bGVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgU3RhdHVzU2NoZWR1bGVyID0gZnVuY3Rpb24gKGlzX29ubGluZSwgaXNfcGF1c2VkLCBob3N0bmFtZSkge1xuICAgICAgICAgICAgdGhpcy5pc19vbmxpbmUgPSBpc19vbmxpbmU7XG4gICAgICAgICAgICB0aGlzLmlzX3BhdXNlZCA9IGlzX3BhdXNlZDtcbiAgICAgICAgICAgIHRoaXMuaG9zdG5hbWUgPSBob3N0bmFtZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBTdGF0dXNTY2hlZHVsZXIucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFN0YXR1c1NjaGVkdWxlci5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RhdHVzU2NoZWR1bGVyKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX29ubGluZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19wYXVzZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaG9zdG5hbWVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTdGF0dXNTY2hlZHVsZXIoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBTdGF0dXNTY2hlZHVsZXIudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoU3RhdHVzU2NoZWR1bGVyLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFN0YXR1c1NjaGVkdWxlci5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gU3RhdHVzU2NoZWR1bGVyO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ3NjYWxlU2VydmljZScsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZykge1xuICAgICAgICBmdW5jdGlvbiBwYWRXaXRoWmVybyAoaW5wdXQsIGxlbmd0aCkge1xuICAgICAgICAgICAgLy8gQ2FzdCBpbnB1dCB0byBzdHJpbmdcbiAgICAgICAgICAgIGlucHV0ID0gJycgKyBpbnB1dDtcblxuICAgICAgICAgICAgdmFyIHBhZGRpbmdTaXplID0gTWF0aC5tYXgoMCwgbGVuZ3RoIC0gaW5wdXQubGVuZ3RoKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQXJyYXkocGFkZGluZ1NpemUgPiAwID8gcGFkZGluZ1NpemUgKyAxIDogMCkuam9pbignMCcpICsgaW5wdXQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY2FsY3VsYXRlRmlsZVNpemVGcm9tTWliOiBmdW5jdGlvbihudW0pe1xuICAgICAgICAgICAgICAgIGlmIChudW0gPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChudW0gPCAxMDI0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVtLnRvRml4ZWQoMikgKyAnIE1CJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobnVtID49IDEwMjQgJiYgbnVtIDwgMTAyNCoxMDI0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKG51bS8xMDI0KS50b0ZpeGVkKDIpICsgJyBHQic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChudW0vMTAyNC8xMDI0KS50b0ZpeGVkKDIpICsgJyBUQic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBudW07XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2FsY3VsYXRlRmlsZVNpemVGcm9tQnl0ZXM6IGZ1bmN0aW9uKG51bSxkZWNpbWFscyl7XG4gICAgICAgICAgICAgICAgLy8gaWYocHJlY2lzaW9uKXtcbiAgICAgICAgICAgICAgICAvLyAgICAgLy8gcm91bmQgbnVtIHRvIHNwZWNpZmllZCBwcmVjaXNpb25cbiAgICAgICAgICAgICAgICAvLyAgICAgbnVtID0gTWF0aC5yb3VuZChudW0vcHJlY2lzaW9uKTtcbiAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAgICAgaWYgKG51bSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bSA8IDEwMjQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudW0udG9GaXhlZChkZWNpbWFscykgKyAnIEJ5dGVzJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobnVtID49IDEwMjQgJiYgbnVtIDwgMTAyNCoxMDI0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKG51bS8xMDI0KS50b0ZpeGVkKGRlY2ltYWxzKSArICcgS0InO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChudW0gPj0gMTAyNCoxMDI0ICYmIG51bSA8IDEwMjQqMTAyNCoxMDI0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKG51bS8xMDI0LzEwMjQpLnRvRml4ZWQoZGVjaW1hbHMpICsgJyBNQic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bSA+PSAxMDI0KjEwMjQqMTAyNCAmJiBudW0gPCAxMDI0KjEwMjQqMTAyNCoxMDI0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKG51bS8xMDI0LzEwMjQvMTAyNCkudG9GaXhlZChkZWNpbWFscykgKyAnIEdCJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKG51bS8xMDI0LzEwMjQvMTAyNC8xMDI0KS50b0ZpeGVkKGRlY2ltYWxzKSArICcgVEInO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbnVtO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFZpZXdwb3J0U2l6ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciB3ID0gd2luZG93LFxuICAgICAgICAgICAgICAgICAgICBkID0gZG9jdW1lbnQsXG4gICAgICAgICAgICAgICAgICAgIGUgPSBkLmRvY3VtZW50RWxlbWVudCxcbiAgICAgICAgICAgICAgICAgICAgZyA9IGRvY3VtZW50LmJvZHksXG4gICAgICAgICAgICAgICAgICAgIHggPSB3LmlubmVyV2lkdGggfHwgZS5jbGllbnRXaWR0aCB8fCBnLmNsaWVudFdpZHRoLFxuICAgICAgICAgICAgICAgICAgICB5ID0gdy5pbm5lckhlaWdodCB8fCBlLmNsaWVudEhlaWdodCB8fCBnLmNsaWVudEhlaWdodDtcblxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiB4LFxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhbGN1bGF0ZUR1cmF0aW9uOiBmdW5jdGlvbiAoc3RhcnQsIHN0b3ApIHtcbiAgICAgICAgICAgICAgICB2YXIgdG8gPSBtb21lbnQudXRjKHN0b3ApLFxuICAgICAgICAgICAgICAgICAgICBmcm9tID0gbW9tZW50LnV0YyhzdGFydCksXG4gICAgICAgICAgICAgICAgICAgIGRpZmYgPSBtb21lbnQudXRjKHRvKS5kaWZmKG1vbWVudC51dGMoZnJvbSkpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGR1cmF0aW9uID0gbW9tZW50LmR1cmF0aW9uKGRpZmYpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhZFdpdGhaZXJvKGR1cmF0aW9uLmRheXMoKSwgMikgKyAnZCwgJyArIHBhZFdpdGhaZXJvKGR1cmF0aW9uLmhvdXJzKCksIDIpICsgJ2gsICcgKyBwYWRXaXRoWmVybyhkdXJhdGlvbi5taW51dGVzKCksIDIpICsgJ20sICcgKyBwYWRXaXRoWmVybyhkdXJhdGlvbi5zZWNvbmRzKCksIDIpICsgJ3MnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldERheVN0cmluZzogZnVuY3Rpb24oZGF5TnVtYmVyKXtcbiAgICAgICAgICAgICAgICB2YXIgZGF5QXJyID0gWydTdW5kYXknLCdNb25kYXknLCdUdWVzZGF5JywnV2VkbmVzZGF5JywnVGh1cnNkYXknLCdGcmlkYXknLCdTYXR1cmRheSddO1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXlBcnJbZGF5TnVtYmVyXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc0lFOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHVhID0gd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQsXG4gICAgICAgICAgICAgICAgICAgIG9sZElFID0gdWEuaW5kZXhPZignTVNJRScpLFxuICAgICAgICAgICAgICAgICAgICBuZXdJRSA9IHVhLmluZGV4T2YoJ1RyaWRlbnQvJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoKG9sZElFID4gLTEpIHx8IChuZXdJRSA+IC0xKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdzY2hlZHVsZXJTZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCAkcSwgc2NhbGVDb25maWcpIHtcbiAgICAgICAgdmFyIGdldFVwZGF0ZVNjaGVkdWxlckRhdGEgPSBmdW5jdGlvbiAoaXNfcGF1c2VkKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlzX3BhdXNlZDogaXNfcGF1c2VkXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB1cGRhdGVTY2hlZHVsZXI6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEgfHwgZ2V0VXBkYXRlU2NoZWR1bGVyRGF0YSgpO1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdzY2hlZHVsZXIvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdzdGF0dXNTZXJ2aWNlJywgZnVuY3Rpb24gKCRyZXNvdXJjZSwgc2NhbGVDb25maWcsIHBvbGxlciwgcG9sbGVyRmFjdG9yeSwgU3RhdHVzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRTdGF0dXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzUmVzb3VyY2UgPSAkcmVzb3VyY2Uoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnc3RhdHVzLycpLFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXNQb2xsZXIgPSBwb2xsZXJGYWN0b3J5Lm5ld1BvbGxlcihzdGF0dXNSZXNvdXJjZSwgc2NhbGVDb25maWcucG9sbEludGVydmFscy5zdGF0dXMpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXR1c1BvbGxlci5wcm9taXNlLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gU3RhdHVzLnRyYW5zZm9ybWVyKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3Jlc3VsdCA9IGFuZ3VsYXIuZXh0ZW5kKHJlc3VsdCwgcmV0dXJuUmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c1BvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ3VzZXJTZXJ2aWNlJywgZnVuY3Rpb24gKCRyb290U2NvcGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldFVzZXJDcmVkczogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB2YXIgY3JlZHMgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlckNyZWRzJyk7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoY3JlZHMpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIHBhcnNpbmcgdXNlciBjcmVkZW50aWFscycpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3JlZHM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldFVzZXJDcmVkczogZnVuY3Rpb24odXNlcil7XG4gICAgICAgICAgICAgICAgaWYgKHVzZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3VzZXJDcmVkcycsIEpTT04uc3RyaW5naWZ5KHVzZXIpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlckNyZWRzJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbG9naW46IGZ1bmN0aW9uICh1c2VybmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciB1c2VyID0ge1xuICAgICAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGlzX2FkbWluOiB0cnVlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFVzZXJDcmVkcyh1c2VyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXNlcjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsb2dvdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0VXNlckNyZWRzKG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdmZWVkRGV0YWlsc0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgc2NhbGVDb25maWcsIG5hdlNlcnZpY2UsIHN1Ym5hdlNlcnZpY2UsIGZlZWRTZXJ2aWNlLCBtb21lbnQpIHtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAkc2NvcGUuZmVlZERhdGEgPSB7fTtcbiAgICAgICAgJHNjb3BlLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3MuZmVlZDtcbiAgICAgICAgJHNjb3BlLnVzZUluZ2VzdFRpbWUgPSAnZmFsc2UnO1xuICAgICAgICAkc2NvcGUuZmlsdGVyVmFsdWUgPSAxO1xuICAgICAgICAkc2NvcGUuZmlsdGVyRHVyYXRpb24gPSAndyc7XG5cbiAgICAgICAgJHNjb3BlLmNoYW5nZUZlZWRTZWxlY3Rpb24gPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgc2V0RmVlZFVybCgpO1xuICAgICAgICAgICAgLy9nZXRGZWVkKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLmNoYW5nZUluZ2VzdFRpbWVTZWxlY3Rpb24gPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgc2V0RmVlZFVybCgpO1xuICAgICAgICAgICAgZ2V0RmVlZCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRGZWVkUGFyYW1zID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7fTtcbiAgICAgICAgICAgIHZhciBzdHJpa2VJZCA9ICRzY29wZS5zZWxlY3RlZEZlZWQgPyAkc2NvcGUuc2VsZWN0ZWRGZWVkLnN0cmlrZS5pZCA6IG51bGw7XG4gICAgICAgICAgICB2YXIgdXNlSW5nZXN0VGltZSA9ICRzY29wZS51c2VJbmdlc3RUaW1lID8gJHNjb3BlLnVzZUluZ2VzdFRpbWUgOiBudWxsO1xuXG4gICAgICAgICAgICBwYXJhbXMuc3RhcnRlZCA9IG1vbWVudC51dGMoKS5zdWJ0cmFjdCgkc2NvcGUuZmlsdGVyVmFsdWUsICRzY29wZS5maWx0ZXJEdXJhdGlvbikuc3RhcnRPZignZCcpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICBwYXJhbXMuZW5kZWQgPSBtb21lbnQudXRjKHBhcmFtcy5zdGFydGVkKS5hZGQoMSwgJHNjb3BlLmZpbHRlckR1cmF0aW9uKS5lbmRPZignZCcpLnRvSVNPU3RyaW5nKCk7XG5cbiAgICAgICAgICAgIGlmIChzdHJpa2VJZCAhPSAkbG9jYXRpb24uc2VhcmNoKCkuc3RyaWtlX2lkKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnN0cmlrZV9pZCA9IHN0cmlrZUlkO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgkbG9jYXRpb24uc2VhcmNoKCkuc3RyaWtlX2lkKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnN0cmlrZV9pZCA9ICRsb2NhdGlvbi5zZWFyY2goKS5zdHJpa2VfaWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh1c2VJbmdlc3RUaW1lICE9ICRsb2NhdGlvbi5zZWFyY2goKS51c2VfaW5nZXN0X3RpbWUpIHtcbiAgICAgICAgICAgICAgIHBhcmFtcy51c2VfaW5nZXN0X3RpbWUgPSB1c2VJbmdlc3RUaW1lO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgkbG9jYXRpb24uc2VhcmNoKCkudXNlX2luZ2VzdF90aW1lKSB7XG4gICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZ2V0RmVlZFBhcmFtcyB1c2VfaW5nZXN0X3RpbWU6ICcgKyAkbG9jYXRpb24uc2VhcmNoKCkudXNlX2luZ2VzdF90aW1lKTtcbiAgICAgICAgICAgICAgIHBhcmFtcy51c2VfaW5nZXN0X3RpbWUgPSAkbG9jYXRpb24uc2VhcmNoKCkudXNlX2luZ2VzdF90aW1lO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcGFyYW1zO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRGZWVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKCRsb2NhdGlvbi5zZWFyY2goKS51c2VfaW5nZXN0X3RpbWUpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUudXNlSW5nZXN0VGltZSA9ICRsb2NhdGlvbi5zZWFyY2goKS51c2VfaW5nZXN0X3RpbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZmVlZFBhcmFtcyA9IGdldEZlZWRQYXJhbXMoKTtcbiAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2goZmVlZFBhcmFtcyk7XG4gICAgICAgICAgICBmZWVkU2VydmljZS5nZXRGZWVkKGZlZWRQYXJhbXMpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWxsRmVlZHMgPSBfLnNvcnRCeU9yZGVyKGRhdGEucmVzdWx0cywgWydzdHJpa2UubmFtZSddLCBbJ2FzYyddKTtcbiAgICAgICAgICAgICAgICB2YXIgc3RyaWtlSWQgPSAkbG9jYXRpb24uc2VhcmNoKCkuc3RyaWtlX2lkO1xuICAgICAgICAgICAgICAgIGlmKHN0cmlrZUlkKXtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHNlbGVjdGVkRmVlZCA9IG5ldyBmZWVkXG4gICAgICAgICAgICAgICAgICAgIHZhciBmZWVkID0gXy5maW5kKCRzY29wZS5hbGxGZWVkcywgZnVuY3Rpb24oZmVlZCl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmVlZC5zdHJpa2UuaWQgPT0gc3RyaWtlSWQ7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRGZWVkID0gZmVlZCA/IGZlZWQgOiBudWxsO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEZlZWQgPSAkc2NvcGUuYWxsRmVlZHNbMF07XG4gICAgICAgICAgICAgICAgICAgIHNldEZlZWRVcmwoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS51cGRhdGVGZWVkUmFuZ2UgPSBmdW5jdGlvbiAoYWN0aW9uKSB7XG4gICAgICAgICAgICBpZiAoYWN0aW9uID09PSAnb2xkZXInKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlclZhbHVlKys7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ25ld2VyJykge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZmlsdGVyVmFsdWUgPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXJWYWx1ZS0tO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSAndG9kYXknKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlclZhbHVlID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGdldEZlZWQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgc2V0RmVlZFVybCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAvLyBzZXQgcGFyYW0gaW4gVVJMXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0gZ2V0RmVlZFBhcmFtcygpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaChwYXJhbXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignZmVlZCcpO1xuICAgICAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnZmVlZCcpO1xuICAgICAgICAgICAgZ2V0RmVlZCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdmaWx0ZXJWYWx1ZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgdmFyICRmZWVkTmV3ZXIgPSAkKCcuZmVlZC1uZXdlcicpLFxuICAgICAgICAgICAgICAgICRmZWVkVG9kYXkgPSAkKCcuZmVlZC10b2RheScpO1xuXG4gICAgICAgICAgICBpZiAodmFsdWUgPiAxKSB7XG4gICAgICAgICAgICAgICAgJGZlZWROZXdlci5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICRmZWVkVG9kYXkucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJGZlZWROZXdlci5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICRmZWVkVG9kYXkuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdpbmdlc3RSZWNvcmRzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBncmlkRmFjdG9yeSwgbmF2U2VydmljZSwgc3VibmF2U2VydmljZSwgZmVlZFNlcnZpY2UpIHtcbiAgICAgICAgJHNjb3BlLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3MuZmVlZDtcblxuICAgICAgICB2YXIgZ3JpZFBhcmFtcyA9IHtcbiAgICAgICAgICAgIHBhZ2U6IDEsIHBhZ2Vfc2l6ZTogMjUsIHN0YXJ0ZWQ6IG51bGwsIGVuZGVkOiBudWxsLCBvcmRlcjogJy10cmFuc2Zlcl9zdGFydGVkJywgc3RhdHVzOiBudWxsXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gY2hlY2sgZm9yIGdyaWRQYXJhbXMgaW4gcXVlcnkgc3RyaW5nLCBhbmQgdXBkYXRlIGFzIG5lY2Vzc2FyeVxuICAgICAgICBfLmZvckVhY2goXy5wYWlycyhncmlkUGFyYW1zKSwgZnVuY3Rpb24gKHBhcmFtKSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBfLmF0KCRsb2NhdGlvbi5zZWFyY2goKSwgcGFyYW1bMF0pO1xuICAgICAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBncmlkUGFyYW1zW3BhcmFtWzBdXSA9IHZhbHVlLmxlbmd0aCA+IDEgPyB2YWx1ZSA6IHZhbHVlWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgZmlsdGVyZWRCeVN0YXR1cyA9IGdyaWRQYXJhbXMuc3RhdHVzID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICB2YXIgZmlsdGVyZWRCeU9yZGVyID0gZ3JpZFBhcmFtcy5vcmRlciA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgJHNjb3BlLmxhc3RNb2RpZmllZFN0YXJ0ID0gZ3JpZFBhcmFtcy5zdGFydGVkID8gbW9tZW50LnV0YyhncmlkUGFyYW1zLnN0YXJ0ZWQpLnRvRGF0ZSgpIDogbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICd3ZWVrcycpLnN0YXJ0T2YoJ2QnKS50b0RhdGUoKTtcblxuICAgICAgICAkc2NvcGUubGFzdE1vZGlmaWVkU3RhcnRQb3B1cCA9IHtcbiAgICAgICAgICAgIG9wZW5lZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLm9wZW5MYXN0TW9kaWZpZWRTdGFydFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgJHNjb3BlLmxhc3RNb2RpZmllZFN0YXJ0UG9wdXAub3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLmxhc3RNb2RpZmllZFN0b3AgPSBncmlkUGFyYW1zLmVuZGVkID8gbW9tZW50LnV0YyhncmlkUGFyYW1zLmVuZGVkKS50b0RhdGUoKSA6IG1vbWVudC51dGMoKS5lbmRPZignZCcpLnRvRGF0ZSgpO1xuICAgICAgICAkc2NvcGUubGFzdE1vZGlmaWVkU3RvcFBvcHVwID0ge1xuICAgICAgICAgICAgb3BlbmVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICAkc2NvcGUub3Blbkxhc3RNb2RpZmllZFN0b3BQb3B1cCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcbiAgICAgICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICRzY29wZS5sYXN0TW9kaWZpZWRTdG9wUG9wdXAub3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLmRhdGVNb2RlbE9wdGlvbnMgPSB7XG4gICAgICAgICAgICB0aW1lem9uZTogJyswMDAnXG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnN0YXR1c1ZhbHVlcyA9IHNjYWxlQ29uZmlnLmluZ2VzdFN0YXR1cztcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkU3RhdHVzID0gZ3JpZFBhcmFtcy5zdGF0dXMgfHwgJHNjb3BlLnN0YXR1c1ZhbHVlc1swXTtcbiAgICAgICAgJHNjb3BlLiR3YXRjaCgnc2VsZWN0ZWRTdGF0dXMnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICgkc2NvcGUubG9hZGluZykge1xuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJlZEJ5U3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXR1cyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJlZEJ5U3RhdHVzID0gdmFsdWUgIT09ICdWSUVXIEFMTCc7XG4gICAgICAgICAgICAgICAgdXBkYXRlU3RhdHVzKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgnbGFzdE1vZGlmaWVkU3RhcnQnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghJHNjb3BlLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICBncmlkUGFyYW1zLnN0YXJ0ZWQgPSB2YWx1ZS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ2xhc3RNb2RpZmllZFN0b3AnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghJHNjb3BlLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgZ3JpZFBhcmFtcy5lbmRlZCA9IHZhbHVlLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cblxuICAgICAgICB2YXIgdXBkYXRlU3RhdHVzID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUgIT0gZ3JpZFBhcmFtcy5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBncmlkUGFyYW1zLnBhZ2UgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZ3JpZFBhcmFtcy5zdGF0dXMgPSB2YWx1ZSA9PT0gJ1ZJRVcgQUxMJyA/IG51bGwgOiB2YWx1ZTtcbiAgICAgICAgICAgIGdyaWRQYXJhbXMucGFnZV9zaXplID0gJHNjb3BlLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgICAgIGlmICghJHNjb3BlLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBkZWZhdWx0Q29sdW1uRGVmcyA9IFtcbiAgICAgICAgICAgIHsgZmllbGQ6ICdmaWxlX25hbWUnLCBkaXNwbGF5TmFtZTogJ0ZpbGUgTmFtZScsIGVuYWJsZUZpbHRlcmluZzogZmFsc2UgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2ZpbGVfc2l6ZScsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdGaWxlIFNpemUnLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPnt7IHJvdy5lbnRpdHkuZmlsZV9zaXplX2Zvcm1hdHRlZCB9fTwvZGl2PicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeyBmaWVsZDogJ3N0cmlrZS50aXRsZScsIGRpc3BsYXlOYW1lOiAnU3RyaWtlIFByb2Nlc3MnLCBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdzdGF0dXMnLFxuICAgICAgICAgICAgICAgIGZpbHRlckhlYWRlclRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtZmlsdGVyLWNvbnRhaW5lclwiPjxzZWxlY3QgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBuZy1tb2RlbD1cImdyaWQuYXBwU2NvcGUuc2VsZWN0ZWRTdGF0dXNcIj48b3B0aW9uIG5nLXNlbGVjdGVkPVwie3sgZ3JpZC5hcHBTY29wZS5zdGF0dXNWYWx1ZXNbJGluZGV4XSA9PSBncmlkLmFwcFNjb3BlLnNlbGVjdGVkU3RhdHVzIH19XCIgdmFsdWU9XCJ7eyBncmlkLmFwcFNjb3BlLnN0YXR1c1ZhbHVlc1skaW5kZXhdIH19XCIgbmctcmVwZWF0PVwic3RhdHVzIGluIGdyaWQuYXBwU2NvcGUuc3RhdHVzVmFsdWVzIHRyYWNrIGJ5ICRpbmRleFwiPnt7IHN0YXR1cy50b1VwcGVyQ2FzZSgpIH19PC9vcHRpb24+PC9zZWxlY3Q+PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ3RyYW5zZmVyX3N0YXJ0ZWQnLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IGZpZWxkOiAndHJhbnNmZXJfZW5kZWQnLCBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdpbmdlc3Rfc3RhcnRlZCcsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHsgZmllbGQ6ICdpbmdlc3RfZW5kZWQnLCBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlIH1cbiAgICAgICAgXTtcblxuICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMgPSBncmlkRmFjdG9yeS5kZWZhdWx0R3JpZE9wdGlvbnMoKTtcbiAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLnBhZ2luYXRpb25DdXJyZW50UGFnZSA9IHBhcnNlSW50KGdyaWRQYXJhbXMucGFnZSB8fCAxKTtcbiAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZSA9IHBhcnNlSW50KGdyaWRQYXJhbXMucGFnZV9zaXplKSB8fCAkc2NvcGUuZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplO1xuICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IGdyaWRGYWN0b3J5LmFwcGx5U29ydENvbmZpZyhkZWZhdWx0Q29sdW1uRGVmcywgZ3JpZFBhcmFtcyk7XG4gICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5kYXRhID0gW107XG4gICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5vblJlZ2lzdGVyQXBpID0gZnVuY3Rpb24gKGdyaWRBcGkpIHtcbiAgICAgICAgICAgICAgICAvL3NldCBncmlkQXBpIG9uIHNjb3BlXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdyaWRBcGkgPSBncmlkQXBpO1xuICAgICAgICAgICAgICAgIC8vICRzY29wZS5ncmlkQXBpLnNlbGVjdGlvbi5vbi5yb3dTZWxlY3Rpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgICAgICAgIC8vICAgICBpZiAoJHNjb3BlLmFjdGlvbkNsaWNrZWQpIHtcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICRzY29wZS5hY3Rpb25DbGlja2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgLy8gICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9mZWVkL2luZ2VzdHMvJyArIHJvdy5lbnRpdHkuaWQpO1xuICAgICAgICAgICAgICAgIC8vICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gICAgIH1cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIH0pO1xuICAgICAgICAgICAgICAgICRzY29wZS5ncmlkQXBpLnBhZ2luYXRpb24ub24ucGFnaW5hdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoY3VycmVudFBhZ2UsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIGdyaWRQYXJhbXMucGFnZSA9IGN1cnJlbnRQYWdlO1xuICAgICAgICAgICAgICAgICAgICBncmlkUGFyYW1zLnBhZ2Vfc2l6ZSA9IHBhZ2VTaXplO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZ3JpZEFwaS5wYWdpbmF0aW9uQ2hhbmdlZCcpO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICRzY29wZS5ncmlkQXBpLmNvcmUub24uc29ydENoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoZ3JpZCwgc29ydENvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5jb2xEZWZzID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKCRzY29wZS5ncmlkQXBpLmdyaWQuY29sdW1ucywgZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sLmNvbERlZi5zb3J0ID0gY29sLnNvcnQ7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmNvbERlZnMgPSAkc2NvcGUuZ3JpZEFwaS5ncmlkLm9wdGlvbnMuY29sdW1uRGVmcztcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNvcnRBcnIgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKHNvcnRDb2x1bW5zLCBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3J0QXJyLnB1c2goY29sLnNvcnQuZGlyZWN0aW9uID09PSAnZGVzYycgPyAnLScgKyBjb2wuZmllbGQgOiBjb2wuZmllbGQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlT3JkZXIoc29ydEFycik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5maWx0ZXJSZXN1bHRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgXy5mb3JFYWNoKF8ucGFpcnMoZ3JpZFBhcmFtcyksIGZ1bmN0aW9uIChwYXJhbSkge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2gocGFyYW1bMF0sIHBhcmFtWzFdKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZ2V0SW5nZXN0cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciB1cGRhdGVPcmRlciA9IGZ1bmN0aW9uIChzb3J0QXJyKSB7XG4gICAgICAgICAgICBncmlkUGFyYW1zLm9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwID8gc29ydEFyciA6IG51bGw7XG4gICAgICAgICAgICBmaWx0ZXJlZEJ5T3JkZXIgPSBzb3J0QXJyLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICAkc2NvcGUuZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRJbmdlc3RzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgZmVlZFNlcnZpY2UuZ2V0SW5nZXN0c09uY2UoZ3JpZFBhcmFtcykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5pbmdlc3RzID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy50b3RhbEl0ZW1zID0gZGF0YS5jb3VudDtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSA9ICRzY29wZS5pbmdlc3RzO1xuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2ZlZWQnKTtcbiAgICAgICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2ZlZWQvaW5nZXN0cycpO1xuICAgICAgICAgICAgaWYgKCFncmlkUGFyYW1zLnN0YXJ0ZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbGFzdE1vZGlmaWVkU3RhcnQ6ICcgKyAkc2NvcGUubGFzdE1vZGlmaWVkU3RhcnQpO1xuICAgICAgICAgICAgICAgIGdyaWRQYXJhbXMuc3RhcnRlZCA9IG1vbWVudC51dGMoJHNjb3BlLmxhc3RNb2RpZmllZFN0YXJ0KS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2goJ3N0YXJ0ZWQnLCBncmlkUGFyYW1zLnN0YXJ0ZWQpLnJlcGxhY2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghZ3JpZFBhcmFtcy5lbmRlZCkge1xuICAgICAgICAgICAgICAgIGdyaWRQYXJhbXMuZW5kZWQgPSBtb21lbnQudXRjKCRzY29wZS5sYXN0TW9kaWZpZWRTdG9wKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2goJ2VuZGVkJywgZ3JpZFBhcmFtcy5lbmRlZCkucmVwbGFjZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZ2V0SW5nZXN0cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIHNldCBjb250YWluZXIgaGVpZ2h0cyBlcXVhbCB0byBhdmFpbGFibGUgcGFnZSBoZWlnaHRcbiAgICAgICAgICAgIHZhciB2aWV3cG9ydCA9IHNjYWxlU2VydmljZS5nZXRWaWV3cG9ydFNpemUoKSxcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBzY2FsZUNvbmZpZy5oZWFkZXJPZmZzZXQgKyBzY2FsZUNvbmZpZy5kYXRlRmlsdGVyT2Zmc2V0LFxuICAgICAgICAgICAgICAgIGdyaWRNYXhIZWlnaHQgPSB2aWV3cG9ydC5oZWlnaHQgLSBvZmZzZXQ7XG5cbiAgICAgICAgICAgICRzY29wZS5ncmlkU3R5bGUgPSAnaGVpZ2h0OiAnICsgZ3JpZE1heEhlaWdodCArICdweDsgbWF4LWhlaWdodDogJyArIGdyaWRNYXhIZWlnaHQgKyAncHg7IG92ZXJmbG93LXk6IGF1dG87JztcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdGZWVkJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBGZWVkID0gZnVuY3Rpb24gKHZhbHVlLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEZlZWQucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0ZlZWQnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxUZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbFRpdGxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBGZWVkLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGZWVkKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXR1c1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEZlZWQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBGZWVkLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEZlZWQuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gRmVlZC5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gRmVlZDtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0ZlZWRTdGF0dXMnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcpIHtcbiAgICAgICAgdmFyIEZlZWRTdGF0dXMgPSBmdW5jdGlvbiAoc3RhdHVzKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBGZWVkU3RhdHVzLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdGZWVkU3RhdHVzJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsRmlsbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfZ3JlZW47XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbEFjdGl2aXR5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxBY3Rpdml0eVRvdGFsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxFcnJvcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsVG90YWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEZlZWRTdGF0dXMuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZlZWRTdGF0dXMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhdHVzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgRmVlZFN0YXR1cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEZlZWRTdGF0dXMudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoRmVlZFN0YXR1cy5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBGZWVkU3RhdHVzLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBGZWVkU3RhdHVzO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ2ZlZWRTZXJ2aWNlJywgZnVuY3Rpb24gKCRsb2NhdGlvbiwgJHRpbWVvdXQsICRxLCAkaHR0cCwgc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSwgRmVlZCwgRmVlZFN0YXR1cykge1xuXG4gICAgICAgIHZhciBnZXRGZWVkUGFyYW1zID0gZnVuY3Rpb24ocGFyYW1zKXtcbiAgICAgICAgICAgIGlmKCFwYXJhbXMpeyBwYXJhbXMgPSB7fTsgfVxuICAgICAgICAgICAgdmFyIHAgPSB7fTtcbiAgICAgICAgICAgIHAucGFnZV9zaXplID0gMTAwMDtcbiAgICAgICAgICAgIHAuc3RhcnRlZCA9IHBhcmFtcy5zdGFydGVkID8gcGFyYW1zLnN0YXJ0ZWQgOiBtb21lbnQudXRjKCkuYWRkKC03LCdkYXlzJykuc3RhcnRPZignZCcpLnRvRGF0ZSgpO1xuICAgICAgICAgICAgcC5lbmRlZCA9IHBhcmFtcy5lbmRlZCA/IHBhcmFtcy5lbmRlZCA6IG1vbWVudC51dGMoKS50b0RhdGUoKTtcbiAgICAgICAgICAgIHAudXNlX2luZ2VzdF90aW1lID0gcGFyYW1zLnVzZV9pbmdlc3RfdGltZSA/IHBhcmFtcy51c2VfaW5nZXN0X3RpbWUgOiBudWxsO1xuICAgICAgICAgICAgcmV0dXJuIHA7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldEluZ2VzdHNQYXJhbXMgPSBmdW5jdGlvbihwYXJhbXMpe1xuICAgICAgICAgICAgcmV0dXJuIHBhcmFtcztcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0RmVlZDogZnVuY3Rpb24ocGFyYW1zKXtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IGdldEZlZWRQYXJhbXMocGFyYW1zKTtcbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnaW5nZXN0cy9zdGF0dXMvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0SW5nZXN0c09uY2U6IGZ1bmN0aW9uKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gZ2V0SW5nZXN0c1BhcmFtcyhwYXJhbXMpO1xuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdpbmdlc3RzLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goZGF0YS5yZXN1bHRzLCBmdW5jdGlvbihkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQuZmlsZV9zaXplX2Zvcm1hdHRlZCA9IHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21CeXRlcyhkLmZpbGVfc2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignbG9hZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgc2NhbGVTZXJ2aWNlLCBuYXZTZXJ2aWNlLCBsb2FkU2VydmljZSwgdWlHcmlkQ29uc3RhbnRzLCBzY2FsZUNvbmZpZywgc3VibmF2U2VydmljZSwgUXVldWVTdGF0dXMsIGdyaWRGYWN0b3J5KSB7XG4gICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgJHNjb3BlLnF1ZXVlU3RhdHVzRXJyb3IgPSBudWxsO1xuICAgICAgICAkc2NvcGUucXVldWVTdGF0dXNFcnJvclN0YXR1cyA9IG51bGw7XG4gICAgICAgICRzY29wZS50b3RhbFF1ZXVlZCA9IDA7XG4gICAgICAgICRzY29wZS5ncmlkU3R5bGUgPSAnJztcbiAgICAgICAgJHNjb3BlLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3MubG9hZDtcbiAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnbG9hZCcpO1xuXG4gICAgICAgICRzY29wZS5nZXRQYWdlID0gZnVuY3Rpb24gKHBhZ2VOdW1iZXIsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBsb2FkU2VydmljZS5nZXRRdWV1ZVN0YXR1cyhwYWdlTnVtYmVyIC0gMSwgcGFnZVNpemUpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV3RGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0RhdGEucHVzaChkYXRhLmpvYnNbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSA9IG5ld0RhdGE7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc3RhdHVzID0gJ1VuYWJsZSB0byBsb2FkIHF1ZXVlIHN0YXR1czogJyArIGVycm9yLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigkc2NvcGUuc3RhdHVzKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zID0gZ3JpZEZhY3RvcnkuZGVmYXVsdEdyaWRPcHRpb25zKCk7XG4gICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZW5hYmxlU29ydGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLmNvbHVtbkRlZnMgPSBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkOiAnam9iX3R5cGVfbmFtZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0pvYiBUeXBlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+PHNwYW4gbmctYmluZC1odG1sPVwicm93LmVudGl0eS5nZXRJY29uKClcIj48L3NwYW4+IHt7IHJvdy5lbnRpdHkuam9iX3R5cGVfbmFtZSB9fTwvZGl2PidcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgeyBmaWVsZDogJ2pvYl90eXBlX3ZlcnNpb24nLCBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgZmllbGQ6ICdoaWdoZXN0X3ByaW9yaXR5JywgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogJ2xvbmdlc3RRdWV1ZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdEdXJhdGlvbiBvZiBMb25nZXN0IFF1ZXVlZCBKb2InLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmdldER1cmF0aW9uKCkgfX08L2Rpdj4nXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgZmllbGQ6ICdjb3VudCcsIGVuYWJsZUZpbHRlcmluZzogZmFsc2UgfSxcbiAgICAgICAgICAgICAgICAgICAgeyBmaWVsZDogJ2lzX2pvYl90eXBlX3BhdXNlZCcsIGVuYWJsZUZpbHRlcmluZzogZmFsc2UgfVxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSA9IFtdO1xuICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLm9uUmVnaXN0ZXJBcGkgPSBmdW5jdGlvbiAoZ3JpZEFwaSkge1xuICAgICAgICAgICAgICAgICAgICAvL3NldCBncmlkQXBpIG9uIHNjb3BlXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5ncmlkQXBpID0gZ3JpZEFwaTtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJvdyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyRsb2NhdGlvbi5wYXRoKCcvam9icycpLnNlYXJjaCh7am9iX3R5cGVfaWQ6IHJvdy5lbnRpdHkuam9iX3R5cGVfaWQsIHN0YXR1czogJ1JVTk5JTkcnfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ3JpZEFwaS5wYWdpbmF0aW9uLm9uLnBhZ2luYXRpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmdldFBhZ2UoY3VycmVudFBhZ2UsIHBhZ2VTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfTtcblxuXG4gICAgICAgICAgICBsb2FkU2VydmljZS5nZXRRdWV1ZVN0YXR1cygwLCAkc2NvcGUuZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplKS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSA9IHJlc3VsdC5xdWV1ZV9zdGF0dXM7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy50b3RhbEl0ZW1zID0gcmVzdWx0LnF1ZXVlX3N0YXR1cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS50b3RhbFF1ZXVlZCA9IF8uc3VtKHJlc3VsdC5xdWV1ZV9zdGF0dXMsICdjb3VudCcpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncXVldWUgc3RhdHVzIHVwZGF0ZWQnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1c1RleHQgJiYgcmVzdWx0LnN0YXR1c1RleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucXVldWVTdGF0dXNFcnJvclN0YXR1cyA9IHJlc3VsdC5zdGF0dXNUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5xdWV1ZVN0YXR1c0Vycm9yID0gJ1VuYWJsZSB0byByZXRyaWV2ZSBxdWV1ZSBzdGF0dXMuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ3F1ZXVlJyk7XG4gICAgICAgIH07XG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIHNldCBjb250YWluZXIgaGVpZ2h0cyBlcXVhbCB0byBhdmFpbGFibGUgcGFnZSBoZWlnaHRcbiAgICAgICAgICAgIHZhciB2aWV3cG9ydCA9IHNjYWxlU2VydmljZS5nZXRWaWV3cG9ydFNpemUoKSxcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBzY2FsZUNvbmZpZy5oZWFkZXJPZmZzZXQsXG4gICAgICAgICAgICAgICAgZ3JpZE1heEhlaWdodCA9IHZpZXdwb3J0LmhlaWdodCAtIG9mZnNldDtcblxuICAgICAgICAgICAgJHNjb3BlLmdyaWRTdHlsZSA9ICdoZWlnaHQ6ICcgKyBncmlkTWF4SGVpZ2h0ICsgJ3B4OyBtYXgtaGVpZ2h0OiAnICsgZ3JpZE1heEhlaWdodCArICdweDsgb3ZlcmZsb3cteTogYXV0bzsnO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2xvYWREZXB0aENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sIG5hdlNlcnZpY2UsIHNjYWxlQ29uZmlnLCBzdWJuYXZTZXJ2aWNlKSB7XG4gICAgICAgICRzY29wZS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmxvYWQ7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2xvYWQvZGVwdGgnKTtcblxuICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignbG9hZCcpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKXtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdxdWV1ZVJ1bm5pbmdDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sIHNjYWxlU2VydmljZSwgbmF2U2VydmljZSwgam9iU2VydmljZSwgZ3JpZEZhY3RvcnksIHVpR3JpZENvbnN0YW50cywgc2NhbGVDb25maWcsIHN1Ym5hdlNlcnZpY2UpIHtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAkc2NvcGUucnVubmluZ0pvYnNFcnJvciA9IG51bGw7XG4gICAgICAgICRzY29wZS5ydW5uaW5nSm9ic0Vycm9yU3RhdHVzID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLnRvdGFsUnVubmluZyA9IDA7XG4gICAgICAgICRzY29wZS5ncmlkU3R5bGUgPSAnJztcbiAgICAgICAgJHNjb3BlLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3MubG9hZDtcbiAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnbG9hZC9ydW5uaW5nJyk7XG5cbiAgICAgICAgJHNjb3BlLmdldFBhZ2UgPSBmdW5jdGlvbiAocGFnZU51bWJlciwgcGFnZVNpemUpe1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgam9iU2VydmljZS5nZXRSdW5uaW5nSm9ic09uY2UocGFnZU51bWJlciAtIDEsIHBhZ2VTaXplKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5ld0RhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTsgaSsrKXtcbiAgICAgICAgICAgICAgICAgICAgbmV3RGF0YS5wdXNoKGRhdGEucmVzdWx0c1tpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5kYXRhID0gbmV3RGF0YTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc3RhdHVzID0gJ1VuYWJsZSB0byBsb2FkIHF1ZXVlIHJ1bm5pbmcgc3RhdHVzOiAnICsgZXJyb3IubWVzc2FnZTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCRzY29wZS5zdGF0dXMpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zID0gZ3JpZEZhY3RvcnkuZGVmYXVsdEdyaWRPcHRpb25zKCk7XG4gICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZW5hYmxlU29ydGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLmNvbHVtbkRlZnMgPSBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogJ3RpdGxlJyxcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdKb2IgVHlwZScsXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj48aSBjbGFzcz1cImZhIGZhLXt7IHJvdy5lbnRpdHkuZ2V0SWNvbigpIH19XCI+PC9pPiB7eyByb3cuZW50aXR5LmpvYl90eXBlLnRpdGxlIH19PC9kaXY+J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge2ZpZWxkOiAnam9iX3R5cGUudmVyc2lvbicsIGVuYWJsZUZpbHRlcmluZzogZmFsc2V9LFxuICAgICAgICAgICAgICAgIHtmaWVsZDogJ2NvdW50JywgZGlzcGxheU5hbWU6ICdOdW1iZXIgb2YgSm9icycsIGVuYWJsZUZpbHRlcmluZzogZmFsc2V9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6ICdsb25nZXN0UnVubmluZycsXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnRHVyYXRpb24gb2YgTG9uZ2VzdCBSdW5uaW5nIEpvYicsXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmdldER1cmF0aW9uKCkgfX08L2Rpdj4nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5kYXRhID0gW107XG4gICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMub25SZWdpc3RlckFwaSA9IGZ1bmN0aW9uIChncmlkQXBpKSB7XG4gICAgICAgICAgICAgICAgLy8gc2V0IGdyaWRBcGkgb24gc2NvcGVcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ3JpZEFwaSA9IGdyaWRBcGk7XG4gICAgICAgICAgICAgICAgZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9qb2JzJykuc2VhcmNoKHtqb2JfdHlwZV9pZDogcm93LmVudGl0eS5qb2JfdHlwZS5pZCwgc3RhdHVzOiAnUlVOTklORyd9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmdyaWRBcGkucGFnaW5hdGlvbi5vbi5wYWdpbmF0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChjdXJyZW50UGFnZSwgcGFnZVNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmdldFBhZ2UoY3VycmVudFBhZ2UsIHBhZ2VTaXplKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGpvYlNlcnZpY2UuZ2V0UnVubmluZ0pvYnMoMCwgJHNjb3BlLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZSkudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSA9IGRhdGEucmVzdWx0cztcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLnRvdGFsSXRlbXMgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudG90YWxSdW5uaW5nID0gXy5zdW0oZGF0YS5yZXN1bHRzLCAnY291bnQnKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3J1bm5pbmcgam9icyB1cGRhdGVkJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzVGV4dCAmJiBkYXRhLnN0YXR1c1RleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucnVubmluZ0pvYnNFcnJvclN0YXR1cyA9IGRhdGEuc3RhdHVzVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucnVubmluZ0pvYnNFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgcnVubmluZyBqb2JzLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2xvYWQnKTtcbiAgICAgICAgfTtcbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgIGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gc2V0IGNvbnRhaW5lciBoZWlnaHRzIGVxdWFsIHRvIGF2YWlsYWJsZSBwYWdlIGhlaWdodFxuICAgICAgICAgICAgdmFyIHZpZXdwb3J0ID0gc2NhbGVTZXJ2aWNlLmdldFZpZXdwb3J0U2l6ZSgpLFxuICAgICAgICAgICAgICAgIG9mZnNldCA9IHNjYWxlQ29uZmlnLmhlYWRlck9mZnNldCxcbiAgICAgICAgICAgICAgICBncmlkTWF4SGVpZ2h0ID0gdmlld3BvcnQuaGVpZ2h0IC0gb2Zmc2V0O1xuXG4gICAgICAgICAgICAkc2NvcGUuZ3JpZFN0eWxlID0gJ2hlaWdodDogJyArIGdyaWRNYXhIZWlnaHQgKyAncHg7IG1heC1oZWlnaHQ6ICcgKyBncmlkTWF4SGVpZ2h0ICsgJ3B4OyBvdmVyZmxvdy15OiBhdXRvOyc7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUXVldWVTdGF0dXMnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgUXVldWVTdGF0dXMgPSBmdW5jdGlvbiAoY291bnQsIGxvbmdlc3RfcXVldWVkLCBqb2JfdHlwZV9uYW1lLCBqb2JfdHlwZV92ZXJzaW9uLCBoaWdoZXN0X3ByaW9yaXR5LCBpc19qb2JfdHlwZV9wYXVzZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY291bnQgPSBjb3VudDtcbiAgICAgICAgICAgIHRoaXMubG9uZ2VzdF9xdWV1ZWQgPSBsb25nZXN0X3F1ZXVlZDtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGVfbmFtZSA9IGpvYl90eXBlX25hbWU7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlX3ZlcnNpb24gPSBqb2JfdHlwZV92ZXJzaW9uO1xuICAgICAgICAgICAgdGhpcy5oaWdoZXN0X3ByaW9yaXR5ID0gaGlnaGVzdF9wcmlvcml0eTtcbiAgICAgICAgICAgIHRoaXMuaXNfam9iX3R5cGVfcGF1c2VkID0gaXNfam9iX3R5cGVfcGF1c2VkO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIFF1ZXVlU3RhdHVzLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldEljb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29uZmlnSm9iVHlwZSA9IF8uZmluZChzY2FsZUNvbmZpZy5qb2JUeXBlcywgJ3RpdGxlJywgdGhpcy5qb2JfdHlwZV9uYW1lKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnSm9iVHlwZSA/ICc8aSBjbGFzcz1cImZhXCI+JiN4JyArIGNvbmZpZ0pvYlR5cGUuY29kZSArICc8L2k+JyA6ICc8aSBjbGFzcz1cImZhXCI+JiN4JyArIHNjYWxlQ29uZmlnLmRlZmF1bHRJY29uQ29kZSArICc8L2k+JztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXREdXJhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRHVyYXRpb24odGhpcy5sb25nZXN0X3F1ZXVlZCwgbW9tZW50LnV0YygpLnRvSVNPU3RyaW5nKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBRdWV1ZVN0YXR1cy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUXVldWVTdGF0dXMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY291bnQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubG9uZ2VzdF9xdWV1ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGVfbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZV92ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmhpZ2hlc3RfcHJpb3JpdHksXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfam9iX3R5cGVfcGF1c2VkXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUXVldWVTdGF0dXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBRdWV1ZVN0YXR1cy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChRdWV1ZVN0YXR1cy5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBRdWV1ZVN0YXR1cy5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gUXVldWVTdGF0dXM7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdsb2FkU2VydmljZScsIGZ1bmN0aW9uKCRodHRwLCAkcSwgJHJlc291cmNlLCBzY2FsZUNvbmZpZywgcG9sbGVyLCBwb2xsZXJGYWN0b3J5LCBRdWV1ZVN0YXR1cykge1xuICAgICAgICB2YXIgZ2V0Sm9iTG9hZFBhcmFtcyA9IGZ1bmN0aW9uIChwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkLCBvcmRlciwgc3RhdHVzLCBqb2JfdHlwZV9pZCwgam9iX3R5cGVfbmFtZSwgam9iX3R5cGVfY2F0ZWdvcnksIHVybCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBzdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9pZDogam9iX3R5cGVfaWQsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfbmFtZTogam9iX3R5cGVfbmFtZSxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9jYXRlZ29yeTogam9iX3R5cGVfY2F0ZWdvcnksXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiAxMDAwLFxuICAgICAgICAgICAgICAgIHVybDogdXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRSZXF1ZXVlSm9ic1BhcmFtcyA9IGZ1bmN0aW9uIChzdGFydGVkLCBlbmRlZCwgam9iX3N0YXR1cywgam9iX3R5cGVfaWRzLCBqb2JfdHlwZV9uYW1lcywgam9iX3R5cGVfY2F0ZWdvcmllcywgcHJpb3JpdHksIHVybCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBzdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICBqb2Jfc3RhdHVzOiBqb2Jfc3RhdHVzLFxuICAgICAgICAgICAgICAgIGpvYl9pZHM6IGpvYl9pZHMsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfaWRzOiBqb2JfdHlwZV9pZHMsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfbmFtZXM6IGpvYl90eXBlX25hbWVzLFxuICAgICAgICAgICAgICAgIGpvYl90eXBlX2NhdGVnb3JpZXM6IGpvYl90eXBlX2NhdGVnb3JpZXMsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IHByaW9yaXR5LFxuICAgICAgICAgICAgICAgIHVybDogdXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRRdWV1ZVN0YXR1czogZnVuY3Rpb24gKHBhZ2VOdW1iZXIsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZV9udW1iZXI6IHBhZ2VOdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogcGFnZVNpemVcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIHF1ZXVlU3RhdHVzUmVzb3VyY2UgPSAkcmVzb3VyY2Uoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAncXVldWUvc3RhdHVzLycsIHBhcmFtcyksXG4gICAgICAgICAgICAgICAgICAgIHF1ZXVlU3RhdHVzUG9sbGVyID0gcG9sbGVyRmFjdG9yeS5uZXdQb2xsZXIocXVldWVTdGF0dXNSZXNvdXJjZSwgc2NhbGVDb25maWcucG9sbEludGVydmFscy5xdWV1ZVN0YXR1cyk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcXVldWVTdGF0dXNQb2xsZXIucHJvbWlzZS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5xdWV1ZV9zdGF0dXMgPSBRdWV1ZVN0YXR1cy50cmFuc2Zvcm1lcihyZXN1bHQucXVldWVfc3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlU3RhdHVzUG9sbGVyLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFF1ZXVlU3RhdHVzT25jZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwLmdldChzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdxdWV1ZS9zdGF0dXMvJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0dXJuRGF0YSA9IFF1ZXVlU3RhdHVzLnRyYW5zZm9ybWVyKGRhdGEucXVldWVfc3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJldHVybkRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlcXVldWVKb2JzOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldFJlcXVldWVKb2JzUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnVybCA9IHBhcmFtcy51cmwgPyBwYXJhbXMudXJsIDogc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAncXVldWUvcmVxdWV1ZS1qb2JzLyc7XG5cbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHBhcmFtcy51cmwsIHBhcmFtcykuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JMb2FkOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYkxvYWRQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMudXJsID0gcGFyYW1zLnVybCA/IHBhcmFtcy51cmwgOiBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdsb2FkLyc7XG5cbiAgICAgICAgICAgICAgICB2YXIgam9iTG9hZFJlc291cmNlID0gJHJlc291cmNlKHBhcmFtcy51cmwsIHBhcmFtcyksXG4gICAgICAgICAgICAgICAgICAgIGpvYkxvYWRQb2xsZXIgPSBwb2xsZXJGYWN0b3J5Lm5ld1BvbGxlcihqb2JMb2FkUmVzb3VyY2UsIHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMuam9iTG9hZCk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gam9iTG9hZFBvbGxlci5wcm9taXNlLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgam9iTG9hZFBvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iTG9hZE9uY2U6IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMgPSBwYXJhbXMgfHwgZ2V0Sm9iTG9hZFBhcmFtcygpO1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBwYXJhbXMudXJsID8gcGFyYW1zLnVybCA6IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2xvYWQvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYkRldGFpbENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sICRyb3V0ZVBhcmFtcywgJHVpYk1vZGFsLCBuYXZTZXJ2aWNlLCBqb2JTZXJ2aWNlLCBqb2JFeGVjdXRpb25TZXJ2aWNlLCBub2RlU2VydmljZSwgbG9hZFNlcnZpY2UsIHNjYWxlQ29uZmlnLCBzdWJuYXZTZXJ2aWNlLCB1c2VyU2VydmljZSwgc2NhbGVTZXJ2aWNlLCB0b2FzdHIpIHtcbiAgICAgICAgJHNjb3BlLmpvYiA9IHt9O1xuICAgICAgICAkc2NvcGUuam9iSWQgPSAkcm91dGVQYXJhbXMuaWQ7XG4gICAgICAgICRzY29wZS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmpvYnM7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2pvYnMnKTtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmdKb2JEZXRhaWwgPSBmYWxzZTtcbiAgICAgICAgJHNjb3BlLmxhdGVzdEV4ZWN1dGlvbiA9IG51bGw7XG4gICAgICAgICRzY29wZS5leGVjdXRpb25Mb2cgPSBudWxsO1xuICAgICAgICAkc2NvcGUuZXhlY3V0aW9uRGV0YWlscyA9IG51bGw7XG4gICAgICAgICRzY29wZS5zZWxlY3RlZEV4ZWN0dWlvbkRldGFpbFZhbHVlcyA9IG51bGw7XG4gICAgICAgICRzY29wZS50aW1lbGluZSA9IFtdO1xuICAgICAgICAkc2NvcGUucmVhZG9ubHkgPSB0cnVlO1xuICAgICAgICAkc2NvcGUuam9iRXJyb3JDcmVhdGVkID0gJyc7XG4gICAgICAgICRzY29wZS5qb2JFcnJvckxhc3RNb2RpZmllZCA9ICcnO1xuICAgICAgICAkc2NvcGUubGFzdFN0YXR1c0NoYW5nZSA9ICcnO1xuICAgICAgICAkc2NvcGUudHJpZ2dlck9jY3VycmVkID0gJyc7XG5cbiAgICAgICAgJHNjb3BlLnNob3dMb2cgPSBmdW5jdGlvbiAoZXhlY3V0aW9uKSB7XG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRFeGVjdXRpb25Mb2cgPSBleGVjdXRpb247XG4gICAgICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdzaG93TG9nLmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXG4gICAgICAgICAgICAgICAgLy9zaXplOiAnbGcnLFxuICAgICAgICAgICAgICAgIHdpbmRvd0NsYXNzOiAnbG9nLW1vZGFsLXdpbmRvdydcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5zaG93RXhlY3V0aW9uRGV0YWlscyA9IGZ1bmN0aW9uIChleGVjdXRpb25JZCkge1xuICAgICAgICAgICAgam9iRXhlY3V0aW9uU2VydmljZS5nZXRKb2JFeGVjdXRpb25EZXRhaWxzKGV4ZWN1dGlvbklkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXhlY3V0aW9uRGV0YWlscyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXhlY3V0aW9uRGV0YWlsVmFsdWVzID0gXy5wYWlycyhkYXRhKTtcbiAgICAgICAgICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3Nob3dFeGVjdXRpb25EZXRhaWxzLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiAnbGcnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUubWVkaWFUeXBlQ2xhc3MgPSBmdW5jdGlvbiAobWVkaWFUeXBlKSB7XG4gICAgICAgICAgICB2YXIgbWVkaWFUeXBlQ2ZnID0gXy5maW5kKHNjYWxlQ29uZmlnLm1lZGlhVHlwZXMsICdtaW1lVHlwZScsIG1lZGlhVHlwZSk7XG4gICAgICAgICAgICBpZiAobWVkaWFUeXBlQ2ZnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lZGlhVHlwZUNmZy5pY29uO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUucmVxdWV1ZUpvYiA9IGZ1bmN0aW9uIChqb2JJZCkge1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgbG9hZFNlcnZpY2UucmVxdWV1ZUpvYnMoeyBqb2JfaWRzOiBbam9iSWRdIH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB0b2FzdHJbJ3N1Y2Nlc3MnXSgnUmVxdWV1ZWQgSm9iJyk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmpvYi5zdGF0dXMgPSBkYXRhLmpvYl9zdGF0dXM7XG4gICAgICAgICAgICAgICAgZ2V0Sm9iRGV0YWlsKGpvYklkKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXSgnUmVxdWV1ZSByZXF1ZXN0IGZhaWxlZCcpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuY2FuY2VsSm9iID0gZnVuY3Rpb24gKGpvYikge1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgJHNjb3BlLmFjdGlvbkNsaWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgdmFyIG9yaWdpbmFsU3RhdHVzID0gam9iLnN0YXR1cztcbiAgICAgICAgICAgIGpvYi5zdGF0dXMgPSAnQ0FOQ0VMJztcbiAgICAgICAgICAgIGpvYlNlcnZpY2UudXBkYXRlSm9iKGpvYi5pZCwgeyBzdGF0dXM6ICdDQU5DRUxFRCcgfSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnc3VjY2VzcyddKCdKb2IgQ2FuY2VsZWQnKTtcbiAgICAgICAgICAgICAgICBqb2Iuc3RhdHVzID0gJ0NBTkNFTEVEJztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgIGpvYi5zdGF0dXMgPSBvcmlnaW5hbFN0YXR1cztcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgICRzY29wZS5jYWxjdWxhdGVGaWxlU2l6ZSA9IGZ1bmN0aW9uIChzaXplKSB7XG4gICAgICAgICAgICByZXR1cm4gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUZpbGVTaXplRnJvbUJ5dGVzKHNpemUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRKb2JEZXRhaWwgPSBmdW5jdGlvbiAoam9iSWQpIHtcbiAgICAgICAgICAgICRzY29wZS5sb2FkaW5nSm9iRGV0YWlsID0gdHJ1ZTtcbiAgICAgICAgICAgIGpvYlNlcnZpY2UuZ2V0Sm9iRGV0YWlsKGpvYklkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmpvYiA9IGRhdGE7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnRpbWVsaW5lID0gY2FsY3VsYXRlVGltZWxpbmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgLy8gJHNjb3BlLnB1Ymxpc2hlZFByb2R1Y3RzID0gXy53aGVyZShkYXRhLnByb2R1Y3RzLCB7ICdpc19wdWJsaXNoZWQnOiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgIC8vICRzY29wZS51bnB1Ymxpc2hlZFByb2R1Y3RzID0gXy53aGVyZShkYXRhLnByb2R1Y3RzLCB7ICdpc19wdWJsaXNoZWQnOiBmYWxzZSB9KTtcbiAgICAgICAgICAgICAgICAvLyAkc2NvcGUucHVibGlzaGVkUHJvZHVjdHNHcm91cGVkID0gXy5wYWlycyhfLmdyb3VwQnkoJHNjb3BlLnB1Ymxpc2hlZFByb2R1Y3RzLCAnam9iX2V4ZS5pZCcpKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUubGF0ZXN0RXhlY3V0aW9uID0gZGF0YS5nZXRMYXRlc3RFeGVjdXRpb24oKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuam9iRXJyb3JDcmVhdGVkID0gZGF0YS5lcnJvciA/IG1vbWVudC51dGMoZGF0YS5lcnJvci5jcmVhdGVkKS50b0lTT1N0cmluZygpIDogJyc7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmxhc3RTdGF0dXNDaGFuZ2UgPSBkYXRhLmxhc3Rfc3RhdHVzX2NoYW5nZSA/IG1vbWVudC5kdXJhdGlvbihtb21lbnQudXRjKGRhdGEubGFzdF9zdGF0dXNfY2hhbmdlKS5kaWZmKG1vbWVudC51dGMoKSkpLmh1bWFuaXplKHRydWUpIDogJyc7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnRyaWdnZXJPY2N1cnJlZCA9IGRhdGEuZXZlbnQub2NjdXJyZWQgPyBtb21lbnQuZHVyYXRpb24obW9tZW50LnV0YyhkYXRhLmV2ZW50Lm9jY3VycmVkKS5kaWZmKG1vbWVudC51dGMoKSkpLmh1bWFuaXplKHRydWUpIDogJyc7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmlucHV0cyA9IGRhdGEuaW5wdXRzO1xuICAgICAgICAgICAgICAgICRzY29wZS5vdXRwdXRzID0gZGF0YS5vdXRwdXRzO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmdKb2JEZXRhaWwgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBjYWxjdWxhdGVUaW1lbGluZSA9IGZ1bmN0aW9uIChqb2IpIHtcbiAgICAgICAgICAgIHZhciB0bCA9IFtdO1xuICAgICAgICAgICAgdGwucHVzaCh7IHRhc2tOYW1lOiAnQ3JlYXRlZCcsIHN0YXJ0ZWQ6IGpvYi5jcmVhdGVkID8gbW9tZW50LnV0Yyhqb2IuY3JlYXRlZCkudG9EYXRlKCkgOiBqb2IuY3JlYXRlZCwgZW5kZWQ6IGpvYi5xdWV1ZWQgPyBtb21lbnQudXRjKGpvYi5xdWV1ZWQpLnRvRGF0ZSgpIDogam9iLnF1ZXVlZCB9KTtcbiAgICAgICAgICAgIHRsLnB1c2goeyB0YXNrTmFtZTogJ1F1ZXVlZCcsIHN0YXJ0ZWQ6IGpvYi5xdWV1ZWQgPyBtb21lbnQudXRjKGpvYi5xdWV1ZWQpLnRvRGF0ZSgpIDogam9iLnF1ZXVlZCwgZW5kZWQ6IGpvYi5zdGFydGVkID8gbW9tZW50LnV0Yyhqb2Iuc3RhcnRlZCkudG9EYXRlKCkgOiBqb2Iuc3RhcnRlZCB9KTtcbiAgICAgICAgICAgIHRsLnB1c2goeyB0YXNrTmFtZTogJ0V4ZWN1dGVkJywgc3RhcnRlZDogam9iLnN0YXJ0ZWQgPyBtb21lbnQudXRjKGpvYi5zdGFydGVkKS50b0RhdGUoKSA6IGpvYi5zdGFydGVkLCBlbmRlZDogam9iLmVuZGVkID8gbW9tZW50LnV0Yyhqb2IuZW5kZWQpLnRvRGF0ZSgpIDogam9iLmVuZGVkIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdGw7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdqb2JzJyk7XG5cbiAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJDcmVkcygpO1xuICAgICAgICAgICAgaWYoJHJvb3RTY29wZS51c2VyKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVhZG9ubHkgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZ2V0Sm9iRGV0YWlsKCRzY29wZS5qb2JJZCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignam9iRXhlY3V0aW9uRGV0YWlsQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlUGFyYW1zLCBuYXZTZXJ2aWNlLCBqb2JFeGVjdXRpb25TZXJ2aWNlLCBub2RlU2VydmljZSwgc2NhbGVDb25maWcsIHN1Ym5hdlNlcnZpY2UpIHtcbiAgICAgICAgJHNjb3BlLmpvYkV4ZWN1dGlvbiA9IHt9O1xuICAgICAgICAkc2NvcGUuam9iRXhlY3V0aW9uSWQgPSAkcm91dGVQYXJhbXMuaWQ7XG4gICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgJHNjb3BlLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3Muam9icztcbiAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgnam9icy9ydW5zJyk7XG5cbiAgICAgICAgdmFyIGdldEpvYkV4ZWN1dGlvbkRldGFpbCA9IGZ1bmN0aW9uIChqb2JFeGVjdXRpb25JZCkge1xuICAgICAgICAgICAgam9iRXhlY3V0aW9uU2VydmljZS5nZXRKb2JFeGVjdXRpb25EZXRhaWwoaWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuam9iRXhlY3V0aW9uID0gZGF0YTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdldEpvYkV4ZWN1dGlvbkRldGFpbCgkcm91dGVQYXJhbXMuaWQpO1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignam9icycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdqb2JFeGVjdXRpb25zQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGxvY2F0aW9uLCBuYXZTZXJ2aWNlLCBzdGF0c1NlcnZpY2UsIGpvYkV4ZWN1dGlvblNlcnZpY2UsIGpvYlR5cGVTZXJ2aWNlLCB1aUdyaWRDb25zdGFudHMsIHNjYWxlQ29uZmlnLCBzdWJuYXZTZXJ2aWNlKSB7XG5cbiAgICAgICAgJHNjb3BlLmpvYkV4ZWN1dGlvbnMgPSBbXTtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAkc2NvcGUuam9iVHlwZVZhbHVlcyA9IFtdO1xuICAgICAgICAkc2NvcGUuc2VsZWN0ZWRKb2JUeXBlID0gJyc7XG4gICAgICAgICRzY29wZS5qb2JTdGF0dXMgPSBzY2FsZUNvbmZpZy5qb2JTdGF0dXM7XG4gICAgICAgICRzY29wZS5zZWxlY3RlZEpvYlN0YXR1cyA9ICcnO1xuICAgICAgICAkc2NvcGUuc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5qb2JzO1xuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdqb2JzL2V4ZWN1dGlvbnMnKTtcblxuICAgICAgICB2YXIgZ3JpZEZpbHRlciA9IHt9LFxuICAgICAgICAgICAgZ3JpZFBhZ2VOdW1iZXIgPSAxO1xuXG4gICAgICAgICRzY29wZS5ncmlkT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGVuYWJsZVJvd1NlbGVjdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgIGVuYWJsZVJvd0hlYWRlclNlbGVjdGlvbjogZmFsc2UsXG4gICAgICAgICAgICBlbmFibGVIb3Jpem9udGFsU2Nyb2xsYmFyOiB1aUdyaWRDb25zdGFudHMuc2Nyb2xsYmFycy5ORVZFUixcbiAgICAgICAgICAgIG11bHRpU2VsZWN0OiBmYWxzZSxcbiAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogdHJ1ZSxcbiAgICAgICAgICAgIHVzZUV4dGVybmFsRmlsdGVyaW5nOiB0cnVlLFxuICAgICAgICAgICAgZW5hYmxlU29ydGluZzogdHJ1ZSxcbiAgICAgICAgICAgIG1pblJvd3NUb1Nob3c6IDE3LFxuICAgICAgICAgICAgcGFnaW5hdGlvblBhZ2VTaXplczogWzI1LDUwLDc1XSxcbiAgICAgICAgICAgIHBhZ2luYXRpb25QYWdlU2l6ZTogMjUsXG4gICAgICAgICAgICB1c2VFeHRlcm5hbFBhZ2luYXRpb246IHRydWUsXG4gICAgICAgICAgICBjb2x1bW5EZWZzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogJ2pvYlR5cGVJZCcsXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnSm9iIFR5cGUnLFxuICAgICAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+PHNwYW4gbmctYmluZC1odG1sPVwicm93LmVudGl0eS5nZXRJY29uKClcIj48L3NwYW4+IHt7IHJvdy5lbnRpdHkuam9iLmpvYlR5cGUudGl0bGUgfX08L2Rpdj4nLFxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJIZWFkZXJUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWZpbHRlci1jb250YWluZXJcIj48c2VsZWN0IGNsYXNzPVwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIgbmctbW9kZWw9XCJncmlkLmFwcFNjb3BlLnNlbGVjdGVkSm9iVHlwZVwiPjxvcHRpb24gdmFsdWU9XCJ7eyBncmlkLmFwcFNjb3BlLmpvYlR5cGVWYWx1ZXNbJGluZGV4XS5pZCB9fVwiIG5nLXJlcGVhdD1cImpvYlR5cGUgaW4gZ3JpZC5hcHBTY29wZS5qb2JUeXBlVmFsdWVzIHRyYWNrIGJ5ICRpbmRleFwiPnt7IGdyaWQuYXBwU2NvcGUuam9iVHlwZVZhbHVlc1skaW5kZXhdLm5hbWUgfX0ge3sgZ3JpZC5hcHBTY29wZS5qb2JUeXBlVmFsdWVzWyRpbmRleF0udmVyc2lvbiB9fTwvb3B0aW9uPjwvc2VsZWN0PidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHsgZmllbGQ6ICdjcmVhdGVkJywgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSwgY2VsbEZpbHRlcjogJ2RhdGU6XFwneXl5eS1NTS1kZCBISDptbTpzc1xcJycgfSxcbiAgICAgICAgICAgICAgICB7IGZpZWxkOiAnbGFzdE1vZGlmaWVkJywgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSwgY2VsbEZpbHRlcjogJ2RhdGU6XFwneXl5eS1NTS1kZCBISDptbTpzc1xcJycgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiAnc3RhdHVzJyxcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVySGVhZGVyVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1maWx0ZXItY29udGFpbmVyXCI+PHNlbGVjdCBjbGFzcz1cImZvcm0tY29udHJvbCBpbnB1dC1zbVwiIG5nLW1vZGVsPVwiZ3JpZC5hcHBTY29wZS5zZWxlY3RlZEpvYlN0YXR1c1wiPjxvcHRpb24gbmctcmVwZWF0PVwic3RhdHVzIGluIGdyaWQuYXBwU2NvcGUuam9iU3RhdHVzIHRyYWNrIGJ5ICRpbmRleFwiPnt7IHN0YXR1cy50b1VwcGVyQ2FzZSgpIH19PC9vcHRpb24+PC9zZWxlY3Q+J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgeyBmaWVsZDogJ2lkJywgZGlzcGxheU5hbWU6ICdJRCcsIGVuYWJsZUZpbHRlcmluZzogZmFsc2UgfVxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIGRhdGE6IFtdLFxuICAgICAgICAgICAgb25SZWdpc3RlckFwaTogZnVuY3Rpb24gKGdyaWRBcGkpIHtcbiAgICAgICAgICAgICAgICAvL3NldCBncmlkQXBpIG9uIHNjb3BlXG4gICAgICAgICAgICAgICAgJHNjb3BlLmdyaWRBcGkgPSBncmlkQXBpO1xuICAgICAgICAgICAgICAgICRzY29wZS5ncmlkQXBpLnNlbGVjdGlvbi5vbi5yb3dTZWxlY3Rpb25DaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vJGxvY2F0aW9uLnBhdGgoJy9qb2JleGVjdXRpb25zLycgKyByb3cuZW50aXR5LmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJvdyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICRzY29wZS5ncmlkQXBpLnBhZ2luYXRpb24ub24ucGFnaW5hdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoY3VycmVudFBhZ2UsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5nZXRQYWdlKGN1cnJlbnRQYWdlLCBwYWdlU2l6ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgnc2VsZWN0ZWRKb2JUeXBlJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoISRzY29wZS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgZ3JpZEZpbHRlci5qb2JUeXBlSWQgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ2V0UGFnZShncmlkUGFnZU51bWJlciwgJHNjb3BlLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZSwgZ3JpZEZpbHRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3NlbGVjdGVkSm9iU3RhdHVzJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoISRzY29wZS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgZ3JpZEZpbHRlci5qb2JTdGF0dXMgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ2V0UGFnZShncmlkUGFnZU51bWJlciwgJHNjb3BlLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZSwgZ3JpZEZpbHRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS5nZXRQYWdlID0gZnVuY3Rpb24gKHBhZ2VOdW1iZXIsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICBncmlkUGFnZU51bWJlciA9IHBhZ2VOdW1iZXI7XG4gICAgICAgICAgICBqb2JFeGVjdXRpb25TZXJ2aWNlLmdldEpvYkV4ZWN1dGlvbnMocGFnZU51bWJlciwgcGFnZVNpemUsIGdyaWRGaWx0ZXIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV3RGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmV4ZWN1dGlvbnNbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0RhdGEucHVzaChkYXRhLmV4ZWN1dGlvbnNbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5kYXRhID0gbmV3RGF0YTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMudG90YWxJdGVtcyA9IGRhdGEuY291bnQ7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldEpvYkV4ZWN1dGlvbnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBqb2JFeGVjdXRpb25TZXJ2aWNlLmdldEpvYkV4ZWN1dGlvbnMoZ3JpZFBhZ2VOdW1iZXIsICRzY29wZS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemUsIGdyaWRGaWx0ZXIpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlWydzY2FsZS1qb2JleGVjdXRpb25zLXRpbWUnXSA9IG1vbWVudC51dGMoKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2VbJ3NjYWxlLWpvYmV4ZWN1dGlvbnMnXSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpO1xuICAgICAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy50b3RhbEl0ZW1zID0gZGF0YS5jb3VudDtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSA9IGRhdGEuZXhlY3V0aW9ucztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGdldEpvYlR5cGVzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Sm9iVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBqb2JUeXBlU2VydmljZS5nZXRKb2JUeXBlc09uY2UoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmpvYlR5cGVWYWx1ZXMgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmpvYlR5cGVWYWx1ZXMudW5zaGlmdCh7IG5hbWU6ICcnLCB2ZXJzaW9uOiAnJywgaWQ6IG51bGwgfSk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGdldEpvYkV4ZWN1dGlvbnMoKTtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ2pvYnMnKTtcbiAgICAgICAgfTtcbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYlR5cGVzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCBob3RrZXlzLCBzY2FsZVNlcnZpY2UsIG5hdlNlcnZpY2UsIGpvYlR5cGVTZXJ2aWNlLCBzY2FsZUNvbmZpZywgc3VibmF2U2VydmljZSwgbm9kZVNlcnZpY2UsIGxvY2FsU3RvcmFnZSwgdXNlclNlcnZpY2UpIHtcbiAgICAgICAgJHNjb3BlLnJlcXVlc3RlZEpvYlR5cGVJZCA9IHBhcnNlSW50KCRyb3V0ZVBhcmFtcy5pZCk7XG4gICAgICAgICRzY29wZS5tYXN0ZXJDb250YWluZXJTdHlsZSA9ICcnO1xuICAgICAgICAkc2NvcGUuZGV0YWlsQ29udGFpbmVyU3R5bGUgPSAnJztcbiAgICAgICAgJHNjb3BlLmpvYlR5cGVzID0gW107XG4gICAgICAgICRzY29wZS5qb2JUeXBlSWRzID0gW107XG4gICAgICAgICRzY29wZS5qb2JUeXBlQ291bnQgPSAwO1xuICAgICAgICAkc2NvcGUuYWN0aXZlSm9iVHlwZURldGFpbHMgPSB7fTtcbiAgICAgICAgJHNjb3BlLmFjdGl2ZUpvYlR5cGVJbnRlcmZhY2VWYWx1ZXMgPSBbXTtcbiAgICAgICAgJHNjb3BlLmFjdGl2ZUpvYlR5cGVFcnJvcnMgPSBbXTtcbiAgICAgICAgJHNjb3BlLmFjdGl2ZUpvYlR5cGVTdGF0cyA9IHt9O1xuICAgICAgICAkc2NvcGUuc2hvd0pvYlR5cGVFcnJvcnMgPSBmYWxzZTtcbiAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAkc2NvcGUuYWN0aXZlSm9iVHlwZSA9IG51bGw7XG4gICAgICAgICRzY29wZS5oZWFsdGhEYXRhNiA9IHt9O1xuICAgICAgICAkc2NvcGUuaGVhbHRoRGF0YTEyID0ge307XG4gICAgICAgICRzY29wZS5oZWFsdGhEYXRhMjQgPSB7fTtcbiAgICAgICAgJHNjb3BlLmFjdGl2aXR5SWNvbiA9ICc8aSBjbGFzcz1cImZhIGZhLXB1bHNlXCI+JiN4JyArIHNjYWxlQ29uZmlnLmFjdGl2aXR5SWNvbkNvZGUgKyAnPC9pPic7XG4gICAgICAgICRzY29wZS5zZWxlY3RKb2JDbGFzcyA9ICd2aXNpYmxlJztcbiAgICAgICAgJHNjb3BlLmpvYkRldGFpbHNDbGFzcyA9ICdpbnZpc2libGUnO1xuICAgICAgICAkc2NvcGUucGF1c2VCdG5DbGFzcyA9ICdmYS1wYXVzZSc7XG4gICAgICAgICRzY29wZS51c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgICRzY29wZS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLmpvYnM7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2pvYnMvdHlwZXMnKTtcblxuICAgICAgICB2YXIgam9iVHlwZVN0YXRzID0ge307XG5cbiAgICAgICAgJHNjb3BlLnZpZXdEZXRhaWxzID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAkc2NvcGUuYWN0aXZlSm9iVHlwZSA9IF8uZmluZCgkc2NvcGUuam9iVHlwZXMsICdpZCcsIGlkKTtcbiAgICAgICAgICAgICRzY29wZS5hY3RpdmVKb2JUeXBlLmNyZWF0ZWQgPSBmb3JtYXREYXRlVGltZSgkc2NvcGUuYWN0aXZlSm9iVHlwZS5jcmVhdGVkKTtcbiAgICAgICAgICAgICRzY29wZS5hY3RpdmVKb2JUeXBlLmxhc3RNb2RpZmllZCA9IGZvcm1hdERhdGVUaW1lKCRzY29wZS5hY3RpdmVKb2JUeXBlLmxhc3RNb2RpZmllZCk7XG5cbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdqb2JzL3R5cGVzLycgKyBpZCk7XG5cbiAgICAgICAgICAgIGdldEpvYlR5cGVEZXRhaWxzKCRzY29wZS5hY3RpdmVKb2JUeXBlLmlkKTtcblxuICAgICAgICAgICAgLy9mb3JtYXRKb2JUeXBlU3RhdHMoKTtcblxuICAgICAgICAgICAgJHNjb3BlLmpvYkRldGFpbHNDbGFzcyA9ICd2aXNpYmxlJztcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RKb2JDbGFzcyA9ICdpbnZpc2libGUnO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS50b2dnbGVQYXVzZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5hY3RpdmVKb2JUeXBlLmlzX3BhdXNlZCA9ICEkc2NvcGUuYWN0aXZlSm9iVHlwZS5pc19wYXVzZWQ7XG4gICAgICAgICAgICAkc2NvcGUuYWN0aXZlSm9iVHlwZURldGFpbHMuaXNfcGF1c2VkID0gJHNjb3BlLmFjdGl2ZUpvYlR5cGUuaXNfcGF1c2VkO1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgam9iVHlwZVNlcnZpY2UudXBkYXRlSm9iVHlwZSgkc2NvcGUuYWN0aXZlSm9iVHlwZURldGFpbHMpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmFjdGl2ZUpvYlR5cGVEZXRhaWxzID0gZGF0YTtcbiAgICAgICAgICAgICAgICAkc2NvcGUucGF1c2VCdG5DbGFzcyA9ICRzY29wZS5nZXRQYXVzZUJ1dHRvbkNsYXNzKCRzY29wZS5hY3RpdmVKb2JUeXBlRGV0YWlscy5pc19wYXVzZWQpO1xuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICAgICAgdG9hc3RyWydlcnJvciddKGVycm9yKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLmdldFBhdXNlQnV0dG9uQ2xhc3MgPSBmdW5jdGlvbihpc19wYXVzZWQpe1xuICAgICAgICAgICAgcmV0dXJuIGlzX3BhdXNlZCA/ICdmYS1wbGF5JyA6ICdmYS1wYXVzZSc7XG4gICAgICAgIH1cblxuICAgICAgICAkc2NvcGUuZ2V0Sm9iVHlwZUxpc3RJdGVtQ2xhc3MgPSBmdW5jdGlvbihqb2JUeXBlKXtcbiAgICAgICAgICAgIHJldHVybiBqb2JUeXBlLmlzX3BhdXNlZCA/ICdwYXVzZWQnIDogJyc7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZm9ybWF0RGF0ZVRpbWUgPSBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgICAgIHJldHVybiBtb21lbnQudXRjKGR0KS50b0lTT1N0cmluZygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRKb2JUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpvYlR5cGVTZXJ2aWNlLmdldEpvYlR5cGVzT25jZSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuam9iVHlwZXMgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmpvYlR5cGVJZHMgPSBfLnBsdWNrKGRhdGEucmVzdWx0cywgJ2lkJyk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmpvYlR5cGVDb3VudCA9IGRhdGEuY291bnQ7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5yZXF1ZXN0ZWRKb2JUeXBlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnZpZXdEZXRhaWxzKCRzY29wZS5yZXF1ZXN0ZWRKb2JUeXBlSWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGhvdGtleXMuYmluZFRvKCRzY29wZSlcbiAgICAgICAgICAgICAgICAgICAgLmFkZCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21ibzogJ2N0cmwrdXAnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdQcmV2aW91cyBKb2IgVHlwZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuYWN0aXZlSm9iVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gXy5pbmRleE9mKCRzY29wZS5qb2JUeXBlSWRzLCAkc2NvcGUuYWN0aXZlSm9iVHlwZS5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZHggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudmlld0RldGFpbHMoJHNjb3BlLmpvYlR5cGVJZHNbaWR4IC0gMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KS5hZGQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tYm86ICdjdHJsK2Rvd24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdOZXh0IEpvYiBUeXBlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5hY3RpdmVKb2JUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSBfLmluZGV4T2YoJHNjb3BlLmpvYlR5cGVJZHMsICRzY29wZS5hY3RpdmVKb2JUeXBlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA8ICgkc2NvcGUuam9iVHlwZUlkcy5sZW5ndGggLSAxKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnZpZXdEZXRhaWxzKCRzY29wZS5qb2JUeXBlSWRzW2lkeCArIDFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRKb2JUeXBlRGV0YWlscyA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgam9iVHlwZVNlcnZpY2UuZ2V0Sm9iVHlwZURldGFpbHMoaWQpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZlSm9iVHlwZURldGFpbHMgPSBkYXRhO1xuICAgICAgICAgICAgICAgICRzY29wZS5hY3RpdmVKb2JUeXBlSW50ZXJmYWNlVmFsdWVzID0gXy5wYWlycyhkYXRhLmpvYl90eXBlX2ludGVyZmFjZSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhdXNlQnRuQ2xhc3MgPSAkc2NvcGUuZ2V0UGF1c2VCdXR0b25DbGFzcygkc2NvcGUuYWN0aXZlSm9iVHlwZURldGFpbHMuaXNfcGF1c2VkKTtcbiAgICAgICAgICAgICAgICAvLyBmb3JtYXQgZXJyb3IgbWFwcGluZ1xuICAgICAgICAgICAgICAgICRzY29wZS5hY3RpdmVKb2JUeXBlRXJyb3JzID0gW107XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dKb2JUeXBlRXJyb3JzID0gXy5rZXlzKGRhdGEuZXJyb3JfbWFwcGluZy5leGl0X2NvZGVzKS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuc2hvd0pvYlR5cGVFcnJvcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGRhdGEuZXJyb3JfbWFwcGluZy5leGl0X2NvZGVzLCBmdW5jdGlvbiAoZXJyb3JfbmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gXy5maW5kKGRhdGEuZXJyb3JzLCAnbmFtZScsIGVycm9yX25hbWUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4aXRDb2RlID0gXy5pbnZlcnQoZGF0YS5lcnJvcl9tYXBwaW5nLmV4aXRfY29kZXMpW2Vycm9yX25hbWVdO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFjdGl2ZUpvYlR5cGVFcnJvcnMucHVzaCh7Y29kZTogZXhpdENvZGUsIGRhdGE6IGVycm9yfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGZvcm1hdCBqb2IgdHlwZSBzdGF0c1xuICAgICAgICAgICAgICAgIHZhciBwZXJmb3JtYW5jZSA9IGRhdGEuZ2V0UGVyZm9ybWFuY2UoKSxcbiAgICAgICAgICAgICAgICAgICAgZmFpbHVyZXMgPSBkYXRhLmdldEZhaWx1cmVzKCk7XG5cbiAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZlSm9iVHlwZVN0YXRzID0gcGVyZm9ybWFuY2U7XG5cbiAgICAgICAgICAgICAgICAkc2NvcGUuaGVhbHRoRGF0YTYgPSB7XG4gICAgICAgICAgICAgICAgICAgIGdhdWdlRGF0YTogcGVyZm9ybWFuY2UuaG91cjYucmF0ZSxcbiAgICAgICAgICAgICAgICAgICAgZG9udXREYXRhOiBmYWlsdXJlcy5ob3VyNlxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgJHNjb3BlLmhlYWx0aERhdGExMiA9IHtcbiAgICAgICAgICAgICAgICAgICAgZ2F1Z2VEYXRhOiBwZXJmb3JtYW5jZS5ob3VyMTIucmF0ZSxcbiAgICAgICAgICAgICAgICAgICAgZG9udXREYXRhOiBmYWlsdXJlcy5ob3VyMTJcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICRzY29wZS5oZWFsdGhEYXRhMjQgPSB7XG4gICAgICAgICAgICAgICAgICAgIGdhdWdlRGF0YTogcGVyZm9ybWFuY2UuaG91cjI0LnJhdGUsXG4gICAgICAgICAgICAgICAgICAgIGRvbnV0RGF0YTogZmFpbHVyZXMuaG91cjI0XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdldEpvYlR5cGVzKCk7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdqb2JzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBzZXQgY29udGFpbmVyIGhlaWdodHMgZXF1YWwgdG8gYXZhaWxhYmxlIHBhZ2UgaGVpZ2h0XG4gICAgICAgICAgICB2YXIgdmlld3BvcnQgPSBzY2FsZVNlcnZpY2UuZ2V0Vmlld3BvcnRTaXplKCksXG4gICAgICAgICAgICAgICAgbWFzdGVyT2Zmc2V0ID0gc2NhbGVDb25maWcuaGVhZGVyT2Zmc2V0LFxuICAgICAgICAgICAgICAgIGRldGFpbE9mZnNldCA9IHNjYWxlQ29uZmlnLmhlYWRlck9mZnNldCArIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ25hdi10YWJzJylbMF0uc2Nyb2xsSGVpZ2h0LFxuICAgICAgICAgICAgICAgIG1hc3Rlck1heEhlaWdodCA9IHZpZXdwb3J0LmhlaWdodCAtIG1hc3Rlck9mZnNldCxcbiAgICAgICAgICAgICAgICBkZXRhaWxNYXhIZWlnaHQgPSB2aWV3cG9ydC5oZWlnaHQgLSBkZXRhaWxPZmZzZXQ7XG5cbiAgICAgICAgICAgICRzY29wZS5tYXN0ZXJDb250YWluZXJTdHlsZSA9ICdoZWlnaHQ6ICcgKyBtYXN0ZXJNYXhIZWlnaHQgKyAncHg7IG1heC1oZWlnaHQ6ICcgKyBtYXN0ZXJNYXhIZWlnaHQgKyAncHg7IG92ZXJmbG93LXk6IGF1dG87JztcbiAgICAgICAgICAgICRzY29wZS5kZXRhaWxDb250YWluZXJTdHlsZSA9ICdoZWlnaHQ6ICcgKyBkZXRhaWxNYXhIZWlnaHQgKyAncHg7IG1heC1oZWlnaHQ6ICcgKyBkZXRhaWxNYXhIZWlnaHQgKyAncHg7IG92ZXJmbG93LXk6IGF1dG87JztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignam9ic0NvbnRyb2xsZXInLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkc2NvcGUsICRsb2NhdGlvbiwgJHVpYk1vZGFsLCBuYXZTZXJ2aWNlLCBqb2JTZXJ2aWNlLCBqb2JUeXBlU2VydmljZSwgam9iRXhlY3V0aW9uU2VydmljZSwgdWlHcmlkQ29uc3RhbnRzLCBzY2FsZUNvbmZpZywgc3VibmF2U2VydmljZSwgZ3JpZEZhY3RvcnksIGxvYWRTZXJ2aWNlLCBzY2FsZVNlcnZpY2UsIHVzZXJTZXJ2aWNlLCBtb21lbnQsIHRvYXN0cikge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi5qb2JzUGFyYW1zID0ge1xuICAgICAgICAgICAgcGFnZTogbnVsbCwgcGFnZV9zaXplOiBudWxsLCBzdGFydGVkOiBudWxsLCBlbmRlZDogbnVsbCwgb3JkZXI6ICRyb290U2NvcGUuam9ic0NvbnRyb2xsZXJPcmRlciB8fCAnLWxhc3RfbW9kaWZpZWQnLCBzdGF0dXM6IG51bGwsIGpvYl90eXBlX2lkOiBudWxsLCBqb2JfdHlwZV9uYW1lOiBudWxsLCBqb2JfdHlwZV9jYXRlZ29yeTogbnVsbCwgdXJsOiBudWxsXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gY2hlY2sgZm9yIGpvYnNQYXJhbXMgaW4gcXVlcnkgc3RyaW5nLCBhbmQgdXBkYXRlIGFzIG5lY2Vzc2FyeVxuICAgICAgICBfLmZvckVhY2goXy5wYWlycyhzZWxmLmpvYnNQYXJhbXMpLCBmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IF8uYXQoJGxvY2F0aW9uLnNlYXJjaCgpLCBwYXJhbVswXSk7XG4gICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHNlbGYuam9ic1BhcmFtc1twYXJhbVswXV0gPSB2YWx1ZS5sZW5ndGggPiAxID8gdmFsdWUgOiB2YWx1ZVswXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGdyaWRQYWdlTnVtYmVyID0gc2VsZi5qb2JzUGFyYW1zLnBhZ2UgfHwgMSxcbiAgICAgICAgICAgIGZpbHRlcmVkQnlKb2JUeXBlID0gc2VsZi5qb2JzUGFyYW1zLmpvYl90eXBlX2lkID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgZmlsdGVyZWRCeUpvYlN0YXR1cyA9IHNlbGYuam9ic1BhcmFtcy5zdGF0dXMgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICBmaWx0ZXJlZEJ5T3JkZXIgPSBzZWxmLmpvYnNQYXJhbXMub3JkZXIgPyB0cnVlIDogZmFsc2U7XG5cbiAgICAgICAgJHNjb3BlLmpvYnNEYXRhID0ge307XG4gICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgJHNjb3BlLmpvYlR5cGVWYWx1ZXMgPSBbXTtcbiAgICAgICAgJHNjb3BlLmpvYkV4ZWN1dGlvbiA9IG51bGw7XG4gICAgICAgICRzY29wZS5zZWxlY3RlZEpvYlR5cGUgPSBzZWxmLmpvYnNQYXJhbXMuam9iX3R5cGVfaWQgfHwgMDtcbiAgICAgICAgJHNjb3BlLmpvYlN0YXR1c1ZhbHVlcyA9IHNjYWxlQ29uZmlnLmpvYlN0YXR1cztcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkSm9iU3RhdHVzID0gc2VsZi5qb2JzUGFyYW1zLnN0YXR1cyB8fCAkc2NvcGUuam9iU3RhdHVzVmFsdWVzWzBdO1xuICAgICAgICAkc2NvcGUuc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5qb2JzO1xuICAgICAgICAkc2NvcGUuYWN0aW9uQ2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICAkc2NvcGUuZ3JpZFN0eWxlID0gJyc7XG4gICAgICAgICRzY29wZS5yZWFkb25seSA9IHRydWU7XG4gICAgICAgICRzY29wZS5sYXN0TW9kaWZpZWRTdGFydCA9IHNlbGYuam9ic1BhcmFtcy5zdGFydGVkID8gbW9tZW50LnV0YyhzZWxmLmpvYnNQYXJhbXMuc3RhcnRlZCkudG9EYXRlKCkgOiBtb21lbnQudXRjKCkuc3VidHJhY3QoMSwgJ3dlZWtzJykuc3RhcnRPZignZCcpLnRvRGF0ZSgpO1xuICAgICAgICAkc2NvcGUubGFzdE1vZGlmaWVkU3RhcnRQb3B1cCA9IHtcbiAgICAgICAgICAgIG9wZW5lZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLm9wZW5MYXN0TW9kaWZpZWRTdGFydFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgJHNjb3BlLmxhc3RNb2RpZmllZFN0YXJ0UG9wdXAub3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLmxhc3RNb2RpZmllZFN0b3AgPSBzZWxmLmpvYnNQYXJhbXMuZW5kZWQgPyBtb21lbnQudXRjKHNlbGYuam9ic1BhcmFtcy5lbmRlZCkudG9EYXRlKCkgOiBtb21lbnQudXRjKCkuZW5kT2YoJ2QnKS50b0RhdGUoKTtcbiAgICAgICAgJHNjb3BlLmxhc3RNb2RpZmllZFN0b3BQb3B1cCA9IHtcbiAgICAgICAgICAgIG9wZW5lZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLm9wZW5MYXN0TW9kaWZpZWRTdG9wUG9wdXAgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAkc2NvcGUubGFzdE1vZGlmaWVkU3RvcFBvcHVwLm9wZW5lZCA9IHRydWU7XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5kYXRlTW9kZWxPcHRpb25zID0ge1xuICAgICAgICAgICAgdGltZXpvbmU6ICcrMDAwJ1xuICAgICAgICB9O1xuXG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ2pvYnMnKTtcblxuICAgICAgICB2YXIgZGVmYXVsdENvbHVtbkRlZnMgPSBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmllbGQ6ICdqb2JfdHlwZScsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdKb2IgVHlwZScsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPjxzcGFuIG5nLWJpbmQtaHRtbD1cInJvdy5lbnRpdHkuam9iX3R5cGUuZ2V0SWNvbigpXCI+PC9zcGFuPiB7eyByb3cuZW50aXR5LmpvYl90eXBlLnRpdGxlIH19IHt7IHJvdy5lbnRpdHkuam9iX3R5cGUudmVyc2lvbiB9fTwvZGl2PicsXG4gICAgICAgICAgICAgICAgZmlsdGVySGVhZGVyVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1maWx0ZXItY29udGFpbmVyXCI+PHNlbGVjdCBjbGFzcz1cImZvcm0tY29udHJvbCBpbnB1dC1zbVwiIG5nLW1vZGVsPVwiZ3JpZC5hcHBTY29wZS5zZWxlY3RlZEpvYlR5cGVcIj48b3B0aW9uIG5nLWlmPVwiZ3JpZC5hcHBTY29wZS5qb2JUeXBlVmFsdWVzWyRpbmRleF1cIiBuZy1zZWxlY3RlZD1cInt7IGdyaWQuYXBwU2NvcGUuam9iVHlwZVZhbHVlc1skaW5kZXhdLmlkID09IGdyaWQuYXBwU2NvcGUuc2VsZWN0ZWRKb2JUeXBlIH19XCIgdmFsdWU9XCJ7eyBncmlkLmFwcFNjb3BlLmpvYlR5cGVWYWx1ZXNbJGluZGV4XS5pZCB9fVwiIG5nLXJlcGVhdD1cImpvYlR5cGUgaW4gZ3JpZC5hcHBTY29wZS5qb2JUeXBlVmFsdWVzIHRyYWNrIGJ5ICRpbmRleFwiPnt7IGdyaWQuYXBwU2NvcGUuam9iVHlwZVZhbHVlc1skaW5kZXhdLnRpdGxlIH19IHt7IGdyaWQuYXBwU2NvcGUuam9iVHlwZVZhbHVlc1skaW5kZXhdLnZlcnNpb24gfX08L29wdGlvbj48L3NlbGVjdD48L2Rpdj4nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAnY3JlYXRlZCcsXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6ICdDcmVhdGVkJyxcbiAgICAgICAgICAgICAgICBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmNyZWF0ZWRfZm9ybWF0dGVkIH19PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2xhc3RfbW9kaWZpZWQnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnTGFzdCBNb2RpZmllZCcsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjZWxsVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1jZWxsLWNvbnRlbnRzXCI+e3sgcm93LmVudGl0eS5sYXN0X21vZGlmaWVkX2Zvcm1hdHRlZCB9fTwvZGl2PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IGZpZWxkOiAnZHVyYXRpb24nLCBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlLCBlbmFibGVTb3J0aW5nOiBmYWxzZSwgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPnt7IHJvdy5lbnRpdHkuZ2V0RHVyYXRpb24oKSB9fTwvZGl2PicgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ3N0YXR1cycsXG4gICAgICAgICAgICAgICAgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50c1wiPnt7IHJvdy5lbnRpdHkuc3RhdHVzIH19IDxidXR0b24gbmctc2hvdz1cIigoIWdyaWQuYXBwU2NvcGUucmVhZG9ubHkpICYmIChyb3cuZW50aXR5LnN0YXR1cyA9PT0gXFwnRkFJTEVEXFwnIHx8IHJvdy5lbnRpdHkuc3RhdHVzID09PSBcXCdDQU5DRUxFRFxcJykpXCIgbmctY2xpY2s9XCJncmlkLmFwcFNjb3BlLnJlcXVldWVKb2JzKHsgam9iX2lkczogW3Jvdy5lbnRpdHkuaWRdIH0pXCIgY2xhc3M9XCJidG4gYnRuLXhzIGJ0bi1kZWZhdWx0XCIgdGl0bGU9XCJSZXF1ZXVlIEpvYlwiPjxpIGNsYXNzPVwiZmEgZmEtcmVwZWF0XCI+PC9pPjwvYnV0dG9uPiA8YnV0dG9uIG5nLXNob3c9XCIhZ3JpZC5hcHBTY29wZS5yZWFkb25seSAmJiByb3cuZW50aXR5LnN0YXR1cyAhPT0gXFwnQ09NUExFVEVEXFwnICYmIHJvdy5lbnRpdHkuc3RhdHVzICE9PSBcXCdDQU5DRUxFRFxcJ1wiIG5nLWNsaWNrPVwiZ3JpZC5hcHBTY29wZS5jYW5jZWxKb2Iocm93LmVudGl0eSlcIiBjbGFzcz1cImJ0biBidG4teHMgYnRuLWRlZmF1bHRcIiB0aXRsZT1cIkNhbmNlbCBKb2JcIj48aSBjbGFzcz1cImZhIGZhLWJhblwiPjwvaT48L2J1dHRvbj48L2Rpdj4nLFxuICAgICAgICAgICAgICAgIGZpbHRlckhlYWRlclRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtZmlsdGVyLWNvbnRhaW5lclwiPjxzZWxlY3QgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5wdXQtc21cIiBuZy1tb2RlbD1cImdyaWQuYXBwU2NvcGUuc2VsZWN0ZWRKb2JTdGF0dXNcIj48b3B0aW9uIG5nLXNlbGVjdGVkPVwie3sgZ3JpZC5hcHBTY29wZS5qb2JTdGF0dXNWYWx1ZXNbJGluZGV4XSA9PSBncmlkLmFwcFNjb3BlLnNlbGVjdGVkSm9iU3RhdHVzIH19XCIgdmFsdWU9XCJ7eyBncmlkLmFwcFNjb3BlLmpvYlN0YXR1c1ZhbHVlc1skaW5kZXhdIH19XCIgbmctcmVwZWF0PVwic3RhdHVzIGluIGdyaWQuYXBwU2NvcGUuam9iU3RhdHVzVmFsdWVzIHRyYWNrIGJ5ICRpbmRleFwiPnt7IHN0YXR1cy50b1VwcGVyQ2FzZSgpIH19PC9vcHRpb24+PC9zZWxlY3Q+PC9kaXY+J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2lkJyxcbiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogJ0xvZycsXG4gICAgICAgICAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzb3J0YWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgd2lkdGg6IDYwLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHMgdGV4dC1jZW50ZXJcIj48YnV0dG9uIG5nLWNsaWNrPVwiZ3JpZC5hcHBTY29wZS5zaG93TG9nKHJvdy5lbnRpdHkuaWQpXCIgY2xhc3M9XCJidG4gYnRuLXhzIGJ0bi1kZWZhdWx0XCI+PGkgY2xhc3M9XCJmYSBmYS1maWxlLXRleHRcIj48L2k+PC9idXR0b24+PC9kaXY+J1xuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuXG4gICAgICAgICRzY29wZS5ncmlkT3B0aW9ucyA9IGdyaWRGYWN0b3J5LmRlZmF1bHRHcmlkT3B0aW9ucygpO1xuICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMucGFnaW5hdGlvbkN1cnJlbnRQYWdlID0gcGFyc2VJbnQoc2VsZi5qb2JzUGFyYW1zLnBhZ2UgfHwgMSk7XG4gICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemUgPSBwYXJzZUludChzZWxmLmpvYnNQYXJhbXMucGFnZV9zaXplKSB8fCAkc2NvcGUuZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplO1xuICAgICAgICB2YXIgY29sRGVmcyA9ICRyb290U2NvcGUuY29sRGVmcyA/ICRyb290U2NvcGUuY29sRGVmcyA6IGRlZmF1bHRDb2x1bW5EZWZzO1xuICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuY29sdW1uRGVmcyA9IGdyaWRGYWN0b3J5LmFwcGx5U29ydENvbmZpZyhjb2xEZWZzLCBzZWxmLmpvYnNQYXJhbXMpO1xuICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSA9IFtdO1xuICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMub25SZWdpc3RlckFwaSA9IGZ1bmN0aW9uIChncmlkQXBpKSB7XG4gICAgICAgICAgICAgICAgLy9zZXQgZ3JpZEFwaSBvbiBzY29wZVxuICAgICAgICAgICAgICAgICRzY29wZS5ncmlkQXBpID0gZ3JpZEFwaTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5hY3Rpb25DbGlja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aW9uQ2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvam9icy9qb2IvJyArIHJvdy5lbnRpdHkuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICRzY29wZS5ncmlkQXBpLnBhZ2luYXRpb24ub24ucGFnaW5hdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoY3VycmVudFBhZ2UsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuam9ic1BhcmFtcy5wYWdlID0gY3VycmVudFBhZ2U7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuam9ic1BhcmFtcy5wYWdlX3NpemUgPSBwYWdlU2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2dyaWRBcGknKTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ3JpZEFwaS5jb3JlLm9uLnNvcnRDaGFuZ2VkKCRzY29wZSwgZnVuY3Rpb24gKGdyaWQsIHNvcnRDb2x1bW5zKSB7XG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuY29sRGVmcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaCgkc2NvcGUuZ3JpZEFwaS5ncmlkLmNvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbC5jb2xEZWYuc29ydCA9IGNvbC5zb3J0O1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5jb2xEZWZzID0gJHNjb3BlLmdyaWRBcGkuZ3JpZC5vcHRpb25zLmNvbHVtbkRlZnM7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzb3J0QXJyID0gW107XG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChzb3J0Q29sdW1ucywgZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc29ydEFyci5wdXNoKGNvbC5zb3J0LmRpcmVjdGlvbiA9PT0gJ2Rlc2MnID8gJy0nICsgY29sLmZpZWxkIDogY29sLmZpZWxkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlSm9iT3JkZXIoc29ydEFycik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgJHNjb3BlLnNob3dTdGF0dXMgPSBmdW5jdGlvbiAoc3RhdHVzKSB7XG4gICAgICAgICAgICByZXR1cm4gXy5pbmNsdWRlcygkc2NvcGUuam9iU3RhdHVzVmFsdWVzLCBzdGF0dXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYudXBkYXRlSm9iVHlwZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlICE9IHNlbGYuam9ic1BhcmFtcy5qb2JfdHlwZV9pZCkge1xuICAgICAgICAgICAgICAgIHNlbGYuam9ic1BhcmFtcy5wYWdlID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbGYuam9ic1BhcmFtcy5qb2JfdHlwZV9pZCA9IHZhbHVlID09IDAgPyBudWxsIDogdmFsdWU7XG4gICAgICAgICAgICBzZWxmLmpvYnNQYXJhbXMucGFnZV9zaXplID0gJHNjb3BlLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzZWxlY3RlZEpvYlR5cGUnKTtcbiAgICAgICAgICAgIGlmICghJHNjb3BlLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3NlbGVjdGVkSm9iVHlwZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCRzY29wZS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkQnlKb2JUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlSm9iVHlwZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJlZEJ5Sm9iVHlwZSA9IHZhbHVlICE9IDA7XG4gICAgICAgICAgICAgICAgc2VsZi51cGRhdGVKb2JUeXBlKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgc2VsZi51cGRhdGVKb2JTdGF0dXMgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPSBzZWxmLmpvYnNQYXJhbXMuc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5qb2JzUGFyYW1zLnBhZ2UgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2VsZi5qb2JzUGFyYW1zLnN0YXR1cyA9IHZhbHVlID09PSAnVklFVyBBTEwnID8gbnVsbCA6IHZhbHVlO1xuICAgICAgICAgICAgc2VsZi5qb2JzUGFyYW1zLnBhZ2Vfc2l6ZSA9ICRzY29wZS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2VsZWN0ZWRKb2JTdGF0dXMnKTtcbiAgICAgICAgICAgIGlmICghJHNjb3BlLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3NlbGVjdGVkSm9iU3RhdHVzJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWRCeUpvYlN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZUpvYlN0YXR1cyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJlZEJ5Sm9iU3RhdHVzID0gdmFsdWUgIT09ICdWSUVXIEFMTCc7XG4gICAgICAgICAgICAgICAgc2VsZi51cGRhdGVKb2JTdGF0dXModmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBzZWxmLnVwZGF0ZUpvYk9yZGVyID0gZnVuY3Rpb24gKHNvcnRBcnIpIHtcbiAgICAgICAgICAgIHNlbGYuam9ic1BhcmFtcy5vcmRlciA9IHNvcnRBcnIubGVuZ3RoID4gMCA/IHNvcnRBcnIgOiBudWxsO1xuICAgICAgICAgICAgZmlsdGVyZWRCeU9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwO1xuICAgICAgICAgICAgJHNjb3BlLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdsYXN0TW9kaWZpZWRTdGFydCcsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKCEkc2NvcGUubG9hZGluZykge1xuICAgICAgICAgICAgICAgIHNlbGYuam9ic1BhcmFtcy5zdGFydGVkID0gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdsYXN0TW9kaWZpZWRTdG9wJywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoISRzY29wZS5sb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5qb2JzUGFyYW1zLmVuZGVkID0gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvKiRzY29wZS4kd2F0Y2goJ2dyaWRBcGknLCBmdW5jdGlvbiAoZ3JpZEFwaSkge1xuICAgICAgICAgICAgaWYgKGZpbHRlcmVkQnlPcmRlcikge1xuICAgICAgICAgICAgICAgIGdyaWRBcGkuY29yZS5yYWlzZS5zb3J0Q2hhbmdlZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTsqL1xuXG4gICAgICAgICRzY29wZS5zaG93TG9nID0gZnVuY3Rpb24gKGpvYklkKSB7XG4gICAgICAgICAgICAvLyBzaG93IGxvZyBtb2RhbFxuICAgICAgICAgICAgJHNjb3BlLmFjdGlvbkNsaWNrZWQgPSB0cnVlO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3Nob3cgbG9nIG1vZGFsJyk7XG4gICAgICAgICAgICBqb2JTZXJ2aWNlLmdldEpvYkRldGFpbChqb2JJZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEpvYiA9IGRhdGEuam9iX3R5cGUudGl0bGUgKyAnICcgKyBkYXRhLmpvYl90eXBlLnZlcnNpb247XG4gICAgICAgICAgICAgICAgJHNjb3BlLmpvYkV4ZWN1dGlvbiA9IGRhdGEuZ2V0TGF0ZXN0RXhlY3V0aW9uKCk7XG4gICAgICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdzaG93TG9nLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiAnbGcnLFxuICAgICAgICAgICAgICAgICAgICB3aW5kb3dDbGFzczogJ2xvZy1tb2RhbC13aW5kb3cnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuZmlsdGVyUmVzdWx0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF8uZm9yRWFjaChfLnBhaXJzKHNlbGYuam9ic1BhcmFtcyksIGZ1bmN0aW9uIChwYXJhbSkge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2gocGFyYW1bMF0sIHBhcmFtWzFdKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgc2VsZi5nZXRKb2JzKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnJlcXVldWVKb2JzID0gZnVuY3Rpb24gKGpvYnNQYXJhbXMpIHtcbiAgICAgICAgICAgIGpvYnNQYXJhbXMgPSBqb2JzUGFyYW1zIHx8IHsgc3RhcnRlZDogJHNjb3BlLmxhc3RNb2RpZmllZFN0YXJ0LnRvSVNPU3RyaW5nKCksIGVuZGVkOiAkc2NvcGUubGFzdE1vZGlmaWVkU3RvcC50b0lTT1N0cmluZygpfTtcbiAgICAgICAgICAgICRzY29wZS5hY3Rpb25DbGlja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGxvYWRTZXJ2aWNlLnJlcXVldWVKb2JzKGpvYnNQYXJhbXMpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnc3VjY2VzcyddKCdSZXF1ZXVlIFN1Y2Nlc3NmdWwnKTtcbiAgICAgICAgICAgICAgICBzZWxmLmdldEpvYnMoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXSgnUmVxdWV1ZSByZXF1ZXN0IGZhaWxlZCcpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLmNhbmNlbEpvYiA9IGZ1bmN0aW9uIChqb2IpIHtcbiAgICAgICAgICAgICRzY29wZS5hY3Rpb25DbGlja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBvcmlnaW5hbFN0YXR1cyA9IGpvYi5zdGF0dXM7XG4gICAgICAgICAgICBqb2Iuc3RhdHVzID0gJ0NBTkNFTCc7XG4gICAgICAgICAgICBqb2JTZXJ2aWNlLnVwZGF0ZUpvYihqb2IuaWQsIHsgc3RhdHVzOiAnQ0FOQ0VMRUQnIH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB0b2FzdHJbJ3N1Y2Nlc3MnXSgnSm9iIENhbmNlbGVkJyk7XG4gICAgICAgICAgICAgICAgam9iLnN0YXR1cyA9ICdDQU5DRUxFRCc7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICBqb2Iuc3RhdHVzID0gb3JpZ2luYWxTdGF0dXM7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5nZXRKb2JzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgam9iU2VydmljZS5nZXRKb2JzT25jZShzZWxmLmpvYnNQYXJhbXMpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuam9ic0RhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLnRvdGFsSXRlbXMgPSBkYXRhLmNvdW50O1xuICAgICAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5kYXRhID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuZ2V0Sm9iVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBqb2JUeXBlU2VydmljZS5nZXRKb2JUeXBlc09uY2UoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmpvYlR5cGVWYWx1ZXMgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmpvYlR5cGVWYWx1ZXMudW5zaGlmdCh7IG5hbWU6ICdWSUVXIEFMTCcsIHRpdGxlOiAnVklFVyBBTEwnLCB2ZXJzaW9uOiAnJywgaWQ6IDAgfSk7XG4gICAgICAgICAgICAgICAgLyppZiAoIWZpbHRlcmVkQnlKb2JUeXBlICYmICFmaWx0ZXJlZEJ5Sm9iU3RhdHVzICYmICFmaWx0ZXJlZEJ5T3JkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5nZXRKb2JzKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlcmVkQnlPcmRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi51cGRhdGVKb2JPcmRlcihzZWxmLmpvYnNQYXJhbXMub3JkZXIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSovXG4gICAgICAgICAgICAgICAgc2VsZi5nZXRKb2JzKHNlbGYuam9ic1BhcmFtcyk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgJHJvb3RTY29wZS5jb2xEZWZzID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIC8vIHJvb3QgY29sdW1uIGRlZnMgaGF2ZSBub3QgYmVlbiBhbHRlcmVkIGJ5IHVzZXIsIHNvIHNldCB1cCBkZWZhdWx0c1xuICAgICAgICAgICAgICAgIGlmICghc2VsZi5qb2JzUGFyYW1zLm9yZGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuam9ic1BhcmFtcy5vcmRlciA9ICctbGFzdF9tb2RpZmllZCc7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2goJ29yZGVyJywgc2VsZi5qb2JzUGFyYW1zLm9yZGVyKS5yZXBsYWNlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghc2VsZi5qb2JzUGFyYW1zLnBhZ2Vfc2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmpvYnNQYXJhbXMucGFnZV9zaXplID0gJHNjb3BlLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaCgncGFnZV9zaXplJywgc2VsZi5qb2JzUGFyYW1zLnBhZ2Vfc2l6ZSkucmVwbGFjZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXNlbGYuam9ic1BhcmFtcy5zdGFydGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuam9ic1BhcmFtcy5zdGFydGVkID0gbW9tZW50LnV0Yygkc2NvcGUubGFzdE1vZGlmaWVkU3RhcnQpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2goJ3N0YXJ0ZWQnLCBzZWxmLmpvYnNQYXJhbXMuc3RhcnRlZCkucmVwbGFjZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXNlbGYuam9ic1BhcmFtcy5lbmRlZCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmpvYnNQYXJhbXMuZW5kZWQgPSBtb21lbnQudXRjKCRzY29wZS5sYXN0TW9kaWZpZWRTdG9wKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKCdlbmRlZCcsIHNlbGYuam9ic1BhcmFtcy5lbmRlZCkucmVwbGFjZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbGYuZ2V0Sm9iVHlwZXMoKTtcbiAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJDcmVkcygpO1xuXG4gICAgICAgICAgICBpZiAoJHJvb3RTY29wZS51c2VyKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlYWRvbmx5ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdqb2JzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5pbml0aWFsaXplKCk7XG5cbiAgICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBzZXQgY29udGFpbmVyIGhlaWdodHMgZXF1YWwgdG8gYXZhaWxhYmxlIHBhZ2UgaGVpZ2h0XG4gICAgICAgICAgICB2YXIgdmlld3BvcnQgPSBzY2FsZVNlcnZpY2UuZ2V0Vmlld3BvcnRTaXplKCksXG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gc2NhbGVDb25maWcuaGVhZGVyT2Zmc2V0ICsgc2NhbGVDb25maWcuZGF0ZUZpbHRlck9mZnNldCxcbiAgICAgICAgICAgICAgICBncmlkTWF4SGVpZ2h0ID0gdmlld3BvcnQuaGVpZ2h0IC0gb2Zmc2V0O1xuXG4gICAgICAgICAgICAkc2NvcGUuZ3JpZFN0eWxlID0gJ2hlaWdodDogJyArIGdyaWRNYXhIZWlnaHQgKyAncHg7IG1heC1oZWlnaHQ6ICcgKyBncmlkTWF4SGVpZ2h0ICsgJ3B4OyBvdmVyZmxvdy15OiBhdXRvOyc7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpe1xuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYkV4ZWN1dGlvbkxvZ0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgJGVsZW1lbnQsICR0aW1lb3V0LCBqb2JFeGVjdXRpb25TZXJ2aWNlLCBzY2FsZUNvbmZpZykge1xuICAgICAgICAndXNlIHN0cmljdCc7XG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgJHNjb3BlLmZvcmNlU2Nyb2xsID0gdHJ1ZTtcblxuICAgICAgICAgICAgJHNjb3BlLmpvYkxvZ0Vycm9yID0gbnVsbDtcblxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnZXhlY3V0aW9uJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZXhlY3V0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGpvYkV4ZWN1dGlvblNlcnZpY2UuZ2V0TG9nKCRzY29wZS5leGVjdXRpb24uaWQpLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24ocmVzdWx0KXtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGdldCBkaWZmZXJlbmNlIG9mIG1heCBzY3JvbGwgbGVuZ3RoIGFuZCBjdXJyZW50IHNjcm9sbCBsZW5ndGguXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbG9nUmVzdWx0ID0gcmVzdWx0LmV4ZWN1dGlvbl9sb2c7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQuJHJlc29sdmVkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGl2ID0gJCgkZWxlbWVudFswXSkuZmluZCgnLmJhc2gnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2Nyb2xsRGlmZiA9IChkaXYuc2Nyb2xsVG9wKCkgKyBkaXYucHJvcCgnb2Zmc2V0SGVpZ2h0JykpIC0gZGl2LnByb3AoJ3Njcm9sbEhlaWdodCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRzY29wZS5zY3JvbGxEaWZmID49IDApeyAkc2NvcGUuZm9yY2VTY3JvbGwgPSB0cnVlOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV4ZWNMb2cgPSBsb2dSZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzVGV4dCAmJiByZXN1bHQuc3RhdHVzVGV4dCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmpvYkxvZ0Vycm9yU3RhdHVzID0gcmVzdWx0LnN0YXR1c1RleHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5qb2JMb2dFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgam9iIGxvZ3MuJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCdleGVjTG9nJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZXhlY0xvZykge1xuICAgICAgICAgICAgICAgICAgICBpZigkc2NvcGUuZm9yY2VTY3JvbGwgfHwgJHNjb3BlLnNjcm9sbERpZmYgPj0gMCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5mb3JjZVNjcm9sbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzY3JsSGVpZ2h0ID0gJCgkZWxlbWVudFswXSkuZmluZCgnLmJhc2gnKS5wcm9wKFwic2Nyb2xsSGVpZ2h0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJGVsZW1lbnRbMF0pLmZpbmQoJy5iYXNoJykuc2Nyb2xsVG9wKHNjcmxIZWlnaHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgNTApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnNjcm9sbGl0ZW0gPSBmdW5jdGlvbihpdGVtKXtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhpdGVtKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuc3Rkb3V0Q2hhbmdlZCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3Rkb3V0IGNoYW5nZWQuJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgfSkuZGlyZWN0aXZlKCdqb2JFeGVjdXRpb25Mb2cnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250cm9sbGVyOiAnam9iRXhlY3V0aW9uTG9nQ29udHJvbGxlcicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvam9icy9kaXJlY3RpdmVzL2pvYkV4ZWN1dGlvbkxvZ1RlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgZXhlY3V0aW9uOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2Fpc0pvYkhlYWx0aENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHNjb3BlLCBqb2JUeXBlU2VydmljZSkge1xuICAgICAgICAkc2NvcGUubG9hZGluZ0pvYkhlYWx0aCA9IHRydWU7XG4gICAgICAgICRzY29wZS5qb2JIZWFsdGhFcnJvciA9IG51bGw7XG4gICAgICAgICRzY29wZS5qb2JIZWFsdGhFcnJvclN0YXR1cyA9IG51bGw7XG4gICAgICAgICRzY29wZS5qb2JIZWFsdGggPSB7fTtcblxuICAgICAgICB2YXIgZ2V0Sm9iVHlwZVN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpvYlR5cGVTZXJ2aWNlLmdldEpvYlR5cGVTdGF0dXMobnVsbCwgbnVsbCwgJHNjb3BlLmR1cmF0aW9uLCBudWxsKS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5qb2JIZWFsdGhFcnJvciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5qb2JUeXBlU3RhdHVzID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUudG90YWwgPSAwO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZmFpbGVkID0gMDtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcGVyZm9ybWFuY2UgPSB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmVzID0gW107XG5cbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGRhdGEucmVzdWx0cywgZnVuY3Rpb24gKHN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGVyZm9ybWFuY2UgPSBzdGF0dXMuZ2V0UGVyZm9ybWFuY2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50b3RhbCA9ICRzY29wZS50b3RhbCArIHBlcmZvcm1hbmNlLnRvdGFsO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmZhaWxlZCA9ICRzY29wZS5mYWlsZWQgKyBwZXJmb3JtYW5jZS5mYWlsZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBmYWlsdXJlcy5wdXNoKHN0YXR1cy5nZXRGYWlsdXJlcygpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmVEYXRhID0gW10sXG4gICAgICAgICAgICAgICAgICAgICAgICBzeXN0ZW1GYWlsdXJlcyA9IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhRmFpbHVyZXMgPSAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWxnb3JpdGhtRmFpbHVyZXMgPSAwO1xuXG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChmYWlsdXJlcywgZnVuY3Rpb24gKGYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChmLCBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlLnN0YXR1cyA9PT0gJ1NZU1RFTScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3lzdGVtRmFpbHVyZXMgPSBzeXN0ZW1GYWlsdXJlcyArIHR5cGUuY291bnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlLnN0YXR1cyA9PT0gJ0RBVEEnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFGYWlsdXJlcyA9IGRhdGFGYWlsdXJlcyArIHR5cGUuY291bnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlLnN0YXR1cyA9PT0gJ0FMR09SSVRITScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxnb3JpdGhtRmFpbHVyZXMgPSBhbGdvcml0aG1GYWlsdXJlcyArIHR5cGUuY291bnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzeXN0ZW1GYWlsdXJlcyA+IDAgfHwgZGF0YUZhaWx1cmVzID4gMCB8fCBhbGdvcml0aG1GYWlsdXJlcyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzeXN0ZW1GYWlsdXJlcyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWlsdXJlRGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnU1lTVEVNJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IHN5c3RlbUZhaWx1cmVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YUZhaWx1cmVzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmVEYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdEQVRBJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IGRhdGFGYWlsdXJlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFsZ29yaXRobUZhaWx1cmVzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWx1cmVEYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdBTEdPUklUSE0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogYWxnb3JpdGhtRmFpbHVyZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5qb2JIZWFsdGggPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYXVnZURhdGE6ICRzY29wZS50b3RhbCA9PT0gMCA/IDAgOiAxMDAgLSAoKCRzY29wZS5mYWlsZWQgLyAkc2NvcGUudG90YWwpICogMTAwKS50b0ZpeGVkKDIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZG9udXREYXRhOiBmYWlsdXJlRGF0YVxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuYnJvYWRjYXN0RGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdqb2JUeXBlU3RhdHVzJywgJHNjb3BlLmpvYlR5cGVTdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzVGV4dCAmJiBkYXRhLnN0YXR1c1RleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuam9iSGVhbHRoRXJyb3JTdGF0dXMgPSBkYXRhLnN0YXR1c1RleHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmpvYkhlYWx0aEVycm9yID0gJ1VuYWJsZSB0byByZXRyaWV2ZSBqb2Igc3RhdGlzdGljcy4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZ0pvYkhlYWx0aCA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgZ2V0Sm9iVHlwZVN0YXR1cygpO1xuICAgIH0pLmRpcmVjdGl2ZSgnYWlzSm9iSGVhbHRoJywgZnVuY3Rpb24oKXtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVzYWdlOiA8YWlzLWpvYi1oZWFsdGggLz5cbiAgICAgICAgICoqL1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fpc0pvYkhlYWx0aENvbnRyb2xsZXInLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdtb2R1bGVzL2pvYnMvZGlyZWN0aXZlcy9qb2JIZWFsdGhUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAnPScsXG4gICAgICAgICAgICAgICAgYnJvYWRjYXN0RGF0YTogJz0nLCAvLyBzZXQgdG8gdHJ1ZSB3aGVuIHVzaW5nIGFub3RoZXIgd2lkZ2V0IGluIHRoZSBzYW1lIHZpZXcgdGhhdCBhbHNvIGNhbGxzIGdldEpvYlR5cGVTdGF0dXNcbiAgICAgICAgICAgICAgICBzaG93RGVzY3JpcHRpb246ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ2pvYlR5cGVJbnRlcmZhY2VEaXJlY3RpdmVDb250cm9sbGVyJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzY29wZSwgam9iVHlwZVNlcnZpY2UpIHtcblxuICAgIH0pLmRpcmVjdGl2ZSgnYWlzSm9iVHlwZUludGVyZmFjZScsIGZ1bmN0aW9uKCl7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2FnZTogPGFpcy1qb2ItaGVhbHRoIC8+XG4gICAgICAgICAqKi9cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdqb2JUeXBlSW50ZXJmYWNlRGlyZWN0aXZlQ29udHJvbGxlcicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvam9icy9kaXJlY3RpdmVzL2pvYlR5cGVJbnRlcmZhY2VUZW1wbGF0ZS5odG1sJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGpvYlR5cGVJbnRlcmZhY2U6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2JUeXBlLCBzY2FsZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIEpvYiA9IGZ1bmN0aW9uIChpZCwgam9iX3R5cGUsIGV2ZW50LCBlcnJvciwgc3RhdHVzLCBwcmlvcml0eSwgbnVtX2V4ZXMsIHRpbWVvdXQsIG1heF90cmllcywgY3B1c19yZXF1aXJlZCwgbWVtX3JlcXVpcmVkLCBkaXNrX2luX3JlcXVpcmVkLCBkaXNrX291dF9yZXF1aXJlZCwgY3JlYXRlZCwgcXVldWVkLCBzdGFydGVkLCBlbmRlZCwgbGFzdF9zdGF0dXNfY2hhbmdlLCBsYXN0X21vZGlmaWVkKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlID0gSm9iVHlwZS50cmFuc2Zvcm1lcihqb2JfdHlwZSk7XG4gICAgICAgICAgICB0aGlzLmV2ZW50ID0gZXZlbnQ7XG4gICAgICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG4gICAgICAgICAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcbiAgICAgICAgICAgIHRoaXMucHJpb3JpdHkgPSBwcmlvcml0eTtcbiAgICAgICAgICAgIHRoaXMubnVtX2V4ZXMgPSBudW1fZXhlcztcbiAgICAgICAgICAgIHRoaXMudGltZW91dCA9IHRpbWVvdXQ7XG4gICAgICAgICAgICB0aGlzLm1heF90cmllcyA9IG1heF90cmllcztcbiAgICAgICAgICAgIHRoaXMuY3B1c19yZXF1aXJlZCA9IGNwdXNfcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLm1lbV9yZXF1aXJlZCA9IG1lbV9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMuZGlza19pbl9yZXF1aXJlZCA9IGRpc2tfaW5fcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmRpc2tfb3V0X3JlcXVpcmVkID0gZGlza19vdXRfcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkX2Zvcm1hdHRlZCA9IG1vbWVudC51dGMoY3JlYXRlZCkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgIHRoaXMucXVldWVkID0gcXVldWVkO1xuICAgICAgICAgICAgdGhpcy5zdGFydGVkID0gc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMuZW5kZWQgPSBlbmRlZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9zdGF0dXNfY2hhbmdlID0gbGFzdF9zdGF0dXNfY2hhbmdlO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKGxhc3RfbW9kaWZpZWQpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBlbmQgPSB0aGlzLmVuZGVkID8gdGhpcy5lbmRlZCA6IG1vbWVudC51dGMoKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRHVyYXRpb24oc3RhcnQsIGVuZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl90eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmV2ZW50LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmVycm9yLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wcmlvcml0eSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5udW1fZXhlcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1heF90cmllcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcHVzX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lbV9yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrX2luX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfb3V0X3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucXVldWVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9zdGF0dXNfY2hhbmdlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2IoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2IudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYi5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iRGV0YWlsRXZlbnQnLCBmdW5jdGlvbiAoSm9iRGV0YWlsRXZlbnRSdWxlKSB7XG4gICAgICAgIHZhciBKb2JEZXRhaWxFdmVudCA9IGZ1bmN0aW9uIChpZCwgdHlwZSwgcnVsZSwgb2NjdXJyZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgICAgICB0aGlzLnJ1bGUgPSBKb2JEZXRhaWxFdmVudFJ1bGUudHJhbnNmb3JtZXIocnVsZSk7XG4gICAgICAgICAgICB0aGlzLm9jY3VycmVkID0gb2NjdXJyZWQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iRGV0YWlsRXZlbnQucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYkRldGFpbEV2ZW50LmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JEZXRhaWxFdmVudChcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJ1bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEub2NjdXJyZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JEZXRhaWxFdmVudCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYkRldGFpbEV2ZW50LnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYkRldGFpbEV2ZW50LmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYkRldGFpbEV2ZW50LmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JEZXRhaWxFdmVudDtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYkRldGFpbEV2ZW50UnVsZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIEpvYkRldGFpbEV2ZW50UnVsZSA9IGZ1bmN0aW9uIChpZCwgdHlwZSwgaXNfYWN0aXZlLCBjcmVhdGVkLCBhcmNoaXZlZCwgbGFzdF9tb2RpZmllZCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgICAgIHRoaXMuaXNfYWN0aXZlID0gaXNfYWN0aXZlO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuYXJjaGl2ZWQgPSBhcmNoaXZlZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iRGV0YWlsRXZlbnRSdWxlLnByb3RvdHlwZSA9IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JEZXRhaWxFdmVudFJ1bGUuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYkRldGFpbEV2ZW50UnVsZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmFyY2hpdmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JEZXRhaWxFdmVudFJ1bGUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2JEZXRhaWxFdmVudFJ1bGUudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iRGV0YWlsRXZlbnRSdWxlLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYkRldGFpbEV2ZW50UnVsZS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iRGV0YWlsRXZlbnRSdWxlO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iRGV0YWlsSW5wdXREYXRhJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgSm9iRGV0YWlsSW5wdXREYXRhID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlLCBmaWxlX2lkLCBmaWxlX2lkcywgZmlsZXMpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLmZpbGVfaWQgPSBmaWxlX2lkO1xuICAgICAgICAgICAgdGhpcy5maWxlX2lkcyA9IGZpbGVfaWRzO1xuICAgICAgICAgICAgdGhpcy5maWxlcyA9IGZpbGVzO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYkRldGFpbElucHV0RGF0YS5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5maWxlX2lkKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxlX2lkO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZpbGVfaWRzKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxlX2lkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iRGV0YWlsSW5wdXREYXRhLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JEZXRhaWxJbnB1dERhdGEoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5maWxlX2lkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZpbGVfaWRzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZpbGVzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRGV0YWlsSW5wdXREYXRhKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iRGV0YWlsSW5wdXREYXRhLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYkRldGFpbElucHV0RGF0YS5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JEZXRhaWxJbnB1dERhdGEuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYkRldGFpbElucHV0RGF0YTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYkRldGFpbE91dHB1dERhdGEnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBKb2JEZXRhaWxPdXRwdXREYXRhID0gZnVuY3Rpb24gKG5hbWUsIHdvcmtzcGFjZV9pZCwgZmlsZXMpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICB0aGlzLndvcmtzcGFjZV9pZCA9IHdvcmtzcGFjZV9pZDtcbiAgICAgICAgICAgIHRoaXMuZmlsZXMgPSBmaWxlcztcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JEZXRhaWxPdXRwdXREYXRhLnByb3RvdHlwZSA9IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JEZXRhaWxPdXRwdXREYXRhLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JEZXRhaWxPdXRwdXREYXRhKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEud29ya3NwYWNlX2lkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZpbGVzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRGV0YWlsT3V0cHV0RGF0YSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYkRldGFpbE91dHB1dERhdGEudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iRGV0YWlsT3V0cHV0RGF0YS5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JEZXRhaWxPdXRwdXREYXRhLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JEZXRhaWxPdXRwdXREYXRhO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iRGV0YWlscycsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgSm9iVHlwZSwgSm9iRXhlY3V0aW9uLCBQcm9kdWN0LCBKb2JEZXRhaWxJbnB1dERhdGEsIEpvYkRldGFpbE91dHB1dERhdGEsIFJlY2lwZSwgSm9iRGV0YWlsRXZlbnQsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgSm9iRGV0YWlscyA9IGZ1bmN0aW9uIChpZCwgam9iX3R5cGUsIGpvYl90eXBlX3JldiwgZXZlbnQsIGVycm9yLCBzdGF0dXMsIHByaW9yaXR5LCBudW1fZXhlcywgdGltZW91dCwgbWF4X3RyaWVzLCBjcHVzX3JlcXVpcmVkLCBtZW1fcmVxdWlyZWQsIGRpc2tfaW5fcmVxdWlyZWQsIGRpc2tfb3V0X3JlcXVpcmVkLCBjcmVhdGVkLCBxdWV1ZWQsIHN0YXJ0ZWQsIGVuZGVkLCBsYXN0X3N0YXR1c19jaGFuZ2UsIGxhc3RfbW9kaWZpZWQsIGRhdGEsIHJlc3VsdHMsIHJlY2lwZXMsIGpvYl9leGVzLCBpbnB1dHMsIG91dHB1dHMpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGUgPSBKb2JUeXBlLnRyYW5zZm9ybWVyKGpvYl90eXBlKTtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGVfcmV2ID0gam9iX3R5cGVfcmV2O1xuICAgICAgICAgICAgdGhpcy5ldmVudCA9IEpvYkRldGFpbEV2ZW50LnRyYW5zZm9ybWVyKGV2ZW50KTtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IgPSBlcnJvcjtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5wcmlvcml0eSA9IHByaW9yaXR5O1xuICAgICAgICAgICAgdGhpcy5udW1fZXhlcyA9IG51bV9leGVzO1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDtcbiAgICAgICAgICAgIHRoaXMubWF4X3RyaWVzID0gbWF4X3RyaWVzO1xuICAgICAgICAgICAgdGhpcy5jcHVzX3JlcXVpcmVkID0gY3B1c19yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMubWVtX3JlcXVpcmVkID0gbWVtX3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX2luX3JlcXVpcmVkID0gZGlza19pbl9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMuZGlza19vdXRfcmVxdWlyZWQgPSBkaXNrX291dF9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhjcmVhdGVkKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgdGhpcy5xdWV1ZWQgPSBxdWV1ZWQ7XG4gICAgICAgICAgICB0aGlzLnF1ZXVlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKHF1ZXVlZCkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRlZCA9IHN0YXJ0ZWQ7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0ZWRfZm9ybWF0dGVkID0gbW9tZW50LnV0YyhzdGFydGVkKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgdGhpcy5lbmRlZCA9IGVuZGVkO1xuICAgICAgICAgICAgdGhpcy5lbmRlZF9mb3JtYXR0ZWQgPSBtb21lbnQudXRjKGVuZGVkKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgdGhpcy5sYXN0X3N0YXR1c19jaGFuZ2UgPSBsYXN0X3N0YXR1c19jaGFuZ2U7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5kYXRhID0ge1xuICAgICAgICAgICAgICAgIGlucHV0X2RhdGE6IEpvYkRldGFpbElucHV0RGF0YS50cmFuc2Zvcm1lcihkYXRhLmlucHV0X2RhdGEpLFxuICAgICAgICAgICAgICAgIHZlcnNpb246IGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICBvdXRwdXRfZGF0YTogSm9iRGV0YWlsT3V0cHV0RGF0YS50cmFuc2Zvcm1lcihkYXRhLm91dHB1dF9kYXRhKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMucmVzdWx0cyA9IHtcbiAgICAgICAgICAgICAgICBvdXRwdXRfZGF0YTogSm9iRGV0YWlsT3V0cHV0RGF0YS50cmFuc2Zvcm1lcihyZXN1bHRzLm91dHB1dF9kYXRhKSxcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiByZXN1bHRzLnZlcnNpb25cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLnJlY2lwZXMgPSBSZWNpcGUudHJhbnNmb3JtZXIocmVjaXBlcyk7XG4gICAgICAgICAgICB0aGlzLmpvYl9leGVzID0gSm9iRXhlY3V0aW9uLnRyYW5zZm9ybWVyKGpvYl9leGVzKTtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRzID0gaW5wdXRzO1xuICAgICAgICAgICAgdGhpcy5vdXRwdXRzID0gb3V0cHV0cztcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JEZXRhaWxzLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbih0aGlzLmNyZWF0ZWQsIHRoaXMubGFzdF9tb2RpZmllZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0TGF0ZXN0RXhlY3V0aW9uOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm51bV9leGVzID4gMCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuam9iX2V4ZXNbMF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFN0YXR1c0NsYXNzOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIC8vIGlmKHRoaXMuc3RhdHVzID09PSAnQ09NUExFVEVEJyl7XG4gICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiAnbGFiZWwtc3VjY2Vzcyc7XG4gICAgICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgICAgIC8vIGVsc2UgaWYoIHRoaXMuc3RhdHVzID09PSAnRkFJTEVEJyl7XG4gICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiAnbGFiZWwtZGVmYXVsdCc7Ly8gICAgcmV0dXJuICdsYWJlbC1kYW5nZXInO1xuICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgICAgICAvLyBlbHNle1xuICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gJ2xhYmVsLWRlZmF1bHQnO1xuICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0dXMudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iRGV0YWlscy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRGV0YWlscyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZV9yZXYsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXJyb3IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm51bV9leGVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWF4X3RyaWVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNwdXNfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVtX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfaW5fcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGlza19vdXRfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5xdWV1ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lbmRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X3N0YXR1c19jaGFuZ2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kYXRhLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVjaXBlcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfZXhlcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pbnB1dHMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEub3V0cHV0c1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYkRldGFpbHMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2JEZXRhaWxzLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYkRldGFpbHMuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iRGV0YWlscy5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iRGV0YWlscztcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYkV4ZWN1dGlvbicsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgSm9iLCBOb2RlLCBtb21lbnQpIHtcbiAgICAgICAgdmFyIEpvYkV4ZWN1dGlvbiA9IGZ1bmN0aW9uIChpZCwgc3RhdHVzLCBjb21tYW5kX2FyZ3VtZW50cywgdGltZW91dCwgcHJlX3N0YXJ0ZWQsIHByZV9jb21wbGV0ZWQsIHByZV9leGl0X2NvZGUsIGpvYl9zdGFydGVkLCBqb2JfY29tcGxldGVkLCBqb2JfZXhpdF9jb2RlLCBwb3N0X3N0YXJ0ZWQsIHBvc3RfY29tcGxldGVkLCBwb3N0X2V4aXRfY29kZSwgY3JlYXRlZCwgcXVldWVkLCBzdGFydGVkLCBlbmRlZCwgbGFzdF9tb2RpZmllZCwgam9iLCBub2RlLCBlcnJvciwgZW52aXJvbm1lbnQsIGNwdXNfc2NoZWR1bGVkLCBtZW1fc2NoZWR1bGVkLCBkaXNrX2luX3NjaGVkdWxlZCwgZGlza19vdXRfc2NoZWR1bGVkLCBkaXNrX3RvdGFsX3NjaGVkdWxlZCwgcmVzdWx0cywgY3VycmVudF9zdGRvdXRfdXJsLCBjdXJyZW50X3N0ZGVycl91cmwsIHJlc3VsdHNfbWFuaWZlc3QpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5jb21tYW5kX2FyZ3VtZW50cyA9IGNvbW1hbmRfYXJndW1lbnRzO1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDtcbiAgICAgICAgICAgIHRoaXMucHJlX3N0YXJ0ZWQgPSBwcmVfc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMucHJlX2NvbXBsZXRlZCA9IHByZV9jb21wbGV0ZWQ7XG4gICAgICAgICAgICB0aGlzLnByZV9leGl0X2NvZGUgPSBwcmVfZXhpdF9jb2RlO1xuICAgICAgICAgICAgdGhpcy5qb2Jfc3RhcnRlZCA9IGpvYl9zdGFydGVkO1xuICAgICAgICAgICAgdGhpcy5qb2JfY29tcGxldGVkID0gam9iX2NvbXBsZXRlZDtcbiAgICAgICAgICAgIHRoaXMuam9iX2V4aXRfY29kZSA9IGpvYl9leGl0X2NvZGU7XG4gICAgICAgICAgICB0aGlzLnBvc3Rfc3RhcnRlZCA9IHBvc3Rfc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMucG9zdF9jb21wbGV0ZWQgPSBwb3N0X2NvbXBsZXRlZDtcbiAgICAgICAgICAgIHRoaXMucG9zdF9leGl0X2NvZGUgPSBwb3N0X2V4aXRfY29kZTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWRfZm9ybWF0dGVkID0gY3JlYXRlZCA/IG1vbWVudC51dGMoY3JlYXRlZCkudG9JU09TdHJpbmcoKSA6IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLnF1ZXVlZCA9IHF1ZXVlZDtcbiAgICAgICAgICAgIHRoaXMucXVldWVkX2Zvcm1hdHRlZCA9IHF1ZXVlZCA/IG1vbWVudC51dGMocXVldWVkKS50b0lTT1N0cmluZygpIDogcXVldWVkO1xuICAgICAgICAgICAgdGhpcy5zdGFydGVkID0gc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRlZF9mb3JtYXR0ZWQgPSBzdGFydGVkID8gbW9tZW50LnV0YyhzdGFydGVkKS50b0lTT1N0cmluZygpIDogc3RhcnRlZDtcbiAgICAgICAgICAgIHRoaXMuZW5kZWQgPSBlbmRlZDtcbiAgICAgICAgICAgIHRoaXMuZW5kZWRfZm9ybWF0dGVkID0gZW5kZWQgPyBtb21lbnQudXRjKGVuZGVkKS50b0lTT1N0cmluZygpIDogZW5kZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkX2Zvcm1hdHRlZCA9IGxhc3RfbW9kaWZpZWQgPyBtb21lbnQudXRjKGxhc3RfbW9kaWZpZWQpLnRvSVNPU3RyaW5nKCkgOiBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5qb2IgPSBKb2IudHJhbnNmb3JtZXIoam9iKTtcbiAgICAgICAgICAgIHRoaXMubm9kZSA9IE5vZGUudHJhbnNmb3JtZXIobm9kZSk7XG4gICAgICAgICAgICB0aGlzLmVycm9yID0gZXJyb3I7XG4gICAgICAgICAgICB0aGlzLmVudmlyb25tZW50ID0gZW52aXJvbm1lbnQ7XG4gICAgICAgICAgICB0aGlzLmNwdXNfc2NoZWR1bGVkID0gY3B1c19zY2hlZHVsZWQ7XG4gICAgICAgICAgICB0aGlzLm1lbV9zY2hlZHVsZWQgPSBtZW1fc2NoZWR1bGVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX2luX3NjaGVkdWxlZCA9IGRpc2tfaW5fc2NoZWR1bGVkO1xuICAgICAgICAgICAgdGhpcy5kaXNrX291dF9zY2hlZHVsZWQgPSBkaXNrX291dF9zY2hlZHVsZWQ7XG4gICAgICAgICAgICB0aGlzLmRpc2tfdG90YWxfc2NoZWR1bGVkID0gZGlza190b3RhbF9zY2hlZHVsZWQ7XG4gICAgICAgICAgICB0aGlzLnJlc3VsdHMgPSByZXN1bHRzO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50X3N0ZG91dF91cmwgPSBjdXJyZW50X3N0ZG91dF91cmw7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRfc3RkZXJyX3VybCA9IGN1cnJlbnRfc3RkZXJyX3VybDtcbiAgICAgICAgICAgIHRoaXMucmVzdWx0c19tYW5pZmVzdCA9IHJlc3VsdHNfbWFuaWZlc3Q7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iRXhlY3V0aW9uLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1vbWVudC51dGModGhpcy5qb2JfY29tcGxldGVkKS5kaWZmKG1vbWVudC51dGModGhpcy5qb2Jfc3RhcnRlZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEljb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5qb2Iuam9iVHlwZS5pY29uQ29kZSA/ICc8aSBjbGFzcz1cImZhXCI+JiN4JyArIHRoaXMuam9iLmpvYlR5cGUuaWNvbkNvZGUgKyAnPC9pPicgOiAnPGkgY2xhc3M9XCJmYVwiPiYjeCcgKyBzY2FsZUNvbmZpZy5kZWZhdWx0SWNvbkNvZGUgKyAnPC9pPic7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYkV4ZWN1dGlvbi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRXhlY3V0aW9uKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb21tYW5kX2FyZ3VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByZV9zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByZV9jb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHJlX2V4aXRfY29kZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2Jfc3RhcnRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfY29tcGxldGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl9leGl0X2NvZGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucG9zdF9zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnBvc3RfY29tcGxldGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnBvc3RfZXhpdF9jb2RlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucXVldWVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubm9kZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lcnJvcixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lbnZpcm9ubWVudCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcHVzX3NjaGVkdWxlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tZW1fc2NoZWR1bGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfaW5fc2NoZWR1bGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfb3V0X3NjaGVkdWxlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrX3RvdGFsX3NjaGVkdWxlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmN1cnJlbnRfc3Rkb3V0X3VybCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jdXJyZW50X3N0ZGVycl91cmwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0c19tYW5pZmVzdFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYkV4ZWN1dGlvbigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYkV4ZWN1dGlvbi50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JFeGVjdXRpb24uYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iRXhlY3V0aW9uLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JFeGVjdXRpb247XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JFeGVjdXRpb25Mb2cnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIEpvYiwgTm9kZSkge1xuICAgICAgICB2YXIgSm9iRXhlY3V0aW9uTG9nID0gZnVuY3Rpb24gKGlkLCBzdGF0dXMsIGNvbW1hbmRfYXJndW1lbnRzLCB0aW1lb3V0LCBleGl0X2NvZGUsIGNyZWF0ZWQsIHF1ZXVlZCwgc2NoZWR1bGVkLCBwcmVfc3RhcnRlZCwgcHJlX2NvbXBsZXRlZCwgam9iX3N0YXJ0ZWQsIGpvYl9jb21wbGV0ZWQsIHBvc3Rfc3RhcnRlZCwgcG9zdF9jb21wbGV0ZWQsIGVuZGVkLCBsYXN0X21vZGlmaWVkLCBqb2IsIG5vZGUsIGVycm9yLCBpc19maW5pc2hlZCwgc3Rkb3V0LCBzdGRlcnIpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgdGhpcy5jb21tYW5kX2FyZ3VtZW50cyA9IGNvbW1hbmRfYXJndW1lbnRzO1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDtcbiAgICAgICAgICAgIHRoaXMuZXhpdF9jb2RlID0gZXhpdF9jb2RlO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMucXVldWVkID0gcXVldWVkO1xuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZWQgPSBzY2hlZHVsZWQ7XG4gICAgICAgICAgICB0aGlzLnByZV9zdGFydGVkID0gcHJlX3N0YXJ0ZWQ7XG4gICAgICAgICAgICB0aGlzLnByZV9jb21wbGV0ZWQgPSBwcmVfY29tcGxldGVkO1xuICAgICAgICAgICAgdGhpcy5qb2Jfc3RhcnRlZCA9IGpvYl9zdGFydGVkO1xuICAgICAgICAgICAgdGhpcy5qb2JfY29tcGxldGVkID0gam9iX2NvbXBsZXRlZDtcbiAgICAgICAgICAgIHRoaXMucG9zdF9zdGFydGVkID0gcG9zdF9zdGFydGVkO1xuICAgICAgICAgICAgdGhpcy5wb3N0X2NvbXBsZXRlZCA9IHBvc3RfY29tcGxldGVkO1xuICAgICAgICAgICAgdGhpcy5lbmRlZCA9IGVuZGVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMuam9iID0gSm9iLnRyYW5zZm9ybWVyKGpvYik7XG4gICAgICAgICAgICB0aGlzLm5vZGUgPSBOb2RlLnRyYW5zZm9ybWVyKG5vZGUpO1xuICAgICAgICAgICAgdGhpcy5lcnJvciA9IGVycm9yO1xuICAgICAgICAgICAgdGhpcy5pc19maW5pc2hlZCA9IGlzX2ZpbmlzaGVkO1xuICAgICAgICAgICAgdGhpcy5zdGRvdXQgPSBzdGRvdXQ7XG4gICAgICAgICAgICB0aGlzLnN0ZG91dEh0bWwgPSBzdGRvdXQgPyBzdGRvdXQucmVwbGFjZShuZXcgUmVnRXhwKCdcXHI/XFxuJywnZycpLCAnPGJyIC8+JykgOiAnJztcbiAgICAgICAgICAgIHRoaXMuc3RkZXJyID0gc3RkZXJyO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYkV4ZWN1dGlvbkxvZy5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICB0b0h0bWw6IGZ1bmN0aW9uKGluc3RyKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5zdHJcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JFeGVjdXRpb25Mb2cuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYkV4ZWN1dGlvbkxvZyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY29tbWFuZF9hcmd1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGltZW91dCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5leGl0X2NvZGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5xdWV1ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc2NoZWR1bGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByZV9zdGFydGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByZV9jb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3N0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX2NvbXBsZXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wb3N0X3N0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucG9zdF9jb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZW5kZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2IsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubm9kZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5lcnJvcixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19maW5pc2hlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGRvdXQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuc3RkZXJyXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iRXhlY3V0aW9uTG9nKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iRXhlY3V0aW9uTG9nLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYkV4ZWN1dGlvbkxvZy5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JFeGVjdXRpb25Mb2cuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYkV4ZWN1dGlvbkxvZztcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYlR5cGUnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIEpvYlR5cGVJbnRlcmZhY2UpIHtcbiAgICAgICAgdmFyIEpvYlR5cGUgPSBmdW5jdGlvbiAoaWQsIG5hbWUsIHRpdGxlLCB2ZXJzaW9uLCBkZXNjcmlwdGlvbiwgaXNfc3lzdGVtLCBpc19sb25nX3J1bm5pbmcsIGlzX2FjdGl2ZSwgaXNfb3BlcmF0aW9uYWwsIGlzX3BhdXNlZCwgdXNlc19kb2NrZXIsIGRvY2tlcl9wcml2aWxlZ2VkLCBkb2NrZXJfaW1hZ2UsIHByaW9yaXR5LCB0aW1lb3V0LCBtYXhfdHJpZXMsIGNwdXNfcmVxdWlyZWQsIG1lbV9yZXF1aXJlZCwgZGlza19vdXRfY29uc3RfcmVxdWlyZWQsIGRpc2tfb3V0X211bHRfcmVxdWlyZWQsIGljb25fY29kZSwgY3JlYXRlZCwgYXJjaGl2ZWQsIHBhdXNlZCwgbGFzdF9tb2RpZmllZCwgam9iX3R5cGVfaW50ZXJmYWNlKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgdGhpcy50aXRsZSA9IHRpdGxlO1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuaXNfc3lzdGVtID0gaXNfc3lzdGVtO1xuICAgICAgICAgICAgdGhpcy5pc19sb25nX3J1bm5pbmcgPSBpc19sb25nX3J1bm5pbmc7XG4gICAgICAgICAgICB0aGlzLmlzX2FjdGl2ZSA9IGlzX2FjdGl2ZTtcbiAgICAgICAgICAgIHRoaXMuaXNfb3BlcmF0aW9uYWwgPSBpc19vcGVyYXRpb25hbDtcbiAgICAgICAgICAgIHRoaXMuaXNfcGF1c2VkID0gaXNfcGF1c2VkO1xuICAgICAgICAgICAgdGhpcy51c2VzX2RvY2tlciA9IHVzZXNfZG9ja2VyO1xuICAgICAgICAgICAgdGhpcy5kb2NrZXJfcHJpdmlsZWdlZCA9IGRvY2tlcl9wcml2aWxlZ2VkO1xuICAgICAgICAgICAgdGhpcy5kb2NrZXJfaW1hZ2UgPSBkb2NrZXJfaW1hZ2U7XG4gICAgICAgICAgICB0aGlzLnByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXQgPSB0aW1lb3V0O1xuICAgICAgICAgICAgdGhpcy5tYXhfdHJpZXMgPSBtYXhfdHJpZXM7XG4gICAgICAgICAgICB0aGlzLmNwdXNfcmVxdWlyZWQgPSBjcHVzX3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5tZW1fcmVxdWlyZWQgPSBtZW1fcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkID0gZGlza19vdXRfY29uc3RfcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmRpc2tfb3V0X211bHRfcmVxdWlyZWQgPSBkaXNrX291dF9tdWx0X3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5pY29uX2NvZGUgPSBpY29uX2NvZGU7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5hcmNoaXZlZCA9IGFyY2hpdmVkO1xuICAgICAgICAgICAgdGhpcy5wYXVzZWQgPSBwYXVzZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZV9pbnRlcmZhY2UgPSBKb2JUeXBlSW50ZXJmYWNlLnRyYW5zZm9ybWVyKGpvYl90eXBlX2ludGVyZmFjZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iVHlwZS5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnSm9iVHlwZSc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0SWNvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmljb25fY29kZSA/ICc8aSBjbGFzcz1cImZhXCI+JiN4JyArIHRoaXMuaWNvbl9jb2RlICsgJzwvaT4nIDogJzxpIGNsYXNzPVwiZmFcIj4mI3gnICsgc2NhbGVDb25maWcuZGVmYXVsdEljb25Db2RlICsgJzwvaT4nO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxUZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWNvbl9jb2RlID8gJyYjeCcgKyB0aGlzLmljb25fY29kZSArICc7JyA6ICcmI3gnICsgc2NhbGVDb25maWcuZGVmYXVsdEljb25Db2RlICsgJzsnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxUaXRsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRpdGxlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBKb2JUeXBlLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19zeXN0ZW0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfbG9uZ19ydW5uaW5nLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19vcGVyYXRpb25hbCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19wYXVzZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudXNlc19kb2NrZXIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZG9ja2VyX3ByaXZpbGVnZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZG9ja2VyX2ltYWdlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWF4X3RyaWVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNwdXNfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVtX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRpc2tfb3V0X211bHRfcmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWNvbl9jb2RlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuYXJjaGl2ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucGF1c2VkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaW50ZXJmYWNlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYlR5cGUudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iVHlwZS5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JUeXBlLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JUeXBlO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYlR5cGVEZXRhaWxzJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBKb2JUeXBlSW50ZXJmYWNlLCBKb2JUeXBlRXJyb3JNYXBwaW5nLCBKb2JUeXBlRXJyb3IsIHNjYWxlU2VydmljZSkge1xuICAgICAgICB2YXIgSm9iVHlwZURldGFpbHMgPSBmdW5jdGlvbiAoaWQsIG5hbWUsIHZlcnNpb24sIHRpdGxlLCBkZXNjcmlwdGlvbiwgY2F0ZWdvcnksIGF1dGhvcl9uYW1lLCBhdXRob3JfdXJsLCBpc19zeXN0ZW0sIGlzX2xvbmdfcnVubmluZywgaXNfYWN0aXZlLCBpc19vcGVyYXRpb25hbCwgaXNfcGF1c2VkLCBpY29uX2NvZGUsIHVzZXNfZG9ja2VyLCBkb2NrZXJfcHJpdmlsZWdlZCwgZG9ja2VyX2ltYWdlLCBwcmlvcml0eSwgdGltZW91dCwgbWF4X3RyaWVzLCBjcHVzX3JlcXVpcmVkLCBtZW1fcmVxdWlyZWQsIGRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkLCBkaXNrX291dF9tdWx0X3JlcXVpcmVkLCBjcmVhdGVkLCBhcmNoaXZlZCwgcGF1c2VkLCBsYXN0X21vZGlmaWVkLCBqb2JfdHlwZV9pbnRlcmZhY2UsIGVycm9yX21hcHBpbmcsIGVycm9ycywgam9iX2NvdW50c182aCwgam9iX2NvdW50c18xMmgsIGpvYl9jb3VudHNfMjRoKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuY2F0ZWdvcnkgPSBjYXRlZ29yeTtcbiAgICAgICAgICAgIHRoaXMuYXV0aG9yX25hbWUgPSBhdXRob3JfbmFtZTtcbiAgICAgICAgICAgIHRoaXMuYXV0aG9yX3VybCA9IGF1dGhvcl91cmw7XG4gICAgICAgICAgICB0aGlzLmlzX3N5c3RlbSA9IGlzX3N5c3RlbTtcbiAgICAgICAgICAgIHRoaXMuaXNfbG9uZ19ydW5uaW5nID0gaXNfbG9uZ19ydW5uaW5nO1xuICAgICAgICAgICAgdGhpcy5pc19hY3RpdmUgPSBpc19hY3RpdmU7XG4gICAgICAgICAgICB0aGlzLmlzX29wZXJhdGlvbmFsID0gaXNfb3BlcmF0aW9uYWw7XG4gICAgICAgICAgICB0aGlzLmlzX3BhdXNlZCA9IGlzX3BhdXNlZDtcbiAgICAgICAgICAgIHRoaXMuaWNvbl9jb2RlID0gaWNvbl9jb2RlO1xuICAgICAgICAgICAgdGhpcy51c2VzX2RvY2tlciA9IHVzZXNfZG9ja2VyO1xuICAgICAgICAgICAgdGhpcy5kb2NrZXJfcHJpdmlsZWdlZCA9IGRvY2tlcl9wcml2aWxlZ2VkO1xuICAgICAgICAgICAgdGhpcy5kb2NrZXJfaW1hZ2UgPSBkb2NrZXJfaW1hZ2U7XG4gICAgICAgICAgICB0aGlzLnByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXQgPSB0aW1lb3V0O1xuICAgICAgICAgICAgdGhpcy5tYXhfdHJpZXMgPSBtYXhfdHJpZXM7XG4gICAgICAgICAgICB0aGlzLmNwdXNfcmVxdWlyZWQgPSBjcHVzX3JlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy5tZW1fcmVxdWlyZWQgPSBtZW1fcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLm1lbV9yZXF1aXJlZF9mb3JtYXR0ZWQgPSBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tTWliKG1lbV9yZXF1aXJlZCk7XG4gICAgICAgICAgICB0aGlzLmRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkID0gZGlza19vdXRfY29uc3RfcmVxdWlyZWQ7XG4gICAgICAgICAgICB0aGlzLmRpc2tfb3V0X2NvbnN0X3JlcXVpcmVkX2Zvcm1hdHRlZCA9IHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21NaWIoZGlza19vdXRfY29uc3RfcmVxdWlyZWQpO1xuICAgICAgICAgICAgdGhpcy5kaXNrX291dF9tdWx0X3JlcXVpcmVkID0gZGlza19vdXRfbXVsdF9yZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmFyY2hpdmVkID0gYXJjaGl2ZWQ7XG4gICAgICAgICAgICB0aGlzLnBhdXNlZCA9IHBhdXNlZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlX2ludGVyZmFjZSA9IGpvYl90eXBlX2ludGVyZmFjZTtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JfbWFwcGluZyA9IEpvYlR5cGVFcnJvck1hcHBpbmcudHJhbnNmb3JtZXIoZXJyb3JfbWFwcGluZyk7XG4gICAgICAgICAgICB0aGlzLmVycm9ycyA9IEpvYlR5cGVFcnJvci50cmFuc2Zvcm1lcihlcnJvcnMpO1xuICAgICAgICAgICAgdGhpcy5qb2JfY291bnRzXzZoID0gam9iX2NvdW50c182aDtcbiAgICAgICAgICAgIHRoaXMuam9iX2NvdW50c18xMmggPSBqb2JfY291bnRzXzEyaDtcbiAgICAgICAgICAgIHRoaXMuam9iX2NvdW50c18yNGggPSBqb2JfY291bnRzXzI0aDtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JUeXBlRGV0YWlscy5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXRJY29uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaWNvbl9jb2RlID8gJzxpIGNsYXNzPVwiZmFcIj4mI3gnICsgdGhpcy5pY29uX2NvZGUgKyAnPC9pPicgOiAnPGkgY2xhc3M9XCJmYVwiPiYjeCcgKyBzY2FsZUNvbmZpZy5kZWZhdWx0SWNvbkNvZGUgKyAnPC9pPic7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0UGVyZm9ybWFuY2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmFpbGVkNkFyciA9IF8ud2hlcmUodGhpcy5qb2JfY291bnRzXzZoLCB7ICdzdGF0dXMnOiAnRkFJTEVEJyB9KSxcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkMTJBcnIgPSBfLndoZXJlKHRoaXMuam9iX2NvdW50c18xMmgsIHsgJ3N0YXR1cyc6ICdGQUlMRUQnIH0pLFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQyNEFyciA9IF8ud2hlcmUodGhpcy5qb2JfY291bnRzXzI0aCwgeyAnc3RhdHVzJzogJ0ZBSUxFRCcgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgY29tcGxldGVkNiA9IF8uZmluZCh0aGlzLmpvYl9jb3VudHNfNmgsICdzdGF0dXMnLCAnQ09NUExFVEVEJykgfHwgeyBjb3VudDogMCB9LFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQ2ID0gXy5zdW0oZmFpbGVkNkFyciwgJ2NvdW50JyksXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsNiA9IGZhaWxlZDZBcnIubGVuZ3RoID4gMCA/IGZhaWxlZDYgKyBjb21wbGV0ZWQ2LmNvdW50IDogY29tcGxldGVkNi5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc1JhdGU2ID0gdG90YWw2ID09PSAwID8gMCA6IDEwMCAtICgoZmFpbGVkNiAvIHRvdGFsNikgKiAxMDApLnRvRml4ZWQoMiksXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDEyID0gXy5maW5kKHRoaXMuam9iX2NvdW50c18xMmgsICdzdGF0dXMnLCAnQ09NUExFVEVEJykgfHwgeyBjb3VudDogMCB9LFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQxMiA9IF8uc3VtKGZhaWxlZDEyQXJyLCAnY291bnQnKSxcbiAgICAgICAgICAgICAgICAgICAgdG90YWwxMiA9IGZhaWxlZDEyQXJyLmxlbmd0aCA+IDAgPyBmYWlsZWQxMiArIGNvbXBsZXRlZDEyLmNvdW50IDogY29tcGxldGVkMTIuY291bnQsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlMTIgPSB0b3RhbDEyID09PSAwID8gMCA6IDEwMCAtICgoZmFpbGVkMTIgLyB0b3RhbDEyKSAqIDEwMCkudG9GaXhlZCgyKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkMjQgPSBfLmZpbmQodGhpcy5qb2JfY291bnRzXzI0aCwgJ3N0YXR1cycsICdDT01QTEVURUQnKSB8fCB7IGNvdW50OiAwIH0sXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDI0ID0gXy5zdW0oZmFpbGVkMjRBcnIsICdjb3VudCcpLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbDI0ID0gZmFpbGVkMjRBcnIubGVuZ3RoID4gMCA/IGZhaWxlZDI0ICsgY29tcGxldGVkMjQuY291bnQgOiBjb21wbGV0ZWQyNC5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc1JhdGUyNCA9IHRvdGFsMjQgPT09IDAgPyAwIDogMTAwIC0gKChmYWlsZWQyNCAvIHRvdGFsMjQpICogMTAwKS50b0ZpeGVkKDIpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgaG91cjY6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhdGU6IHN1Y2Nlc3NSYXRlNixcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxlZDogZmFpbGVkNixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogY29tcGxldGVkNi5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0b3RhbDZcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgaG91cjEyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByYXRlOiBzdWNjZXNzUmF0ZTEyLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbGVkOiBmYWlsZWQxMixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogY29tcGxldGVkMTIuY291bnQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogdG90YWwxMlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBob3VyMjQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhdGU6IHN1Y2Nlc3NSYXRlMjQsXG4gICAgICAgICAgICAgICAgICAgICAgICBmYWlsZWQ6IGZhaWxlZDI0LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkOiBjb21wbGV0ZWQyNC5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0b3RhbDI0XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEZhaWx1cmVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZhaWxlZDYgPSBfLndoZXJlKHRoaXMuam9iX2NvdW50c182aCwgeyAnc3RhdHVzJzogJ0ZBSUxFRCcgfSksXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDZWYWx1ZXMgPSBfLnZhbHVlcyhfLmdyb3VwQnkoZmFpbGVkNiwgJ2NhdGVnb3J5JykpLFxuICAgICAgICAgICAgICAgICAgICBmYWlsZWQxMiA9IF8ud2hlcmUodGhpcy5qb2JfY291bnRzXzEyaCwgeyAnc3RhdHVzJzogJ0ZBSUxFRCcgfSksXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDEyVmFsdWVzID0gXy52YWx1ZXMoXy5ncm91cEJ5KGZhaWxlZDEyLCAnY2F0ZWdvcnknKSksXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDI0ID0gXy53aGVyZSh0aGlzLmpvYl9jb3VudHNfMjRoLCB7ICdzdGF0dXMnOiAnRkFJTEVEJyB9KSxcbiAgICAgICAgICAgICAgICAgICAgZmFpbGVkMjRWYWx1ZXMgPSBfLnZhbHVlcyhfLmdyb3VwQnkoZmFpbGVkMjQsICdjYXRlZ29yeScpKTtcblxuICAgICAgICAgICAgICAgIHZhciBnZXRGYWlsdXJlQ291bnRzID0gZnVuY3Rpb24gKGNhdGVnb3JpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldHVybkFyciA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goY2F0ZWdvcmllcywgZnVuY3Rpb24gKGNhdGVnb3J5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goY2F0ZWdvcnksIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5BcnIucHVzaCh7IHN0YXR1czogdmFsLmNhdGVnb3J5LCBjb3VudDogdmFsLmNvdW50IH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuQXJyO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBob3VyNjogZ2V0RmFpbHVyZUNvdW50cyhmYWlsZWQ2VmFsdWVzKSxcbiAgICAgICAgICAgICAgICAgICAgaG91cjEyOiBnZXRGYWlsdXJlQ291bnRzKGZhaWxlZDEyVmFsdWVzKSxcbiAgICAgICAgICAgICAgICAgICAgaG91cjI0OiBnZXRGYWlsdXJlQ291bnRzKGZhaWxlZDI0VmFsdWVzKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYlR5cGVEZXRhaWxzLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlRGV0YWlscyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY2F0ZWdvcnksXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuYXV0aG9yX25hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuYXV0aG9yX3VybCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19zeXN0ZW0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfbG9uZ19ydW5uaW5nLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX2FjdGl2ZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19vcGVyYXRpb25hbCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19wYXVzZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWNvbl9jb2RlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnVzZXNfZG9ja2VyLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRvY2tlcl9wcml2aWxlZ2VkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRvY2tlcl9pbWFnZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wcmlvcml0eSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1heF90cmllcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcHVzX3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lbV9yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrX291dF9jb25zdF9yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrX291dF9tdWx0X3JlcXVpcmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuYXJjaGl2ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucGF1c2VkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaW50ZXJmYWNlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmVycm9yX21hcHBpbmcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXJyb3JzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl9jb3VudHNfNmgsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX2NvdW50c18xMmgsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX2NvdW50c18yNGhcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlRGV0YWlscygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYlR5cGVEZXRhaWxzLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKEpvYlR5cGVEZXRhaWxzLmJ1aWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JUeXBlRGV0YWlscy5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iVHlwZURldGFpbHM7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iVHlwZUVycm9yJywgZnVuY3Rpb24gKG1vbWVudCwgc2NhbGVDb25maWcpIHtcbiAgICAgICAgdmFyIEpvYlR5cGVFcnJvciA9IGZ1bmN0aW9uIChpZCwgbmFtZSwgdGl0bGUsIGRlc2NyaXB0aW9uLCBjYXRlZ29yeSwgY3JlYXRlZCwgbGFzdF9tb2RpZmllZCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuY2F0ZWdvcnkgPSBjYXRlZ29yeTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWRfZm9ybWF0dGVkID0gY3JlYXRlZCA/IG1vbWVudC51dGMoY3JlYXRlZCkudG9JU09TdHJpbmcoKSA6IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkX2Zvcm1hdHRlZCA9IGxhc3RfbW9kaWZpZWQgPyBtb21lbnQudXRjKGxhc3RfbW9kaWZpZWQpLnRvSVNPU3RyaW5nKCkgOiBsYXN0X21vZGlmaWVkO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIEpvYlR5cGVFcnJvci5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iVHlwZUVycm9yLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jYXRlZ29yeSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcmVhdGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlRXJyb3IoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBKb2JUeXBlRXJyb3IudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iVHlwZUVycm9yLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYlR5cGVFcnJvci5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gSm9iVHlwZUVycm9yO1xuICAgIH0pXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnSm9iVHlwZUVycm9yTWFwcGluZycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIEpvYlR5cGVFcnJvck1hcHBpbmcgPSBmdW5jdGlvbiAodmVyc2lvbiwgZXhpdF9jb2Rlcykge1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMuZXhpdF9jb2RlcyA9IGV4aXRfY29kZXM7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iVHlwZUVycm9yTWFwcGluZy5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iVHlwZUVycm9yTWFwcGluZy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZUVycm9yTWFwcGluZyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS52ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmV4aXRfY29kZXNcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlRXJyb3JNYXBwaW5nKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iVHlwZUVycm9yTWFwcGluZy50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JUeXBlRXJyb3JNYXBwaW5nLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYlR5cGVFcnJvck1hcHBpbmcuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYlR5cGVFcnJvck1hcHBpbmc7XG4gICAgfSlcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JUeXBlSW5wdXREYXRhJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnKSB7XG4gICAgICAgIHZhciBKb2JUeXBlSW5wdXREYXRhID0gZnVuY3Rpb24gKG1lZGlhX3R5cGVzLCByZXF1aXJlZCwgdHlwZSwgbmFtZSkge1xuICAgICAgICAgICAgdGhpcy5tZWRpYV90eXBlcyA9IG1lZGlhX3R5cGVzO1xuICAgICAgICAgICAgdGhpcy5yZXF1aXJlZCA9IHJlcXVpcmVkO1xuICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iVHlwZUlucHV0RGF0YS5wcm90b3R5cGUgPSB7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iVHlwZUlucHV0RGF0YS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZUlucHV0RGF0YShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tZWRpYV90eXBlcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXF1aXJlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlSW5wdXREYXRhKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iVHlwZUlucHV0RGF0YS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JUeXBlSW5wdXREYXRhLmJ1aWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JUeXBlSW5wdXREYXRhLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JUeXBlSW5wdXREYXRhO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYlR5cGVJbnRlcmZhY2UnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIEpvYlR5cGVJbnB1dERhdGEsIEpvYlR5cGVPdXRwdXREYXRhKSB7XG4gICAgICAgIHZhciBKb2JUeXBlSW50ZXJmYWNlID0gZnVuY3Rpb24gKHZlcnNpb24sIGNvbW1hbmQsIGNvbW1hbmRfYXJndW1lbnRzLCBpbnB1dF9kYXRhLCBvdXRwdXRfZGF0YSkge1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMuY29tbWFuZCA9IGNvbW1hbmQ7XG4gICAgICAgICAgICB0aGlzLmNvbW1hbmRfYXJndW1lbnRzID0gY29tbWFuZF9hcmd1bWVudHM7XG4gICAgICAgICAgICB0aGlzLmlucHV0X2RhdGEgPSBKb2JUeXBlSW5wdXREYXRhLnRyYW5zZm9ybWVyKGlucHV0X2RhdGEpO1xuICAgICAgICAgICAgdGhpcy5vdXRwdXRfZGF0YSA9IEpvYlR5cGVPdXRwdXREYXRhLnRyYW5zZm9ybWVyKG91dHB1dF9kYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JUeXBlSW50ZXJmYWNlLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGdldEljb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pY29uQ29kZSA/ICc8aSBjbGFzcz1cImZhXCI+JiN4JyArIHRoaXMuaWNvbkNvZGUgKyAnPC9pPicgOiAnPGkgY2xhc3M9XCJmYVwiPiYjeCcgKyBzY2FsZUNvbmZpZy5kZWZhdWx0SWNvbkNvZGUgKyAnPC9pPic7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYlR5cGVJbnRlcmZhY2UuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEpvYlR5cGVJbnRlcmZhY2UoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb21tYW5kLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNvbW1hbmRfYXJndW1lbnRzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlucHV0X2RhdGEsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEub3V0cHV0X2RhdGFcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlSW50ZXJmYWNlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iVHlwZUludGVyZmFjZS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChKb2JUeXBlSW50ZXJmYWNlLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpvYlR5cGVJbnRlcmZhY2UuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYlR5cGVJbnRlcmZhY2U7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdKb2JUeXBlT3V0cHV0RGF0YScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIEpvYlR5cGVPdXRwdXREYXRhID0gZnVuY3Rpb24gKG5hbWUsIHR5cGUsIHJlcXVpcmVkLCBtZWRpYV90eXBlKSB7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgICAgIHRoaXMucmVxdWlyZWQgPSByZXF1aXJlZDtcbiAgICAgICAgICAgIHRoaXMubWVkaWFfdHlwZSA9IG1lZGlhX3R5cGU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgSm9iVHlwZU91dHB1dERhdGEucHJvdG90eXBlID0ge1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIEpvYlR5cGVPdXRwdXREYXRhLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKb2JUeXBlT3V0cHV0RGF0YShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWVkaWFfdHlwZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpvYlR5cGVPdXRwdXREYXRhKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgSm9iVHlwZU91dHB1dERhdGEudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iVHlwZU91dHB1dERhdGEuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSm9iVHlwZU91dHB1dERhdGEuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIEpvYlR5cGVPdXRwdXREYXRhO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ0pvYlR5cGVTdGF0dXMnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIEpvYlR5cGUsIEpvYkV4ZWN1dGlvbikge1xuICAgICAgICB2YXIgSm9iVHlwZVN0YXR1cyA9IGZ1bmN0aW9uIChqb2JfdHlwZSwgam9iX2NvdW50cykge1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZSA9IEpvYlR5cGUudHJhbnNmb3JtZXIoam9iX3R5cGUpO1xuICAgICAgICAgICAgdGhpcy5qb2JfY291bnRzID0gam9iX2NvdW50cztcbiAgICAgICAgICAgIHRoaXMuaGFzX3J1bm5pbmcgPSBfLmZpbmQoam9iX2NvdW50cywgJ3N0YXR1cycsICdSVU5OSU5HJyk7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gdGhpcy5nZXRQZXJmb3JtYW5jZSgpLnJhdGVEZXNjcmlwdGlvbjtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBKb2JUeXBlU3RhdHVzLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdKb2JUeXBlU3RhdHVzJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRQZXJmb3JtYW5jZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBmYWlsZWRBcnIgPSBfLndoZXJlKHRoaXMuam9iX2NvdW50cywgeyAnc3RhdHVzJzogJ0ZBSUxFRCcgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgY29tcGxldGVkID0gXy5maW5kKHRoaXMuam9iX2NvdW50cywgJ3N0YXR1cycsICdDT01QTEVURUQnKSB8fCB7IGNvdW50OiAwIH0sXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZCA9IF8uc3VtKGZhaWxlZEFyciwgJ2NvdW50JyksXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsID0gZmFpbGVkQXJyLmxlbmd0aCA+IDAgPyBmYWlsZWQgKyBjb21wbGV0ZWQuY291bnQgOiBjb21wbGV0ZWQuY291bnQsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlID0gdG90YWwgPT09IDAgPyAwIDogMTAwIC0gKChmYWlsZWQgLyB0b3RhbCkgKiAxMDApLnRvRml4ZWQoMiksXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlRGVzY3JpcHRpb24gPSAnc3VjY2Vzcyc7XG5cbiAgICAgICAgICAgICAgICBpZiAoc3VjY2Vzc1JhdGUgPD0gMzAgJiYgdG90YWwgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlRGVzY3JpcHRpb24gPSAnZXJyb3InO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3VjY2Vzc1JhdGUgPiAzMCAmJiBzdWNjZXNzUmF0ZSA8PSA2MCAmJiB0b3RhbCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc1JhdGVEZXNjcmlwdGlvbiA9ICd3YXJuaW5nJztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRvdGFsID09PSAwICYmICF0aGlzLmhhc19ydW5uaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NSYXRlRGVzY3JpcHRpb24gPSAnel9pbmFjdGl2ZSc7IC8vIHByZXBlbmQgd2l0aCAnel8nIGZvciBvcmRlcmluZyBwdXJwb3Nlc1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHJhdGU6IHN1Y2Nlc3NSYXRlLFxuICAgICAgICAgICAgICAgICAgICByYXRlRGVzY3JpcHRpb246IHN1Y2Nlc3NSYXRlRGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZDogZmFpbGVkLFxuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQ6IGNvbXBsZXRlZC5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IHRvdGFsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRSdW5uaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF8uZmluZCh0aGlzLmpvYl9jb3VudHMsICdzdGF0dXMnLCAnUlVOTklORycpIHx8IHsgY291bnQ6IDAgfTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRGYWlsdXJlczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBmYWlsZWQgPSBfLndoZXJlKHRoaXMuam9iX2NvdW50cywgeyAnc3RhdHVzJzogJ0ZBSUxFRCcgfSksXG4gICAgICAgICAgICAgICAgICAgIGZhaWxlZFZhbHVlcyA9IF8udmFsdWVzKF8uZ3JvdXBCeShmYWlsZWQsICdjYXRlZ29yeScpKTtcblxuICAgICAgICAgICAgICAgIHZhciBnZXRGYWlsdXJlQ291bnRzID0gZnVuY3Rpb24gKGNhdGVnb3JpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldHVybkFyciA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goY2F0ZWdvcmllcywgZnVuY3Rpb24gKGNhdGVnb3J5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goY2F0ZWdvcnksIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5BcnIucHVzaCh7IHN0YXR1czogdmFsLmNhdGVnb3J5LCBjb3VudDogdmFsLmNvdW50IH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuQXJyO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0RmFpbHVyZUNvdW50cyhmYWlsZWRWYWx1ZXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxGaWxsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1cyA9IHRoaXMuZ2V0UGVyZm9ybWFuY2UoKS5yYXRlRGVzY3JpcHRpb247XG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ3N1Y2Nlc3MnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfZ3JlZW47XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09ICd3YXJuaW5nJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X3llbGxvdztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gJ2Vycm9yJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVDb25maWcuY29sb3JzLmNoYXJ0X3JlZDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gJ3pfaW5hY3RpdmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfZ3JheV9kYXJrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsQWN0aXZpdHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcnVubmluZyA9IHRoaXMuZ2V0UnVubmluZygpO1xuICAgICAgICAgICAgICAgIGlmIChydW5uaW5nLmNvdW50ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyYjeCcgKyBzY2FsZUNvbmZpZy5hY3Rpdml0eUljb25Db2RlICsgJzsnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbEFjdGl2aXR5VG90YWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRSdW5uaW5nKCkuY291bnQgPiAwID8gdGhpcy5nZXRSdW5uaW5nKCkuY291bnQgOiAnJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsRXJyb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGVyZm9ybWFuY2UgPSB0aGlzLmdldFBlcmZvcm1hbmNlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdGYWlsZWQ6ICcgKyAocGVyZm9ybWFuY2UuZmFpbGVkKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsVG90YWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGVyZm9ybWFuY2UgPSB0aGlzLmdldFBlcmZvcm1hbmNlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdDb21wbGV0ZWQ6ICcgKyBwZXJmb3JtYW5jZS5jb21wbGV0ZWQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbFBhdXNlUmVzdW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxGYWlsdXJlczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfLm1hcCh0aGlzLmdldEZhaWx1cmVzKCksICdzdGF0dXMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgSm9iVHlwZVN0YXR1cy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZVN0YXR1cyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfY291bnRzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgSm9iVHlwZVN0YXR1cygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIEpvYlR5cGVTdGF0dXMudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoSm9iVHlwZVN0YXR1cy5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKb2JUeXBlU3RhdHVzLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBKb2JUeXBlU3RhdHVzO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKXtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdQcm9kdWN0JywgZnVuY3Rpb24gKEpvYlR5cGUsIHNjYWxlU2VydmljZSwgc2NhbGVDb25maWcpIHtcbiAgICAgICAgdmFyIFByb2R1Y3QgPSBmdW5jdGlvbiAoaWQsIHdvcmtzcGFjZSwgZmlsZV9uYW1lLCBtZWRpYV90eXBlLCBmaWxlX3NpemUsIGRhdGFfdHlwZSwgaXNfZGVsZXRlZCwgdXVpZCwgdXJsLCBjcmVhdGVkLCBkZWxldGVkLCBkYXRhX3N0YXJ0ZWQsIGRhdGFfZW5kZWQsIGdlb21ldHJ5LCBjZW50ZXJfcG9pbnQsIG1ldGFfZGF0YSwgY291bnRyaWVzLCBsYXN0X21vZGlmaWVkLCBpc19vcGVyYXRpb25hbCwgaXNfcHVibGlzaGVkLCBwdWJsaXNoZWQsIHVucHVibGlzaGVkLCBqb2JfdHlwZSwgam9iLCBqb2JfZXhlLCB1cGRhdGUsIHNvdXJjZV9maWxlcykge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy53b3Jrc3BhY2UgPSB3b3Jrc3BhY2U7XG4gICAgICAgICAgICB0aGlzLmZpbGVfbmFtZSA9IGZpbGVfbmFtZTtcbiAgICAgICAgICAgIHRoaXMubWVkaWFfdHlwZSA9IG1lZGlhX3R5cGU7XG4gICAgICAgICAgICB0aGlzLmZpbGVfc2l6ZSA9IGZpbGVfc2l6ZTtcbiAgICAgICAgICAgIHRoaXMuZmlsZV9zaXplX3JlYWRhYmxlID0gdGhpcy5nZXRSZWFkYWJsZUZpbGVTaXplKCk7XG4gICAgICAgICAgICB0aGlzLmRhdGFfdHlwZSA9IGRhdGFfdHlwZTtcbiAgICAgICAgICAgIHRoaXMuaXNfZGVsZXRlZCA9IGlzX2RlbGV0ZWQ7XG4gICAgICAgICAgICB0aGlzLnV1aWQgPSB1dWlkO1xuICAgICAgICAgICAgdGhpcy51cmwgPSB1cmw7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkX2Zvcm1hdHRlZCA9IGNyZWF0ZWQgPyBtb21lbnQudXRjKGNyZWF0ZWQpLnRvSVNPU3RyaW5nKCkgOiBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5kZWxldGVkID0gZGVsZXRlZDtcbiAgICAgICAgICAgIHRoaXMuZGF0YV9zdGFydGVkID0gZGF0YV9zdGFydGVkO1xuICAgICAgICAgICAgdGhpcy5kYXRhX2VuZGVkID0gZGF0YV9lbmRlZDtcbiAgICAgICAgICAgIHRoaXMuZ2VvbWV0cnkgPSBnZW9tZXRyeTtcbiAgICAgICAgICAgIHRoaXMuY2VudGVyX3BvaW50ID0gY2VudGVyX3BvaW50O1xuICAgICAgICAgICAgdGhpcy5tZXRhX2RhdGEgPSBtZXRhX2RhdGE7XG4gICAgICAgICAgICB0aGlzLmNvdW50cmllcyA9IGNvdW50cmllcztcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWRfZm9ybWF0dGVkID0gbGFzdF9tb2RpZmllZCA/IG1vbWVudC51dGMobGFzdF9tb2RpZmllZCkudG9JU09TdHJpbmcoKSA6IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmlzX29wZXJhdGlvbmFsID0gaXNfb3BlcmF0aW9uYWw7XG4gICAgICAgICAgICB0aGlzLmlzX29wZXJhdGlvbmFsX2xhYmVsID0gaXNfb3BlcmF0aW9uYWwgPyAnT3BlcmF0aW9uYWwnIDogJ1ImYW1wO0QnO1xuICAgICAgICAgICAgdGhpcy5pc19wdWJsaXNoZWQgPSBpc19wdWJsaXNoZWQ7XG4gICAgICAgICAgICB0aGlzLnB1Ymxpc2hlZCA9IHB1Ymxpc2hlZDtcbiAgICAgICAgICAgIHRoaXMudW5wdWJsaXNoZWQgPSB1bnB1Ymxpc2hlZDtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGUgPSBKb2JUeXBlLnRyYW5zZm9ybWVyKGpvYl90eXBlKTtcbiAgICAgICAgICAgIHRoaXMuam9iID0gam9iO1xuICAgICAgICAgICAgdGhpcy5qb2JfZXhlID0gam9iX2V4ZTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlID0gdXBkYXRlO1xuICAgICAgICAgICAgdGhpcy5zb3VyY2VfZmlsZXMgPSBzb3VyY2VfZmlsZXM7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgUHJvZHVjdC5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXREdXJhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQudXRjKHRoaXMubGFzdF9tb2RpZmllZCkuZGlmZihtb21lbnQudXRjKHRoaXMuY3JlYXRlZCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldFJlYWRhYmxlRmlsZVNpemU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUZpbGVTaXplRnJvbUJ5dGVzKHRoaXMuZmlsZV9zaXplKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgUHJvZHVjdC5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvZHVjdChcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS53b3Jrc3BhY2UsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZmlsZV9uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lZGlhX3R5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZmlsZV9zaXplLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRhdGFfdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19kZWxldGVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnV1aWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudXJsLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVsZXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kYXRhX3N0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGF0YV9lbmRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5nZW9tZXRyeSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jZW50ZXJfcG9pbnQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubWV0YV9kYXRhLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNvdW50cmllcyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X21vZGlmaWVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX29wZXJhdGlvbmFsLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlzX3B1Ymxpc2hlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdWJsaXNoZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudW5wdWJsaXNoZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl9leGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudXBkYXRlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnNvdXJjZV9maWxlc1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb2R1Y3QoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBQcm9kdWN0LnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFByb2R1Y3QuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUHJvZHVjdC5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gUHJvZHVjdDtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1J1bm5pbmdKb2InLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSwgSm9iVHlwZSkge1xuICAgICAgICB2YXIgUnVubmluZ0pvYiA9IGZ1bmN0aW9uIChjb3VudCwgbG9uZ2VzdF9ydW5uaW5nLCBqb2JfdHlwZSkge1xuICAgICAgICAgICAgdGhpcy5jb3VudCA9IGNvdW50O1xuICAgICAgICAgICAgdGhpcy5sb25nZXN0X3J1bm5pbmcgPSBsb25nZXN0X3J1bm5pbmc7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlID0gSm9iVHlwZS50cmFuc2Zvcm1lcihqb2JfdHlwZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gcHVibGljIG1ldGhvZHNcbiAgICAgICAgUnVubmluZ0pvYi5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICBnZXREdXJhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRHVyYXRpb24odGhpcy5sb25nZXN0X3J1bm5pbmcsIG1vbWVudC51dGMoKS50b0lTT1N0cmluZygpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRJY29uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbmZpZ0pvYlR5cGUgPSBfLmZpbmQoc2NhbGVDb25maWcuam9iVHlwZXMsICd0aXRsZScsIHRoaXMuam9iX3R5cGUubmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ0pvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZ0pvYlR5cGUuaWNvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlQ29uZmlnLmRlZmF1bHRJY29uO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBSdW5uaW5nSm9iLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSdW5uaW5nSm9iKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNvdW50LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxvbmdlc3RfcnVubmluZyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJ1bm5pbmdKb2IoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBSdW5uaW5nSm9iLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFJ1bm5pbmdKb2IuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUnVubmluZ0pvYi5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gUnVubmluZ0pvYjtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdTeXN0ZW1GYWlsdXJlJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBzY2FsZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIFN5c3RlbUZhaWx1cmUgPSBmdW5jdGlvbiAoY291bnQsIGpvYl90eXBlX25hbWUsIGpvYl90eXBlX3ZlcnNpb24sIGVycm9yX25hbWUsIGZpcnN0X2Vycm9yLCBsYXN0X2Vycm9yKSB7XG4gICAgICAgICAgICB0aGlzLmNvdW50ID0gY291bnQ7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlX25hbWUgPSBqb2JfdHlwZV9uYW1lO1xuICAgICAgICAgICAgdGhpcy5qb2JfdHlwZV92ZXJzaW9uID0gam9iX3R5cGVfdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JfbmFtZSA9IGVycm9yX25hbWU7XG4gICAgICAgICAgICB0aGlzLmZpcnN0X2Vycm9yID0gZmlyc3RfZXJyb3I7XG4gICAgICAgICAgICB0aGlzLmxhc3RfZXJyb3IgPSBsYXN0X2Vycm9yO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIFN5c3RlbUZhaWx1cmUucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgZ2V0RHVyYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUR1cmF0aW9uKHRoaXMuZmlyc3RfZXJyb3IsIHRoaXMubGFzdF9lcnJvcik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0SWNvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBjb25maWdKb2JUeXBlID0gXy5maW5kKHNjYWxlQ29uZmlnLmpvYlR5cGVzLCAndGl0bGUnLCB0aGlzLmpvYl90eXBlX25hbWUpO1xuICAgICAgICAgICAgICAgIGlmIChjb25maWdKb2JUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb25maWdKb2JUeXBlLmljb247XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBzY2FsZUNvbmZpZy5kZWZhdWx0SWNvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgU3lzdGVtRmFpbHVyZS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3lzdGVtRmFpbHVyZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZV9uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl90eXBlX3ZlcnNpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZXJyb3JfbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5maXJzdF9lcnJvcixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X2Vycm9yXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgU3lzdGVtRmFpbHVyZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFN5c3RlbUZhaWx1cmUudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoU3lzdGVtRmFpbHVyZS5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBTeXN0ZW1GYWlsdXJlLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBTeXN0ZW1GYWlsdXJlO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnam9iRXhlY3V0aW9uU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCwgJHEsICRyZXNvdXJjZSwgcG9sbGVyLCBzY2FsZUNvbmZpZywgSm9iRXhlY3V0aW9uLCBKb2JFeGVjdXRpb25Mb2cpIHtcblxuICAgICAgICB2YXIgZ2V0Sm9iRXhlY3V0aW9uc1BhcmFtcyA9IGZ1bmN0aW9uKCBwYWdlTnVtYmVyLCBwYWdlU2l6ZSwgZmlsdGVyICl7XG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2VOdW1iZXIsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBwYWdlU2l6ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBqb2JUeXBlSWQgPSBmaWx0ZXIuam9iX3R5cGVfaWQgPyBmaWx0ZXIuam9iVHlwZUlkIDogJyc7XG4gICAgICAgICAgICB2YXIgam9iU3RhdHVzID0gZmlsdGVyLnN0YXR1cyA/IGZpbHRlci5qb2JTdGF0dXMgOiAnJztcblxuICAgICAgICAgICAgaWYgKGpvYlN0YXR1cyAmJiBqb2JTdGF0dXMgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmpvYl9zdGF0dXMgPSBqb2JTdGF0dXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcGFyYW1zO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRKb2JFeGVjdXRpb25zOiBmdW5jdGlvbiAocGFnZU51bWJlciwgcGFnZVNpemUsIGZpbHRlcikge1xuICAgICAgICAgICAgICAgIHZhciBqb2JFeGVjdXRpb25zID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IGdldEpvYkV4ZWN1dGlvbnNQYXJhbXMocGFnZU51bWJlciwgcGFnZVNpemUsIGZpbHRlcik7XG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2pvYi1leGVjdXRpb25zLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBqb2JFeGVjdXRpb25zLmV4ZWN1dGlvbnMgPSBKb2JFeGVjdXRpb24udHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgam9iRXhlY3V0aW9ucy5jb3VudCA9IGRhdGEuY291bnQ7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShqb2JFeGVjdXRpb25zKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iRXhlY3V0aW9uRGV0YWlsczogZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2pvYi1leGVjdXRpb25zLycgKyBpZCArICcvJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoSm9iRXhlY3V0aW9uLnRyYW5zZm9ybWVyKGRhdGEpKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0TG9nT25jZTogZnVuY3Rpb24oZXhlY0lkKXtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9iLWV4ZWN1dGlvbnMvJyArIGV4ZWNJZCArICcvbG9ncy8nKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0TG9nOiBmdW5jdGlvbihleGVjSWQpe1xuICAgICAgICAgICAgICAgIHZhciB1cmwgPSB1cmwgfHwgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9iLWV4ZWN1dGlvbnMvJyArIGV4ZWNJZCArICcvbG9ncy8nO1xuXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHZpZXcuIFNpbmNlIGEgcHJvbWlzZSBjYW4gb25seSBiZSByZXNvbHZlZCBvciByZWplY3RlZCBvbmNlIGJ1dCB3ZSB3YW50XG4gICAgICAgICAgICAgICAgLy8gdG8ga2VlcCB0cmFjayBvZiBhbGwgcmVxdWVzdHMsIHBvbGxlciBzZXJ2aWNlIHVzZXMgdGhlIG5vdGlmeUNhbGxiYWNrLiBCeSBkZWZhdWx0XG4gICAgICAgICAgICAgICAgLy8gcG9sbGVyIG9ubHkgZ2V0cyBub3RpZmllZCBvZiBzdWNjZXNzIHJlc3BvbnNlcy5cbiAgICAgICAgICAgICAgICB2YXIgam9iRXhlY3V0aW9uTG9nUmVzb3VyY2UgPSAkcmVzb3VyY2UodXJsKTtcbiAgICAgICAgICAgICAgICB2YXIgam9iRXhlY3V0aW9uTG9nUG9sbGVyID0gcG9sbGVyLmdldChqb2JFeGVjdXRpb25Mb2dSZXNvdXJjZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk6IHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMuam9iRXhlY3V0aW9uTG9nXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGpvYkV4ZWN1dGlvbkxvZ1BvbGxlci5wcm9taXNlLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQuJHJlc29sdmVkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5leGVjdXRpb25fbG9nID0gSm9iRXhlY3V0aW9uTG9nLnRyYW5zZm9ybWVyKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQuZXhlY3V0aW9uX2xvZy5zdGF0dXMgPT09ICdDT01QTEVURUQnIHx8IHJlc3VsdC5leGVjdXRpb25fbG9nLnN0YXR1cyA9PT0gJ0ZBSUxFRCcpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvYkV4ZWN1dGlvbkxvZ1BvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgam9iRXhlY3V0aW9uTG9nUG9sbGVyLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnam9iU2VydmljZScsIGZ1bmN0aW9uKCRodHRwLCAkcSwgJHJlc291cmNlLCBzY2FsZUNvbmZpZywgSm9iLCBKb2JEZXRhaWxzLCBSdW5uaW5nSm9iLCBwb2xsZXIsIHBvbGxlckZhY3RvcnkpIHtcblxuICAgICAgICB2YXIgZ2V0Sm9ic1BhcmFtcyA9IGZ1bmN0aW9uIChwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkLCBvcmRlciwgc3RhdHVzLCBqb2JfdHlwZV9pZCwgam9iX3R5cGVfbmFtZSwgam9iX3R5cGVfY2F0ZWdvcnksIHVybCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLFxuICAgICAgICAgICAgICAgIHBhZ2Vfc2l6ZTogcGFnZV9zaXplLFxuICAgICAgICAgICAgICAgIHN0YXJ0ZWQ6IHN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgZW5kZWQ6IGVuZGVkLFxuICAgICAgICAgICAgICAgIG9yZGVyOiBvcmRlcixcbiAgICAgICAgICAgICAgICBzdGF0dXM6IHN0YXR1cyxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9pZDogam9iX3R5cGVfaWQsXG4gICAgICAgICAgICAgICAgam9iX3R5cGVfbmFtZTogam9iX3R5cGVfbmFtZSxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZV9jYXRlZ29yeTogam9iX3R5cGVfY2F0ZWdvcnksXG4gICAgICAgICAgICAgICAgdXJsOiB1cmxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldEpvYlVwZGF0ZURhdGEgPSBmdW5jdGlvbiAoc3RhdHVzKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN0YXR1czogc3RhdHVzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRKb2JzOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYnNQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMudXJsID0gcGFyYW1zLnVybCA/IHBhcmFtcy51cmwgOiBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdqb2JzLyc7XG5cbiAgICAgICAgICAgICAgICB2YXIgam9ic1Jlc291cmNlID0gJHJlc291cmNlKHBhcmFtcy51cmwsIHBhcmFtcyksXG4gICAgICAgICAgICAgICAgICAgIGpvYnNQb2xsZXIgPSBwb2xsZXJGYWN0b3J5Lm5ld1BvbGxlcihqb2JzUmVzb3VyY2UsIHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMuam9icyk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gam9ic1BvbGxlci5wcm9taXNlLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuJHJlc29sdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBKb2IudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvYnNQb2xsZXIuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYnNPbmNlOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldEpvYnNQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogcGFyYW1zLnVybCA/IHBhcmFtcy51cmwgOiBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdqb2JzLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBKb2IudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEpvYkNvdW50c0J5U3RhdHVzOiBmdW5jdGlvbiAoaG91cikge1xuICAgICAgICAgICAgICAgIGhvdXIgPSBob3VyIHx8IDM7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLnVybHMuZ2V0Sm9iQ291bnRzQnlTdGF0dXMoaG91cikpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JEZXRhaWw6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9icy8nICsgaWQgKyAnLycpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKEpvYkRldGFpbHMudHJhbnNmb3JtZXIoZGF0YSkpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRSdW5uaW5nSm9iczogZnVuY3Rpb24gKHBhZ2VOdW1iZXIsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZU51bWJlcjogcGFnZU51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgcGFnZVNpemU6IHBhZ2VTaXplXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB2YXIgcnVubmluZ0pvYnNSZXNvdXJjZSA9ICRyZXNvdXJjZShzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdqb2ItdHlwZXMvcnVubmluZy8nLCBwYXJhbXMpLFxuICAgICAgICAgICAgICAgICAgICBydW5uaW5nSm9ic1BvbGxlciA9IHBvbGxlckZhY3RvcnkubmV3UG9sbGVyKHJ1bm5pbmdKb2JzUmVzb3VyY2UsIHNjYWxlQ29uZmlnLnBvbGxJbnRlcnZhbHMucnVubmluZ0pvYnMpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJ1bm5pbmdKb2JzUG9sbGVyLnByb21pc2UudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IFJ1bm5pbmdKb2IudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bm5pbmdKb2JzUG9sbGVyLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRSdW5uaW5nSm9ic09uY2U6IGZ1bmN0aW9uIChwYWdlTnVtYmVyLCBwYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHBhZ2VOdW1iZXI6IHBhZ2VOdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBwYWdlU2l6ZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2pvYi10eXBlcy9ydW5uaW5nLycsIHBhcmFtcykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBSdW5uaW5nSm9iLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlSm9iOiBmdW5jdGlvbiAoaWQsIGRhdGEpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gZGF0YSB8fCBnZXRKb2JVcGRhdGVEYXRhKCk7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2pvYnMvJyArIGlkICsgJy8nLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQQVRDSCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdqb2JUeXBlU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCwgJHEsICRyZXNvdXJjZSwgcG9sbGVyLCBwb2xsZXJGYWN0b3J5LCBzY2FsZUNvbmZpZywgam9iU2VydmljZSwgSm9iVHlwZSwgSm9iVHlwZURldGFpbHMsIEpvYlR5cGVTdGF0dXMpIHtcbiAgICAgICAgLyp2YXIgdG90YWxKb2JUeXBlcyA9IDU7XG5cbiAgICAgICAgdmFyIGdldFRvdGFsSm9iVHlwZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdG90YWxKb2JUeXBlcztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgc2V0VG90YWxKb2JUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRvdGFsSm9iVHlwZXMgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMjAgLSAxICsgMSkpICsgMTtcbiAgICAgICAgfTtcblxuICAgICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZXRUb3RhbEpvYlR5cGVzKCk7XG4gICAgICAgIH0sIDMxMDApOyovXG5cbiAgICAgICAgdmFyIGdldEpvYlR5cGVTdGF0dXNQYXJhbXMgPSBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCkge1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHt9O1xuXG4gICAgICAgICAgICBpZiAocGFnZSkgeyBwYXJhbXMucGFnZSA9IHBhZ2U7IH1cbiAgICAgICAgICAgIGlmIChwYWdlX3NpemUpIHsgcGFyYW1zLnBhZ2Vfc2l6ZSA9IHBhZ2Vfc2l6ZTsgfVxuICAgICAgICAgICAgaWYgKHN0YXJ0ZWQpIHsgcGFyYW1zLnN0YXJ0ZWQgPSBzdGFydGVkOyB9XG4gICAgICAgICAgICBpZiAoZW5kZWQpIHsgcGFyYW1zLmVuZGVkID0gZW5kZWQ7IH1cblxuICAgICAgICAgICAgcmV0dXJuIHBhcmFtcztcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0Sm9iVHlwZXM6IGZ1bmN0aW9uIChvcmRlcikge1xuICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyOiBvcmRlciB8fCBbJ25hbWUnLCd2ZXJzaW9uJ11cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIGpvYlR5cGVzUmVzb3VyY2UgPSAkcmVzb3VyY2Uoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9iLXR5cGVzLycsIHBhcmFtcyksXG4gICAgICAgICAgICAgICAgICAgIGpvYlR5cGVzUG9sbGVyID0gcG9sbGVyRmFjdG9yeS5uZXdQb2xsZXIoam9iVHlwZXNSZXNvdXJjZSwgc2NhbGVDb25maWcucG9sbEludGVydmFscy5qb2JUeXBlcyk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gam9iVHlwZXNQb2xsZXIucHJvbWlzZS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLyp2YXIgcmV0dXJuUmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXNvbHZlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2JfdHlwZXM6IFtdXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBnZXRUb3RhbEpvYlR5cGVzKCk7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblJlc3VsdC5qb2JfdHlwZXMucHVzaChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpc19zeXN0ZW1cIjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicGF1c2VkXCI6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImRpc2tcIjogNjQuMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIjogaSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZG9ja2VyX2ltYWdlXCI6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFyY2hpdmVkXCI6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInVzZXNfZG9ja2VyXCI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJwcmlvcml0eVwiOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidmVyc2lvblwiOiBcIjEuMFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpY29uX2NvZGVcIjogc2NhbGVDb25maWcuam9iVHlwZXNbaSAtIDFdLmNvZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImRlc2NyaXB0aW9uXCI6IFwiSW5nZXN0cyBhIHNvdXJjZSBmaWxlIGludG8gYSB3b3Jrc3BhY2VcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibWVtXCI6IDY0LjAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlzX2FjdGl2ZVwiOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjcHVzXCI6IDEuMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGFzdF9tb2RpZmllZFwiOiBcIjIwMTUtMDMtMTFUMDA6MDA6MDBaXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm1heF90cmllc1wiOiAzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpc19wYXVzZWRcIjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogc2NhbGVDb25maWcuam9iVHlwZXNbaSAtIDFdLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVkXCI6IFwiMjAxNS0wMy0xMVQwMDowMDowMFpcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidGltZW91dFwiOiAxODAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpc19sb25nX3J1bm5pbmdcIjogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJldHVyblJlc3VsdDsqL1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBKb2JUeXBlLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvYlR5cGVzUG9sbGVyLnN0b3AoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iVHlwZXNPbmNlOiBmdW5jdGlvbiAob3JkZXIpIHtcbiAgICAgICAgICAgICAgICBvcmRlciA9IG9yZGVyIHx8IFsnbmFtZScsJ3ZlcnNpb24nXTtcblxuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdqb2ItdHlwZXMvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7IG9yZGVyOiBvcmRlciB9XG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBKb2JUeXBlLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iVHlwZVN0YXR1czogZnVuY3Rpb24gKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gZ2V0Sm9iVHlwZVN0YXR1c1BhcmFtcyhwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkKTtcblxuICAgICAgICAgICAgICAgIHZhciBqb2JUeXBlU3RhdHVzUmVzb3VyY2UgPSAkcmVzb3VyY2Uoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9iLXR5cGVzL3N0YXR1cy8nLCBwYXJhbXMpLFxuICAgICAgICAgICAgICAgICAgICBqb2JUeXBlU3RhdHVzUG9sbGVyID0gcG9sbGVyRmFjdG9yeS5uZXdQb2xsZXIoam9iVHlwZVN0YXR1c1Jlc291cmNlLCBzY2FsZUNvbmZpZy5wb2xsSW50ZXJ2YWxzLmpvYlR5cGVTdGF0dXMpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGpvYlR5cGVTdGF0dXNQb2xsZXIucHJvbWlzZS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLyp2YXIgcmV0dXJuZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVzb2x2ZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iX3R5cGVfc3RhdHM6IFtdXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBnZXRUb3RhbEpvYlR5cGVzKCk7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybmRhdGEuam9iX3R5cGVfc3RhdHMucHVzaChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiOiBpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpY29uX2NvZGVcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ2ZXJzaW9uXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm51bV9jb21wbGV0ZWRcIjogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDIwMDAwIC0gMTAwMDAgKyAxKSkgKyAxMDAwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibnVtX2NhbmNlbGVkXCI6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMDAgLSAyMCArIDEpKSArIDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJudW1fZXJyb3JfREFUQVwiOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoOTAwMCAtIDIwICsgMSkpICsgMjAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm51bV9lcnJvcl9TWVNURU1cIjogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDkwMDAgLSAyMCArIDEpKSArIDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJudW1fZXJyb3JfQUxHT1JJVEhNXCI6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg5MDAwIC0gMjAgKyAxKSkgKyAyMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHJldHVybmRhdGE7Ki9cblxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXN1bHRzID0gSm9iVHlwZVN0YXR1cy50cmFuc2Zvcm1lcihkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgam9iVHlwZVN0YXR1c1BvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Sm9iVHlwZVN0YXR1c09uY2U6IGZ1bmN0aW9uIChwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXMgPSBnZXRKb2JUeXBlU3RhdHVzUGFyYW1zKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2pvYi10eXBlcy9zdGF0dXMvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IEpvYlR5cGVTdGF0dXMudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRKb2JUeXBlRGV0YWlsczogZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgICRodHRwLmdldChzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdqb2ItdHlwZXMvJyArIGlkICsgJy8nKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShKb2JUeXBlRGV0YWlscy50cmFuc2Zvcm1lcihkYXRhKSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZUpvYlR5cGU6IGZ1bmN0aW9uIChkYXRhKXtcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlZEpvYlR5cGUgPSBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX21hcHBpbmdzOiBkYXRhLmVycm9yX21hcHBpbmdzLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNfcGF1c2VkOiBkYXRhLmlzX3BhdXNlZFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdmFyIHVwZGF0ZWREYXRhID0gdXBkYXRlZEpvYlR5cGUoZGF0YSk7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2pvYi10eXBlcy8nICsgZGF0YS5pZCArICcvJyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB1cGRhdGVkRGF0YVxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoSm9iVHlwZURldGFpbHMudHJhbnNmb3JtZXIocmVzdWx0KSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTsgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ21ldHJpY3NDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGxvY2F0aW9uLCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBuYXZTZXJ2aWNlLCBtZXRyaWNzU2VydmljZSwgbW9tZW50KSB7XG4gICAgICAgIHZhciBjaGFydCA9IG51bGwsXG4gICAgICAgICAgICBjb2xBcnIgPSBbXSxcbiAgICAgICAgICAgIGNvbE5hbWVzID0ge30sXG4gICAgICAgICAgICB4QXJyID0gW10sXG4gICAgICAgICAgICByZW1vdmVJZHMgPSBbXSxcbiAgICAgICAgICAgIHlVbml0cyA9IFtdLFxuICAgICAgICAgICAgbG9jYXRpb25QYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgY2hhcnQ6IG51bGxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZWxmID0gdGhpcztcblxuICAgICAgICAkc2NvcGUuXyA9IF87XG4gICAgICAgICRzY29wZS5tb21lbnQgPSBtb21lbnQ7XG4gICAgICAgICRzY29wZS5sb2FkaW5nTWV0cmljcyA9IGZhbHNlO1xuICAgICAgICAkc2NvcGUuY2hhcnRBcnIgPSBbXTtcbiAgICAgICAgJHNjb3BlLmNoYXJ0RGF0YSA9IFtdO1xuICAgICAgICAkc2NvcGUuY2hhcnRTdHlsZSA9ICcnO1xuICAgICAgICAkc2NvcGUuc2VsZWN0ZWREYXRhVHlwZSA9IHt9O1xuICAgICAgICAkc2NvcGUuaW5wdXRTdGFydERhdGUgPSBtb21lbnQudXRjKCkuc3VidHJhY3QoMSwgJ00nKS50b0RhdGUoKTtcbiAgICAgICAgJHNjb3BlLmlucHV0RW5kRGF0ZSA9IG1vbWVudC51dGMoKS50b0RhdGUoKTtcbiAgICAgICAgJHNjb3BlLm9wZW5JbnB1dFN0YXJ0ID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgJHNjb3BlLmlucHV0U3RhcnRPcGVuZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICAkc2NvcGUuaW5wdXRTdGFydE9wZW5lZCA9IGZhbHNlO1xuICAgICAgICAkc2NvcGUub3BlbklucHV0RW5kID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgJHNjb3BlLmlucHV0RW5kT3BlbmVkID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgJHNjb3BlLmlucHV0RW5kT3BlbmVkID0gZmFsc2U7XG4gICAgICAgICRzY29wZS5kYXRlTW9kZWxPcHRpb25zID0ge1xuICAgICAgICAgICAgdGltZXpvbmU6ICcrMDAwJ1xuICAgICAgICB9O1xuICAgICAgICAkc2NvcGUuZGF0YVR5cGVGaWx0ZXJUZXh0ID0gJyc7XG4gICAgICAgICRzY29wZS5maWx0ZXJzQXBwbGllZCA9IFtdO1xuICAgICAgICAkc2NvcGUuZmlsdGVyZWRDaG9pY2VzID0gW107XG4gICAgICAgICRzY29wZS5maWx0ZXJlZENob2ljZXNPcHRpb25zID0gW107XG4gICAgICAgICRzY29wZS5zZWxlY3RlZE1ldHJpY3MgPSBbXTtcbiAgICAgICAgJHNjb3BlLmNvbHVtbkdyb3Vwc09wdGlvbnMgPSBbXTtcbiAgICAgICAgJHNjb3BlLmNvbHVtbnMgPSBbXTtcbiAgICAgICAgJHNjb3BlLmdyb3VwcyA9IFtdO1xuICAgICAgICAkc2NvcGUuY2hhcnRUaXRsZSA9ICcnO1xuICAgICAgICAkc2NvcGUuY2hhcnREaXNwbGF5ID0gJ3N0YWNrZWQnO1xuICAgICAgICAkc2NvcGUuc3RhY2tlZENsYXNzID0gJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgJHNjb3BlLmdyb3VwZWRDbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgICRzY29wZS5zdWJjaGFydENsYXNzID0gJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgJHNjb3BlLnN1YmNoYXJ0RW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICAkc2NvcGUuY2hhcnRUeXBlID0gJ2Jhcic7XG4gICAgICAgICRzY29wZS5jaGFydFR5cGVEaXNwbGF5ID0gJ0Jhcic7XG4gICAgICAgICRzY29wZS5iYXJDbGFzcyA9ICdidG4tcHJpbWFyeSc7XG4gICAgICAgICRzY29wZS5hcmVhQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICAkc2NvcGUubGluZUNsYXNzID0gJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgJHNjb3BlLnNwbGluZUNsYXNzID0gJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgJHNjb3BlLnNjYXR0ZXJDbGFzcyA9ICdidG4tZGVmYXVsdCc7XG5cbiAgICAgICAgLypcbiAgICAgICAgLy8gY2hlY2sgZm9yIGxvY2F0aW9uUGFyYW1zIGluIHF1ZXJ5IHN0cmluZywgYW5kIHVwZGF0ZSBhcyBuZWNlc3NhcnlcbiAgICAgICAgXy5mb3JFYWNoKF8ucGFpcnMobG9jYXRpb25QYXJhbXMpLCBmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IF8uYXQoJGxvY2F0aW9uLnNlYXJjaCgpLCBwYXJhbVswXSk7XG4gICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGxvY2F0aW9uUGFyYW1zW3BhcmFtWzBdXSA9IHZhbHVlLmxlbmd0aCA+IDEgPyB2YWx1ZSA6IHZhbHVlWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAobG9jYXRpb25QYXJhbXMuY2hhcnQpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNoYXJ0QXJyID0gSlNPTi5wYXJzZShhdG9iKGxvY2F0aW9uUGFyYW1zLmNoYXJ0KSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgdG9hc3RyWydlcnJvciddKCdVbmFibGUgdG8gcGFyc2UgSlNPTicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgICovXG5cbiAgICAgICAgc2VsZi5nZXRQbG90RGF0YVBhcmFtcyA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogbnVsbCxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IG51bGwsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogb2JqLnN0YXJ0ZWQsXG4gICAgICAgICAgICAgICAgZW5kZWQ6IG9iai5lbmRlZCxcbiAgICAgICAgICAgICAgICBjaG9pY2VfaWQ6IG9iai5jaG9pY2VfaWQsXG4gICAgICAgICAgICAgICAgY29sdW1uOiBvYmouY29sdW1uLFxuICAgICAgICAgICAgICAgIGdyb3VwOiBvYmouZ3JvdXAsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6IG9iai5kYXRhVHlwZS5uYW1lXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYucmVzZXRTZWxlY3Rpb25zID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHNjb3BlLmlucHV0U3RhcnREYXRlID0gbW9tZW50LnV0YygpLnN1YnRyYWN0KDEsICdNJykudG9EYXRlKCk7XG4gICAgICAgICAgICAkc2NvcGUuaW5wdXRFbmREYXRlID0gbW9tZW50LnV0YygpLnRvRGF0ZSgpO1xuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkRGF0YVR5cGUgPSB7fTtcbiAgICAgICAgICAgICRzY29wZS5jaGFuZ2VEYXRhVHlwZVNlbGVjdGlvbigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYudXBkYXRlQ2hhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc2NvcGUuY2hhcnREYXRhID0gW107XG4gICAgICAgICAgICBpZiAoJHNjb3BlLmNoYXJ0QXJyLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIC8vIG5vdGhpbmcgdG8gc2hvdyBvbiBjaGFydFxuICAgICAgICAgICAgICAgIGNoYXJ0LmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICBjaGFydCA9IG51bGw7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBjYWxsSW5pdCA9IF8uYWZ0ZXIoJHNjb3BlLmNoYXJ0QXJyLmxlbmd0aCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IGluaXRDaGFydCBhZnRlciB0aGlzIGZ1bmN0aW9uIGhhcyBiZWVuIGNhbGxlZCBmb3IgYWxsIGRhdGFzZXRzIGluIGNoYXJ0QXJyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nTWV0cmljcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmluaXRDaGFydCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKCRzY29wZS5jaGFydEFyciwgZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gc2VsZi5nZXRQbG90RGF0YVBhcmFtcyhvYmopO1xuICAgICAgICAgICAgICAgICAgICBtZXRyaWNzU2VydmljZS5nZXRQbG90RGF0YShwYXJhbXMpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9tZXRyaWNzU2VydmljZS5nZXRHZW5lcmF0ZWRQbG90RGF0YSh7cXVlcnk6IG9iaiwgcGFyYW1zOiBwYXJhbXN9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2hhcnREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBvYmosXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0czogZGF0YS5yZXN1bHRzXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxJbml0KCk7XG4gICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmdNZXRyaWNzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgIGxvY2F0aW9uUGFyYW1zLmNoYXJ0ID0gYnRvYShKU09OLnN0cmluZ2lmeSgkc2NvcGUuY2hhcnRBcnIpKTtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKCdjaGFydCcsIGxvY2F0aW9uUGFyYW1zLmNoYXJ0KS5yZXBsYWNlKCk7XG4gICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuYWRkVG9DaGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5jaGFydEFyciA9IFtdOyAvLyBjb21tZW50IHRoaXMgb3V0IGlmIGFsbG93aW5nIG11bHRpcGxlIGFkZHNcbiAgICAgICAgICAgICRzY29wZS5sb2FkaW5nTWV0cmljcyA9IHRydWU7XG4gICAgICAgICAgICB2YXIgZmlsdGVyZWRDaG9pY2VzID0gW10sXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRDb2x1bW5zID0gW107XG4gICAgICAgICAgICAvLyBmaW5kIHRoZSBmaWx0ZXIgb2JqZWN0IGFzc29jaWF0ZWQgd2l0aCB0aGUgY2hvc2VuIGZpbHRlciBJRHNcbiAgICAgICAgICAgIF8uZm9yRWFjaCgkc2NvcGUuZmlsdGVyc0FwcGxpZWQsIGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgIGZpbHRlcmVkQ2hvaWNlcy5wdXNoKF8uZmluZCgkc2NvcGUuZmlsdGVyZWRDaG9pY2VzLCB7IGlkOiBwYXJzZUludChpZCkgfSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KCRzY29wZS5zZWxlY3RlZE1ldHJpY3MpKSB7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKCRzY29wZS5zZWxlY3RlZE1ldHJpY3MsIGZ1bmN0aW9uIChtZXRyaWMpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRDb2x1bW5zLnB1c2goXy5maW5kKCRzY29wZS5jb2x1bW5zLCB7IG5hbWU6IG1ldHJpYyB9KSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkQ29sdW1ucy5wdXNoKF8uZmluZCgkc2NvcGUuY29sdW1ucywgeyBuYW1lOiAkc2NvcGUuc2VsZWN0ZWRNZXRyaWNzIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRzY29wZS5jaGFydEFyci5wdXNoKHtcbiAgICAgICAgICAgICAgICBzdGFydGVkOiAkc2NvcGUuaW5wdXRTdGFydERhdGUudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBlbmRlZDogJHNjb3BlLmlucHV0RW5kRGF0ZS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNob2ljZV9pZDogJHNjb3BlLmZpbHRlcnNBcHBsaWVkLFxuICAgICAgICAgICAgICAgIGNvbHVtbjogXy5wbHVjayhzZWxlY3RlZENvbHVtbnMsICduYW1lJyksXG4gICAgICAgICAgICAgICAgZ3JvdXA6IG51bGwsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICRzY29wZS5zZWxlY3RlZERhdGFUeXBlLFxuICAgICAgICAgICAgICAgIGZpbHRlcnNBcHBsaWVkOiBmaWx0ZXJlZENob2ljZXMsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRNZXRyaWNzOiBzZWxlY3RlZENvbHVtbnNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc2VsZi51cGRhdGVDaGFydCgpO1xuICAgICAgICAgICAgLy9zZWxmLnJlc2V0U2VsZWN0aW9ucygpO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5kZWxldGVGcm9tQ2hhcnQgPSBmdW5jdGlvbiAob2JqVG9EZWxldGUpIHtcbiAgICAgICAgICAgIF8ucmVtb3ZlKCRzY29wZS5jaGFydEFyciwgZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShvYmopID09PSBKU09OLnN0cmluZ2lmeShvYmpUb0RlbGV0ZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNlbGYudXBkYXRlQ2hhcnQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuZ2V0RmlsdGVyT3B0aW9ucyA9IGZ1bmN0aW9uIChwYXJhbSkge1xuICAgICAgICAgICAgcmV0dXJuIF8udW5pcShfLnBsdWNrKCRzY29wZS5maWx0ZXJlZENob2ljZXMsIHBhcmFtKSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLmNoYW5nZURhdGFUeXBlU2VsZWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gcmVzZXQgb3B0aW9uc1xuICAgICAgICAgICAgJHNjb3BlLmZpbHRlcnNBcHBsaWVkID0gW107XG4gICAgICAgICAgICAvLyRzY29wZS5maWx0ZXJlZENob2ljZXMgPSBbXTtcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZERhdGFUeXBlT3B0aW9ucyA9IFtdO1xuICAgICAgICAgICAgJHNjb3BlLmRhdGFUeXBlRmlsdGVyVGV4dCA9ICcnO1xuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkTWV0cmljcyA9IFtdO1xuICAgICAgICAgICAgLy8kc2NvcGUuY29sdW1uR3JvdXBzID0gW107XG4gICAgICAgICAgICAkc2NvcGUuY29sdW1ucyA9IFtdO1xuXG4gICAgICAgICAgICBpZiAoISRzY29wZS5zZWxlY3RlZERhdGFUeXBlLm5hbWUgfHwgJHNjb3BlLnNlbGVjdGVkRGF0YVR5cGUubmFtZSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWREYXRhVHlwZSA9IHt9O1xuICAgICAgICAgICAgICAgIHNlbGYuZ2V0RGF0YVR5cGVzKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNlbGYuZ2V0RGF0YVR5cGVPcHRpb25zKCRzY29wZS5zZWxlY3RlZERhdGFUeXBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKiRzY29wZS5jaGFuZ2VGaWx0ZXJTZWxlY3Rpb24gPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2cobmFtZSArICc6ICcgKyAkc2NvcGUuZmlsdGVyc0FwcGxpZWRbbmFtZV0pO1xuICAgICAgICAgICAgLy8gcmVtb3ZlIGZpbHRlciBpZiB2YWx1ZSBpcyBudWxsIG9yIGVtcHR5XG4gICAgICAgICAgICBpZiAoISRzY29wZS5maWx0ZXJzQXBwbGllZFtuYW1lXSB8fCAkc2NvcGUuZmlsdGVyc0FwcGxpZWRbbmFtZV0gPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlICRzY29wZS5maWx0ZXJzQXBwbGllZFtuYW1lXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHVwZGF0ZSBmaWx0ZXJlZCBjaG9pY2VzXG4gICAgICAgICAgICBhcHBseUZpbHRlcnNUb0Nob2ljZXMoKTtcbiAgICAgICAgfTsqL1xuXG4gICAgICAgICRzY29wZS5hcmVGaWx0ZXJzQXBwbGllZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZmlsdGVyc0FwcGxpZWQubGVuZ3RoID4gMDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKiRzY29wZS5yZW1vdmVGaWx0ZXIgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgLy8gc2V0IHZhbHVlID0gbnVsbFxuICAgICAgICAgICAgJHNjb3BlLmZpbHRlcnNBcHBsaWVkW25hbWVdID0gJyc7XG4gICAgICAgICAgICAvLyB0cmlnZ2VyIGZpbHRlciBzZWxlY3Rpb24gY2hhbmdlXG4gICAgICAgICAgICAkc2NvcGUuY2hhbmdlRmlsdGVyU2VsZWN0aW9uKG5hbWUpO1xuICAgICAgICB9OyovXG5cbiAgICAgICAgJHNjb3BlLnVwZGF0ZUNoYXJ0RGlzcGxheSA9IGZ1bmN0aW9uIChkaXNwbGF5KSB7XG4gICAgICAgICAgICAkc2NvcGUuY2hhcnREaXNwbGF5ID0gZGlzcGxheTtcbiAgICAgICAgICAgICRzY29wZS5zdGFja2VkQ2xhc3MgPSBkaXNwbGF5ID09PSAnc3RhY2tlZCcgPyAnYnRuLXByaW1hcnknIDogJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgICAgICRzY29wZS5ncm91cGVkQ2xhc3MgPSBkaXNwbGF5ID09PSAnZ3JvdXBlZCcgPyAnYnRuLXByaW1hcnknIDogJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgICAgIHNlbGYuaW5pdENoYXJ0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnVwZGF0ZUNoYXJ0VHlwZSA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgICAgICAkc2NvcGUuY2hhcnRUeXBlID0gdHlwZTtcbiAgICAgICAgICAgICRzY29wZS5jaGFydFR5cGVEaXNwbGF5ID0gXy5jYXBpdGFsaXplKHR5cGUpO1xuICAgICAgICAgICAgJHNjb3BlLmJhckNsYXNzID0gdHlwZSA9PT0gJ2JhcicgPyAnYnRuLXByaW1hcnknIDogJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgICAgICRzY29wZS5hcmVhQ2xhc3MgPSB0eXBlID09PSAnYXJlYScgPyAnYnRuLXByaW1hcnknIDogJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgICAgICRzY29wZS5saW5lQ2xhc3MgPSB0eXBlID09PSAnbGluZScgPyAnYnRuLXByaW1hcnknIDogJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgICAgICRzY29wZS5zcGxpbmVDbGFzcyA9IHR5cGUgPT09ICdzcGxpbmUnID8gJ2J0bi1wcmltYXJ5JyA6ICdidG4tZGVmYXVsdCc7XG4gICAgICAgICAgICAkc2NvcGUuc2NhdHRlckNsYXNzID0gdHlwZSA9PT0gJ3NjYXR0ZXInID8gJ2J0bi1wcmltYXJ5JyA6ICdidG4tZGVmYXVsdCc7XG4gICAgICAgICAgICBzZWxmLmluaXRDaGFydCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS50b2dnbGVTdWJjaGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5zdWJjaGFydEVuYWJsZWQgPSAhJHNjb3BlLnN1YmNoYXJ0RW5hYmxlZDtcbiAgICAgICAgICAgIGlmICgkc2NvcGUuc3ViY2hhcnRFbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnN1YmNoYXJ0Q2xhc3MgPSAnYnRuLXByaW1hcnknO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc3ViY2hhcnRDbGFzcyA9ICdidG4tZGVmYXVsdCc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignbWV0cmljcycpO1xuICAgICAgICAgICAgc2VsZi5nZXREYXRhVHlwZXMoKTtcbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmNoYXJ0QXJyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZUNoYXJ0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAqL1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qdmFyIGFwcGx5RmlsdGVyc1RvQ2hvaWNlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjaG9pY2VzID0gJHNjb3BlLnNlbGVjdGVkRGF0YVR5cGVPcHRpb25zID8gJHNjb3BlLnNlbGVjdGVkRGF0YVR5cGVPcHRpb25zLmNob2ljZXMgOiBbXTtcbiAgICAgICAgICAgIHZhciBmaWx0ZXJlZENob2ljZXMgPSBfLndoZXJlKGNob2ljZXMsJHNjb3BlLmZpbHRlcnNBcHBsaWVkKTtcbiAgICAgICAgICAgICRzY29wZS5maWx0ZXJlZENob2ljZXMgPSBmaWx0ZXJlZENob2ljZXM7XG4gICAgICAgIH07Ki9cblxuICAgICAgICBzZWxmLmdldERhdGFUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG1ldHJpY3NTZXJ2aWNlLmdldERhdGFUeXBlcygpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5hdmFpbGFibGVEYXRhVHlwZXMgPSByZXN1bHQucmVzdWx0cztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICB0b2FzdHJbJ2Vycm9yJ10oZXJyb3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5nZXREYXRhVHlwZSA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgbWV0cmljc1NlcnZpY2UuZ2V0RGF0YVR5cGVNZXRyaWNzKGlkKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWREYXRhVHlwZUF2YWlsYWJsZU1ldHJpY3MgPSByZXN1bHQubWV0cmljcztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuZ2V0RGF0YVR5cGVPcHRpb25zID0gZnVuY3Rpb24gKGRhdGFUeXBlKSB7XG4gICAgICAgICAgICBtZXRyaWNzU2VydmljZS5nZXREYXRhVHlwZU9wdGlvbnMoZGF0YVR5cGUubmFtZSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkRGF0YVR5cGVPcHRpb25zID0gcmVzdWx0O1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChyZXN1bHQuZmlsdGVycywgZnVuY3Rpb24gKGZpbHRlcikge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YVR5cGVGaWx0ZXJUZXh0ID0gJHNjb3BlLmRhdGFUeXBlRmlsdGVyVGV4dC5sZW5ndGggPT09IDAgPyBfLmNhcGl0YWxpemUoZmlsdGVyLnBhcmFtKSA6ICRzY29wZS5kYXRhVHlwZUZpbHRlclRleHQgKyAnLCAnICsgXy5jYXBpdGFsaXplKGZpbHRlci5wYXJhbSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmZpbHRlcmVkQ2hvaWNlcyA9IF8uc29ydEJ5T3JkZXIocmVzdWx0LmNob2ljZXMsIFsndGl0bGUnLCd2ZXJzaW9uJ10sIFsnYXNjJywnYXNjJ10pO1xuICAgICAgICAgICAgICAgIC8vIGZvcm1hdCBmaWx0ZXJlZENob2ljZXMgZm9yIHVzZSB3aXRoIG11bHRpc2VsZWN0IGRpcmVjdGl2ZVxuICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJlZENob2ljZXNPcHRpb25zID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKCRzY29wZS5maWx0ZXJlZENob2ljZXMsIGZ1bmN0aW9uIChjaG9pY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRDaG9pY2VzT3B0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBjaG9pY2UudmVyc2lvbiA/IGNob2ljZS50aXRsZSArICcgJyArIGNob2ljZS52ZXJzaW9uIDogY2hvaWNlLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGNob2ljZS52ZXJzaW9uID8gY2hvaWNlLnRpdGxlICsgJyAnICsgY2hvaWNlLnZlcnNpb24gOiBjaG9pY2UudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY2hvaWNlLmlkXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXJlZENob2ljZXNPcHRpb25zID0gZmlsdGVyZWRDaG9pY2VzT3B0aW9ucztcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29sdW1ucyA9IF8uc29ydEJ5T3JkZXIocmVzdWx0LmNvbHVtbnMsIFsndGl0bGUnXSwgWydhc2MnXSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmdyb3VwcyA9IHJlc3VsdC5ncm91cHM7XG5cbiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYW4gYXJyYXkgb2Ygb2JqZWN0cyBjb250YWluaW5nIGdyb3VwZWQgY29sdW1uc1xuICAgICAgICAgICAgICAgIHZhciBjb2x1bW5Hcm91cHNPcHRpb25zID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbkdyb3VwcyA9IF8ucGFpcnMoXy5ncm91cEJ5KHJlc3VsdC5jb2x1bW5zLCAnZ3JvdXAnKSk7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKGNvbHVtbkdyb3VwcywgZnVuY3Rpb24gKGdyb3VwKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogXy5maW5kKCRzY29wZS5ncm91cHMsIHsgbmFtZTogZ3JvdXBbMF0gfSkudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW11cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGdyb3VwWzFdLCBmdW5jdGlvbiAoY29sdW1uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGNvbHVtbi50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogY29sdW1uLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBjb2x1bW4ubmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbi5jaGlsZHJlbi5wdXNoKGNoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbkdyb3Vwc09wdGlvbnMucHVzaChvcHRpb24pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbHVtbkdyb3Vwc09wdGlvbnMudW5zaGlmdCh7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnTm9uZSBTZWxlY3RlZCcsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnTm9uZSBTZWxlY3RlZCcsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICRzY29wZS5jb2x1bW5Hcm91cHNPcHRpb25zID0gY29sdW1uR3JvdXBzT3B0aW9ucztcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcil7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLmluaXRpYWxpemUoKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdpbnB1dEVuZERhdGUnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHZhbHVlKVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBzZXQgdXAgY2hhcnRcbiAgICAgICAgc2VsZi5pbml0Q2hhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBtYXJrIGFueSBleGlzdGluZyBkYXRhIGZvciByZW1vdmFsXG4gICAgICAgICAgICAvLyBjb21wYXJlIGN1cnJDb2xzIChjb2x1bW5zIGN1cnJlbnRseSBpbiB0aGUgY2hhcnQpIHdpdGggZGlzcGxheUNvbHMgKGNvbHVtbnMgdG8gZGlzcGxheSlcbiAgICAgICAgICAgIHJlbW92ZUlkcyA9IFtdO1xuICAgICAgICAgICAgdmFyIGN1cnJDb2xzID0gW10sXG4gICAgICAgICAgICAgICAgZGlzcGxheUNvbHMgPSBbXTtcbiAgICAgICAgICAgIF8uZm9yRWFjaChjb2xBcnIsIGZ1bmN0aW9uIChjb2wsIGlkeCkge1xuICAgICAgICAgICAgICAgIGlmIChpZHggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJDb2xzLnB1c2goY29sWzBdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIF8uZm9yRWFjaCgkc2NvcGUuY2hhcnREYXRhLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIGRpc3BsYXlDb2xzID0gZGlzcGxheUNvbHMuY29uY2F0KF8ucGx1Y2soZC5xdWVyeS5maWx0ZXJzQXBwbGllZCwgJ25hbWUnKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIGRldGVybWluZSB0aGUgZXhhY3QgZGlmZmVyZW5jZXMgYmV0d2VlbiBjdXJyQ29scyBhbmQgZGlzcGxheUNvbHNcbiAgICAgICAgICAgIC8vIGlmIG5vbmUgYXJlIGZvdW5kLCB0aGVuIHJlbW92ZUlkcyBzdGF5cyBlbXB0eVxuICAgICAgICAgICAgXy5mb3JFYWNoKGN1cnJDb2xzLCBmdW5jdGlvbiAoY3VyckNvbCkge1xuICAgICAgICAgICAgICAgIHZhciBkaXNwbGF5Q29sID0gXy5maW5kKGRpc3BsYXlDb2xzLCBmdW5jdGlvbiAoZENvbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZENvbCA9PT0gY3VyckNvbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoIWRpc3BsYXlDb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSWRzLnB1c2goY3VyckNvbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIGluaXQgd2l0aCBuZXcgZGF0YVxuICAgICAgICAgICAgY29sQXJyID0gW107XG4gICAgICAgICAgICB4QXJyID0gW107XG4gICAgICAgICAgICBjb2xOYW1lcyA9IHt9O1xuXG4gICAgICAgICAgICAvLyBjcmVhdGUgeEFyclxuICAgICAgICAgICAgdmFyIG51bURheXMgPSBtb21lbnQudXRjKCRzY29wZS5pbnB1dEVuZERhdGUpLmVuZE9mKCdkJykuZGlmZihtb21lbnQudXRjKCRzY29wZS5pbnB1dFN0YXJ0RGF0ZS50b0lTT1N0cmluZygpKS5zdGFydE9mKCdkJyksICdkJykgKyAxOyAvLyBhZGQgMSB0byBpbmNsdWRlIHN0YXJ0aW5nIGRheSBpbiBjb3VudFxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1EYXlzOyBpKyspIHtcbiAgICAgICAgICAgICAgICB4QXJyLnB1c2gobW9tZW50LnV0Yygkc2NvcGUuaW5wdXRTdGFydERhdGUudG9JU09TdHJpbmcoKSkuc3RhcnRPZignZCcpLmFkZChpLCAnZCcpLnRvRGF0ZSgpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIGRhdGF0eXBlcyBhbmQgYWRkIHZhbHVlcyB0byBjb2xBcnJcbiAgICAgICAgICAgIF8uZm9yRWFjaCgkc2NvcGUuY2hhcnREYXRhLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZUFyciA9IFtdLFxuICAgICAgICAgICAgICAgICAgICBxdWVyeSA9IGRhdGEucXVlcnksXG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5RmlsdGVyID0ge30sXG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5RGF0ZXMgPSBbXTtcblxuICAgICAgICAgICAgICAgIHlVbml0cyA9IF8ucGx1Y2socXVlcnkuc2VsZWN0ZWRNZXRyaWNzLCAndW5pdHMnKTtcblxuICAgICAgICAgICAgICAgIGlmIChxdWVyeS5maWx0ZXJzQXBwbGllZC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGZpbHRlcnMgd2VyZSBhcHBsaWVkLCBzbyBidWlsZCBkYXRhIHNvdXJjZSBhY2NvcmRpbmdseVxuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goZGF0YS5yZXN1bHRzLCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB2YWx1ZXMgZm9yIGFsbCBmaWx0ZXJzIGFyZSByZXR1cm5lZCBpbiBvbmUgYXJyYXkgb2YgYXJyYXlzLFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc28gZ3JvdXAgcmVzdWx0cyBieSBpZCB0byBpc29sYXRlIGZpbHRlciB2YWx1ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBncm91cGVkUmVzdWx0ID0gXy5ncm91cEJ5KHJlc3VsdC52YWx1ZXMsICdpZCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdE9iaiA9IHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcklkcyA9IF8ucGx1Y2socXVlcnkuZmlsdGVyc0FwcGxpZWQsICdpZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdHJ5IHRvIGdldCBlYWNoIGZpbHRlciBpZCBmcm9tIGdyb3VwZWRSZXN1bHQuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBpdCdzIHVuZGVmaW5lZCwgYW4gZW1wdHkgYXJyYXkgd2lsbCBiZSByZXR1cm5lZFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBhbGxvd3MgYSB6ZXJvZWQgYXJyYXkgdG8gYXBwZWFyIGluIHRoZSBjaGFydCxcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNpbmNlIHdlIHdhbnQgdG8gaW5jbHVkZSBhbGwgZmlsdGVycyBzZWxlY3RlZCBieSB0aGUgdXNlclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVnYXJkbGVzcyBvZiB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlcklkcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2hlbiBtb3JlIHRoYW4gb25lIGZpbHRlciBpcyByZXF1ZXN0ZWQsIHRoZW4gYW4gaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB2YWx1ZSBpcyBwcmVzZW50IHdpdGhpbiBkYXRhLnJlc3VsdHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goZmlsdGVySWRzLCBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0T2JqW2lkXSA9IF8uZ2V0KGdyb3VwZWRSZXN1bHQsIGlkLCBbXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gb25lIGZpbHRlciBpcyByZXF1ZXN0ZWQsIG5vIGlkIHZhbHVlIGlzIGluY2x1ZGVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW4gZGF0YS5yZXN1bHRzLCBzbyBidWlsZCByZXN1bHRPYmogd2l0aCB0aGUgb3RoZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpbmZvIHdlIGhhdmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRPYmpbcXVlcnkuY2hvaWNlX2lkWzBdXSA9IF8ucGFpcnMoZ3JvdXBlZFJlc3VsdClbMF1bMV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goXy5wYWlycyhyZXN1bHRPYmopLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlQXJyID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZFswXSB3aWxsIGJlIGNob2ljZSBpZCwgZFsxXSB3aWxsIGJlIHZhbHVlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIG9ubHkgb25lIGZpbHRlciB3YXMgc2VsZWN0ZWQsIGRbMF0gd2lsbCByZXR1cm4gYXMgc3RyaW5nICd1bmRlZmluZWQnIHNpbmNlIG5vIGlkIGlzIGluY2x1ZGVkIGluIHRoaXMgY2FzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5RmlsdGVyID0gZFswXSA9PT0gJ3VuZGVmaW5lZCcgPyBxdWVyeS5maWx0ZXJzQXBwbGllZFswXSA6IF8uZmluZChxdWVyeS5maWx0ZXJzQXBwbGllZCwgeyBpZDogcGFyc2VJbnQoZFswXSkgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlEYXRlcyA9IGRbMV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgcmVzdWx0IHZhbHVlcyB0byB2YWx1ZUFyclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh4QXJyLCBmdW5jdGlvbiAoeERhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlT2JqID0gXy5maW5kKHF1ZXJ5RGF0ZXMsIGZ1bmN0aW9uIChxRGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vbWVudC51dGMocURhdGUuZGF0ZSkuaXNTYW1lKHhEYXRlLCAnZGF5Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBwdXNoIDAgaWYgZGF0YSBmb3IgeERhdGUgaXMgbm90IHByZXNlbnQgaW4gcXVlcnlEYXRlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZUFyci5wdXNoKHZhbHVlT2JqID8gdmFsdWVPYmoudmFsdWUgOiAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByZXBlbmQgdmFsdWVBcnIgd2l0aCBmaWx0ZXIgdGl0bGUsIGFuZCBwdXNoIG9udG8gY29sQXJyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVBcnIudW5zaGlmdChxdWVyeUZpbHRlci5uYW1lICsgcXVlcnlGaWx0ZXIuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbE5hbWVzW3F1ZXJ5RmlsdGVyLm5hbWUgKyBxdWVyeUZpbHRlci5pZF0gPSBxdWVyeUZpbHRlci52ZXJzaW9uID8gcXVlcnlGaWx0ZXIudGl0bGUgKyAnICcgKyBxdWVyeUZpbHRlci52ZXJzaW9uIDogcXVlcnlGaWx0ZXIudGl0bGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sQXJyLnB1c2godmFsdWVBcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIG5vIGZpbHRlcnMgd2VyZSBhcHBsaWVkLCBzbyBzaG93IGFnZ3JlZ2F0ZSBzdGF0aXN0aWNzXG4gICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChkYXRhLnJlc3VsdHMsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZCByZXN1bHQgdmFsdWVzIHRvIHZhbHVlQXJyXG4gICAgICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goeEFyciwgZnVuY3Rpb24gKHhEYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlT2JqID0gXy5maW5kKHJlc3VsdC52YWx1ZXMsIGZ1bmN0aW9uIChxRGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50LnV0YyhxRGF0ZS5kYXRlKS5pc1NhbWUoeERhdGUsICdkYXknKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBwdXNoIDAgaWYgZGF0YSBmb3IgeERhdGUgaXMgbm90IHByZXNlbnQgaW4gcmVzdWx0LnZhbHVlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlQXJyLnB1c2godmFsdWVPYmogPyB2YWx1ZU9iai52YWx1ZSA6IDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByZXBlbmQgdmFsdWVBcnIgd2l0aCBmaWx0ZXIgdGl0bGUsIGFuZCBwdXNoIG9udG8gY29sQXJyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sdW1uTGFiZWwgPSByZXN1bHQuY29sdW1uLnRpdGxlICsgJyBmb3IgYWxsICcgKyBxdWVyeS5kYXRhVHlwZS50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlQXJyLnVuc2hpZnQoY29sdW1uTGFiZWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sTmFtZXNbJ2FnZ3JlZ2F0ZSddID0gY29sdW1uTGFiZWw7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xBcnIucHVzaCh2YWx1ZUFycik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBpbmZvcm0gdGhlIHVzZXIgaWYgdGhlIG1ldHJpY3MgdGhleSBzZWxlY3RlZCBhcmUgZW1wdHlcbiAgICAgICAgICAgIGlmIChfLnN1bShfLmZsYXR0ZW4oY29sQXJyKSkgPT09IDApIHtcbiAgICAgICAgICAgICAgICB0b2FzdHJbJ2luZm8nXSgnVGhlcmUgaXMgbm8gZGF0YSB0byBkaXNwbGF5LicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBwcmVwZW5kIHhBcnIgd2l0aCBhbiAneCcgbGFiZWwgYW5kIGFkZCB0byBjb2xBcnJcbiAgICAgICAgICAgIHhBcnIudW5zaGlmdCgneCcpO1xuICAgICAgICAgICAgY29sQXJyLnVuc2hpZnQoeEFycik7XG5cbiAgICAgICAgICAgIHZhciB0eXBlcyA9IHt9LFxuICAgICAgICAgICAgICAgIHR5cGUgPSB7fSxcbiAgICAgICAgICAgICAgICBncm91cHMgPSBbXTtcblxuICAgICAgICAgICAgXy5mb3JFYWNoKGNvbEFyciwgZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgICAgICAgIHR5cGUgPSB7fTtcbiAgICAgICAgICAgICAgICBpZiAoY29sWzBdICE9PSAneCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZVtjb2xbMF1dID0gJHNjb3BlLmNoYXJ0VHlwZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5jaGFydERpc3BsYXkgPT09ICdzdGFja2VkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzLnB1c2goY29sWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCh0eXBlcywgdHlwZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKGNoYXJ0KSB7XG4gICAgICAgICAgICAgICAgLy8gY2hhcnQgYWxyZWFkeSBleGlzdHMsIHNvIHVwZGF0ZSB2YWx1ZXNcbiAgICAgICAgICAgICAgICBjaGFydC5ncm91cHMoW2dyb3Vwc10pO1xuICAgICAgICAgICAgICAgIGNoYXJ0LmRhdGEubmFtZXMoY29sTmFtZXMpO1xuICAgICAgICAgICAgICAgIGNoYXJ0LmF4aXMubGFiZWxzKHtcbiAgICAgICAgICAgICAgICAgICAgeTogXy5jYXBpdGFsaXplKHlVbml0c1swXSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjaGFydC5sb2FkKHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uczogY29sQXJyLFxuICAgICAgICAgICAgICAgICAgICB0eXBlczogdHlwZXMsXG4gICAgICAgICAgICAgICAgICAgIHVubG9hZDogcmVtb3ZlSWRzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIG5vIGNoYXJ0IHlldCwgc28gc2V0IGl0IHVwXG4gICAgICAgICAgICAgICAgY2hhcnQgPSBjMy5nZW5lcmF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGJpbmR0bzogJyNtZXRyaWNzJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgeDogJ3gnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uczogY29sQXJyLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZXM6IHR5cGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzOiBbZ3JvdXBzXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzOiBjb2xOYW1lc1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzdWJjaGFydDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hvdzogJHNjb3BlLnN1YmNoYXJ0RW5hYmxlZFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogNzAwXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuOiBzY2FsZUNvbmZpZy5jb2xvcnMucGF0dGVybkQzMjBcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYXhpczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RpbWVzZXJpZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgeDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2s6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vbWVudC51dGMoZCkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0RhdGVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdvdXRlci1jZW50ZXInXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBfLmNhcGl0YWxpemUoeVVuaXRzWzBdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdvdXRlci1taWRkbGUnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc2V0IGNoYXJ0IGhlaWdodFxuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIHNldCBjb250YWluZXIgaGVpZ2h0cyBlcXVhbCB0byBhdmFpbGFibGUgcGFnZSBoZWlnaHRcbiAgICAgICAgICAgIHZhciB2aWV3cG9ydCA9IHNjYWxlU2VydmljZS5nZXRWaWV3cG9ydFNpemUoKSxcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBzY2FsZUNvbmZpZy5oZWFkZXJPZmZzZXQsXG4gICAgICAgICAgICAgICAgY2hhcnRNYXhIZWlnaHQgPSB2aWV3cG9ydC5oZWlnaHQgLSBvZmZzZXQ7XG5cbiAgICAgICAgICAgICRzY29wZS5jaGFydFN0eWxlID0gJ2hlaWdodDogJyArIGNoYXJ0TWF4SGVpZ2h0ICsgJ3B4OyBtYXgtaGVpZ2h0OiAnICsgY2hhcnRNYXhIZWlnaHQgKyAncHg7JztcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdtZXRyaWNzU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCwgJHEsICRyZXNvdXJjZSwgc2NhbGVDb25maWcpIHtcbiAgICAgICAgdmFyIGdldFBsb3REYXRhUGFyYW1zID0gZnVuY3Rpb24gKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQsIGNob2ljZV9pZCwgY29sdW1uLCBncm91cCwgZGF0YVR5cGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGNob2ljZV9pZCk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UsXG4gICAgICAgICAgICAgICAgcGFnZV9zaXplOiBwYWdlX3NpemUsXG4gICAgICAgICAgICAgICAgc3RhcnRlZDogc3RhcnRlZCxcbiAgICAgICAgICAgICAgICBlbmRlZDogZW5kZWQsXG4gICAgICAgICAgICAgICAgY2hvaWNlX2lkOiBjaG9pY2VfaWQsXG4gICAgICAgICAgICAgICAgY29sdW1uOiBjb2x1bW4sXG4gICAgICAgICAgICAgICAgZ3JvdXA6IGdyb3VwLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBkYXRhVHlwZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0RGF0YVR5cGVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgICRodHRwLmdldChzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdtZXRyaWNzLycpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXREYXRhVHlwZU1ldHJpY3M6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnbWV0cmljcy8nICsgaWQgKyAnLycpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXREYXRhVHlwZU9wdGlvbnM6IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdtZXRyaWNzLycgKyBuYW1lICsgJy8nO1xuICAgICAgICAgICAgICAgICRodHRwLmdldCh1cmwpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRQbG90RGF0YTogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBwYXJhbXMgfHwgZ2V0UGxvdERhdGFQYXJhbXMoKSxcbiAgICAgICAgICAgICAgICAgICAgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnbWV0cmljcy8nICsgcGFyYW1zLmRhdGFUeXBlICsgJy9wbG90LWRhdGEvJyxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRHZW5lcmF0ZWRQbG90RGF0YTogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgIHZhciByZXR1cm5PYmogPSB7XG4gICAgICAgICAgICAgICAgICAgIGNvdW50OiAyOCxcbiAgICAgICAgICAgICAgICAgICAgbmV4dDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXM6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHM6IFtdXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHZhciBudW1EYXlzID0gbW9tZW50LnV0YyhvYmoucGFyYW1zLmVuZGVkKS5kaWZmKG1vbWVudC51dGMob2JqLnBhcmFtcy5zdGFydGVkKSwgJ2QnKSArIDE7XG5cbiAgICAgICAgICAgICAgICBfLmZvckVhY2gob2JqLnF1ZXJ5LnNlbGVjdGVkTWV0cmljcywgZnVuY3Rpb24gKG1ldHJpYykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0dXJuUmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uOiBtZXRyaWMsXG4gICAgICAgICAgICAgICAgICAgICAgICBtaW5feDogbW9tZW50LnV0YyhvYmoucGFyYW1zLnN0YXJ0ZWQpLmZvcm1hdCgnWVlZWS1NTS1ERCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4X3g6IG1vbWVudC51dGMob2JqLnBhcmFtcy5lbmRlZCkuZm9ybWF0KCdZWVlZLU1NLUREJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBtaW5feTogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heF95OiAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXM6IFtdXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1EYXlzOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmoucXVlcnkuZmlsdGVyc0FwcGxpZWQubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChvYmoucXVlcnkuZmlsdGVyc0FwcGxpZWQsIGZ1bmN0aW9uIChmaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuUmVzdWx0LnZhbHVlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IG1vbWVudC51dGMob2JqLnBhcmFtcy5zdGFydGVkKS5hZGQoaSwgJ2QnKS5mb3JtYXQoJ1lZWVktTU0tREQnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwMCAtIDEgKyAxKSkgKyAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGZpbHRlci5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuUmVzdWx0LnZhbHVlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogbW9tZW50LnV0YyhvYmoucGFyYW1zLnN0YXJ0ZWQpLmFkZChpLCAnZCcpLmZvcm1hdCgnWVlZWS1NTS1ERCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDEwMDAgLSAxICsgMSkpICsgMVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybk9iai5yZXN1bHRzLnB1c2gocmV0dXJuUmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXR1cm5PYmopO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ25hdkNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgJHdpbmRvdywgc2NhbGVDb25maWcsIG5hdlNlcnZpY2UpIHtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBzY2FsZUNvbmZpZy5jb2xvcnMubmF2X2JnO1xuXG4gICAgICAgICRzY29wZS5hY3RpdmVQYWdlID0gJ292ZXJ2aWV3JztcbiAgICAgICAgJHNjb3BlLmRvY3NVcmwgPSBzY2FsZUNvbmZpZy51cmxzLmRvY3VtZW50YXRpb247XG5cbiAgICAgICAgJHNjb3BlLmdvdG8gPSBmdW5jdGlvbihsb2MpIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2goJycpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgobG9jKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgbG9jYXRpb25VcGRhdGVkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkc2NvcGUuYWN0aXZlUGFnZSA9IG5hdlNlcnZpY2UubG9jYXRpb247XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UucmVnaXN0ZXJPYnNlcnZlcihsb2NhdGlvblVwZGF0ZWQpO1xuICAgICAgICB9O1xuICAgICAgICBpbml0aWFsaXplKCk7XG5cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICAvKipcbiAgICAgKiBTZWU6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTI1NzY3OTgvYW5ndWxhcmpzLWhvdy10by13YXRjaC1zZXJ2aWNlLXZhcmlhYmxlcy8xNzU1ODg4NSMxNzU1ODg4NVxuICAgICAqIERvaW5nIHRoaW5ncyB0aGlzIHdheSBzbyB0aGF0IHNzTmF2YmFyQ29udHJvbGxlciBjYW4gZ2V0IG5vdGlmaWVkXG4gICAgICogd2hlbiB0aGUgbG9jYXRpb24gY2hhbmdlcy4gVGhlbiwgb3VyIGNvbnRyb2xsZXJzIGp1c3QgbmVlZCB0byBjYWxsIGludG9cbiAgICAgKiB0aGlzIHNlcnZpY2UgdG8gdXBkYXRlTG9jYXRpb24uXG4gICAgICpcbiAgICAgKiBUaGUgb25seSB0aGluZyBJIGRvbid0IGxpa2UgYWJvdXQgdGhpcyBpcyB0aGF0IHRoZSBpbmRpdmlkdWFsXG4gICAgICogY29udHJvbGxlcnMgaGF2ZSB0byBjYWxsIGluIGFuZCB0ZWxsIHRoZSBzc05hdmlnYXRpb25TZXJ2aWNlIHdoYXRcbiAgICAgKiBwYWdlIHRoZXkgYXJlIHNob3dpbmcuXG4gICAgICovXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnbmF2U2VydmljZScsIGZ1bmN0aW9uICgkbG9jYXRpb24pIHtcblxuICAgICAgICB0aGlzLmxvY2F0aW9uID0gJ292ZXJ2aWV3JzsgLy8gd2hlcmUgdGhlIGFwcCBzdGFydHNcblxuICAgICAgICB2YXIgb2JzZXJ2ZXJzID0gW107XG5cbiAgICAgICAgdGhpcy5yZWdpc3Rlck9ic2VydmVyID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIG9ic2VydmVycy5wdXNoKGNhbGxiYWNrKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLm5vdGlmeU9ic2VydmVycyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKG9ic2VydmVycywgZnVuY3Rpb24ob2JzZXJ2ZXIpIHtcbiAgICAgICAgICAgICAgICBvYnNlcnZlcigpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy51cGRhdGVMb2NhdGlvbiA9IGZ1bmN0aW9uKGxvY2F0aW9uSW4pIHtcbiAgICAgICAgICAgIHRoaXMubG9jYXRpb24gPSBsb2NhdGlvbkluO1xuICAgICAgICAgICAgdGhpcy5ub3RpZnlPYnNlcnZlcnMoKTtcbiAgICAgICAgfTtcblxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnc3VibmF2U2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCwgc2NhbGVDb25maWcpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRQYXRoID0gJyc7XG5cbiAgICAgICAgdGhpcy5zZXRDdXJyZW50UGF0aCA9IGZ1bmN0aW9uIChwYXRoKSB7XG4gICAgICAgICAgICBjdXJyZW50UGF0aCA9IHBhdGg7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5nZXRDdXJyZW50UGF0aCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50UGF0aDtcbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdub2RlRGV0YWlsc0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlUGFyYW1zLCAkdGltZW91dCwgbmF2U2VydmljZSwgbm9kZVNlcnZpY2UpIHtcbiAgICAgICAgJHNjb3BlLm5vZGVJZCA9ICRyb3V0ZVBhcmFtcy5pZDtcblxuICAgICAgICB2YXIgZ2V0Tm9kZURldGFpbHMgPSBmdW5jdGlvbiAobm9kZUlkKSB7XG4gICAgICAgICAgICBub2RlU2VydmljZS5nZXROb2RlKG5vZGVJZCkudGhlbiggZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUubm9kZSA9IGRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbignbm9kZXMnKTtcblxuICAgICAgICAgICAgZ2V0Tm9kZURldGFpbHMoJHNjb3BlLm5vZGVJZCk7XG4gICAgICAgICAgICBfLmRlZmVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAgIC8qJHNjb3BlLiR3YXRjaCgnbm9kZURhdGEnLCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICAkc2NvcGUucmVkcmF3R3JpZCgpO1xuICAgICAgICB9LCB0cnVlKTsqL1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignbm9kZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sICR0aW1lb3V0LCBuYXZTZXJ2aWNlLCBub2RlU2VydmljZSkge1xuICAgICAgICAkc2NvcGUubm9kZUNvdW50cyA9IFtdO1xuICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgICRzY29wZS5ob3VyVmFsdWUgPSAzO1xuICAgICAgICAkc2NvcGUubm9kZXNFcnJvciA9IG51bGw7XG4gICAgICAgICRzY29wZS5ub2Rlc0Vycm9yU3RhdHVzID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLm5vZGVTdGF0dXNFcnJvciA9IG51bGw7XG4gICAgICAgICRzY29wZS5ub2RlU3RhdHVzRXJyb3JTdGF0dXMgPSBudWxsO1xuICAgICAgICAkc2NvcGUubm9kZURhdGEgPSB7XG4gICAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICAgICAgc3RhdHVzOiBudWxsXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGRlYm91bmNlVGltZXIgPSB7fTtcblxuICAgICAgICB2YXIgZGVib3VuY2VCcm9hZGNhc3QgPSBmdW5jdGlvbiAobWVzc2FnZSwgYXJncykge1xuICAgICAgICAgICAgaWYgKGRlYm91bmNlVGltZXJbbWVzc2FnZV0pIHtcbiAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwoZGVib3VuY2VUaW1lclttZXNzYWdlXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWJvdW5jZVRpbWVyW21lc3NhZ2VdID0gJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KG1lc3NhZ2UsIGFyZ3MpO1xuICAgICAgICAgICAgfSwgNTAwKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUucmVkcmF3R3JpZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRlYm91bmNlQnJvYWRjYXN0KCdyZWRyYXdHcmlkJywgJHNjb3BlLm5vZGVEYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0Tm9kZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBub2RlU2VydmljZS5nZXROb2RlcygpLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm5vZGVzRXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubm9kZURhdGEuZGF0YSA9IGRhdGEucmVzdWx0cztcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlZHJhd0dyaWQoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXNUZXh0ICYmIGRhdGEuc3RhdHVzVGV4dCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ub2Rlc0Vycm9yU3RhdHVzID0gZGF0YS5zdGF0dXNUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5ub2Rlc0Vycm9yID0gJ1VuYWJsZSB0byByZXRyaWV2ZSBub2Rlcy4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXROb2RlU3RhdHVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbm9kZVNlcnZpY2UuZ2V0Tm9kZVN0YXR1cyhudWxsLCBudWxsLCAnUFQnICsgJHNjb3BlLmhvdXJWYWx1ZSArICdIJywgbnVsbCkudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubm9kZVN0YXR1c0Vycm9yID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm5vZGVEYXRhLnN0YXR1cyA9IGRhdGEucmVzdWx0cztcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlZHJhd0dyaWQoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXNUZXh0ICYmIGRhdGEuc3RhdHVzVGV4dCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ub2RlU3RhdHVzRXJyb3JTdGF0dXMgPSBkYXRhLnN0YXR1c1RleHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm5vZGVTdGF0dXNFcnJvciA9ICdVbmFibGUgdG8gcmV0cmlldmUgbm9kZSBzdGF0dXMuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZ2V0Tm9kZXMoKTtcbiAgICAgICAgICAgIGdldE5vZGVTdGF0dXMoKTtcbiAgICAgICAgICAgIF8uZGVmZXIoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ25vZGVzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCl7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignYWlzTm9kZUhlYWx0aENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHNjb3BlLCBub2RlU2VydmljZSkge1xuICAgICAgICAkc2NvcGUubG9hZGluZ05vZGVIZWFsdGggPSB0cnVlO1xuICAgICAgICAkc2NvcGUubm9kZUhlYWx0aEVycm9yID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLm5vZGVIZWFsdGhFcnJvclN0YXR1cyA9IG51bGw7XG4gICAgICAgICRzY29wZS5ub2RlSGVhbHRoID0ge307XG4gICAgICAgICRzY29wZS5ub2Rlc09mZmxpbmUgPSAwO1xuICAgICAgICAkc2NvcGUubm9kZXNQYXVzZWRFcnJvcnMgPSAwO1xuICAgICAgICAkc2NvcGUubm9kZXNQYXVzZWQgPSAwO1xuICAgICAgICAkc2NvcGUubm9kZXNPZmZsaW5lQW5kUGF1c2VkID0gMDtcbiAgICAgICAgJHNjb3BlLm5vZGVzT2ZmbGluZUFuZFBhdXNlZEVycm9ycyA9IDA7XG4gICAgICAgICRzY29wZS5oZWFsdGh5Tm9kZXMgPSAwO1xuICAgICAgICAkc2NvcGUudG90YWxOb2RlcyA9IDA7XG5cbiAgICAgICAgdmFyIGdldE5vZGVTdGF0dXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZ05vZGVIZWFsdGggPSB0cnVlO1xuICAgICAgICAgICAgbm9kZVNlcnZpY2UuZ2V0Tm9kZVN0YXR1cyhudWxsLCBudWxsLCAkc2NvcGUuZHVyYXRpb24sIG51bGwpLnRoZW4obnVsbCwgbnVsbCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS4kcmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRvdGFsTm9kZXMgPSBkYXRhLnJlc3VsdHMubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBub2Rlc09mZmxpbmUgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVzUGF1c2VkRXJyb3JzID0gW10sXG4gICAgICAgICAgICAgICAgICAgICAgICBub2Rlc1BhdXNlZCA9IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXNPZmZsaW5lQW5kUGF1c2VkRXJyb3JzID0gW10sXG4gICAgICAgICAgICAgICAgICAgICAgICBub2Rlc09mZmxpbmVBbmRQYXVzZWQgPSBbXTtcblxuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goZGF0YS5yZXN1bHRzLCBmdW5jdGlvbiAobikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFuLmlzX29ubGluZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vZGUgaXMgb2ZmbGluZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuLm5vZGUuaXNfcGF1c2VkX2Vycm9ycykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2Rlc09mZmxpbmVBbmRQYXVzZWRFcnJvcnMucHVzaChuKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG4ubm9kZS5pc19wYXVzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXNPZmZsaW5lQW5kUGF1c2VkLnB1c2gobik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXNPZmZsaW5lLnB1c2gobik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBub2RlIGlzIG9ubGluZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuLm5vZGUuaXNfcGF1c2VkX2Vycm9ycykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2Rlc1BhdXNlZEVycm9ycy5wdXNoKG4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobi5ub2RlLmlzX3BhdXNlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2Rlc1BhdXNlZC5wdXNoKG4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm5vZGVzT2ZmbGluZSA9IG5vZGVzT2ZmbGluZS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5ub2Rlc1BhdXNlZEVycm9ycyA9IG5vZGVzUGF1c2VkRXJyb3JzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm5vZGVzUGF1c2VkID0gbm9kZXNQYXVzZWQubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubm9kZXNPZmZsaW5lQW5kUGF1c2VkRXJyb3JzID0gbm9kZXNPZmZsaW5lQW5kUGF1c2VkRXJyb3JzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm5vZGVzT2ZmbGluZUFuZFBhdXNlZCA9IG5vZGVzT2ZmbGluZUFuZFBhdXNlZC5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHRoZSBsZW5ndGggb2Ygbm9kZXMgYm90aCBvZmZsaW5lIGFuZCBwYXVzZWQgdG8gcHJvZHVjZSBhbiBhY2N1cmF0ZSBoZWFsdGh5IGNvdW50XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5oZWFsdGh5Tm9kZXMgPSAkc2NvcGUudG90YWxOb2RlcyAtICRzY29wZS5ub2Rlc09mZmxpbmUgLSAkc2NvcGUubm9kZXNQYXVzZWRFcnJvcnMgLSAkc2NvcGUubm9kZXNQYXVzZWQgLSAkc2NvcGUubm9kZXNPZmZsaW5lQW5kUGF1c2VkIC0gJHNjb3BlLm5vZGVzT2ZmbGluZUFuZFBhdXNlZEVycm9ycztcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZG9udXREYXRhID0gW107XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIHBlcmNlbnRhZ2Ugb2YgaGVhbHRoeSBub2RlcywgYW5kIGJyZWFrZG93biBvZiB3aHkgbm9kZXMgYXJlIHVuaGVhbHRoeVxuICAgICAgICAgICAgICAgICAgICB2YXIgZ2F1Z2VEYXRhID0gJHNjb3BlLnRvdGFsTm9kZXMgPiAwID8gKCgkc2NvcGUuaGVhbHRoeU5vZGVzIC8gJHNjb3BlLnRvdGFsTm9kZXMpICogMTAwKS50b0ZpeGVkKDIpIDogMC4wMDtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm5vZGVzT2ZmbGluZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbnV0RGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdPZmZsaW5lJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogJHNjb3BlLm5vZGVzT2ZmbGluZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm5vZGVzUGF1c2VkRXJyb3JzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9udXREYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ0hpZ2ggRmFpbHVyZSBSYXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogJHNjb3BlLm5vZGVzUGF1c2VkRXJyb3JzXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUubm9kZXNQYXVzZWQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb251dERhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnUGF1c2VkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogJHNjb3BlLm5vZGVzUGF1c2VkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5ub2RlSGVhbHRoID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2F1Z2VEYXRhOiBnYXVnZURhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICBkb251dERhdGE6IGRvbnV0RGF0YVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1c1RleHQgJiYgZGF0YS5zdGF0dXNUZXh0ICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm5vZGVIZWFsdGhFcnJvclN0YXR1cyA9IGRhdGEuc3RhdHVzVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubm9kZUhlYWx0aEVycm9yID0gJ1VuYWJsZSB0byByZXRyaWV2ZSBub2RlIGhlYWx0aC4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZ05vZGVIZWFsdGggPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGdldE5vZGVTdGF0dXMoKTtcblxuICAgICAgICAkcm9vdFNjb3BlLiRvbigndXBkYXRlTm9kZUhlYWx0aCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGdldE5vZGVTdGF0dXMoKTtcbiAgICAgICAgfSk7XG4gICAgfSkuZGlyZWN0aXZlKCdhaXNOb2RlSGVhbHRoJywgZnVuY3Rpb24oKXtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVzYWdlOiA8YWlzLW5vZGUtaGVhbHRoIC8+XG4gICAgICAgICAqKi9cbiAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgY29udHJvbGxlcjogJ2Fpc05vZGVIZWFsdGhDb250cm9sbGVyJyxcbiAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvbm9kZXMvZGlyZWN0aXZlcy9ub2RlSGVhbHRoVGVtcGxhdGUuaHRtbCcsXG4gICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgICBkdXJhdGlvbjogJz0nLFxuICAgICAgICAgICAgICAgICBzaG93RGVzY3JpcHRpb246ICc9J1xuICAgICAgICAgICAgIH1cbiAgICAgICAgIH07XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnTm9kZScsIGZ1bmN0aW9uIChOb2RlUmVzb3VyY2VzLCBzY2FsZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIE5vZGUgPSBmdW5jdGlvbiAoaWQsIGhvc3RuYW1lLCBwb3J0LCBzbGF2ZV9pZCwgcGF1c2VfcmVhc29uLCBpc19wYXVzZWQsIGlzX3BhdXNlZF9lcnJvcnMsIGlzX2FjdGl2ZSwgYXJjaGl2ZWQsIGNyZWF0ZWQsIGxhc3Rfb2ZmZXIsIGxhc3RfbW9kaWZpZWQsIHJlc291cmNlcykge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5ob3N0bmFtZSA9IGhvc3RuYW1lO1xuICAgICAgICAgICAgdGhpcy5wb3J0ID0gcG9ydDtcbiAgICAgICAgICAgIHRoaXMuc2xhdmVfaWQgPSBzbGF2ZV9pZDtcbiAgICAgICAgICAgIHRoaXMucGF1c2VfcmVhc29uID0gcGF1c2VfcmVhc29uO1xuICAgICAgICAgICAgdGhpcy5pc19wYXVzZWQgPSBpc19wYXVzZWQ7XG4gICAgICAgICAgICB0aGlzLmlzX3BhdXNlZF9lcnJvcnMgPSBpc19wYXVzZWRfZXJyb3JzO1xuICAgICAgICAgICAgdGhpcy5pc19hY3RpdmUgPSBpc19hY3RpdmU7XG4gICAgICAgICAgICB0aGlzLmFyY2hpdmVkID0gYXJjaGl2ZWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X29mZmVyID0gbGFzdF9vZmZlcjtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLnJlc291cmNlcyA9IE5vZGVSZXNvdXJjZXMudHJhbnNmb3JtZXIocmVzb3VyY2VzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBtZXRob2RzXG4gICAgICAgIE5vZGUucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ05vZGUnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldER1cmF0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjYWxlU2VydmljZS5jYWxjdWxhdGVEdXJhdGlvbih0aGlzLmNyZWF0ZWQsIHRoaXMubGFzdF9tb2RpZmllZCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbFRleHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIG9ubHkgdXNlZCByZXZlYWwgPSB0cnVlIG9uIGdyaWRDaGFydCBkaXJlY3RpdmVcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ob3N0bmFtZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsVGl0bGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ob3N0bmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgTm9kZS5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTm9kZShcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5ob3N0bmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wb3J0LFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnNsYXZlX2lkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnBhdXNlX3JlYXNvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19wYXVzZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfcGF1c2VkX2Vycm9ycyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19hY3RpdmUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuYXJjaGl2ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X29mZmVyLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmxhc3RfbW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucmVzb3VyY2VzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgTm9kZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIE5vZGUudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoTm9kZS5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gTm9kZS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gTm9kZTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKXtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdOb2RlUmVzb3VyY2VzJywgZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIE5vZGVSZXNvdXJjZXMgPSBmdW5jdGlvbiAoY3B1cywgbWVtLCBkaXNrKSB7XG4gICAgICAgICAgICB0aGlzLmNwdXMgPSBjcHVzO1xuICAgICAgICAgICAgdGhpcy5tZW0gPSBtZW07XG4gICAgICAgICAgICB0aGlzLmRpc2sgPSBkaXNrO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vcHVibGljIG1ldGhvZHNcbiAgICAgICAgTm9kZVJlc291cmNlcy5wcm90b3R5cGUgPSB7XG4gICAgICAgICAgICAvLyBnZXREdXJhdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgLy9yZXR1cm4gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUR1cmF0aW9uKHRoaXMuY3JlYXRlZCwgdGhpcy5sYXN0X21vZGlmaWVkKTtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgTm9kZVJlc291cmNlcy5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTm9kZVJlc291cmNlcyhcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jcHVzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm1lbSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kaXNrXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgTm9kZVJlc291cmNlcygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIE5vZGVSZXNvdXJjZXMudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoTm9kZVJlc291cmNlcy5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBOb2RlUmVzb3VyY2VzLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBOb2RlUmVzb3VyY2VzO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5mYWN0b3J5KCdOb2RlU3RhdHVzJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBub2RlVXBkYXRlU2VydmljZSwgTm9kZSwgSm9iRXhlY3V0aW9uKSB7XG4gICAgICAgIHZhciBOb2RlU3RhdHVzID0gZnVuY3Rpb24gKG5vZGUsIGlzX29ubGluZSwgam9iX2V4ZV9jb3VudHMsIGpvYl9leGVzX3J1bm5pbmcpIHtcbiAgICAgICAgICAgIHRoaXMubm9kZSA9IE5vZGUudHJhbnNmb3JtZXIobm9kZSk7XG4gICAgICAgICAgICB0aGlzLmlzX29ubGluZSA9IGlzX29ubGluZTtcbiAgICAgICAgICAgIHRoaXMuam9iX2V4ZV9jb3VudHMgPSBqb2JfZXhlX2NvdW50cztcbiAgICAgICAgICAgIHRoaXMuam9iX2V4ZXNfcnVubmluZyA9IEpvYkV4ZWN1dGlvbi50cmFuc2Zvcm1lcihqb2JfZXhlc19ydW5uaW5nKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBtZXRob2RzXG4gICAgICAgIE5vZGVTdGF0dXMucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ05vZGVTdGF0dXMnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENvbXBsZXRlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBjb21wbGV0ZWQgPSBfLmZpbmQodGhpcy5qb2JfZXhlX2NvdW50cywgJ3N0YXR1cycsICdDT01QTEVURUQnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29tcGxldGVkID8gY29tcGxldGVkLmNvdW50IDogMDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRGYWlsZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmFpbGVkID0gXy5maW5kKHRoaXMuam9iX2V4ZV9jb3VudHMsICdzdGF0dXMnLCAnRkFJTEVEJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWxlZCA/IGZhaWxlZC5jb3VudCA6IDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbEZpbGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29sb3IgPSAnJztcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc19vbmxpbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubm9kZS5pc19wYXVzZWRfZXJyb3JzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9vcmFuZ2U7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5ub2RlLmlzX3BhdXNlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfeWVsbG93O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSBzY2FsZUNvbmZpZy5jb2xvcnMuY2hhcnRfZ3JlZW47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb2xvciA9IHNjYWxlQ29uZmlnLmNvbG9ycy5jaGFydF9yZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBjb2xvcjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsQWN0aXZpdHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbEVycm9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdGYWlsZWQ6ICcgKyB0aGlzLmdldEZhaWxlZCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldENlbGxUb3RhbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnQ29tcGxldGVkOiAnICsgdGhpcy5nZXRDb21wbGV0ZWQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRDZWxsU3RhdHVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNfb25saW5lKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm5vZGUuaXNfcGF1c2VkX2Vycm9ycykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdIaWdoIEZhaWx1cmUgUmF0ZSc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5ub2RlLmlzX3BhdXNlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdQYXVzZWQnO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdPbmxpbmUnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdPZmZsaW5lJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbEpvYnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9ICcnO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh0aGlzLmpvYl9leGVzX3J1bm5pbmcsIGZ1bmN0aW9uIChqb2JFeGVjdXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGpvYkV4ZWN1dGlvbi5qb2Iuam9iX3R5cGUuaWNvbl9jb2RlID9cbiAgICAgICAgICAgICAgICAgICAgdGV4dCArICcgJyArICcmI3gnICsgam9iRXhlY3V0aW9uLmpvYi5qb2JfdHlwZS5pY29uX2NvZGUgKyAnOycgOlxuICAgICAgICAgICAgICAgICAgICB0ZXh0ICsgJyAnICsgJyYjeCcgKyBzY2FsZUNvbmZpZy5kZWZhdWx0SWNvbkNvZGUgKyAnOyc7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Q2VsbFBhdXNlUmVzdW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubm9kZS5pc19wYXVzZWQgPyAnJiN4ZjA0YjsnIDogJyYjeGYwNGM7JztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXVzZVJlc3VtZUNlbGw6IGZ1bmN0aW9uIChwYXVzZV9yZWFzb24pIHtcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlRGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgaG9zdG5hbWU6IHRoaXMubm9kZS5ob3N0bmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcG9ydDogdGhpcy5ub2RlLnBvcnQsXG4gICAgICAgICAgICAgICAgICAgIHBhdXNlX3JlYXNvbjogcGF1c2VfcmVhc29uIHx8ICcnLFxuICAgICAgICAgICAgICAgICAgICBpc19wYXVzZWQ6ICF0aGlzLm5vZGUuaXNfcGF1c2VkXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZVVwZGF0ZVNlcnZpY2UudXBkYXRlTm9kZSh0aGlzLm5vZGUuaWQsIHVwZGF0ZURhdGEpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9kZS50cmFuc2Zvcm1lcihyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIE5vZGVTdGF0dXMuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE5vZGVTdGF0dXMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubm9kZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19vbmxpbmUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX2V4ZV9jb3VudHMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX2V4ZXNfcnVubmluZ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IE5vZGVTdGF0dXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBOb2RlU3RhdHVzLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKE5vZGVTdGF0dXMuYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE5vZGVTdGF0dXMuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIE5vZGVTdGF0dXM7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdub2RlU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCwgJHEsICRyZXNvdXJjZSwgc2NhbGVDb25maWcsIE5vZGUsIE5vZGVTdGF0dXMsIHBvbGxlciwgcG9sbGVyRmFjdG9yeSkge1xuICAgICAgICAvKnZhciB0b3RhbE5vZGVzID0gNTtcblxuICAgICAgICB2YXIgZ2V0VG90YWxOb2RlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0b3RhbE5vZGVzO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBzZXRUb3RhbE5vZGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdG90YWxOb2RlcyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgyMCAtIDEgKyAxKSkgKyAxO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNldFRvdGFsTm9kZXMoKTtcbiAgICAgICAgfSwgMzEwMCk7Ki9cblxuICAgICAgICB2YXIgZ2V0Tm9kZVN0YXR1c1BhcmFtcyA9IGZ1bmN0aW9uIChwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkKSB7XG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge307XG5cbiAgICAgICAgICAgIGlmKHBhZ2UpIHsgcGFyYW1zLnBhZ2UgPSBwYWdlOyB9XG4gICAgICAgICAgICBpZihwYWdlX3NpemUpIHsgcGFyYW1zLnBhZ2Vfc2l6ZSA9IHBhZ2Vfc2l6ZTsgfVxuICAgICAgICAgICAgaWYoc3RhcnRlZCkgeyBwYXJhbXMuc3RhcnRlZCA9IHN0YXJ0ZWQ7IH1cbiAgICAgICAgICAgIGlmKGVuZGVkKSB7IHBhcmFtcy5lbmRlZCA9IGVuZGVkOyB9XG5cbiAgICAgICAgICAgIHJldHVybiBwYXJhbXM7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldE5vZGVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5vZGVzUmVzb3VyY2UgPSAkcmVzb3VyY2Uoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnbm9kZXMvJyksXG4gICAgICAgICAgICAgICAgICAgIG5vZGVzUG9sbGVyID0gcG9sbGVyRmFjdG9yeS5uZXdQb2xsZXIobm9kZXNSZXNvdXJjZSwgc2NhbGVDb25maWcucG9sbEludGVydmFscy5ub2Rlcyk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZXNQb2xsZXIucHJvbWlzZS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLyp2YXIgcmV0dXJuUmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXNvbHZlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlczogW11cbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3RGF0YSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBnZXRUb3RhbE5vZGVzKCk7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0RhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIjogaSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJob3N0bmFtZVwiOiBcIm5vZGVcIiArIGkgKyBcIi5sb2NhbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInBvcnRcIjogNTA1MSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzbGF2ZV9pZFwiOiBcIjIwMTUwNjE2LTEwMzA1MC0xODAwNDU0NTM2LTUwNTAtNjE5My1TMlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRvdGFsX2NwdXNcIjogMi4wLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRvdGFsX21lbVwiOiA2NzkzLjAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidG90YWxfZGlza1wiOiA5NDYzOS4wLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlzX3BhdXNlZFwiOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVkXCI6IFwiMjAxNS0wNi0xNVQxNzoxODo1Mi40MTRaXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGFzdF9tb2RpZmllZFwiOiBcIjIwMTUtMDYtMTVUMTc6MTg6NTIuNDE0WlwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5SZXN1bHQubm9kZXMucHVzaChuZXdEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJldHVyblJlc3VsdDsqL1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBOb2RlLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2Rlc1BvbGxlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Tm9kZXNPbmNlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgICRodHRwLmdldChzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdub2Rlcy8nKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXR1cm5EYXRhID0gTm9kZS50cmFuc2Zvcm1lcihkYXRhLm5vZGVzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJldHVybkRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXROb2RlOiBmdW5jdGlvbiAoc2xhdmVJZCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAkaHR0cC5nZXQoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnbm9kZXMvJyArIHNsYXZlSWQgKyAnLycpLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldHVybkRhdGEgPSBOb2RlLnRyYW5zZm9ybWVyKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUocmV0dXJuRGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldE5vZGVTdGF0dXM6IGZ1bmN0aW9uIChwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IGdldE5vZGVTdGF0dXNQYXJhbXMocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgbm9kZVN0YXR1c1Jlc291cmNlID0gJHJlc291cmNlKHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ25vZGVzL3N0YXR1cy8nLCBwYXJhbXMpLFxuICAgICAgICAgICAgICAgICAgICBub2RlU3RhdHVzUG9sbGVyID0gcG9sbGVyRmFjdG9yeS5uZXdQb2xsZXIobm9kZVN0YXR1c1Jlc291cmNlLCBzY2FsZUNvbmZpZy5wb2xsSW50ZXJ2YWxzLm5vZGVTdGF0dXMpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vZGVTdGF0dXNQb2xsZXIucHJvbWlzZS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLyp2YXIgcmV0dXJuUmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXNvbHZlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlX3N0YXRzOiBbXVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdEYXRhID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdldFRvdGFsTm9kZXMoKTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3RGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJob3N0bmFtZVwiOiBcIm5vZGVcIiArIGkgKyBcIi5sb2NhbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImpvYnNfY29tcGxldGVkXCI6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxMDAgLSAyMCArIDEpKSArIDIwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN5c3RlbV9mYWlsdXJlc1wiOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMjAgLSAwICsgMSkpICsgMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiOiBpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5SZXN1bHQubm9kZV9zdGF0cy5wdXNoKG5ld0RhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcmV0dXJuUmVzdWx0OyovXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEucmVzdWx0cyA9IE5vZGVTdGF0dXMudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVTdGF0dXNQb2xsZXIuc3RvcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldE5vZGVTdGF0dXNPbmNlOiBmdW5jdGlvbiAocGFnZSwgcGFnZV9zaXplLCBzdGFydGVkLCBlbmRlZCkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gZ2V0Tm9kZVN0YXR1c1BhcmFtcyhwYWdlLCBwYWdlX3NpemUsIHN0YXJ0ZWQsIGVuZGVkKTtcbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnbm9kZXMvc3RhdHVzLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBOb2RlU3RhdHVzLnRyYW5zZm9ybWVyKGRhdGEucmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0Tm9kZURhdGE6IGZ1bmN0aW9uIChzbGF2ZUlkLCBzaW5jZSkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge30sXG4gICAgICAgICAgICAgICAgICAgIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgICAgICAgICAgc2luY2UgPSBzaW5jZSB8fCAnUFQzSCc7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXROb2RlcygpLnRoZW4oZnVuY3Rpb24gKG5vZGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEubm9kZXMgPSBub2RlcztcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0Tm9kZVN0YXR1cyhzaW5jZSkudGhlbihmdW5jdGlvbiAoc3RhdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhdHMgPSBzdGF0cztcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuc2VydmljZSgnbm9kZVVwZGF0ZVNlcnZpY2UnLCBmdW5jdGlvbiAoJGh0dHAsICRxLCBzY2FsZUNvbmZpZywgTm9kZSkge1xuICAgICAgICB2YXIgZ2V0Tm9kZVVwZGF0ZURhdGEgPSBmdW5jdGlvbiAoaG9zdG5hbWUsIHBvcnQsIHBhdXNlX3JlYXNvbiwgaXNfcGF1c2VkKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGhvc3RuYW1lOiBob3N0bmFtZSxcbiAgICAgICAgICAgICAgICBwb3J0OiBwb3J0LFxuICAgICAgICAgICAgICAgIHBhdXNlX3JlYXNvbjogcGF1c2VfcmVhc29uLFxuICAgICAgICAgICAgICAgIGlzX3BhdXNlZDogaXNfcGF1c2VkXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB1cGRhdGVOb2RlOiBmdW5jdGlvbiAoaWQsIGRhdGEpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gZGF0YSB8fCBnZXROb2RlVXBkYXRlRGF0YSgpO1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdub2Rlcy8nICsgaWQgKyAnLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BBVENIJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoTm9kZS50cmFuc2Zvcm1lcihyZXN1bHQpKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KVxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcignb3ZDb250cm9sbGVyJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHNjb3BlLCBuYXZTZXJ2aWNlLCBub2RlU2VydmljZSwgam9iU2VydmljZSwgam9iVHlwZVNlcnZpY2UsIHN0YXR1c1NlcnZpY2UsIGdhdWdlRmFjdG9yeSwgc2NhbGVDb25maWcsIHNjYWxlU2VydmljZSwgc2NoZWR1bGVyU2VydmljZSwgdXNlclNlcnZpY2UpIHtcbiAgICAgICAgJHNjb3BlLmRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAkc2NvcGUuam9iRXJyb3IgPSBudWxsO1xuICAgICAgICAkc2NvcGUuam9iRXJyb3JTdGF0dXMgPSBudWxsO1xuICAgICAgICAkc2NvcGUubG9hZGluZ0pvYnMgPSB0cnVlO1xuICAgICAgICAkc2NvcGUuam9iVHlwZXMgPSBbXTtcbiAgICAgICAgJHNjb3BlLmhvdXJWYWx1ZSA9IDM7XG4gICAgICAgICRzY29wZS5qb2JEYXRhID0ge1xuICAgICAgICAgICAgZGF0YTogbnVsbCxcbiAgICAgICAgICAgIHN0YXR1czogbnVsbFxuICAgICAgICB9O1xuICAgICAgICAkc2NvcGUuam9iRXJyb3JCcmVha2Rvd24gPSBbXTtcbiAgICAgICAgJHNjb3BlLnN0YXR1cyA9IG51bGw7XG4gICAgICAgICRzY29wZS5sb2FkaW5nU3RhdHVzID0gdHJ1ZTtcbiAgICAgICAgJHNjb3BlLnN0YXR1c0Vycm9yID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLnN0YXR1c0Vycm9yU3RhdHVzID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLm1hc3RlclN0YXR1cyA9ICcnO1xuICAgICAgICAkc2NvcGUubWFzdGVyU3RhdHVzQ2xhc3MgPSAnYWxlcnQtc3VjY2Vzcyc7XG4gICAgICAgICRzY29wZS5zY2hlZHVsZXJTdGF0dXMgPSAnJztcbiAgICAgICAgJHNjb3BlLnNjaGVkdWxlclN0YXR1c0NsYXNzID0gJ2FsZXJ0LXN1Y2Nlc3MnO1xuICAgICAgICAkc2NvcGUubWVtQ2FsYyA9ICcnO1xuICAgICAgICAkc2NvcGUuZGlza0NhbGMgPSAnJztcbiAgICAgICAgJHNjb3BlLnNjaGVkdWxlcklzUGF1c2VkID0gZmFsc2U7XG4gICAgICAgICRzY29wZS51c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckNyZWRzKCk7XG4gICAgICAgICRzY29wZS5zY2hlZHVsZXJDb250YWluZXJDbGFzcyA9ICRzY29wZS51c2VyID8gJHNjb3BlLnVzZXIuaXNfYWRtaW4gPyAnY29sLXhzLTggY29sLWxnLTEwJyA6ICdjb2wteHMtMTInIDogJ2NvbC14cy0xMic7XG4gICAgICAgICRzY29wZS5zY2hlZHVsZXJCdG5DbGFzcyA9ICdmYS1wYXVzZSc7XG5cbiAgICAgICAgJHNjb3BlLnRvZ2dsZVNjaGVkdWxlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5zY2hlZHVsZXJJc1BhdXNlZCA9ICEkc2NvcGUuc2NoZWR1bGVySXNQYXVzZWQ7XG4gICAgICAgICAgICB2YXIgc2NoZWR1bGVyRGF0YSA9IHtcbiAgICAgICAgICAgICAgICBpc19wYXVzZWQ6ICRzY29wZS5zY2hlZHVsZXJJc1BhdXNlZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHNjaGVkdWxlclNlcnZpY2UudXBkYXRlU2NoZWR1bGVyKHNjaGVkdWxlckRhdGEpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2NoZWR1bGVyU3RhdHVzID0gZGF0YS5pc19wYXVzZWQgPyAnUGF1c2VkJyA6ICdSdW5uaW5nJztcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2NoZWR1bGVyU3RhdHVzQ2xhc3MgPSBkYXRhLmlzX3BhdXNlZCA/ICdhbGVydC13YXJuaW5nJyA6ICdhbGVydC1zdWNjZXNzJztcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2NoZWR1bGVyQnRuQ2xhc3MgPSBkYXRhLmlzX3BhdXNlZCA/ICdmYS1wbGF5JyA6ICdmYS1wYXVzZSc7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgcmVkcmF3R3JpZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdyZWRyYXdHcmlkJywgJHNjb3BlLmpvYkRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRKb2JUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpvYlR5cGVTZXJ2aWNlLmdldEpvYlR5cGVzKCkudGhlbihudWxsLCBudWxsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuam9iRXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuam9iRGF0YS5kYXRhID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgICAgICByZWRyYXdHcmlkKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzVGV4dCAmJiBkYXRhLnN0YXR1c1RleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuam9iRXJyb3JTdGF0dXMgPSBkYXRhLnN0YXR1c1RleHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmpvYkVycm9yID0gJ1VuYWJsZSB0byByZXRyaWV2ZSBqb2IgdHlwZXMuJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZ0pvYnMgPSBmYWxzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFN0YXR1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBjcHVHYXVnZSA9IGdhdWdlRmFjdG9yeS5jcmVhdGVHYXVnZSgnY3B1JywgJ0NQVScsIDAsIDEwMCwgMTgwKSxcbiAgICAgICAgICAgICAgICBtZW1HYXVnZSA9IGdhdWdlRmFjdG9yeS5jcmVhdGVHYXVnZSgnbWVtb3J5JywgJ01lbW9yeScsIDAsIDEwMCwgMTgwKSxcbiAgICAgICAgICAgICAgICBkaXNrR2F1Z2UgPSBnYXVnZUZhY3RvcnkuY3JlYXRlR2F1Z2UoJ2Rpc2snLCAnRGlzaycsIDAsIDEwMCwgMTgwKTtcblxuICAgICAgICAgICAgc3RhdHVzU2VydmljZS5nZXRTdGF0dXMoKS50aGVuKG51bGwsIG51bGwsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LiRyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3RhdHVzRXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3RhdHVzID0gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICBjcHVHYXVnZS5yZWRyYXcocmVzdWx0LmdldENwdVVzYWdlKCkpO1xuICAgICAgICAgICAgICAgICAgICBtZW1HYXVnZS5yZWRyYXcocmVzdWx0LmdldE1lbVVzYWdlKCkpO1xuICAgICAgICAgICAgICAgICAgICBkaXNrR2F1Z2UucmVkcmF3KHJlc3VsdC5nZXREaXNrVXNhZ2UoKSk7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5tYXN0ZXJTdGF0dXMgPSByZXN1bHQubWFzdGVyLmlzX29ubGluZSA/ICdPbmxpbmUnIDogJ09mZmxpbmUnO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWFzdGVyU3RhdHVzQ2xhc3MgPSByZXN1bHQubWFzdGVyLmlzX29ubGluZSA/ICdhbGVydC1zdWNjZXNzJyA6ICdhbGVydC1kYW5nZXInO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnNjaGVkdWxlci5pc19vbmxpbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zY2hlZHVsZXJTdGF0dXMgPSByZXN1bHQuc2NoZWR1bGVyLmlzX3BhdXNlZCA/ICdQYXVzZWQnIDogJ1J1bm5pbmcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNjaGVkdWxlclN0YXR1c0NsYXNzID0gcmVzdWx0LnNjaGVkdWxlci5pc19wYXVzZWQgPyAnYWxlcnQtd2FybmluZycgOiAnYWxlcnQtc3VjY2Vzcyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2NoZWR1bGVySXNQYXVzZWQgPSByZXN1bHQuc2NoZWR1bGVyLmlzX3BhdXNlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zY2hlZHVsZXJCdG5DbGFzcyA9IHJlc3VsdC5zY2hlZHVsZXIuaXNfcGF1c2VkID8gJ2ZhLXBsYXknIDogJ2ZhLXBhdXNlJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zY2hlZHVsZXJTdGF0dXMgPSByZXN1bHQuc2NoZWR1bGVyLmlzX3BhdXNlZCA/ICdPZmZsaW5lOyBQYXVzZWQnIDogJ09mZmxpbmUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNjaGVkdWxlclN0YXR1c0NsYXNzID0gJ2FsZXJ0LWRhbmdlcic7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2NoZWR1bGVySXNQYXVzZWQgPSByZXN1bHQuc2NoZWR1bGVyLmlzX3BhdXNlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zY2hlZHVsZXJCdG5DbGFzcyA9IHJlc3VsdC5zY2hlZHVsZXIuaXNfcGF1c2VkID8gJ2ZhLXBsYXknIDogJ2ZhLXBhdXNlJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnJlc291cmNlcy5zY2hlZHVsZWQubWVtICYmIHJlc3VsdC5yZXNvdXJjZXMudG90YWwubWVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWVtQ2FsYyA9IHNjYWxlU2VydmljZS5jYWxjdWxhdGVGaWxlU2l6ZUZyb21NaWIocmVzdWx0LnJlc291cmNlcy5zY2hlZHVsZWQubWVtKSArICcgLyAnICsgc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUZpbGVTaXplRnJvbU1pYihyZXN1bHQucmVzb3VyY2VzLnRvdGFsLm1lbSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5yZXNvdXJjZXMuc2NoZWR1bGVkLmRpc2sgJiYgcmVzdWx0LnJlc291cmNlcy50b3RhbC5kaXNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGlza0NhbGMgPSBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tTWliKHJlc3VsdC5yZXNvdXJjZXMuc2NoZWR1bGVkLmRpc2spICsgJyAvICcgKyBzY2FsZVNlcnZpY2UuY2FsY3VsYXRlRmlsZVNpemVGcm9tTWliKHJlc3VsdC5yZXNvdXJjZXMudG90YWwuZGlzayk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1c1RleHQgJiYgcmVzdWx0LnN0YXR1c1RleHQgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3RhdHVzRXJyb3JTdGF0dXMgPSByZXN1bHQuc3RhdHVzVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3RhdHVzRXJyb3IgPSAnVW5hYmxlIHRvIHJldHJpZXZlIGNsdXN0ZXIgc3RhdHVzLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nU3RhdHVzID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkcm9vdFNjb3BlLiRvbignam9iVHlwZVN0YXR1cycsIGZ1bmN0aW9uIChldmVudCwgZGF0YSkge1xuICAgICAgICAgICAgJHNjb3BlLmpvYkRhdGEuc3RhdHVzID0gZGF0YTtcbiAgICAgICAgICAgIHJlZHJhd0dyaWQoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBnZXRKb2JUeXBlcygpO1xuICAgICAgICAgICAgZ2V0U3RhdHVzKCk7XG4gICAgICAgICAgICBuYXZTZXJ2aWNlLnVwZGF0ZUxvY2F0aW9uKCdvdmVydmlldycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbnRyb2xsZXIoJ3JlY2lwZURldGFpbHNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzY29wZSwgJGxvY2F0aW9uLCAkcm91dGVQYXJhbXMsIG5hdlNlcnZpY2UsIHJlY2lwZVNlcnZpY2UsIHNjYWxlQ29uZmlnLCBzdWJuYXZTZXJ2aWNlLCB1c2VyU2VydmljZSkge1xuXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAkc2NvcGUucmVjaXBlID0ge307XG4gICAgICAgICRzY29wZS5yZWNpcGVJZCA9ICRyb3V0ZVBhcmFtcy5pZDtcbiAgICAgICAgJHNjb3BlLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3MucmVjaXBlcztcbiAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgncmVjaXBlcycpO1xuICAgICAgICAkc2NvcGUubG9hZGluZ1JlY2lwZURldGFpbCA9IHRydWU7XG4gICAgICAgICRzY29wZS5hY3RpdmVUYWIgPSAnc3RhdHVzJztcbiAgICAgICAgJHNjb3BlLmxhc3RTdGF0dXNDaGFuZ2UgPSAnJztcblxuICAgICAgICBzZWxmLmdldFJlY2lwZURldGFpbCA9IGZ1bmN0aW9uIChyZWNpcGVJZCkge1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmdSZWNpcGVEZXRhaWwgPSB0cnVlO1xuICAgICAgICAgICAgcmVjaXBlU2VydmljZS5nZXRSZWNpcGVEZXRhaWxzKHJlY2lwZUlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZSA9IGRhdGE7XG4gICAgICAgICAgICAgICAgcmVjaXBlU2VydmljZS5nZXRSZWNpcGVUeXBlRGV0YWlsKGRhdGEucmVjaXBlX3R5cGUuaWQpLnRoZW4oZnVuY3Rpb24ocmVjaXBlVHlwZSl7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZWNpcGVUeXBlID0gcmVjaXBlVHlwZTtcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmdSZWNpcGVEZXRhaWwgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ3JlY2lwZXMnKTtcbiAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJDcmVkcygpO1xuXG4gICAgICAgICAgICBzZWxmLmdldFJlY2lwZURldGFpbCgkc2NvcGUucmVjaXBlSWQpO1xuICAgICAgICB9O1xuXG5cblxuICAgICAgICAkc2NvcGUuc3dpdGNoVGFiID0gZnVuY3Rpb24gKHRhYikge1xuICAgICAgICAgICAgJCgnIycgKyAkc2NvcGUuYWN0aXZlVGFiKS5oaWRlKCk7XG4gICAgICAgICAgICAkc2NvcGUuYWN0aXZlVGFiID0gdGFiO1xuICAgICAgICAgICAgJCgnIycgKyAkc2NvcGUuYWN0aXZlVGFiKS5zaG93KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5pbml0aWFsaXplKCk7XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcigncmVjaXBlRWRpdG9yQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGxvZywgJGxvY2F0aW9uLCAkcm91dGVQYXJhbXMsICR1aWJNb2RhbCwgbmF2U2VydmljZSwgcmVjaXBlU2VydmljZSwgUmVjaXBlVHlwZSwgc3VibmF2U2VydmljZSwgam9iVHlwZVNlcnZpY2UsIHNjYWxlQ29uZmlnKSB7XG5cbiAgICAgICAgJHNjb3BlLmRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAkc2NvcGUucmVjaXBlcyA9IG51bGw7XG4gICAgICAgICRzY29wZS5yZWNpcGVUeXBlSWQgPSBwYXJzZUludCgkcm91dGVQYXJhbXMuaWQpO1xuXG4gICAgICAgICRzY29wZS5qb2JUeXBlVmFsdWVzID0gW107XG5cbiAgICAgICAgJHNjb3BlLnN1Ym5hdkxpbmtzID0gc2NhbGVDb25maWcuc3VibmF2TGlua3MucmVjaXBlcztcbiAgICAgICAgc3VibmF2U2VydmljZS5zZXRDdXJyZW50UGF0aCgncmVjaXBlcy9idWlsZGVyJyk7XG5cbiAgICAgICAgJHNjb3BlLml0ZW1zID0gWydpdGVtMScsICdpdGVtMicsICdpdGVtMyddO1xuICAgICAgICAkc2NvcGUuYW5pbWF0aW9uc0VuYWJsZWQgPSB0cnVlO1xuICAgICAgICAkc2NvcGUuc2VsZWN0ZWQgPSBudWxsO1xuXG4gICAgICAgIHZhciBnZXRKb2JUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGpvYlR5cGVTZXJ2aWNlLmdldEpvYlR5cGVzT25jZSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuam9iVHlwZVZhbHVlcyA9IGRhdGE7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLm9wZW5BZGRKb2IgPSBmdW5jdGlvbiAoc2l6ZSkge1xuICAgICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICBhbmltYXRpb246ICRzY29wZS5hbmltYXRpb25zRW5hYmxlZCxcbiAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FkZEpvYkNvbnRlbnQuaHRtbCcsXG4gICAgICAgICAgICAgc2NvcGU6ICRzY29wZSxcbiAgICAgICAgICAgICBzaXplOiAnc20nXG4gICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICRzY29wZS5hZGRKb2JUeXBlKCRzY29wZS5zZWxlY3RlZEl0ZW0pO1xuICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgfSk7XG4gICAgICAgICB9O1xuXG4gICAgICAgICAkc2NvcGUuYWRkSm9iVHlwZSA9IGZ1bmN0aW9uKHNlbGVjdGVkSm9iVHlwZSl7XG4gICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5hZGRKb2JUeXBlKHNlbGVjdGVkSm9iVHlwZSk7XG4gICAgICAgICAgICAgJHNjb3BlLnJlZHJhd0dyYXBoKCk7XG4gICAgICAgICB9O1xuXG4gICAgICAgICAkc2NvcGUuc2VsZWN0SXRlbSA9IGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEl0ZW0gPSBpdGVtO1xuICAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZ2V0Sm9iVHlwZXMoKTtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ3JlY2lwZXMnKTtcbiAgICAgICAgICAgIGlmKCRzY29wZS5yZWNpcGVUeXBlSWQpe1xuICAgICAgICAgICAgICAgICRzY29wZS5nZXRSZWNpcGVUeXBlRGV0YWlsKCRzY29wZS5yZWNpcGVUeXBlSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVjaXBlVHlwZSA9IFJlY2lwZVR5cGUubmV3KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuZ2V0UmVjaXBlVHlwZURldGFpbCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgcmVjaXBlU2VydmljZS5nZXRSZWNpcGVUeXBlRGV0YWlsKGlkKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUgPSBkYXRhO1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucmVkcmF3R3JhcGgpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlZHJhd0dyYXBoKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnNhdmVSZWNpcGVUeXBlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUucmVjaXBlVHlwZS5uYW1lKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuaW5pdGlhbGl6ZSgpO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcigncmVjaXBlVHlwZXNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICR1aWJNb2RhbCwgaG90a2V5cywgc2NhbGVTZXJ2aWNlLCBuYXZTZXJ2aWNlLCByZWNpcGVTZXJ2aWNlLCBzdWJuYXZTZXJ2aWNlLCBqb2JUeXBlU2VydmljZSwgc2NhbGVDb25maWcsIFJlY2lwZVR5cGUsIHVzZXJTZXJ2aWNlKSB7XG4gICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgJHNjb3BlLm1hc3RlckNvbnRhaW5lclN0eWxlID0gJyc7XG4gICAgICAgICRzY29wZS5kZXRhaWxDb250YWluZXJTdHlsZSA9ICcnO1xuICAgICAgICAkc2NvcGUubWFzdGVyTWF4SGVpZ2h0ID0gMDtcbiAgICAgICAgJHNjb3BlLmRldGFpbE1heEhlaWdodCA9IDA7XG4gICAgICAgICRzY29wZS5yZWNpcGVUeXBlcyA9IFtdO1xuICAgICAgICAkc2NvcGUucmVjaXBlVHlwZUlkcyA9IFtdO1xuICAgICAgICAkc2NvcGUucmVxdWVzdGVkUmVjaXBlVHlwZUlkID0gcGFyc2VJbnQoJHJvdXRlUGFyYW1zLmlkKTtcbiAgICAgICAgJHNjb3BlLmFjdGl2ZVJlY2lwZVR5cGUgPSBudWxsO1xuICAgICAgICAkc2NvcGUucGVyY2VudGFnZSA9IDczO1xuICAgICAgICAkc2NvcGUuZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICRzY29wZS5yZWNpcGVzID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLm1vZGUgPSAndmlldyc7IC8vIHZhbGlkIHZhbHVlcyBhcmUgYWRkLCB2aWV3LCBhbmQgZWRpdFxuICAgICAgICAkc2NvcGUuYWRkQnRuVGV4dCA9ICdOZXcgUmVjaXBlJztcbiAgICAgICAgJHNjb3BlLmFkZEJ0bkNsYXNzID0gJ2J0bi1wcmltYXJ5JztcbiAgICAgICAgJHNjb3BlLmFkZEJ0bkljb24gPSAnZmEtcGx1cy1jaXJjbGUnO1xuICAgICAgICAkc2NvcGUuZWRpdEJ0blRleHQgPSAnRWRpdCc7XG4gICAgICAgICRzY29wZS5lZGl0QnRuQ2xhc3MgPSAnYnRuLXN1Y2Nlc3MnO1xuICAgICAgICAkc2NvcGUuZWRpdEJ0bkljb24gPSAnZmEtZWRpdCc7XG4gICAgICAgICRzY29wZS5qb2JUeXBlVmFsdWVzID0gW107XG4gICAgICAgICRzY29wZS5pc1JlY2lwZU1vZGlmaWVkID0gZmFsc2U7XG4gICAgICAgICRzY29wZS5zYXZlQnRuQ2xhc3MgPSAnYnRuLWRlZmF1bHQnO1xuICAgICAgICAkc2NvcGUubWFzdGVyQ2xhc3MgPSAnY29sLXhzLTMnO1xuICAgICAgICAkc2NvcGUuZGV0YWlsQ2xhc3MgPSAnY29sLXhzLTknO1xuICAgICAgICAkc2NvcGUubWluaW1pemVNYXN0ZXIgPSBmYWxzZTtcbiAgICAgICAgJHNjb3BlLm5ld0J0bkNvbnRhaW5lckNsYXNzID0gJ2hpZGRlbic7XG4gICAgICAgICRzY29wZS5taW5pbWl6ZUJ0bkNvbnRhaW5lckNsYXNzID0gJ2hpZGRlbic7XG4gICAgICAgICRzY29wZS5taW5pbWl6ZUJ0bkNsYXNzID0gJ2ZhIGZhLWNoZXZyb24tbGVmdCc7XG4gICAgICAgICRzY29wZS51c2VyID0gJHJvb3RTY29wZS51c2VyO1xuXG4gICAgICAgICRzY29wZS5zdWJuYXZMaW5rcyA9IHNjYWxlQ29uZmlnLnN1Ym5hdkxpbmtzLnJlY2lwZXM7XG4gICAgICAgIHN1Ym5hdlNlcnZpY2Uuc2V0Q3VycmVudFBhdGgoJ3JlY2lwZXMvdHlwZXMnKTtcblxuICAgICAgICB2YXIgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIG5hdlNlcnZpY2UudXBkYXRlTG9jYXRpb24oJ3JlY2lwZXMnKTtcbiAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJDcmVkcygpO1xuICAgICAgICAgICAgZ2V0UmVjaXBlVHlwZXMoKTtcbiAgICAgICAgICAgIC8vZ2V0Sm9iVHlwZXMoKTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIHZhciBnZXRSZWNpcGVUeXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJlY2lwZVNlcnZpY2UuZ2V0UmVjaXBlVHlwZXMoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGVzID0gZGF0YTtcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVjaXBlVHlwZUlkcyA9IF8ucGx1Y2soZGF0YSwgJ2lkJyk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnZpZXdSZWNpcGVUeXBlRGV0YWlsKCRzY29wZS5yZXF1ZXN0ZWRSZWNpcGVUeXBlSWQpO1xuICAgICAgICAgICAgICAgIGhvdGtleXMuYmluZFRvKCRzY29wZSlcbiAgICAgICAgICAgICAgICAgICAgLmFkZCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21ibzogJ2N0cmwrdXAnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdQcmV2aW91cyBSZWNpcGUgVHlwZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuYWN0aXZlUmVjaXBlVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gXy5pbmRleE9mKCRzY29wZS5yZWNpcGVUeXBlSWRzLCAkc2NvcGUuYWN0aXZlUmVjaXBlVHlwZS5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZHggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubG9hZFJlY2lwZVR5cGUoJHNjb3BlLnJlY2lwZVR5cGVJZHNbaWR4IC0gMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KS5hZGQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tYm86ICdjdHJsK2Rvd24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdOZXh0IFJlY2lwZSBUeXBlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5hY3RpdmVSZWNpcGVUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSBfLmluZGV4T2YoJHNjb3BlLnJlY2lwZVR5cGVJZHMsICRzY29wZS5hY3RpdmVSZWNpcGVUeXBlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA8ICgkc2NvcGUucmVjaXBlVHlwZUlkcy5sZW5ndGggLSAxKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRSZWNpcGVUeXBlKCRzY29wZS5yZWNpcGVUeXBlSWRzW2lkeCArIDFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5uZXdSZWNpcGVUeXBlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvcmVjaXBlcy90eXBlcy8wJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnZpZXdSZWNpcGVUeXBlRGV0YWlsID0gZnVuY3Rpb24ocmVjaXBlVHlwZUlkKXtcbiAgICAgICAgICAgIGlmIChyZWNpcGVUeXBlSWQgPiAwKSB7XG4gICAgICAgICAgICAgICAgcmVjaXBlU2VydmljZS5nZXRSZWNpcGVUeXBlRGV0YWlsKHJlY2lwZVR5cGVJZCkudGhlbihmdW5jdGlvbiAoZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5hY3RpdmVSZWNpcGVUeXBlID0gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiggcmVjaXBlVHlwZUlkID09PSAwKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmFjdGl2ZVJlY2lwZVR5cGUgPSBuZXcgUmVjaXBlVHlwZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5sb2FkUmVjaXBlVHlwZSA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgaWYoJHNjb3BlLmFjdGl2ZVJlY2lwZVR5cGUgJiYgJHNjb3BlLmFjdGl2ZVJlY2lwZVR5cGUubW9kaWZpZWQpe1xuICAgICAgICAgICAgICAgIGNvbmZpcm1DaGFuZ2VSZWNpcGUoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT0tcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9yZWNpcGVzL3R5cGVzLycgKyBpZCk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBDYW5jZWxcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3JlY2lwZXMvdHlwZXMvJyArIGlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgY29uZmlybUNoYW5nZVJlY2lwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogJHNjb3BlLmFuaW1hdGlvbnNFbmFibGVkLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29uZmlybURpYWxvZy5odG1sJyxcbiAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgIHNpemU6ICdzbSdcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gbW9kYWxJbnN0YW5jZS5yZXN1bHQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnRvZ2dsZU1hc3RlciA9IGZ1bmN0aW9uIChtaW5pbWl6ZU1hc3Rlcikge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBtaW5pbWl6ZU1hc3RlciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUubWluaW1pemVNYXN0ZXIgPSBtaW5pbWl6ZU1hc3RlcjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLm1pbmltaXplTWFzdGVyID0gISRzY29wZS5taW5pbWl6ZU1hc3RlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRzY29wZS5tYXN0ZXJDbGFzcyA9ICRzY29wZS5taW5pbWl6ZU1hc3RlciA/ICdjb2wteHMtMScgOiAnY29sLXhzLTMnO1xuICAgICAgICAgICAgJHNjb3BlLmRldGFpbENsYXNzID0gJHNjb3BlLm1pbmltaXplTWFzdGVyID8gJ2NvbC14cy0xMScgOiAnY29sLXhzLTknO1xuICAgICAgICAgICAgJHNjb3BlLm1pbmltaXplQnRuQ29udGFpbmVyQ2xhc3MgPSAkc2NvcGUubWluaW1pemVNYXN0ZXIgPyAnY29sLXhzLTEyJyA6ICRyb290U2NvcGUudXNlciA/ICdjb2wteHMtNiB0ZXh0LXJpZ2h0JyA6ICdjb2wteHMtMTIgdGV4dC1yaWdodCc7XG4gICAgICAgICAgICAkc2NvcGUubWluaW1pemVCdG5DbGFzcyA9ICRzY29wZS5taW5pbWl6ZU1hc3RlciA/ICdmYSBmYS1jaGV2cm9uLXJpZ2h0JyA6ICdmYSBmYS1jaGV2cm9uLWxlZnQnO1xuICAgICAgICAgICAgJHNjb3BlLm5ld0J0bkNvbnRhaW5lckNsYXNzID0gJHNjb3BlLm1pbmltaXplTWFzdGVyID8gJ2hpZGRlbicgOiAnY29sLXhzLTYnO1xuICAgICAgICB9O1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCd0b2dnbGVFZGl0JywgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XG4gICAgICAgICAgICAkc2NvcGUudG9nZ2xlTWFzdGVyKGRhdGEgPT09ICdlZGl0Jyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgICAgICAkcm9vdFNjb3BlLiRvbigncmVjaXBlTW9kaWZpZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc2NvcGUuaXNSZWNpcGVNb2RpZmllZCA9IHRydWU7XG4gICAgICAgICAgICAkc2NvcGUuc2F2ZUJ0bkNsYXNzID0gJ2J0bi1zdWNjZXNzJztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc2NvcGUubmV3QnRuQ29udGFpbmVyQ2xhc3MgPSAkcm9vdFNjb3BlLnVzZXIgPyAnY29sLXhzLTYnIDogJ2hpZGRlbic7XG4gICAgICAgICAgICAkc2NvcGUubWluaW1pemVCdG5Db250YWluZXJDbGFzcyA9ICRyb290U2NvcGUudXNlciA/ICdjb2wteHMtNiB0ZXh0LXJpZ2h0JyA6ICdjb2wteHMtMTIgdGV4dC1yaWdodCc7XG4gICAgICAgICAgICAvLyBzZXQgY29udGFpbmVyIGhlaWdodHMgZXF1YWwgdG8gYXZhaWxhYmxlIHBhZ2UgaGVpZ2h0XG4gICAgICAgICAgICB2YXIgdmlld3BvcnQgPSBzY2FsZVNlcnZpY2UuZ2V0Vmlld3BvcnRTaXplKCksXG4gICAgICAgICAgICAgICAgbWFzdGVyT2Zmc2V0ID0gc2NhbGVDb25maWcuaGVhZGVyT2Zmc2V0ICsgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnbWFzdGVyLWNvbnRyb2xzJylbMF0uc2Nyb2xsSGVpZ2h0LFxuICAgICAgICAgICAgICAgIGRldGFpbE9mZnNldCA9IHNjYWxlQ29uZmlnLmhlYWRlck9mZnNldDtcblxuICAgICAgICAgICAgJHNjb3BlLm1hc3Rlck1heEhlaWdodCA9IHZpZXdwb3J0LmhlaWdodCAtIG1hc3Rlck9mZnNldDtcbiAgICAgICAgICAgICRzY29wZS5kZXRhaWxNYXhIZWlnaHQgPSB2aWV3cG9ydC5oZWlnaHQgLSBkZXRhaWxPZmZzZXQ7XG5cbiAgICAgICAgICAgICRzY29wZS5tYXN0ZXJDb250YWluZXJTdHlsZSA9ICdoZWlnaHQ6ICcgKyAkc2NvcGUubWFzdGVyTWF4SGVpZ2h0ICsgJ3B4OyBtYXgtaGVpZ2h0OiAnICsgJHNjb3BlLm1hc3Rlck1heEhlaWdodCArICdweDsgb3ZlcmZsb3cteTogYXV0bzsnO1xuICAgICAgICAgICAgJHNjb3BlLmRldGFpbENvbnRhaW5lclN0eWxlID0gJ2hlaWdodDogJyArICRzY29wZS5kZXRhaWxNYXhIZWlnaHQgKyAncHg7IG1heC1oZWlnaHQ6ICcgKyAkc2NvcGUuZGV0YWlsTWF4SGVpZ2h0ICsgJ3B4JztcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuY29udHJvbGxlcigncmVjaXBlc0NvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHNjb3BlLCAkbG9jYXRpb24sIHNjYWxlU2VydmljZSwgbmF2U2VydmljZSwgZ3JpZEZhY3RvcnksIHVpR3JpZENvbnN0YW50cywgc2NhbGVDb25maWcsIHN1Ym5hdlNlcnZpY2UsIHJlY2lwZVNlcnZpY2UpIHtcblxuICAgICAgICB2YXIgcmVjaXBlc1BhcmFtcyA9IHtcbiAgICAgICAgICAgIHBhZ2U6IG51bGwsIHBhZ2Vfc2l6ZTogbnVsbCwgc3RhcnRlZDogbnVsbCwgZW5kZWQ6IG51bGwsIG9yZGVyOiAkcm9vdFNjb3BlLnJlY2lwZXNDb250cm9sbGVyT3JkZXIgfHwgbnVsbCwgdHlwZV9pZDogbnVsbCwgdHlwZV9uYW1lOiBudWxsLCB1cmw6IG51bGxcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBjaGVjayBmb3IgcmVjaXBlc1BhcmFtcyBpbiBxdWVyeSBzdHJpbmcsIGFuZCB1cGRhdGUgYXMgbmVjZXNzYXJ5XG4gICAgICAgIF8uZm9yRWFjaChfLnBhaXJzKHJlY2lwZXNQYXJhbXMpLCBmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IF8uYXQoJGxvY2F0aW9uLnNlYXJjaCgpLCBwYXJhbVswXSk7XG4gICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHJlY2lwZXNQYXJhbXNbcGFyYW1bMF1dID0gdmFsdWUubGVuZ3RoID4gMSA/IHZhbHVlIDogdmFsdWVbMF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBncmlkUGFnZU51bWJlciA9IHJlY2lwZXNQYXJhbXMucGFnZSB8fCAxLFxuICAgICAgICAgICAgZmlsdGVyZWRCeVJlY2lwZVR5cGUgPSByZWNpcGVzUGFyYW1zLnR5cGVfaWQgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgICAgICBmaWx0ZXJlZEJ5T3JkZXIgPSByZWNpcGVzUGFyYW1zLm9yZGVyID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgIC8vIHRoaXMgZmlsZSB3aWxsIGJlIHNpbWlsYXIgdG8gam9ic0NvbnRyb2xsZXJcbiAgICAgICAgJHNjb3BlLnJlY2lwZXNEYXRhID0ge307XG4gICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGVWYWx1ZXMgPSBbXTtcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkUmVjaXBlVHlwZSA9IHJlY2lwZXNQYXJhbXMudHlwZV9pZCB8fCAwO1xuICAgICAgICAkc2NvcGUuc3VibmF2TGlua3MgPSBzY2FsZUNvbmZpZy5zdWJuYXZMaW5rcy5yZWNpcGVzO1xuICAgICAgICAkc2NvcGUuZ3JpZFN0eWxlID0gJyc7XG4gICAgICAgICRzY29wZS5sYXN0TW9kaWZpZWRTdGFydCA9IHJlY2lwZXNQYXJhbXMuc3RhcnRlZCA/IG1vbWVudC51dGMocmVjaXBlc1BhcmFtcy5zdGFydGVkKS50b0RhdGUoKSA6IG1vbWVudC51dGMoKS5zdWJ0cmFjdCgxLCAnd2Vla3MnKS5zdGFydE9mKCdkJykudG9EYXRlKCk7XG4gICAgICAgICRzY29wZS5sYXN0TW9kaWZpZWRTdGFydFBvcHVwID0ge1xuICAgICAgICAgICAgb3BlbmVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICAkc2NvcGUub3Blbkxhc3RNb2RpZmllZFN0YXJ0UG9wdXAgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAkc2NvcGUubGFzdE1vZGlmaWVkU3RhcnRQb3B1cC5vcGVuZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICAkc2NvcGUubGFzdE1vZGlmaWVkU3RvcCA9IHJlY2lwZXNQYXJhbXMuZW5kZWQgPyBtb21lbnQudXRjKHJlY2lwZXNQYXJhbXMuZW5kZWQpLnRvRGF0ZSgpIDogbW9tZW50LnV0YygpLmVuZE9mKCdkJykudG9EYXRlKCk7XG4gICAgICAgICRzY29wZS5sYXN0TW9kaWZpZWRTdG9wUG9wdXAgPSB7XG4gICAgICAgICAgICBvcGVuZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5vcGVuTGFzdE1vZGlmaWVkU3RvcFBvcHVwID0gZnVuY3Rpb24gKCRldmVudCkge1xuICAgICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgJHNjb3BlLmxhc3RNb2RpZmllZFN0b3BQb3B1cC5vcGVuZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICAkc2NvcGUuZGF0ZU1vZGVsT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRpbWV6b25lOiAnKzAwMCdcbiAgICAgICAgfTtcblxuICAgICAgICBzdWJuYXZTZXJ2aWNlLnNldEN1cnJlbnRQYXRoKCdyZWNpcGVzJyk7XG5cbiAgICAgICAgdmFyIGRlZmF1bHRDb2x1bW5EZWZzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZpZWxkOiAncmVjaXBlX3R5cGUnLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAnUmVjaXBlIFR5cGUnLFxuICAgICAgICAgICAgICAgIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LnJlY2lwZV90eXBlLnRpdGxlIH19IHt7IHJvdy5lbnRpdHkucmVjaXBlX3R5cGUudmVyc2lvbiB9fTwvZGl2PicsXG4gICAgICAgICAgICAgICAgZmlsdGVySGVhZGVyVGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidWktZ3JpZC1maWx0ZXItY29udGFpbmVyXCI+PHNlbGVjdCBjbGFzcz1cImZvcm0tY29udHJvbCBpbnB1dC1zbVwiIG5nLW1vZGVsPVwiZ3JpZC5hcHBTY29wZS5zZWxlY3RlZFJlY2lwZVR5cGVcIj48b3B0aW9uIG5nLXNlbGVjdGVkPVwie3sgZ3JpZC5hcHBTY29wZS5yZWNpcGVUeXBlVmFsdWVzWyRpbmRleF0uaWQgPT0gZ3JpZC5hcHBTY29wZS5zZWxlY3RlZFJlY2lwZVR5cGUgfX1cIiB2YWx1ZT1cInt7IGdyaWQuYXBwU2NvcGUucmVjaXBlVHlwZVZhbHVlc1skaW5kZXhdLmlkIH19XCIgbmctcmVwZWF0PVwicmVjaXBlVHlwZSBpbiBncmlkLmFwcFNjb3BlLnJlY2lwZVR5cGVWYWx1ZXMgdHJhY2sgYnkgJGluZGV4XCI+e3sgZ3JpZC5hcHBTY29wZS5yZWNpcGVUeXBlVmFsdWVzWyRpbmRleF0udGl0bGUgfX0ge3sgZ3JpZC5hcHBTY29wZS5yZWNpcGVUeXBlVmFsdWVzWyRpbmRleF0udmVyc2lvbiB9fTwvb3B0aW9uPjwvc2VsZWN0PidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvL3sgZmllbGQ6ICdjcmVhdGVkJywgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSwgY2VsbEZpbHRlcjogJ2RhdGU6XFwneXl5eS1NTS1kZCBISDptbTpzc1xcJyd9LFxuICAgICAgICAgICAgeyBmaWVsZDogJ2NyZWF0ZWQnLCBlbmFibGVGaWx0ZXJpbmc6IGZhbHNlfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWVsZDogJ2xhc3RfbW9kaWZpZWQnLFxuICAgICAgICAgICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgLy9jZWxsRmlsdGVyOiAnZGF0ZTpcXCd5eXl5LU1NLWRkIEhIOm1tOnNzXFwnJywgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeyBmaWVsZDogJ2R1cmF0aW9uJywgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSwgZW5hYmxlU29ydGluZzogZmFsc2UsIGNlbGxUZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ1aS1ncmlkLWNlbGwtY29udGVudHNcIj57eyByb3cuZW50aXR5LmdldER1cmF0aW9uKCkgfX08L2Rpdj4nIH0sXG4gICAgICAgICAgICB7IGZpZWxkOiAnY29tcGxldGVkJywgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSwgZW5hYmxlU29ydGluZzogdHJ1ZSwgY2VsbFRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInVpLWdyaWQtY2VsbC1jb250ZW50cyBzdGF0dXMgY29tcGxldGVkXCIgbmctaWY9XCJyb3cuZW50aXR5LmNvbXBsZXRlZFwiPkNvbXBsZXRlZCB7eyByb3cuZW50aXR5Lmxhc3Rfc3RhdHVzX2NoYW5nZSB9fTwvZGl2PicgfVxuICAgICAgICBdO1xuXG4gICAgICAgICRzY29wZS5ncmlkT3B0aW9ucyA9IGdyaWRGYWN0b3J5LmRlZmF1bHRHcmlkT3B0aW9ucygpO1xuICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMucGFnaW5hdGlvbkN1cnJlbnRQYWdlID0gcGFyc2VJbnQocmVjaXBlc1BhcmFtcy5wYWdlIHx8IDEpO1xuICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplID0gcGFyc2VJbnQocmVjaXBlc1BhcmFtcy5wYWdlX3NpemUpIHx8ICRzY29wZS5ncmlkT3B0aW9ucy5wYWdpbmF0aW9uUGFnZVNpemU7XG4gICAgICAgIHZhciBjb2xEZWZzID0gJHJvb3RTY29wZS5yZWNpcGVDb2xEZWZzID8gJHJvb3RTY29wZS5yZWNpcGVDb2xEZWZzIDogZGVmYXVsdENvbHVtbkRlZnM7XG4gICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy5jb2x1bW5EZWZzID0gZ3JpZEZhY3RvcnkuYXBwbHlTb3J0Q29uZmlnKGNvbERlZnMsIHJlY2lwZXNQYXJhbXMpO1xuICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMuZGF0YSA9IFtdO1xuICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMub25SZWdpc3RlckFwaSA9IGZ1bmN0aW9uIChncmlkQXBpKSB7XG4gICAgICAgICAgICAvL3NldCBncmlkQXBpIG9uIHNjb3BlXG4gICAgICAgICAgICAkc2NvcGUuZ3JpZEFwaSA9IGdyaWRBcGk7XG4gICAgICAgICAgICAkc2NvcGUuZ3JpZEFwaS5zZWxlY3Rpb24ub24ucm93U2VsZWN0aW9uQ2hhbmdlZCgkc2NvcGUsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvcmVjaXBlcy9yZWNpcGUvJyArIHJvdy5lbnRpdHkuaWQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRzY29wZS5ncmlkQXBpLnBhZ2luYXRpb24ub24ucGFnaW5hdGlvbkNoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoY3VycmVudFBhZ2UsIHBhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgcmVjaXBlc1BhcmFtcy5wYWdlID0gY3VycmVudFBhZ2U7XG4gICAgICAgICAgICAgICAgcmVjaXBlc1BhcmFtcy5wYWdlX3NpemUgPSBwYWdlU2l6ZTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZ3JpZEFwaScpO1xuICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRzY29wZS5ncmlkQXBpLmNvcmUub24uc29ydENoYW5nZWQoJHNjb3BlLCBmdW5jdGlvbiAoZ3JpZCwgc29ydENvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnJlY2lwZUNvbERlZnMgPSBudWxsO1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCgkc2NvcGUuZ3JpZEFwaS5ncmlkLmNvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sLmNvbERlZi5zb3J0ID0gY29sLnNvcnQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5yZWNpcGVDb2xEZWZzID0gJHNjb3BlLmdyaWRBcGkuZ3JpZC5vcHRpb25zLmNvbHVtbkRlZnM7XG4gICAgICAgICAgICAgICAgdmFyIHNvcnRBcnIgPSBbXTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goc29ydENvbHVtbnMsIGZ1bmN0aW9uIChjb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgc29ydEFyci5wdXNoKGNvbC5zb3J0LmRpcmVjdGlvbiA9PT0gJ2Rlc2MnID8gJy0nICsgY29sLmZpZWxkIDogY29sLmZpZWxkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB1cGRhdGVSZWNpcGVPcmRlcihzb3J0QXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5nZXRQYWdlID0gZnVuY3Rpb24gKGZpbHRlciwgcGFnZU51bWJlciwgcGFnZVNpemUsIHVybCkge1xuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICAgICAgICAgcmVjaXBlU2VydmljZS5nZXRSZWNpcGVzKGZpbHRlciwgcGFnZU51bWJlciwgcGFnZVNpemUsIHVybCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBuZXdEYXRhID0gW107XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEucmVzdWx0c1tpXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3RGF0YS5wdXNoKGRhdGEucmVzdWx0c1tpXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLmRhdGEgPSBuZXdEYXRhO1xuICAgICAgICAgICAgICAgICRzY29wZS5ncmlkT3B0aW9ucy50b3RhbEl0ZW1zID0gZGF0YS5jb3VudDtcbiAgICAgICAgICAgICAgICAkc2NvcGUuam9ic0RhdGEgPSBkYXRhO1xuICAgICAgICAgICAgICAgIGdyaWRQYWdlTnVtYmVyID0gcGFnZU51bWJlcjtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuZmlsdGVyUmVzdWx0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF8uZm9yRWFjaChfLnBhaXJzKHJlY2lwZXNQYXJhbXMpLCBmdW5jdGlvbiAocGFyYW0pIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKHBhcmFtWzBdLCBwYXJhbVsxXSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGdldFJlY2lwZXMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0UmVjaXBlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJlY2lwZVNlcnZpY2UuZ2V0UmVjaXBlcyhyZWNpcGVzUGFyYW1zKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZXNEYXRhID0gZGF0YTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ3JpZE9wdGlvbnMudG90YWxJdGVtcyA9IGRhdGEuY291bnQ7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zLmRhdGEgPSBkYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldFJlY2lwZVR5cGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmVjaXBlU2VydmljZS5nZXRSZWNpcGVUeXBlcygpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVjaXBlVHlwZVZhbHVlcyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGVWYWx1ZXMudW5zaGlmdCh7IG5hbWU6ICdWSUVXIEFMTCcsIHRpdGxlOiAnVklFVyBBTEwnLCB2ZXJzaW9uOiAnJywgaWQ6IDAgfSk7XG4gICAgICAgICAgICAgICAgZ2V0UmVjaXBlcygpO1xuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgdXBkYXRlUmVjaXBlT3JkZXIgPSBmdW5jdGlvbiAoc29ydEFycikge1xuICAgICAgICAgICAgcmVjaXBlc1BhcmFtcy5vcmRlciA9IHNvcnRBcnIubGVuZ3RoID4gMCA/IHNvcnRBcnIgOiBudWxsO1xuICAgICAgICAgICAgZmlsdGVyZWRCeU9yZGVyID0gc29ydEFyci5sZW5ndGggPiAwO1xuICAgICAgICAgICAgJHNjb3BlLmZpbHRlclJlc3VsdHMoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgdXBkYXRlUmVjaXBlVHlwZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlICE9IHJlY2lwZXNQYXJhbXMudHlwZV9pZCkge1xuICAgICAgICAgICAgICAgIHJlY2lwZXNQYXJhbXMucGFnZSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZWNpcGVzUGFyYW1zLnR5cGVfaWQgPSB2YWx1ZSA9PSAwID8gbnVsbCA6IHZhbHVlO1xuICAgICAgICAgICAgcmVjaXBlc1BhcmFtcy5wYWdlX3NpemUgPSAkc2NvcGUuZ3JpZE9wdGlvbnMucGFnaW5hdGlvblBhZ2VTaXplO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3NlbGVjdGVkUmVjaXBlVHlwZScpO1xuICAgICAgICAgICAgaWYgKCEkc2NvcGUubG9hZGluZykge1xuICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiR3YXRjaCgnbGFzdE1vZGlmaWVkU3RhcnQnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghJHNjb3BlLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICByZWNpcGVzUGFyYW1zLnN0YXJ0ZWQgPSB2YWx1ZS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgICRzY29wZS5maWx0ZXJSZXN1bHRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ2xhc3RNb2RpZmllZFN0b3AnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICghJHNjb3BlLmxvYWRpbmcpIHtcbiAgICAgICAgICAgICAgICByZWNpcGVzUGFyYW1zLmVuZGVkID0gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVyUmVzdWx0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdzZWxlY3RlZFJlY2lwZVR5cGUnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIGlmICgkc2NvcGUubG9hZGluZykge1xuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJlZEJ5UmVjaXBlVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVSZWNpcGVUeXBlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZpbHRlcmVkQnlSZWNpcGVUeXBlID0gdmFsdWUgIT0gMDtcbiAgICAgICAgICAgICAgICB1cGRhdGVSZWNpcGVUeXBlKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mICRyb290U2NvcGUucmVjaXBlQ29sRGVmcyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAvLyByb290IGNvbHVtbiBkZWZzIGhhdmUgbm90IGJlZW4gYWx0ZXJlZCBieSB1c2VyLCBzbyBzZXQgdXAgZGVmYXVsdHNcbiAgICAgICAgICAgICAgICBpZiAoIXJlY2lwZXNQYXJhbXMub3JkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVjaXBlc1BhcmFtcy5vcmRlciA9ICctbGFzdF9tb2RpZmllZCc7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2goJ29yZGVyJywgcmVjaXBlc1BhcmFtcy5vcmRlcikucmVwbGFjZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXJlY2lwZXNQYXJhbXMucGFnZV9zaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlY2lwZXNQYXJhbXMucGFnZV9zaXplID0gJHNjb3BlLmdyaWRPcHRpb25zLnBhZ2luYXRpb25QYWdlU2l6ZTtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnNlYXJjaCgncGFnZV9zaXplJywgcmVjaXBlc1BhcmFtcy5wYWdlX3NpemUpLnJlcGxhY2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFyZWNpcGVzUGFyYW1zLnN0YXJ0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVjaXBlc1BhcmFtcy5zdGFydGVkID0gbW9tZW50LnV0Yygkc2NvcGUubGFzdE1vZGlmaWVkU3RhcnQpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5zZWFyY2goJ3N0YXJ0ZWQnLCByZWNpcGVzUGFyYW1zLnN0YXJ0ZWQpLnJlcGxhY2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFyZWNpcGVzUGFyYW1zLmVuZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlY2lwZXNQYXJhbXMuZW5kZWQgPSBtb21lbnQudXRjKCRzY29wZS5sYXN0TW9kaWZpZWRTdG9wKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24uc2VhcmNoKCdlbmRlZCcsIHJlY2lwZXNQYXJhbXMuZW5kZWQpLnJlcGxhY2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBnZXRSZWNpcGVUeXBlcygpO1xuICAgICAgICAgICAgbmF2U2VydmljZS51cGRhdGVMb2NhdGlvbigncmVjaXBlcycpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgIC8vIHNldCBjb250YWluZXIgaGVpZ2h0IGVxdWFsIHRvIGF2YWlsYWJsZSBwYWdlIGhlaWdodFxuICAgICAgICAgICAgdmFyIHZpZXdwb3J0ID0gc2NhbGVTZXJ2aWNlLmdldFZpZXdwb3J0U2l6ZSgpO1xuICAgICAgICAgICAgdmFyIG9mZnNldCA9IHNjYWxlQ29uZmlnLmhlYWRlck9mZnNldCArIHNjYWxlQ29uZmlnLmRhdGVGaWx0ZXJPZmZzZXQ7XG4gICAgICAgICAgICB2YXIgZ3JpZE1heEhlaWdodCA9IHZpZXdwb3J0LmhlaWdodCAtIG9mZnNldDtcbiAgICAgICAgICAgICRzY29wZS5ncmlkU3R5bGUgPSAnaGVpZ2h0OiAnICsgZ3JpZE1heEhlaWdodCArICdweDsgbWF4LWhlaWdodDogJyArIGdyaWRNYXhIZWlnaHQgKyAncHg7JztcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KSgpO1xuIiwiLyoqXG4gKiA8YWlzLXNjYWxlLXJlY2lwZS12aWV3ZXIgLz5cbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5jb250cm9sbGVyKCdhaXNTY2FsZVJlY2lwZUdyYXBoVmlld2VyQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRsb2NhdGlvbiwgJHVpYk1vZGFsLCBzY2FsZUNvbmZpZywgc2NhbGVTZXJ2aWNlLCBqb2JUeXBlU2VydmljZSwgcmVjaXBlU2VydmljZSwgd29ya3NwYWNlc1NlcnZpY2UpIHtcbiAgICAgICAgJHNjb3BlLnZlcnRpY2VzID0gW107XG4gICAgICAgICRzY29wZS5lZGdlcyA9IFtdO1xuICAgICAgICAkc2NvcGUuaXNVcGRhdGUgPSBmYWxzZTtcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkSm9iID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkSW5wdXRQcm92aWRlciA9IG51bGw7XG4gICAgICAgICRzY29wZS5tb2RlID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLmVkaXRNb2RlID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLmRlcGVuZGVuY3lCdG5DbGFzcyA9ICdmYS1wbHVzJztcbiAgICAgICAgJHNjb3BlLmFkZEJ0blRleHQgPSAnTmV3IFJlY2lwZSc7XG4gICAgICAgICRzY29wZS5hZGRCdG5DbGFzcyA9ICdidG4tcHJpbWFyeSc7XG4gICAgICAgICRzY29wZS5hZGRCdG5JY29uID0gJ2ZhLXBsdXMtY2lyY2xlJztcbiAgICAgICAgJHNjb3BlLmVkaXRCdG5UZXh0ID0gJ0VkaXQnO1xuICAgICAgICAkc2NvcGUuZWRpdEJ0bkNsYXNzID0gJ2J0bi1zdWNjZXNzJztcbiAgICAgICAgJHNjb3BlLmVkaXRCdG5JY29uID0gJ2ZhLWVkaXQnO1xuICAgICAgICAkc2NvcGUuam9iVHlwZVZhbHVlcyA9IFtdO1xuICAgICAgICAkc2NvcGUuc2F2ZUJ0bkNsYXNzID0gJ2J0bi1kZWZhdWx0JztcbiAgICAgICAgJHNjb3BlLnNhdmluZ1JlY2lwZSA9IGZhbHNlO1xuICAgICAgICAkc2NvcGUud2FybmluZ3MgPSBbXTtcbiAgICAgICAgJHNjb3BlLnJlYWRvbmx5ID0gdHJ1ZTtcbiAgICAgICAgJHNjb3BlLmRldGFpbE1heEhlaWdodCA9IDA7XG4gICAgICAgICRzY29wZS5yZWNpcGVUeXBlVHJpZ2dlciA9IHsgZGF0YVR5cGVzOiAnJyB9O1xuICAgICAgICAkc2NvcGUuZGV0YWlsQ29udGFpbmVyU3R5bGUgPSAnJztcbiAgICAgICAgJHNjb3BlLmNvbnRhaW5lckNsYXNzID0gJHNjb3BlLmhhc0NvbnRhaW5lciA/ICcnIDogJ2RldGFpbC1jb250YWluZXIgbm8tdGFicyc7XG4gICAgICAgICRzY29wZS5sYXN0U3RhdHVzQ2hhbmdlID0gJyc7XG4gICAgICAgICRzY29wZS5hdmFpbGFibGVXb3Jrc3BhY2VzID0gW107XG4gICAgICAgICRzY29wZS5yZWNpcGVJbnB1dFR5cGVzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdwcm9wZXJ0eScsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdQcm9wZXJ0eScsXG4gICAgICAgICAgICAgICAgZmllbGRzOiBbXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZmlsZScsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdGaWxlJyxcbiAgICAgICAgICAgICAgICBmaWVsZHM6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ21lZGlhX3R5cGVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnTWVkaWEgVHlwZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFtdXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdmaWxlcycsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdGaWxlcycsXG4gICAgICAgICAgICAgICAgZmllbGRzOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdtZWRpYV90eXBlcycsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ01lZGlhIFR5cGVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBbXVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuICAgICAgICAkc2NvcGUuYXZhaWxhYmxlVHJpZ2dlclR5cGVzID0gc2NhbGVDb25maWcudHJpZ2dlclR5cGVzO1xuICAgICAgICAkc2NvcGUuc2VsZWN0ZWRSZWNpcGVJbnB1dFR5cGUgPSB7fTtcbiAgICAgICAgJHNjb3BlLnJlY2lwZUlucHV0ID0ge1xuICAgICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIHR5cGU6ICcnXG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS5pc0lFID0gc2NhbGVTZXJ2aWNlLmlzSUUoKTtcblxuICAgICAgICB2YXIgc3RhcnRKb2IgPSBudWxsO1xuXG4gICAgICAgIC8vIERhZ3JlIHZhcmlhYmxlc1xuICAgICAgICB2YXIgc3ZnID0gbnVsbDtcbiAgICAgICAgdmFyIGlubmVyID0gbnVsbDtcbiAgICAgICAgdmFyIGdyYXBoID0gbnVsbDtcbiAgICAgICAgdmFyIHpvb20gPSBudWxsO1xuICAgICAgICB2YXIgcmVuZGVyID0gbnVsbDtcblxuXG4gICAgICAgIHZhciByZXNldEVkaXRCdG4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc2NvcGUuZWRpdEJ0blRleHQgPSAkc2NvcGUubW9kZSA9PT0gJ2VkaXQnID8gJ0NhbmNlbCBFZGl0JyA6ICdFZGl0JztcbiAgICAgICAgICAgICRzY29wZS5lZGl0QnRuQ2xhc3MgPSAkc2NvcGUubW9kZSA9PT0gJ2VkaXQnID8gJ2J0bi13YXJuaW5nJyA6ICdidG4tc3VjY2Vzcyc7XG4gICAgICAgICAgICAkc2NvcGUuZWRpdEJ0bkljb24gPSAkc2NvcGUubW9kZSA9PT0gJ2VkaXQnID8gJ2ZhLWNsb3NlJyA6ICdmYS1lZGl0JztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgcmVzZXRBZGRCdG4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc2NvcGUuYWRkQnRuVGV4dCA9ICRzY29wZS5tb2RlID09PSAnYWRkJyA/ICdDYW5jZWwnIDogJ05ldyBSZWNpcGUnO1xuICAgICAgICAgICAgJHNjb3BlLmFkZEJ0bkNsYXNzID0gJHNjb3BlLm1vZGUgPT09ICdhZGQnID8gJ2J0bi13YXJuaW5nJyA6ICdidG4tcHJpbWFyeSc7XG4gICAgICAgICAgICAkc2NvcGUuYWRkQnRuSWNvbiA9ICRzY29wZS5tb2RlID09PSAnYWRkJyA/ICdmYS1jbG9zZScgOiAnZmEtcGx1cy1jaXJjbGUnO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciB0b2dnbGVBZGRSZWNpcGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc2NvcGUubW9kZSA9ICRzY29wZS5tb2RlID09PSAnYWRkJyA/ICd2aWV3JyA6ICdhZGQnO1xuICAgICAgICAgICAgcmVzZXRBZGRCdG4oKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgdG9nZ2xlRWRpdFJlY2lwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmKCRzY29wZS5tb2RlID09PSAnZWRpdCcpe1xuICAgICAgICAgICAgICAgICRzY29wZS5tb2RlID0gJ3ZpZXcnO1xuICAgICAgICAgICAgICAgICRzY29wZS5yZWxvYWRSZWNpcGVUeXBlRGV0YWlsKCRzY29wZS5yZWNpcGVUeXBlLmlkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLm1vZGUgPSAnZWRpdCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkc2NvcGUuZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgIHJlc2V0RWRpdEJ0bigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBlbmFibGVTYXZlUmVjaXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUubW9kaWZpZWQgPSB0cnVlO1xuICAgICAgICAgICAgJHNjb3BlLnNhdmVCdG5DbGFzcyA9ICdidG4tc3VjY2Vzcyc7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGRpc2FibGVTYXZlUmVjaXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUubW9kaWZpZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICRzY29wZS5zYXZlQnRuQ2xhc3MgPSAnYnRuLWRlZmF1bHQ7J1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBjb25maXJtQ2hhbmdlUmVjaXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiAkc2NvcGUuYW5pbWF0aW9uc0VuYWJsZWQsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb25maXJtRGlhbG9nLmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXG4gICAgICAgICAgICAgICAgc2l6ZTogJ3NtJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBtb2RhbEluc3RhbmNlLnJlc3VsdDtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0UmVjaXBlVHlwZUpvYkNsYXNzTmFtZSA9IGZ1bmN0aW9uKGpvYil7XG4gICAgICAgICAgICAvLyBkZWZhdWx0IHRvICdub3N0YXR1cydcbiAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSAnbm9zdGF0dXMnO1xuICAgICAgICAgICAgLy8gZmluZCB0aGUgYXNzb2NpYXRlZCBqb2IgaW4gdGhlIHJlY2lwZS5qb2JzXG4gICAgICAgICAgICBpZigkc2NvcGUucmVjaXBlKXtcbiAgICAgICAgICAgICAgICB2YXIgcmVjaXBlam9iID0gXy5maW5kKCRzY29wZS5yZWNpcGUuam9icyx7am9iX25hbWU6IGpvYi5uYW1lfSk7XG4gICAgICAgICAgICAgICAgaWYocmVjaXBlam9iKXtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gcmVjaXBlam9iLmpvYi5zdGF0dXMudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY2xhc3NOYW1lO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5yZWxvYWRSZWNpcGVUeXBlRGV0YWlsID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICB2YXIgZ2V0UmVjaXBlRGV0YWlsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJlY2lwZVNlcnZpY2UuZ2V0UmVjaXBlVHlwZURldGFpbChpZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVjaXBlVHlwZSA9IGRhdGE7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICgkc2NvcGUucmVjaXBlVHlwZS5tb2RpZmllZCkge1xuICAgICAgICAgICAgICAgIGNvbmZpcm1DaGFuZ2VSZWNpcGUoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gT0tcbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzZXRBZGRCdG4oKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5tb2RlID09PSAnZWRpdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZUVkaXRSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBnZXRSZWNpcGVEZXRhaWwoKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIENhbmNlbFxuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUubW9kZSA9PT0gJ2VkaXQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvZ2dsZUVkaXRSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVzZXRBZGRCdG4oKTtcbiAgICAgICAgICAgICAgICBnZXRSZWNpcGVEZXRhaWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUucmVkcmF3ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaW5pdGlhbGl6ZSgpO1xuICAgICAgICAgICAgLy8kcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlY2lwZU1vZGlmaWVkJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLm5vZGVDbGljayA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICAvLyBSZW1vdmUgc2VsZWN0aW9uIGNsYXNzXG4gICAgICAgICAgICAkKCdkaXYnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQtbm9kZScpO1xuICAgICAgICAgICAgJCgnZGl2JykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtZGVwZW5kZW5jeScpO1xuICAgICAgICAgICAgJCgnZGl2JykucmVtb3ZlQ2xhc3MoJ2pvYi1hY3RpdmUnKTtcblxuICAgICAgICAgICAgLy8gZmluZCB0aGUgam9iIGluIHRoZSByZWNpcGUgZGVmaW5pdGlvblxuICAgICAgICAgICAgdmFyIGpvYiA9IF8uZmluZCgkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uLmpvYnMse25hbWU6IG5hbWV9KTtcblxuICAgICAgICAgICAgaWYobmFtZSA9PT0gJ3N0YXJ0Jyl7XG4gICAgICAgICAgICAgICAgam9iID0gc3RhcnRKb2I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgJG5hbWUgPSAkKCcjJyArIG5hbWUpO1xuICAgICAgICAgICAgdmFyIHBvcyA9ICRuYW1lLnBvc2l0aW9uKCk7XG5cbiAgICAgICAgICAgIC8vIGNsaWNrIG5vZGUgZGlmZmVyZW50IGZyb20gc2VsZWN0ZWRKb2JcbiAgICAgICAgICAgIGlmICghJHNjb3BlLnNlbGVjdGVkSm9iIHx8IGpvYi5uYW1lICE9PSAkc2NvcGUuc2VsZWN0ZWRKb2IubmFtZSkge1xuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZWRpdE1vZGUgPT09ICdhZGREZXBlbmRlbmN5Jykge1xuICAgICAgICAgICAgICAgICAgICBhZGREZXBlbmRlbmN5KG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZWRyYXcoKTtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJHNjb3BlLmVkaXRNb2RlID09PSAnYWRkSW5wdXQnKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZElucHV0UHJvdmlkZXIgPSBqb2I7XG4gICAgICAgICAgICAgICAgICAgICQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgICAgICAgICAkKCcjJyArIG5hbWUpLmFkZENsYXNzKCdzZWxlY3RlZC1ub2RlLWRlcGVuZGVuY3knKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnI291dHB1dC1zZWxlY3RvcicpLmNzcyh7dG9wOiBwb3MudG9wLCBsZWZ0OiBwb3MubGVmdCwgcG9zaXRpb246ICdhYnNvbHV0ZSd9KTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RvZ2dsZSBpbnB1dCBzZWxlY3RvcicpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJHNjb3BlLmVkaXRNb2RlID09PSAnYWRkT3V0cHV0Jyl7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZE91dHB1dFJlY2VpdmVyID0gam9iO1xuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgcG9zaXRpb24gb2Ygb3V0cHV0LXNlbGVjdG9yXG4gICAgICAgICAgICAgICAgICAgICQoJyNpbnB1dC1zZWxlY3RvcicpLmNzcyh7dG9wOiBwb3MudG9wLCBsZWZ0OiBwb3MubGVmdCwgcG9zaXRpb246ICdhYnNvbHV0ZSd9KTtcbiAgICAgICAgICAgICAgICAgICAgLy8kc2NvcGUubW9kZSA9ICdhZGRJbnB1dEFjdGl2ZSc7XG4gICAgICAgICAgICAgICAgICAgICQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgICAgICAgICAkKCcjJyArIG5hbWUpLmFkZENsYXNzKCdzZWxlY3RlZC1ub2RlLWRlcGVuZGVuY3knKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RvZ2dsZSBvdXRwdXQgc2VsZWN0b3InKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGUgdGhlIHNlbGVjdGVkIGpvYlxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRKb2IgPSBqb2I7XG4gICAgICAgICAgICAgICAgICAgIGlmKCRzY29wZS5yZWNpcGUpe1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkUmVjaXBlSm9iID0gXy5maW5kKCRzY29wZS5yZWNpcGUuam9icywgeyBqb2JfbmFtZTogam9iLm5hbWUgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gYXBwbHkgdGhlIHNlbGVjdGVkLW5vZGUgY2xhc3NcbiAgICAgICAgICAgICAgICAgICAgJG5hbWUuYWRkQ2xhc3MoJ3NlbGVjdGVkLW5vZGUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHsgLy8gY2xpY2sgc2VsZWN0ZWQgbm9kZVxuICAgICAgICAgICAgICAgICQoJ2RpdicpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZC1ub2RlJyk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkSm9iID0gbnVsbDtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRSZWNpcGVKb2IgPSBudWxsO1xuICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZE91dHB1dFJlY2VpdmVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRJbnB1dFByb3ZpZGVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGVwZW5kZW5jeUJ0bkNsYXNzID0gJ2ZhLXBsdXMnO1xuXG4gICAgICAgICAgICAgICAgJCgnLnJlY2lwZU5vZGU6bm90KFwiLnNlbGVjdGVkLW5vZGVcIiknKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQtbm9kZS1zZWxlY3RhYmxlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZigkc2NvcGUuc2VsZWN0ZWRKb2Ipe1xuICAgICAgICAgICAgICAgICQoJyMnICsgJHNjb3BlLnNlbGVjdGVkSm9iLm5hbWUpLmFkZENsYXNzKCdzZWxlY3RlZC1ub2RlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgICRzY29wZS50b2dnbGVFZGl0TW9kZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICgkc2NvcGUubW9kZSA9PT0gJ2VkaXQnKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlbG9hZFJlY2lwZVR5cGVEZXRhaWwoJHNjb3BlLnJlY2lwZVR5cGUuaWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0b2dnbGVFZGl0UmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgcmVzZXRBZGRCdG4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgndG9nZ2xlRWRpdCcsICRzY29wZS5tb2RlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUub3BlbkFkZEpvYiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogJHNjb3BlLmFuaW1hdGlvbnNFbmFibGVkLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYWRkSm9iQ29udGVudC5odG1sJyxcbiAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxuICAgICAgICAgICAgICAgIHNpemU6ICdzbSdcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUuc2VsZWN0ZWRKb2JUeXBlKXtcbiAgICAgICAgICAgICAgICAgICAgam9iVHlwZVNlcnZpY2UuZ2V0Sm9iVHlwZURldGFpbHMoJHNjb3BlLnNlbGVjdGVkSm9iVHlwZS5pZCkudGhlbihmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hZGRKb2JUeXBlKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlU2F2ZVJlY2lwZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5vcGVuRWRpdFRyaWdnZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb246ICRzY29wZS5hbmltYXRpb25zRW5hYmxlZCxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2VkaXRUcmlnZ2VyLmh0bWwnLFxuICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXG4gICAgICAgICAgICAgICAgc2l6ZTogJ21kJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmKCAkc2NvcGUubW9kZSA9PT0gJ2VkaXQnIHx8ICRzY29wZS5tb2RlID09PSAnYWRkJyApIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUudHJpZ2dlcl9ydWxlLmNvbmZpZ3VyYXRpb24uY29uZGl0aW9uLmRhdGFfdHlwZXMgPSAkc2NvcGUucmVjaXBlVHlwZVRyaWdnZXIuZGF0YVR5cGVzID8gJHNjb3BlLnJlY2lwZVR5cGVUcmlnZ2VyLmRhdGFUeXBlcy5zcGxpdCgnLCcpIDogW107XG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIH0pO1xuXG5cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuZGVsZXRlUmVjaXBlSW5wdXQgPSBmdW5jdGlvbihpbnB1dE5hbWUpe1xuICAgICAgICAgICAgdmFyIHJlbW92ZWRSZWNpcGVJbnB1dCA9IF8ucmVtb3ZlKCRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24uaW5wdXRfZGF0YSwgZnVuY3Rpb24gKHJlY2lwZUlucHV0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY2lwZUlucHV0Lm5hbWUgPT09IGlucHV0TmFtZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlbW92ZWQgJyArIHJlbW92ZWRSZWNpcGVJbnB1dC5sZW5ndGggKyAnIHJlY2lwZSBpbnB1dHMuJyk7XG4gICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAkc2NvcGUucmVkcmF3KCk7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUub3BlbkFkZElucHV0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogJHNjb3BlLmFuaW1hdGlvbnNFbmFibGVkLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYWRkSW5wdXQuaHRtbCcsXG4gICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAvLyBjaGVjayBmb3IgZmllbGRzIGFuZCBhZGQgYXMgbmVjZXNzYXJ5XG4gICAgICAgICAgICAgICAgaWYoICRzY29wZS5zZWxlY3RlZFJlY2lwZUlucHV0VHlwZS5maWVsZHMubGVuZ3RoID4gMCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWVsZEFyciA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnNlbGVjdGVkUmVjaXBlSW5wdXRUeXBlLmZpZWxkcywgZnVuY3Rpb24oZmllbGQpe1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGZpZWxkLnZhbHVlLnNwbGl0KCcsJyksIGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZEFyci5wdXNoKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZUlucHV0W2ZpZWxkLm5hbWVdID0gZmllbGRBcnI7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGFkZCBpbnB1dCB0byByZWNpcGUgdHlwZSBkZWZpbml0aW9uXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5pbnB1dF9kYXRhLnB1c2goJHNjb3BlLnJlY2lwZUlucHV0KTtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCBmdW5jdGlvbihqb2Ipe1xuICAgICAgICAgICAgICAgICAgICBpZihqb2IucmVjaXBlX2lucHV0cy5sZW5ndGggPT09IDApe1xuICAgICAgICAgICAgICAgICAgICAgICAgam9iLnJlY2lwZV9pbnB1dHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iX2lucHV0OiAkc2NvcGUucmVjaXBlSW5wdXQubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNpcGVfaW5wdXQ6ICRzY29wZS5yZWNpcGVJbnB1dC5uYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGdldElvTWFwcGluZ3MoKTtcblxuICAgICAgICAgICAgICAgIC8vIHJlc2V0IGZvcm0gZmllbGRzXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZUlucHV0ID0ge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICcnXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRSZWNpcGVJbnB1dFR5cGUgPSB7fTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5jaGFuZ2VJbnB1dFR5cGUgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkUmVjaXBlSW5wdXRUeXBlID0gXy5maW5kKCRzY29wZS5yZWNpcGVJbnB1dFR5cGVzLCB7J25hbWUnOiAkc2NvcGUucmVjaXBlSW5wdXQudHlwZX0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRXYXJuaW5nc0h0bWwgPSBmdW5jdGlvbiAod2FybmluZ3MpIHtcbiAgICAgICAgICAgIHZhciB3YXJuaW5nc0h0bWwgPSAnJztcbiAgICAgICAgICAgIF8uZm9yRWFjaCh3YXJuaW5ncywgZnVuY3Rpb24gKHdhcm5pbmcpIHtcbiAgICAgICAgICAgICAgICB3YXJuaW5nc0h0bWwgKz0gJzxiPicgKyB3YXJuaW5nLmlkICsgJzo8L2I+ICcgKyB3YXJuaW5nLmRldGFpbHMgKyAnPGJyIC8+PGJyIC8+JztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgd2FybmluZ3NIdG1sICs9ICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0biBidG4tZGVmYXVsdCBidG4teHMgY2xlYXJcIj5IaWRlPC9idXR0b24+JztcbiAgICAgICAgICAgIHJldHVybiB3YXJuaW5nc0h0bWw7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnZhbGlkYXRlUmVjaXBlVHlwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJlY2lwZVNlcnZpY2UudmFsaWRhdGVSZWNpcGVUeXBlKCRzY29wZS5yZWNpcGVUeXBlKS50aGVuKGZ1bmN0aW9uKHZhbGlkYXRpb25SZXN1bHQpe1xuICAgICAgICAgICAgICAgIGlmKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MgJiYgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5sZW5ndGggPiAwKXtcbiAgICAgICAgICAgICAgICAgICAgLy8gZGlzcGxheSB0aGUgd2FybmluZ3NcbiAgICAgICAgICAgICAgICAgICAgdmFyIHdhcm5pbmdzSHRtbCA9IGdldFdhcm5pbmdzSHRtbCh2YWxpZGF0aW9uUmVzdWx0Lndhcm5pbmdzKTtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyW1wiZXJyb3JcIl0od2FybmluZ3NIdG1sKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbXCJzdWNjZXNzXCJdKCdSZWNpcGUgaXMgdmFsaWQuJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyb3Ipe1xuICAgICAgICAgICAgICAgIGlmKGVycm9yLmRldGFpbCl7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0cltcImVycm9yXCJdKGVycm9yLmRldGFpbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyW1wiZXJyb3JcIl0oZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH07XG5cblxuICAgICAgICAkc2NvcGUuc2F2ZVJlY2lwZVR5cGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkc2NvcGUuc2F2aW5nUmVjaXBlID0gdHJ1ZTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzYXZlIHJlY2lwZTogJyArICRzY29wZS5yZWNpcGVUeXBlLm5hbWUpO1xuICAgICAgICAgICAgcmVjaXBlU2VydmljZS52YWxpZGF0ZVJlY2lwZVR5cGUoJHNjb3BlLnJlY2lwZVR5cGUpLnRoZW4oZnVuY3Rpb24odmFsaWRhdGlvblJlc3VsdCl7XG4gICAgICAgICAgICAgICAgaWYodmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyAmJiB2YWxpZGF0aW9uUmVzdWx0Lndhcm5pbmdzLmxlbmd0aCA+IDApe1xuICAgICAgICAgICAgICAgICAgICAvLyBkaXNwbGF5IHRoZSB3YXJuaW5nc1xuICAgICAgICAgICAgICAgICAgICB2YXIgd2FybmluZ3NIdG1sID0gZ2V0V2FybmluZ3NIdG1sKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MpO1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHJbXCJlcnJvclwiXSh3YXJuaW5nc0h0bWwpO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2F2aW5nUmVjaXBlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVjaXBlU2VydmljZS5zYXZlUmVjaXBlVHlwZSgkc2NvcGUucmVjaXBlVHlwZSkudGhlbihmdW5jdGlvbihzYXZlUmVzdWx0KXtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zYXZpbmdSZWNpcGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yZWNpcGVUeXBlID0gc2F2ZVJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yZWRyYXcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vJGxvY2F0aW9uLnBhdGgoJy9yZWNpcGVzL3R5cGVzLycgKyBzYXZlUmVzdWx0LmlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyb3Ipe1xuICAgICAgICAgICAgICAgIGlmKGVycm9yICYmIGVycm9yLmRldGFpbCl7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvci5kZXRhaWwpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0clsnZXJyb3InXShlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICRzY29wZS5zYXZpbmdSZWNpcGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBkaXNhYmxlU2F2ZVJlY2lwZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5hZGRKb2JUeXBlID0gZnVuY3Rpb24gKHNlbGVjdGVkSm9iVHlwZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coc2VsZWN0ZWRKb2JUeXBlLm5hbWUpO1xuICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5hZGRKb2Ioc2VsZWN0ZWRKb2JUeXBlKTtcbiAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdyZWRyYXdSZWNpcGVzJyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLm1hcElucHV0ID0gZnVuY3Rpb24gKHByb3ZpZGVyTmFtZSwgcHJvdmlkZXJPdXRwdXQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdtYXAgc2VsZWN0ZWQgam9iIGlucHV0IHRvICcgKyBwcm92aWRlck5hbWUgKyAnLicgKyBwcm92aWRlck91dHB1dCk7XG4gICAgICAgICAgICB2YXIgZGVwZW5kZW5jeSA9IF8uZmluZCgkc2NvcGUuc2VsZWN0ZWRKb2IuZGVwZW5kZW5jaWVzLCB7bmFtZTogcHJvdmlkZXJOYW1lfSk7XG5cbiAgICAgICAgICAgIGlmKGRlcGVuZGVuY3kgJiYgZGVwZW5kZW5jeS5jb25uZWN0aW9ucyAmJiBkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLmxlbmd0aCA+IDApe1xuICAgICAgICAgICAgICAgIHZhciBjb25uID0gXy5maW5kKGRlcGVuZGVuY3kuY29ubmVjdGlvbnMsIHsgb3V0cHV0OiBwcm92aWRlck91dHB1dCwgaW5wdXQ6ICRzY29wZS5zZWxlY3RlZEpvYklucHV0Lm5hbWUgfSk7XG4gICAgICAgICAgICAgICAgaWYoIWNvbm4pe1xuICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLnB1c2goeyBvdXRwdXQ6IHByb3ZpZGVyT3V0cHV0LCBpbnB1dDogJHNjb3BlLnNlbGVjdGVkSm9iSW5wdXQubmFtZSB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKCFkZXBlbmRlbmN5KXtcbiAgICAgICAgICAgICAgICBkZXBlbmRlbmN5ID0ge25hbWU6IHByb3ZpZGVyTmFtZSwgY29ubmVjdGlvbnM6IFt7IG91dHB1dDogcHJvdmlkZXJPdXRwdXQsIGlucHV0OiAkc2NvcGUuc2VsZWN0ZWRKb2JJbnB1dC5uYW1lIH1dfTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRKb2IuZGVwZW5kZW5jaWVzLnB1c2goZGVwZW5kZW5jeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBkZXBlbmRlbmN5LmNvbm5lY3Rpb25zID0gW3sgb3V0cHV0OiBwcm92aWRlck91dHB1dCwgaW5wdXQ6ICRzY29wZS5zZWxlY3RlZEpvYklucHV0Lm5hbWUgfV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRKb2IuZGVwU3RhcnQgPSBmYWxzZTtcbiAgICAgICAgICAgICRzY29wZS5lZGl0TW9kZSA9ICcnO1xuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkSm9iSW5wdXQgPSBudWxsO1xuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkSW5wdXRQcm92aWRlciA9IG51bGw7XG4gICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAkc2NvcGUucmVkcmF3KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLm1hcElucHV0UmVjaXBlSW5wdXQgPSBmdW5jdGlvbihyZWNpcGVJbnB1dCl7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbWFwIHNlbGVjdGVkIGpvYiB0byByZWNpcGUgaW5wdXQgJyArIHJlY2lwZUlucHV0KTtcbiAgICAgICAgICAgIHZhciBleGlzdGluZ0lucHV0ID0gXy5maW5kKCRzY29wZS5zZWxlY3RlZEpvYi5yZWNpcGVfaW5wdXRzLCB7IGpvYl9pbnB1dDogJHNjb3BlLnNlbGVjdGVkSm9iSW5wdXQubmFtZSB9KTtcbiAgICAgICAgICAgIGlmKCBleGlzdGluZ0lucHV0ICYmIGV4aXN0aW5nSW5wdXQucmVjaXBlX25hbWUgIT09IHJlY2lwZUlucHV0KXtcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgaXRcbiAgICAgICAgICAgICAgICBleGlzdGluZ0lucHV0LnJlY2lwZV9pbnB1dCA9IHJlY2lwZUlucHV0O1xuICAgICAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVkcmF3KCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYoICFleGlzdGluZ0lucHV0ICl7XG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIGl0XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkSm9iLnJlY2lwZV9pbnB1dHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGpvYl9pbnB1dDogJHNjb3BlLnNlbGVjdGVkSm9iSW5wdXQubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcmVjaXBlX2lucHV0OiByZWNpcGVJbnB1dFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVkcmF3KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkc2NvcGUuZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEpvYklucHV0ID0gbnVsbDtcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZElucHV0UHJvdmlkZXIgPSBudWxsO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5tYXBPdXRwdXQgPSBmdW5jdGlvbiAocmVjZWl2ZXJOYW1lLCByZWNlaXZlcklucHV0KSB7XG4gICAgICAgICAgICB2YXIgZGVwZW5kZW5jeSA9IF8uZmluZCgkc2NvcGUuc2VsZWN0ZWRPdXRwdXRSZWNlaXZlci5kZXBlbmRlbmNpZXMsIHtuYW1lOiAkc2NvcGUuc2VsZWN0ZWRKb2IubmFtZX0pO1xuXG4gICAgICAgICAgICBpZihkZXBlbmRlbmN5ICYmIGRlcGVuZGVuY3kuY29ubmVjdGlvbnMgJiYgZGVwZW5kZW5jeS5jb25uZWN0aW9ucy5sZW5ndGggPiAwKXtcbiAgICAgICAgICAgICAgICB2YXIgY29ubiA9IF8uZmluZChkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLCB7IG91dHB1dDogJHNjb3BlLnNlbGVjdGVkSm9iT3V0cHV0Lm5hbWUsIGlucHV0OiByZWNlaXZlcklucHV0IH0pO1xuICAgICAgICAgICAgICAgIGlmKCFjb25uKXtcbiAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jeS5jb25uZWN0aW9ucy5wdXNoKHtvdXRwdXQ6ICRzY29wZS5zZWxlY3RlZEpvYk91dHB1dC5uYW1lLCBpbnB1dDogcmVjZWl2ZXJJbnB1dH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoIWRlcGVuZGVuY3kpe1xuICAgICAgICAgICAgICAgIGRlcGVuZGVuY3kgPSB7bmFtZTogJHNjb3BlLnNlbGVjdGVkSm9iLm5hbWUsIGNvbm5lY3Rpb25zOiBbe291dHB1dDogJHNjb3BlLnNlbGVjdGVkSm9iT3V0cHV0Lm5hbWUsIGlucHV0OiByZWNlaXZlcklucHV0fV19O1xuICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZE91dHB1dFJlY2VpdmVyLmRlcGVuZGVuY2llcy5wdXNoKGRlcGVuZGVuY3kpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZGVwZW5kZW5jeS5jb25uZWN0aW9ucyA9IFt7b3V0cHV0OiAkc2NvcGUuc2VsZWN0ZWRKb2JPdXRwdXQubmFtZSwgaW5wdXQ6IHJlY2VpdmVySW5wdXR9XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZE91dHB1dFJlY2VpdmVyLmRlcFN0YXJ0ID0gZmFsc2U7XG4gICAgICAgICAgICAkc2NvcGUuZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEpvYk91dHB1dCA9IG51bGw7XG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRPdXRwdXRSZWNlaXZlciA9IG51bGw7XG4gICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAkc2NvcGUucmVkcmF3KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnRvZ2dsZUFkZERlcGVuZGVuY3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLmVkaXRNb2RlID09PSAnYWRkRGVwZW5kZW5jeScpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGVwZW5kZW5jeUJ0bkNsYXNzID0gJ2ZhLXBsdXMnO1xuICAgICAgICAgICAgICAgICQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndG9nZ2xlIGFkZERlcGVuZGVuY3kgbW9kZScpO1xuICAgICAgICAgICAgICAgICRzY29wZS5lZGl0TW9kZSA9ICdhZGREZXBlbmRlbmN5JztcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGVwZW5kZW5jeUJ0bkNsYXNzID0gJ2ZhLW1pbnVzJztcbiAgICAgICAgICAgICAgICAkKCcucmVjaXBlTm9kZTpub3QoXCIuc2VsZWN0ZWQtbm9kZVwiKScpLmFkZENsYXNzKCdzZWxlY3RlZC1ub2RlLXNlbGVjdGFibGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUudG9nZ2xlQWRkSW5wdXQgPSBmdW5jdGlvbiAoam9iaW5wdXQpIHtcbiAgICAgICAgICAgIGlmICgkc2NvcGUuZWRpdE1vZGUgPT09ICdhZGRJbnB1dCcpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZWRpdE1vZGUgPSAnJztcbiAgICAgICAgICAgICAgICAkKCcucmVjaXBlTm9kZTpub3QoXCIuc2VsZWN0ZWQtbm9kZVwiKScpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZC1ub2RlLXNlbGVjdGFibGUnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkSm9iSW5wdXQgPSBqb2JpbnB1dDtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndG9nZ2xlIGFkZElucHV0IG1vZGUnKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZWRpdE1vZGUgPSAnYWRkSW5wdXQnO1xuICAgICAgICAgICAgICAgICQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykuYWRkQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS50b2dnbGVBZGRPdXRwdXQgPSBmdW5jdGlvbiAoam9ib3V0cHV0KSB7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLmVkaXRNb2RlID09PSAnYWRkT3V0cHV0Jykge1xuICAgICAgICAgICAgICAgICRzY29wZS5lZGl0TW9kZSA9ICcnO1xuICAgICAgICAgICAgICAgICQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRKb2JPdXRwdXQgPSBqb2JvdXRwdXQ7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RvZ2dsZSBhZGRPdXRwdXQgbW9kZScpO1xuICAgICAgICAgICAgICAgICRzY29wZS5lZGl0TW9kZSA9ICdhZGRPdXRwdXQnO1xuICAgICAgICAgICAgICAgICQoJy5yZWNpcGVOb2RlOm5vdChcIi5zZWxlY3RlZC1ub2RlXCIpJykuYWRkQ2xhc3MoJ3NlbGVjdGVkLW5vZGUtc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5yZW1vdmVEZXBlbmRlbmN5ID0gZnVuY3Rpb24gKGRlcE5hbWUpIHtcbiAgICAgICAgICAgIHZhciByZW1vdmVkRGVwcyA9IF8ucmVtb3ZlKCRzY29wZS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMsIGZ1bmN0aW9uIChkZXApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVwLm5hbWUgPT09IGRlcE5hbWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZW1vdmVkICcgKyByZW1vdmVkRGVwcy5sZW5ndGggKyAnIGRlcGVuZGVuY2llcy4nKTtcbiAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgICRzY29wZS5yZWRyYXcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUucmVtb3ZlSW5wdXRNYXBwaW5nID0gZnVuY3Rpb24gKGRlcE5hbWUsIGRlcE91dHB1dCkge1xuICAgICAgICAgICAgaWYoIGRlcE5hbWUgPT09ICdyZWNpcGUnICl7XG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGl0IGZyb20gc2VsZWN0ZWRKb2IucmVjaXBlX2lucHV0c1xuICAgICAgICAgICAgICAgIHZhciBkZXAgPSBfLnJlbW92ZSgkc2NvcGUuc2VsZWN0ZWRKb2IucmVjaXBlX2lucHV0cywgeyByZWNpcGVfaW5wdXQ6IGRlcE91dHB1dCB9KTtcbiAgICAgICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlZHJhdygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVwID0gXy5maW5kKCRzY29wZS5zZWxlY3RlZEpvYi5kZXBlbmRlbmNpZXMsIHtuYW1lOiBkZXBOYW1lfSk7XG4gICAgICAgICAgICAgICAgaWYgKGRlcCAmJiBkZXAuY29ubmVjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaXQncyBhbiBpbnB1dCBmcm9tIGFub3RoZXIgam9iXG4gICAgICAgICAgICAgICAgICAgIHZhciByZW1vdmVkQ29uID0gXy5yZW1vdmUoZGVwLmNvbm5lY3Rpb25zLCBmdW5jdGlvbiAoY29ubikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbm4ub3V0cHV0ID09PSBkZXBPdXRwdXQ7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVtb3ZlZCAnICsgcmVtb3ZlZENvbi5sZW5ndGggKyAnIGlucHV0IGNvbm5lY3Rpb25zLicpO1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVTYXZlUmVjaXBlKCk7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZWRyYXcoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuZGVsZXRlUmVjaXBlSm9iID0gZnVuY3Rpb24oam9iTmFtZSl7XG4gICAgICAgICAgICAvLyByZW1vdmUgZGVwZW5kZW50IGNvbm5lY3Rpb25zXG4gICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCBmdW5jdGlvbihqb2Ipe1xuICAgICAgICAgICAgICAgIF8ucmVtb3ZlKGpvYi5kZXBlbmRlbmNpZXMsIHtuYW1lOiBqb2JOYW1lfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIHJlbW92ZSBqb2IgZnJvbSBkZWZpbml0aW9uLmpvYnNcbiAgICAgICAgICAgIF8ucmVtb3ZlKCRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24uam9icywgeyBuYW1lOiBqb2JOYW1lIH0pO1xuICAgICAgICAgICAgLy8gZW5hYmxlIHNhdmUgYW5kIHJlZHJhd1xuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkSm9iID0gbnVsbDtcbiAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgICRzY29wZS5yZWRyYXcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUucmVtb3ZlT3V0cHV0TWFwcGluZyA9IGZ1bmN0aW9uIChqb2JOYW1lLCBkZXBPdXRwdXQpIHtcbiAgICAgICAgICAgIC8vIHdlIGhhdmUgdG8gcmVtb3ZlIG91dHB1dCBtYXBwaW5nIGZyb20gdGhlIGpvYiB3aGVyZSB0aGUgZGVwZW5kZW5jeSBpcyBkZWZpbmVkXG4gICAgICAgICAgICB2YXIgcmVjZWl2ZXIgPSBfLmZpbmQoJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLHtuYW1lOiBqb2JOYW1lfSk7XG4gICAgICAgICAgICAvLyByZW1vdmUgaXQgZnJvbSByZWNlaXZlci5kZXBlbmRlbmNpZXNcbiAgICAgICAgICAgIHZhciBkZXAgPSBfLmZpbmQocmVjZWl2ZXIuZGVwZW5kZW5jaWVzLCB7bmFtZTogJHNjb3BlLnNlbGVjdGVkSm9iLm5hbWV9KTtcbiAgICAgICAgICAgIGlmIChkZXAgJiYgZGVwLmNvbm5lY3Rpb25zKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlbW92ZWRDb24gPSBfLnJlbW92ZShkZXAuY29ubmVjdGlvbnMsIGZ1bmN0aW9uIChjb25uKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb25uLm91dHB1dCA9PT0gZGVwT3V0cHV0O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZW1vdmVkICcgKyByZW1vdmVkQ29uLmxlbmd0aCArICcgb3V0cHV0IGNvbm5lY3Rpb25zLicpO1xuICAgICAgICAgICAgICAgIGVuYWJsZVNhdmVSZWNpcGUoKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVkcmF3KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLnNlbGVjdEpvYlR5cGVUb0FkZCA9IGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkSm9iVHlwZSA9IGl0ZW07XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLiRvbigncmVkcmF3UmVjaXBlcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5yZWRyYXcoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGFkZERlcGVuZGVuY3kgPSBmdW5jdGlvbihqb2JOYW1lKXtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5zZWxlY3RlZEpvYi5uYW1lICsgJy0+JyArIGpvYk5hbWUpO1xuICAgICAgICAgICAgaWYgKCEkc2NvcGUuc2VsZWN0ZWRKb2IuZGVwZW5kZW5jaWVzKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkSm9iLmRlcGVuZGVuY2llcyA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGV4aXN0aW5nRGVwZW5kZW5jeSA9IF8uZmluZCgkc2NvcGUuc2VsZWN0ZWRKb2IuZGVwZW5kZW5jaWVzLCB7bmFtZTogam9iTmFtZX0pO1xuXG4gICAgICAgICAgICBpZighZXhpc3RpbmdEZXBlbmRlbmN5KXsgJHNjb3BlLnNlbGVjdGVkSm9iLmRlcGVuZGVuY2llcy5wdXNoKHtuYW1lOiBqb2JOYW1lfSk7IH1cbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEpvYi5kZXBTdGFydCA9IGZhbHNlO1xuICAgICAgICAgICAgJHNjb3BlLmVkaXRNb2RlID0gJyc7XG4gICAgICAgICAgICAkc2NvcGUuZGVwZW5kZW5jeUJ0bkNsYXNzID0gJ2ZhLXBsdXMnO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldElvTWFwcGluZ3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZigkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uKXtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goJHNjb3BlLnJlY2lwZVR5cGUuZGVmaW5pdGlvbi5qb2JzLCBmdW5jdGlvbiAoam9iKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHBvcHVsYXRlIHRoZSBjdXJyZW50IGpvYlR5cGVcbiAgICAgICAgICAgICAgICAgICAgLyp2YXIgdGhpc0pvYlR5cGUgPSBfLmZpbmQoJHNjb3BlLnJlY2lwZVR5cGUuam9iX3R5cGVzLHtpZDogam9iLmpvYl90eXBlX2lkfSk7XG4gICAgICAgICAgICAgICAgICAgIGpvYi5qb2JfdHlwZSA9IHRoaXNKb2JUeXBlOyovXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZmluZCBkZXBlbmRlbnRzXG4gICAgICAgICAgICAgICAgICAgIGlmIChqb2Iuam9iX3R5cGUgJiYgam9iLmpvYl90eXBlLmpvYl90eXBlX2ludGVyZmFjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGpvYi5qb2JfdHlwZS5qb2JfdHlwZV9pbnRlcmZhY2Uub3V0cHV0X2RhdGEsIGZ1bmN0aW9uIChqb2JPdXRwdXQsIGtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqb2JPdXRwdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlcHMgPSBnZXREZXBlbmRlbnRzKGpvYi5uYW1lLGpvYk91dHB1dC5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgam9iT3V0cHV0LmRlcGVuZGVudHMgPSBkZXBzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGRlcGVuZGVuY3kgbWFwcGluZ3NcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChqb2Iuam9iX3R5cGUuam9iX3R5cGVfaW50ZXJmYWNlLmlucHV0X2RhdGEsIGZ1bmN0aW9uIChqb2JJbnB1dCwga2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpvYklucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnB1dE1hcHBpbmdzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChqb2IuZGVwZW5kZW5jaWVzLCBmdW5jdGlvbiAoZGVwZW5kZW5jeSxrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLCBmdW5jdGlvbiAoY29ubixrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29ubi5pbnB1dCA9PT0gam9iSW5wdXQubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dE1hcHBpbmdzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZGVwZW5kZW5jeS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0OiBjb25uLm91dHB1dCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiBjb25uLmlucHV0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKGpvYi5yZWNpcGVfaW5wdXRzLCBmdW5jdGlvbihyZWNpcGVJbnB1dCwga2V5KXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJlY2lwZUlucHV0LmpvYl9pbnB1dCA9PT0gam9iSW5wdXQubmFtZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRNYXBwaW5ncy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ3JlY2lwZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dDogcmVjaXBlSW5wdXQucmVjaXBlX2lucHV0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dDogcmVjaXBlSW5wdXQuam9iX2lucHV0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2JJbnB1dC5kZXBlbmRlbmNpZXMgPSBpbnB1dE1hcHBpbmdzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICBqb2JUeXBlU2VydmljZS5nZXRKb2JUeXBlc09uY2UoKS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICRzY29wZS5qb2JUeXBlVmFsdWVzID0gZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHdvcmtzcGFjZXNTZXJ2aWNlLmdldFdvcmtzcGFjZXMoKS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICRzY29wZS5hdmFpbGFibGVXb3Jrc3BhY2VzID0gZGF0YVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ3JlY2lwZVR5cGUnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5yZWNpcGVUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLnJlY2lwZVR5cGUuaWQgfHwgJHNjb3BlLnJlY2lwZVR5cGUuaWQgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tb2RlID0gJ2FkZCc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKCRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24uam9icywgZnVuY3Rpb24gKGpvYiwgaWR4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZigham9iLmpvYl90eXBlLmpvYl90eXBlX2ludGVyZmFjZSAmJiAkc2NvcGUucmVjaXBlVHlwZS5qb2JfdHlwZXMpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBqb2JUeXBlRGF0YSA9IF8uZmluZCgkc2NvcGUucmVjaXBlVHlwZS5qb2JfdHlwZXMsIHtuYW1lOiBqb2Iuam9iX3R5cGUubmFtZSwgdmVyc2lvbjogam9iLmpvYl90eXBlLnZlcnNpb259KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uLmpvYnNbaWR4XS5qb2JfdHlwZSA9IGpvYlR5cGVEYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldHVwIHN0cmluZyB0byBiaW5kIGNvbW1hIGRlbGltaXRlZCBsaXN0IG9mIHRyaWdnZXIgcnVsZSBjb25maWd1cmF0aW9uIGNvbmRpdGlvbiBkYXRhIHR5cGVzXG4gICAgICAgICAgICAgICAgICAgIGlmKCRzY29wZS5yZWNpcGVUeXBlLnRyaWdnZXJfcnVsZSAmJiAkc2NvcGUucmVjaXBlVHlwZS50cmlnZ2VyX3J1bGUuY29uZmlndXJhdGlvbiAmJiAkc2NvcGUucmVjaXBlVHlwZS50cmlnZ2VyX3J1bGUuY29uZmlndXJhdGlvbi5jb25kaXRpb24gJiYgJHNjb3BlLnJlY2lwZVR5cGUudHJpZ2dlcl9ydWxlLmNvbmZpZ3VyYXRpb24uY29uZGl0aW9uLmRhdGFfdHlwZXMpe1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlY2lwZVR5cGVUcmlnZ2VyLmRhdGFUeXBlcyA9ICRzY29wZS5yZWNpcGVUeXBlLnRyaWdnZXJfcnVsZS5jb25maWd1cmF0aW9uLmNvbmRpdGlvbi5kYXRhX3R5cGVzLmpvaW4oJywnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGluaXRHcmFwaCgpO1xuICAgICAgICAgICAgICAgICAgICBnZXRJb01hcHBpbmdzKCk7XG4gICAgICAgICAgICAgICAgICAgIGRyYXdHcmFwaCgkc2NvcGUuaXNVcGRhdGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYoJHJvb3RTY29wZS51c2VyKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVhZG9ubHkgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaW5pdEdyYXBoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gKioqKioqXG4gICAgICAgICAgICAvLyBzZXR1cCBEMyBjb250YWluZXIgYW5kIEdyYXBoXG4gICAgICAgICAgICAvLyAqKioqKipcbiAgICAgICAgICAgIC8vJHNjb3BlLnNlbGVjdGVkSm9iID0gbnVsbDtcbiAgICAgICAgICAgIGZ1bmN0aW9uIGNsaWNrZWQoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSBkMy5ldmVudDtcbiAgICAgICAgICAgICAgICB2YXIgeCA9IGQzLmV2ZW50Lng7XG4gICAgICAgICAgICAgICAgdmFyIHkgPSBkMy5ldmVudC55O1xuICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IHBhcnNlSW50KHN2Zy5zdHlsZShcIndpZHRoXCIpLnJlcGxhY2UoL3B4LywgXCJcIikpO1xuICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSBwYXJzZUludChzdmcuc3R5bGUoXCJoZWlnaHRcIikucmVwbGFjZSgvcHgvLCBcIlwiKSk7XG5cbiAgICAgICAgICAgICAgICBpbm5lci5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgd2lkdGggLyAyICsgXCIsXCIgKyBoZWlnaHQgLyAyICsgXCIpc2NhbGUoMil0cmFuc2xhdGUoXCIgKyAteCArIFwiLFwiICsgLXkgKyBcIilcIik7XG5cbiAgICAgICAgICAgICAgICAvL2lubmVyLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoNTBweCwgNTBweClzY2FsZSgyLDMpXCIpO1xuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHN2ZyA9IGQzLnNlbGVjdChcInN2Z1wiKTtcbiAgICAgICAgICAgIGlubmVyID0gc3ZnLnNlbGVjdChcImdcIik7IC8vLm9uKFwiY2xpY2tcIiwgY2xpY2tlZCk7XG4gICAgICAgICAgICAvLyBTZXQgdXAgem9vbSBzdXBwb3J0XG4gICAgICAgICAgICB6b29tID0gZDMuYmVoYXZpb3Iuem9vbSgpLm9uKFwiem9vbVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaW5uZXIuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIGQzLmV2ZW50LnRyYW5zbGF0ZSArIFwiKVwiICtcbiAgICAgICAgICAgICAgICAgICAgXCJzY2FsZShcIiArIGQzLmV2ZW50LnNjYWxlICsgXCIpXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzdmcuY2FsbCh6b29tKTtcblxuICAgICAgICAgICAgcmVuZGVyID0gbmV3IGRhZ3JlRDMucmVuZGVyKCk7XG5cbiAgICAgICAgICAgIC8vIExlZnQtdG8tcmlnaHQgbGF5b3V0XG4gICAgICAgICAgICBncmFwaCA9IG5ldyBkYWdyZUQzLmdyYXBobGliLkdyYXBoKCk7XG4gICAgICAgICAgICBncmFwaC5zZXRHcmFwaCh7XG4gICAgICAgICAgICAgICAgbm9kZXNlcDogNzAsXG4gICAgICAgICAgICAgICAgcmFua3NlcDogNTAsXG4gICAgICAgICAgICAgICAgcmFua2RpcjogXCJUQlwiLFxuICAgICAgICAgICAgICAgIG1hcmdpbng6IDIwLFxuICAgICAgICAgICAgICAgIG1hcmdpbnk6IDIwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBkcmF3R3JhcGggPSBmdW5jdGlvbiAoaXNVcGRhdGUpIHtcbiAgICAgICAgICAgIC8vIGdsb2JhbHMgYmVjYXVzZSBkYWdyZSBuZWVkcyBhIHJlZmVyZW5jZSB0byBhbmd1bGFyIHNjb3BlXG4gICAgICAgICAgICB3aW5kb3cubm9kZUNsaWNrID0gZnVuY3Rpb24obmFtZSkge1xuICAgICAgICAgICAgICAgIHZhciBzY29wZSA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVjaXBldmlld2VyJykpLnNjb3BlKCk7XG4gICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubm9kZUNsaWNrKG5hbWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgd2luZG93Lm1hcElucHV0ID0gZnVuY3Rpb24oam9iTmFtZSwgam9iT3V0cHV0KXtcbiAgICAgICAgICAgICAgICB2YXIgc2NvcGUgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY2lwZXZpZXdlcicpKS5zY29wZSgpO1xuICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm1hcElucHV0KGpvYk5hbWUsIGpvYk91dHB1dCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUuaXNVcGRhdGUgPSB0cnVlO1xuICAgICAgICAgICAgaWYoJHNjb3BlLnJlY2lwZSl7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmxhc3RTdGF0dXNDaGFuZ2UgPSAkc2NvcGUucmVjaXBlLmxhc3RfbW9kaWZpZWQgPyBtb21lbnQuZHVyYXRpb24obW9tZW50LnV0Yygkc2NvcGUucmVjaXBlLmxhc3RfbW9kaWZpZWQpLmRpZmYobW9tZW50LnV0YygpKSkuaHVtYW5pemUodHJ1ZSkgOiAnJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGpvYnMgPSBbXTtcbiAgICAgICAgICAgIGlmICgkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uKSB7XG4gICAgICAgICAgICAgICAgam9icyA9ICRzY29wZS5yZWNpcGVUeXBlLmRlZmluaXRpb24uam9icztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjaGlsZENvdW50cyA9IFtdO1xuICAgICAgICAgICAgLy8gY3JlYXRlIGdyYXBoIG9iamVjdHNcbiAgICAgICAgICAgIGZvciAodmFyIGlkeCBpbiBqb2JzKSB7XG4gICAgICAgICAgICAgICAgdmFyIGpvYiA9IGpvYnNbaWR4XTtcblxuICAgICAgICAgICAgICAgIGlmICggam9iLmRlcGVuZGVuY2llcyA9PT0gdW5kZWZpbmVkIHx8IGpvYi5kZXBlbmRlbmNpZXMubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgICAgICAgICBqb2IuZGVwU3RhcnQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gZ2V0UmVjaXBlVHlwZUpvYkNsYXNzTmFtZShqb2IpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGh0bWwgPSAnPGRpdj4nO1xuICAgICAgICAgICAgICAgIC8vdmFyIGh0bWwgPSBcIjxkaXYgb25jbGljaz1cXFwiY29uc29sZS5sb2coJ1wiICsgam9iLmpvYl90eXBlLm5hbWUgKyBcIicpXFxcIj5cIjtcbiAgICAgICAgICAgICAgICBodG1sICs9ICc8c3BhbiBjbGFzcz1cInN0YXR1c1wiPjwvc3Bhbj4nO1xuICAgICAgICAgICAgICAgIC8vICAgaHRtbCArPSBcIjxzcGFuIGNsYXNzPWNvbnN1bWVycz5cIit3b3JrZXIuY29uc3VtZXJzK1wiPC9zcGFuPlwiO1xuICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxzcGFuIGNsYXNzPVwibmFtZVwiPic7XG4gICAgICAgICAgICAgICAgaWYgKGpvYi5qb2JfdHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGpvYi5qb2JUeXBlKTtcbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPGRpdiBpZD1cIicgKyBqb2IubmFtZSArICdcIiBjbGFzcz1cInJlY2lwZU5vZGVcIiBvbmNsaWNrPVwibm9kZUNsaWNrKFxcJycgKyBqb2IubmFtZSArICdcXCcpXCI+PHNwYW4gY2xhc3M9XCJuYW1lXCI+JyArIGpvYi5qb2JfdHlwZS5nZXRJY29uKCkgKyAnICcgKyBqb2IubmFtZSArICc8L3NwYW4+PC9kaXY+JztcbiAgICAgICAgICAgICAgICAgICAgLy9pZihqb2JUeXBlLm5hbWUpe1xuICAgICAgICAgICAgICAgICAgICAvLyAgICBodG1sICs9ICc8ZGl2IGlkPVwiJyArIGpvYi5uYW1lICsgJ1wiIGNsYXNzPVwicmVjaXBlTm9kZVwiIG9uY2xpY2s9XCJub2RlQ2xpY2soXFwnJyArIGpvYi5uYW1lICsgJ1xcJylcIj48c3BhbiBjbGFzcz1cIm5hbWVcIj4nICsgam9iVHlwZS5nZXRJY29uKCkgKyAnICcgKyBqb2JUeXBlLnRpdGxlICsgJzwvc3Bhbj48L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICAvL30gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgIGh0bWwgKz0gJzxkaXYgaWQ9XCInICsgam9iLm5hbWUgKyAnXCIgY2xhc3M9XCJyZWNpcGVOb2RlXCIgb25jbGljaz1cIm5vZGVDbGljayhcXCcnICsgam9iLm5hbWUgKyAnXFwnKVwiPjxzcGFuIGNsYXNzPVwibmFtZVwiPicgKyBqb2JUeXBlLmdldEljb24oKSArICcgJyArIGpvYi5uYW1lICsgJzwvc3Bhbj48L2Rpdj4nO1xuICAgICAgICAgICAgICAgICAgICAvL31cblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBodG1sICs9ICc8L3NwYW4+JztcbiAgICAgICAgICAgICAgICAvLyAgIGh0bWwgKz0gXCI8c3BhbiBjbGFzcz1xdWV1ZT48c3BhbiBjbGFzcz1jb3VudGVyPlwiK3dvcmtlci5jb3VudCtcIjwvc3Bhbj48L3NwYW4+XCI7XG4gICAgICAgICAgICAgICAgaHRtbCArPSAnPC9kaXY+JztcbiAgICAgICAgICAgICAgICBncmFwaC5zZXROb2RlKGpvYi5uYW1lLCB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsVHlwZTogJ2h0bWwnLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogaHRtbCxcbiAgICAgICAgICAgICAgICAgICAgcng6IDUsXG4gICAgICAgICAgICAgICAgICAgIHJ5OiA1LFxuICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAwLFxuICAgICAgICAgICAgICAgICAgICBjbGFzczogY2xhc3NOYW1lXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gc2V0dXAgZWRnZXNcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBkIGluIGpvYi5kZXBlbmRlbmNpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRlcCA9IGpvYi5kZXBlbmRlbmNpZXNbZF07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlcC5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBncmFwaC5zZXRFZGdlKGRlcC5uYW1lLCBqb2IubmFtZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbGFiZWxUeXBlOiAnaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9sYWJlbDogZGVwLm5hbWUgKyAnLS0+JyArIGpvYi5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyMFxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZENvdW50c1tkZXAubmFtZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZENvdW50c1tkZXAubmFtZV0gKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRDb3VudHNbZGVwLm5hbWVdID0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc2V0IHN0YXJ0IG5vZGUgYW5kIGVkZ2VzXG4gICAgICAgICAgICBncmFwaC5zZXROb2RlKCdzdGFydCcsIHtcbiAgICAgICAgICAgICAgICBsYWJlbFR5cGU6ICdodG1sJyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJzxkaXYgaWQ9XCJzdGFydFwiIGNsYXNzPVwicmVjaXBlTm9kZVwiIG9uY2xpY2s9XCJub2RlQ2xpY2soXFwnc3RhcnRcXCcpXCI+PHNwYW4gY2xhc3M9bmFtZT5TdGFydDwvc3Bhbj48L2Rpdj4nLFxuICAgICAgICAgICAgICAgIHJ4OiA1LFxuICAgICAgICAgICAgICAgIHJ5OiA1LFxuICAgICAgICAgICAgICAgIHBhZGRpbmc6IDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc3RhcnRKb2IgPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3N0YXJ0JyxcbiAgICAgICAgICAgICAgICBqb2JfdHlwZToge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1N0YXJ0J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaW5wdXRfZGF0YTogJHNjb3BlLnJlY2lwZVR5cGUuaW5wdXRfZGF0YVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBub0RlcHMgPSBfLmZpbHRlcihqb2JzLCAnZGVwU3RhcnQnLCB0cnVlKTtcbiAgICAgICAgICAgIGZvciAodmFyIG4gaW4gbm9EZXBzKSB7XG4gICAgICAgICAgICAgICAgZ3JhcGguc2V0RWRnZSgnc3RhcnQnLCBub0RlcHNbbl0ubmFtZSwge1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc2V0IGVuZCBub2RlIGFuZCBlZGdlc1xuICAgICAgICAgICAgZ3JhcGguc2V0Tm9kZSgnZW5kJywge1xuICAgICAgICAgICAgICAgIGxhYmVsVHlwZTogJ2h0bWwnLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnPGRpdj48c3BhbiBjbGFzcz1uYW1lPkVuZDwvc3Bhbj48L2Rpdj4nLFxuICAgICAgICAgICAgICAgIHJ4OiA1LFxuICAgICAgICAgICAgICAgIHJ5OiA1LFxuICAgICAgICAgICAgICAgIHBhZGRpbmc6IDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIG5vQ2hpbGRyZW4gPV8uZmlsdGVyKGpvYnMsIGZ1bmN0aW9uIChqb2IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gIWNoaWxkQ291bnRzW2pvYi5uYW1lXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZm9yICh2YXIgbyBpbiBub0NoaWxkcmVuKSB7XG4gICAgICAgICAgICAgICAgZ3JhcGguc2V0RWRnZShub0NoaWxkcmVuW29dLm5hbWUsICdlbmQnLCB7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyB3YWl0IGZvciBjdXJyZW50IGNhbGwgc3RhY2sgdG8gY2xlYXJcbiAgICAgICAgICAgIF8uZGVmZXIoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlubmVyLmNhbGwocmVuZGVyLCBncmFwaCk7XG5cbiAgICAgICAgICAgICAgICAvLyBab29tIGFuZCBzY2FsZSB0byBmaXRcbiAgICAgICAgICAgICAgICB2YXIgem9vbVNjYWxlID0gem9vbS5zY2FsZSgpO1xuICAgICAgICAgICAgICAgIHZhciBncmFwaFdpZHRoID0gZ3JhcGguZ3JhcGgoKS53aWR0aCArIDQwO1xuICAgICAgICAgICAgICAgIHZhciBncmFwaEhlaWdodCA9IGdyYXBoLmdyYXBoKCkuaGVpZ2h0ICsgNDA7XG4gICAgICAgICAgICAgICAgdmFyIHdpZHRoID0gcGFyc2VJbnQoc3ZnLnN0eWxlKFwid2lkdGhcIikucmVwbGFjZSgvcHgvLCBcIlwiKSk7XG4gICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IHBhcnNlSW50KHN2Zy5zdHlsZShcImhlaWdodFwiKS5yZXBsYWNlKC9weC8sIFwiXCIpKTtcbiAgICAgICAgICAgICAgICAvL3pvb21TY2FsZSA9IE1hdGgubWluKHdpZHRoIC8gZ3JhcGhXaWR0aCwgaGVpZ2h0IC8gZ3JhcGhIZWlnaHQpO1xuICAgICAgICAgICAgICAgIC8vaWYoem9vbVNjYWxlPDAuODApe1xuICAgICAgICAgICAgICAgIC8vICB6b29tU2NhbGUgPSAwLjgwO1xuICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgICAgICB6b29tU2NhbGUgPSAwLjc1O1xuICAgICAgICAgICAgICAgIGlmKHpvb21TY2FsZSA8IDEpe1xuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCd6b29tU2NhbGU6ICcgKyB6b29tU2NhbGUpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNsYXRlID0gWzAsMF07Ly8gWyh3aWR0aCp6b29tU2NhbGUpLShncmFwaFdpZHRoKnpvb21TY2FsZSksIDBdO1xuICAgICAgICAgICAgICAgICAgICB6b29tLnRyYW5zbGF0ZSh0cmFuc2xhdGUpO1xuICAgICAgICAgICAgICAgICAgICB6b29tLnNjYWxlKHpvb21TY2FsZSk7XG4gICAgICAgICAgICAgICAgICAgIHpvb20uZXZlbnQoaXNVcGRhdGUgPyBzdmcudHJhbnNpdGlvbigpLmR1cmF0aW9uKDUwMCkgOiBkMy5zZWxlY3QoXCJzdmdcIikpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGFkZCBzZWxlY3RlZCBjbGFzcyB0byBhcHByb3ByaWF0ZSBub2RlXG4gICAgICAgICAgICAgICAgaWYoJHNjb3BlLnNlbGVjdGVkSm9iKXtcbiAgICAgICAgICAgICAgICAgICAgJCgnIycgKyAkc2NvcGUuc2VsZWN0ZWRKb2IubmFtZSkuYWRkQ2xhc3MoJ3NlbGVjdGVkLW5vZGUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZ2V0RGVwZW5kZW50cyA9IGZ1bmN0aW9uIChuYW1lLG91dHB1dE5hbWUpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHRzID0gW107XG5cbiAgICAgICAgICAgIF8uZm9yRWFjaCgkc2NvcGUucmVjaXBlVHlwZS5kZWZpbml0aW9uLmpvYnMsIGZ1bmN0aW9uIChqb2IsIGtleSkge1xuICAgICAgICAgICAgICAgIGlmIChqb2IubmFtZSAhPT0gbmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2goam9iLmRlcGVuZGVuY2llcywgZnVuY3Rpb24gKGRlcGVuZGVuY3ksIGtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlcGVuZGVuY3kubmFtZSA9PT0gbmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZm9yRWFjaChkZXBlbmRlbmN5LmNvbm5lY3Rpb25zLCBmdW5jdGlvbiAoY29ubiwga2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25uLm91dHB1dCA9PT0gb3V0cHV0TmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBqb2IubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQ6IGNvbm4ub3V0cHV0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiBjb25uLmlucHV0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXRpYWxpemUoKTtcblxuICAgIH0pLmRpcmVjdGl2ZSgnYWlzU2NhbGVSZWNpcGVHcmFwaFZpZXdlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgICAgICAvKipcbiAgICAgICAgICogVXNhZ2U6IDxhaXMtc2NhbGUtcmVjaXBlLXZpZXdlciByZWNpcGU9XCJyZWNpcGVcIiAvPlxuICAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhaXNTY2FsZVJlY2lwZUdyYXBoVmlld2VyQ29udHJvbGxlcicsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvcmVjaXBlcy9wYXJ0aWFscy9yZWNpcGVHcmFwaFZpZXdlclRlbXBsYXRlLmh0bWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgcmVjaXBlVHlwZTogJz0nLFxuICAgICAgICAgICAgICAgIHJlY2lwZTogJz0nLFxuICAgICAgICAgICAgICAgIGlzTW9kaWZpZWQ6ICc9bW9kaWZpZWQnLFxuICAgICAgICAgICAgICAgIGFsbG93RWRpdDogJz0nLFxuICAgICAgICAgICAgICAgIGhhc0NvbnRhaW5lcjogJz0nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlKSB7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbEhlaWdodCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3JlY2lwZS12aWV3ZXItdGl0bGUnKVswXS5zY3JvbGxIZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmRldGFpbE1heEhlaWdodCA9IHNjb3BlLiRwYXJlbnQuZGV0YWlsTWF4SGVpZ2h0ID8gc2NvcGUuJHBhcmVudC5kZXRhaWxNYXhIZWlnaHQgLSBlbEhlaWdodCA6IDcwMDtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGV0YWlsQ29udGFpbmVyU3R5bGUgPSAnaGVpZ2h0OiAnICsgc2NvcGUuZGV0YWlsTWF4SGVpZ2h0ICsgJ3B4OyBtYXgtaGVpZ2h0OiAnICsgc2NvcGUuZGV0YWlsTWF4SGVpZ2h0ICsgJ3B4OyBvdmVyZmxvdy15OiBhdXRvOyc7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1JlY2lwZScsIGZ1bmN0aW9uIChSZWNpcGVUeXBlLCBzY2FsZVNlcnZpY2UpIHtcbiAgICAgICAgdmFyIFJlY2lwZSA9IGZ1bmN0aW9uIChpZCwgY3JlYXRlZCwgY29tcGxldGVkLCBsYXN0X21vZGlmaWVkLCByZWNpcGVfdHlwZSkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMuY29tcGxldGVkID0gY29tcGxldGVkO1xuICAgICAgICAgICAgdGhpcy5sYXN0X21vZGlmaWVkID0gbGFzdF9tb2RpZmllZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9zdGF0dXNfY2hhbmdlID0gbGFzdF9tb2RpZmllZCA/IG1vbWVudC5kdXJhdGlvbihtb21lbnQudXRjKGxhc3RfbW9kaWZpZWQpLmRpZmYobW9tZW50LnV0YygpKSkuaHVtYW5pemUodHJ1ZSkgOiAnJztcbiAgICAgICAgICAgIHRoaXMucmVjaXBlX3R5cGUgPSBSZWNpcGVUeXBlLnRyYW5zZm9ybWVyKHJlY2lwZV90eXBlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBwdWJsaWMgbWV0aG9kc1xuICAgICAgICBSZWNpcGUucHJvdG90eXBlID0ge1xuICAgICAgICAgICAgZ2V0RHVyYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2NhbGVTZXJ2aWNlLmNhbGN1bGF0ZUR1cmF0aW9uKHRoaXMuY3JlYXRlZCwgdGhpcy5sYXN0X21vZGlmaWVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgUmVjaXBlLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGUoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZWNpcGVfdHlwZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGUuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGU7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlRGF0YScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIFJlY2lwZURhdGEgPSBmdW5jdGlvbiAoaW5wdXRfZGF0YSwgdmVyc2lvbiwgd29ya3NwYWNlX2lkKSB7XG4gICAgICAgICAgICB0aGlzLmlucHV0X2RhdGEgPSBpbnB1dF9kYXRhO1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMud29ya3NwYWNlX2lkID0gd29ya3NwYWNlX2lkO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHN0YXRpYyBtZXRob2RzLCBhc3NpZ25lZCB0byBjbGFzc1xuICAgICAgICBSZWNpcGVEYXRhLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVEYXRhKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlucHV0X2RhdGEsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS53b3Jrc3BhY2VfaWRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVEYXRhKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUmVjaXBlRGF0YS50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGVEYXRhLmJ1aWxkKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFJlY2lwZURhdGEuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIFJlY2lwZURhdGE7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlRGV0YWlscycsIGZ1bmN0aW9uIChSZWNpcGVEYXRhLCBSZWNpcGVUeXBlRGVmaW5pdGlvbiwgUmVjaXBlVHlwZSwgUmVjaXBlVHlwZURldGFpbCwgUmVjaXBlSm9iQ29udGFpbmVyLCBzY2FsZUNvbmZpZykge1xuICAgICAgICB2YXIgUmVjaXBlRGV0YWlscyA9IGZ1bmN0aW9uIChpZCwgY3JlYXRlZCwgY29tcGxldGVkLCBsYXN0X21vZGlmaWVkLCBkYXRhLCByZWNpcGVfdHlwZSwgcmVjaXBlX3R5cGVfcmV2LCBqb2JzKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZWQgPSBjcmVhdGVkO1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZWQgPSBjb21wbGV0ZWQ7XG4gICAgICAgICAgICB0aGlzLmNvbXBsZXRlZF9mb3JtYXR0ZWQgPSB0aGlzLmNvbXBsZXRlZCA/IG1vbWVudC51dGModGhpcy5jb21wbGV0ZWQpLnRvSVNPU3RyaW5nKCkgOiB0aGlzLmNvbXBsZXRlZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBSZWNpcGVEYXRhLnRyYW5zZm9ybWVyKGRhdGEpO1xuICAgICAgICAgICAgdGhpcy5yZWNpcGVfdHlwZSA9IFJlY2lwZVR5cGUudHJhbnNmb3JtZXIocmVjaXBlX3R5cGUpO1xuICAgICAgICAgICAgdGhpcy5yZWNpcGVfdHlwZV9yZXYgPSBSZWNpcGVUeXBlRGV0YWlsLnRyYW5zZm9ybWVyKHJlY2lwZV90eXBlX3Jldik7XG4gICAgICAgICAgICB0aGlzLmpvYnMgPSBSZWNpcGVKb2JDb250YWluZXIudHJhbnNmb3JtZXIoam9icyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZURldGFpbHMuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZURldGFpbHMoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubGFzdF9tb2RpZmllZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kYXRhLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlY2lwZV90eXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlY2lwZV90eXBlX3JldixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlRGV0YWlscygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZURldGFpbHMudHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUmVjaXBlRGV0YWlscy5idWlsZClcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBSZWNpcGVEZXRhaWxzLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVEZXRhaWxzO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlSm9iJywgZnVuY3Rpb24gKEpvYlR5cGUpIHtcbiAgICAgICAgdmFyIFJlY2lwZUpvYiA9IGZ1bmN0aW9uIChpZCwgc3RhdHVzLCBqb2JfdHlwZSkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlID0gSm9iVHlwZS50cmFuc2Zvcm1lcihqb2JfdHlwZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZUpvYi5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlSm9iKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZUpvYigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZUpvYi50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGVKb2IuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlSm9iLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVKb2I7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlSm9iQ29udGFpbmVyJywgZnVuY3Rpb24gKFJlY2lwZUpvYikge1xuICAgICAgICB2YXIgUmVjaXBlSm9iQ29udGFpbmVyID0gZnVuY3Rpb24gKGpvYl9uYW1lLCBqb2IpIHtcbiAgICAgICAgICAgIHRoaXMuam9iX25hbWUgPSBqb2JfbmFtZTtcbiAgICAgICAgICAgIHRoaXMuam9iID0gUmVjaXBlSm9iLnRyYW5zZm9ybWVyKGpvYik7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZUpvYkNvbnRhaW5lci5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlSm9iQ29udGFpbmVyKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYl9uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYlxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZUpvYkNvbnRhaW5lcigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZUpvYkNvbnRhaW5lci50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGVKb2JDb250YWluZXIuYnVpbGQpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlSm9iQ29udGFpbmVyLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVKb2JDb250YWluZXI7XG4gICAgfSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlVHlwZScsIGZ1bmN0aW9uIChzY2FsZUNvbmZpZywgUmVjaXBlVHlwZURlZmluaXRpb24pIHtcbiAgICAgICAgdmFyIFJlY2lwZVR5cGUgPSBmdW5jdGlvbiAoaWQsIG5hbWUsIHZlcnNpb24sIHRpdGxlLCBkZXNjcmlwdGlvbiwgaXNfYWN0aXZlLCBkZWZpbml0aW9uLCByZXZpc2lvbl9udW0sIGNyZWF0ZWQsICBsYXN0X21vZGlmaWVkLCBhcmNoaXZlZCwgdHJpZ2dlcl9ydWxlKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIHRoaXMuaXNfYWN0aXZlID0gaXNfYWN0aXZlO1xuICAgICAgICAgICAgdGhpcy5kZWZpbml0aW9uID0gZGVmaW5pdGlvbiA/IFJlY2lwZVR5cGVEZWZpbml0aW9uLnRyYW5zZm9ybWVyKGRlZmluaXRpb24pIDogbmV3IFJlY2lwZVR5cGVEZWZpbml0aW9uKCk7XG4gICAgICAgICAgICB0aGlzLnJldmlzaW9uX251bSA9IHJldmlzaW9uX251bTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlZCA9IGNyZWF0ZWQ7XG4gICAgICAgICAgICB0aGlzLmxhc3RfbW9kaWZpZWQgPSBsYXN0X21vZGlmaWVkO1xuICAgICAgICAgICAgdGhpcy5hcmNoaXZlZCA9IGFyY2hpdmVkO1xuICAgICAgICAgICAgdGhpcy50cmlnZ2VyX3J1bGUgPSB0cmlnZ2VyX3J1bGU7XG4gICAgICAgICAgICB0aGlzLm1vZGlmaWVkID0gZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZVR5cGUuYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYoZGF0YSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVUeXBlKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pc19hY3RpdmUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVmaW5pdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZXZpc2lvbl9udW0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X21vZGlmaWVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmFyY2hpdmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRyaWdnZXJfcnVsZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZVR5cGUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBSZWNpcGVUeXBlLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YS5tYXAoUmVjaXBlVHlwZS5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlVHlwZS5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gUmVjaXBlVHlwZTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1JlY2lwZVR5cGVEZWZpbml0aW9uJywgZnVuY3Rpb24gKHNjYWxlQ29uZmlnLCBSZWNpcGVUeXBlRGVmaW5pdGlvbkpvYiwgSm9iVHlwZUlucHV0RGF0YSkge1xuXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgLy8gcHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIHZhciBSZWNpcGVUeXBlRGVmaW5pdGlvbiA9IGZ1bmN0aW9uIChpbnB1dF9kYXRhLCB2ZXJzaW9uLCBqb2JzKSB7XG4gICAgICAgICAgICB0aGlzLmlucHV0X2RhdGEgPSBpbnB1dF9kYXRhID8gSm9iVHlwZUlucHV0RGF0YS50cmFuc2Zvcm1lcihpbnB1dF9kYXRhKSA6IFtdO1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbiB8fCAnMS4wJztcbiAgICAgICAgICAgIHRoaXMuam9icyA9IGpvYnMgPyBSZWNpcGVUeXBlRGVmaW5pdGlvbkpvYi50cmFuc2Zvcm1lcihqb2JzKSA6IFtdO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRKb2JOYW1lID0gZnVuY3Rpb24oam9icywgam9iTmFtZSl7XG4gICAgICAgICAgICB2YXIgdGhlTmFtZSA9IGpvYk5hbWU7XG4gICAgICAgICAgICB2YXIgZXhpc3RpbmcgPSBfLmZpbmQoam9icywgeyAnbmFtZSc6IGpvYk5hbWUgfSk7XG4gICAgICAgICAgICB2YXIgaWR4ID0gMjtcbiAgICAgICAgICAgIHdoaWxlKGV4aXN0aW5nKXtcbiAgICAgICAgICAgICAgICB0aGVOYW1lID0gam9iTmFtZSArICctJyArIGlkeDtcbiAgICAgICAgICAgICAgICBleGlzdGluZyA9IF8uZmluZChqb2JzLCB7ICduYW1lJzogdGhlTmFtZSB9KTtcbiAgICAgICAgICAgICAgICBpZHgrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGVOYW1lO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHB1YmxpYyBtZXRob2RzXG4gICAgICAgIFJlY2lwZVR5cGVEZWZpbml0aW9uLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGFkZEpvYjogZnVuY3Rpb24gKGpvYlR5cGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgam5hbWUgPSBnZXRKb2JOYW1lKHRoaXMuam9icywgam9iVHlwZS5uYW1lKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhqbmFtZSk7XG4gICAgICAgICAgICAgICAgdmFyIGpvYiA9IHtcbiAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgcmVjaXBlX2lucHV0czogW10sXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGpuYW1lLFxuICAgICAgICAgICAgICAgICAgICBqb2JfdHlwZV9pZDogam9iVHlwZS5pZCxcbiAgICAgICAgICAgICAgICAgICAgam9iX3R5cGU6IGpvYlR5cGVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMuam9icy5wdXNoKGpvYik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZVR5cGVEZWZpbml0aW9uLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmKGRhdGEpe1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZURlZmluaXRpb24oXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaW5wdXRfZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS52ZXJzaW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmpvYnNcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVUeXBlRGVmaW5pdGlvbigpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJlY2lwZVR5cGVEZWZpbml0aW9uLnRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgICAgICAgICAubWFwKFJlY2lwZVR5cGVEZWZpbml0aW9uLmJ1aWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBSZWNpcGVUeXBlRGVmaW5pdGlvbi5idWlsZChkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gUmVjaXBlVHlwZURlZmluaXRpb247XG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCl7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlVHlwZURlZmluaXRpb25Kb2InLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIEpvYlR5cGVEZXRhaWxzKSB7XG4gICAgICAgIC8vIHByaXZhdGUgbWV0aG9kc1xuICAgICAgICB2YXIgUmVjaXBlVHlwZURlZmluaXRpb25Kb2IgPSBmdW5jdGlvbiAocmVjaXBlX2lucHV0cywgbmFtZSwgam9iX3R5cGUsIGRlcGVuZGVuY2llcykge1xuICAgICAgICAgICAgdGhpcy5yZWNpcGVfaW5wdXRzID0gcmVjaXBlX2lucHV0cztcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICB0aGlzLmpvYl90eXBlID0gam9iX3R5cGU7XG4gICAgICAgICAgICAvL3RoaXMuam9iX3R5cGUgPSB7XG4gICAgICAgICAgICAvLyAgICBuYW1lOiBqb2JfdHlwZS5uYW1lLFxuICAgICAgICAgICAgLy8gICAgdmVyc2lvbjogam9iX3R5cGUudmVyc2lvblxuICAgICAgICAgICAgLy99O1xuICAgICAgICAgICAgdGhpcy5kZXBlbmRlbmNpZXMgPSBkZXBlbmRlbmNpZXMgfHwgW107XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc3RhdGljIG1ldGhvZHMsIGFzc2lnbmVkIHRvIGNsYXNzXG4gICAgICAgIFJlY2lwZVR5cGVEZWZpbml0aW9uSm9iLmJ1aWxkID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVUeXBlRGVmaW5pdGlvbkpvYihcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5yZWNpcGVfaW5wdXRzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuam9iX3R5cGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVwZW5kZW5jaWVzXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZURlZmluaXRpb25Kb2IoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBSZWNpcGVUeXBlRGVmaW5pdGlvbkpvYi50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGVUeXBlRGVmaW5pdGlvbkpvYi5idWlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUmVjaXBlVHlwZURlZmluaXRpb25Kb2IuYnVpbGQoZGF0YSk7XG4gICAgICAgIH07XG5cblxuICAgICAgICByZXR1cm4gUmVjaXBlVHlwZURlZmluaXRpb25Kb2I7XG5cbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmZhY3RvcnkoJ1JlY2lwZVR5cGVEZXRhaWwnLCBmdW5jdGlvbiAoc2NhbGVDb25maWcsIFJlY2lwZVR5cGVEZWZpbml0aW9uLCBKb2JUeXBlRGV0YWlscykge1xuICAgICAgICB2YXIgUmVjaXBlVHlwZURldGFpbCA9IGZ1bmN0aW9uIChpZCwgbmFtZSwgdmVyc2lvbiwgdGl0bGUsIGRlc2NyaXB0aW9uLCBpc19hY3RpdmUsIGRlZmluaXRpb24sIGNyZWF0ZWQsIGxhc3RfbW9kaWZpZWQsIGFyY2hpdmVkLCB0cmlnZ2VyX3J1bGUsIGpvYl90eXBlcykge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICAgICAgICB0aGlzLmlzX2FjdGl2ZSA9IGlzX2FjdGl2ZTtcbiAgICAgICAgICAgIHRoaXMuZGVmaW5pdGlvbiA9IFJlY2lwZVR5cGVEZWZpbml0aW9uLnRyYW5zZm9ybWVyKGRlZmluaXRpb24pO1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVkID0gY3JlYXRlZDtcbiAgICAgICAgICAgIHRoaXMubGFzdF9tb2RpZmllZCA9IGxhc3RfbW9kaWZpZWQ7XG4gICAgICAgICAgICB0aGlzLmFyY2hpdmVkID0gYXJjaGl2ZWQ7XG4gICAgICAgICAgICB0aGlzLnRyaWdnZXJfcnVsZSA9IHRyaWdnZXJfcnVsZTtcbiAgICAgICAgICAgIHRoaXMuam9iX3R5cGVzID0gSm9iVHlwZURldGFpbHMudHJhbnNmb3JtZXIoam9iX3R5cGVzKTtcbiAgICAgICAgICAgIHRoaXMubW9kaWZpZWQgPSBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgUmVjaXBlVHlwZURldGFpbC5idWlsZCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmVjaXBlVHlwZURldGFpbChcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuaXNfYWN0aXZlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmRlZmluaXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5sYXN0X21vZGlmaWVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmFyY2hpdmVkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRyaWdnZXJfcnVsZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5qb2JfdHlwZXNcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSZWNpcGVUeXBlRGV0YWlsKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUmVjaXBlVHlwZURldGFpbC50cmFuc2Zvcm1lciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgLm1hcChSZWNpcGVUeXBlRGV0YWlsLmJ1aWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBSZWNpcGVUeXBlRGV0YWlsLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVUeXBlRGV0YWlsO1xuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NjYWxlQXBwJykuZmFjdG9yeSgnUmVjaXBlVHlwZVZhbGlkYXRpb24nLCBmdW5jdGlvbiAoUmVjaXBlVHlwZURlZmluaXRpb24pIHtcblxuICAgICAgICB2YXIgZ2V0UmVjaXBlVHlwZVZhbGlkYXRpb25Kb2JzID0gZnVuY3Rpb24oam9icyl7XG4gICAgICAgICAgICB2YXIgam9ic091dCA9IFtdO1xuICAgICAgICAgICAgXy5mb3JFYWNoKGpvYnMsIGZ1bmN0aW9uKGpvYil7XG4gICAgICAgICAgICAgICBqb2JzT3V0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgIHJlY2lwZV9pbnB1dHM6IGpvYi5yZWNpcGVfaW5wdXRzLFxuICAgICAgICAgICAgICAgICAgIG5hbWU6IGpvYi5uYW1lLFxuICAgICAgICAgICAgICAgICAgIGpvYl90eXBlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGpvYi5qb2JfdHlwZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiBqb2Iuam9iX3R5cGUudmVyc2lvblxuICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzOiBqb2IuZGVwZW5kZW5jaWVzXG4gICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gam9ic091dDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgUmVjaXBlVHlwZVZhbGlkYXRpb24gPSBmdW5jdGlvbiAoaWQsIG5hbWUsIHZlcnNpb24sIHRpdGxlLCBkZXNjcmlwdGlvbiwgZGVmaW5pdGlvbiwgdHJpZ2dlcl9ydWxlKSB7XG4gICAgICAgICAgICBpZihpZCl7XG4gICAgICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICAgICAgICAvL3RoaXMuZGVmaW5pdGlvbiA9IGRlZmluaXRpb24gPyBSZWNpcGVUeXBlRGVmaW5pdGlvbi50cmFuc2Zvcm1lcihkZWZpbml0aW9uKSA6IG5ldyBSZWNpcGVUeXBlRGVmaW5pdGlvbigpO1xuICAgICAgICAgICAgdGhpcy5kZWZpbml0aW9uID0ge1xuICAgICAgICAgICAgICAgIGlucHV0X2RhdGE6IGRlZmluaXRpb24uaW5wdXRfZGF0YSxcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiBkZWZpbml0aW9uLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgam9iczogZ2V0UmVjaXBlVHlwZVZhbGlkYXRpb25Kb2JzKGRlZmluaXRpb24uam9icylcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLnRyaWdnZXJfcnVsZSA9IHRyaWdnZXJfcnVsZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBzdGF0aWMgbWV0aG9kcywgYXNzaWduZWQgdG8gY2xhc3NcbiAgICAgICAgUmVjaXBlVHlwZVZhbGlkYXRpb24uYnVpbGQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZVR5cGVWYWxpZGF0aW9uKFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmlkLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS50aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5kZWZpbml0aW9uLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnRyaWdnZXJfcnVsZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJlY2lwZVR5cGVWYWxpZGF0aW9uKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgUmVjaXBlVHlwZVZhbGlkYXRpb24udHJhbnNmb3JtZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShkYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoUmVjaXBlVHlwZVZhbGlkYXRpb24uYnVpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFJlY2lwZVR5cGVWYWxpZGF0aW9uLmJ1aWxkKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBSZWNpcGVUeXBlVmFsaWRhdGlvbjtcbiAgICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2NhbGVBcHAnKS5zZXJ2aWNlKCdyZWNpcGVTZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCAkcSwgJHRpbWVvdXQsIHNjYWxlQ29uZmlnLCBSZWNpcGVUeXBlLCBSZWNpcGVUeXBlRGV0YWlsLCBSZWNpcGUsIFJlY2lwZURldGFpbHMsIFJlY2lwZVR5cGVWYWxpZGF0aW9uKSB7XG4gICAgICAgIHZhciBnZXRSZWNpcGVzUGFyYW1zID0gZnVuY3Rpb24gKHBhZ2UsIHBhZ2Vfc2l6ZSwgc3RhcnRlZCwgZW5kZWQsIG9yZGVyLCBjb21wbGV0ZWQsIHJlY2lwZV90eXBlX2lkLCByZWNpcGVfdHlwZV9uYW1lLCB1cmwpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcGFnZTogcGFnZSxcbiAgICAgICAgICAgICAgICBwYWdlX3NpemU6IHBhZ2Vfc2l6ZSxcbiAgICAgICAgICAgICAgICBzdGFydGVkOiBzdGFydGVkLFxuICAgICAgICAgICAgICAgIGVuZGVkOiBlbmRlZCxcbiAgICAgICAgICAgICAgICBvcmRlcjogb3JkZXIsXG4gICAgICAgICAgICAgICAgY29tcGxldGVkOiBjb21wbGV0ZWQsXG4gICAgICAgICAgICAgICAgcmVjaXBlX3R5cGVfaWQ6IHJlY2lwZV90eXBlX2lkLFxuICAgICAgICAgICAgICAgIHJlY2lwZV90eXBlX25hbWU6IHJlY2lwZV90eXBlX25hbWUsXG4gICAgICAgICAgICAgICAgdXJsOiB1cmxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldFJlY2lwZVR5cGVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgICRodHRwLmdldChzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdyZWNpcGUtdHlwZXMvJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkLnJlc29sdmUoUmVjaXBlVHlwZS50cmFuc2Zvcm1lcihkYXRhLnJlc3VsdHMpKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBnZXRSZWNpcGVUeXBlRGV0YWlsOiBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICRodHRwLmdldChzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdyZWNpcGUtdHlwZXMvJyArIGlkICsgJy8nKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJldHVybkRhdGEgPSBSZWNpcGVUeXBlRGV0YWlsLnRyYW5zZm9ybWVyKGRhdGEpO1xuICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXR1cm5EYXRhKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHJldHVybiBkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBnZXRSZWNpcGVzOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IGdldFJlY2lwZXNQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogcGFyYW1zLnVybCA/IHBhcmFtcy51cmwgOiBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdyZWNpcGVzLycsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMgPSBSZWNpcGUudHJhbnNmb3JtZXIoZGF0YS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZ2V0UmVjaXBlRGV0YWlsczogZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgICRodHRwLmdldChzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdyZWNpcGVzLycgKyBpZCArICcvJykuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gUmVjaXBlRGV0YWlscy50cmFuc2Zvcm1lcihkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgc2F2ZVJlY2lwZVR5cGU6IGZ1bmN0aW9uKHJlY2lwZVR5cGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIGNsZWFuUmVjaXBlVHlwZSA9IFJlY2lwZVR5cGVWYWxpZGF0aW9uLnRyYW5zZm9ybWVyKHJlY2lwZVR5cGUpO1xuXG4gICAgICAgICAgICAgICAgaWYoIWNsZWFuUmVjaXBlVHlwZS5pZCl7XG4gICAgICAgICAgICAgICAgICAgICRodHRwLnBvc3Qoc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAncmVjaXBlLXR5cGVzLycsIGNsZWFuUmVjaXBlVHlwZSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWNpcGVUeXBlLmlkID0gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgICAgZC5yZXNvbHZlKHJlY2lwZVR5cGUpO1xuICAgICAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRodHRwLnBhdGNoKHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3JlY2lwZS10eXBlcy8nICsgY2xlYW5SZWNpcGVUeXBlLmlkICsgJy8nLCBjbGVhblJlY2lwZVR5cGUpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVjaXBlVHlwZSA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZWNpcGVUeXBlKTtcbiAgICAgICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oZXJyb3Ipe1xuICAgICAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgdmFsaWRhdGVSZWNpcGVUeXBlOiBmdW5jdGlvbiAocmVjaXBlVHlwZSkge1xuICAgICAgICAgICAgICAgIHZhciBkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgY2xlYW5SZWNpcGVUeXBlID0gUmVjaXBlVHlwZVZhbGlkYXRpb24udHJhbnNmb3JtZXIocmVjaXBlVHlwZSk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3JlY2lwZS10eXBlcy92YWxpZGF0aW9uLycsIGNsZWFuUmVjaXBlVHlwZSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGVycm9yKXtcbiAgICAgICAgICAgICAgICAgICAgZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLnNlcnZpY2UoJ3dvcmtzcGFjZXNTZXJ2aWNlJywgZnVuY3Rpb24oJGh0dHAsICRxLCAkcmVzb3VyY2UsIHNjYWxlQ29uZmlnKSB7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldFdvcmtzcGFjZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3dvcmtzcGFjZXMvJztcblxuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCdcbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGQucmVzb2x2ZShkYXRhLnJlc3VsdHMpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQucHJvbWlzZTtcbiAgICAgICAgICAgIH0vLyxcbiAgICAgICAgICAgIC8vZ2V0V29ya3NwYWNlRGV0YWlsczogZnVuY3Rpb24oaWQpIHtcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvL31cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7XG4iLCIvKipcbiAqIEBhdXRob3IgRGltaXRyeSBLdWRyYXl2dHNldlxuICogQHZlcnNpb24gMi4xXG4gKi9cblxuIHZhciB1cGRhdGVXaW5kb3cgPSBmdW5jdGlvbigpe1xuICAgIC8vICB4ID0gdy5pbm5lcldpZHRoIHx8IGUuY2xpZW50V2lkdGggfHwgZy5jbGllbnRXaWR0aDtcbiAgICAvLyAgeSA9IHcuaW5uZXJIZWlnaHR8fCBlLmNsaWVudEhlaWdodHx8IGcuY2xpZW50SGVpZ2h0O1xuICAgICAvL1xuICAgIC8vICBzdmcuYXR0cihcIndpZHRoXCIsIHgpLmF0dHIoXCJoZWlnaHRcIiwgeSk7XG4gICAgY29uc29sZS5sb2coJ3Jlc2l6ZScpO1xuIH07XG5cbiB3aW5kb3cub25yZXNpemUgPSB1cGRhdGVXaW5kb3c7XG5cbmQzLmdhbnR0ID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIEZJVF9USU1FX0RPTUFJTl9NT0RFID0gXCJmaXRcIjtcbiAgICB2YXIgRklYRURfVElNRV9ET01BSU5fTU9ERSA9IFwiZml4ZWRcIjtcblxuICAgIHZhciBtYXJnaW4gPSB7XG5cdFx0dG9wIDogMjAsXG5cdFx0cmlnaHQgOiAyMCxcblx0XHRib3R0b20gOiAyMCxcblx0XHRsZWZ0IDogNjBcbiAgICB9O1xuICAgIHZhciB0aW1lRG9tYWluU3RhcnQgPSBkMy50aW1lLmRheS5vZmZzZXQobmV3IERhdGUoKSwtMyk7XG4gICAgdmFyIHRpbWVEb21haW5FbmQgPSBkMy50aW1lLmhvdXIub2Zmc2V0KG5ldyBEYXRlKCksKzMpO1xuICAgIHZhciB0aW1lRG9tYWluTW9kZSA9IEZJVF9USU1FX0RPTUFJTl9NT0RFOy8vIGZpeGVkIG9yIGZpdFxuICAgIHZhciB0YXNrVHlwZXMgPSBbXTtcbiAgICB2YXIgdGFza1N0YXR1cyA9IFtdO1xuICAgIHZhciBoZWlnaHQgPSBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodCAtIG1hcmdpbi50b3AgLSBtYXJnaW4uYm90dG9tLTU7XG4gICAgdmFyIHdpZHRoID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aCAtIG1hcmdpbi5yaWdodCAtIG1hcmdpbi5sZWZ0LTU7XG5cdHZhciByZW5kZXJUbyA9IFwiYm9keVwiO1xuXHR2YXIgYmVnaW4gPSAnJztcblx0dmFyIGVuZGVkID0gJyc7XG5cbiAgICB2YXIgdGlja0Zvcm1hdCA9IFwiJUg6JU06JVNcIjtcblxuICAgIHZhciBrZXlGdW5jdGlvbiA9IGZ1bmN0aW9uKGQpIHtcblx0XHRyZXR1cm4gZFtiZWdpbl0gKyBkLnRhc2tOYW1lICsgZFtlbmRlZF07XG4gICAgfTtcblxuICAgIHZhciByZWN0VHJhbnNmb3JtID0gZnVuY3Rpb24oZCkge1xuXHRcdHJldHVybiBcInRyYW5zbGF0ZShcIiArIHgoZFtiZWdpbl0pICsgXCIsXCIgKyB5KGQudGFza05hbWUpICsgXCIpXCI7XG4gICAgfTtcblxuICAgIHZhciB4ID0gZDMudGltZS5zY2FsZSgpLmRvbWFpbihbIHRpbWVEb21haW5TdGFydCwgdGltZURvbWFpbkVuZCBdKS5yYW5nZShbIDAsIHdpZHRoIF0pLmNsYW1wKHRydWUpO1xuXG4gICAgdmFyIHkgPSBkMy5zY2FsZS5vcmRpbmFsKCkuZG9tYWluKHRhc2tUeXBlcykucmFuZ2VSb3VuZEJhbmRzKFsgMCwgaGVpZ2h0IC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b20gXSwgLjEpO1xuXG4gICAgdmFyIHhBeGlzID0gZDMuc3ZnLmF4aXMoKS5zY2FsZSh4KS5vcmllbnQoXCJib3R0b21cIikudGlja0Zvcm1hdChkMy50aW1lLmZvcm1hdCh0aWNrRm9ybWF0KSkudGlja1N1YmRpdmlkZSh0cnVlKVxuXHQgICAgLnRpY2tTaXplKDgpLnRpY2tQYWRkaW5nKDgpO1xuXG4gICAgdmFyIHlBeGlzID0gZDMuc3ZnLmF4aXMoKS5zY2FsZSh5KS5vcmllbnQoXCJsZWZ0XCIpLnRpY2tTaXplKDApO1xuXG4gICAgdmFyIGluaXRUaW1lRG9tYWluID0gZnVuY3Rpb24odGFza3MpIHtcblx0aWYgKHRpbWVEb21haW5Nb2RlID09PSBGSVRfVElNRV9ET01BSU5fTU9ERSkge1xuXHQgICAgaWYgKHRhc2tzID09PSB1bmRlZmluZWQgfHwgdGFza3MubGVuZ3RoIDwgMSkge1xuXHRcdHRpbWVEb21haW5TdGFydCA9IGQzLnRpbWUuZGF5Lm9mZnNldChuZXcgRGF0ZSgpLCAtMyk7XG5cdFx0dGltZURvbWFpbkVuZCA9IGQzLnRpbWUuaG91ci5vZmZzZXQobmV3IERhdGUoKSwgKzMpO1xuXHRcdHJldHVybjtcblx0ICAgIH1cblx0ICAgIHRhc2tzLnNvcnQoZnVuY3Rpb24oYSwgYikge1xuXHRcdHJldHVybiBhW2VuZGVkXSAtIGJbZW5kZWRdO1xuXHQgICAgfSk7XG5cdCAgICB0aW1lRG9tYWluRW5kID0gdGFza3NbdGFza3MubGVuZ3RoIC0gMV1bZW5kZWRdO1xuXHQgICAgdGFza3Muc29ydChmdW5jdGlvbihhLCBiKSB7XG5cdFx0cmV0dXJuIGFbYmVnaW5dIC0gYltiZWdpbl07XG5cdCAgICB9KTtcblx0ICAgIHRpbWVEb21haW5TdGFydCA9IHRhc2tzWzBdW2JlZ2luXTtcblx0fVxuICAgIH07XG5cbiAgICB2YXIgaW5pdEF4aXMgPSBmdW5jdGlvbigpIHtcblx0eCA9IGQzLnRpbWUuc2NhbGUoKS5kb21haW4oWyB0aW1lRG9tYWluU3RhcnQsIHRpbWVEb21haW5FbmQgXSkucmFuZ2UoWyAwLCB3aWR0aCBdKS5jbGFtcCh0cnVlKTtcblx0eSA9IGQzLnNjYWxlLm9yZGluYWwoKS5kb21haW4odGFza1R5cGVzKS5yYW5nZVJvdW5kQmFuZHMoWyAwLCBoZWlnaHQgLSBtYXJnaW4udG9wIC0gbWFyZ2luLmJvdHRvbSBdLCAuMSk7XG5cdHhBeGlzID0gZDMuc3ZnLmF4aXMoKS5zY2FsZSh4KS5vcmllbnQoXCJib3R0b21cIikudGlja3MoTWF0aC5jZWlsKHdpZHRoLzE1MCkpLnRpY2tGb3JtYXQoZDMudGltZS5mb3JtYXQodGlja0Zvcm1hdCkpLnRpY2tTdWJkaXZpZGUodHJ1ZSlcblx0XHQudGlja1NpemUoOCkudGlja1BhZGRpbmcoOCk7XG5cblx0eUF4aXMgPSBkMy5zdmcuYXhpcygpLnNjYWxlKHkpLm9yaWVudChcImxlZnRcIikudGlja1NpemUoMCk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGdhbnR0KHRhc2tzKSB7XG5cblx0aW5pdFRpbWVEb21haW4odGFza3MpO1xuXHRpbml0QXhpcygpO1xuXG5cdHZhciBzdmcgPSBkMy5zZWxlY3QocmVuZGVyVG8pXG5cdC5hcHBlbmQoXCJzdmdcIilcblx0LmF0dHIoXCJjbGFzc1wiLCBcImNoYXJ0XCIpXG5cdC5hdHRyKFwid2lkdGhcIiwgd2lkdGggKyBtYXJnaW4ubGVmdCArIG1hcmdpbi5yaWdodClcblx0LmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0ICsgbWFyZ2luLnRvcCArIG1hcmdpbi5ib3R0b20pXG5cdC5hcHBlbmQoXCJnXCIpXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJnYW50dC1jaGFydFwiKVxuXHQuYXR0cihcIndpZHRoXCIsIHdpZHRoICsgbWFyZ2luLmxlZnQgKyBtYXJnaW4ucmlnaHQpXG5cdC5hdHRyKFwiaGVpZ2h0XCIsIGhlaWdodCArIG1hcmdpbi50b3AgKyBtYXJnaW4uYm90dG9tKVxuXHQuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIG1hcmdpbi5sZWZ0ICsgXCIsIFwiICsgbWFyZ2luLnRvcCArIFwiKVwiKTtcblxuICAgICAgc3ZnLnNlbGVjdEFsbChcIi5jaGFydFwiKVxuXHQgLmRhdGEodGFza3MsIGtleUZ1bmN0aW9uKS5lbnRlcigpXG5cdCAuYXBwZW5kKFwicmVjdFwiKVxuXHQgLmF0dHIoXCJyeFwiLCA1KVxuICAgICAgICAgLmF0dHIoXCJyeVwiLCA1KVxuXHQgLmF0dHIoXCJjbGFzc1wiLCBmdW5jdGlvbihkKXtcblx0ICAgICBpZih0YXNrU3RhdHVzW2Quc3RhdHVzXSA9PSBudWxsKXsgcmV0dXJuIFwiYmFyXCI7fVxuXHQgICAgIHJldHVybiB0YXNrU3RhdHVzW2Quc3RhdHVzXTtcblx0ICAgICB9KVxuXHQgLmF0dHIoXCJ5XCIsIDApXG5cdCAuYXR0cihcInRyYW5zZm9ybVwiLCByZWN0VHJhbnNmb3JtKVxuXHQgLmF0dHIoXCJoZWlnaHRcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geS5yYW5nZUJhbmQoKTsgfSlcblx0IC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24oZCkge1xuXHQgICAgIHJldHVybiAoeChkW2VuZGVkXSkgLSB4KGRbYmVnaW5dKSk7XG5cdCAgICAgfSk7XG5cblxuXHQgc3ZnLmFwcGVuZChcImdcIilcblx0IC5hdHRyKFwiY2xhc3NcIiwgXCJ4IGF4aXNcIilcblx0IC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsIFwiICsgKGhlaWdodCAtIG1hcmdpbi50b3AgLSBtYXJnaW4uYm90dG9tKSArIFwiKVwiKVxuXHQgLnRyYW5zaXRpb24oKVxuXHQgLmNhbGwoeEF4aXMpO1xuXG5cdCBzdmcuYXBwZW5kKFwiZ1wiKS5hdHRyKFwiY2xhc3NcIiwgXCJ5IGF4aXNcIikudHJhbnNpdGlvbigpLmNhbGwoeUF4aXMpO1xuXG5cdCByZXR1cm4gZ2FudHQ7XG5cbiAgICB9O1xuXG4gICAgZ2FudHQucmVkcmF3ID0gZnVuY3Rpb24odGFza3MpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3JlZHJhdycpO1xuXHRpbml0VGltZURvbWFpbih0YXNrcyk7XG5cdGluaXRBeGlzKCk7XG5cbiAgICAgICAgdmFyIHN2ZyA9IGQzLnNlbGVjdChcInN2Z1wiKTtcblxuICAgICAgICB2YXIgZ2FudHRDaGFydEdyb3VwID0gc3ZnLnNlbGVjdChcIi5nYW50dC1jaGFydFwiKTtcbiAgICAgICAgdmFyIHJlY3QgPSBnYW50dENoYXJ0R3JvdXAuc2VsZWN0QWxsKFwicmVjdFwiKS5kYXRhKHRhc2tzLCBrZXlGdW5jdGlvbik7XG5cbiAgICAgICAgcmVjdC5lbnRlcigpXG4gICAgICAgICAuaW5zZXJ0KFwicmVjdFwiLFwiOmZpcnN0LWNoaWxkXCIpXG4gICAgICAgICAuYXR0cihcInJ4XCIsIDUpXG4gICAgICAgICAuYXR0cihcInJ5XCIsIDUpXG5cdCAuYXR0cihcImNsYXNzXCIsIGZ1bmN0aW9uKGQpe1xuXHQgICAgIGlmKHRhc2tTdGF0dXNbZC5zdGF0dXNdID09IG51bGwpeyByZXR1cm4gXCJiYXJcIjt9XG5cdCAgICAgcmV0dXJuIHRhc2tTdGF0dXNbZC5zdGF0dXNdO1xuXHQgICAgIH0pXG5cdCAudHJhbnNpdGlvbigpXG5cdCAuYXR0cihcInlcIiwgMClcblx0IC5hdHRyKFwidHJhbnNmb3JtXCIsIHJlY3RUcmFuc2Zvcm0pXG5cdCAuYXR0cihcImhlaWdodFwiLCBmdW5jdGlvbihkKSB7IHJldHVybiB5LnJhbmdlQmFuZCgpOyB9KVxuXHQgIC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24oZCkge1xuXHQgICAgIHJldHVybiAoeChkW2VuZGVkXSkgLSB4KGRbYmVnaW5dKSk7XG5cdCAgICAgfSk7XG5cbiAgICAgICAgcmVjdC50cmFuc2l0aW9uKClcbiAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCByZWN0VHJhbnNmb3JtKVxuXHQgLmF0dHIoXCJoZWlnaHRcIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4geS5yYW5nZUJhbmQoKTsgfSlcblx0IC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24oZCkge1xuXHQgICAgIHJldHVybiAoeChkW2VuZGVkXSkgLSB4KGRbYmVnaW5dKSk7XG5cdCAgICAgfSk7XG5cblx0cmVjdC5leGl0KCkucmVtb3ZlKCk7XG5cblx0c3ZnLnNlbGVjdChcIi54XCIpLnRyYW5zaXRpb24oKS5jYWxsKHhBeGlzKTtcblx0c3ZnLnNlbGVjdChcIi55XCIpLnRyYW5zaXRpb24oKS5jYWxsKHlBeGlzKTtcblxuXHRyZXR1cm4gZ2FudHQ7XG4gICAgfTtcblxuICAgIGdhbnR0Lm1hcmdpbiA9IGZ1bmN0aW9uKHZhbHVlKSB7XG5cdGlmICghYXJndW1lbnRzLmxlbmd0aClcblx0ICAgIHJldHVybiBtYXJnaW47XG5cdG1hcmdpbiA9IHZhbHVlO1xuXHRyZXR1cm4gZ2FudHQ7XG4gICAgfTtcblxuICAgIGdhbnR0LnRpbWVEb21haW4gPSBmdW5jdGlvbih2YWx1ZSkge1xuXHRpZiAoIWFyZ3VtZW50cy5sZW5ndGgpXG5cdCAgICByZXR1cm4gWyB0aW1lRG9tYWluU3RhcnQsIHRpbWVEb21haW5FbmQgXTtcblx0dGltZURvbWFpblN0YXJ0ID0gK3ZhbHVlWzBdLCB0aW1lRG9tYWluRW5kID0gK3ZhbHVlWzFdO1xuXHRyZXR1cm4gZ2FudHQ7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfVxuICAgICAqICAgICAgICAgICAgICAgIHZhbGUgVGhlIHZhbHVlIGNhbiBiZSBcImZpdFwiIC0gdGhlIGRvbWFpbiBmaXRzIHRoZSBkYXRhIG9yXG4gICAgICogICAgICAgICAgICAgICAgXCJmaXhlZFwiIC0gZml4ZWQgZG9tYWluLlxuICAgICAqL1xuICAgIGdhbnR0LnRpbWVEb21haW5Nb2RlID0gZnVuY3Rpb24odmFsdWUpIHtcblx0aWYgKCFhcmd1bWVudHMubGVuZ3RoKVxuXHQgICAgcmV0dXJuIHRpbWVEb21haW5Nb2RlO1xuICAgICAgICB0aW1lRG9tYWluTW9kZSA9IHZhbHVlO1xuICAgICAgICByZXR1cm4gZ2FudHQ7XG5cbiAgICB9O1xuXG4gICAgZ2FudHQudGFza1R5cGVzID0gZnVuY3Rpb24odmFsdWUpIHtcblx0aWYgKCFhcmd1bWVudHMubGVuZ3RoKVxuXHQgICAgcmV0dXJuIHRhc2tUeXBlcztcblx0dGFza1R5cGVzID0gdmFsdWU7XG5cdHJldHVybiBnYW50dDtcbiAgICB9O1xuXG4gICAgZ2FudHQudGFza1N0YXR1cyA9IGZ1bmN0aW9uKHZhbHVlKSB7XG5cdGlmICghYXJndW1lbnRzLmxlbmd0aClcblx0ICAgIHJldHVybiB0YXNrU3RhdHVzO1xuXHR0YXNrU3RhdHVzID0gdmFsdWU7XG5cdHJldHVybiBnYW50dDtcbiAgICB9O1xuXG5cdGdhbnR0LmJlZ2luID0gZnVuY3Rpb24odmFsdWUpe1xuXHRcdGlmKCFhcmd1bWVudHMubGVuZ3RoKXtcblx0XHRcdHJldHVybiBiZWdpbjtcblx0XHR9XG5cdFx0YmVnaW4gPSB2YWx1ZTtcblx0XHRyZXR1cm4gZ2FudHQ7XG5cdH07XG5cblx0Z2FudHQuZW5kZWQgPSBmdW5jdGlvbih2YWx1ZSl7XG5cdFx0aWYoIWFyZ3VtZW50cy5sZW5ndGgpe1xuXHRcdFx0cmV0dXJuIGVuZGVkO1xuXHRcdH1cblx0XHRlbmRlZCA9IHZhbHVlO1xuXHRcdHJldHVybiBnYW50dDtcblx0fTtcblxuICAgIGdhbnR0LndpZHRoID0gZnVuY3Rpb24odmFsdWUpIHtcblx0aWYgKCFhcmd1bWVudHMubGVuZ3RoKVxuXHQgICAgcmV0dXJuIHdpZHRoO1xuXHR3aWR0aCA9ICt2YWx1ZTtcblx0cmV0dXJuIGdhbnR0O1xuICAgIH07XG5cbiAgICBnYW50dC5oZWlnaHQgPSBmdW5jdGlvbih2YWx1ZSkge1xuXHRpZiAoIWFyZ3VtZW50cy5sZW5ndGgpXG5cdCAgICByZXR1cm4gaGVpZ2h0O1xuXHRoZWlnaHQgPSArdmFsdWU7XG5cdHJldHVybiBnYW50dDtcbiAgICB9O1xuXG4gICAgZ2FudHQudGlja0Zvcm1hdCA9IGZ1bmN0aW9uKHZhbHVlKSB7XG5cdGlmICghYXJndW1lbnRzLmxlbmd0aClcblx0ICAgIHJldHVybiB0aWNrRm9ybWF0O1xuXHR0aWNrRm9ybWF0ID0gdmFsdWU7XG5cdHJldHVybiBnYW50dDtcbiAgICB9O1xuXG5cdGdhbnR0LnJlbmRlclRvID0gZnVuY3Rpb24odmFsdWUpIHtcblx0XHRpZighYXJndW1lbnRzLmxlbmd0aCl7XG5cdFx0XHRyZXR1cm4gcmVuZGVyVG87XG5cdFx0fVxuXHRcdHJlbmRlclRvID0gdmFsdWU7XG5cdFx0cmV0dXJuIGdhbnR0O1xuXHR9O1xuXG5cblxuICAgIHJldHVybiBnYW50dDtcbn07XG4iLCJmdW5jdGlvbiBHYXVnZShwbGFjZWhvbGRlck5hbWUsIGNvbmZpZ3VyYXRpb24pXG57XG4gICAgdGhpcy5wbGFjZWhvbGRlck5hbWUgPSBwbGFjZWhvbGRlck5hbWU7XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7IC8vIGZvciBpbnRlcm5hbCBkMyBmdW5jdGlvbnNcblxuICAgIHRoaXMuY29uZmlndXJlID0gZnVuY3Rpb24oY29uZmlndXJhdGlvbilcbiAgICB7XG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlndXJhdGlvbjtcblxuICAgICAgICB0aGlzLmNvbmZpZy5zaXplID0gdGhpcy5jb25maWcuc2l6ZSAqIDAuOTtcblxuICAgICAgICB0aGlzLmNvbmZpZy5yYWR1aXMgPSB0aGlzLmNvbmZpZy5zaXplICogMC45NyAvIDI7XG4gICAgICAgIHRoaXMuY29uZmlnLmN4ID0gdGhpcy5jb25maWcuc2l6ZSAvIDI7XG4gICAgICAgIHRoaXMuY29uZmlnLmN5ID0gdGhpcy5jb25maWcuc2l6ZSAvIDI7XG5cbiAgICAgICAgdGhpcy5jb25maWcubWluID0gdW5kZWZpbmVkICE9IGNvbmZpZ3VyYXRpb24ubWluID8gY29uZmlndXJhdGlvbi5taW4gOiAwO1xuICAgICAgICB0aGlzLmNvbmZpZy5tYXggPSB1bmRlZmluZWQgIT0gY29uZmlndXJhdGlvbi5tYXggPyBjb25maWd1cmF0aW9uLm1heCA6IDEwMDtcbiAgICAgICAgdGhpcy5jb25maWcucmFuZ2UgPSB0aGlzLmNvbmZpZy5tYXggLSB0aGlzLmNvbmZpZy5taW47XG5cbiAgICAgICAgdGhpcy5jb25maWcubWFqb3JUaWNrcyA9IGNvbmZpZ3VyYXRpb24ubWFqb3JUaWNrcyB8fCA1O1xuICAgICAgICB0aGlzLmNvbmZpZy5taW5vclRpY2tzID0gY29uZmlndXJhdGlvbi5taW5vclRpY2tzIHx8IDI7XG5cbiAgICAgICAgdGhpcy5jb25maWcuZ3JlZW5Db2xvciBcdD0gY29uZmlndXJhdGlvbi5ncmVlbkNvbG9yIHx8IFwiIzhmY2EwZVwiO1xuICAgICAgICB0aGlzLmNvbmZpZy55ZWxsb3dDb2xvciA9IGNvbmZpZ3VyYXRpb24ueWVsbG93Q29sb3IgfHwgXCIjZmZjMzE3XCI7XG4gICAgICAgIHRoaXMuY29uZmlnLnJlZENvbG9yIFx0PSBjb25maWd1cmF0aW9uLnJlZENvbG9yIHx8IFwiI2Y1NGQzNlwiO1xuXG4gICAgICAgIHRoaXMuY29uZmlnLnRyYW5zaXRpb25EdXJhdGlvbiA9IGNvbmZpZ3VyYXRpb24udHJhbnNpdGlvbkR1cmF0aW9uIHx8IDUwMDtcbiAgICB9O1xuXG4gICAgdGhpcy5yZW5kZXIgPSBmdW5jdGlvbigpXG4gICAge1xuICAgICAgICB0aGlzLmJvZHkgPSBkMy5zZWxlY3QoXCIjXCIgKyB0aGlzLnBsYWNlaG9sZGVyTmFtZSlcbiAgICAgICAgICAgIC5hcHBlbmQoXCJzdmc6c3ZnXCIpXG4gICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiZ2F1Z2VcIilcbiAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgdGhpcy5jb25maWcuc2l6ZSlcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIHRoaXMuY29uZmlnLnNpemUpO1xuXG4gICAgICAgIHRoaXMuYm9keS5hcHBlbmQoXCJzdmc6Y2lyY2xlXCIpXG4gICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwib3V0ZXItY2lyY2xlXCIpXG4gICAgICAgICAgICAuYXR0cihcImN4XCIsIHRoaXMuY29uZmlnLmN4KVxuICAgICAgICAgICAgLmF0dHIoXCJjeVwiLCB0aGlzLmNvbmZpZy5jeSlcbiAgICAgICAgICAgIC5hdHRyKFwiclwiLCB0aGlzLmNvbmZpZy5yYWR1aXMgKiAwLjk1KVxuICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBcIiNjY2NcIik7XG4gICAgICAgICAgICAvKi5zdHlsZShcInN0cm9rZVwiLCBcIiMwMDBcIilcbiAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCBcIjAuNXB4XCIpOyovXG5cbiAgICAgICAgdGhpcy5ib2R5LmFwcGVuZChcInN2ZzpjaXJjbGVcIilcbiAgICAgICAgICAgIC5hdHRyKFwiY3hcIiwgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAuYXR0cihcImN5XCIsIHRoaXMuY29uZmlnLmN5KVxuICAgICAgICAgICAgLmF0dHIoXCJyXCIsIDAuOSAqIHRoaXMuY29uZmlnLnJhZHVpcylcbiAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgXCIjZmZmXCIpXG4gICAgICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCIjZTBlMGUwXCIpXG4gICAgICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgXCIycHhcIik7XG5cbiAgICAgICAgZm9yICh2YXIgZ3JlZW5JZHggaW4gdGhpcy5jb25maWcuZ3JlZW5ab25lcylcbiAgICAgICAge1xuICAgICAgICAgICAgdGhpcy5kcmF3QmFuZCh0aGlzLmNvbmZpZy5ncmVlblpvbmVzW2dyZWVuSWR4XS5mcm9tLCB0aGlzLmNvbmZpZy5ncmVlblpvbmVzW2dyZWVuSWR4XS50bywgc2VsZi5jb25maWcuZ3JlZW5Db2xvcik7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciB5ZWxsb3dJZHggaW4gdGhpcy5jb25maWcueWVsbG93Wm9uZXMpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMuZHJhd0JhbmQodGhpcy5jb25maWcueWVsbG93Wm9uZXNbeWVsbG93SWR4XS5mcm9tLCB0aGlzLmNvbmZpZy55ZWxsb3dab25lc1t5ZWxsb3dJZHhdLnRvLCBzZWxmLmNvbmZpZy55ZWxsb3dDb2xvcik7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciByZWRJZHggaW4gdGhpcy5jb25maWcucmVkWm9uZXMpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMuZHJhd0JhbmQodGhpcy5jb25maWcucmVkWm9uZXNbcmVkSWR4XS5mcm9tLCB0aGlzLmNvbmZpZy5yZWRab25lc1tyZWRJZHhdLnRvLCBzZWxmLmNvbmZpZy5yZWRDb2xvcik7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZm9udFNpemUgPSAwO1xuXG4gICAgICAgIGlmICh1bmRlZmluZWQgIT0gdGhpcy5jb25maWcubGFiZWwpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGZvbnRTaXplID0gTWF0aC5yb3VuZCh0aGlzLmNvbmZpZy5zaXplIC8gOSk7XG4gICAgICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKFwic3ZnOnRleHRcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIHRoaXMuY29uZmlnLmN5IC8gMiArIGZvbnRTaXplIC8gMilcbiAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIGZvbnRTaXplIC8gMilcbiAgICAgICAgICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAgICAgICAgICAgLnRleHQodGhpcy5jb25maWcubGFiZWwpXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIGZvbnRTaXplICsgXCJweFwiKVxuICAgICAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgXCIjMzMzXCIpXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMHB4XCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9udFNpemUgPSBNYXRoLnJvdW5kKHRoaXMuY29uZmlnLnNpemUgLyAxNik7XG4gICAgICAgIHZhciBtYWpvckRlbHRhID0gdGhpcy5jb25maWcucmFuZ2UgLyAodGhpcy5jb25maWcubWFqb3JUaWNrcyAtIDEpO1xuICAgICAgICBmb3IgKHZhciBtYWpvciA9IHRoaXMuY29uZmlnLm1pbjsgbWFqb3IgPD0gdGhpcy5jb25maWcubWF4OyBtYWpvciArPSBtYWpvckRlbHRhKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgbWlub3JEZWx0YSA9IG1ham9yRGVsdGEgLyB0aGlzLmNvbmZpZy5taW5vclRpY2tzLFxuICAgICAgICAgICAgICAgIHBvaW50MSA9IDAsXG4gICAgICAgICAgICAgICAgcG9pbnQyID0gMDtcbiAgICAgICAgICAgIGZvciAodmFyIG1pbm9yID0gbWFqb3IgKyBtaW5vckRlbHRhOyBtaW5vciA8IE1hdGgubWluKG1ham9yICsgbWFqb3JEZWx0YSwgdGhpcy5jb25maWcubWF4KTsgbWlub3IgKz0gbWlub3JEZWx0YSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBwb2ludDEgPSB0aGlzLnZhbHVlVG9Qb2ludChtaW5vciwgMC43NSk7XG4gICAgICAgICAgICAgICAgcG9pbnQyID0gdGhpcy52YWx1ZVRvUG9pbnQobWlub3IsIDAuODUpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5ib2R5LmFwcGVuZChcInN2ZzpsaW5lXCIpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieDFcIiwgcG9pbnQxLngpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieTFcIiwgcG9pbnQxLnkpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieDJcIiwgcG9pbnQyLngpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieTJcIiwgcG9pbnQyLnkpXG4gICAgICAgICAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZVwiLCBcIiM2NjZcIilcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMXB4XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwb2ludDEgPSB0aGlzLnZhbHVlVG9Qb2ludChtYWpvciwgMC43KTtcbiAgICAgICAgICAgIHBvaW50MiA9IHRoaXMudmFsdWVUb1BvaW50KG1ham9yLCAwLjg1KTtcblxuICAgICAgICAgICAgdGhpcy5ib2R5LmFwcGVuZChcInN2ZzpsaW5lXCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ4MVwiLCBwb2ludDEueClcbiAgICAgICAgICAgICAgICAuYXR0cihcInkxXCIsIHBvaW50MS55KVxuICAgICAgICAgICAgICAgIC5hdHRyKFwieDJcIiwgcG9pbnQyLngpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ5MlwiLCBwb2ludDIueSlcbiAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2VcIiwgXCIjMzMzXCIpXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwic3Ryb2tlLXdpZHRoXCIsIFwiMnB4XCIpO1xuXG4gICAgICAgICAgICBpZiAobWFqb3IgPT0gdGhpcy5jb25maWcubWluIHx8IG1ham9yID09IHRoaXMuY29uZmlnLm1heClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgcG9pbnQgPSB0aGlzLnZhbHVlVG9Qb2ludChtYWpvciwgMC42Myk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKFwic3ZnOnRleHRcIilcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIHBvaW50LngpXG4gICAgICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCBwb2ludC55KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIGZvbnRTaXplIC8gMylcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBtYWpvciA9PSB0aGlzLmNvbmZpZy5taW4gPyBcInN0YXJ0XCIgOiBcImVuZFwiKVxuICAgICAgICAgICAgICAgICAgICAudGV4dChtYWpvcilcbiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIGZvbnRTaXplICsgXCJweFwiKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIFwiIzMzM1wiKVxuICAgICAgICAgICAgICAgICAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgXCIwcHhcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcG9pbnRlckNvbnRhaW5lciA9IHRoaXMuYm9keS5hcHBlbmQoXCJzdmc6Z1wiKS5hdHRyKFwiY2xhc3NcIiwgXCJwb2ludGVyQ29udGFpbmVyXCIpO1xuXG4gICAgICAgIHZhciBtaWRWYWx1ZSA9ICh0aGlzLmNvbmZpZy5taW4gKyB0aGlzLmNvbmZpZy5tYXgpIC8gMjtcblxuICAgICAgICB2YXIgcG9pbnRlclBhdGggPSB0aGlzLmJ1aWxkUG9pbnRlclBhdGgobWlkVmFsdWUpO1xuXG4gICAgICAgIHZhciBwb2ludGVyTGluZSA9IGQzLnN2Zy5saW5lKClcbiAgICAgICAgICAgIC54KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQueCB9KVxuICAgICAgICAgICAgLnkoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC55IH0pXG4gICAgICAgICAgICAuaW50ZXJwb2xhdGUoXCJiYXNpc1wiKTtcblxuICAgICAgICBwb2ludGVyQ29udGFpbmVyLnNlbGVjdEFsbChcInBhdGhcIilcbiAgICAgICAgICAgIC5kYXRhKFtwb2ludGVyUGF0aF0pXG4gICAgICAgICAgICAuZW50ZXIoKVxuICAgICAgICAgICAgLmFwcGVuZChcInN2ZzpwYXRoXCIpXG4gICAgICAgICAgICAuYXR0cihcImRcIiwgcG9pbnRlckxpbmUpXG4gICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIFwiIzg4OFwiKTtcblxuICAgICAgICBwb2ludGVyQ29udGFpbmVyLmFwcGVuZChcInN2ZzpjaXJjbGVcIilcbiAgICAgICAgICAgIC5hdHRyKFwiY3hcIiwgdGhpcy5jb25maWcuY3gpXG4gICAgICAgICAgICAuYXR0cihcImN5XCIsIHRoaXMuY29uZmlnLmN5KVxuICAgICAgICAgICAgLmF0dHIoXCJyXCIsIDAuMTIgKiB0aGlzLmNvbmZpZy5yYWR1aXMpXG4gICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIFwiIzg4OFwiKTtcblxuICAgICAgICBmb250U2l6ZSA9IE1hdGgucm91bmQodGhpcy5jb25maWcuc2l6ZSAvIDEwKTtcbiAgICAgICAgcG9pbnRlckNvbnRhaW5lci5zZWxlY3RBbGwoXCJ0ZXh0XCIpXG4gICAgICAgICAgICAuZGF0YShbbWlkVmFsdWVdKVxuICAgICAgICAgICAgLmVudGVyKClcbiAgICAgICAgICAgIC5hcHBlbmQoXCJzdmc6dGV4dFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIHRoaXMuY29uZmlnLmN4KVxuICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIHRoaXMuY29uZmlnLnNpemUgLSB0aGlzLmNvbmZpZy5jeSAvIDQgLSBmb250U2l6ZSlcbiAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgZm9udFNpemUgLyAyKVxuICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgICAgICAgICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIGZvbnRTaXplICsgXCJweFwiKVxuICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBcIiMwMDBcIilcbiAgICAgICAgICAgIC5zdHlsZShcInN0cm9rZS13aWR0aFwiLCBcIjBweFwiKTtcblxuICAgICAgICB0aGlzLnJlZHJhdyh0aGlzLmNvbmZpZy5taW4sIDApO1xuICAgIH07XG5cbiAgICB0aGlzLmJ1aWxkUG9pbnRlclBhdGggPSBmdW5jdGlvbih2YWx1ZSlcbiAgICB7XG4gICAgICAgIHZhciBkZWx0YSA9IHRoaXMuY29uZmlnLnJhbmdlIC8gMTM7XG5cbiAgICAgICAgdmFyIGhlYWQgPSB2YWx1ZVRvUG9pbnQodmFsdWUsIDAuODUpO1xuICAgICAgICB2YXIgaGVhZDEgPSB2YWx1ZVRvUG9pbnQodmFsdWUgLSBkZWx0YSwgMC4xMik7XG4gICAgICAgIHZhciBoZWFkMiA9IHZhbHVlVG9Qb2ludCh2YWx1ZSArIGRlbHRhLCAwLjEyKTtcblxuICAgICAgICB2YXIgdGFpbFZhbHVlID0gdmFsdWUgLSAodGhpcy5jb25maWcucmFuZ2UgKiAoMS8oMjcwLzM2MCkpIC8gMik7XG4gICAgICAgIHZhciB0YWlsID0gdmFsdWVUb1BvaW50KHRhaWxWYWx1ZSwgMC4yOCk7XG4gICAgICAgIHZhciB0YWlsMSA9IHZhbHVlVG9Qb2ludCh0YWlsVmFsdWUgLSBkZWx0YSwgMC4xMik7XG4gICAgICAgIHZhciB0YWlsMiA9IHZhbHVlVG9Qb2ludCh0YWlsVmFsdWUgKyBkZWx0YSwgMC4xMik7XG5cbiAgICAgICAgcmV0dXJuIFtoZWFkLCBoZWFkMSwgdGFpbDIsIHRhaWwsIHRhaWwxLCBoZWFkMiwgaGVhZF07XG5cbiAgICAgICAgZnVuY3Rpb24gdmFsdWVUb1BvaW50KHZhbHVlLCBmYWN0b3IpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZhciBwb2ludCA9IHNlbGYudmFsdWVUb1BvaW50KHZhbHVlLCBmYWN0b3IpO1xuICAgICAgICAgICAgcG9pbnQueCAtPSBzZWxmLmNvbmZpZy5jeDtcbiAgICAgICAgICAgIHBvaW50LnkgLT0gc2VsZi5jb25maWcuY3k7XG4gICAgICAgICAgICByZXR1cm4gcG9pbnQ7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5kcmF3QmFuZCA9IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGNvbG9yKVxuICAgIHtcbiAgICAgICAgaWYgKDAgPj0gZW5kIC0gc3RhcnQpIHJldHVybjtcblxuICAgICAgICB0aGlzLmJvZHkuYXBwZW5kKFwic3ZnOnBhdGhcIilcbiAgICAgICAgICAgIC5zdHlsZShcImZpbGxcIiwgY29sb3IpXG4gICAgICAgICAgICAuYXR0cihcImRcIiwgZDMuc3ZnLmFyYygpXG4gICAgICAgICAgICAgICAgLnN0YXJ0QW5nbGUodGhpcy52YWx1ZVRvUmFkaWFucyhzdGFydCkpXG4gICAgICAgICAgICAgICAgLmVuZEFuZ2xlKHRoaXMudmFsdWVUb1JhZGlhbnMoZW5kKSlcbiAgICAgICAgICAgICAgICAuaW5uZXJSYWRpdXMoMC42NSAqIHRoaXMuY29uZmlnLnJhZHVpcylcbiAgICAgICAgICAgICAgICAub3V0ZXJSYWRpdXMoMC44NSAqIHRoaXMuY29uZmlnLnJhZHVpcykpXG4gICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbigpIHsgcmV0dXJuIFwidHJhbnNsYXRlKFwiICsgc2VsZi5jb25maWcuY3ggKyBcIiwgXCIgKyBzZWxmLmNvbmZpZy5jeSArIFwiKSByb3RhdGUoMjcwKVwiIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLnJlZHJhdyA9IGZ1bmN0aW9uKHZhbHVlLCB0cmFuc2l0aW9uRHVyYXRpb24pXG4gICAge1xuICAgICAgICB2YXIgcG9pbnRlckNvbnRhaW5lciA9IHRoaXMuYm9keS5zZWxlY3QoXCIucG9pbnRlckNvbnRhaW5lclwiKTtcblxuICAgICAgICBwb2ludGVyQ29udGFpbmVyLnNlbGVjdEFsbChcInRleHRcIikudGV4dChNYXRoLnJvdW5kKHZhbHVlKSk7XG5cbiAgICAgICAgdmFyIHBvaW50ZXIgPSBwb2ludGVyQ29udGFpbmVyLnNlbGVjdEFsbChcInBhdGhcIik7XG4gICAgICAgIHBvaW50ZXIudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAuZHVyYXRpb24odW5kZWZpbmVkICE9IHRyYW5zaXRpb25EdXJhdGlvbiA/IHRyYW5zaXRpb25EdXJhdGlvbiA6IHRoaXMuY29uZmlnLnRyYW5zaXRpb25EdXJhdGlvbilcbiAgICAgICAgICAgIC8vLmRlbGF5KDApXG4gICAgICAgICAgICAvLy5lYXNlKFwibGluZWFyXCIpXG4gICAgICAgICAgICAvLy5hdHRyKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uKGQpXG4gICAgICAgICAgICAuYXR0clR3ZWVuKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uKClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgcG9pbnRlclZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gc2VsZi5jb25maWcubWF4KSBwb2ludGVyVmFsdWUgPSBzZWxmLmNvbmZpZy5tYXggKyAwLjAyKnNlbGYuY29uZmlnLnJhbmdlO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlIDwgc2VsZi5jb25maWcubWluKSBwb2ludGVyVmFsdWUgPSBzZWxmLmNvbmZpZy5taW4gLSAwLjAyKnNlbGYuY29uZmlnLnJhbmdlO1xuICAgICAgICAgICAgICAgIHZhciB0YXJnZXRSb3RhdGlvbiA9IChzZWxmLnZhbHVlVG9EZWdyZWVzKHBvaW50ZXJWYWx1ZSkgLSA5MCk7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRSb3RhdGlvbiA9IHNlbGYuX2N1cnJlbnRSb3RhdGlvbiB8fCB0YXJnZXRSb3RhdGlvbjtcbiAgICAgICAgICAgICAgICBzZWxmLl9jdXJyZW50Um90YXRpb24gPSB0YXJnZXRSb3RhdGlvbjtcblxuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihzdGVwKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvdGF0aW9uID0gY3VycmVudFJvdGF0aW9uICsgKHRhcmdldFJvdGF0aW9uLWN1cnJlbnRSb3RhdGlvbikqc3RlcDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwidHJhbnNsYXRlKFwiICsgc2VsZi5jb25maWcuY3ggKyBcIiwgXCIgKyBzZWxmLmNvbmZpZy5jeSArIFwiKSByb3RhdGUoXCIgKyByb3RhdGlvbiArIFwiKVwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBvdXRlckNpcmNsZSA9IHRoaXMuYm9keS5zZWxlY3QoXCIub3V0ZXItY2lyY2xlXCIpXG4gICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAuZHVyYXRpb24oNzUwKVxuICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGkgPSBwYXJzZUludCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKGkgPiAwICYmIGkgPCA3NSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcuZ3JlZW5Db2xvcjtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPj0gNzUgJiYgaSA8IDkwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbmZpZy55ZWxsb3dDb2xvcjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jb25maWcucmVkQ29sb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMudmFsdWVUb0RlZ3JlZXMgPSBmdW5jdGlvbih2YWx1ZSlcbiAgICB7XG4gICAgICAgIC8vIHRoYW5rcyBAY2xvc2VhbGVydFxuICAgICAgICAvL3JldHVybiB2YWx1ZSAvIHRoaXMuY29uZmlnLnJhbmdlICogMjcwIC0gNDU7XG4gICAgICAgIHJldHVybiB2YWx1ZSAvIHRoaXMuY29uZmlnLnJhbmdlICogMjcwIC0gKHRoaXMuY29uZmlnLm1pbiAvIHRoaXMuY29uZmlnLnJhbmdlICogMjcwICsgNDUpO1xuICAgIH07XG5cbiAgICB0aGlzLnZhbHVlVG9SYWRpYW5zID0gZnVuY3Rpb24odmFsdWUpXG4gICAge1xuICAgICAgICByZXR1cm4gdGhpcy52YWx1ZVRvRGVncmVlcyh2YWx1ZSkgKiBNYXRoLlBJIC8gMTgwO1xuICAgIH07XG5cbiAgICB0aGlzLnZhbHVlVG9Qb2ludCA9IGZ1bmN0aW9uKHZhbHVlLCBmYWN0b3IpXG4gICAge1xuICAgICAgICByZXR1cm4geyBcdHg6IHRoaXMuY29uZmlnLmN4IC0gdGhpcy5jb25maWcucmFkdWlzICogZmFjdG9yICogTWF0aC5jb3ModGhpcy52YWx1ZVRvUmFkaWFucyh2YWx1ZSkpLFxuICAgICAgICAgICAgeTogdGhpcy5jb25maWcuY3kgLSB0aGlzLmNvbmZpZy5yYWR1aXMgKiBmYWN0b3IgKiBNYXRoLnNpbih0aGlzLnZhbHVlVG9SYWRpYW5zKHZhbHVlKSkgXHRcdH07XG4gICAgfTtcblxuICAgIC8vIGluaXRpYWxpemF0aW9uXG4gICAgdGhpcy5jb25maWd1cmUoY29uZmlndXJhdGlvbik7XG59IiwiLyohIFxuICogYW5ndWxhci1ob3RrZXlzIHYxLjUuMFxuICogaHR0cHM6Ly9jaGllZmZhbmN5cGFudHMuZ2l0aHViLmlvL2FuZ3VsYXItaG90a2V5c1xuICogQ29weXJpZ2h0IChjKSAyMDE1IFdlcyBDcnV2ZXJcbiAqIExpY2Vuc2U6IE1JVFxuICovXG4hZnVuY3Rpb24oKXtcInVzZSBzdHJpY3RcIjthbmd1bGFyLm1vZHVsZShcImNmcC5ob3RrZXlzXCIsW10pLnByb3ZpZGVyKFwiaG90a2V5c1wiLFtcIiRpbmplY3RvclwiLGZ1bmN0aW9uKGEpe3RoaXMuaW5jbHVkZUNoZWF0U2hlZXQ9ITAsdGhpcy51c2VOZ1JvdXRlPWEuaGFzKFwibmdWaWV3RGlyZWN0aXZlXCIpLHRoaXMudGVtcGxhdGVUaXRsZT1cIktleWJvYXJkIFNob3J0Y3V0czpcIix0aGlzLnRlbXBsYXRlSGVhZGVyPW51bGwsdGhpcy50ZW1wbGF0ZUZvb3Rlcj1udWxsLHRoaXMudGVtcGxhdGU9JzxkaXYgY2xhc3M9XCJjZnAtaG90a2V5cy1jb250YWluZXIgZmFkZVwiIG5nLWNsYXNzPVwie2luOiBoZWxwVmlzaWJsZX1cIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCI+PGRpdiBjbGFzcz1cImNmcC1ob3RrZXlzXCI+PGg0IGNsYXNzPVwiY2ZwLWhvdGtleXMtdGl0bGVcIiBuZy1pZj1cIiFoZWFkZXJcIj57eyB0aXRsZSB9fTwvaDQ+PGRpdiBuZy1iaW5kLWh0bWw9XCJoZWFkZXJcIiBuZy1pZj1cImhlYWRlclwiPjwvZGl2Pjx0YWJsZT48dGJvZHk+PHRyIG5nLXJlcGVhdD1cImhvdGtleSBpbiBob3RrZXlzIHwgZmlsdGVyOnsgZGVzY3JpcHRpb246IFxcJyEkJHVuZGVmaW5lZCQkXFwnIH1cIj48dGQgY2xhc3M9XCJjZnAtaG90a2V5cy1rZXlzXCI+PHNwYW4gbmctcmVwZWF0PVwia2V5IGluIGhvdGtleS5mb3JtYXQoKSB0cmFjayBieSAkaW5kZXhcIiBjbGFzcz1cImNmcC1ob3RrZXlzLWtleVwiPnt7IGtleSB9fTwvc3Bhbj48L3RkPjx0ZCBjbGFzcz1cImNmcC1ob3RrZXlzLXRleHRcIj57eyBob3RrZXkuZGVzY3JpcHRpb24gfX08L3RkPjwvdHI+PC90Ym9keT48L3RhYmxlPjxkaXYgbmctYmluZC1odG1sPVwiZm9vdGVyXCIgbmctaWY9XCJmb290ZXJcIj48L2Rpdj48ZGl2IGNsYXNzPVwiY2ZwLWhvdGtleXMtY2xvc2VcIiBuZy1jbGljaz1cInRvZ2dsZUNoZWF0U2hlZXQoKVwiPsOXPC9kaXY+PC9kaXY+PC9kaXY+Jyx0aGlzLmNoZWF0U2hlZXRIb3RrZXk9XCI/XCIsdGhpcy5jaGVhdFNoZWV0RGVzY3JpcHRpb249XCJTaG93IC8gaGlkZSB0aGlzIGhlbHAgbWVudVwiLHRoaXMuJGdldD1bXCIkcm9vdEVsZW1lbnRcIixcIiRyb290U2NvcGVcIixcIiRjb21waWxlXCIsXCIkd2luZG93XCIsXCIkZG9jdW1lbnRcIixmdW5jdGlvbihhLGIsYyxkLGUpe2Z1bmN0aW9uIGYoYSl7dmFyIGI9e2NvbW1hbmQ6XCLijJhcIixzaGlmdDpcIuKHp1wiLGxlZnQ6XCLihpBcIixyaWdodDpcIuKGklwiLHVwOlwi4oaRXCIsZG93bjpcIuKGk1wiLFwicmV0dXJuXCI6XCLihqlcIixiYWNrc3BhY2U6XCLijKtcIn07YT1hLnNwbGl0KFwiK1wiKTtmb3IodmFyIGM9MDtjPGEubGVuZ3RoO2MrKylcIm1vZFwiPT09YVtjXSYmKGQubmF2aWdhdG9yJiZkLm5hdmlnYXRvci5wbGF0Zm9ybS5pbmRleE9mKFwiTWFjXCIpPj0wP2FbY109XCJjb21tYW5kXCI6YVtjXT1cImN0cmxcIiksYVtjXT1iW2FbY11dfHxhW2NdO3JldHVybiBhLmpvaW4oXCIgKyBcIil9ZnVuY3Rpb24gZyhhLGIsYyxkLGUsZil7dGhpcy5jb21ibz1hIGluc3RhbmNlb2YgQXJyYXk/YTpbYV0sdGhpcy5kZXNjcmlwdGlvbj1iLHRoaXMuY2FsbGJhY2s9Yyx0aGlzLmFjdGlvbj1kLHRoaXMuYWxsb3dJbj1lLHRoaXMucGVyc2lzdGVudD1mLHRoaXMuX2Zvcm1hdGVkPW51bGx9ZnVuY3Rpb24gaCgpe2Zvcih2YXIgYT1vLmhvdGtleXMubGVuZ3RoO2EtLTspe3ZhciBiPW8uaG90a2V5c1thXTtiJiYhYi5wZXJzaXN0ZW50JiZrKGIpfX1mdW5jdGlvbiBpKCl7by5oZWxwVmlzaWJsZT0hby5oZWxwVmlzaWJsZSxvLmhlbHBWaXNpYmxlPyh0PWwoXCJlc2NcIiksayhcImVzY1wiKSxqKFwiZXNjXCIsdC5kZXNjcmlwdGlvbixpLG51bGwsW1wiSU5QVVRcIixcIlNFTEVDVFwiLFwiVEVYVEFSRUFcIl0pKTooayhcImVzY1wiKSx0IT09ITEmJmoodCkpfWZ1bmN0aW9uIGooYSxiLGMsZCxlLGYpe3ZhciBoLGk9W1wiSU5QVVRcIixcIlNFTEVDVFwiLFwiVEVYVEFSRUFcIl0saj1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYSk7aWYoXCJbb2JqZWN0IE9iamVjdF1cIj09PWomJihiPWEuZGVzY3JpcHRpb24sYz1hLmNhbGxiYWNrLGQ9YS5hY3Rpb24sZj1hLnBlcnNpc3RlbnQsZT1hLmFsbG93SW4sYT1hLmNvbWJvKSxiIGluc3RhbmNlb2YgRnVuY3Rpb24/KGQ9YyxjPWIsYj1cIiQkdW5kZWZpbmVkJCRcIik6YW5ndWxhci5pc1VuZGVmaW5lZChiKSYmKGI9XCIkJHVuZGVmaW5lZCQkXCIpLHZvaWQgMD09PWYmJihmPSEwKSxcImZ1bmN0aW9uXCI9PXR5cGVvZiBjKXtoPWMsZSBpbnN0YW5jZW9mIEFycmF5fHwoZT1bXSk7Zm9yKHZhciBrLGw9MDtsPGUubGVuZ3RoO2wrKyllW2xdPWVbbF0udG9VcHBlckNhc2UoKSxrPWkuaW5kZXhPZihlW2xdKSwtMSE9PWsmJmkuc3BsaWNlKGssMSk7Yz1mdW5jdGlvbihhKXt2YXIgYj0hMCxjPWEudGFyZ2V0fHxhLnNyY0VsZW1lbnQsZD1jLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk7aWYoKFwiIFwiK2MuY2xhc3NOYW1lK1wiIFwiKS5pbmRleE9mKFwiIG1vdXNldHJhcCBcIik+LTEpYj0hMDtlbHNlIGZvcih2YXIgZT0wO2U8aS5sZW5ndGg7ZSsrKWlmKGlbZV09PT1kKXtiPSExO2JyZWFrfWImJm4oaC5hcHBseSh0aGlzLGFyZ3VtZW50cykpfX1cInN0cmluZ1wiPT10eXBlb2YgZD9Nb3VzZXRyYXAuYmluZChhLG4oYyksZCk6TW91c2V0cmFwLmJpbmQoYSxuKGMpKTt2YXIgbT1uZXcgZyhhLGIsYyxkLGUsZik7cmV0dXJuIG8uaG90a2V5cy5wdXNoKG0pLG19ZnVuY3Rpb24gayhhKXt2YXIgYj1hIGluc3RhbmNlb2YgZz9hLmNvbWJvOmE7aWYoTW91c2V0cmFwLnVuYmluZChiKSxhbmd1bGFyLmlzQXJyYXkoYikpe2Zvcih2YXIgYz0hMCxkPWIubGVuZ3RoO2QtLTspYz1rKGJbZF0pJiZjO3JldHVybiBjfXZhciBlPW8uaG90a2V5cy5pbmRleE9mKGwoYikpO3JldHVybiBlPi0xPyhvLmhvdGtleXNbZV0uY29tYm8ubGVuZ3RoPjE/by5ob3RrZXlzW2VdLmNvbWJvLnNwbGljZShvLmhvdGtleXNbZV0uY29tYm8uaW5kZXhPZihiKSwxKTpvLmhvdGtleXMuc3BsaWNlKGUsMSksITApOiExfWZ1bmN0aW9uIGwoYSl7aWYoIWEpcmV0dXJuIG8uaG90a2V5cztmb3IodmFyIGIsYz0wO2M8by5ob3RrZXlzLmxlbmd0aDtjKyspaWYoYj1vLmhvdGtleXNbY10sYi5jb21iby5pbmRleE9mKGEpPi0xKXJldHVybiBiO3JldHVybiExfWZ1bmN0aW9uIG0oYSl7cmV0dXJuIGEuJGlkIGluIHB8fChwW2EuJGlkXT1bXSxhLiRvbihcIiRkZXN0cm95XCIsZnVuY3Rpb24oKXtmb3IodmFyIGI9cFthLiRpZF0ubGVuZ3RoO2ItLTspayhwW2EuJGlkXS5wb3AoKSl9KSkse2FkZDpmdW5jdGlvbihiKXt2YXIgYztyZXR1cm4gYz1hcmd1bWVudHMubGVuZ3RoPjE/ai5hcHBseSh0aGlzLGFyZ3VtZW50cyk6aihiKSxwW2EuJGlkXS5wdXNoKGMpLHRoaXN9fX1mdW5jdGlvbiBuKGEpe3JldHVybiBmdW5jdGlvbihjLGQpe2lmKGEgaW5zdGFuY2VvZiBBcnJheSl7dmFyIGU9YVswXSxmPWFbMV07YT1mdW5jdGlvbihhKXtmLnNjb3BlLiRldmFsKGUpfX1iLiRhcHBseShmdW5jdGlvbigpe2EoYyxsKGQpKX0pfX1Nb3VzZXRyYXAucHJvdG90eXBlLnN0b3BDYWxsYmFjaz1mdW5jdGlvbihhLGIpe3JldHVybihcIiBcIitiLmNsYXNzTmFtZStcIiBcIikuaW5kZXhPZihcIiBtb3VzZXRyYXAgXCIpPi0xPyExOmIuY29udGVudEVkaXRhYmxlJiZcInRydWVcIj09Yi5jb250ZW50RWRpdGFibGV9LGcucHJvdG90eXBlLmZvcm1hdD1mdW5jdGlvbigpe2lmKG51bGw9PT10aGlzLl9mb3JtYXRlZCl7Zm9yKHZhciBhPXRoaXMuY29tYm9bMF0sYj1hLnNwbGl0KC9bXFxzXS8pLGM9MDtjPGIubGVuZ3RoO2MrKyliW2NdPWYoYltjXSk7dGhpcy5fZm9ybWF0ZWQ9Yn1yZXR1cm4gdGhpcy5fZm9ybWF0ZWR9O3ZhciBvPWIuJG5ldygpO28uaG90a2V5cz1bXSxvLmhlbHBWaXNpYmxlPSExLG8udGl0bGU9dGhpcy50ZW1wbGF0ZVRpdGxlLG8uaGVhZGVyPXRoaXMudGVtcGxhdGVIZWFkZXIsby5mb290ZXI9dGhpcy50ZW1wbGF0ZUZvb3RlcixvLnRvZ2dsZUNoZWF0U2hlZXQ9aTt2YXIgcD1bXTtpZih0aGlzLnVzZU5nUm91dGUmJmIuJG9uKFwiJHJvdXRlQ2hhbmdlU3VjY2Vzc1wiLGZ1bmN0aW9uKGEsYil7aCgpLGImJmIuaG90a2V5cyYmYW5ndWxhci5mb3JFYWNoKGIuaG90a2V5cyxmdW5jdGlvbihhKXt2YXIgYz1hWzJdOyhcInN0cmluZ1wiPT10eXBlb2YgY3x8YyBpbnN0YW5jZW9mIFN0cmluZykmJihhWzJdPVtjLGJdKSxhWzVdPSExLGouYXBwbHkodGhpcyxhKX0pfSksdGhpcy5pbmNsdWRlQ2hlYXRTaGVldCl7dmFyIHE9ZVswXSxyPWFbMF0scz1hbmd1bGFyLmVsZW1lbnQodGhpcy50ZW1wbGF0ZSk7aih0aGlzLmNoZWF0U2hlZXRIb3RrZXksdGhpcy5jaGVhdFNoZWV0RGVzY3JpcHRpb24saSksKHI9PT1xfHxyPT09cS5kb2N1bWVudEVsZW1lbnQpJiYocj1xLmJvZHkpLGFuZ3VsYXIuZWxlbWVudChyKS5hcHBlbmQoYyhzKShvKSl9dmFyIHQ9ITEsdT17YWRkOmosZGVsOmssZ2V0OmwsYmluZFRvOm0sdGVtcGxhdGU6dGhpcy50ZW1wbGF0ZSx0b2dnbGVDaGVhdFNoZWV0OmksaW5jbHVkZUNoZWF0U2hlZXQ6dGhpcy5pbmNsdWRlQ2hlYXRTaGVldCxjaGVhdFNoZWV0SG90a2V5OnRoaXMuY2hlYXRTaGVldEhvdGtleSxjaGVhdFNoZWV0RGVzY3JpcHRpb246dGhpcy5jaGVhdFNoZWV0RGVzY3JpcHRpb24sdXNlTmdSb3V0ZTp0aGlzLnVzZU5nUm91dGUscHVyZ2VIb3RrZXlzOmgsdGVtcGxhdGVUaXRsZTp0aGlzLnRlbXBsYXRlVGl0bGV9O3JldHVybiB1fV19XSkuZGlyZWN0aXZlKFwiaG90a2V5XCIsW1wiaG90a2V5c1wiLGZ1bmN0aW9uKGEpe3JldHVybntyZXN0cmljdDpcIkFcIixsaW5rOmZ1bmN0aW9uKGIsYyxkKXt2YXIgZSxmO2FuZ3VsYXIuZm9yRWFjaChiLiRldmFsKGQuaG90a2V5KSxmdW5jdGlvbihiLGMpe2Y9XCJzdHJpbmdcIj09dHlwZW9mIGQuaG90a2V5QWxsb3dJbj9kLmhvdGtleUFsbG93SW4uc3BsaXQoL1tcXHMsXSsvKTpbXSxlPWMsYS5hZGQoe2NvbWJvOmMsZGVzY3JpcHRpb246ZC5ob3RrZXlEZXNjcmlwdGlvbixjYWxsYmFjazpiLGFjdGlvbjpkLmhvdGtleUFjdGlvbixhbGxvd0luOmZ9KX0pLGMuYmluZChcIiRkZXN0cm95XCIsZnVuY3Rpb24oKXthLmRlbChlKX0pfX19XSkucnVuKFtcImhvdGtleXNcIixmdW5jdGlvbihhKXt9XSl9KCksZnVuY3Rpb24oYSxiLGMpe2Z1bmN0aW9uIGQoYSxiLGMpe3JldHVybiBhLmFkZEV2ZW50TGlzdGVuZXI/dm9pZCBhLmFkZEV2ZW50TGlzdGVuZXIoYixjLCExKTp2b2lkIGEuYXR0YWNoRXZlbnQoXCJvblwiK2IsYyl9ZnVuY3Rpb24gZShhKXtpZihcImtleXByZXNzXCI9PWEudHlwZSl7dmFyIGI9U3RyaW5nLmZyb21DaGFyQ29kZShhLndoaWNoKTtyZXR1cm4gYS5zaGlmdEtleXx8KGI9Yi50b0xvd2VyQ2FzZSgpKSxifXJldHVybiByW2Eud2hpY2hdP3JbYS53aGljaF06c1thLndoaWNoXT9zW2Eud2hpY2hdOlN0cmluZy5mcm9tQ2hhckNvZGUoYS53aGljaCkudG9Mb3dlckNhc2UoKX1mdW5jdGlvbiBmKGEsYil7cmV0dXJuIGEuc29ydCgpLmpvaW4oXCIsXCIpPT09Yi5zb3J0KCkuam9pbihcIixcIil9ZnVuY3Rpb24gZyhhKXt2YXIgYj1bXTtyZXR1cm4gYS5zaGlmdEtleSYmYi5wdXNoKFwic2hpZnRcIiksYS5hbHRLZXkmJmIucHVzaChcImFsdFwiKSxhLmN0cmxLZXkmJmIucHVzaChcImN0cmxcIiksYS5tZXRhS2V5JiZiLnB1c2goXCJtZXRhXCIpLGJ9ZnVuY3Rpb24gaChhKXtyZXR1cm4gYS5wcmV2ZW50RGVmYXVsdD92b2lkIGEucHJldmVudERlZmF1bHQoKTp2b2lkKGEucmV0dXJuVmFsdWU9ITEpfWZ1bmN0aW9uIGkoYSl7cmV0dXJuIGEuc3RvcFByb3BhZ2F0aW9uP3ZvaWQgYS5zdG9wUHJvcGFnYXRpb24oKTp2b2lkKGEuY2FuY2VsQnViYmxlPSEwKX1mdW5jdGlvbiBqKGEpe3JldHVyblwic2hpZnRcIj09YXx8XCJjdHJsXCI9PWF8fFwiYWx0XCI9PWF8fFwibWV0YVwiPT1hfWZ1bmN0aW9uIGsoKXtpZighcSl7cT17fTtmb3IodmFyIGEgaW4gcilhPjk1JiYxMTI+YXx8ci5oYXNPd25Qcm9wZXJ0eShhKSYmKHFbclthXV09YSl9cmV0dXJuIHF9ZnVuY3Rpb24gbChhLGIsYyl7cmV0dXJuIGN8fChjPWsoKVthXT9cImtleWRvd25cIjpcImtleXByZXNzXCIpLFwia2V5cHJlc3NcIj09YyYmYi5sZW5ndGgmJihjPVwia2V5ZG93blwiKSxjfWZ1bmN0aW9uIG0oYSl7cmV0dXJuXCIrXCI9PT1hP1tcIitcIl06KGE9YS5yZXBsYWNlKC9cXCt7Mn0vZyxcIitwbHVzXCIpLGEuc3BsaXQoXCIrXCIpKX1mdW5jdGlvbiBuKGEsYil7dmFyIGMsZCxlLGY9W107Zm9yKGM9bShhKSxlPTA7ZTxjLmxlbmd0aDsrK2UpZD1jW2VdLHVbZF0mJihkPXVbZF0pLGImJlwia2V5cHJlc3NcIiE9YiYmdFtkXSYmKGQ9dFtkXSxmLnB1c2goXCJzaGlmdFwiKSksaihkKSYmZi5wdXNoKGQpO3JldHVybiBiPWwoZCxmLGIpLHtrZXk6ZCxtb2RpZmllcnM6ZixhY3Rpb246Yn19ZnVuY3Rpb24gbyhhLGMpe3JldHVybiBhPT09Yj8hMTphPT09Yz8hMDpvKGEucGFyZW50Tm9kZSxjKX1mdW5jdGlvbiBwKGEpe2Z1bmN0aW9uIGMoYSl7YT1hfHx7fTt2YXIgYixjPSExO2ZvcihiIGluIHUpYVtiXT9jPSEwOnVbYl09MDtjfHwoeD0hMSl9ZnVuY3Rpb24gayhhLGIsYyxkLGUsZyl7dmFyIGgsaSxrPVtdLGw9Yy50eXBlO2lmKCFzLl9jYWxsYmFja3NbYV0pcmV0dXJuW107Zm9yKFwia2V5dXBcIj09bCYmaihhKSYmKGI9W2FdKSxoPTA7aDxzLl9jYWxsYmFja3NbYV0ubGVuZ3RoOysraClpZihpPXMuX2NhbGxiYWNrc1thXVtoXSwoZHx8IWkuc2VxfHx1W2kuc2VxXT09aS5sZXZlbCkmJmw9PWkuYWN0aW9uJiYoXCJrZXlwcmVzc1wiPT1sJiYhYy5tZXRhS2V5JiYhYy5jdHJsS2V5fHxmKGIsaS5tb2RpZmllcnMpKSl7dmFyIG09IWQmJmkuY29tYm89PWUsbj1kJiZpLnNlcT09ZCYmaS5sZXZlbD09ZzsobXx8bikmJnMuX2NhbGxiYWNrc1thXS5zcGxpY2UoaCwxKSxrLnB1c2goaSl9cmV0dXJuIGt9ZnVuY3Rpb24gbChhLGIsYyxkKXtzLnN0b3BDYWxsYmFjayhiLGIudGFyZ2V0fHxiLnNyY0VsZW1lbnQsYyxkKXx8YShiLGMpPT09ITEmJihoKGIpLGkoYikpfWZ1bmN0aW9uIG0oYSl7XCJudW1iZXJcIiE9dHlwZW9mIGEud2hpY2gmJihhLndoaWNoPWEua2V5Q29kZSk7dmFyIGI9ZShhKTtpZihiKXJldHVyblwia2V5dXBcIj09YS50eXBlJiZ2PT09Yj92b2lkKHY9ITEpOnZvaWQgcy5oYW5kbGVLZXkoYixnKGEpLGEpfWZ1bmN0aW9uIG8oKXtjbGVhclRpbWVvdXQodCksdD1zZXRUaW1lb3V0KGMsMWUzKX1mdW5jdGlvbiBxKGEsYixkLGYpe2Z1bmN0aW9uIGcoYil7cmV0dXJuIGZ1bmN0aW9uKCl7eD1iLCsrdVthXSxvKCl9fWZ1bmN0aW9uIGgoYil7bChkLGIsYSksXCJrZXl1cFwiIT09ZiYmKHY9ZShiKSksc2V0VGltZW91dChjLDEwKX11W2FdPTA7Zm9yKHZhciBpPTA7aTxiLmxlbmd0aDsrK2kpe3ZhciBqPWkrMT09PWIubGVuZ3RoLGs9aj9oOmcoZnx8bihiW2krMV0pLmFjdGlvbik7cihiW2ldLGssZixhLGkpfX1mdW5jdGlvbiByKGEsYixjLGQsZSl7cy5fZGlyZWN0TWFwW2ErXCI6XCIrY109YixhPWEucmVwbGFjZSgvXFxzKy9nLFwiIFwiKTt2YXIgZixnPWEuc3BsaXQoXCIgXCIpO3JldHVybiBnLmxlbmd0aD4xP3ZvaWQgcShhLGcsYixjKTooZj1uKGEsYykscy5fY2FsbGJhY2tzW2Yua2V5XT1zLl9jYWxsYmFja3NbZi5rZXldfHxbXSxrKGYua2V5LGYubW9kaWZpZXJzLHt0eXBlOmYuYWN0aW9ufSxkLGEsZSksdm9pZCBzLl9jYWxsYmFja3NbZi5rZXldW2Q/XCJ1bnNoaWZ0XCI6XCJwdXNoXCJdKHtjYWxsYmFjazpiLG1vZGlmaWVyczpmLm1vZGlmaWVycyxhY3Rpb246Zi5hY3Rpb24sc2VxOmQsbGV2ZWw6ZSxjb21ibzphfSkpfXZhciBzPXRoaXM7aWYoYT1hfHxiLCEocyBpbnN0YW5jZW9mIHApKXJldHVybiBuZXcgcChhKTtzLnRhcmdldD1hLHMuX2NhbGxiYWNrcz17fSxzLl9kaXJlY3RNYXA9e307dmFyIHQsdT17fSx2PSExLHc9ITEseD0hMTtzLl9oYW5kbGVLZXk9ZnVuY3Rpb24oYSxiLGQpe3ZhciBlLGY9ayhhLGIsZCksZz17fSxoPTAsaT0hMTtmb3IoZT0wO2U8Zi5sZW5ndGg7KytlKWZbZV0uc2VxJiYoaD1NYXRoLm1heChoLGZbZV0ubGV2ZWwpKTtmb3IoZT0wO2U8Zi5sZW5ndGg7KytlKWlmKGZbZV0uc2VxKXtpZihmW2VdLmxldmVsIT1oKWNvbnRpbnVlO2k9ITAsZ1tmW2VdLnNlcV09MSxsKGZbZV0uY2FsbGJhY2ssZCxmW2VdLmNvbWJvLGZbZV0uc2VxKX1lbHNlIGl8fGwoZltlXS5jYWxsYmFjayxkLGZbZV0uY29tYm8pO3ZhciBtPVwia2V5cHJlc3NcIj09ZC50eXBlJiZ3O2QudHlwZSE9eHx8aihhKXx8bXx8YyhnKSx3PWkmJlwia2V5ZG93blwiPT1kLnR5cGV9LHMuX2JpbmRNdWx0aXBsZT1mdW5jdGlvbihhLGIsYyl7Zm9yKHZhciBkPTA7ZDxhLmxlbmd0aDsrK2QpcihhW2RdLGIsYyl9LGQoYSxcImtleXByZXNzXCIsbSksZChhLFwia2V5ZG93blwiLG0pLGQoYSxcImtleXVwXCIsbSl9Zm9yKHZhciBxLHI9ezg6XCJiYWNrc3BhY2VcIiw5OlwidGFiXCIsMTM6XCJlbnRlclwiLDE2Olwic2hpZnRcIiwxNzpcImN0cmxcIiwxODpcImFsdFwiLDIwOlwiY2Fwc2xvY2tcIiwyNzpcImVzY1wiLDMyOlwic3BhY2VcIiwzMzpcInBhZ2V1cFwiLDM0OlwicGFnZWRvd25cIiwzNTpcImVuZFwiLDM2OlwiaG9tZVwiLDM3OlwibGVmdFwiLDM4OlwidXBcIiwzOTpcInJpZ2h0XCIsNDA6XCJkb3duXCIsNDU6XCJpbnNcIiw0NjpcImRlbFwiLDkxOlwibWV0YVwiLDkzOlwibWV0YVwiLDIyNDpcIm1ldGFcIn0scz17MTA2OlwiKlwiLDEwNzpcIitcIiwxMDk6XCItXCIsMTEwOlwiLlwiLDExMTpcIi9cIiwxODY6XCI7XCIsMTg3OlwiPVwiLDE4ODpcIixcIiwxODk6XCItXCIsMTkwOlwiLlwiLDE5MTpcIi9cIiwxOTI6XCJgXCIsMjE5OlwiW1wiLDIyMDpcIlxcXFxcIiwyMjE6XCJdXCIsMjIyOlwiJ1wifSx0PXtcIn5cIjpcImBcIixcIiFcIjpcIjFcIixcIkBcIjpcIjJcIixcIiNcIjpcIjNcIiwkOlwiNFwiLFwiJVwiOlwiNVwiLFwiXlwiOlwiNlwiLFwiJlwiOlwiN1wiLFwiKlwiOlwiOFwiLFwiKFwiOlwiOVwiLFwiKVwiOlwiMFwiLF86XCItXCIsXCIrXCI6XCI9XCIsXCI6XCI6XCI7XCIsJ1wiJzpcIidcIixcIjxcIjpcIixcIixcIj5cIjpcIi5cIixcIj9cIjpcIi9cIixcInxcIjpcIlxcXFxcIn0sdT17b3B0aW9uOlwiYWx0XCIsY29tbWFuZDpcIm1ldGFcIixcInJldHVyblwiOlwiZW50ZXJcIixlc2NhcGU6XCJlc2NcIixwbHVzOlwiK1wiLG1vZDovTWFjfGlQb2R8aVBob25lfGlQYWQvLnRlc3QobmF2aWdhdG9yLnBsYXRmb3JtKT9cIm1ldGFcIjpcImN0cmxcIn0sdj0xOzIwPnY7Kyt2KXJbMTExK3ZdPVwiZlwiK3Y7Zm9yKHY9MDs5Pj12OysrdilyW3YrOTZdPXY7cC5wcm90b3R5cGUuYmluZD1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcztyZXR1cm4gYT1hIGluc3RhbmNlb2YgQXJyYXk/YTpbYV0sZC5fYmluZE11bHRpcGxlLmNhbGwoZCxhLGIsYyksZH0scC5wcm90b3R5cGUudW5iaW5kPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcztyZXR1cm4gYy5iaW5kLmNhbGwoYyxhLGZ1bmN0aW9uKCl7fSxiKX0scC5wcm90b3R5cGUudHJpZ2dlcj1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXM7cmV0dXJuIGMuX2RpcmVjdE1hcFthK1wiOlwiK2JdJiZjLl9kaXJlY3RNYXBbYStcIjpcIitiXSh7fSxhKSxjfSxwLnByb3RvdHlwZS5yZXNldD1mdW5jdGlvbigpe3ZhciBhPXRoaXM7cmV0dXJuIGEuX2NhbGxiYWNrcz17fSxhLl9kaXJlY3RNYXA9e30sYX0scC5wcm90b3R5cGUuc3RvcENhbGxiYWNrPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcztyZXR1cm4oXCIgXCIrYi5jbGFzc05hbWUrXCIgXCIpLmluZGV4T2YoXCIgbW91c2V0cmFwIFwiKT4tMT8hMTpvKGIsYy50YXJnZXQpPyExOlwiSU5QVVRcIj09Yi50YWdOYW1lfHxcIlNFTEVDVFwiPT1iLnRhZ05hbWV8fFwiVEVYVEFSRUFcIj09Yi50YWdOYW1lfHxiLmlzQ29udGVudEVkaXRhYmxlfSxwLnByb3RvdHlwZS5oYW5kbGVLZXk9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO3JldHVybiBhLl9oYW5kbGVLZXkuYXBwbHkoYSxhcmd1bWVudHMpfSxwLmluaXQ9ZnVuY3Rpb24oKXt2YXIgYT1wKGIpO2Zvcih2YXIgYyBpbiBhKVwiX1wiIT09Yy5jaGFyQXQoMCkmJihwW2NdPWZ1bmN0aW9uKGIpe3JldHVybiBmdW5jdGlvbigpe3JldHVybiBhW2JdLmFwcGx5KGEsYXJndW1lbnRzKX19KGMpKX0scC5pbml0KCksYS5Nb3VzZXRyYXA9cCxcInVuZGVmaW5lZFwiIT10eXBlb2YgbW9kdWxlJiZtb2R1bGUuZXhwb3J0cyYmKG1vZHVsZS5leHBvcnRzPXApLFwiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZCYmZGVmaW5lKGZ1bmN0aW9uKCl7cmV0dXJuIHB9KX0od2luZG93LGRvY3VtZW50KTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdzY2FsZUFwcCcpLmNvbmZpZyhmdW5jdGlvbiAoJHByb3ZpZGUpIHtcbiAgICAgICAgJHByb3ZpZGUuZGVjb3JhdG9yKCckaHR0cEJhY2tlbmQnLCBhbmd1bGFyLm1vY2suZTJlLiRodHRwQmFja2VuZERlY29yYXRvcik7XG4gICAgfSkucnVuKGZ1bmN0aW9uICgkaHR0cEJhY2tlbmQsIHNjYWxlQ29uZmlnLCBYTUxIdHRwUmVxdWVzdCkge1xuXG4gICAgICAgIHZhciBnZXRTeW5jID0gZnVuY3Rpb24gKHVybCkge1xuICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIHJlcXVlc3Qub3BlbignR0VUJywgdXJsLCBmYWxzZSk7XG4gICAgICAgICAgICByZXF1ZXN0LnNlbmQobnVsbCk7XG4gICAgICAgICAgICByZXR1cm4gW3JlcXVlc3Quc3RhdHVzLCByZXF1ZXN0LnJlc3BvbnNlLCB7fV07XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gSW5nZXN0cyBTdGF0dXNcbiAgICAgICAgdmFyIGluZ2VzdHNTdGF0dXNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvaW5nZXN0U3RhdHVzLmpzb24nO1xuICAgICAgICB2YXIgaW5nZXN0c1N0YXR1c1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdpbmdlc3RzL3N0YXR1cy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChpbmdlc3RzU3RhdHVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMoaW5nZXN0c1N0YXR1c092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cblxuICAgICAgICAvLyBKb2IgbG9hZFxuICAgICAgICB2YXIgam9iTG9hZFJlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdsb2FkLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKGpvYkxvYWRSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgbnVtSG91cnMgPSBtb21lbnQudXRjKCkuZW5kT2YoJ2QnKS5kaWZmKG1vbWVudC51dGMoKS5zdWJ0cmFjdCg3LCAnZCcpLnN0YXJ0T2YoJ2QnKSwgJ2gnKTtcbiAgICAgICAgICAgIHZhciBzdGFydFRpbWUgPSBtb21lbnQudXRjKCkuc3VidHJhY3QoNywgJ2QnKS5zdGFydE9mKCdkJyk7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBjb3VudDogbnVtSG91cnMsXG4gICAgICAgICAgICAgICAgbmV4dDogbnVsbCxcbiAgICAgICAgICAgICAgICBwcmV2aW91czogbnVsbCxcbiAgICAgICAgICAgICAgICByZXN1bHRzOiBbXVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmNvdW50OyBpKyspIHtcbiAgICAgICAgICAgICAgICBkYXRhLnJlc3VsdHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHRpbWU6IG1vbWVudC51dGMoc3RhcnRUaW1lKS5hZGQoaSwgJ2gnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICBwZW5kaW5nX2NvdW50OiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwIC0gMjAgKyAxKSkgKyAyMCxcbiAgICAgICAgICAgICAgICAgICAgcXVldWVkX2NvdW50OiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoMTAwIC0gMjAgKyAxKSkgKyAyMCxcbiAgICAgICAgICAgICAgICAgICAgcnVubmluZ19jb3VudDogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDEwMCAtIDIwICsgMSkpICsgMjBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIFsyMDAsIGRhdGEsIHt9XTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSm9iIGRldGFpbHNcbiAgICAgICAgdmFyIGpvYkRldGFpbHNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvam9iRGV0YWlscy5qc29uJztcbiAgICAgICAgdmFyIGpvYkRldGFpbHNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9icy8uKi8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChqb2JEZXRhaWxzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMoam9iRGV0YWlsc092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSm9ic1xuICAgICAgICB2YXIgam9ic092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9qb2JzLmpzb24nO1xuICAgICAgICB2YXIgam9ic1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdqb2JzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKGpvYnNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhqb2JzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBKb2IgdHlwZSBzdGF0dXNcbiAgICAgICAgdmFyIGpvYlR5cGVTdGF0dXNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvam9iVHlwZVN0YXR1cy5qc29uJztcbiAgICAgICAgdmFyIGpvYlR5cGVTdGF0dXNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnam9iLXR5cGVzL3N0YXR1cy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChqb2JUeXBlU3RhdHVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMoam9iVHlwZVN0YXR1c092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSm9iIHR5cGVzXG4gICAgICAgIHZhciBqb2JUeXBlc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9qb2JUeXBlcy5qc29uJztcbiAgICAgICAgdmFyIGpvYlR5cGVzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ2pvYi10eXBlcy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChqb2JUeXBlc1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKGpvYlR5cGVzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBNZXRyaWNzIFBsb3QgRGF0YSBEZXRhaWxcbiAgICAgICAgdmFyIG1ldHJpY3NQbG90RGF0YU92ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9tZXRyaWNzSm9iVHlwZXNQbG90RGF0YS5qc29uJztcbiAgICAgICAgdmFyIG1ldHJpY3NQbG90RGF0YVJlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdtZXRyaWNzLy4qLy4qLycsJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQobWV0cmljc1Bsb3REYXRhUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMobWV0cmljc1Bsb3REYXRhT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBNZXRyaWNzIERldGFpbFxuICAgICAgICB2YXIgbWV0cmljc0RldGFpbE92ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9tZXRyaWNzSW5nZXN0Lmpzb24nO1xuICAgICAgICB2YXIgbWV0cmljc0RldGFpbFJlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdtZXRyaWNzLy4qLycsJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQobWV0cmljc0RldGFpbFJlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKG1ldHJpY3NEZXRhaWxPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIE1ldHJpY3NcbiAgICAgICAgdmFyIG1ldHJpY3NPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvbWV0cmljcy5qc29uJztcbiAgICAgICAgdmFyIG1ldHJpY3NSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnbWV0cmljcy8nLCdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKG1ldHJpY3NSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhtZXRyaWNzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBOb2RlIHN0YXR1c1xuICAgICAgICB2YXIgbm9kZVN0YXR1c092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9ub2RlU3RhdHVzLmpzb24nO1xuICAgICAgICB2YXIgbm9kZVN0YXR1c1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdub2Rlcy9zdGF0dXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQobm9kZVN0YXR1c1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKG5vZGVTdGF0dXNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIE5vZGVzXG4gICAgICAgIHZhciBub2Rlc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9ub2Rlcy5qc29uJztcbiAgICAgICAgdmFyIG5vZGVzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ25vZGVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKG5vZGVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMobm9kZXNPdmVycmlkZVVybCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFF1ZXVlIFN0YXR1cyBzZXJ2aWNlXG4gICAgICAgIHZhciBxdWV1ZVN0YXR1c092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9xdWV1ZVN0YXR1cy5qc29uJztcbiAgICAgICAgdmFyIHF1ZXVlU3RhdHVzUmVnZXggPSBuZXcgUmVnRXhwKCdeJyArIHNjYWxlQ29uZmlnLnVybHMuYXBpUHJlZml4ICsgJ3F1ZXVlL3N0YXR1cy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChxdWV1ZVN0YXR1c1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKHF1ZXVlU3RhdHVzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBSZWNpcGVzIHNlcnZpY2VcbiAgICAgICAgdmFyIHJlY2lwZXNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvcmVjaXBlcy5qc29uJztcbiAgICAgICAgdmFyIHJlY2lwZXNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAncmVjaXBlcy8nLCAnaScpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlbkdFVChyZWNpcGVzUmVnZXgpLnJlc3BvbmQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldFN5bmMocmVjaXBlc092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmVjaXBlIFR5cGUgRGV0YWlsIHNlcnZpY2VcbiAgICAgICAgdmFyIHJlY2lwZVR5cGVEZXRhaWxPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvcmVjaXBlVHlwZURldGFpbC5qc29uJztcbiAgICAgICAgdmFyIHJlY2lwZVR5cGVEZXRhaWxSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAncmVjaXBlLXR5cGVzLy4qLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKHJlY2lwZVR5cGVEZXRhaWxSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhyZWNpcGVUeXBlRGV0YWlsT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBSZWNpcGUgVHlwZXMgc2VydmljZVxuICAgICAgICB2YXIgcmVjaXBlVHlwZXNPdmVycmlkZVVybCA9ICd0ZXN0L2RhdGEvcmVjaXBlVHlwZXMuanNvbic7XG4gICAgICAgIHZhciByZWNpcGVUeXBlc1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICdyZWNpcGUtdHlwZXMvJywgJ2knKTtcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQocmVjaXBlVHlwZXNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyhyZWNpcGVUeXBlc092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gU3RhdHVzIHNlcnZpY2VcbiAgICAgICAgdmFyIHN0YXR1c092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS9zdGF0dXMuanNvbic7XG4gICAgICAgIHZhciBzdGF0dXNSZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgc2NhbGVDb25maWcudXJscy5hcGlQcmVmaXggKyAnc3RhdHVzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKHN0YXR1c1JlZ2V4KS5yZXNwb25kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRTeW5jKHN0YXR1c092ZXJyaWRlVXJsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gV29ya3NwYWNlc1xuICAgICAgICB2YXIgd29ya3NwYWNlc092ZXJyaWRlVXJsID0gJ3Rlc3QvZGF0YS93b3Jrc3BhY2VzLmpzb24nO1xuICAgICAgICB2YXIgd29ya3NwYWNlc1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXicgKyBzY2FsZUNvbmZpZy51cmxzLmFwaVByZWZpeCArICd3b3Jrc3BhY2VzLycsICdpJyk7XG4gICAgICAgICRodHRwQmFja2VuZC53aGVuR0VUKHdvcmtzcGFjZXNSZWdleCkucmVzcG9uZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0U3luYyh3b3Jrc3BhY2VzT3ZlcnJpZGVVcmwpO1xuICAgICAgICB9KTtcblxuXG5cblxuXG4gICAgICAgIC8vIEZvciBldmVyeXRoaW5nIGVsc2UsIGRvbid0IG1vY2tcbiAgICAgICAgJGh0dHBCYWNrZW5kLndoZW5HRVQoL15cXHcrLiovKS5wYXNzVGhyb3VnaCgpO1xuICAgICAgICAkaHR0cEJhY2tlbmQud2hlblBPU1QoL15cXHcrLiovKS5wYXNzVGhyb3VnaCgpO1xuICAgIH0pO1xufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
